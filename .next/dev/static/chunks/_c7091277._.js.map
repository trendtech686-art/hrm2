{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/switch.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\r\n\r\nimport { cn } from \"../../lib/utils\"\r\n\r\ntype SwitchProps = Omit<\r\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>,\r\n  \"checked\" | \"defaultChecked\"\r\n> & {\r\n  checked?: boolean | undefined\r\n  defaultChecked?: boolean | undefined\r\n}\r\n\r\nconst Switch = React.forwardRef<\r\n  React.ElementRef<typeof SwitchPrimitives.Root>,\r\n  SwitchProps\r\n>(({ className, checked, defaultChecked, ...props }, ref) => (\r\n  <SwitchPrimitives.Root\r\n    className={cn(\r\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\r\n      className\r\n    )}\r\n    {...props}\r\n    {...(checked !== undefined ? { checked } : {})}\r\n    {...(defaultChecked !== undefined ? { defaultChecked } : {})}\r\n    ref={ref}\r\n  >\r\n    <SwitchPrimitives.Thumb\r\n      className={cn(\r\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\r\n      )}\r\n    />\r\n  </SwitchPrimitives.Root>\r\n))\r\nSwitch.displayName = SwitchPrimitives.Root.displayName\r\n\r\nexport { Switch }\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAEA;AALA;;;;;AAeA,MAAM,uBAAS,2KAAgB,MAG7B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,cAAc,EAAE,GAAG,OAAO,EAAE,oBACnD,6LAAC,6KAAqB;QACpB,WAAW,IAAA,qHAAE,EACX,sXACA;QAED,GAAG,KAAK;QACR,GAAI,YAAY,YAAY;YAAE;QAAQ,IAAI,CAAC,CAAC;QAC5C,GAAI,mBAAmB,YAAY;YAAE;QAAe,IAAI,CAAC,CAAC;QAC3D,KAAK;kBAEL,cAAA,6LAAC,8KAAsB;YACrB,WAAW,IAAA,qHAAE,EACX;;;;;;;;;;;;AAKR,OAAO,WAAW,GAAG,6KAAqB,CAAC,WAAW"}},
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/popover.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\r\n\r\nimport { cn } from \"../../lib/utils\"\r\nimport { useModal } from \"../../contexts/modal-context\"\r\n\r\nconst Popover = PopoverPrimitive.Root\r\n\r\nconst PopoverTrigger = PopoverPrimitive.Trigger\r\n\r\n// Context to pass popover ID through the component tree\r\nconst PopoverContext = React.createContext<string>(\"\");\r\n\r\n// Provider component that accepts an ID\r\nconst PopoverProvider = ({ id, children }: { id: string; children: React.ReactNode }) => {\r\n  return <PopoverContext.Provider value={id}>{children}</PopoverContext.Provider>;\r\n};\r\n\r\nconst PopoverContent = React.forwardRef<\r\n  React.ElementRef<typeof PopoverPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content> & {\r\n    id?: string;\r\n  }\r\n>(({ className, align = \"center\", sideOffset = 4, id: propId, ...props }, ref) => {\r\n  // Use either the prop id or the id from context\r\n  const contextId = React.useContext(PopoverContext);\r\n  const id = propId || contextId || `popover-${React.useId()}`;\r\n  \r\n  // Get open state from props\r\n  const [open, setOpen] = React.useState(false);\r\n  React.useEffect(() => {\r\n    if (props[\"data-state\"] === \"open\") {\r\n      setOpen(true);\r\n    } else {\r\n      setOpen(false);\r\n    }\r\n  }, [props[\"data-state\"]]);\r\n  \r\n  // Register with our modal context\r\n  const { zIndex } = useModal(id, open, 'popover');\r\n  \r\n  return (\r\n    <PopoverPrimitive.Portal>\r\n      <PopoverPrimitive.Content\r\n        ref={ref}\r\n        align={align}\r\n        sideOffset={sideOffset}\r\n        className={cn(\r\n          \"w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none transition-opacity duration-200 opacity-0 data-[state=open]:opacity-100 data-[state=closed]:opacity-0\",\r\n          className\r\n        )}\r\n        style={{ zIndex }}\r\n        {...props}\r\n      >\r\n        <PopoverProvider id={id}>\r\n          {props.children}\r\n        </PopoverProvider>\r\n      </PopoverPrimitive.Content>\r\n    </PopoverPrimitive.Portal>\r\n  );\r\n})\r\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\r\n\r\nexport { Popover, PopoverTrigger, PopoverContent, PopoverProvider }\r\n"],"names":[],"mappings":";;;;;;;;;;;AAEA;AACA;AAEA;AACA;;;AANA;;;;;AAQA,MAAM,UAAU,8KAAqB;AAErC,MAAM,iBAAiB,iLAAwB;AAE/C,wDAAwD;AACxD,MAAM,+BAAiB,8KAAmB,CAAS;AAEnD,wCAAwC;AACxC,MAAM,kBAAkB,CAAC,EAAE,EAAE,EAAE,QAAQ,EAA6C;IAClF,qBAAO,6LAAC,eAAe,QAAQ;QAAC,OAAO;kBAAK;;;;;;AAC9C;KAFM;AAIN,MAAM,+BAAiB,GAAA,2KAAgB,UAKrC,CAAC,EAAE,SAAS,EAAE,QAAQ,QAAQ,EAAE,aAAa,CAAC,EAAE,IAAI,MAAM,EAAE,GAAG,OAAO,EAAE;;IACxE,gDAAgD;IAChD,MAAM,YAAY,2KAAgB,CAAC;IACnC,MAAM,KAAK,UAAU,aAAa,CAAC,QAAQ,EAAE,sKAAW,IAAI;IAE5D,4BAA4B;IAC5B,MAAM,CAAC,MAAM,QAAQ,GAAG,yKAAc,CAAC;IACvC,0KAAe;oCAAC;YACd,IAAI,KAAK,CAAC,aAAa,KAAK,QAAQ;gBAClC,QAAQ;YACV,OAAO;gBACL,QAAQ;YACV;QACF;mCAAG;QAAC,KAAK,CAAC,aAAa;KAAC;IAExB,kCAAkC;IAClC,MAAM,EAAE,MAAM,EAAE,GAAG,IAAA,4IAAQ,EAAC,IAAI,MAAM;IAEtC,qBACE,6LAAC,gLAAuB;kBACtB,cAAA,6LAAC,iLAAwB;YACvB,KAAK;YACL,OAAO;YACP,YAAY;YACZ,WAAW,IAAA,qHAAE,EACX,8LACA;YAEF,OAAO;gBAAE;YAAO;YACf,GAAG,KAAK;sBAET,cAAA,6LAAC;gBAAgB,IAAI;0BAClB,MAAM,QAAQ;;;;;;;;;;;;;;;;AAKzB;;QArBqB,4IAAQ;;;;QAAR,4IAAQ;;;;AAsB7B,eAAe,WAAW,GAAG,iLAAwB,CAAC,WAAW"}},
    {"offset": {"line": 161, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"../../lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border border-border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLHeadingElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      \"text-h3 font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA;AAEA;;;;AAEA,MAAM,qBAAO,2KAAgB,MAG3B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,0EACA;QAED,GAAG,KAAK;;;;;;;AAGb,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,2KAAgB,OAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,2KAAgB,OAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,qDACA;QAED,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,2KAAgB,OAGtC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;AAGb,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QAAI,KAAK;QAAK,WAAW,IAAA,qHAAE,EAAC,YAAY;QAAa,GAAG,KAAK;;;;;;;AAEhE,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,2KAAgB,QAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;;AAGb,WAAW,WAAW,GAAG"}},
    {"offset": {"line": 268, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/checkbox.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\r\nimport { Check } from \"lucide-react\"\r\n\r\nimport { cn } from \"../../lib/utils\"\r\n\r\ntype BaseCheckboxProps = React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\r\n\r\ntype CheckboxProps = Omit<BaseCheckboxProps, \"checked\" | \"defaultChecked\"> & {\r\n  checked?: CheckboxPrimitive.CheckedState | undefined\r\n  defaultChecked?: CheckboxPrimitive.CheckedState | undefined\r\n}\r\n\r\nconst Checkbox = React.forwardRef<\r\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\r\n  CheckboxProps\r\n>(({ className, checked, defaultChecked, ...props }, ref) => (\r\n  <CheckboxPrimitive.Root\r\n    ref={ref}\r\n    className={cn(\r\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\r\n      className\r\n    )}\r\n    {...props}\r\n    {...(checked !== undefined ? { checked } : {})}\r\n    {...(defaultChecked !== undefined ? { defaultChecked } : {})}\r\n  >\r\n    <CheckboxPrimitive.Indicator\r\n      className={cn(\"flex items-center justify-center text-current\")}\r\n    >\r\n      <Check className=\"h-4 w-4\" />\r\n    </CheckboxPrimitive.Indicator>\r\n  </CheckboxPrimitive.Root>\r\n))\r\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\r\n\r\nexport { Checkbox }\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAEA;;;;;;AASA,MAAM,yBAAW,2KAAgB,MAG/B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,cAAc,EAAE,GAAG,OAAO,EAAE,oBACnD,6LAAC,+KAAsB;QACrB,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,kTACA;QAED,GAAG,KAAK;QACR,GAAI,YAAY,YAAY;YAAE;QAAQ,IAAI,CAAC,CAAC;QAC5C,GAAI,mBAAmB,YAAY;YAAE;QAAe,IAAI,CAAC,CAAC;kBAE3D,cAAA,6LAAC,oLAA2B;YAC1B,WAAW,IAAA,qHAAE,EAAC;sBAEd,cAAA,6LAAC,gNAAK;gBAAC,WAAU;;;;;;;;;;;;;;;;;AAIvB,SAAS,WAAW,GAAG,+KAAsB,CAAC,WAAW"}},
    {"offset": {"line": 324, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/dialog.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\r\nimport { X } from \"lucide-react\"\r\n\r\nimport { cn } from \"../../lib/utils\"\r\nimport { useModal } from \"../../contexts/modal-context\"\r\n\r\n// Use the original Dialog component\r\nconst Dialog = DialogPrimitive.Root\r\n\r\n// Create a Context to pass ID through the Dialog component tree\r\nconst DialogContext = React.createContext<string>(\"\");\r\n\r\n// Provider component that accepts an ID\r\nconst DialogProvider = ({ id, children }: { id: string; children: React.ReactNode }) => {\r\n  return <DialogContext.Provider value={id}>{children}</DialogContext.Provider>;\r\n};\r\n\r\nconst DialogTrigger = DialogPrimitive.Trigger\r\n\r\nconst DialogPortal = DialogPrimitive.Portal\r\n\r\nconst DialogClose = DialogPrimitive.Close\r\n\r\nconst DialogOverlay = React.forwardRef<\r\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\r\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\r\n>(({ className, ...props }, ref) => (\r\n  <DialogPrimitive.Overlay\r\n    ref={ref}\r\n    className={cn(\r\n      \"fixed inset-0 z-50 bg-black/50 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\r\n\r\nconst DialogContent = React.forwardRef<\r\n  React.ElementRef<typeof DialogPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content> & { \r\n    id?: string;\r\n    open?: boolean;\r\n  }\r\n>(({ className, children, id: propId, open, ...props }, ref) => {\r\n  // Use either the prop id or the id from context\r\n  const contextId = React.useContext(DialogContext);\r\n  const id = propId || contextId || `dialog-${React.useId()}`;\r\n  \r\n  // Register with our modal context using the open prop\r\n  const { zIndex } = useModal(id, !!open, 'dialog');\r\n  \r\n  return (\r\n    <DialogPortal>\r\n      {/* Sử dụng overlay chỉ dành cho Dialog */}\r\n      <DialogOverlay style={{ zIndex: zIndex - 1 }} />\r\n      <DialogPrimitive.Content\r\n        ref={ref}\r\n        className={cn(\r\n          \"dialog-content fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-border bg-background p-6 shadow-lg sm:rounded-lg\",\r\n          className\r\n        )}\r\n        style={{ zIndex }}\r\n        {...props}\r\n      >\r\n        <DialogProvider id={id}>\r\n          {children}\r\n          <DialogPrimitive.Close\r\n            aria-label=\"Đóng\"\r\n            className=\"absolute right-4 top-4 flex h-9 w-9 items-center justify-center rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\"\r\n          >\r\n            <X className=\"h-4 w-4\" />\r\n            <span className=\"sr-only\">Đóng</span>\r\n          </DialogPrimitive.Close>\r\n        </DialogProvider>\r\n      </DialogPrimitive.Content>\r\n    </DialogPortal>\r\n  );\r\n})\r\nDialogContent.displayName = DialogPrimitive.Content.displayName\r\n\r\nconst DialogHeader = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement>) => (\r\n  <div\r\n    className={cn(\r\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n)\r\nDialogHeader.displayName = \"DialogHeader\"\r\n\r\nconst DialogFooter = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement>) => (\r\n  <div\r\n    className={cn(\r\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n)\r\nDialogFooter.displayName = \"DialogFooter\"\r\n\r\nconst DialogTitle = React.forwardRef<\r\n  React.ElementRef<typeof DialogPrimitive.Title>,\r\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\r\n>(({ className, ...props }, ref) => (\r\n  <DialogPrimitive.Title\r\n    ref={ref}\r\n    className={cn(\r\n      \"text-lg font-semibold leading-none tracking-tight\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nDialogTitle.displayName = DialogPrimitive.Title.displayName\r\n\r\nconst DialogDescription = React.forwardRef<\r\n  React.ElementRef<typeof DialogPrimitive.Description>,\r\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\r\n>(({ className, ...props }, ref) => (\r\n  <DialogPrimitive.Description\r\n    ref={ref}\r\n    className={cn(\"text-sm text-muted-foreground\", className)}\r\n    {...props}\r\n  />\r\n))\r\nDialogDescription.displayName = DialogPrimitive.Description.displayName\r\n\r\nexport {\r\n  Dialog,\r\n  DialogPortal,\r\n  DialogOverlay,\r\n  DialogClose,\r\n  DialogTrigger,\r\n  DialogContent,\r\n  DialogHeader,\r\n  DialogFooter,\r\n  DialogTitle,\r\n  DialogDescription,\r\n  DialogProvider,\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAEA;AACA;;;;;;;;AAEA,oCAAoC;AACpC,MAAM,SAAS,6KAAoB;AAEnC,gEAAgE;AAChE,MAAM,8BAAgB,8KAAmB,CAAS;AAElD,wCAAwC;AACxC,MAAM,iBAAiB,CAAC,EAAE,EAAE,EAAE,QAAQ,EAA6C;IACjF,qBAAO,6LAAC,cAAc,QAAQ;QAAC,OAAO;kBAAK;;;;;;AAC7C;KAFM;AAIN,MAAM,gBAAgB,gLAAuB;AAE7C,MAAM,eAAe,+KAAsB;AAE3C,MAAM,cAAc,8KAAqB;AAEzC,MAAM,8BAAgB,2KAAgB,CAGpC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,gLAAuB;QACtB,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,0JACA;QAED,GAAG,KAAK;;;;;;MAVP;AAaN,cAAc,WAAW,GAAG,gLAAuB,CAAC,WAAW;AAE/D,MAAM,8BAAgB,GAAA,2KAAgB,UAMpC,CAAC,EAAE,SAAS,EAAE,QAAQ,EAAE,IAAI,MAAM,EAAE,IAAI,EAAE,GAAG,OAAO,EAAE;;IACtD,gDAAgD;IAChD,MAAM,YAAY,2KAAgB,CAAC;IACnC,MAAM,KAAK,UAAU,aAAa,CAAC,OAAO,EAAE,sKAAW,IAAI;IAE3D,sDAAsD;IACtD,MAAM,EAAE,MAAM,EAAE,GAAG,IAAA,4IAAQ,EAAC,IAAI,CAAC,CAAC,MAAM;IAExC,qBACE,6LAAC;;0BAEC,6LAAC;gBAAc,OAAO;oBAAE,QAAQ,SAAS;gBAAE;;;;;;0BAC3C,6LAAC,gLAAuB;gBACtB,KAAK;gBACL,WAAW,IAAA,qHAAE,EACX,kLACA;gBAEF,OAAO;oBAAE;gBAAO;gBACf,GAAG,KAAK;0BAET,cAAA,6LAAC;oBAAe,IAAI;;wBACjB;sCACD,6LAAC,8KAAqB;4BACpB,cAAW;4BACX,WAAU;;8CAEV,6LAAC,oMAAC;oCAAC,WAAU;;;;;;8CACb,6LAAC;oCAAK,WAAU;8CAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMtC;;QA5BqB,4IAAQ;;;;QAAR,4IAAQ;;;;AA6B7B,cAAc,WAAW,GAAG,gLAAuB,CAAC,WAAW;AAE/D,MAAM,eAAe,CAAC,EACpB,SAAS,EACT,GAAG,OACkC,iBACrC,6LAAC;QACC,WAAW,IAAA,qHAAE,EACX,sDACA;QAED,GAAG,KAAK;;;;;;MATP;AAYN,aAAa,WAAW,GAAG;AAE3B,MAAM,eAAe,CAAC,EACpB,SAAS,EACT,GAAG,OACkC,iBACrC,6LAAC;QACC,WAAW,IAAA,qHAAE,EACX,iEACA;QAED,GAAG,KAAK;;;;;;MATP;AAYN,aAAa,WAAW,GAAG;AAE3B,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,8KAAqB;QACpB,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,qDACA;QAED,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG,8KAAqB,CAAC,WAAW;AAE3D,MAAM,kCAAoB,2KAAgB,OAGxC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,oLAA2B;QAC1B,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;AAGb,kBAAkB,WAAW,GAAG,oLAA2B,CAAC,WAAW"}},
    {"offset": {"line": 534, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/alert-dialog.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\r\n\r\nimport { cn } from \"../../lib/utils\"\r\nimport { buttonVariants } from \"./button\"\r\n\r\nconst AlertDialog = AlertDialogPrimitive.Root\r\n\r\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\r\n\r\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\r\n\r\nconst AlertDialogOverlay = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Overlay\r\n    className={cn(\r\n      \"fixed inset-0 z-50 bg-black/80 transition-opacity duration-200 opacity-0 data-[state=open]:opacity-100 data-[state=closed]:opacity-0\",\r\n      className\r\n    )}\r\n    {...props}\r\n    ref={ref}\r\n  />\r\n))\r\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\r\n\r\nconst AlertDialogContent = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPortal>\r\n    <AlertDialogOverlay />\r\n    <AlertDialogPrimitive.Content\r\n      ref={ref}\r\n      className={cn(\r\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border border-border bg-background p-6 shadow-lg transition-opacity duration-200 opacity-0 data-[state=open]:opacity-100 data-[state=closed]:opacity-0 sm:rounded-lg\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  </AlertDialogPortal>\r\n))\r\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\r\n\r\nconst AlertDialogHeader = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement>) => (\r\n  <div\r\n    className={cn(\r\n      \"flex flex-col space-y-2 text-center sm:text-left\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n)\r\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\r\n\r\nconst AlertDialogFooter = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLDivElement>) => (\r\n  <div\r\n    className={cn(\r\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n)\r\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\r\n\r\nconst AlertDialogTitle = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Title\r\n    ref={ref}\r\n    className={cn(\"text-lg font-semibold\", className)}\r\n    {...props}\r\n  />\r\n))\r\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\r\n\r\nconst AlertDialogDescription = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Description\r\n    ref={ref}\r\n    className={cn(\"text-sm text-muted-foreground\", className)}\r\n    {...props}\r\n  />\r\n))\r\nAlertDialogDescription.displayName =\r\n  AlertDialogPrimitive.Description.displayName\r\n\r\nconst AlertDialogAction = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Action\r\n    ref={ref}\r\n    className={cn(buttonVariants(), className)}\r\n    {...props}\r\n  />\r\n))\r\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\r\n\r\nconst AlertDialogCancel = React.forwardRef<\r\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\r\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\r\n>(({ className, ...props }, ref) => (\r\n  <AlertDialogPrimitive.Cancel\r\n    ref={ref}\r\n    className={cn(\r\n      buttonVariants({ variant: \"outline\" }),\r\n      \"mt-2 sm:mt-0\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\r\n\r\nexport {\r\n  AlertDialog,\r\n  AlertDialogPortal,\r\n  AlertDialogOverlay,\r\n  AlertDialogTrigger,\r\n  AlertDialogContent,\r\n  AlertDialogHeader,\r\n  AlertDialogFooter,\r\n  AlertDialogTitle,\r\n  AlertDialogDescription,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAEA;AACA;;;;;;AAEA,MAAM,cAAc,sLAAyB;AAE7C,MAAM,qBAAqB,yLAA4B;AAEvD,MAAM,oBAAoB,wLAA2B;AAErD,MAAM,mCAAqB,2KAAgB,CAGzC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,yLAA4B;QAC3B,WAAW,IAAA,qHAAE,EACX,wIACA;QAED,GAAG,KAAK;QACT,KAAK;;;;;;KAVH;AAaN,mBAAmB,WAAW,GAAG,yLAA4B,CAAC,WAAW;AAEzE,MAAM,mCAAqB,2KAAgB,OAGzC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;;0BACC,6LAAC;;;;;0BACD,6LAAC,yLAA4B;gBAC3B,KAAK;gBACL,WAAW,IAAA,qHAAE,EACX,yQACA;gBAED,GAAG,KAAK;;;;;;;;;;;;;AAIf,mBAAmB,WAAW,GAAG,yLAA4B,CAAC,WAAW;AAEzE,MAAM,oBAAoB,CAAC,EACzB,SAAS,EACT,GAAG,OACkC,iBACrC,6LAAC;QACC,WAAW,IAAA,qHAAE,EACX,oDACA;QAED,GAAG,KAAK;;;;;;MATP;AAYN,kBAAkB,WAAW,GAAG;AAEhC,MAAM,oBAAoB,CAAC,EACzB,SAAS,EACT,GAAG,OACkC,iBACrC,6LAAC;QACC,WAAW,IAAA,qHAAE,EACX,iEACA;QAED,GAAG,KAAK;;;;;;MATP;AAYN,kBAAkB,WAAW,GAAG;AAEhC,MAAM,iCAAmB,2KAAgB,OAGvC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,uLAA0B;QACzB,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,yBAAyB;QACtC,GAAG,KAAK;;;;;;;AAGb,iBAAiB,WAAW,GAAG,uLAA0B,CAAC,WAAW;AAErE,MAAM,uCAAyB,2KAAgB,OAG7C,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,6LAAgC;QAC/B,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;AAGb,uBAAuB,WAAW,GAChC,6LAAgC,CAAC,WAAW;AAE9C,MAAM,kCAAoB,2KAAgB,OAGxC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,wLAA2B;QAC1B,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,IAAA,gJAAc,KAAI;QAC/B,GAAG,KAAK;;;;;;;AAGb,kBAAkB,WAAW,GAAG,wLAA2B,CAAC,WAAW;AAEvE,MAAM,kCAAoB,2KAAgB,QAGxC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,wLAA2B;QAC1B,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,IAAA,gJAAc,EAAC;YAAE,SAAS;QAAU,IACpC,gBACA;QAED,GAAG,KAAK;;;;;;;AAGb,kBAAkB,WAAW,GAAG,wLAA2B,CAAC,WAAW"}},
    {"offset": {"line": 694, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/label.tsx"],"sourcesContent":["import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"../../lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAEA;;;;;;AAEA,MAAM,gBAAgB,IAAA,0KAAG,EACvB;AAGF,MAAM,sBAAQ,2KAAgB,MAI5B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,4KAAmB;QAClB,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,iBAAiB;QAC9B,GAAG,KAAK;;;;;;;AAGb,MAAM,WAAW,GAAG,4KAAmB,CAAC,WAAW"}},
    {"offset": {"line": 731, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/tabs.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\r\n\r\nimport { cn } from \"../../lib/utils\"\r\n\r\nconst Tabs = TabsPrimitive.Root\r\n\r\nconst TabsList = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.List\r\n    ref={ref}\r\n    className={cn(\r\n      \"inline-flex h-9 items-center justify-center rounded-md bg-muted p-1\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTabsList.displayName = TabsPrimitive.List.displayName\r\n\r\nconst TabsTrigger = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.Trigger\r\n    ref={ref}\r\n    className={cn(\r\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium text-muted-foreground ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\r\n\r\nconst TabsContent = React.forwardRef<\r\n  React.ElementRef<typeof TabsPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <TabsPrimitive.Content\r\n    ref={ref}\r\n    className={cn(\r\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTabsContent.displayName = TabsPrimitive.Content.displayName\r\n\r\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\r\n"],"names":[],"mappings":";;;;;;;;;;;AAAA;AACA;AAEA;;;;;AAEA,MAAM,OAAO,2KAAkB;AAE/B,MAAM,yBAAW,2KAAgB,MAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,2KAAkB;QACjB,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,uEACA;QAED,GAAG,KAAK;;;;;;;AAGb,SAAS,WAAW,GAAG,2KAAkB,CAAC,WAAW;AAErD,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,8KAAqB;QACpB,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,6ZACA;QAED,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG,8KAAqB,CAAC,WAAW;AAE3D,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,8KAAqB;QACpB,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,mIACA;QAED,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG,8KAAqB,CAAC,WAAW"}},
    {"offset": {"line": 798, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/id-utils.ts"],"sourcesContent":["/**\r\n * ID Utilities\r\n * Helpers for generating and validating IDs (systemId & business id)\r\n */\r\n\r\nimport { getPrefix, type EntityType } from './smart-prefix';\r\nimport { ID_CONFIG } from './id-config';\r\n\r\n// Re-export EntityType for convenience\r\nexport type { EntityType } from './smart-prefix';\r\n\r\n/**\r\n * Generate SystemId (6 digits, immutable, internal use only)\r\n * Format: SYSTEMID_PREFIX + 6 digits (e.g., \"EMP000001\", \"CUSTOMER000001\", \"ORDER000001\")\r\n * Uses systemIdPrefix from ID_CONFIG (English full words)\r\n */\r\nexport function generateSystemId(entityType: EntityType, counter: number): string {\r\n  const config = ID_CONFIG[entityType];\r\n  if (!config) {\r\n    throw new Error(`No configuration found for entity type: ${entityType}`);\r\n  }\r\n  const prefix = config.systemIdPrefix;\r\n  const digitCount = config.digitCount || 6;\r\n  return `${prefix}${String(counter).padStart(digitCount, '0')}`;\r\n}\r\n\r\n/**\r\n * Generate Business ID (6 digits, user-facing, editable)\r\n * Format: PREFIX + 6 digits (e.g., \"NV000001\", \"KH000001\", \"CTV000001\")\r\n * All entities use same 6-digit format for consistency\r\n * \r\n * @param entityType - Entity type from smart-prefix\r\n * @param counter - Current counter value\r\n * @param customId - Optional custom ID from user input\r\n * @returns Generated ID or validated custom ID\r\n */\r\nexport function generateBusinessId(\r\n  entityType: EntityType, \r\n  counter: number,\r\n  customId?: string\r\n): string {\r\n  // If user provided custom ID, validate and return it\r\n  if (customId && customId.trim()) {\r\n    const sanitized = sanitizeBusinessId(customId);\r\n    if (!sanitized) {\r\n      throw new Error('Mã không hợp lệ! Chỉ được phép sử dụng chữ cái và số.');\r\n    }\r\n    return sanitized;\r\n  }\r\n  \r\n  // Otherwise, auto-generate\r\n  const prefix = getPrefix(entityType);\r\n  return `${prefix}${String(counter).padStart(6, '0')}`;\r\n}\r\n\r\n/**\r\n * Sanitize business ID\r\n * - Remove special characters (keep only letters and numbers)\r\n * - Convert to uppercase\r\n * - Trim whitespace\r\n * \r\n * @param id - Raw user input\r\n * @returns Sanitized ID or null if invalid\r\n */\r\nexport function sanitizeBusinessId(id: string): string | null {\r\n  if (!id || typeof id !== 'string') return null;\r\n  \r\n  // Remove all special characters, keep only alphanumeric\r\n  const cleaned = id.trim().replace(/[^a-zA-Z0-9]/g, '');\r\n  \r\n  if (!cleaned) return null;\r\n  \r\n  // Convert to uppercase for consistency\r\n  return cleaned.toUpperCase();\r\n}\r\n\r\n/**\r\n * Validate business ID uniqueness (case-insensitive)\r\n * \r\n * @param id - ID to check\r\n * @param existingIds - Array of existing IDs in the system\r\n * @param currentId - Current ID (for edit mode, to exclude self)\r\n * @returns true if unique, false if duplicate\r\n */\r\nexport function isBusinessIdUnique(\r\n  id: string,\r\n  existingIds: string[],\r\n  currentId?: string\r\n): boolean {\r\n  if (!id) return false;\r\n  \r\n  const normalizedId = id.toUpperCase();\r\n  const normalizedCurrentId = currentId?.toUpperCase();\r\n  \r\n  return !existingIds.some(existingId => {\r\n    // ✅ Filter out empty/undefined IDs\r\n    if (!existingId || existingId.trim() === '') return false;\r\n    \r\n    const normalizedExisting = existingId.toUpperCase();\r\n    // Skip self-comparison in edit mode\r\n    if (normalizedCurrentId && normalizedExisting === normalizedCurrentId) {\r\n      return false;\r\n    }\r\n    return normalizedExisting === normalizedId;\r\n  });\r\n}\r\n\r\n/**\r\n * Extract counter from system ID\r\n * Used to initialize counter when loading from localStorage\r\n * Supports both 6, 7 and 8 digits\r\n * \r\n * @param systemId - System ID to parse (e.g., \"EMP000001\", \"CUSTOMER000001\", \"WARRANTY0000001\")\r\n * @param prefix - Expected systemIdPrefix (e.g., \"EMP\", \"CUSTOMER\", \"WARRANTY\")\r\n * @returns Counter value or 0 if invalid\r\n */\r\nexport function extractCounterFromSystemId(systemId: string, prefix: string): number {\r\n  if (!systemId || typeof systemId !== 'string') return 0;\r\n  \r\n  // Try different digit counts (most entities use 6 digits, some use 7-8)\r\n  const regex8 = new RegExp(`^${prefix}(\\\\d{8})$`);\r\n  const regex7 = new RegExp(`^${prefix}(\\\\d{7})$`);\r\n  const regex6 = new RegExp(`^${prefix}(\\\\d{6})$`);\r\n  \r\n  const match8 = systemId.match(regex8);\r\n  if (match8) return parseInt(match8[1], 10);\r\n  \r\n  const match7 = systemId.match(regex7);\r\n  if (match7) return parseInt(match7[1], 10);\r\n  \r\n  const match6 = systemId.match(regex6);\r\n  if (match6) return parseInt(match6[1], 10);\r\n  \r\n  return 0;\r\n}\r\n\r\n/**\r\n * Extract counter from business ID\r\n * Used to initialize counter when loading from localStorage\r\n * \r\n * @param businessId - Business ID to parse (e.g., \"NV000001\")\r\n * @param prefix - Expected prefix (e.g., \"NV\")\r\n * @returns Counter value or 0 if invalid\r\n */\r\nexport function extractCounterFromBusinessId(businessId: string, prefix: string): number {\r\n  if (!businessId || typeof businessId !== 'string') return 0;\r\n  const regex = new RegExp(`^${prefix}(\\\\d+)$`);\r\n  const match = businessId.match(regex);\r\n  return match ? parseInt(match[1], 10) : 0;\r\n}\r\n\r\n/**\r\n * Get max counter from array of items (for systemId)\r\n * \r\n * @param items - Array of items with systemId\r\n * @param prefix - Prefix to match\r\n * @returns Maximum counter value\r\n */\r\nexport function getMaxSystemIdCounter<T extends { systemId: string }>(\r\n  items: T[],\r\n  prefix: string\r\n): number {\r\n  if (!items || !Array.isArray(items)) return 0;\r\n  \r\n  let maxCounter = 0;\r\n  \r\n  items.forEach(item => {\r\n    if (!item || !item.systemId) return;\r\n    const counter = extractCounterFromSystemId(item.systemId, prefix);\r\n    if (counter > maxCounter) {\r\n      maxCounter = counter;\r\n    }\r\n  });\r\n  \r\n  return maxCounter;\r\n}\r\n\r\n/**\r\n * Get max counter from array of items (for business id)\r\n * Only counts auto-generated IDs (PREFIX + digits)\r\n * \r\n * @param items - Array of items with id\r\n * @param prefix - Prefix to match\r\n * @returns Maximum counter value\r\n */\r\nexport function getMaxBusinessIdCounter<T extends { id: string }>(\r\n  items: T[],\r\n  prefix: string\r\n): number {\r\n  if (!items || !Array.isArray(items)) return 0;\r\n  \r\n  let maxCounter = 0;\r\n  \r\n  items.forEach(item => {\r\n    if (!item || !item.id) return;\r\n    const counter = extractCounterFromBusinessId(item.id, prefix);\r\n    if (counter > maxCounter) {\r\n      maxCounter = counter;\r\n    }\r\n  });\r\n  \r\n  return maxCounter;\r\n}\r\n\r\n/**\r\n * Format ID for display\r\n * Adds spacing for readability\r\n * \r\n * @param id - ID to format\r\n * @returns Formatted ID (e.g., \"NV-000001\", \"KH-000123\")\r\n */\r\nexport function formatIdForDisplay(id: string): string {\r\n  // Match pattern: PREFIX followed by numbers\r\n  const match = id.match(/^([A-Z]+)(\\d+)$/);\r\n  if (!match) return id;\r\n  \r\n  const [, prefix, numbers] = match;\r\n  return `${prefix}-${numbers}`;\r\n}\r\n\r\n/**\r\n * Validate ID format\r\n * Check if ID follows valid pattern (letters + numbers only)\r\n * \r\n * @param id - ID to validate\r\n * @returns true if valid format\r\n */\r\nexport function isValidIdFormat(id: string): boolean {\r\n  if (!id || typeof id !== 'string') return false;\r\n  \r\n  // Only alphanumeric characters allowed\r\n  const regex = /^[A-Z0-9]+$/i;\r\n  return regex.test(id);\r\n}\r\n\r\n/**\r\n * Generate suggested IDs based on entity type\r\n * Useful for autocomplete or placeholder text\r\n * \r\n * @param entityType - Entity type\r\n * @param counter - Current counter\r\n * @param count - Number of suggestions\r\n * @returns Array of suggested IDs\r\n */\r\nexport function generateSuggestedIds(\r\n  entityType: EntityType,\r\n  counter: number,\r\n  count: number = 3\r\n): string[] {\r\n  const suggestions: string[] = [];\r\n  const prefix = getPrefix(entityType);\r\n  \r\n  for (let i = 0; i < count; i++) {\r\n    suggestions.push(`${prefix}${String(counter + i + 1).padStart(6, '0')}`);\r\n  }\r\n  \r\n  return suggestions;\r\n}\r\n\r\n/**\r\n * ✨ Find next available business ID\r\n * Checks existing IDs and increments counter until finding a unique ID\r\n * \r\n * @param prefix - ID prefix (e.g., 'PT', 'PC', 'NV')\r\n * @param existingIds - Array of existing business IDs\r\n * @param startCounter - Starting counter value\r\n * @param digitCount - Number of digits (default: 6)\r\n * @returns Object with nextId and updatedCounter\r\n */\r\nexport function findNextAvailableBusinessId(\r\n  prefix: string,\r\n  existingIds: string[],\r\n  startCounter: number,\r\n  digitCount: number = 6\r\n): { nextId: string; updatedCounter: number } {\r\n  let counter = startCounter;\r\n  let nextId: string;\r\n  \r\n  // Keep incrementing until we find a unique ID\r\n  do {\r\n    counter++;\r\n    nextId = `${prefix}${String(counter).padStart(digitCount, '0')}`;\r\n  } while (existingIds.some(id => id === nextId));\r\n  \r\n  return {\r\n    nextId,\r\n    updatedCounter: counter\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 961, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/store-factory.ts"],"sourcesContent":["import { create } from 'zustand';\r\n// persist, createJSONStorage removed - database is now source of truth\r\nimport { \r\n  generateSystemId, \r\n  generateBusinessId, \r\n  isBusinessIdUnique,\r\n  getMaxSystemIdCounter,\r\n  getMaxBusinessIdCounter,\r\n  findNextAvailableBusinessId,\r\n  type EntityType \r\n} from './id-utils';\r\nimport { getPrefix } from './smart-prefix';\r\nimport { ID_CONFIG, type SystemId, type BusinessId, createSystemId, createBusinessId as brandBusinessId } from './id-config';\r\n\r\nconst SYSTEM_FALLBACK_ID: SystemId = createSystemId('SYS000000');\r\n\r\nconst asSystemIdFallback = (): SystemId => SYSTEM_FALLBACK_ID;\r\n\r\n// ✅ API Sync helper for store-factory\r\nasync function syncToAPI<T>(\r\n  apiEndpoint: string,\r\n  action: 'create' | 'update' | 'delete' | 'restore',\r\n  data: T | { systemId: SystemId },\r\n  systemId?: SystemId\r\n): Promise<boolean> {\r\n  try {\r\n    const endpoint = action === 'create' \r\n      ? apiEndpoint \r\n      : `${apiEndpoint}/${systemId || (data as any).systemId}`;\r\n    \r\n    const method = action === 'create' ? 'POST' \r\n      : action === 'update' ? 'PATCH' \r\n      : action === 'delete' ? 'DELETE'\r\n      : 'PATCH'; // restore uses PATCH\r\n    \r\n    const response = await fetch(endpoint, {\r\n      method,\r\n      headers: { 'Content-Type': 'application/json' },\r\n      credentials: 'include',\r\n      body: action !== 'delete' ? JSON.stringify(data) : undefined,\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      console.warn(`[Store Factory API] ${action} failed for ${apiEndpoint}:`, response.status);\r\n    }\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error(`[Store Factory API] ${action} error for ${apiEndpoint}:`, error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Item with SystemId (branded type)\r\nexport type ItemWithSystemId = { systemId: SystemId; [key: string]: any };\r\n\r\n// ✅ Counter state for ID generation\r\nexport type CounterState = {\r\n  systemId: number;\r\n  businessId: number;\r\n};\r\n\r\nexport type CrudState<T extends ItemWithSystemId> = {\r\n  data: T[];\r\n  _counters: CounterState; // ✅ Persisted counters\r\n  _initialized: boolean; // ✅ Track if loaded from API\r\n  add: (item: Omit<T, 'systemId'>) => T;\r\n  addMultiple: (items: Omit<T, 'systemId'>[]) => void;\r\n  update: (systemId: SystemId, item: Partial<T>) => void; // ✅ Accept partial updates\r\n  remove: (systemId: SystemId) => void; // ✅ Branded type\r\n  hardDelete: (systemId: SystemId) => void; // ✅ Branded type\r\n  restore: (systemId: SystemId) => void; // ✅ Branded type\r\n  findById: (systemId: SystemId | string) => T | undefined; // ✅ Branded type\r\n  getActive: () => T[];\r\n  getDeleted: () => T[];\r\n  loadFromAPI: () => Promise<void>; // ✅ Load data from database\r\n};\r\n\r\nexport const createCrudStore = <T extends ItemWithSystemId>(\r\n  _initialData: T[], // @deprecated - Kept for backward compatibility but NO LONGER USED\r\n  entityType: EntityType, // Changed from idPrefix to entityType\r\n  options?: {\r\n    businessIdField?: keyof T; // Field name for business ID (default: 'id')\r\n    persistKey?: string; // @deprecated - No longer used, kept for backward compatibility\r\n    getCurrentUser?: () => string | undefined; // Function to get current user systemId\r\n    apiEndpoint?: string; // ✅ API endpoint for database sync (e.g., '/api/employees')\r\n  }\r\n) => {\r\n  const businessPrefix = getPrefix(entityType); // Vietnamese prefix for Business ID (NV, KH, DH)\r\n  const config = ID_CONFIG[entityType];\r\n  const systemIdPrefix = config?.systemIdPrefix || entityType.toUpperCase(); // English prefix for SystemId (EMP, CUSTOMER, ORDER)\r\n  \r\n  const businessIdField = options?.businessIdField ?? 'id';\r\n  // const persistKey = options?.persistKey; // @deprecated - No longer used\r\n  const getCurrentUser = options?.getCurrentUser;\r\n  const apiEndpoint = options?.apiEndpoint;\r\n\r\n  // ✅ CHANGED: Start with empty array - database is source of truth\r\n  // Mock data files (data.ts) are NO LONGER USED for runtime\r\n  const normalizedInitialData: T[] = [];\r\n\r\n  const storeConfig = (set: any, get: any) => ({\r\n    data: normalizedInitialData, // ✅ Start empty - data loaded via React Query\r\n    // ✅ Counters start at 0 - will be initialized from API via loadFromAPI()\r\n    _counters: {\r\n      systemId: 0,\r\n      businessId: 0\r\n    },\r\n    _initialized: false, // ✅ Track API initialization\r\n    add: (item: Omit<T, 'systemId'>): T => {\r\n        // ✅ Get counters from state (persisted)\r\n        const currentCounters = get()._counters;\r\n        const newSystemIdCounter = currentCounters.systemId + 1;\r\n        const newSystemId = createSystemId(generateSystemId(entityType, newSystemIdCounter));\r\n        \r\n        // Generate or validate Business ID (if field exists)\r\n        let finalItem = { ...item } as any;\r\n        let newBusinessIdCounter = currentCounters.businessId;\r\n        \r\n        if (businessIdField in item) {\r\n          const customId = (item as any)[businessIdField];\r\n          const existingIds = get().data.map((d: any) => d[businessIdField]);\r\n          \r\n          // ✅ If customId provided, validate uniqueness\r\n          if (customId && customId.trim()) {\r\n            if (!isBusinessIdUnique(customId, existingIds)) {\r\n              throw new Error(`Mã \"${customId}\" đã tồn tại! Vui lòng sử dụng mã khác.`);\r\n            }\r\n            finalItem[businessIdField] = customId.trim().toUpperCase();\r\n          } else {\r\n            // ✅ Auto-generate with findNextAvailableBusinessId\r\n            const digitCount = 6; // All entities use 6 digits\r\n            const result = findNextAvailableBusinessId(businessPrefix, existingIds, newBusinessIdCounter, digitCount);\r\n            finalItem[businessIdField] = result.nextId;\r\n            newBusinessIdCounter = result.updatedCounter;\r\n          }\r\n        }\r\n        \r\n        const now = new Date().toISOString();\r\n        const currentUser = getCurrentUser?.();\r\n        const newItem = { \r\n          ...finalItem, \r\n          systemId: newSystemId, // ✅ Branded SystemId\r\n          createdAt: finalItem.createdAt || now,\r\n          updatedAt: now,\r\n          createdBy: finalItem.createdBy || currentUser,\r\n          updatedBy: currentUser,\r\n        } as unknown as T;\r\n        \r\n        // ✅ Update both data and counters atomically\r\n        set((state: any) => ({ \r\n          data: [...state.data, newItem],\r\n          _counters: {\r\n            systemId: newSystemIdCounter,\r\n            businessId: newBusinessIdCounter\r\n          }\r\n        }));\r\n        \r\n        // ✅ Sync to API in background\r\n        if (apiEndpoint) {\r\n          syncToAPI(apiEndpoint, 'create', newItem).catch(console.error);\r\n        }\r\n        \r\n        return newItem;\r\n    },\r\n    addMultiple: (items: Omit<T, 'systemId'>[]) => \r\n        set((state: any) => {\r\n            const now = new Date().toISOString();\r\n            const currentUser = getCurrentUser?.();\r\n            const newItems: T[] = [];\r\n            const digitCount = 6; // All entities use 6 digits\r\n            \r\n            // ✅ Start from current counters\r\n            let currentSystemIdCounter = state._counters.systemId;\r\n            let currentBusinessIdCounter = state._counters.businessId;\r\n            \r\n            items.forEach(item => {\r\n                // ✅ Generate SystemId from current counter\r\n                currentSystemIdCounter++;\r\n                const newSystemId = createSystemId(generateSystemId(entityType, currentSystemIdCounter));\r\n                \r\n                // Generate or validate Business ID (if field exists)\r\n                let finalItem = { ...item } as any;\r\n                if (businessIdField in item) {\r\n                  const customId = (item as any)[businessIdField];\r\n                  \r\n                  // Collect existing IDs (from state + already added in this batch)\r\n                  const existingIds = [\r\n                    ...state.data.map((d: any) => d[businessIdField]),\r\n                    ...newItems.map((d: any) => d[businessIdField])\r\n                  ];\r\n                  \r\n                  // ✅ If customId provided, validate uniqueness\r\n                  if (customId && customId.trim()) {\r\n                    if (!isBusinessIdUnique(customId, existingIds)) {\r\n                      throw new Error(`Mã \"${customId}\" đã tồn tại! Vui lòng sử dụng mã khác.`);\r\n                    }\r\n                    finalItem[businessIdField] = customId.trim().toUpperCase();\r\n                  } else {\r\n                    // ✅ Auto-generate with findNextAvailableBusinessId\r\n                    const result = findNextAvailableBusinessId(businessPrefix, existingIds, currentBusinessIdCounter, digitCount);\r\n                    finalItem[businessIdField] = result.nextId;\r\n                    currentBusinessIdCounter = result.updatedCounter;\r\n                  }\r\n                }\r\n                \r\n                newItems.push({ \r\n                  ...finalItem, \r\n                  systemId: newSystemId,\r\n                  createdAt: now,\r\n                  updatedAt: now,\r\n                  createdBy: currentUser,\r\n                  updatedBy: currentUser,\r\n                } as unknown as T);\r\n            });\r\n            \r\n            // ✅ Update both data and counters\r\n            const result = { \r\n              data: [...state.data, ...newItems],\r\n              _counters: {\r\n                systemId: currentSystemIdCounter,\r\n                businessId: currentBusinessIdCounter\r\n              }\r\n            };\r\n            \r\n            // ✅ Sync to API in background (batch)\r\n            if (apiEndpoint) {\r\n              newItems.forEach(item => {\r\n                syncToAPI(apiEndpoint, 'create', item).catch(console.error);\r\n              });\r\n            }\r\n            \r\n            return result;\r\n        }),\r\n    update: (systemId: SystemId, updatedItem: Partial<T>) => {\r\n      // Validate unique business ID (case-insensitive, skip self)\r\n      if (businessIdField in updatedItem) {\r\n        const businessId = (updatedItem as any)[businessIdField];\r\n        const existingIds = get().data\r\n          .filter((d: any) => d.systemId !== systemId)\r\n          .map((d: any) => d[businessIdField]);\r\n        \r\n        if (businessId && !isBusinessIdUnique(businessId, existingIds)) {\r\n          throw new Error(`Mã \"${businessId}\" đã tồn tại! Vui lòng sử dụng mã khác.`);\r\n        }\r\n      }\r\n\r\n      const now = new Date().toISOString();\r\n      const currentUser = getCurrentUser?.();\r\n      set((state: any) => ({\r\n        data: state.data.map((item: T) =>\r\n          item.systemId === systemId \r\n            ? { ...item, ...updatedItem, updatedAt: now, updatedBy: currentUser } as T\r\n            : item\r\n        ),\r\n      }));\r\n      \r\n      // ✅ Sync to API in background\r\n      if (apiEndpoint) {\r\n        const fullItem = get().data.find((item: T) => item.systemId === systemId);\r\n        if (fullItem) {\r\n          syncToAPI(apiEndpoint, 'update', fullItem, systemId).catch(console.error);\r\n        }\r\n      }\r\n    },\r\n    remove: (systemId: SystemId) => {\r\n      // Soft delete - mark as deleted\r\n      const now = new Date().toISOString();\r\n      set((state: any) => ({\r\n        data: state.data.map((item: T) =>\r\n          item.systemId === systemId\r\n            ? { ...item, isDeleted: true, deletedAt: now } as T\r\n            : item\r\n        ),\r\n      }));\r\n      \r\n      // ✅ Sync to API in background\r\n      if (apiEndpoint) {\r\n        const item = get().data.find((item: T) => item.systemId === systemId);\r\n        if (item) {\r\n          syncToAPI(apiEndpoint, 'update', { ...item, isDeleted: true, deletedAt: now }, systemId).catch(console.error);\r\n        }\r\n      }\r\n    },\r\n    hardDelete: (systemId: SystemId) => {\r\n      // Permanent delete - remove from array\r\n      set((state: any) => ({\r\n        data: state.data.filter((item: T) => item.systemId !== systemId),\r\n      }));\r\n      \r\n      // ✅ Sync to API in background\r\n      if (apiEndpoint) {\r\n        syncToAPI(apiEndpoint, 'delete', { systemId }, systemId).catch(console.error);\r\n      }\r\n    },\r\n    restore: (systemId: SystemId) => {\r\n      // Restore soft-deleted item\r\n      set((state: any) => ({\r\n        data: state.data.map((item: T) =>\r\n          item.systemId === systemId\r\n            ? { ...item, isDeleted: false, deletedAt: null } as T\r\n            : item\r\n        ),\r\n      }));\r\n      \r\n      // ✅ Sync to API in background\r\n      if (apiEndpoint) {\r\n        const item = get().data.find((item: T) => item.systemId === systemId);\r\n        if (item) {\r\n          syncToAPI(apiEndpoint, 'restore', { ...item, isDeleted: false, deletedAt: null }, systemId).catch(console.error);\r\n        }\r\n      }\r\n    },\r\n    getActive: () => get().data.filter((item: any) => !item.isDeleted),\r\n    getDeleted: () => get().data.filter((item: any) => item.isDeleted),\r\n    findById: (id: SystemId | string) => get().data.find((item: T) => item.systemId === id || (item as any).id === id),\r\n    \r\n    // ✅ Load data from database API - OPTIMIZED: No more limit=10000!\r\n    // This is now only used for counter initialization, NOT for loading all data\r\n    // Use React Query hooks for data fetching with proper pagination\r\n    loadFromAPI: async () => {\r\n      if (!apiEndpoint) return;\r\n      if (get()._initialized) return;\r\n      \r\n      try {\r\n        // Only fetch minimal data needed to initialize counters\r\n        // Actual data loading should be done via React Query hooks\r\n        const response = await fetch(`${apiEndpoint}?limit=1&sortBy=systemId&sortOrder=desc`, {\r\n          credentials: 'include',\r\n        });\r\n        if (response.ok) {\r\n          const json = await response.json();\r\n          const pagination = json.pagination || {};\r\n          const lastItem = json.data?.[0];\r\n          \r\n          // Initialize counters from the latest item (highest IDs)\r\n          const newCounters = {\r\n            systemId: lastItem ? getMaxSystemIdCounter([lastItem], systemIdPrefix) : 0,\r\n            businessId: (lastItem && options?.businessIdField)\r\n              ? getMaxBusinessIdCounter([lastItem] as any[], businessPrefix)\r\n              : 0\r\n          };\r\n          \r\n          set({ \r\n            data: [], // Don't store data in Zustand anymore - use React Query\r\n            _counters: newCounters,\r\n            _initialized: true \r\n          });\r\n          \r\n          console.log(`[Store Factory] ${apiEndpoint} initialized. Total records: ${pagination.total || 'unknown'}`);\r\n        }\r\n      } catch (error) {\r\n        console.error(`[Store Factory] loadFromAPI error for ${apiEndpoint}:`, error);\r\n        // Still mark as initialized to prevent infinite retry\r\n        set({ _initialized: true });\r\n      }\r\n    },\r\n  });\r\n\r\n  // ✅ SIMPLIFIED: No localStorage persistence, database is source of truth\r\n  // Data is loaded via ApiSyncProvider on app init\r\n  return create<CrudState<T>>(storeConfig);\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1272, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/id-types.ts"],"sourcesContent":["/**\r\n * Type-safe ID System\r\n * \r\n * Prevents mixing systemId with business ID at compile time\r\n */\r\n\r\n// Branded types for type safety\r\nexport type SystemId = string & { readonly __brand: 'SystemId' };\r\nexport type BusinessId = string & { readonly __brand: 'BusinessId' };\r\n\r\n/**\r\n * Create a SystemId from a string\r\n * Use this when you know for sure it's a systemId\r\n */\r\nexport function asSystemId(id: string): SystemId {\r\n  return id as SystemId;\r\n}\r\n\r\n/**\r\n * Create a BusinessId from a string\r\n * Use this when you know for sure it's a business ID\r\n */\r\nexport function asBusinessId(id: string): BusinessId {\r\n  return id as BusinessId;\r\n}\r\n\r\n/**\r\n * Check if a string is a valid systemId format\r\n */\r\nexport function isSystemIdFormat(id: string): boolean {\r\n  // SystemId: 8 digits + prefix (e.g., NV00000001, VOUCHER00000123)\r\n  return /^[A-Z]+\\d{8}$/.test(id);\r\n}\r\n\r\n/**\r\n * Check if a string is a valid business ID format\r\n */\r\nexport function isBusinessIdFormat(id: string): boolean {\r\n  // Business ID: shorter, variable length (e.g., NV001, PT000001)\r\n  return /^[A-Z]+\\d{3,6}$/.test(id);\r\n}\r\n\r\n/**\r\n * Safely convert unknown ID to proper type\r\n */\r\nexport function parseId(id: string): { type: 'system' | 'business'; value: SystemId | BusinessId } {\r\n  if (isSystemIdFormat(id)) {\r\n    return { type: 'system', value: asSystemId(id) };\r\n  }\r\n  if (isBusinessIdFormat(id)) {\r\n    return { type: 'business', value: asBusinessId(id) };\r\n  }\r\n  throw new Error(`Invalid ID format: ${id}`);\r\n}\r\n\r\n/**\r\n * ID Pair - Always keep systemId and businessId together\r\n */\r\nexport interface IDPair {\r\n  systemId: SystemId;\r\n  businessId: BusinessId;\r\n}\r\n\r\n/**\r\n * Entity with dual IDs\r\n */\r\nexport interface DualIDEntity {\r\n  systemId: SystemId;\r\n  id: BusinessId;\r\n}\r\n\r\n/**\r\n * Store methods with type-safe IDs\r\n */\r\nexport interface TypeSafeStore<T extends DualIDEntity> {\r\n  /** Find by systemId (for queries, relationships) */\r\n  findBySystemId(systemId: SystemId): T | null;\r\n  \r\n  /** Find by business ID (for user input, display) */\r\n  findByBusinessId(businessId: BusinessId): T | null;\r\n  \r\n  /** Update by systemId (always use systemId for updates) */\r\n  updateBySystemId(systemId: SystemId, updates: Partial<T>): void;\r\n  \r\n  /** Delete by systemId (always use systemId for deletes) */\r\n  deleteBySystemId(systemId: SystemId): void;\r\n}\r\n\r\n/**\r\n * Route params with type-safe IDs\r\n */\r\nexport interface RouteParams {\r\n  systemId?: SystemId;\r\n  id?: BusinessId;\r\n}\r\n\r\n/**\r\n * Link builder - always uses systemId\r\n */\r\nexport function buildEntityLink(path: string, entity: DualIDEntity): string {\r\n  return path.replace(':systemId', entity.systemId);\r\n}\r\n\r\n/**\r\n * Display ID - always uses business ID\r\n */\r\nexport function getDisplayId(entity: DualIDEntity): string {\r\n  return entity.id;\r\n}\r\n\r\n/**\r\n * Runtime guard: ensures a string is valid SystemId format and casts it\r\n * Logs warning if format is invalid\r\n */\r\nexport function ensureSystemId(id: string, context?: string): SystemId {\r\n  if (!isSystemIdFormat(id)) {\r\n    console.warn(`[ensureSystemId] Invalid SystemId format: \"${id}\"${context ? ` in ${context}` : ''}`);\r\n  }\r\n  return asSystemId(id);\r\n}\r\n\r\n/**\r\n * Runtime guard: ensures a string is valid BusinessId format and casts it\r\n * Logs warning if format is invalid\r\n */\r\nexport function ensureBusinessId(id: string, context?: string): BusinessId {\r\n  if (!isBusinessIdFormat(id)) {\r\n    console.warn(`[ensureBusinessId] Invalid BusinessId format: \"${id}\"${context ? ` in ${context}` : ''}`);\r\n  }\r\n  return asBusinessId(id);\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;CAIC,GAED,gCAAgC;;;;;;;;;;;;;;;;;;;;;AAQzB,SAAS,WAAW,EAAU;IACnC,OAAO;AACT;AAMO,SAAS,aAAa,EAAU;IACrC,OAAO;AACT;AAKO,SAAS,iBAAiB,EAAU;IACzC,kEAAkE;IAClE,OAAO,gBAAgB,IAAI,CAAC;AAC9B;AAKO,SAAS,mBAAmB,EAAU;IAC3C,gEAAgE;IAChE,OAAO,kBAAkB,IAAI,CAAC;AAChC;AAKO,SAAS,QAAQ,EAAU;IAChC,IAAI,iBAAiB,KAAK;QACxB,OAAO;YAAE,MAAM;YAAU,OAAO,WAAW;QAAI;IACjD;IACA,IAAI,mBAAmB,KAAK;QAC1B,OAAO;YAAE,MAAM;YAAY,OAAO,aAAa;QAAI;IACrD;IACA,MAAM,IAAI,MAAM,CAAC,mBAAmB,EAAE,IAAI;AAC5C;AA8CO,SAAS,gBAAgB,IAAY,EAAE,MAAoB;IAChE,OAAO,KAAK,OAAO,CAAC,aAAa,OAAO,QAAQ;AAClD;AAKO,SAAS,aAAa,MAAoB;IAC/C,OAAO,OAAO,EAAE;AAClB;AAMO,SAAS,eAAe,EAAU,EAAE,OAAgB;IACzD,IAAI,CAAC,iBAAiB,KAAK;QACzB,QAAQ,IAAI,CAAC,CAAC,2CAA2C,EAAE,GAAG,CAAC,EAAE,UAAU,CAAC,IAAI,EAAE,SAAS,GAAG,IAAI;IACpG;IACA,OAAO,WAAW;AACpB;AAMO,SAAS,iBAAiB,EAAU,EAAE,OAAgB;IAC3D,IAAI,CAAC,mBAAmB,KAAK;QAC3B,QAAQ,IAAI,CAAC,CAAC,+CAA+C,EAAE,GAAG,CAAC,EAAE,UAAU,CAAC,IAAI,EAAE,SAAS,GAAG,IAAI;IACxG;IACA,OAAO,aAAa;AACtB"}},
    {"offset": {"line": 1351, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/activity-history-helper.ts"],"sourcesContent":["/**\r\n * Activity History Helper\r\n * \r\n * Helper để tạo các entry lịch sử hoạt động một cách nhất quán\r\n * Dùng chung cho tất cả các modules trong hệ thống\r\n * \r\n * NOTE: Đã remove import useEmployeeStore để tránh circular dependency\r\n * và cải thiện compile time\r\n */\r\n\r\nimport type { HistoryEntry } from '../components/ActivityHistory';\r\nimport { getCurrentUserInfo as getAuthUserInfo } from '../contexts/auth-context';\r\nimport type { SystemId } from './id-types';\r\n\r\n// Re-export HistoryEntry type for convenience\r\nexport type { HistoryEntry } from '../components/ActivityHistory';\r\n\r\n/**\r\n * Lấy thông tin người dùng hiện tại từ auth context\r\n * NOTE: Avatar lookup từ employee store đã bị remove để tránh circular dependency\r\n */\r\nexport function getCurrentUserInfo(): { systemId: string; name: string; avatar?: string } {\r\n  const authInfo = getAuthUserInfo();\r\n  \r\n  return {\r\n    systemId: authInfo.systemId || 'SYSTEM',\r\n    name: authInfo.name || 'Hệ thống',\r\n    avatar: undefined, // Avatar will be fetched by component if needed\r\n  };\r\n}\r\n\r\n/**\r\n * Lấy thông tin nhân viên từ systemId\r\n * NOTE: This function now requires employee data to be passed in\r\n * to avoid circular dependency with employee store\r\n */\r\nexport function getEmployeeInfoFromData(\r\n  employeeSystemId: SystemId | string,\r\n  employees: Array<{ systemId: string; fullName: string; avatarUrl?: string }>\r\n): { systemId: string; name: string; avatar?: string } {\r\n  const employee = employees.find(e => e.systemId === employeeSystemId);\r\n  \r\n  if (employee) {\r\n    return {\r\n      systemId: employee.systemId,\r\n      name: employee.fullName,\r\n      avatar: employee.avatarUrl,\r\n    };\r\n  }\r\n  \r\n  // Fallback to system\r\n  return {\r\n    systemId: String(employeeSystemId) || 'SYSTEM',\r\n    name: 'Hệ thống',\r\n  };\r\n}\r\n\r\n/**\r\n * @deprecated Use getEmployeeInfoFromData instead\r\n */\r\nexport function getEmployeeInfo(employeeSystemId: SystemId | string): { systemId: string; name: string; avatar?: string } {\r\n  // Return minimal info without employee store lookup\r\n  return {\r\n    systemId: String(employeeSystemId) || 'SYSTEM',\r\n    name: 'Hệ thống',\r\n  };\r\n}\r\n\r\n/**\r\n * Tạo một history entry mới\r\n */\r\nexport function createHistoryEntry(\r\n  action: HistoryEntry['action'],\r\n  userOrDescription: { systemId: string; name: string; avatar?: string } | string,\r\n  descriptionOrMetadata?: string | HistoryEntry['metadata'],\r\n  metadata?: HistoryEntry['metadata']\r\n): HistoryEntry {\r\n  const hasUserObject = typeof userOrDescription === 'object' && userOrDescription !== null;\r\n  const user = hasUserObject ? userOrDescription : getCurrentUserInfo();\r\n  const description = (hasUserObject ? descriptionOrMetadata : userOrDescription) as string | undefined;\r\n  const meta = (hasUserObject ? metadata : descriptionOrMetadata) as HistoryEntry['metadata'] | undefined;\r\n\r\n  return {\r\n    id: `history-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n    action,\r\n    timestamp: new Date(),\r\n    user: {\r\n      systemId: user.systemId,\r\n      name: user.name,\r\n      avatar: user.avatar,\r\n    },\r\n    description: description ?? '',\r\n    metadata: meta,\r\n  };\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"created\"\r\n */\r\nexport function createCreatedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('created', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"updated\"\r\n */\r\nexport function createUpdatedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('updated', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"status_changed\"\r\n */\r\nexport function createStatusChangedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  oldStatus: string,\r\n  newStatus: string,\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry(\r\n    'status_changed',\r\n    user,\r\n    description,\r\n    { field: 'status', oldValue: oldStatus, newValue: newStatus }\r\n  );\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"deleted\"\r\n */\r\nexport function createDeletedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('deleted', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"assigned\"\r\n */\r\nexport function createAssignedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('assigned', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"payment_made\"\r\n */\r\nexport function createPaymentEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('payment_made', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"comment_added\"\r\n */\r\nexport function createCommentEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('comment_added', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"cancelled\"\r\n */\r\nexport function createCancelledEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('cancelled', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"verified\"\r\n */\r\nexport function createVerifiedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('verified', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"ended\"\r\n */\r\nexport function createEndedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('ended', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"reopened\"\r\n */\r\nexport function createReopenedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('reopened', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho product actions\r\n */\r\nexport function createProductEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  action: 'product_added' | 'product_updated' | 'product_removed',\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry(action, user, description);\r\n}\r\n\r\n/**\r\n * Helper để append history entry vào existing array\r\n */\r\nexport function appendHistoryEntry(\r\n  existingHistory: HistoryEntry[] | undefined,\r\n  ...newEntries: HistoryEntry[]\r\n): HistoryEntry[] {\r\n  return [...(existingHistory || []), ...newEntries];\r\n}\r\n\r\n/**\r\n * Helper để tạo nhiều history entries cùng lúc\r\n */\r\nexport function createBulkUpdateEntries(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  changes: Array<{ field: string; description: string }>\r\n): HistoryEntry[] {\r\n  return changes.map(change => createHistoryEntry('updated', user, change.description));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1503, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/store.ts"],"sourcesContent":["import { createCrudStore, CrudState } from '../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { Product } from './types';\r\nimport { type SystemId } from '@/lib/id-types';\r\nimport { asSystemId, asBusinessId } from '../../lib/id-types';\r\nimport { getCurrentUserSystemId } from '../../contexts/auth-context';\r\nimport Fuse from 'fuse.js';\r\nimport {\r\n  getCurrentUserInfo,\r\n  createCreatedEntry,\r\n  createUpdatedEntry,\r\n  createStatusChangedEntry,\r\n  appendHistoryEntry,\r\n  type HistoryEntry\r\n} from '../../lib/activity-history-helper';\r\n\r\nconst baseStore = createCrudStore<Product>([], 'products', {\r\n  businessIdField: 'id',\r\n  getCurrentUser: getCurrentUserSystemId, // ✅ Track who creates/updates\r\n  apiEndpoint: '/api/products',\r\n});\r\n\r\n// ✅ API Sync helpers\r\nconst API_ENDPOINT = '/api/products';\r\n\r\nconst syncToApi = {\r\n  create: async (product: Product) => {\r\n    try {\r\n      const response = await fetch(API_ENDPOINT, {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(product),\r\n      });\r\n      if (!response.ok) console.warn('[Product API] Create sync failed');\r\n      else console.log('[Product API] Created:', product.systemId);\r\n    } catch (e) {\r\n      console.warn('[Product API] Create sync error:', e);\r\n    }\r\n  },\r\n  update: async (systemId: SystemId, updates: Partial<Product>) => {\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}`, {\r\n        method: 'PATCH',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(updates),\r\n      });\r\n      if (!response.ok) console.warn('[Product API] Update sync failed');\r\n      else console.log('[Product API] Updated:', systemId);\r\n    } catch (e) {\r\n      console.warn('[Product API] Update sync error:', e);\r\n    }\r\n  },\r\n  delete: async (systemId: SystemId, hard = false) => {\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ hard }),\r\n      });\r\n      if (!response.ok) console.warn('[Product API] Delete sync failed');\r\n      else console.log('[Product API] Deleted:', systemId);\r\n    } catch (e) {\r\n      console.warn('[Product API] Delete sync error:', e);\r\n    }\r\n  },\r\n  restore: async (systemId: SystemId) => {\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}/restore`, {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n      });\r\n      if (!response.ok) console.warn('[Product API] Restore sync failed');\r\n      else console.log('[Product API] Restored:', systemId);\r\n    } catch (e) {\r\n      console.warn('[Product API] Restore sync error:', e);\r\n    }\r\n  },\r\n};\r\n\r\n// ✅ Wrap base store methods with API sync\r\nconst originalAdd = baseStore.getState().add;\r\nconst originalUpdate = baseStore.getState().update;\r\nconst originalRemove = baseStore.getState().remove;\r\nconst originalHardDelete = baseStore.getState().hardDelete;\r\nconst originalRestore = baseStore.getState().restore;\r\n\r\nbaseStore.setState({\r\n  add: (item: Omit<Product, 'systemId'>) => {\r\n    const result = originalAdd(item);\r\n    syncToApi.create(result);\r\n    return result;\r\n  },\r\n  update: (systemId: SystemId, updates: Partial<Product>) => {\r\n    originalUpdate(systemId, updates);\r\n    syncToApi.update(systemId, updates);\r\n  },\r\n  remove: (systemId: SystemId) => {\r\n    originalRemove(systemId);\r\n    syncToApi.delete(systemId, false);\r\n  },\r\n  hardDelete: (systemId: SystemId) => {\r\n    originalHardDelete(systemId);\r\n    syncToApi.delete(systemId, true);\r\n  },\r\n  restore: (systemId: SystemId) => {\r\n    originalRestore(systemId);\r\n    syncToApi.restore(systemId);\r\n  },\r\n});\r\n\r\n// Define extended store interface\r\nexport interface ProductStoreState extends CrudState<Product> {\r\n  updateInventory: (productSystemId: SystemId, branchSystemId: SystemId, quantityChange: number) => void;\r\n  commitStock: (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => void;\r\n  uncommitStock: (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => void;\r\n  dispatchStock: (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => void;\r\n  completeDelivery: (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => void;\r\n  returnStockFromTransit: (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => void;\r\n  updateLastPurchasePrice: (productSystemId: SystemId, price: number, date: string) => void;\r\n  searchProducts: (query: string, page: number, limit?: number) => Promise<{ items: { value: SystemId; label: string }[], hasNextPage: boolean }>;\r\n}\r\n\r\n// Helper to check if product tracks stock\r\nconst canModifyStock = (product: Product | undefined): boolean => {\r\n  if (!product) return false;\r\n  // Services, digital products, and combos don't track stock directly\r\n  if (product.type === 'service' || product.type === 'digital' || product.type === 'combo') return false;\r\n  // Explicitly disabled stock tracking\r\n  if (product.isStockTracked === false) return false;\r\n  return true;\r\n};\r\n\r\n// Define custom methods\r\nconst updateInventory = (productSystemId: SystemId, branchSystemId: SystemId, quantityChange: number) => {\r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!product) return state;\r\n    \r\n    // Skip if product doesn't track stock\r\n    if (!canModifyStock(product)) {\r\n      console.warn(`[updateInventory] Skipped: Product ${productSystemId} does not track stock`);\r\n      return state;\r\n    }\r\n    \r\n    const oldQuantity = product.inventoryByBranch?.[branchSystemId] || 0;\r\n    const newQuantity = oldQuantity + quantityChange;\r\n    \r\n    // ✅ Removed COMPLAINT_ADJUSTMENT stock history creation\r\n    // Stock history will be created by inventory check balance instead\r\n    \r\n    return {\r\n      data: state.data.map(p => {\r\n        if (p.systemId === productSystemId) {\r\n          const newInventoryByBranch = { ...p.inventoryByBranch };\r\n          newInventoryByBranch[branchSystemId] = newQuantity;\r\n          return {\r\n            ...p,\r\n            inventoryByBranch: newInventoryByBranch,\r\n          };\r\n        }\r\n        return p;\r\n      }),\r\n    };\r\n  });\r\n};\r\n\r\nconst commitStock = (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => {\r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!canModifyStock(product)) {\r\n      console.warn(`[commitStock] Skipped: Product ${productSystemId} does not track stock`);\r\n      return state;\r\n    }\r\n    return {\r\n      data: state.data.map(p => {\r\n        if (p.systemId === productSystemId) {\r\n          const newCommitted = { ...p.committedByBranch };\r\n          newCommitted[branchSystemId] = (newCommitted[branchSystemId] || 0) + quantity;\r\n          return { ...p, committedByBranch: newCommitted };\r\n        }\r\n        return p;\r\n      }),\r\n    };\r\n  });\r\n};\r\n\r\nconst uncommitStock = (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => {\r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!canModifyStock(product)) {\r\n      console.warn(`[uncommitStock] Skipped: Product ${productSystemId} does not track stock`);\r\n      return state;\r\n    }\r\n    return {\r\n      data: state.data.map(p => {\r\n        if (p.systemId === productSystemId) {\r\n          const newCommitted = { ...p.committedByBranch };\r\n          newCommitted[branchSystemId] = Math.max(0, (newCommitted[branchSystemId] || 0) - quantity);\r\n          return { ...p, committedByBranch: newCommitted };\r\n        }\r\n        return p;\r\n      }),\r\n    };\r\n  });\r\n};\r\n\r\nconst dispatchStock = (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => {\r\n  console.log('🔴 [dispatchStock] Called with:', { productSystemId, branchSystemId, quantity });\r\n  \r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!product) {\r\n      console.error('❌ [dispatchStock] Product not found:', productSystemId);\r\n      return state;\r\n    }\r\n    \r\n    // Skip if product doesn't track stock\r\n    if (!canModifyStock(product)) {\r\n      console.warn(`[dispatchStock] Skipped: Product ${productSystemId} does not track stock`);\r\n      return state;\r\n    }\r\n    \r\n    console.log('📦 [dispatchStock] Current inventory:', product.inventoryByBranch);\r\n    console.log('📦 [dispatchStock] Current committed:', product.committedByBranch);\r\n    \r\n    return {\r\n      data: state.data.map(product => {\r\n        if (product.systemId === productSystemId) {\r\n          const newInventory = { ...product.inventoryByBranch };\r\n          const oldInventory = newInventory[branchSystemId] || 0;\r\n          newInventory[branchSystemId] = oldInventory - quantity;\r\n          \r\n          const newCommitted = { ...product.committedByBranch };\r\n          newCommitted[branchSystemId] = Math.max(0, (newCommitted[branchSystemId] || 0) - quantity);\r\n\r\n          const newInTransit = { ...product.inTransitByBranch };\r\n          newInTransit[branchSystemId] = (newInTransit[branchSystemId] || 0) + quantity;\r\n          \r\n          console.log('✅ [dispatchStock] Updated inventory:', {\r\n            old: oldInventory,\r\n            new: newInventory[branchSystemId],\r\n            change: -quantity\r\n          });\r\n          \r\n          return { \r\n            ...product, \r\n            inventoryByBranch: newInventory,\r\n            committedByBranch: newCommitted,\r\n            inTransitByBranch: newInTransit,\r\n          };\r\n        }\r\n        return product;\r\n      }),\r\n    };\r\n  });\r\n  \r\n  console.log('✅ [dispatchStock] Completed');\r\n};\r\n\r\nconst completeDelivery = (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => {\r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!canModifyStock(product)) {\r\n      return state;\r\n    }\r\n    return {\r\n      data: state.data.map(p => {\r\n        if (p.systemId === productSystemId) {\r\n          const newInTransit = { ...p.inTransitByBranch };\r\n          newInTransit[branchSystemId] = Math.max(0, (newInTransit[branchSystemId] || 0) - quantity);\r\n          return { ...p, inTransitByBranch: newInTransit };\r\n        }\r\n        return p;\r\n      }),\r\n    };\r\n  });\r\n};\r\n\r\nconst returnStockFromTransit = (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => {\r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!canModifyStock(product)) {\r\n      return state;\r\n    }\r\n    return {\r\n      data: state.data.map(p => {\r\n        if (p.systemId === productSystemId) {\r\n          const newInTransit = { ...p.inTransitByBranch };\r\n          newInTransit[branchSystemId] = Math.max(0, (newInTransit[branchSystemId] || 0) - quantity);\r\n          const newInventory = { ...p.inventoryByBranch };\r\n          newInventory[branchSystemId] = (newInventory[branchSystemId] || 0) + quantity;\r\n          return { ...p, inventoryByBranch: newInventory, inTransitByBranch: newInTransit };\r\n        }\r\n        return p;\r\n      }),\r\n    };\r\n  });\r\n};\r\n\r\nconst updateLastPurchasePrice = (productSystemId: SystemId, price: number, date: string) => {\r\n  baseStore.setState(state => ({\r\n    data: state.data.map(product => {\r\n      if (product.systemId === productSystemId) {\r\n        // Only update if the new date is newer or equal to the existing lastPurchaseDate\r\n        const existingDate = product.lastPurchaseDate ? new Date(product.lastPurchaseDate).getTime() : 0;\r\n        const newDateTs = new Date(date).getTime();\r\n        \r\n        if (newDateTs >= existingDate) {\r\n          return {\r\n            ...product,\r\n            lastPurchasePrice: price,\r\n            lastPurchaseDate: date,\r\n          };\r\n        }\r\n      }\r\n      return product;\r\n    }),\r\n  }));\r\n};\r\n\r\nconst searchProducts = async (query: string, page: number = 1, limit: number = 10): Promise<{ items: { value: SystemId; label: string }[], hasNextPage: boolean }> => {\r\n  const allProducts = baseStore.getState().data;\r\n  \r\n  // ✅ Create fresh Fuse instance with current data (avoid stale data)\r\n  const fuse = new Fuse(allProducts, {\r\n    keys: ['name', 'id', 'sku', 'barcode'],\r\n    threshold: 0.3,\r\n  });\r\n  \r\n  const results = fuse.search(query);\r\n  const startIndex = (page - 1) * limit;\r\n  const endIndex = startIndex + limit;\r\n  const paginatedResults = results.slice(startIndex, endIndex);\r\n\r\n  return {\r\n    items: paginatedResults.map(result => ({\r\n      value: asSystemId(result.item.systemId),\r\n      label: `${result.item.name} (${result.item.id})`,\r\n    })),\r\n    hasNextPage: endIndex < results.length,\r\n  };\r\n};\r\n\r\n// Wrapped add method with activity history logging\r\nconst addProduct = (product: Omit<Product, 'systemId'>) => {\r\n  const userInfo = getCurrentUserInfo();\r\n  const newProduct = baseStore.getState().add(product);\r\n  \r\n  // Add activity history entry\r\n  const historyEntry = createCreatedEntry(\r\n    userInfo,\r\n    `${userInfo.name} đã tạo sản phẩm ${newProduct.name} (${newProduct.id})`\r\n  );\r\n  baseStore.getState().update(newProduct.systemId, {\r\n    ...newProduct,\r\n    activityHistory: [historyEntry]\r\n  });\r\n  \r\n  return newProduct;\r\n};\r\n\r\n// Wrapped update method with activity history logging\r\nconst updateProduct = (systemId: SystemId, updatedProduct: Product) => {\r\n  const userInfo = getCurrentUserInfo();\r\n  const existingProduct = baseStore.getState().data.find(p => p.systemId === systemId);\r\n  const historyEntries: HistoryEntry[] = [];\r\n  \r\n  if (existingProduct) {\r\n    // Track status changes\r\n    if (existingProduct.status !== updatedProduct.status) {\r\n      const statusLabels: Record<string, string> = {\r\n        'active': 'Đang kinh doanh',\r\n        'inactive': 'Ngừng kinh doanh',\r\n        'discontinued': 'Ngừng sản xuất'\r\n      };\r\n      historyEntries.push(createStatusChangedEntry(\r\n        userInfo,\r\n        statusLabels[existingProduct.status || 'active'],\r\n        statusLabels[updatedProduct.status || 'active'],\r\n        `${userInfo.name} đã đổi trạng thái từ \"${statusLabels[existingProduct.status || 'active']}\" sang \"${statusLabels[updatedProduct.status || 'active']}\"`\r\n      ));\r\n    }\r\n    \r\n    // Track field changes\r\n    const fieldsToTrack: Array<{ key: keyof Product; label: string }> = [\r\n      { key: 'name', label: 'Tên sản phẩm' },\r\n      { key: 'id', label: 'Mã SKU' },\r\n      { key: 'description', label: 'Mô tả' },\r\n      { key: 'shortDescription', label: 'Mô tả ngắn' },\r\n      { key: 'type', label: 'Loại sản phẩm' },\r\n      { key: 'categorySystemId', label: 'Danh mục' },\r\n      { key: 'brandSystemId', label: 'Thương hiệu' },\r\n      { key: 'unit', label: 'Đơn vị tính' },\r\n      { key: 'costPrice', label: 'Giá vốn' },\r\n      { key: 'minPrice', label: 'Giá tối thiểu' },\r\n      { key: 'barcode', label: 'Mã vạch' },\r\n      { key: 'primarySupplierSystemId', label: 'Nhà cung cấp chính' },\r\n      { key: 'warrantyPeriodMonths', label: 'Thời hạn bảo hành' },\r\n      { key: 'reorderLevel', label: 'Mức đặt hàng lại' },\r\n      { key: 'safetyStock', label: 'Tồn kho an toàn' },\r\n      { key: 'maxStock', label: 'Tồn kho tối đa' },\r\n    ];\r\n    \r\n    const changes: string[] = [];\r\n    for (const field of fieldsToTrack) {\r\n      const oldVal = existingProduct[field.key];\r\n      const newVal = updatedProduct[field.key];\r\n      if (oldVal !== newVal && !(oldVal === undefined && newVal === undefined)) {\r\n        if (field.key === 'status') continue;\r\n        const oldDisplay = oldVal !== undefined && oldVal !== null && oldVal !== '' ? String(oldVal) : '(trống)';\r\n        const newDisplay = newVal !== undefined && newVal !== null && newVal !== '' ? String(newVal) : '(trống)';\r\n        changes.push(`${field.label}: ${oldDisplay} → ${newDisplay}`);\r\n      }\r\n    }\r\n    \r\n    // Track price changes separately\r\n    if (existingProduct.costPrice !== updatedProduct.costPrice) {\r\n      changes.push(`Giá vốn: ${existingProduct.costPrice?.toLocaleString('vi-VN')} → ${updatedProduct.costPrice?.toLocaleString('vi-VN')}`);\r\n    }\r\n    \r\n    if (changes.length > 0) {\r\n      historyEntries.push(createUpdatedEntry(\r\n        userInfo,\r\n        `${userInfo.name} đã cập nhật: ${changes.join(', ')}`\r\n      ));\r\n    }\r\n  }\r\n  \r\n  const productWithHistory = {\r\n    ...updatedProduct,\r\n    activityHistory: appendHistoryEntry(existingProduct?.activityHistory, ...historyEntries)\r\n  };\r\n  \r\n  baseStore.getState().update(systemId, productWithHistory);\r\n};\r\n\r\n// Export typed hook that includes both base and custom methods\r\nexport const useProductStore = (): ProductStoreState => {\r\n  const state = baseStore();\r\n  return {\r\n    ...state,\r\n    add: addProduct,\r\n    update: updateProduct,\r\n    updateInventory,\r\n    commitStock,\r\n    uncommitStock,\r\n    dispatchStock,\r\n    completeDelivery,\r\n    returnStockFromTransit,\r\n    updateLastPurchasePrice,\r\n    searchProducts,\r\n  };\r\n};\r\n\r\n// Export getState method for non-hook usage\r\nuseProductStore.getState = () => {\r\n  const state = baseStore.getState();\r\n  return {\r\n    ...state,\r\n    add: addProduct,\r\n    update: updateProduct,\r\n    updateInventory,\r\n    commitStock,\r\n    uncommitStock,\r\n    dispatchStock,\r\n    completeDelivery,\r\n    returnStockFromTransit,\r\n    updateLastPurchasePrice,\r\n    searchProducts,\r\n  };\r\n};\r\n\r\n(useProductStore as typeof useProductStore & { subscribe?: typeof baseStore.subscribe }).subscribe = baseStore.subscribe;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2017, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/types.ts"],"sourcesContent":["import type { SystemId } from '@/lib/id-types';\r\n\r\n// ========================================\r\n// PKGX Reference Data Types\r\n// ========================================\r\n\r\n/**\r\n * Danh mục PKGX (cat_id từ ECShop)\r\n */\r\nexport type PkgxCategory = {\r\n  id: number;         // cat_id trên PKGX\r\n  name: string;       // Tên danh mục\r\n  parentId?: number;  // Parent category (nếu có)\r\n  sortOrder?: number; // Thứ tự sắp xếp\r\n  isShow?: number;    // Hiển thị (1=hiện, 0=ẩn)\r\n  // SEO fields\r\n  cat_desc?: string;      // Mô tả danh mục ngắn\r\n  long_desc?: string;     // Mô tả danh mục dài (HTML)\r\n  keywords?: string;      // SEO keywords\r\n  meta_title?: string;    // Meta title\r\n  meta_desc?: string;     // Meta description\r\n  cat_alias?: string;     // Slug/alias\r\n  style?: string;         // Template style\r\n  grade?: number;         // Cấp độ danh mục\r\n  filter_attr?: string;   // Filter attributes\r\n};\r\n\r\n/**\r\n * Thương hiệu PKGX (brand_id từ ECShop)\r\n */\r\nexport type PkgxBrand = {\r\n  id: number;           // brand_id trên PKGX\r\n  name: string;         // Tên thương hiệu\r\n  // Basic fields\r\n  logo?: string;          // Logo URL\r\n  description?: string;   // Mô tả thương hiệu (brand_desc)\r\n  siteUrl?: string;       // Website URL\r\n  sortOrder?: number;     // Thứ tự sắp xếp\r\n  isShow?: number;        // Hiển thị (1=hiện, 0=ẩn)\r\n  // SEO fields\r\n  keywords?: string;      // Keywords\r\n  metaTitle?: string;     // Meta title\r\n  metaDesc?: string;      // Meta description\r\n  // Description fields\r\n  shortDescription?: string;  // Mô tả ngắn (short_desc)\r\n  longDescription?: string;   // Mô tả dài (long_desc)\r\n  // Legacy fields (backward compatibility)\r\n  brand_logo?: string;    // Logo URL (legacy)\r\n  brand_desc?: string;    // Mô tả thương hiệu (HTML) (legacy)\r\n  site_url?: string;      // Website URL (legacy)\r\n  sort_order?: number;    // Thứ tự sắp xếp (legacy)\r\n};\r\n\r\n/**\r\n * Ảnh trong gallery sản phẩm PKGX\r\n */\r\nexport type PkgxGalleryImage = {\r\n  img_id: number;           // ID ảnh trong gallery\r\n  goods_id: number;         // ID sản phẩm\r\n  img_url: string;          // Đường dẫn ảnh gốc\r\n  thumb_url: string;        // Đường dẫn thumbnail\r\n  img_desc?: string;        // Mô tả ảnh\r\n  img_original?: string;    // Ảnh gốc (nếu có)\r\n};\r\n\r\n// ========================================\r\n// Mapping Types\r\n// ========================================\r\n\r\n/**\r\n * Mapping danh mục HRM → PKGX\r\n */\r\nexport type PkgxCategoryMapping = {\r\n  id: string;                     // Unique mapping ID\r\n  hrmCategorySystemId: SystemId;  // Category systemId trong HRM\r\n  hrmCategoryName: string;        // Tên hiển thị HRM\r\n  pkgxCatId: number;              // cat_id trên PKGX\r\n  pkgxCatName: string;            // Tên danh mục PKGX\r\n};\r\n\r\n/**\r\n * Mapping thương hiệu HRM → PKGX\r\n */\r\nexport type PkgxBrandMapping = {\r\n  id: string;                     // Unique mapping ID\r\n  hrmBrandSystemId: SystemId;     // Brand systemId trong HRM\r\n  hrmBrandName: string;           // Tên hiển thị HRM\r\n  pkgxBrandId: number;            // brand_id trên PKGX\r\n  pkgxBrandName: string;          // Tên thương hiệu PKGX\r\n};\r\n\r\n/**\r\n * Mapping bảng giá HRM → các loại giá PKGX\r\n */\r\nexport type PkgxPriceMapping = {\r\n  shopPrice: SystemId | null;     // Bảng giá → shop_price (giá bán)\r\n  marketPrice: SystemId | null;   // Bảng giá → market_price (giá thị trường)\r\n  partnerPrice: SystemId | null;  // Bảng giá → partner_price (giá đối tác)\r\n  acePrice: SystemId | null;      // Bảng giá → ace_price\r\n  dealPrice: SystemId | null;     // Bảng giá → deal_price\r\n};\r\n\r\n// ========================================\r\n// Sync Settings Types\r\n// ========================================\r\n\r\n/**\r\n * Cài đặt đồng bộ tự động\r\n */\r\nexport type PkgxSyncSettings = {\r\n  autoSyncEnabled: boolean;       // Bật/tắt auto sync\r\n  intervalMinutes: number;        // Tần suất (15, 30, 60, 120, 240)\r\n  syncInventory: boolean;         // Đồng bộ tồn kho\r\n  syncPrice: boolean;             // Đồng bộ giá\r\n  syncSeo: boolean;               // Đồng bộ SEO (meta_title, meta_desc, keywords)\r\n  syncOnProductUpdate: boolean;   // Sync ngay khi update SP trong HRM\r\n  notifyOnError: boolean;         // Thông báo khi có lỗi\r\n};\r\n\r\n/**\r\n * Log đồng bộ PKGX - Ghi lại TẤT CẢ các API call\r\n */\r\nexport type PkgxSyncLog = {\r\n  id: string;                     // Unique log ID\r\n  timestamp: string;              // ISO timestamp\r\n  action: \r\n    | 'test_connection'           // Test kết nối API\r\n    | 'ping'                      // Ping server\r\n    | 'sync_all'                  // Đồng bộ toàn bộ\r\n    | 'sync_price'                // Đồng bộ giá\r\n    | 'sync_inventory'            // Đồng bộ tồn kho\r\n    | 'sync_seo'                  // Đồng bộ SEO\r\n    | 'sync_description'          // Đồng bộ mô tả\r\n    | 'sync_flags'                // Đồng bộ flags (isHot, isNew, etc.)\r\n    | 'sync_basic'                // Đồng bộ thông tin cơ bản (alias)\r\n    | 'sync_basic_info'           // Đồng bộ thông tin cơ bản\r\n    | 'sync_images'               // Đồng bộ ảnh sản phẩm\r\n    | 'create_product'            // Tạo sản phẩm mới trên PKGX\r\n    | 'update_product'            // Cập nhật sản phẩm\r\n    | 'link_product'              // Liên kết SP HRM với PKGX\r\n    | 'unlink_product'            // Hủy liên kết SP\r\n    | 'unlink_mapping'            // Hủy liên kết mapping (category/brand)\r\n    | 'batch_unlink'              // Hủy liên kết hàng loạt\r\n    | 'bulk_sync_all'             // Bulk: Đồng bộ toàn bộ\r\n    | 'bulk_sync_basic'           // Bulk: Đồng bộ thông tin cơ bản\r\n    | 'bulk_sync_price'           // Bulk: Đồng bộ giá\r\n    | 'bulk_sync_inventory'       // Bulk: Đồng bộ tồn kho\r\n    | 'bulk_sync_seo'             // Bulk: Đồng bộ SEO\r\n    | 'bulk_sync_description'     // Bulk: Đồng bộ mô tả\r\n    | 'bulk_sync_flags'           // Bulk: Đồng bộ flags\r\n    | 'bulk_sync_images'          // Bulk: Đồng bộ ảnh\r\n    | 'sync_categories'           // Đồng bộ danh mục\r\n    | 'sync_brands'               // Đồng bộ thương hiệu\r\n    | 'get_products'              // Lấy danh sách SP từ PKGX\r\n    | 'upload_image'              // Upload ảnh sản phẩm\r\n    | 'save_config'               // Lưu cấu hình\r\n    | 'save_mapping';             // Lưu mapping\r\n  status: 'success' | 'error' | 'partial' | 'info';\r\n  message: string;                // Log message\r\n  // User info - Ai thực hiện action\r\n  userId?: string;                // User systemId hoặc 'SYSTEM'\r\n  userName?: string;              // Tên người dùng\r\n  details?: {\r\n    // Request info\r\n    url?: string;\r\n    method?: string;\r\n    // Response info\r\n    responseTime?: number;        // ms\r\n    httpStatus?: number;\r\n    // Data info\r\n    total?: number;\r\n    success?: number;\r\n    failed?: number;\r\n    productId?: string;\r\n    productName?: string;\r\n    pkgxId?: number;\r\n    inventory?: number;\r\n    categoryId?: number;\r\n    brandId?: number;\r\n    // Error info\r\n    error?: string;\r\n    errorCode?: string;\r\n  };\r\n};\r\n\r\n/**\r\n * Kết quả sync gần nhất\r\n */\r\nexport type PkgxSyncResult = {\r\n  status: 'success' | 'partial' | 'error';\r\n  total: number;\r\n  success: number;\r\n  failed: number;\r\n  errors?: string[];\r\n};\r\n\r\n// ========================================\r\n// Main PKGX Settings Type\r\n// ========================================\r\n\r\n/**\r\n * Toàn bộ cài đặt PKGX\r\n */\r\nexport type PkgxSettings = {\r\n  // === General Config ===\r\n  apiUrl: string;\r\n  apiKey: string;\r\n  enabled: boolean;                // Bật/tắt tích hợp PKGX\r\n  \r\n  // === Reference Data ===\r\n  categories: PkgxCategory[];\r\n  brands: PkgxBrand[];\r\n  \r\n  // === Mappings ===\r\n  priceMapping: PkgxPriceMapping;\r\n  categoryMappings: PkgxCategoryMapping[];\r\n  brandMappings: PkgxBrandMapping[];\r\n  \r\n  // === Sync Settings ===\r\n  syncSettings: PkgxSyncSettings;\r\n  \r\n  // === Status ===\r\n  lastSyncAt?: string;\r\n  lastSyncResult?: PkgxSyncResult;\r\n  connectionStatus?: 'connected' | 'disconnected' | 'error';\r\n  connectionError?: string;\r\n  \r\n  // === Logs ===\r\n  logs: PkgxSyncLog[];\r\n  \r\n  // === Cached PKGX Products ===\r\n  pkgxProducts: PkgxProduct[];     // Sản phẩm từ PKGX - lưu cache để không mất khi chuyển tab\r\n  pkgxProductsLastFetch?: string;  // Thời gian fetch gần nhất\r\n};\r\n\r\n// ========================================\r\n// PKGX Product Response Types (từ API)\r\n// ========================================\r\n\r\n/**\r\n * Sản phẩm trả về từ PKGX API\r\n * \r\n * Lưu ý quan trọng:\r\n * - goods_id: Primary Key, dùng để update/link sản phẩm qua API\r\n * - goods_sn: Mã SKU của sản phẩm, có thể sync với HRM.sku\r\n */\r\nexport type PkgxProduct = {\r\n  goods_id: number;      // PRIMARY KEY - Dùng để update sản phẩm qua API\r\n  goods_name: string;\r\n  goods_sn: string;      // Mã SKU - map với HRM Product.sku\r\n  cat_id: number;\r\n  brand_id: number;\r\n  shop_price: number;\r\n  market_price: number;\r\n  partner_price: number;\r\n  ace_price?: number;\r\n  deal_price?: number;\r\n  goods_number: number;\r\n  goods_desc: string;\r\n  keywords: string;\r\n  goods_brief: string;\r\n  meta_title: string;\r\n  meta_desc: string;\r\n  goods_img: string;\r\n  goods_thumb: string;\r\n  original_img: string;\r\n  is_on_sale: number;\r\n  is_best: number;\r\n  is_hot: number;\r\n  is_new: number;\r\n  is_home: number;\r\n  slug: string;\r\n  seller_note?: string;\r\n  add_time?: number;\r\n  last_update?: number;\r\n};\r\n\r\n/**\r\n * Response phân trang từ get_products\r\n */\r\nexport type PkgxProductsResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  pagination: {\r\n    total_items: number;\r\n    total_pages: number;\r\n    current_page: number;\r\n    per_page: number;\r\n  };\r\n  data: PkgxProduct[];\r\n};\r\n\r\n/**\r\n * Response upload ảnh\r\n */\r\nexport type PkgxImageUploadResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  data: {\r\n    original_img: string;\r\n    goods_img: string;\r\n    goods_thumb: string;\r\n    full_urls: {\r\n      original: string;\r\n      goods: string;\r\n      thumb: string;\r\n    };\r\n  };\r\n  goods_id?: number;\r\n  product_updated?: boolean;\r\n};\r\n\r\n/**\r\n * Response lấy danh sách danh mục từ PKGX API\r\n */\r\nexport type PkgxCategoryFromApi = {\r\n  cat_id: number;\r\n  cat_name: string;\r\n  parent_id: number;\r\n  sort_order: number;\r\n  is_show?: number; // 0 or 1\r\n  // SEO fields\r\n  cat_desc?: string;\r\n  long_desc?: string;\r\n  keywords?: string;\r\n  meta_title?: string;\r\n  meta_desc?: string;\r\n  cat_alias?: string;\r\n  style?: string;\r\n  grade?: number;\r\n  filter_attr?: string;\r\n};\r\n\r\nexport type PkgxCategoriesResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  total: number;\r\n  data: PkgxCategoryFromApi[];\r\n};\r\n\r\n/**\r\n * Response lấy danh sách thương hiệu từ PKGX API\r\n */\r\nexport type PkgxBrandFromApi = {\r\n  brand_id: number;\r\n  brand_name: string;\r\n  brand_logo?: string;\r\n  brand_desc?: string;\r\n  short_desc?: string;\r\n  long_desc?: string;\r\n  keywords?: string;\r\n  meta_title?: string;\r\n  meta_desc?: string;\r\n  site_url?: string;\r\n  sort_order: number;\r\n  is_show?: number; // 0 or 1\r\n};\r\n\r\nexport type PkgxBrandsResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  total: number;\r\n  data: PkgxBrandFromApi[];\r\n};\r\n\r\n/**\r\n * Response lấy gallery ảnh sản phẩm từ PKGX API\r\n */\r\nexport type PkgxGalleryResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  goods_id: number;\r\n  total: number;\r\n  data: PkgxGalleryImage[];\r\n};\r\n\r\n/**\r\n * Payload tạo/cập nhật sản phẩm\r\n */\r\nexport type PkgxProductPayload = {\r\n  goods_name?: string;\r\n  goods_sn?: string;\r\n  cat_id?: number;\r\n  brand_id?: number;\r\n  shop_price?: number;\r\n  market_price?: number;\r\n  partner_price?: number;\r\n  ace_price?: number;\r\n  deal_price?: number;\r\n  goods_number?: number;\r\n  goods_desc?: string;\r\n  keywords?: string;\r\n  goods_brief?: string;\r\n  meta_title?: string;\r\n  meta_desc?: string;\r\n  original_img?: string;\r\n  gallery_images?: string[];  // Album ảnh sản phẩm\r\n  best?: boolean;\r\n  hot?: boolean;\r\n  new?: boolean;\r\n  ishome?: boolean;\r\n  is_on_sale?: boolean;  // Hiển thị đăng web (on/off trên website PKGX)\r\n  seller_note?: string;\r\n};\r\n\r\n// ========================================\r\n// UI State Types\r\n// ========================================\r\n\r\nexport type PkgxSettingsTab = \r\n  | 'general'\r\n  | 'categories'\r\n  | 'brands'\r\n  | 'category-mapping'\r\n  | 'brand-mapping'\r\n  | 'price-mapping'\r\n  | 'product-mapping'\r\n  | 'sync';\r\n\r\nexport type ConnectionTestResult = {\r\n  success: boolean;\r\n  message: string;\r\n  productCount?: number;\r\n};\r\n\r\n// ========================================\r\n// Default Values\r\n// ========================================\r\n\r\nexport const DEFAULT_PKGX_SETTINGS: PkgxSettings = {\r\n  apiUrl: 'https://phukiengiaxuong.com.vn/admin/api_product_pro.php',\r\n  apiKey: '',\r\n  enabled: false,\r\n  \r\n  categories: [],\r\n  brands: [],\r\n  \r\n  priceMapping: {\r\n    shopPrice: null,\r\n    marketPrice: null,\r\n    partnerPrice: null,\r\n    acePrice: null,\r\n    dealPrice: null,\r\n  },\r\n  categoryMappings: [],\r\n  brandMappings: [],\r\n  \r\n  syncSettings: {\r\n    autoSyncEnabled: false,\r\n    intervalMinutes: 30,\r\n    syncInventory: true,\r\n    syncPrice: true,\r\n    syncSeo: false,\r\n    syncOnProductUpdate: true,\r\n    notifyOnError: true,\r\n  },\r\n  \r\n  logs: [],\r\n  \r\n  // Cached PKGX Products\r\n  pkgxProducts: [],\r\n  pkgxProductsLastFetch: undefined,\r\n};\r\n\r\nexport const SYNC_INTERVAL_OPTIONS = [\r\n  { value: 15, label: '15 phút' },\r\n  { value: 30, label: '30 phút' },\r\n  { value: 60, label: '1 giờ' },\r\n  { value: 120, label: '2 giờ' },\r\n  { value: 240, label: '4 giờ' },\r\n];\r\n"],"names":[],"mappings":";;;;;;AA6aO,MAAM,wBAAsC;IACjD,QAAQ;IACR,QAAQ;IACR,SAAS;IAET,YAAY,EAAE;IACd,QAAQ,EAAE;IAEV,cAAc;QACZ,WAAW;QACX,aAAa;QACb,cAAc;QACd,UAAU;QACV,WAAW;IACb;IACA,kBAAkB,EAAE;IACpB,eAAe,EAAE;IAEjB,cAAc;QACZ,iBAAiB;QACjB,iBAAiB;QACjB,eAAe;QACf,WAAW;QACX,SAAS;QACT,qBAAqB;QACrB,eAAe;IACjB;IAEA,MAAM,EAAE;IAER,uBAAuB;IACvB,cAAc,EAAE;IAChB,uBAAuB;AACzB;AAEO,MAAM,wBAAwB;IACnC;QAAE,OAAO;QAAI,OAAO;IAAU;IAC9B;QAAE,OAAO;QAAI,OAAO;IAAU;IAC9B;QAAE,OAAO;QAAI,OAAO;IAAQ;IAC5B;QAAE,OAAO;QAAK,OAAO;IAAQ;IAC7B;QAAE,OAAO;QAAK,OAAO;IAAQ;CAC9B"}},
    {"offset": {"line": 2081, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/constants.ts"],"sourcesContent":["import type { PkgxCategory, PkgxBrand } from './types';\r\n\r\n/**\r\n * Danh sách danh mục PKGX (cat_id từ ECShop)\r\n * Nguồn: idpkgx.xlsx\r\n */\r\nexport const PKGX_CATEGORIES: PkgxCategory[] = [\r\n  // === Danh mục chính - Hàng theo loại ===\r\n  { id: 382, name: 'Sản phẩm mới' },\r\n  { id: 302, name: 'Hàng Theo Loại Bán' },\r\n  { id: 413, name: 'Hàng Hot Trend' },\r\n  { id: 390, name: 'Hàng Bán Chạy' },\r\n  { id: 389, name: 'Hàng Thanh Lý' },\r\n  { id: 387, name: 'Hàng Độc Quyền' },\r\n  { id: 391, name: 'Hàng bán Sàn TMĐT' },\r\n  { id: 388, name: 'Hàng Tặng Kèm' },\r\n  { id: 386, name: 'Hàng Chợ' },\r\n  \r\n  // === Tai nghe ===\r\n  { id: 37, name: 'Sỉ tai nghe' },\r\n  { id: 315, name: 'Tai nghe Bluetooth TWS' },\r\n  { id: 314, name: 'Tai nghe có dây' },\r\n  { id: 316, name: 'Tai nghe chụp tai bluetooth' },\r\n  { id: 375, name: 'Tai nghe bluetooth 1 bên' },\r\n  { id: 376, name: 'Tai nghe bluetooth thể thao' },\r\n  { id: 377, name: 'Tai nghe chụp tai Gaming' },\r\n  { id: 384, name: 'Case Tai Nghe Bluetooth' },\r\n  \r\n  // === Cáp sạc ===\r\n  { id: 38, name: 'Sỉ cáp sạc' },\r\n  { id: 317, name: 'Cáp sạc Type-C' },\r\n  { id: 318, name: 'Cáp sạc Lightning' },\r\n  { id: 319, name: 'Cáp sạc Micro USB' },\r\n  { id: 320, name: 'Cáp sạc đa năng' },\r\n  { id: 378, name: 'Cáp sạc nhanh' },\r\n  \r\n  // === Củ sạc ===\r\n  { id: 39, name: 'Sỉ củ sạc' },\r\n  { id: 321, name: 'Củ sạc nhanh' },\r\n  { id: 322, name: 'Củ sạc thường' },\r\n  { id: 323, name: 'Củ sạc không dây' },\r\n  { id: 379, name: 'Củ sạc Magsafe' },\r\n  \r\n  // === Sạc dự phòng ===\r\n  { id: 40, name: 'Sỉ sạc dự phòng' },\r\n  { id: 324, name: 'Sạc dự phòng 10000mAh' },\r\n  { id: 325, name: 'Sạc dự phòng 20000mAh' },\r\n  { id: 326, name: 'Sạc dự phòng 30000mAh+' },\r\n  { id: 380, name: 'Sạc dự phòng mini' },\r\n  \r\n  // === Loa ===\r\n  { id: 41, name: 'Sỉ loa bluetooth' },\r\n  { id: 327, name: 'Loa bluetooth mini' },\r\n  { id: 328, name: 'Loa bluetooth karaoke' },\r\n  { id: 329, name: 'Loa bluetooth chống nước' },\r\n  { id: 381, name: 'Loa kéo' },\r\n  \r\n  // === Phụ kiện điện thoại ===\r\n  { id: 42, name: 'Phụ kiện điện thoại' },\r\n  { id: 330, name: 'Ốp lưng điện thoại' },\r\n  { id: 331, name: 'Kính cường lực' },\r\n  { id: 332, name: 'Giá đỡ điện thoại' },\r\n  { id: 333, name: 'Gậy selfie/tripod' },\r\n  { id: 383, name: 'Ring holder' },\r\n  \r\n  // === Phụ kiện máy tính ===\r\n  { id: 43, name: 'Phụ kiện máy tính' },\r\n  { id: 334, name: 'Chuột máy tính' },\r\n  { id: 335, name: 'Bàn phím' },\r\n  { id: 336, name: 'Hub USB' },\r\n  { id: 337, name: 'Webcam' },\r\n  \r\n  // === Đồng hồ thông minh ===\r\n  { id: 44, name: 'Sỉ đồng hồ thông minh' },\r\n  { id: 338, name: 'Smartwatch' },\r\n  { id: 339, name: 'Smartband' },\r\n  { id: 340, name: 'Dây đeo smartwatch' },\r\n  \r\n  // === Gaming ===\r\n  { id: 45, name: 'Phụ kiện gaming' },\r\n  { id: 341, name: 'Tay cầm chơi game' },\r\n  { id: 342, name: 'Quạt tản nhiệt điện thoại' },\r\n  { id: 343, name: 'Nút bấm chơi game' },\r\n  \r\n  // === Ô tô ===\r\n  { id: 46, name: 'Phụ kiện ô tô' },\r\n  { id: 344, name: 'Sạc xe hơi' },\r\n  { id: 345, name: 'Giá đỡ điện thoại xe hơi' },\r\n  { id: 346, name: 'Camera hành trình' },\r\n  \r\n  // === Gia dụng ===\r\n  { id: 47, name: 'Đồ gia dụng' },\r\n  { id: 347, name: 'Đèn LED' },\r\n  { id: 348, name: 'Quạt mini' },\r\n  { id: 349, name: 'Cân điện tử' },\r\n];\r\n\r\n/**\r\n * Danh sách thương hiệu PKGX (brand_id từ ECShop)\r\n * Nguồn: idpkgx.xlsx\r\n */\r\nexport const PKGX_BRANDS: PkgxBrand[] = [\r\n  // === Thương hiệu chính ===\r\n  { id: 15, name: 'Hoco' },\r\n  { id: 141, name: 'Borofone' },\r\n  { id: 138, name: 'Baseus' },\r\n  { id: 12, name: 'Wekome' },\r\n  { id: 157, name: 'Maxitech' },\r\n  \r\n  // === Thương hiệu phụ ===\r\n  { id: 10, name: 'Anker' },\r\n  { id: 11, name: 'Xiaomi' },\r\n  { id: 13, name: 'Samsung' },\r\n  { id: 14, name: 'Apple' },\r\n  { id: 16, name: 'Remax' },\r\n  { id: 17, name: 'Ugreen' },\r\n  { id: 18, name: 'Vivan' },\r\n  { id: 19, name: 'Energizer' },\r\n  { id: 20, name: 'Sony' },\r\n  { id: 21, name: 'JBL' },\r\n  { id: 22, name: 'Logitech' },\r\n  { id: 23, name: 'Rapoo' },\r\n  { id: 24, name: 'Orico' },\r\n  { id: 25, name: 'Havit' },\r\n  { id: 26, name: 'Edifier' },\r\n  { id: 27, name: 'Aukey' },\r\n  { id: 28, name: 'Belkin' },\r\n  { id: 29, name: 'Mophie' },\r\n  { id: 30, name: 'Spigen' },\r\n  { id: 31, name: 'Nillkin' },\r\n  { id: 32, name: 'ESR' },\r\n  { id: 33, name: 'Mazer' },\r\n  { id: 34, name: 'Hyphen' },\r\n  { id: 35, name: 'WiWU' },\r\n  { id: 36, name: 'Pisen' },\r\n  { id: 37, name: 'Yoobao' },\r\n  { id: 38, name: 'iWalk' },\r\n  { id: 39, name: 'Romoss' },\r\n  { id: 40, name: 'Tronsmart' },\r\n  { id: 41, name: 'QCY' },\r\n  { id: 42, name: 'Lenovo' },\r\n  { id: 43, name: 'Huawei' },\r\n  { id: 44, name: 'Oppo' },\r\n  { id: 45, name: 'Vivo' },\r\n  { id: 46, name: 'Realme' },\r\n  { id: 47, name: 'Nothing' },\r\n  { id: 100, name: 'Không thương hiệu' },\r\n  { id: 101, name: 'OEM' },\r\n  { id: 102, name: 'Noname' },\r\n];\r\n\r\n/**\r\n * API Configuration\r\n */\r\nexport const PKGX_API_CONFIG = {\r\n  baseUrl: 'https://phukiengiaxuong.com.vn/admin/api_product_hrm.php',\r\n  cdnUrl: 'https://phukiengiaxuong.com.vn/cdn/',\r\n  defaultApiKey: 'a91f2c47e5d8b6f03a7c4e9d12f0b8a6',\r\n  \r\n  // Rate limiting\r\n  maxRequestsPerMinute: 60,\r\n  requestTimeout: 30000, // 30 seconds\r\n  \r\n  // Pagination\r\n  defaultPageSize: 50,\r\n  maxPageSize: 100,\r\n};\r\n\r\n/**\r\n * Field mapping reference\r\n */\r\nexport const FIELD_MAPPING_REFERENCE = {\r\n  // HRM Field → PKGX Field\r\n  'pkgxId': 'goods_id',\r\n  'id': 'goods_sn',\r\n  'name': 'goods_name',\r\n  'categorySystemId': 'cat_id',\r\n  'brandSystemId': 'brand_id',\r\n  'description': 'goods_desc',\r\n  'shortDescription': 'goods_brief',\r\n  'ktitle': 'meta_title',\r\n  'seoDescription': 'meta_desc',\r\n  'tags': 'keywords',\r\n  'thumbnailImage': 'original_img',\r\n  'isFeatured': 'is_best',\r\n  'isNewArrival': 'is_new',\r\n  'isPublished': 'is_on_sale',\r\n  'slug': 'slug',\r\n} as const;\r\n\r\n/**\r\n * PKGX Price field descriptions\r\n */\r\nexport const PKGX_PRICE_FIELDS = [\r\n  { key: 'shopPrice', field: 'shop_price', label: 'Giá bán (shop_price)', description: 'Giá bán chính trên website' },\r\n  { key: 'marketPrice', field: 'market_price', label: 'Giá thị trường (market_price)', description: 'Giá niêm yết / giá gốc' },\r\n  { key: 'partnerPrice', field: 'partner_price', label: 'Giá đối tác (partner_price)', description: 'Giá dành cho đối tác' },\r\n  { key: 'acePrice', field: 'ace_price', label: 'Giá ACE (ace_price)', description: 'Giá đặc biệt ACE' },\r\n  { key: 'dealPrice', field: 'deal_price', label: 'Giá deal (deal_price)', description: 'Giá khuyến mãi' },\r\n] as const;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2615, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/pkgx/api-service.ts"],"sourcesContent":["import { usePkgxSettingsStore } from '../../features/settings/pkgx/store';\r\nimport type {\r\n  PkgxProduct,\r\n  PkgxProductsResponse,\r\n  PkgxProductPayload,\r\n  PkgxImageUploadResponse,\r\n  PkgxCategoriesResponse,\r\n  PkgxBrandsResponse,\r\n  PkgxBrandFromApi,\r\n  PkgxGalleryResponse,\r\n  PkgxGalleryImage,\r\n} from '../../features/settings/pkgx/types';\r\nimport { PKGX_API_CONFIG } from '../../features/settings/pkgx/constants';\r\n\r\n// ========================================\r\n// Types\r\n// ========================================\r\n\r\ntype ApiResponse<T> = {\r\n  success: boolean;\r\n  data?: T;\r\n  error?: string;\r\n};\r\n\r\ntype CreateProductResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  goods_id: number;\r\n  created_slug: string;\r\n};\r\n\r\ntype UpdateProductResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  goods_id: number;\r\n  updated_slug?: string;\r\n};\r\n\r\n// ========================================\r\n// Helper Functions\r\n// ========================================\r\n\r\nfunction getApiConfig() {\r\n  const { settings } = usePkgxSettingsStore.getState();\r\n  return {\r\n    apiUrl: settings.apiUrl || PKGX_API_CONFIG.baseUrl,\r\n    apiKey: settings.apiKey,\r\n    enabled: settings.enabled,\r\n  };\r\n}\r\n\r\nasync function fetchWithAuth<T>(url: string, options: RequestInit = {}): Promise<ApiResponse<T>> {\r\n  const { apiKey, enabled } = getApiConfig();\r\n\r\n  if (!enabled) {\r\n    return { success: false, error: 'Tích hợp PKGX chưa được bật' };\r\n  }\r\n\r\n  if (!apiKey) {\r\n    return { success: false, error: 'Chưa cấu hình API Key' };\r\n  }\r\n\r\n  // DEBUG: Log request details\r\n  console.log('[PKGX fetchWithAuth] URL:', url);\r\n  console.log('[PKGX fetchWithAuth] Method:', options.method || 'GET');\r\n  console.log('[PKGX fetchWithAuth] Headers:', options.headers);\r\n  if (options.body) {\r\n    console.log('[PKGX fetchWithAuth] Body (raw):', options.body);\r\n    console.log('[PKGX fetchWithAuth] Body type:', typeof options.body);\r\n  }\r\n\r\n  try {\r\n    const fetchOptions: RequestInit = {\r\n      ...options,\r\n      mode: 'cors',\r\n      credentials: 'omit',\r\n      headers: {\r\n        'X-API-KEY': apiKey,\r\n        'Content-Type': 'application/json',\r\n        ...options.headers,\r\n      },\r\n    };\r\n    console.log('[PKGX fetchWithAuth] Full fetch options:', JSON.stringify(fetchOptions, null, 2));\r\n    \r\n    const response = await fetch(url, fetchOptions);\r\n\r\n    const responseText = await response.text();\r\n    console.log('[PKGX fetchWithAuth] Response text:', responseText);\r\n    \r\n    const data = JSON.parse(responseText);\r\n    \r\n    // DEBUG: Log response\r\n    console.log('[PKGX fetchWithAuth] Response status:', response.status);\r\n    console.log('[PKGX fetchWithAuth] Response data:', data);\r\n\r\n    if (data.error) {\r\n      return { success: false, error: data.message || 'Lỗi từ server PKGX' };\r\n    }\r\n\r\n    return { success: true, data };\r\n  } catch (error) {\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Không thể kết nối đến server PKGX',\r\n    };\r\n  }\r\n}\r\n\r\n// ========================================\r\n// API Functions\r\n// ========================================\r\n\r\n/**\r\n * Lấy danh sách danh mục từ PKGX\r\n */\r\nexport async function getCategories(): Promise<ApiResponse<PkgxCategoriesResponse>> {\r\n  const { apiUrl } = getApiConfig();\r\n  const url = `${apiUrl}?action=get_categories`;\r\n  return fetchWithAuth<PkgxCategoriesResponse>(url, { method: 'GET' });\r\n}\r\n\r\n/**\r\n * Lấy danh sách thương hiệu từ PKGX\r\n */\r\nexport async function getBrands(): Promise<ApiResponse<PkgxBrandsResponse>> {\r\n  const { apiUrl } = getApiConfig();\r\n  const url = `${apiUrl}?action=get_brands`;\r\n  return fetchWithAuth<PkgxBrandsResponse>(url, { method: 'GET' });\r\n}\r\n\r\n/**\r\n * Lấy chi tiết 1 thương hiệu từ PKGX theo brand_id\r\n */\r\nexport async function getBrandById(brandId: number): Promise<ApiResponse<PkgxBrandFromApi | null>> {\r\n  const { apiUrl } = getApiConfig();\r\n  const url = `${apiUrl}?action=get_brands&brand_id=${brandId}`;\r\n  \r\n  const response = await fetchWithAuth<{ error: boolean; message: string; data: PkgxBrandFromApi }>(url, { method: 'GET' });\r\n  \r\n  if (!response.success || !response.data) {\r\n    return { success: false, error: response.error };\r\n  }\r\n  \r\n  return { success: true, data: response.data.data };\r\n}\r\n\r\n/**\r\n * Lấy danh sách sản phẩm từ PKGX (có phân trang)\r\n */\r\nexport async function getProducts(\r\n  page: number = 1,\r\n  limit: number = 50\r\n): Promise<ApiResponse<PkgxProductsResponse>> {\r\n  const { apiUrl } = getApiConfig();\r\n  const url = `${apiUrl}?action=get_products&page=${page}&limit=${limit}`;\r\n  return fetchWithAuth<PkgxProductsResponse>(url, { method: 'GET' });\r\n}\r\n\r\n/**\r\n * Lấy tất cả sản phẩm từ PKGX (tự động phân trang)\r\n */\r\nexport async function getAllProducts(): Promise<ApiResponse<PkgxProduct[]>> {\r\n  const allProducts: PkgxProduct[] = [];\r\n  let currentPage = 1;\r\n  let totalPages = 1;\r\n\r\n  while (currentPage <= totalPages) {\r\n    const response = await getProducts(currentPage, 100);\r\n\r\n    if (!response.success || !response.data) {\r\n      return { success: false, error: response.error };\r\n    }\r\n\r\n    allProducts.push(...response.data.data);\r\n    totalPages = response.data.pagination.total_pages;\r\n    currentPage++;\r\n  }\r\n\r\n  return { success: true, data: allProducts };\r\n}\r\n\r\n/**\r\n * Lấy sản phẩm theo goods_id (sử dụng API get_products với filter)\r\n */\r\nexport async function getProductById(goodsId: number): Promise<ApiResponse<PkgxProduct | null>> {\r\n  const { apiUrl } = getApiConfig();\r\n  // API không có action=get_product, dùng get_products với goods_id filter\r\n  const url = `${apiUrl}?action=get_products&goods_id=${goodsId}`;\r\n  \r\n  const response = await fetchWithAuth<PkgxProductsResponse>(url, { method: 'GET' });\r\n  \r\n  if (!response.success || !response.data) {\r\n    return { success: false, error: response.error };\r\n  }\r\n  \r\n  // Trả về sản phẩm đầu tiên nếu có\r\n  const product = response.data.data?.[0] || null;\r\n  return { success: true, data: product };\r\n}\r\n\r\n/**\r\n * Lấy gallery ảnh sản phẩm theo goods_id\r\n * Note: Cần API endpoint `get_gallery` trên server PKGX\r\n */\r\nexport async function getProductGallery(goodsId: number): Promise<ApiResponse<PkgxGalleryImage[]>> {\r\n  const { apiUrl } = getApiConfig();\r\n  const url = `${apiUrl}?action=get_gallery&goods_id=${goodsId}`;\r\n  \r\n  try {\r\n    const response = await fetchWithAuth<PkgxGalleryResponse>(url, { method: 'GET' });\r\n    \r\n    // Debug log\r\n    console.log('Gallery API response:', response);\r\n    \r\n    if (!response.success) {\r\n      // Nếu API chưa có hoặc lỗi, trả về mảng rỗng\r\n      console.log('Gallery API error:', response.error);\r\n      return { success: true, data: [] };\r\n    }\r\n    \r\n    // response.data chứa toàn bộ response từ API: { error, message, goods_id, total, data }\r\n    const galleryData = response.data as PkgxGalleryResponse;\r\n    return { success: true, data: galleryData.data || [] };\r\n  } catch (error) {\r\n    console.error('Gallery API exception:', error);\r\n    return { success: true, data: [] }; // Fallback to empty array\r\n  }\r\n}\r\n\r\n/**\r\n * Tạo sản phẩm mới trên PKGX\r\n */\r\nexport async function createProduct(\r\n  payload: PkgxProductPayload\r\n): Promise<ApiResponse<CreateProductResponse>> {\r\n  const { apiUrl } = getApiConfig();\r\n  const url = `${apiUrl}?action=create_product`;\r\n\r\n  return fetchWithAuth<CreateProductResponse>(url, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(payload),\r\n  });\r\n}\r\n\r\n/**\r\n * Cập nhật sản phẩm trên PKGX\r\n */\r\nexport async function updateProduct(\r\n  goodsId: number,\r\n  payload: Partial<PkgxProductPayload>\r\n): Promise<ApiResponse<UpdateProductResponse>> {\r\n  const { apiUrl } = getApiConfig();\r\n  const url = `${apiUrl}?action=update_product&goods_id=${goodsId}`;\r\n\r\n  return fetchWithAuth<UpdateProductResponse>(url, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(payload),\r\n  });\r\n}\r\n\r\n/**\r\n * Cập nhật giá sản phẩm\r\n */\r\nexport async function updateProductPrice(\r\n  goodsId: number,\r\n  prices: {\r\n    shop_price?: number;\r\n    market_price?: number;\r\n    partner_price?: number;\r\n    ace_price?: number;\r\n    deal_price?: number;\r\n  }\r\n): Promise<ApiResponse<UpdateProductResponse>> {\r\n  return updateProduct(goodsId, prices);\r\n}\r\n\r\n/**\r\n * Cập nhật SEO sản phẩm\r\n */\r\nexport async function updateProductSeo(\r\n  goodsId: number,\r\n  seo: {\r\n    meta_title?: string;\r\n    meta_desc?: string;\r\n    keywords?: string;\r\n  }\r\n): Promise<ApiResponse<UpdateProductResponse>> {\r\n  return updateProduct(goodsId, seo);\r\n}\r\n\r\n/**\r\n * Cập nhật tồn kho sản phẩm\r\n */\r\nexport async function updateProductStock(\r\n  goodsId: number,\r\n  goodsNumber: number\r\n): Promise<ApiResponse<UpdateProductResponse>> {\r\n  return updateProduct(goodsId, { goods_number: goodsNumber });\r\n}\r\n\r\n/**\r\n * Upload ảnh sản phẩm lên PKGX\r\n */\r\nexport async function uploadProductImage(\r\n  imageFile: File,\r\n  options?: {\r\n    filenameSlug?: string;\r\n    goodsId?: number;\r\n  }\r\n): Promise<ApiResponse<PkgxImageUploadResponse>> {\r\n  const { apiUrl, apiKey, enabled } = getApiConfig();\r\n\r\n  if (!enabled) {\r\n    return { success: false, error: 'Tích hợp PKGX chưa được bật' };\r\n  }\r\n\r\n  if (!apiKey) {\r\n    return { success: false, error: 'Chưa cấu hình API Key' };\r\n  }\r\n\r\n  const url = `${apiUrl}?action=upload_product_image`;\r\n  const formData = new FormData();\r\n  formData.append('image_file', imageFile);\r\n\r\n  if (options?.filenameSlug) {\r\n    formData.append('filename_slug', options.filenameSlug);\r\n  }\r\n\r\n  if (options?.goodsId) {\r\n    formData.append('goods_id', options.goodsId.toString());\r\n  }\r\n\r\n  try {\r\n    const response = await fetch(url, {\r\n      method: 'POST',\r\n      headers: { 'X-API-KEY': apiKey },\r\n      body: formData,\r\n    });\r\n\r\n    const data = await response.json();\r\n\r\n    if (data.error) {\r\n      return { success: false, error: data.message };\r\n    }\r\n\r\n    return { success: true, data };\r\n  } catch (error) {\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Không thể upload ảnh',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Upload ảnh từ URL (server-to-server, tránh CORS)\r\n * Server PKGX sẽ tự download ảnh từ URL rồi xử lý\r\n */\r\nexport async function uploadImageFromUrl(\r\n  imageUrl: string,\r\n  options?: {\r\n    filenameSlug?: string;\r\n    goodsId?: number;\r\n  }\r\n): Promise<ApiResponse<PkgxImageUploadResponse>> {\r\n  const { apiUrl, apiKey, enabled } = getApiConfig();\r\n\r\n  if (!enabled) {\r\n    return { success: false, error: 'Tích hợp PKGX chưa được bật' };\r\n  }\r\n\r\n  if (!apiKey) {\r\n    return { success: false, error: 'Chưa cấu hình API Key' };\r\n  }\r\n\r\n  const url = `${apiUrl}?action=upload_image_from_url`;\r\n  \r\n  const payload: Record<string, unknown> = {\r\n    image_url: imageUrl,\r\n  };\r\n\r\n  if (options?.filenameSlug) {\r\n    payload.filename_slug = options.filenameSlug;\r\n  }\r\n\r\n  if (options?.goodsId) {\r\n    payload.goods_id = options.goodsId;\r\n  }\r\n\r\n  try {\r\n    const response = await fetch(url, {\r\n      method: 'POST',\r\n      headers: { \r\n        'X-API-KEY': apiKey,\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify(payload),\r\n    });\r\n\r\n    const data = await response.json();\r\n\r\n    if (data.error) {\r\n      return { success: false, error: data.message };\r\n    }\r\n\r\n    return { success: true, data };\r\n  } catch (error) {\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Không thể upload ảnh từ URL',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Lấy chi tiết danh mục theo cat_id (bao gồm SEO fields)\r\n */\r\nexport async function getCategoryById(catId: number): Promise<ApiResponse<PkgxCategoriesResponse>> {\r\n  const { apiUrl } = getApiConfig();\r\n  const url = `${apiUrl}?action=get_categories&cat_id=${catId}`;\r\n  return fetchWithAuth<PkgxCategoriesResponse>(url, { method: 'GET' });\r\n}\r\n\r\n/**\r\n * Cập nhật thông tin danh mục (SEO, mô tả)\r\n * \r\n * Các trường hỗ trợ:\r\n * - cat_name: Tên danh mục\r\n * - cat_desc: Mô tả chi tiết (HTML) - tương đương longDescription\r\n * - keywords: Từ khóa SEO - tương đương seoKeywords\r\n * - cat_alias: Slug URL\r\n * - meta_title: Tiêu đề SEO (NEW)\r\n * - meta_desc: Mô tả SEO (NEW)\r\n * - short_desc: Mô tả ngắn (NEW)\r\n */\r\nexport async function updateCategory(\r\n  catId: number,\r\n  payload: {\r\n    cat_name?: string;\r\n    cat_desc?: string;  // Mô tả ngắn (shortDescription)\r\n    long_desc?: string; // Mô tả dài (longDescription) - HTML\r\n    keywords?: string;\r\n    cat_alias?: string;\r\n    // SEO fields\r\n    meta_title?: string;\r\n    meta_desc?: string;\r\n  }\r\n): Promise<ApiResponse<{ error: boolean; message: string; cat_id: number }>> {\r\n  const { apiUrl } = getApiConfig();\r\n  // Add timestamp to bust cache\r\n  const timestamp = Date.now();\r\n  const url = `${apiUrl}?action=update_category&cat_id=${catId}&_t=${timestamp}`;\r\n\r\n  console.log('[updateCategory] Calling with catId:', catId, 'payload:', payload);\r\n\r\n  return fetchWithAuth(url, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(payload),\r\n  });\r\n}\r\n\r\n/**\r\n * Cập nhật thông tin cơ bản danh mục (tên, parent, hiển thị)\r\n * URL: POST ?action=update_category_basic&cat_id=123\r\n * \r\n * Các trường hỗ trợ:\r\n * - cat_name: Tên danh mục\r\n * - parent_id: ID danh mục cha (0 = gốc)\r\n * - is_show: 1 = Hiển thị, 0 = Ẩn (Display in Category Home)\r\n */\r\nexport async function updateCategoryBasic(\r\n  catId: number,\r\n  payload: {\r\n    cat_name?: string;\r\n    parent_id?: number;\r\n    is_show?: number; // 1 = hiển thị, 0 = ẩn\r\n  }\r\n): Promise<ApiResponse<{ error: boolean; message: string; cat_id: number; changes?: Record<string, { old: unknown; new: unknown }> }>> {\r\n  const { apiUrl } = getApiConfig();\r\n  const timestamp = Date.now();\r\n  const url = `${apiUrl}?action=update_category_basic&cat_id=${catId}&_t=${timestamp}`;\r\n\r\n  console.log('[updateCategoryBasic] Calling with catId:', catId, 'payload:', payload);\r\n\r\n  return fetchWithAuth(url, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(payload),\r\n  });\r\n}\r\n\r\n/**\r\n * Cập nhật thông tin thương hiệu (SEO, mô tả)\r\n * \r\n * Các trường hỗ trợ:\r\n * - brand_name: Tên thương hiệu\r\n * - brand_desc: Mô tả chi tiết (HTML) - tương đương longDescription\r\n * - site_url: Website URL\r\n * - keywords: Từ khóa SEO (NEW) - tương đương seoKeywords\r\n * - meta_title: Tiêu đề SEO (NEW)\r\n * - meta_desc: Mô tả SEO (NEW)\r\n * - short_desc: Mô tả ngắn (NEW)\r\n * - long_desc: Mô tả dài (NEW)\r\n */\r\nexport async function updateBrand(\r\n  brandId: number,\r\n  payload: {\r\n    brand_name?: string;\r\n    brand_desc?: string;\r\n    site_url?: string;\r\n    // SEO fields (NEW)\r\n    keywords?: string;\r\n    meta_title?: string;\r\n    meta_desc?: string;\r\n    short_desc?: string;\r\n    long_desc?: string;\r\n  }\r\n): Promise<ApiResponse<{ error: boolean; message: string; brand_id: number }>> {\r\n  const { apiUrl } = getApiConfig();\r\n  const url = `${apiUrl}?action=update_brand&brand_id=${brandId}`;\r\n\r\n  return fetchWithAuth(url, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(payload),\r\n  });\r\n}\r\n\r\n/**\r\n * Test kết nối API\r\n */\r\nexport async function testConnection(): Promise<ApiResponse<{ productCount: number }>> {\r\n  const response = await getProducts(1, 1);\r\n\r\n  if (!response.success) {\r\n    return { success: false, error: response.error };\r\n  }\r\n\r\n  return {\r\n    success: true,\r\n    data: { productCount: response.data?.pagination.total_items || 0 },\r\n  };\r\n}\r\n\r\n// ========================================\r\n// Member Price API (Giá thành viên)\r\n// ========================================\r\n\r\ntype MemberRank = {\r\n  rank_id: number;\r\n  rank_name: string;\r\n  min_points: number;\r\n  max_points: number;\r\n  discount: number;\r\n  special_rank: number;\r\n};\r\n\r\ntype MemberRanksResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  total: number;\r\n  data: MemberRank[];\r\n};\r\n\r\ntype MemberPriceResult = {\r\n  user_rank: number;\r\n  rank_name?: string;\r\n  user_price?: number;\r\n  status: 'updated' | 'deleted' | 'skipped';\r\n  reason?: string;\r\n};\r\n\r\ntype CurrentMemberPrice = {\r\n  user_rank: string;\r\n  user_price: string;\r\n  rank_name: string;\r\n};\r\n\r\ntype UpdateMemberPriceResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  goods_id: number;\r\n  goods_name: string;\r\n  results: MemberPriceResult[];\r\n  current_member_prices: CurrentMemberPrice[];\r\n};\r\n\r\n/**\r\n * Lấy danh sách hạng thành viên từ PKGX\r\n */\r\nexport async function getMemberRanks(): Promise<ApiResponse<MemberRanksResponse>> {\r\n  const { apiUrl } = getApiConfig();\r\n  const url = `${apiUrl}?action=get_member_ranks`;\r\n  return fetchWithAuth<MemberRanksResponse>(url, { method: 'GET' });\r\n}\r\n\r\n/**\r\n * Cập nhật giá thành viên cho sản phẩm\r\n * \r\n * @param goodsId - ID sản phẩm trên PKGX\r\n * @param memberPrices - Mảng giá thành viên theo user_rank\r\n * \r\n * Ví dụ:\r\n * - Cập nhật 1 giá: updateMemberPrice(8014, [{ user_rank: 8, user_price: 2200000 }])\r\n * - Cập nhật nhiều: updateMemberPrice(8014, [{ user_rank: 8, user_price: 2200000 }, { user_rank: 9, user_price: 1800000 }])\r\n * - Xóa giá (set = 0): updateMemberPrice(8014, [{ user_rank: 8, user_price: 0 }])\r\n */\r\nexport async function updateMemberPrice(\r\n  goodsId: number,\r\n  memberPrices: Array<{ user_rank: number; user_price: number }>\r\n): Promise<ApiResponse<UpdateMemberPriceResponse>> {\r\n  const { apiUrl } = getApiConfig();\r\n  const url = `${apiUrl}?action=update_member_price&goods_id=${goodsId}`;\r\n\r\n  return fetchWithAuth<UpdateMemberPriceResponse>(url, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ member_prices: memberPrices }),\r\n  });\r\n}\r\n\r\n/**\r\n * Cập nhật giá thành viên theo rank_id đơn lẻ\r\n */\r\nexport async function updateMemberPriceSingle(\r\n  goodsId: number,\r\n  userRank: number,\r\n  userPrice: number\r\n): Promise<ApiResponse<UpdateMemberPriceResponse>> {\r\n  return updateMemberPrice(goodsId, [{ user_rank: userRank, user_price: userPrice }]);\r\n}\r\n\r\n// ========================================\r\n// HTML Image Processing\r\n// ========================================\r\n\r\n/**\r\n * Kiểm tra URL có phải là URL công khai không (không phải localhost/internal)\r\n */\r\nfunction isPublicUrl(url: string): boolean {\r\n  try {\r\n    const parsed = new URL(url);\r\n    const hostname = parsed.hostname.toLowerCase();\r\n    \r\n    // Loại bỏ các URL nội bộ\r\n    if (hostname === 'localhost' || \r\n        hostname === '127.0.0.1' ||\r\n        hostname.startsWith('192.168.') ||\r\n        hostname.startsWith('10.') ||\r\n        hostname.endsWith('.local')) {\r\n      return false;\r\n    }\r\n    return true;\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Kiểm tra xem URL có phải là ảnh base64 không\r\n */\r\nfunction isBase64Image(url: string): boolean {\r\n  return url.startsWith('data:image/');\r\n}\r\n\r\n/**\r\n * Kiểm tra xem URL đã là URL của PKGX CDN chưa\r\n */\r\nfunction isPkgxCdnUrl(url: string): boolean {\r\n  return url.includes('phukiengiaxuong.com.vn/cdn/');\r\n}\r\n\r\n/**\r\n * Xử lý HTML để upload tất cả ảnh lên PKGX và thay thế URL\r\n * \r\n * Hàm này sẽ:\r\n * 1. Tìm tất cả <img> tags trong HTML\r\n * 2. Với mỗi ảnh có src là URL công khai (không phải localhost):\r\n *    - Upload lên PKGX qua upload_image_from_url\r\n *    - Thay thế src bằng URL mới trên PKGX CDN\r\n * 3. Với ảnh base64: bỏ qua (quá nặng, không sync)\r\n * 4. Với ảnh đã trên PKGX CDN: giữ nguyên\r\n * \r\n * @param html - HTML content cần xử lý\r\n * @param filenamePrefix - Prefix cho tên file (optional)\r\n * @returns HTML đã được xử lý với URLs mới\r\n */\r\nexport async function processHtmlImagesForPkgx(\r\n  html: string,\r\n  filenamePrefix?: string\r\n): Promise<{ processedHtml: string; uploadedCount: number; skippedCount: number; errors: string[] }> {\r\n  if (!html) {\r\n    return { processedHtml: html, uploadedCount: 0, skippedCount: 0, errors: [] };\r\n  }\r\n\r\n  // Regex để tìm tất cả <img> tags\r\n  const imgRegex = /<img[^>]+src=[\"']([^\"']+)[\"'][^>]*>/gi;\r\n  \r\n  let processedHtml = html;\r\n  let uploadedCount = 0;\r\n  let skippedCount = 0;\r\n  const errors: string[] = [];\r\n  \r\n  // Tìm tất cả các ảnh\r\n  const matches: Array<{ fullMatch: string; src: string }> = [];\r\n  let match;\r\n  while ((match = imgRegex.exec(html)) !== null) {\r\n    matches.push({ fullMatch: match[0], src: match[1] });\r\n  }\r\n\r\n  // Xử lý từng ảnh\r\n  for (let i = 0; i < matches.length; i++) {\r\n    const { fullMatch, src } = matches[i];\r\n    \r\n    // Skip base64 images\r\n    if (isBase64Image(src)) {\r\n      skippedCount++;\r\n      errors.push(`Bỏ qua ảnh base64 (không hỗ trợ upload base64)`);\r\n      continue;\r\n    }\r\n    \r\n    // Skip if already on PKGX CDN\r\n    if (isPkgxCdnUrl(src)) {\r\n      skippedCount++;\r\n      continue;\r\n    }\r\n    \r\n    // Skip localhost/internal URLs\r\n    if (!isPublicUrl(src)) {\r\n      skippedCount++;\r\n      errors.push(`Bỏ qua URL nội bộ: ${src.substring(0, 50)}...`);\r\n      continue;\r\n    }\r\n    \r\n    // Upload to PKGX\r\n    try {\r\n      const slug = filenamePrefix \r\n        ? `${filenamePrefix}-desc-img-${i + 1}` \r\n        : `desc-img-${Date.now()}-${i + 1}`;\r\n      \r\n      const uploadResult = await uploadImageFromUrl(src, { filenameSlug: slug });\r\n      \r\n      if (uploadResult.success && uploadResult.data?.data?.full_urls?.original) {\r\n        // Replace src in HTML\r\n        const newSrc = uploadResult.data.data.full_urls.original;\r\n        const newImgTag = fullMatch.replace(src, newSrc);\r\n        processedHtml = processedHtml.replace(fullMatch, newImgTag);\r\n        uploadedCount++;\r\n      } else {\r\n        errors.push(`Lỗi upload ảnh: ${uploadResult.error || 'Unknown error'}`);\r\n        skippedCount++;\r\n      }\r\n    } catch (error) {\r\n      errors.push(`Exception upload ảnh: ${error instanceof Error ? error.message : String(error)}`);\r\n      skippedCount++;\r\n    }\r\n  }\r\n\r\n  return { processedHtml, uploadedCount, skippedCount, errors };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3174, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/store.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport type { SystemId } from '@/lib/id-types';\r\nimport type {\r\n  PkgxSettings,\r\n  PkgxCategory,\r\n  PkgxBrand,\r\n  PkgxCategoryMapping,\r\n  PkgxBrandMapping,\r\n  PkgxPriceMapping,\r\n  PkgxSyncSettings,\r\n  PkgxSyncResult,\r\n  PkgxSyncLog,\r\n  PkgxProduct,\r\n} from './types';\r\nimport { DEFAULT_PKGX_SETTINGS } from './types';\r\nimport { PKGX_CATEGORIES, PKGX_BRANDS } from './constants';\r\nimport { getCategories as fetchPkgxCategories, getBrands as fetchPkgxBrands } from '@/lib/pkgx/api-service';\r\nimport { getCurrentUserInfo } from '@/contexts/auth-context';\r\n\r\n// ========================================\r\n// Store Interface\r\n// ========================================\r\n\r\ninterface PkgxSettingsStore {\r\n  // === State ===\r\n  settings: PkgxSettings;\r\n  isLoading: boolean;\r\n  isSaving: boolean;\r\n  \r\n  // === General Config Actions ===\r\n  setApiUrl: (url: string) => void;\r\n  setApiKey: (key: string) => void;\r\n  setEnabled: (enabled: boolean) => void;\r\n  \r\n  // === Reference Data Actions ===\r\n  setCategories: (categories: PkgxCategory[]) => void;\r\n  addCategory: (category: PkgxCategory) => void;\r\n  updateCategory: (id: number, updates: Partial<PkgxCategory>) => void;\r\n  deleteCategory: (id: number) => void;\r\n  \r\n  setBrands: (brands: PkgxBrand[]) => void;\r\n  addBrand: (brand: PkgxBrand) => void;\r\n  updateBrand: (id: number, updates: Partial<PkgxBrand>) => void;\r\n  deleteBrand: (id: number) => void;\r\n  \r\n  // === Mapping Actions ===\r\n  setPriceMapping: (mapping: PkgxPriceMapping) => void;\r\n  updatePriceMapping: (field: keyof PkgxPriceMapping, policyId: SystemId | null) => void;\r\n  \r\n  setCategoryMappings: (mappings: PkgxCategoryMapping[]) => void;\r\n  addCategoryMapping: (mapping: PkgxCategoryMapping) => void;\r\n  updateCategoryMapping: (id: string, updates: Partial<PkgxCategoryMapping>) => void;\r\n  deleteCategoryMapping: (id: string) => void;\r\n  \r\n  setBrandMappings: (mappings: PkgxBrandMapping[]) => void;\r\n  addBrandMapping: (mapping: PkgxBrandMapping) => void;\r\n  updateBrandMapping: (id: string, updates: Partial<PkgxBrandMapping>) => void;\r\n  deleteBrandMapping: (id: string) => void;\r\n  \r\n  // === Sync Settings Actions ===\r\n  setSyncSettings: (settings: PkgxSyncSettings) => void;\r\n  updateSyncSetting: <K extends keyof PkgxSyncSettings>(key: K, value: PkgxSyncSettings[K]) => void;\r\n  \r\n  // === Log Actions ===\r\n  addLog: (log: Omit<PkgxSyncLog, 'id' | 'timestamp'>) => void;\r\n  clearLogs: () => void;\r\n  \r\n  // === Sync Actions ===\r\n  syncCategoriesFromPkgx: () => Promise<void>;\r\n  syncBrandsFromPkgx: () => Promise<void>;\r\n  \r\n  // === PKGX Products Cache Actions ===\r\n  setPkgxProducts: (products: PkgxProduct[]) => void;\r\n  clearPkgxProducts: () => void;\r\n  \r\n  // === Status Actions ===\r\n  setLastSyncAt: (timestamp: string) => void;\r\n  setLastSyncResult: (result: PkgxSyncResult) => void;\r\n  setConnectionStatus: (status: 'connected' | 'disconnected' | 'error', error?: string) => void;\r\n  \r\n  // === Utility Actions ===\r\n  loadDefaultData: () => void;\r\n  resetSettings: () => void;\r\n  setLoading: (loading: boolean) => void;\r\n  setSaving: (saving: boolean) => void;\r\n  \r\n  // === Getters ===\r\n  getCategoryById: (id: number) => PkgxCategory | undefined;\r\n  getBrandById: (id: number) => PkgxBrand | undefined;\r\n  getCategoryMappingByHrmId: (hrmCategoryId: SystemId) => PkgxCategoryMapping | undefined;\r\n  getBrandMappingByHrmId: (hrmBrandId: SystemId) => PkgxBrandMapping | undefined;\r\n  getPkgxCatIdByHrmCategory: (hrmCategoryId: SystemId) => number | null;\r\n  getPkgxBrandIdByHrmBrand: (hrmBrandId: SystemId) => number | null;\r\n  \r\n  // === API Sync ===\r\n  initialized: boolean;\r\n  loadFromAPI: () => Promise<void>;\r\n}\r\n\r\n// ========================================\r\n// API Sync Helper\r\n// ========================================\r\nasync function syncPkgxSettingsToAPI(settings: Partial<PkgxSettings>): Promise<boolean> {\r\n  try {\r\n    const response = await fetch('/api/settings/pkgx', {\r\n      method: 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      credentials: 'include',\r\n      body: JSON.stringify(settings),\r\n    });\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error('[PKGX Settings API] sync error:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// ========================================\r\n// Store Implementation\r\n// ========================================\r\n\r\nexport const usePkgxSettingsStore = create<PkgxSettingsStore>()(\r\n  (set, get) => ({\r\n      // === Initial State ===\r\n      settings: {\r\n        ...DEFAULT_PKGX_SETTINGS,\r\n        categories: PKGX_CATEGORIES,\r\n        brands: PKGX_BRANDS,\r\n      },\r\n      isLoading: false,\r\n      isSaving: false,\r\n      initialized: false,\r\n      \r\n      // === General Config Actions ===\r\n      setApiUrl: (url) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, apiUrl: url },\r\n        })),\r\n        \r\n      setApiKey: (key) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, apiKey: key },\r\n        })),\r\n        \r\n      setEnabled: (enabled) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, enabled },\r\n        })),\r\n      \r\n      // === Reference Data Actions ===\r\n      setCategories: (categories) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, categories },\r\n        })),\r\n        \r\n      addCategory: (category) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categories: [...state.settings.categories, category],\r\n          },\r\n        })),\r\n        \r\n      updateCategory: (id, updates) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categories: state.settings.categories.map((c) =>\r\n              c.id === id ? { ...c, ...updates } : c\r\n            ),\r\n          },\r\n        })),\r\n        \r\n      deleteCategory: (id) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categories: state.settings.categories.filter((c) => c.id !== id),\r\n            // Also remove related mappings\r\n            categoryMappings: state.settings.categoryMappings.filter(\r\n              (m) => m.pkgxCatId !== id\r\n            ),\r\n          },\r\n        })),\r\n      \r\n      setBrands: (brands) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, brands },\r\n        })),\r\n        \r\n      addBrand: (brand) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brands: [...state.settings.brands, brand],\r\n          },\r\n        })),\r\n        \r\n      updateBrand: (id, updates) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brands: state.settings.brands.map((b) =>\r\n              b.id === id ? { ...b, ...updates } : b\r\n            ),\r\n          },\r\n        })),\r\n        \r\n      deleteBrand: (id) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brands: state.settings.brands.filter((b) => b.id !== id),\r\n            // Also remove related mappings\r\n            brandMappings: state.settings.brandMappings.filter(\r\n              (m) => m.pkgxBrandId !== id\r\n            ),\r\n          },\r\n        })),\r\n      \r\n      // === Mapping Actions ===\r\n      setPriceMapping: (mapping) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, priceMapping: mapping },\r\n        })),\r\n        \r\n      updatePriceMapping: (field, policyId) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            priceMapping: {\r\n              ...state.settings.priceMapping,\r\n              [field]: policyId,\r\n            },\r\n          },\r\n        })),\r\n      \r\n      setCategoryMappings: (mappings) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, categoryMappings: mappings },\r\n        })),\r\n        \r\n      addCategoryMapping: (mapping) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categoryMappings: [...state.settings.categoryMappings, mapping],\r\n          },\r\n        })),\r\n        \r\n      updateCategoryMapping: (id, updates) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categoryMappings: state.settings.categoryMappings.map((m) =>\r\n              m.id === id ? { ...m, ...updates } : m\r\n            ),\r\n          },\r\n        })),\r\n        \r\n      deleteCategoryMapping: (id) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categoryMappings: state.settings.categoryMappings.filter(\r\n              (m) => m.id !== id\r\n            ),\r\n          },\r\n        })),\r\n      \r\n      setBrandMappings: (mappings) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, brandMappings: mappings },\r\n        })),\r\n        \r\n      addBrandMapping: (mapping) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brandMappings: [...state.settings.brandMappings, mapping],\r\n          },\r\n        })),\r\n        \r\n      updateBrandMapping: (id, updates) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brandMappings: state.settings.brandMappings.map((m) =>\r\n              m.id === id ? { ...m, ...updates } : m\r\n            ),\r\n          },\r\n        })),\r\n        \r\n      deleteBrandMapping: (id) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brandMappings: state.settings.brandMappings.filter(\r\n              (m) => m.id !== id\r\n            ),\r\n          },\r\n        })),\r\n      \r\n      // === Sync Settings Actions ===\r\n      setSyncSettings: (syncSettings) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, syncSettings },\r\n        })),\r\n        \r\n      updateSyncSetting: (key, value) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            syncSettings: {\r\n              ...state.settings.syncSettings,\r\n              [key]: value,\r\n            },\r\n          },\r\n        })),\r\n      \r\n      // === Log Actions ===\r\n      addLog: (log) => {\r\n        // Lấy thông tin user hiện tại\r\n        const userInfo = getCurrentUserInfo();\r\n        \r\n        const newLog: PkgxSyncLog = {\r\n          ...log,\r\n          id: `log-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,\r\n          timestamp: new Date().toISOString(),\r\n          userId: userInfo.systemId,\r\n          userName: userInfo.name,\r\n        };\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            logs: [newLog, ...state.settings.logs].slice(0, 100), // Keep last 100 logs\r\n          },\r\n        }));\r\n      },\r\n      \r\n      clearLogs: () =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, logs: [] },\r\n        })),\r\n      \r\n      // === Sync Actions ===\r\n      syncCategoriesFromPkgx: async () => {\r\n        const { addLog, setCategories } = get();\r\n        try {\r\n          const response = await fetchPkgxCategories();\r\n          if (response.success && response.data && !response.data.error) {\r\n            // Map API response to PkgxCategory format\r\n            const categories: PkgxCategory[] = response.data.data.map((cat) => ({\r\n              id: cat.cat_id,\r\n              name: cat.cat_name,\r\n              parentId: cat.parent_id > 0 ? cat.parent_id : undefined,\r\n            }));\r\n            \r\n            // Replace all categories with fresh data from server\r\n            setCategories(categories);\r\n            addLog({\r\n              action: 'sync_categories',\r\n              status: 'success',\r\n              message: `Đã đồng bộ ${categories.length} danh mục từ PKGX`,\r\n              details: { total: categories.length, success: categories.length, failed: 0 },\r\n            });\r\n          } else {\r\n            throw new Error(response.error || response.data?.message || 'Không thể lấy danh sách danh mục');\r\n          }\r\n        } catch (error) {\r\n          addLog({\r\n            action: 'sync_categories',\r\n            status: 'error',\r\n            message: 'Lỗi khi đồng bộ danh mục từ PKGX',\r\n            details: { error: error instanceof Error ? error.message : String(error) },\r\n          });\r\n          throw error; // Re-throw to let UI handle\r\n        }\r\n      },\r\n      \r\n      syncBrandsFromPkgx: async () => {\r\n        const { addLog, setBrands } = get();\r\n        try {\r\n          const response = await fetchPkgxBrands();\r\n          if (response.success && response.data && !response.data.error) {\r\n            // Map API response to PkgxBrand format\r\n            const brands: PkgxBrand[] = response.data.data.map((brand) => ({\r\n              id: brand.brand_id,\r\n              name: brand.brand_name,\r\n            }));\r\n            \r\n            // Replace all brands with fresh data from server\r\n            setBrands(brands);\r\n            addLog({\r\n              action: 'sync_brands',\r\n              status: 'success',\r\n              message: `Đã đồng bộ ${brands.length} thương hiệu từ PKGX`,\r\n              details: { total: brands.length, success: brands.length, failed: 0 },\r\n            });\r\n          } else {\r\n            throw new Error(response.error || response.data?.message || 'Không thể lấy danh sách thương hiệu');\r\n          }\r\n        } catch (error) {\r\n          addLog({\r\n            action: 'sync_brands',\r\n            status: 'error',\r\n            message: 'Lỗi khi đồng bộ thương hiệu từ PKGX',\r\n            details: { error: error instanceof Error ? error.message : String(error) },\r\n          });\r\n          throw error; // Re-throw to let UI handle\r\n        }\r\n      },\r\n      \r\n      // === PKGX Products Cache Actions ===\r\n      setPkgxProducts: (products) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            pkgxProducts: products,\r\n            pkgxProductsLastFetch: new Date().toISOString(),\r\n          },\r\n        })),\r\n        \r\n      clearPkgxProducts: () =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            pkgxProducts: [],\r\n            pkgxProductsLastFetch: undefined,\r\n          },\r\n        })),\r\n      \r\n      // === Status Actions ===\r\n      setLastSyncAt: (timestamp) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, lastSyncAt: timestamp },\r\n        })),\r\n        \r\n      setLastSyncResult: (result) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, lastSyncResult: result },\r\n        })),\r\n        \r\n      setConnectionStatus: (status, error) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            connectionStatus: status,\r\n            connectionError: error,\r\n          },\r\n        })),\r\n      \r\n      // === Utility Actions ===\r\n      loadDefaultData: () =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categories: PKGX_CATEGORIES,\r\n            brands: PKGX_BRANDS,\r\n          },\r\n        })),\r\n        \r\n      resetSettings: () =>\r\n        set({\r\n          settings: {\r\n            ...DEFAULT_PKGX_SETTINGS,\r\n            categories: PKGX_CATEGORIES,\r\n            brands: PKGX_BRANDS,\r\n          },\r\n        }),\r\n        \r\n      setLoading: (isLoading) => set({ isLoading }),\r\n      setSaving: (isSaving) => set({ isSaving }),\r\n      \r\n      // === Getters ===\r\n      getCategoryById: (id) =>\r\n        get().settings.categories.find((c) => c.id === id),\r\n        \r\n      getBrandById: (id) =>\r\n        get().settings.brands.find((b) => b.id === id),\r\n        \r\n      getCategoryMappingByHrmId: (hrmCategoryId) =>\r\n        get().settings.categoryMappings.find(\r\n          (m) => m.hrmCategorySystemId === hrmCategoryId\r\n        ),\r\n        \r\n      getBrandMappingByHrmId: (hrmBrandId) =>\r\n        get().settings.brandMappings.find(\r\n          (m) => m.hrmBrandSystemId === hrmBrandId\r\n        ),\r\n        \r\n      getPkgxCatIdByHrmCategory: (hrmCategoryId) => {\r\n        const mapping = get().settings.categoryMappings.find(\r\n          (m) => m.hrmCategorySystemId === hrmCategoryId\r\n        );\r\n        return mapping?.pkgxCatId ?? null;\r\n      },\r\n      \r\n      getPkgxBrandIdByHrmBrand: (hrmBrandId) => {\r\n        const mapping = get().settings.brandMappings.find(\r\n          (m) => m.hrmBrandSystemId === hrmBrandId\r\n        );\r\n        return mapping?.pkgxBrandId ?? null;\r\n      },\r\n      \r\n      loadFromAPI: async () => {\r\n        if (get().initialized) return;\r\n        \r\n        try {\r\n          const response = await fetch('/api/settings/pkgx', {\r\n            credentials: 'include',\r\n          });\r\n          if (response.ok) {\r\n            const json = await response.json();\r\n            const data = json.data || json.settings;\r\n            if (data) {\r\n              set({ \r\n                settings: { \r\n                  ...DEFAULT_PKGX_SETTINGS, \r\n                  categories: PKGX_CATEGORIES,\r\n                  brands: PKGX_BRANDS,\r\n                  ...data \r\n                },\r\n                initialized: true \r\n              });\r\n            } else {\r\n              set({ initialized: true });\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('[PKGX Settings Store] loadFromAPI error:', error);\r\n        }\r\n      },\r\n    })\r\n);\r\n\r\n// ========================================\r\n// Selector Hooks\r\n// ========================================\r\n\r\nexport function usePkgxEnabled() {\r\n  return usePkgxSettingsStore((state) => state.settings.enabled);\r\n}\r\n\r\nexport function usePkgxApiConfig() {\r\n  return usePkgxSettingsStore((state) => ({\r\n    apiUrl: state.settings.apiUrl,\r\n    apiKey: state.settings.apiKey,\r\n    enabled: state.settings.enabled,\r\n  }));\r\n}\r\n\r\nexport function usePkgxCategories() {\r\n  return usePkgxSettingsStore((state) => state.settings.categories);\r\n}\r\n\r\nexport function usePkgxBrands() {\r\n  return usePkgxSettingsStore((state) => state.settings.brands);\r\n}\r\n\r\nexport function usePkgxPriceMapping() {\r\n  return usePkgxSettingsStore((state) => state.settings.priceMapping);\r\n}\r\n\r\nexport function usePkgxCategoryMappings() {\r\n  return usePkgxSettingsStore((state) => state.settings.categoryMappings);\r\n}\r\n\r\nexport function usePkgxBrandMappings() {\r\n  return usePkgxSettingsStore((state) => state.settings.brandMappings);\r\n}\r\n\r\nexport function usePkgxSyncSettings() {\r\n  return usePkgxSettingsStore((state) => state.settings.syncSettings);\r\n}\r\n\r\nexport function usePkgxSyncStatus() {\r\n  return usePkgxSettingsStore((state) => ({\r\n    lastSyncAt: state.settings.lastSyncAt,\r\n    lastSyncResult: state.settings.lastSyncResult,\r\n    connectionStatus: state.settings.connectionStatus,\r\n    connectionError: state.settings.connectionError,\r\n  }));\r\n}\r\n\r\nexport function usePkgxProducts() {\r\n  return usePkgxSettingsStore((state) => ({\r\n    products: state.settings.pkgxProducts,\r\n    lastFetch: state.settings.pkgxProductsLastFetch,\r\n  }));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3745, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/mobile/skeleton.tsx"],"sourcesContent":["import * as React from \"react\";\r\nimport { Card, CardContent } from \"../ui/card\";\r\nimport { cn } from \"../../lib/utils\";\r\n\r\ninterface SkeletonProps extends React.HTMLAttributes<HTMLDivElement> {\r\n  className?: string;\r\n}\r\n\r\n/**\r\n * Skeleton - Base skeleton loading component\r\n */\r\nexport function Skeleton({ className, ...props }: SkeletonProps) {\r\n  return (\r\n    <div\r\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\n/**\r\n * MobileCardSkeleton - Loading placeholder for mobile cards\r\n */\r\nexport function MobileCardSkeleton({ \r\n  count = 3,\r\n  className \r\n}: { \r\n  count?: number | undefined;\r\n  className?: string | undefined;\r\n}) {\r\n  return (\r\n    <>\r\n      {Array.from({ length: count }).map((_, i) => (\r\n        <Card key={i} className={cn(\"overflow-hidden\", className)}>\r\n          <CardContent className=\"p-4\">\r\n            <div className=\"flex items-start space-x-3\">\r\n              {/* Avatar skeleton */}\r\n              <Skeleton className=\"h-12 w-12 rounded-full flex-shrink-0\" />\r\n              \r\n              {/* Content skeleton */}\r\n              <div className=\"flex-1 space-y-2\">\r\n                <Skeleton className=\"h-4 w-3/4\" />\r\n                <Skeleton className=\"h-3 w-1/2\" />\r\n                <div className=\"space-y-1.5 pt-2\">\r\n                  <Skeleton className=\"h-3 w-full\" />\r\n                  <Skeleton className=\"h-3 w-2/3\" />\r\n                </div>\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Footer skeleton */}\r\n            <div className=\"flex items-center justify-between mt-3 pt-3 border-t border-border\">\r\n              <Skeleton className=\"h-5 w-20\" />\r\n              <Skeleton className=\"h-3 w-24\" />\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      ))}\r\n    </>\r\n  );\r\n}\r\n\r\n/**\r\n * TableSkeleton - Loading placeholder for tables\r\n */\r\nexport function TableSkeleton({ \r\n  rows = 5,\r\n  columns = 4 \r\n}: { \r\n  rows?: number;\r\n  columns?: number;\r\n}) {\r\n  return (\r\n    <div className=\"space-y-3\">\r\n      {Array.from({ length: rows }).map((_, rowIndex) => (\r\n        <div key={rowIndex} className=\"flex items-center space-x-4\">\r\n          {Array.from({ length: columns }).map((_, colIndex) => (\r\n            <div key={colIndex}>\r\n              <Skeleton \r\n                className={cn(\r\n                  \"h-9\",\r\n                  colIndex === 0 ? \"w-1/4\" : \"flex-1\"\r\n                )}\r\n              />\r\n            </div>\r\n          ))}\r\n        </div>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * CardGridSkeleton - Loading placeholder for card grids\r\n */\r\nexport function CardGridSkeleton({\r\n  count = 4,\r\n  columns = 4\r\n}: {\r\n  count?: number;\r\n  columns?: number;\r\n}) {\r\n  return (\r\n    <div className={`grid gap-4 grid-cols-1 md:grid-cols-2 lg:grid-cols-${columns}`}>\r\n      {Array.from({ length: count }).map((_, i) => (\r\n        <Card key={i}>\r\n          <CardContent className=\"p-6\">\r\n            <div className=\"flex items-start justify-between mb-2\">\r\n              <Skeleton className=\"h-5 w-5 rounded\" />\r\n              <Skeleton className=\"h-4 w-16\" />\r\n            </div>\r\n            <Skeleton className=\"h-8 w-24 mb-2\" />\r\n            <Skeleton className=\"h-3 w-full\" />\r\n          </CardContent>\r\n        </Card>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * FormSkeleton - Loading placeholder for forms\r\n */\r\nexport function FormSkeleton({ fields = 6 }: { fields?: number }) {\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {Array.from({ length: fields }).map((_, i) => (\r\n        <div key={i} className=\"space-y-2\">\r\n          <Skeleton className=\"h-4 w-32\" />\r\n          <Skeleton className=\"h-9 w-full\" />\r\n        </div>\r\n      ))}\r\n      <div className=\"flex justify-end space-x-2 pt-4\">\r\n        <Skeleton className=\"h-9 w-24\" />\r\n        <Skeleton className=\"h-9 w-24\" />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * ChartSkeleton - Loading placeholder for charts\r\n */\r\nexport function ChartSkeleton({ height = \"300px\" }: { height?: string }) {\r\n  return (\r\n    <div className=\"w-full\" style={{ height }}>\r\n      <div className=\"flex items-end justify-between h-full space-x-2 pb-4\">\r\n        {[40, 70, 55, 80, 60, 90, 45].map((h, i) => (\r\n          <div key={i} className=\"flex-1\" style={{ height: `${h}%` }}>\r\n            <Skeleton className=\"w-full h-full\" />\r\n          </div>\r\n        ))}\r\n      </div>\r\n      <div className=\"flex justify-between pt-2\">\r\n        {Array.from({ length: 7 }).map((_, i) => (\r\n          <div key={i}>\r\n            <Skeleton className=\"h-3 w-8\" />\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * PageSkeleton - Loading placeholder for full pages\r\n */\r\nexport function PageSkeleton() {\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Header */}\r\n      <div className=\"space-y-2\">\r\n        <Skeleton className=\"h-8 w-48\" />\r\n        <Skeleton className=\"h-4 w-96\" />\r\n      </div>\r\n      \r\n      {/* Actions */}\r\n      <div className=\"flex justify-between\">\r\n        <Skeleton className=\"h-9 w-64\" />\r\n        <Skeleton className=\"h-9 w-32\" />\r\n      </div>\r\n      \r\n      {/* Content */}\r\n      <CardGridSkeleton count={6} />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4193, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/mobile/touch-button.tsx"],"sourcesContent":["import * as React from \"react\";\r\nimport { Button } from \"../ui/button\";\r\nimport { cn } from \"../../lib/utils\";\r\nimport { cva, type VariantProps } from \"class-variance-authority\";\r\n\r\nconst touchButtonVariants = cva(\r\n  \"inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\r\n        destructive: \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\r\n        outline: \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\r\n        secondary: \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\r\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\r\n        link: \"text-primary underline-offset-4 hover:underline\",\r\n      },\r\n      size: {\r\n        default: \"h-12 px-4 py-2 min-w-touch\", // Mobile-first: 48px height\r\n        sm: \"h-9 rounded-md px-3 min-w-touch\",\r\n        lg: \"h-14 rounded-md px-8 min-w-touch-lg\", // 56px height for large touch\r\n        xl: \"h-16 rounded-md px-10 min-w-touch-lg\", // 64px height for extra large\r\n        icon: \"h-12 w-12\", // Square touch target\r\n        \"icon-sm\": \"h-9 w-10\",\r\n        \"icon-lg\": \"h-14 w-14\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  }\r\n);\r\n\r\nexport interface TouchButtonProps\r\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\r\n    VariantProps<typeof touchButtonVariants> {\r\n  asChild?: boolean;\r\n}\r\n\r\n/**\r\n * TouchButton - Mobile-optimized button with minimum 44px touch targets\r\n * Follows Apple HIG and Material Design guidelines for touch interfaces\r\n */\r\nconst TouchButton = React.forwardRef<HTMLButtonElement, TouchButtonProps>(\r\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\r\n    return (\r\n      <Button\r\n        className={cn(touchButtonVariants({ variant, size, className }))}\r\n        ref={ref}\r\n        {...props}\r\n      />\r\n    );\r\n  }\r\n);\r\nTouchButton.displayName = \"TouchButton\";\r\n\r\nexport { TouchButton, touchButtonVariants };\r\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;;;;;;AAEA,MAAM,sBAAsB,IAAA,0KAAG,EAC7B,0RACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aAAa;YACb,SAAS;YACT,WAAW;YACX,OAAO;YACP,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,IAAI;YACJ,MAAM;YACN,WAAW;YACX,WAAW;QACb;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AASF;;;CAGC,GACD,MAAM,4BAAc,2KAAgB,MAClC,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,KAAK,EAAE,GAAG,OAAO,EAAE;IACxD,qBACE,6LAAC,wIAAM;QACL,WAAW,IAAA,qHAAE,EAAC,oBAAoB;YAAE;YAAS;YAAM;QAAU;QAC7D,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;;AAEF,YAAY,WAAW,GAAG"}},
    {"offset": {"line": 4265, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/mobile/empty-state.tsx"],"sourcesContent":["import * as React from \"react\";\r\nimport { LucideIcon } from \"lucide-react\";\r\nimport { cn } from \"../../lib/utils\";\r\nimport { TouchButton } from \"./touch-button\";\r\n\r\ninterface EmptyStateProps {\r\n  icon?: LucideIcon | undefined;\r\n  title: string;\r\n  description?: string | undefined;\r\n  action?: React.ReactNode | undefined;\r\n  className?: string | undefined;\r\n  size?: \"sm\" | \"md\" | \"lg\" | undefined;\r\n}\r\n\r\n/**\r\n * EmptyState - Professional empty state component\r\n * Use cases:\r\n * - No search results\r\n * - Empty lists\r\n * - No data to display\r\n * - First-time user experience\r\n */\r\nexport function EmptyState({\r\n  icon: Icon,\r\n  title,\r\n  description,\r\n  action,\r\n  className,\r\n  size = \"md\",\r\n}: EmptyStateProps) {\r\n  const sizeClasses = {\r\n    sm: {\r\n      container: \"py-8\",\r\n      icon: \"h-12 w-12 mb-3\",\r\n      title: \"text-base\",\r\n      description: \"text-sm\",\r\n    },\r\n    md: {\r\n      container: \"py-12\",\r\n      icon: \"h-16 w-16 mb-4\",\r\n      title: \"text-lg\",\r\n      description: \"text-sm\",\r\n    },\r\n    lg: {\r\n      container: \"py-16\",\r\n      icon: \"h-20 w-20 mb-6\",\r\n      title: \"text-xl\",\r\n      description: \"text-base\",\r\n    },\r\n  };\r\n\r\n  const classes = sizeClasses[size];\r\n\r\n  return (\r\n    <div\r\n      className={cn(\r\n        \"flex flex-col items-center justify-center px-4 text-center\",\r\n        classes.container,\r\n        className\r\n      )}\r\n    >\r\n      {Icon && (\r\n        <Icon\r\n          className={cn(\r\n            \"text-muted-foreground\",\r\n            classes.icon\r\n          )}\r\n          strokeWidth={1.5}\r\n        />\r\n      )}\r\n      \r\n      <h3 className={cn(\"font-semibold mb-2\", classes.title)}>\r\n        {title}\r\n      </h3>\r\n      \r\n      {description && (\r\n        <p\r\n          className={cn(\r\n            \"text-muted-foreground mb-6 max-w-sm\",\r\n            classes.description\r\n          )}\r\n        >\r\n          {description}\r\n        </p>\r\n      )}\r\n      \r\n      {action && <div className=\"mt-2\">{action}</div>}\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * SearchEmptyState - Specialized empty state for search results\r\n */\r\nexport function SearchEmptyState({\r\n  searchQuery,\r\n  onClear,\r\n}: {\r\n  searchQuery: string;\r\n  onClear?: () => void;\r\n}) {\r\n  return (\r\n    <EmptyState\r\n      title=\"Không tìm thấy kết quả\"\r\n      description={`Không có kết quả nào phù hợp với \"${searchQuery}\". Thử tìm kiếm với từ khóa khác.`}\r\n      action={\r\n        onClear && (\r\n          <TouchButton variant=\"outline\" onClick={onClear}>\r\n            Xóa bộ lọc\r\n          </TouchButton>\r\n        )\r\n      }\r\n    />\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;;;;AAmBO,SAAS,WAAW,EACzB,MAAM,IAAI,EACV,KAAK,EACL,WAAW,EACX,MAAM,EACN,SAAS,EACT,OAAO,IAAI,EACK;IAChB,MAAM,cAAc;QAClB,IAAI;YACF,WAAW;YACX,MAAM;YACN,OAAO;YACP,aAAa;QACf;QACA,IAAI;YACF,WAAW;YACX,MAAM;YACN,OAAO;YACP,aAAa;QACf;QACA,IAAI;YACF,WAAW;YACX,MAAM;YACN,OAAO;YACP,aAAa;QACf;IACF;IAEA,MAAM,UAAU,WAAW,CAAC,KAAK;IAEjC,qBACE,6LAAC;QACC,WAAW,IAAA,qHAAE,EACX,8DACA,QAAQ,SAAS,EACjB;;YAGD,sBACC,6LAAC;gBACC,WAAW,IAAA,qHAAE,EACX,yBACA,QAAQ,IAAI;gBAEd,aAAa;;;;;;0BAIjB,6LAAC;gBAAG,WAAW,IAAA,qHAAE,EAAC,sBAAsB,QAAQ,KAAK;0BAClD;;;;;;YAGF,6BACC,6LAAC;gBACC,WAAW,IAAA,qHAAE,EACX,uCACA,QAAQ,WAAW;0BAGpB;;;;;;YAIJ,wBAAU,6LAAC;gBAAI,WAAU;0BAAQ;;;;;;;;;;;;AAGxC;KAnEgB;AAwET,SAAS,iBAAiB,EAC/B,WAAW,EACX,OAAO,EAIR;IACC,qBACE,6LAAC;QACC,OAAM;QACN,aAAa,CAAC,kCAAkC,EAAE,YAAY,iCAAiC,CAAC;QAChG,QACE,yBACE,6LAAC,0JAAW;YAAC,SAAQ;YAAU,SAAS;sBAAS;;;;;;;;;;;AAO3D;MApBgB"}},
    {"offset": {"line": 4372, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/table.tsx"],"sourcesContent":["import * as React from \"react\"\r\n\r\nimport { cn } from \"../../lib/utils\"\r\n\r\nconst Table = React.forwardRef<\r\n  HTMLTableElement,\r\n  React.HTMLAttributes<HTMLTableElement>\r\n>(({ className, ...props }, ref) => (\r\n    <table\r\n      ref={ref}\r\n      className={cn(\"w-full caption-bottom text-sm\", className)}\r\n      {...props}\r\n    />\r\n))\r\nTable.displayName = \"Table\"\r\n\r\nconst TableHeader = React.forwardRef<\r\n  HTMLTableSectionElement,\r\n  React.HTMLAttributes<HTMLTableSectionElement>\r\n>(({ className, ...props }, ref) => (\r\n  <thead ref={ref} className={cn(\"[&_tr]:border-b [&_tr]:border-border\", className)} {...props} />\r\n))\r\nTableHeader.displayName = \"TableHeader\"\r\n\r\nconst TableBody = React.forwardRef<\r\n  HTMLTableSectionElement,\r\n  React.HTMLAttributes<HTMLTableSectionElement>\r\n>(({ className, ...props }, ref) => (\r\n  <tbody\r\n    ref={ref}\r\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\r\n    {...props}\r\n  />\r\n))\r\nTableBody.displayName = \"TableBody\"\r\n\r\nconst TableFooter = React.forwardRef<\r\n  HTMLTableSectionElement,\r\n  React.HTMLAttributes<HTMLTableSectionElement>\r\n>(({ className, ...props }, ref) => (\r\n  <tfoot\r\n    ref={ref}\r\n    className={cn(\r\n      \"border-t border-border bg-muted/50 font-medium [&>tr]:last:border-b-0\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTableFooter.displayName = \"TableFooter\"\r\n\r\nconst TableRow = React.forwardRef<\r\n  HTMLTableRowElement,\r\n  React.HTMLAttributes<HTMLTableRowElement>\r\n>(({ className, ...props }, ref) => (\r\n  <tr\r\n    ref={ref}\r\n    className={cn(\r\n      \"group border-b border-border transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTableRow.displayName = \"TableRow\"\r\n\r\nconst TableHead = React.forwardRef<\r\n  HTMLTableCellElement,\r\n  React.ThHTMLAttributes<HTMLTableCellElement>\r\n>(({ className, ...props }, ref) => (\r\n  <th\r\n    ref={ref}\r\n    className={cn(\r\n      \"h-9 px-4 text-left align-middle font-medium text-foreground [&:has([role=checkbox])]:px-3 [&:has([role=checkbox])]:w-12 [&:has([role=checkbox])]:text-center whitespace-nowrap\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTableHead.displayName = \"TableHead\"\r\n\r\nconst TableCell = React.forwardRef<\r\n  HTMLTableCellElement,\r\n  React.TdHTMLAttributes<HTMLTableCellElement>\r\n>(({ className, ...props }, ref) => (\r\n  <td\r\n    ref={ref}\r\n    className={cn(\r\n      \"px-4 py-1 align-middle whitespace-nowrap [&:has([role=checkbox])]:px-3 [&:has([role=checkbox])]:w-12 [&:has([role=checkbox])]:text-center\", \r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nTableCell.displayName = \"TableCell\"\r\n\r\nconst TableCaption = React.forwardRef<\r\n  HTMLTableCaptionElement,\r\n  React.HTMLAttributes<HTMLTableCaptionElement>\r\n>(({ className, ...props }, ref) => (\r\n  <caption\r\n    ref={ref}\r\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\r\n    {...props}\r\n  />\r\n))\r\nTableCaption.displayName = \"TableCaption\"\r\n\r\nexport {\r\n  Table,\r\n  TableHeader,\r\n  TableBody,\r\n  TableFooter,\r\n  TableHead,\r\n  TableRow,\r\n  TableCell,\r\n  TableCaption,\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA;AAEA;;;;AAEA,MAAM,sBAAQ,2KAAgB,MAG5B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBACxB,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;AAGf,MAAM,WAAW,GAAG;AAEpB,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QAAM,KAAK;QAAK,WAAW,IAAA,qHAAE,EAAC,wCAAwC;QAAa,GAAG,KAAK;;;;;;;AAE9F,YAAY,WAAW,GAAG;AAE1B,MAAM,0BAAY,2KAAgB,OAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,yEACA;QAED,GAAG,KAAK;;;;;;;AAGb,YAAY,WAAW,GAAG;AAE1B,MAAM,yBAAW,2KAAgB,OAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,mGACA;QAED,GAAG,KAAK;;;;;;;AAGb,SAAS,WAAW,GAAG;AAEvB,MAAM,0BAAY,2KAAgB,QAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,kLACA;QAED,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,0BAAY,2KAAgB,QAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,6IACA;QAED,GAAG,KAAK;;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,6BAAe,2KAAgB,QAGnC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,sCAAsC;QACnD,GAAG,KAAK;;;;;;;AAGb,aAAa,WAAW,GAAG"}},
    {"offset": {"line": 4509, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/select.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\r\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\r\n\r\nimport { cn } from \"../../lib/utils\"\r\nimport { useModal } from \"../../contexts/modal-context\"\r\n\r\ntype BaseSelectProps = React.ComponentPropsWithoutRef<typeof SelectPrimitive.Root>\r\n\r\ntype SelectProps = Omit<BaseSelectProps, \"value\" | \"defaultValue\"> & {\r\n  value?: string | undefined\r\n  defaultValue?: string | undefined\r\n}\r\n\r\nconst Select = ({ value, defaultValue, ...props }: SelectProps) => {\r\n  const controlledProps: Partial<BaseSelectProps> = {}\r\n\r\n  if (value !== undefined) {\r\n    controlledProps.value = value\r\n  }\r\n\r\n  if (defaultValue !== undefined) {\r\n    controlledProps.defaultValue = defaultValue\r\n  }\r\n\r\n  return <SelectPrimitive.Root {...props} {...controlledProps} />\r\n}\r\nSelect.displayName = SelectPrimitive.Root.displayName\r\n\r\nconst SelectGroup = SelectPrimitive.Group\r\n\r\nconst SelectValue = SelectPrimitive.Value\r\n\r\nconst SelectTrigger = React.forwardRef<\r\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\r\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\r\n>(({ className, children, ...props }, ref) => (\r\n  <SelectPrimitive.Trigger\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    {children}\r\n    <SelectPrimitive.Icon asChild>\r\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\r\n    </SelectPrimitive.Icon>\r\n  </SelectPrimitive.Trigger>\r\n))\r\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\r\n\r\nconst SelectScrollUpButton = React.forwardRef<\r\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\r\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\r\n>(({ className, ...props }, ref) => (\r\n  <SelectPrimitive.ScrollUpButton\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex cursor-default items-center justify-center py-1\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    <ChevronUp className=\"h-4 w-4\" />\r\n  </SelectPrimitive.ScrollUpButton>\r\n))\r\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\r\n\r\nconst SelectScrollDownButton = React.forwardRef<\r\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\r\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\r\n>(({ className, ...props }, ref) => (\r\n  <SelectPrimitive.ScrollDownButton\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex cursor-default items-center justify-center py-1\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    <ChevronDown className=\"h-4 w-4\" />\r\n  </SelectPrimitive.ScrollDownButton>\r\n))\r\nSelectScrollDownButton.displayName =\r\n  SelectPrimitive.ScrollDownButton.displayName\r\n\r\nconst SelectContent = React.forwardRef<\r\n  React.ElementRef<typeof SelectPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\r\n>(({ className, children, position = \"popper\", ...props }, ref) => {\r\n  const modalId = React.useId();\r\n  const [isOpen, setIsOpen] = React.useState(false);\r\n  const { zIndex } = useModal(modalId, isOpen, 'select');\r\n\r\n  React.useEffect(() => {\r\n    const content = ref && 'current' in ref ? ref.current : null;\r\n    if (!content) return;\r\n\r\n    const observer = new MutationObserver((mutations) => {\r\n      mutations.forEach((mutation) => {\r\n        if (mutation.type === 'attributes' && mutation.attributeName === 'data-state') {\r\n          const target = mutation.target as HTMLElement;\r\n          const state = target.getAttribute('data-state');\r\n          setIsOpen(state === 'open');\r\n        }\r\n      });\r\n    });\r\n\r\n    observer.observe(content, { attributes: true, attributeFilter: ['data-state'] });\r\n\r\n    return () => observer.disconnect();\r\n  }, [ref]);\r\n\r\n  return (\r\n    <SelectPrimitive.Portal>\r\n      <SelectPrimitive.Content\r\n        ref={ref}\r\n        className={cn(\r\n          \"relative max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border border-border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\r\n          position === \"popper\" &&\r\n            \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\r\n          className\r\n        )}\r\n        style={{ zIndex }}\r\n        position={position}\r\n        {...props}\r\n      >\r\n        <SelectScrollUpButton />\r\n        <SelectPrimitive.Viewport\r\n          className={cn(\r\n            \"p-1\",\r\n            position === \"popper\" &&\r\n              \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\r\n          )}\r\n        >\r\n          {children}\r\n        </SelectPrimitive.Viewport>\r\n        <SelectScrollDownButton />\r\n      </SelectPrimitive.Content>\r\n    </SelectPrimitive.Portal>\r\n  );\r\n})\r\nSelectContent.displayName = SelectPrimitive.Content.displayName\r\n\r\nconst SelectLabel = React.forwardRef<\r\n  React.ElementRef<typeof SelectPrimitive.Label>,\r\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\r\n>(({ className, ...props }, ref) => (\r\n  <SelectPrimitive.Label\r\n    ref={ref}\r\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\r\n    {...props}\r\n  />\r\n))\r\nSelectLabel.displayName = SelectPrimitive.Label.displayName\r\n\r\nconst SelectItem = React.forwardRef<\r\n  React.ElementRef<typeof SelectPrimitive.Item>,\r\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\r\n>(({ className, children, ...props }, ref) => (\r\n  <SelectPrimitive.Item\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\r\n      <SelectPrimitive.ItemIndicator>\r\n        <Check className=\"h-4 w-4\" />\r\n      </SelectPrimitive.ItemIndicator>\r\n    </span>\r\n\r\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\r\n  </SelectPrimitive.Item>\r\n))\r\nSelectItem.displayName = SelectPrimitive.Item.displayName\r\n\r\nconst SelectSeparator = React.forwardRef<\r\n  React.ElementRef<typeof SelectPrimitive.Separator>,\r\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\r\n>(({ className, ...props }, ref) => (\r\n  <SelectPrimitive.Separator\r\n    ref={ref}\r\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\r\n    {...props}\r\n  />\r\n))\r\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\r\n\r\nexport {\r\n  Select,\r\n  SelectGroup,\r\n  SelectValue,\r\n  SelectTrigger,\r\n  SelectContent,\r\n  SelectLabel,\r\n  SelectItem,\r\n  SelectSeparator,\r\n  SelectScrollUpButton,\r\n  SelectScrollDownButton,\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4800, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/data-table/data-table-pagination.tsx"],"sourcesContent":["import * as React from \"react\";\r\nimport {\r\n  ChevronLeft,\r\n  ChevronRight,\r\n  ChevronsLeft,\r\n  ChevronsRight,\r\n} from \"lucide-react\"\r\n\r\nimport { Button } from \"../ui/button\"\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"../ui/select\"\r\n\r\ninterface DataTablePaginationProps {\r\n  pageIndex: number;\r\n  pageSize: number;\r\n  pageCount: number;\r\n  rowCount: number;\r\n  selectedRowCount: number;\r\n  setPageIndex: (index: number) => void;\r\n  setPageSize: (size: number) => void;\r\n  canPreviousPage: boolean;\r\n  canNextPage: boolean;\r\n}\r\n\r\nexport function DataTablePagination({\r\n  pageIndex,\r\n  pageSize,\r\n  pageCount,\r\n  rowCount,\r\n  selectedRowCount,\r\n  setPageIndex,\r\n  setPageSize,\r\n  canPreviousPage,\r\n  canNextPage,\r\n}: DataTablePaginationProps) {\r\n  // Generate page numbers to display\r\n  const getPageNumbers = () => {\r\n    const pages: (number | 'ellipsis')[] = [];\r\n    const showEllipsis = pageCount > 7;\r\n    \r\n    if (!showEllipsis) {\r\n      // Show all pages if 7 or fewer\r\n      for (let i = 0; i < pageCount; i++) {\r\n        pages.push(i);\r\n      }\r\n    } else {\r\n      // Always show first page\r\n      pages.push(0);\r\n      \r\n      if (pageIndex <= 3) {\r\n        // Near start: 1 2 3 4 5 ... last\r\n        for (let i = 1; i < 5; i++) {\r\n          pages.push(i);\r\n        }\r\n        pages.push('ellipsis');\r\n        pages.push(pageCount - 1);\r\n      } else if (pageIndex >= pageCount - 4) {\r\n        // Near end: 1 ... N-4 N-3 N-2 N-1 N\r\n        pages.push('ellipsis');\r\n        for (let i = pageCount - 5; i < pageCount; i++) {\r\n          pages.push(i);\r\n        }\r\n      } else {\r\n        // Middle: 1 ... current-1 current current+1 ... last\r\n        pages.push('ellipsis');\r\n        pages.push(pageIndex - 1);\r\n        pages.push(pageIndex);\r\n        pages.push(pageIndex + 1);\r\n        pages.push('ellipsis');\r\n        pages.push(pageCount - 1);\r\n      }\r\n    }\r\n    \r\n    return pages;\r\n  };\r\n  \r\n  const pageNumbers = getPageNumbers();\r\n  \r\n  return (\r\n    <div className=\"flex items-center justify-between px-2\">\r\n      <div className=\"flex-1 text-sm text-muted-foreground\">\r\n        {selectedRowCount} của{\" \"}\r\n        {rowCount} dòng được chọn.\r\n      </div>\r\n      <div className=\"flex items-center space-x-6 lg:space-x-8\">\r\n        <div className=\"flex items-center space-x-2\">\r\n          <p className=\"text-sm font-medium\">Số dòng mỗi trang</p>\r\n          <Select\r\n            value={`${pageSize}`}\r\n            onValueChange={(value) => {\r\n              setPageSize(Number(value))\r\n            }}\r\n          >\r\n            <SelectTrigger className=\"w-[70px]\">\r\n              <SelectValue placeholder={`${pageSize}`} />\r\n            </SelectTrigger>\r\n            <SelectContent>\r\n              {[10, 20, 30, 40, 50].map((size) => (\r\n                <SelectItem key={size} value={`${size}`}>\r\n                  {size}\r\n                </SelectItem>\r\n              ))}\r\n            </SelectContent>\r\n          </Select>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center space-x-1\">\r\n          <Button\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            className=\"px-3\"\r\n            onClick={() => setPageIndex(pageIndex - 1)}\r\n            disabled={!canPreviousPage}\r\n          >\r\n            Previous\r\n          </Button>\r\n          \r\n          {pageNumbers.map((page, idx) => {\r\n            if (page === 'ellipsis') {\r\n              return (\r\n                <span key={`ellipsis-${idx}`} className=\"px-2 text-muted-foreground\">\r\n                  ...\r\n                </span>\r\n              );\r\n            }\r\n            \r\n            return (\r\n              <Button\r\n                key={page}\r\n                variant={pageIndex === page ? \"default\" : \"outline\"}\r\n                size=\"sm\"\r\n                className=\"w-9 p-0\"\r\n                onClick={() => setPageIndex(page)}\r\n              >\r\n                {page + 1}\r\n              </Button>\r\n            );\r\n          })}\r\n          \r\n          <Button\r\n            variant=\"outline\"\r\n            size=\"sm\"\r\n            className=\"px-3\"\r\n            onClick={() => setPageIndex(pageIndex + 1)}\r\n            disabled={!canNextPage}\r\n          >\r\n            Next\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;;AAQA;AACA;;;;AAoBO,SAAS,oBAAoB,EAClC,SAAS,EACT,QAAQ,EACR,SAAS,EACT,QAAQ,EACR,gBAAgB,EAChB,YAAY,EACZ,WAAW,EACX,eAAe,EACf,WAAW,EACc;IACzB,mCAAmC;IACnC,MAAM,iBAAiB;QACrB,MAAM,QAAiC,EAAE;QACzC,MAAM,eAAe,YAAY;QAEjC,IAAI,CAAC,cAAc;YACjB,+BAA+B;YAC/B,IAAK,IAAI,IAAI,GAAG,IAAI,WAAW,IAAK;gBAClC,MAAM,IAAI,CAAC;YACb;QACF,OAAO;YACL,yBAAyB;YACzB,MAAM,IAAI,CAAC;YAEX,IAAI,aAAa,GAAG;gBAClB,iCAAiC;gBACjC,IAAK,IAAI,IAAI,GAAG,IAAI,GAAG,IAAK;oBAC1B,MAAM,IAAI,CAAC;gBACb;gBACA,MAAM,IAAI,CAAC;gBACX,MAAM,IAAI,CAAC,YAAY;YACzB,OAAO,IAAI,aAAa,YAAY,GAAG;gBACrC,oCAAoC;gBACpC,MAAM,IAAI,CAAC;gBACX,IAAK,IAAI,IAAI,YAAY,GAAG,IAAI,WAAW,IAAK;oBAC9C,MAAM,IAAI,CAAC;gBACb;YACF,OAAO;gBACL,qDAAqD;gBACrD,MAAM,IAAI,CAAC;gBACX,MAAM,IAAI,CAAC,YAAY;gBACvB,MAAM,IAAI,CAAC;gBACX,MAAM,IAAI,CAAC,YAAY;gBACvB,MAAM,IAAI,CAAC;gBACX,MAAM,IAAI,CAAC,YAAY;YACzB;QACF;QAEA,OAAO;IACT;IAEA,MAAM,cAAc;IAEpB,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,WAAU;;oBACZ;oBAAiB;oBAAK;oBACtB;oBAAS;;;;;;;0BAEZ,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAE,WAAU;0CAAsB;;;;;;0CACnC,6LAAC,wIAAM;gCACL,OAAO,GAAG,UAAU;gCACpB,eAAe,CAAC;oCACd,YAAY,OAAO;gCACrB;;kDAEA,6LAAC,+IAAa;wCAAC,WAAU;kDACvB,cAAA,6LAAC,6IAAW;4CAAC,aAAa,GAAG,UAAU;;;;;;;;;;;kDAEzC,6LAAC,+IAAa;kDACX;4CAAC;4CAAI;4CAAI;4CAAI;4CAAI;yCAAG,CAAC,GAAG,CAAC,CAAC,qBACzB,6LAAC,4IAAU;gDAAY,OAAO,GAAG,MAAM;0DACpC;+CADc;;;;;;;;;;;;;;;;;;;;;;kCAQzB,6LAAC;wBAAI,WAAU;;0CACb,6LAAC,wIAAM;gCACL,SAAQ;gCACR,MAAK;gCACL,WAAU;gCACV,SAAS,IAAM,aAAa,YAAY;gCACxC,UAAU,CAAC;0CACZ;;;;;;4BAIA,YAAY,GAAG,CAAC,CAAC,MAAM;gCACtB,IAAI,SAAS,YAAY;oCACvB,qBACE,6LAAC;wCAA6B,WAAU;kDAA6B;uCAA1D,CAAC,SAAS,EAAE,KAAK;;;;;gCAIhC;gCAEA,qBACE,6LAAC,wIAAM;oCAEL,SAAS,cAAc,OAAO,YAAY;oCAC1C,MAAK;oCACL,WAAU;oCACV,SAAS,IAAM,aAAa;8CAE3B,OAAO;mCANH;;;;;4BASX;0CAEA,6LAAC,wIAAM;gCACL,SAAQ;gCACR,MAAK;gCACL,WAAU;gCACV,SAAS,IAAM,aAAa,YAAY;gCACxC,UAAU,CAAC;0CACZ;;;;;;;;;;;;;;;;;;;;;;;;AAOX;KAhIgB"}},
    {"offset": {"line": 5011, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/data-table/sticky-scrollbar.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { cn } from '../../lib/utils';\r\n\r\ninterface StickyScrollbarProps {\r\n  /** Ref to the scrollable element (table container) */\r\n  targetRef: React.RefObject<HTMLDivElement | null>;\r\n  /** Additional CSS classes */\r\n  className?: string | undefined;\r\n}\r\n\r\n/**\r\n * Sticky Horizontal Scrollbar Component\r\n * \r\n * Creates a sticky scrollbar at the bottom of the viewport that syncs with\r\n * the table's horizontal scroll. This allows users to scroll horizontally\r\n * without having to scroll to the bottom of the table first.\r\n */\r\nexport function StickyScrollbar({ targetRef, className }: StickyScrollbarProps) {\r\n  const scrollbarRef = React.useRef<HTMLDivElement>(null);\r\n  const [isVisible, setIsVisible] = React.useState(false);\r\n  const [scrollbarStyle, setScrollbarStyle] = React.useState<React.CSSProperties>({});\r\n  const [isMounted, setIsMounted] = React.useState(false);\r\n  const [updateTrigger, setUpdateTrigger] = React.useState(0); // ✅ Force update trigger\r\n\r\n  // Force re-render after mount to ensure refs are available\r\n  React.useEffect(() => {\r\n    setIsMounted(true);\r\n  }, []);\r\n\r\n  // ✅ Force update when target element changes size (e.g., columns added/removed)\r\n  React.useEffect(() => {\r\n    if (!isMounted || !targetRef.current) return;\r\n    \r\n    const targetElement = targetRef.current;\r\n    \r\n    // Watch for changes to table width/scrollWidth\r\n    const mutationObserver = new MutationObserver(() => {\r\n      setUpdateTrigger(prev => prev + 1);\r\n    });\r\n    \r\n    mutationObserver.observe(targetElement, {\r\n      attributes: true,\r\n      childList: true,\r\n      subtree: true,\r\n    });\r\n    \r\n    return () => {\r\n      mutationObserver.disconnect();\r\n    };\r\n  }, [targetRef, isMounted]);\r\n\r\n  React.useEffect(() => {\r\n    if (!isMounted) return;\r\n    \r\n    const targetElement = targetRef.current;\r\n    const scrollbarElement = scrollbarRef.current;\r\n    \r\n    if (!targetElement || !scrollbarElement) return;\r\n\r\n    let animationFrameId: number;\r\n\r\n    // Check if horizontal scrollbar is needed and update position\r\n    const updateScrollbar = () => {\r\n      const hasHorizontalScroll = targetElement.scrollWidth > targetElement.clientWidth;\r\n      setIsVisible(hasHorizontalScroll);\r\n      \r\n      if (hasHorizontalScroll) {\r\n        // Get the bounding rect to position the scrollbar correctly\r\n        const rect = targetElement.getBoundingClientRect();\r\n        \r\n        // Set the scrollbar position and width to match the table VIEWPORT\r\n        setScrollbarStyle({\r\n          left: `${rect.left}px`,\r\n          width: `${rect.width}px`,\r\n        });\r\n        \r\n        // ✅ FIX: Set the inner content width to match table's FULL scroll width\r\n        // This allows the scrollbar to scroll the full distance\r\n        const scrollContent = scrollbarElement.firstElementChild as HTMLDivElement;\r\n        if (scrollContent) {\r\n          scrollContent.style.width = `${targetElement.scrollWidth}px`;\r\n          scrollContent.style.height = '1px'; // Ensure height for scrollbar\r\n        }\r\n      }\r\n    };\r\n\r\n    // Sync scroll position: sticky scrollbar -> table\r\n    const handleStickyScroll = () => {\r\n      cancelAnimationFrame(animationFrameId);\r\n      animationFrameId = requestAnimationFrame(() => {\r\n        if (targetElement.scrollLeft !== scrollbarElement.scrollLeft) {\r\n          targetElement.scrollLeft = scrollbarElement.scrollLeft;\r\n        }\r\n      });\r\n    };\r\n\r\n    // Sync scroll position: table -> sticky scrollbar\r\n    const handleTableScroll = () => {\r\n      cancelAnimationFrame(animationFrameId);\r\n      animationFrameId = requestAnimationFrame(() => {\r\n        if (scrollbarElement.scrollLeft !== targetElement.scrollLeft) {\r\n          scrollbarElement.scrollLeft = targetElement.scrollLeft;\r\n        }\r\n      });\r\n    };\r\n\r\n    // Initial update\r\n    updateScrollbar();\r\n\r\n    // Add event listeners\r\n    scrollbarElement.addEventListener('scroll', handleStickyScroll, { passive: true });\r\n    targetElement.addEventListener('scroll', handleTableScroll, { passive: true });\r\n    window.addEventListener('resize', updateScrollbar, { passive: true });\r\n\r\n    // Re-check on content changes\r\n    const resizeObserver = new ResizeObserver(updateScrollbar);\r\n    resizeObserver.observe(targetElement);\r\n\r\n    return () => {\r\n      cancelAnimationFrame(animationFrameId);\r\n      scrollbarElement.removeEventListener('scroll', handleStickyScroll);\r\n      targetElement.removeEventListener('scroll', handleTableScroll);\r\n      window.removeEventListener('resize', updateScrollbar);\r\n      resizeObserver.disconnect();\r\n    };\r\n  }, [targetRef, isMounted, updateTrigger]); // ✅ Re-run when updateTrigger changes\r\n\r\n  // Always render but conditionally show with visibility\r\n  return (\r\n    <div\r\n      ref={scrollbarRef}\r\n      className={cn(\r\n        \"fixed bottom-0 z-[100] overflow-x-auto overflow-y-hidden\",\r\n        \"h-3 bg-muted/90 backdrop-blur-sm border-t border-border shadow-[0_-2px_12px_rgba(0,0,0,0.08)]\",\r\n        \"transition-opacity duration-200\",\r\n        isVisible ? \"opacity-100\" : \"opacity-0 pointer-events-none\",\r\n        className\r\n      )}\r\n      style={scrollbarStyle}\r\n    >\r\n      {/* Invisible content div to create scrollbar width */}\r\n      <div className=\"h-px pointer-events-none\" />\r\n    </div>\r\n  );\r\n}\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5178, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/data-table/responsive-data-table.tsx"],"sourcesContent":["import * as React from \"react\";\r\nimport { Trash2, ChevronDown, ChevronsRight } from \"lucide-react\";\r\nimport { useBreakpoint } from \"../../contexts/breakpoint-context\";\r\nimport { Card, CardContent } from \"../ui/card\";\r\nimport { MobileCardSkeleton } from \"../mobile/skeleton\";\r\nimport { EmptyState } from \"../mobile/empty-state\";\r\nimport { TouchButton } from \"../mobile/touch-button\";\r\nimport { cn } from \"../../lib/utils\";\r\nimport {\r\n  Table,\r\n  TableBody,\r\n  TableCell,\r\n  TableHead,\r\n  TableHeader,\r\n  TableRow,\r\n} from \"../ui/table\";\r\nimport { DataTablePagination } from \"./data-table-pagination\";\r\nimport { Button } from \"../ui/button\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuTrigger,\r\n} from \"../ui/dropdown-menu\";\r\nimport { StickyScrollbar } from \"./sticky-scrollbar\";\r\nimport type { ColumnDef } from './types';\r\n\r\nexport interface BulkAction<TData> {\r\n  label: string;\r\n  icon?: React.ComponentType<{ className?: string }>;\r\n  onSelect: (selectedRows: TData[]) => void;\r\n}\r\n\r\ninterface DesktopDataTableProps<TData extends { systemId: string }> {\r\n  columns: ColumnDef<TData>[];\r\n  data: TData[];\r\n  pageCount: number;\r\n  pagination: { pageIndex: number; pageSize: number };\r\n  setPagination: (updater: React.SetStateAction<{ pageIndex: number; pageSize: number }>) => void;\r\n  rowCount: number;\r\n  rowSelection: Record<string, boolean>;\r\n  setRowSelection: (updater: React.SetStateAction<Record<string, boolean>>) => void;\r\n  onBulkDelete?: (() => void) | undefined;\r\n  showBulkDeleteButton?: boolean | undefined;\r\n  bulkActions?: BulkAction<TData>[] | undefined;\r\n  pkgxBulkActions?: BulkAction<TData>[] | undefined;\r\n  bulkActionButtons?: React.ReactNode | undefined;\r\n  allSelectedRows: TData[];\r\n  renderSubComponent?: ((row: TData) => React.ReactNode) | undefined;\r\n  expanded: Record<string, boolean>;\r\n  setExpanded: (updater: React.SetStateAction<Record<string, boolean>>) => void;\r\n  sorting: { id: string; desc: boolean };\r\n  setSorting: (updater: React.SetStateAction<{ id: string; desc: boolean }>) => void;\r\n  columnVisibility: Record<string, boolean>;\r\n  setColumnVisibility: React.Dispatch<React.SetStateAction<Record<string, boolean>>>;\r\n  columnOrder: string[];\r\n  setColumnOrder: React.Dispatch<React.SetStateAction<string[]>>;\r\n  pinnedColumns: string[];\r\n  setPinnedColumns: React.Dispatch<React.SetStateAction<string[]>>;\r\n  onRowClick?: ((row: TData) => void) | undefined;\r\n  getRowStyle?: ((row: TData) => React.CSSProperties) | undefined;\r\n  className?: string | undefined;\r\n}\r\n\r\ninterface ResponsiveDataTableProps<TData extends { systemId: string }> {\r\n  // Required props\r\n  columns: ColumnDef<TData>[];\r\n  data: TData[];\r\n  \r\n  // Mobile-specific\r\n  renderMobileCard?: ((row: TData, index: number) => React.ReactNode) | undefined;\r\n  mobileCardClassName?: string | undefined;\r\n  autoGenerateMobileCards?: boolean | undefined;\r\n  mobileVirtualized?: boolean | undefined;\r\n  mobileRowHeight?: number | undefined;\r\n  mobileListHeight?: number | undefined;\r\n  \r\n  // States\r\n  isLoading?: boolean | undefined;\r\n  emptyTitle?: string | undefined;\r\n  emptyDescription?: string | undefined;\r\n  emptyAction?: React.ReactNode | undefined;\r\n  \r\n  // Desktop DataTable props\r\n  pageCount: number;\r\n  pagination: { pageIndex: number; pageSize: number };\r\n  setPagination: (updater: React.SetStateAction<{ pageIndex: number; pageSize: number }>) => void;\r\n  rowCount: number;\r\n  rowSelection?: Record<string, boolean> | undefined;\r\n  setRowSelection?: ((updater: React.SetStateAction<Record<string, boolean>>) => void) | undefined;\r\n  onBulkDelete?: (() => void) | undefined;\r\n  showBulkDeleteButton?: boolean | undefined;\r\n  bulkActions?: BulkAction<TData>[] | undefined;\r\n  pkgxBulkActions?: BulkAction<TData>[] | undefined;\r\n  bulkActionButtons?: React.ReactNode | undefined;\r\n  allSelectedRows?: TData[] | undefined;\r\n  renderSubComponent?: ((row: TData) => React.ReactNode) | undefined;\r\n  expanded?: Record<string, boolean> | undefined;\r\n  setExpanded?: ((updater: React.SetStateAction<Record<string, boolean>>) => void) | undefined;\r\n  sorting: { id: string; desc: boolean };\r\n  setSorting: (updater: React.SetStateAction<{ id: string; desc: boolean }>) => void;\r\n  columnVisibility?: Record<string, boolean> | undefined;\r\n  setColumnVisibility?: React.Dispatch<React.SetStateAction<Record<string, boolean>>> | undefined;\r\n  columnOrder?: string[] | undefined;\r\n  setColumnOrder?: React.Dispatch<React.SetStateAction<string[]>> | undefined;\r\n  pinnedColumns?: string[] | undefined;\r\n  setPinnedColumns?: React.Dispatch<React.SetStateAction<string[]>> | undefined;\r\n  onRowClick?: ((row: TData) => void) | undefined;\r\n  getRowStyle?: ((row: TData) => React.CSSProperties) | undefined;\r\n  className?: string | undefined;\r\n}\r\n\r\n/**\r\n * ResponsiveDataTable - Auto-adaptive data display component\r\n * \r\n * Desktop (>= 768px): Full-featured DataTable with sorting, filtering, bulk actions\r\n * Mobile (< 768px): Card-based layout with touch-friendly interactions\r\n * \r\n * Features:\r\n * - Automatic responsive switching\r\n * - Loading states (skeleton)\r\n * - Empty states\r\n * - Mobile pagination\r\n * - Preserves functionality across breakpoints\r\n * \r\n * @example\r\n * <ResponsiveDataTable\r\n *   columns={columns}\r\n *   data={employees}\r\n *   renderMobileCard={(employee) => <EmployeeCard employee={employee} />}\r\n *   pagination={pagination}\r\n *   setPagination={setPagination}\r\n *   // ... other props\r\n * />\r\n */\r\nexport function ResponsiveDataTable<TData extends { systemId: string }>({\r\n  columns,\r\n  data,\r\n  renderMobileCard,\r\n  autoGenerateMobileCards = true,\r\n  mobileCardClassName,\r\n  isLoading = false,\r\n  emptyTitle = \"Không có dữ liệu\",\r\n  emptyDescription,\r\n  emptyAction,\r\n  mobileVirtualized = false,\r\n  mobileRowHeight = 180,\r\n  mobileListHeight = 600,\r\n  pageCount,\r\n  pagination,\r\n  setPagination,\r\n  rowCount,\r\n  rowSelection = {},\r\n  setRowSelection = () => {},\r\n  onBulkDelete,\r\n  showBulkDeleteButton = true,\r\n  bulkActions,\r\n  pkgxBulkActions,\r\n  bulkActionButtons,\r\n  allSelectedRows = [],\r\n  renderSubComponent,\r\n  expanded = {},\r\n  setExpanded = () => {},\r\n  sorting,\r\n  setSorting,\r\n  columnVisibility = {},\r\n  setColumnVisibility = () => {},\r\n  columnOrder = [],\r\n  setColumnOrder = () => {},\r\n  pinnedColumns = [],\r\n  setPinnedColumns = () => {},\r\n  onRowClick,\r\n  getRowStyle,\r\n  className,\r\n}: ResponsiveDataTableProps<TData>) {\r\n  const { isMobile } = useBreakpoint();\r\n  const autoCardColumns = React.useMemo(() => {\r\n    return columns\r\n      .filter(column => {\r\n        if (!column.id) return false;\r\n        if (['select', 'control', 'actions', 'expander'].includes(column.id)) return false;\r\n        if (columnVisibility && columnVisibility[column.id] === false) return false;\r\n        const meta = column.meta as Record<string, any> | undefined;\r\n        if (meta?.hideOnMobileCard) return false;\r\n        return true;\r\n      })\r\n      .slice(0, 6);\r\n  }, [columns, columnVisibility]);\r\n\r\n  const getColumnLabel = React.useCallback((column: ColumnDef<TData>) => {\r\n    if (typeof column.header === 'string') return column.header;\r\n    const meta = column.meta as Record<string, any> | undefined;\r\n    if (meta?.displayName) return meta.displayName;\r\n    return column.id || '';\r\n  }, []);\r\n\r\n  const renderColumnValue = React.useCallback((column: ColumnDef<TData>, row: TData) => {\r\n    if (typeof column.cell === 'function') {\r\n      return column.cell({\r\n        row,\r\n        isSelected: false,\r\n        isExpanded: false,\r\n        onToggleSelect: () => {},\r\n        onToggleExpand: () => {},\r\n      } as any);\r\n    }\r\n    if (column.accessorKey) {\r\n      const value = (row as any)[column.accessorKey as string];\r\n      if (value === undefined || value === null) return '—';\r\n      if (React.isValidElement(value)) return value;\r\n      return String(value);\r\n    }\r\n    return '—';\r\n  }, []);\r\n\r\n  const autoRenderMobileCard = React.useCallback((row: TData) => (\r\n    <MobileCardWrapper>\r\n      <div className=\"space-y-3 text-sm\">\r\n        {autoCardColumns.map(column => (\r\n          <div key={column.id}>\r\n            <div className=\"text-xs uppercase text-muted-foreground font-semibold\">\r\n              {getColumnLabel(column)}\r\n            </div>\r\n            <div className=\"text-base font-medium text-foreground\">\r\n              {renderColumnValue(column, row)}\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </MobileCardWrapper>\r\n  ), [autoCardColumns, getColumnLabel, renderColumnValue]);\r\n\r\n  const hasAutoCardSupport = autoGenerateMobileCards !== false && autoCardColumns.length > 0;\r\n  const cardRenderer = renderMobileCard ?? (hasAutoCardSupport ? autoRenderMobileCard : undefined);\r\n  const shouldRenderMobileCards = Boolean(isMobile && cardRenderer);\r\n\r\n  const desktopProps: DesktopDataTableProps<TData> = {\r\n    columns,\r\n    data,\r\n    pageCount,\r\n    pagination,\r\n    setPagination,\r\n    rowCount,\r\n    rowSelection,\r\n    setRowSelection,\r\n    onBulkDelete,\r\n    showBulkDeleteButton,\r\n    bulkActions,\r\n    pkgxBulkActions,\r\n    bulkActionButtons,\r\n    allSelectedRows,\r\n    renderSubComponent,\r\n    expanded,\r\n    setExpanded,\r\n    sorting,\r\n    setSorting,\r\n    columnVisibility,\r\n    setColumnVisibility,\r\n    columnOrder,\r\n    setColumnOrder,\r\n    pinnedColumns,\r\n    setPinnedColumns,\r\n    onRowClick,\r\n    getRowStyle,\r\n    className,\r\n  };\r\n\r\n  // Loading state\r\n  if (isLoading) {\r\n    return shouldRenderMobileCards ? (\r\n      <MobileCardSkeleton count={pagination.pageSize || 10} className={mobileCardClassName} />\r\n    ) : (\r\n      <div className={cn(\"space-y-3\", className)}>\r\n        {Array.from({ length: pagination.pageSize || 10 }).map((_, i) => (\r\n          <div key={i} className=\"h-16 bg-muted animate-pulse rounded\" />\r\n        ))}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Empty state - only for mobile card mode\r\n  if (data.length === 0 && shouldRenderMobileCards) {\r\n    return (\r\n      <EmptyState\r\n        title={emptyTitle}\r\n        description={emptyDescription}\r\n        action={emptyAction}\r\n        className={className}\r\n      />\r\n    );\r\n  }\r\n\r\n  // Mobile card layout\r\n  if (shouldRenderMobileCards && cardRenderer) {\r\n    if (mobileVirtualized) {\r\n      return (\r\n        <div\r\n          className={cn('pb-4', className)}\r\n          style={{ maxHeight: mobileListHeight, overflowY: 'auto' }}\r\n        >\r\n          {data.map((row, index) => (\r\n            <div\r\n              key={row.systemId}\r\n              className={mobileCardClassName}\r\n              style={{ minHeight: mobileRowHeight }}\r\n            >\r\n              {cardRenderer(row, index)}\r\n            </div>\r\n          ))}\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div className={cn(\"space-y-3 pb-4\", className)}>\r\n        {data.map((row, index) => (\r\n          <div key={row.systemId} className={mobileCardClassName}>\r\n            {cardRenderer(row, index)}\r\n          </div>\r\n        ))}\r\n\r\n        {/* Mobile Pagination */}\r\n        {pageCount > 1 && (\r\n          <div className=\"flex items-center justify-between pt-4 border-t border-border\">\r\n            <TouchButton\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={() => setPagination(p => ({ ...p, pageIndex: Math.max(0, p.pageIndex - 1) }))}\r\n              disabled={pagination.pageIndex === 0}\r\n            >\r\n              Trước\r\n            </TouchButton>\r\n            \r\n            <div className=\"flex flex-col items-center gap-1\">\r\n              <span className=\"text-sm font-medium\">\r\n                Trang {pagination.pageIndex + 1} / {pageCount}\r\n              </span>\r\n              <span className=\"text-xs text-muted-foreground\">\r\n                {rowCount} kết quả\r\n              </span>\r\n            </div>\r\n            \r\n            <TouchButton\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={() => setPagination(p => ({ ...p, pageIndex: Math.min(pageCount - 1, p.pageIndex + 1) }))}\r\n              disabled={pagination.pageIndex >= pageCount - 1}\r\n            >\r\n              Sau\r\n            </TouchButton>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Desktop table layout\r\n  return <DesktopDataTable {...desktopProps} />;\r\n}\r\n\r\nfunction DesktopDataTable<TData extends { systemId: string }>({\r\n  columns,\r\n  data,\r\n  pageCount,\r\n  pagination,\r\n  setPagination,\r\n  rowCount,\r\n  rowSelection,\r\n  setRowSelection,\r\n  onBulkDelete,\r\n  showBulkDeleteButton = true,\r\n  bulkActions,\r\n  pkgxBulkActions,\r\n  bulkActionButtons,\r\n  allSelectedRows,\r\n  renderSubComponent,\r\n  expanded,\r\n  setExpanded,\r\n  sorting,\r\n  setSorting,\r\n  columnVisibility,\r\n  setColumnVisibility,\r\n  columnOrder,\r\n  setColumnOrder,\r\n  pinnedColumns,\r\n  setPinnedColumns,\r\n  onRowClick,\r\n  getRowStyle,\r\n  className,\r\n}: DesktopDataTableProps<TData>) {\r\n  const numSelected = Object.keys(rowSelection).length;\r\n  const isAllPageRowsSelected = data.length > 0 && data.every(row => rowSelection[row.systemId]);\r\n  const isSomePageRowsSelected = !isAllPageRowsSelected && data.some(row => rowSelection[row.systemId]);\r\n  const hasData = data?.length > 0;\r\n  const [columnWidths, setColumnWidths] = React.useState<Record<string, number>>({});\r\n  const stickyCellBg = 'var(--sticky-column-bg, rgba(255, 255, 255, 1))';\r\n  const stickyHeaderBg = 'var(--sticky-column-header-bg, var(--muted))';\r\n\r\n  const handleToggleAllPageRows = (value: boolean) => {\r\n    const newSelection = { ...rowSelection };\r\n    data.forEach(row => {\r\n      if (value) {\r\n        newSelection[row.systemId] = true;\r\n      } else {\r\n        delete newSelection[row.systemId];\r\n      }\r\n    });\r\n    setRowSelection(newSelection);\r\n  };\r\n\r\n  const displayColumns = React.useMemo(() => {\r\n    const expanderColumn: ColumnDef<TData> | null = renderSubComponent\r\n      ? {\r\n          id: 'expander',\r\n          header: () => null,\r\n          cell: ({ isExpanded, onToggleExpand }) => (\r\n            <div className=\"flex items-center justify-center\">\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  onToggleExpand();\r\n                }}\r\n                className=\"h-8 w-8\"\r\n              >\r\n                <ChevronsRight className={cn('h-4 w-4 transition-transform', isExpanded && 'rotate-90')} />\r\n              </Button>\r\n            </div>\r\n          ),\r\n          size: 60,\r\n          meta: { displayName: 'Mở rộng', sticky: 'left' },\r\n        }\r\n      : null;\r\n\r\n    const allConfigurableColumns = expanderColumn ? [expanderColumn, ...columns] : [...columns];\r\n\r\n    const visibleMasterCols = allConfigurableColumns.filter(col => {\r\n      if (col.id === 'expander') return true;\r\n      const isVisible = columnVisibility[col.id];\r\n      return isVisible !== false;\r\n    });\r\n\r\n    const normalizedCols = visibleMasterCols.map(col => {\r\n      if (['select', 'control'].includes(col.id)) {\r\n        return {\r\n          ...col,\r\n          meta: { ...col.meta, sticky: 'left' as const },\r\n        };\r\n      }\r\n\r\n      if (col.id === 'actions') {\r\n        return {\r\n          ...col,\r\n          meta: { ...col.meta, sticky: 'right' as const },\r\n        };\r\n      }\r\n\r\n      return col;\r\n    });\r\n\r\n    const staticLeftCols = normalizedCols.filter(c => {\r\n      const meta = c.meta as any;\r\n      return meta?.sticky === 'left' && !['select', 'control', 'expander'].includes(c.id);\r\n    });\r\n    const staticRightCols = normalizedCols.filter(c => (c.meta as any)?.sticky === 'right');\r\n    const controlCols = normalizedCols.filter(c => ['select', 'control', 'expander'].includes(c.id));\r\n    const bodyCols = normalizedCols.filter(c => {\r\n      const meta = c.meta as any;\r\n      return !meta?.sticky && !['select', 'control', 'expander'].includes(c.id);\r\n    });\r\n\r\n    const orderedBodyCols = [...bodyCols].sort((a, b) => {\r\n      const indexA = columnOrder.indexOf(a.id);\r\n      const indexB = columnOrder.indexOf(b.id);\r\n      if (indexA === -1 && indexB === -1) return 0;\r\n      if (indexA === -1) return 1;\r\n      if (indexB === -1) return -1;\r\n      return indexA - indexB;\r\n    });\r\n\r\n    const userPinnedCols = orderedBodyCols\r\n      .filter(col => pinnedColumns.includes(col.id))\r\n      .map(col => ({\r\n        ...col,\r\n        meta: { ...col.meta, sticky: 'left' as const }\r\n      }));\r\n\r\n    const nonPinnedBodyCols = orderedBodyCols.filter(c => !pinnedColumns.includes(c.id));\r\n\r\n    return [\r\n      ...controlCols,\r\n      ...staticLeftCols,\r\n      ...userPinnedCols,\r\n      ...nonPinnedBodyCols,\r\n      ...staticRightCols,\r\n    ] as ColumnDef<TData>[];\r\n  }, [columns, columnVisibility, columnOrder, pinnedColumns, renderSubComponent]);\r\n\r\n  const leftStickyColumns = React.useMemo(() => displayColumns.filter(c => (c.meta as any)?.sticky === 'left'), [displayColumns]);\r\n  const rightStickyColumns = React.useMemo(() => displayColumns.filter(c => (c.meta as any)?.sticky === 'right'), [displayColumns]);\r\n\r\n  const getColumnWidth = React.useCallback((column: ColumnDef<TData>) => {\r\n    return column.size ?? columnWidths[column.id] ?? ((column.meta as any)?.minWidth ?? 140);\r\n  }, [columnWidths]);\r\n\r\n  const leftOffsets = React.useMemo(() => {\r\n      let offset = 0;\r\n      return leftStickyColumns.map(c => {\r\n          const width = getColumnWidth(c);\r\n          const currentOffset = offset;\r\n          offset += width;\r\n          return currentOffset;\r\n      });\r\n  }, [leftStickyColumns, getColumnWidth]);\r\n\r\n  const rightOffsets = React.useMemo(() => {\r\n      let offset = 0;\r\n      const reversedOffsets = [...rightStickyColumns].reverse().map(c => {\r\n          const width = getColumnWidth(c);\r\n          const currentOffset = offset;\r\n          offset += width;\r\n          return currentOffset;\r\n      });\r\n      return reversedOffsets.reverse();\r\n  }, [rightStickyColumns, getColumnWidth]);\r\n\r\n  const tableContainerRef = React.useRef<HTMLDivElement>(null);\r\n  const headerScrollRef = React.useRef<HTMLDivElement>(null);\r\n  const bodyTableRef = React.useRef<HTMLTableElement>(null);\r\n  const headerTableRef = React.useRef<HTMLTableElement>(null);\r\n  const fallbackTableRef = React.useCallback((node: HTMLTableElement | null) => {\r\n    headerTableRef.current = node;\r\n    bodyTableRef.current = node;\r\n  }, []);\r\n\r\n  const syncScroll = (source: 'header' | 'body') => {\r\n    if (!headerScrollRef.current || !tableContainerRef.current) return;\r\n\r\n    if (source === 'body') {\r\n      headerScrollRef.current.scrollLeft = tableContainerRef.current.scrollLeft;\r\n    } else {\r\n      tableContainerRef.current.scrollLeft = headerScrollRef.current.scrollLeft;\r\n    }\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    if (!hasData) return;\r\n    if (!headerTableRef.current) return;\r\n\r\n    const syncWidths = () => {\r\n      const bodyTable = bodyTableRef.current;\r\n      const headerTable = headerTableRef.current;\r\n      if (!headerTable) return;\r\n\r\n      const bodyRow = bodyTable?.querySelector('tbody tr:first-child');\r\n      const headerRow = headerTable.querySelector('thead tr:last-child');\r\n      if (!headerRow) return;\r\n\r\n      const bodyCells = bodyRow ? Array.from(bodyRow.querySelectorAll('td')) : [];\r\n      const headerCells = Array.from(headerRow.querySelectorAll('th'));\r\n      const nextWidthMap: Record<string, number> = {};\r\n\r\n      displayColumns.forEach((column, index) => {\r\n        const sourceCell = bodyCells[index];\r\n        const fallbackCell = headerCells[index];\r\n        const width = sourceCell?.getBoundingClientRect().width || fallbackCell?.getBoundingClientRect().width;\r\n        if (width && headerCells[index]) {\r\n          headerCells[index].style.width = `${width}px`;\r\n          headerCells[index].style.minWidth = `${width}px`;\r\n          headerCells[index].style.maxWidth = `${width}px`;\r\n          nextWidthMap[column.id] = width;\r\n        }\r\n      });\r\n\r\n      if (bodyTable) {\r\n        headerTable.style.width = `${bodyTable.getBoundingClientRect().width}px`;\r\n      }\r\n\r\n      setColumnWidths(prev => {\r\n        let changed = false;\r\n        const updated = { ...prev };\r\n        Object.entries(nextWidthMap).forEach(([key, width]) => {\r\n          if (prev[key] !== width) {\r\n            changed = true;\r\n            updated[key] = width;\r\n          }\r\n        });\r\n        return changed ? updated : prev;\r\n      });\r\n    };\r\n\r\n    syncWidths();\r\n    window.addEventListener('resize', syncWidths);\r\n\r\n    const resizeObserver = new ResizeObserver(syncWidths);\r\n    if (bodyTableRef.current) {\r\n      resizeObserver.observe(bodyTableRef.current);\r\n    }\r\n\r\n    return () => {\r\n      window.removeEventListener('resize', syncWidths);\r\n      resizeObserver.disconnect();\r\n    };\r\n  }, [data, displayColumns, hasData]);\r\n\r\n  const renderHeaderRow = (isSticky: boolean) => (\r\n    <TableRow className=\"h-9\">\r\n      {displayColumns.map((column, colIndex) => {\r\n        const stickyMeta = isSticky ? (column.meta as any)?.sticky : undefined;\r\n        const hasFixedSize = column.size !== undefined;\r\n        const fallbackMinWidth = (column.meta as any)?.minWidth ?? 140;\r\n\r\n        const style: React.CSSProperties = {};\r\n\r\n        if (hasFixedSize) {\r\n          style.width = column.size;\r\n          style.minWidth = column.size;\r\n          style.maxWidth = column.size;\r\n        } else {\r\n          style.minWidth = fallbackMinWidth;\r\n        }\r\n\r\n        let thClassName = \"bg-muted whitespace-nowrap\";\r\n\r\n        const isLastLeftSticky = stickyMeta === 'left' && colIndex === leftStickyColumns.length - 1;\r\n        const isFirstRightSticky = stickyMeta === 'right' && colIndex === displayColumns.length - rightStickyColumns.length;\r\n\r\n        if (isSticky && stickyMeta === 'left') {\r\n          const stickyIndex = leftStickyColumns.findIndex(c => c.id === column.id);\r\n          if (stickyIndex !== -1) {\r\n            (style as any).position = 'sticky';\r\n            (style as any).left = `${leftOffsets[stickyIndex]}px`;\r\n            (style as any).top = 0;\r\n            (style as any).backgroundColor = stickyHeaderBg;\r\n            thClassName = cn(thClassName, \"z-30 bg-muted shadow-sm\");\r\n          }\r\n        } else if (isSticky && stickyMeta === 'right') {\r\n          const stickyIndex = rightStickyColumns.findIndex(c => c.id === column.id);\r\n          if (stickyIndex !== -1) {\r\n            (style as any).position = 'sticky';\r\n            (style as any).right = `${rightOffsets[stickyIndex]}px`;\r\n            (style as any).top = 0;\r\n            (style as any).backgroundColor = stickyHeaderBg;\r\n            thClassName = cn(thClassName, \"z-30 bg-muted shadow-[-2px_0_4px_-2px_rgba(0,0,0,0.1)]\");\r\n          }\r\n        }\r\n\r\n        if (['control', 'select', 'expander', 'actions'].includes(column.id)) {\r\n          thClassName = cn(thClassName, \"px-2 text-center\");\r\n        }\r\n\r\n        return (\r\n          <TableHead\r\n            key={column.id}\r\n            style={style}\r\n            className={cn(thClassName, {\r\n              \"border-r border-border\": isSticky && isLastLeftSticky,\r\n            })}\r\n          >\r\n            {typeof column.header === 'function'\r\n              // @ts-ignore\r\n              ? column.header({\r\n                  isAllPageRowsSelected,\r\n                  isSomePageRowsSelected,\r\n                  onToggleAll: handleToggleAllPageRows,\r\n                  sorting,\r\n                  setSorting,\r\n                })\r\n              : column.header}\r\n          </TableHead>\r\n        );\r\n      })}\r\n    </TableRow>\r\n  );\r\n\r\n  return (\r\n    <div className={cn(\"flex flex-col w-full\", className)}>\r\n      {hasData ? (\r\n        <>\r\n          <div\r\n            ref={headerScrollRef}\r\n            onScroll={() => syncScroll('header')}\r\n            className=\"sticky top-32 z-30 overflow-x-auto rounded-t-md border border-border border-b-0 bg-muted [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]\"\r\n          >\r\n            <Table ref={headerTableRef}>\r\n              <TableHeader className=\"bg-muted shadow-sm\">\r\n                {numSelected > 0 && (\r\n                  <tr className=\"absolute inset-x-0 top-0 z-50 h-9 bg-muted/95 backdrop-blur-sm border-b border-border shadow-md\">\r\n                    <th className=\"sticky left-0 z-[60] bg-muted/95 backdrop-blur-sm px-3 w-[48px]\">\r\n                      {columns.find(c => c.id === 'select') &&\r\n                        typeof columns.find(c => c.id === 'select')!.header === 'function' &&\r\n                        // @ts-ignore\r\n                        columns.find(c => c.id === 'select')!.header({\r\n                          isAllPageRowsSelected,\r\n                          isSomePageRowsSelected,\r\n                          onToggleAll: handleToggleAllPageRows,\r\n                        })\r\n                      }\r\n                    </th>\r\n                    <th className=\"sticky left-[48px] z-[60] h-9 bg-muted/95 backdrop-blur-sm\">\r\n                      <div className=\"flex items-center gap-3 px-4\">\r\n                        <span className=\"text-sm font-medium\">{numSelected} mục đã chọn</span>\r\n                        {bulkActions && bulkActions.length > 0 && (\r\n                          <DropdownMenu>\r\n                            <DropdownMenuTrigger asChild>\r\n                              <Button variant=\"outline\" size=\"sm\">\r\n                                Action\r\n                                <ChevronDown className=\"ml-2 h-4 w-4\" />\r\n                              </Button>\r\n                            </DropdownMenuTrigger>\r\n                            <DropdownMenuContent align=\"start\">\r\n                              {bulkActions.map((action, index) => (\r\n                                <DropdownMenuItem\r\n                                  key={index}\r\n                                  onSelect={() => action.onSelect(allSelectedRows)}\r\n                                  disabled={(action as any).disabled}\r\n                                >\r\n                                  {action.icon && <action.icon className=\"mr-2 h-4 w-4\" />}\r\n                                  {action.label}\r\n                                </DropdownMenuItem>\r\n                              ))}\r\n                            </DropdownMenuContent>\r\n                          </DropdownMenu>\r\n                        )}\r\n                        {pkgxBulkActions && pkgxBulkActions.length > 0 && (\r\n                          <DropdownMenu>\r\n                            <DropdownMenuTrigger asChild>\r\n                              <Button variant=\"outline\" size=\"sm\">\r\n                                PKGX\r\n                                <ChevronDown className=\"ml-2 h-4 w-4\" />\r\n                              </Button>\r\n                            </DropdownMenuTrigger>\r\n                            <DropdownMenuContent align=\"start\">\r\n                              {pkgxBulkActions.map((action, index) => (\r\n                                <DropdownMenuItem\r\n                                  key={index}\r\n                                  onSelect={() => action.onSelect(allSelectedRows)}\r\n                                  disabled={(action as any).disabled}\r\n                                  className={(action as any).variant === 'destructive' ? 'text-destructive focus:text-destructive' : ''}\r\n                                >\r\n                                  {action.icon && <action.icon className=\"mr-2 h-4 w-4\" />}\r\n                                  {action.label}\r\n                                </DropdownMenuItem>\r\n                              ))}\r\n                            </DropdownMenuContent>\r\n                          </DropdownMenu>\r\n                        )}\r\n                        {bulkActionButtons}\r\n                      </div>\r\n                    </th>\r\n                  </tr>\r\n                )}\r\n                {renderHeaderRow(true)}\r\n              </TableHeader>\r\n            </Table>\r\n          </div>\r\n\r\n          <div\r\n            ref={tableContainerRef}\r\n            onScroll={() => syncScroll('body')}\r\n            className=\"rounded-b-md border border-border bg-background overflow-x-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]\"\r\n          >\r\n            <Table ref={bodyTableRef}>\r\n              <TableBody>\r\n                {data.map((row, rowIndex) => (\r\n                  <React.Fragment key={`${row.systemId}-${rowIndex}`}>\r\n                    <TableRow\r\n                      data-state={rowSelection[row.systemId] && \"selected\"}\r\n                      onClick={() => onRowClick?.(row)}\r\n                      className={cn('group', onRowClick && 'cursor-pointer')}\r\n                      style={getRowStyle?.(row)}\r\n                    >\r\n                      {displayColumns.map((column, colIndex) => {\r\n                        const isInteractiveColumn = ['select', 'control', 'actions', 'expander'].includes(column.id);\r\n\r\n                        const stickyMeta = (column.meta as any)?.sticky;\r\n                        const hasFixedSize = column.size !== undefined;\r\n                        const fallbackMinWidth = (column.meta as any)?.minWidth ?? 140;\r\n\r\n                        const style: React.CSSProperties = {};\r\n\r\n                        if (hasFixedSize) {\r\n                          style.width = column.size;\r\n                          style.minWidth = column.size;\r\n                          style.maxWidth = column.size;\r\n                        } else {\r\n                          style.minWidth = fallbackMinWidth;\r\n                        }\r\n\r\n                        let tdClassName = \"\";\r\n\r\n                        const isLastLeftSticky = stickyMeta === 'left' && colIndex === leftStickyColumns.length - 1;\r\n\r\n                        if (stickyMeta === 'left') {\r\n                          const stickyIndex = leftStickyColumns.findIndex(c => c.id === column.id);\r\n                          if (stickyIndex !== -1) {\r\n                            (style as any).position = 'sticky';\r\n                            (style as any).left = `${leftOffsets[stickyIndex]}px`;\r\n                            const rowBgColor = getRowStyle?.(row)?.backgroundColor;\r\n                            (style as any).backgroundColor = rowBgColor || stickyCellBg;\r\n                            tdClassName = cn(\r\n                              \"z-20 shadow-[2px_0_6px_rgba(0,0,0,0.05)]\",\r\n                              \"bg-muted text-foreground group-hover:bg-muted group-data-[state=selected]:bg-muted\"\r\n                            );\r\n                          }\r\n                        } else if (stickyMeta === 'right') {\r\n                          const stickyIndex = rightStickyColumns.findIndex(c => c.id === column.id);\r\n                          if (stickyIndex !== -1) {\r\n                            (style as any).position = 'sticky';\r\n                            (style as any).right = `${rightOffsets[stickyIndex]}px`;\r\n                            const rowBgColor = getRowStyle?.(row)?.backgroundColor;\r\n                            (style as any).backgroundColor = rowBgColor || stickyCellBg;\r\n                            tdClassName = cn(\r\n                              \"z-20\",\r\n                              \"bg-muted text-foreground group-hover:bg-muted group-data-[state=selected]:bg-muted shadow-[-2px_0_6px_rgba(0,0,0,0.08)]\"\r\n                            );\r\n                          }\r\n                        }\r\n\r\n                        if (['control', 'select', 'expander', 'actions'].includes(column.id)) {\r\n                          tdClassName = cn(tdClassName, \"px-2 text-center\");\r\n                        }\r\n\r\n                        return (\r\n                          <TableCell\r\n                            key={column.id}\r\n                            style={style}\r\n                            className={cn(tdClassName, {\r\n                              \"border-r border-border\": isLastLeftSticky,\r\n                            })}\r\n                            onClick={isInteractiveColumn ? (e) => e.stopPropagation() : undefined}\r\n                          >\r\n                            {column.cell({\r\n                              row,\r\n                              isSelected: !!rowSelection[row.systemId],\r\n                              isExpanded: !!expanded[row.systemId],\r\n                              onToggleSelect: (value) => {\r\n                                setRowSelection(prev => {\r\n                                  const newSelection = { ...prev };\r\n                                  if (value) {\r\n                                    newSelection[row.systemId] = true;\r\n                                  } else {\r\n                                    delete newSelection[row.systemId];\r\n                                  }\r\n                                  return newSelection;\r\n                                });\r\n                              },\r\n                              onToggleExpand: () => setExpanded(prev => ({ ...prev, [row.systemId]: !prev[row.systemId] })),\r\n                            })}\r\n                          </TableCell>\r\n                        );\r\n                      })}\r\n                    </TableRow>\r\n                    {expanded[row.systemId] && renderSubComponent && (\r\n                      <TableRow>\r\n                        <TableCell colSpan={displayColumns.length} className=\"p-0\">\r\n                          {renderSubComponent(row)}\r\n                        </TableCell>\r\n                      </TableRow>\r\n                    )}\r\n                  </React.Fragment>\r\n                ))}\r\n              </TableBody>\r\n            </Table>\r\n          </div>\r\n        </>\r\n      ) : (\r\n        <div\r\n          ref={tableContainerRef}\r\n          className=\"rounded-md border border-border bg-background overflow-x-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]\"\r\n        >\r\n          <Table ref={fallbackTableRef}>\r\n            <TableHeader className=\"bg-muted shadow-sm\">\r\n              {renderHeaderRow(true)}\r\n            </TableHeader>\r\n            <TableBody>\r\n              <TableRow>\r\n                <TableCell colSpan={displayColumns.length} className=\"h-24 text-center\">\r\n                  Không có dữ liệu.\r\n                </TableCell>\r\n              </TableRow>\r\n            </TableBody>\r\n          </Table>\r\n        </div>\r\n      )}\r\n\r\n      <div className=\"flex-shrink-0 border-t border-border bg-background px-6 py-3\">\r\n        <DataTablePagination\r\n          pageIndex={pagination.pageIndex}\r\n          pageSize={pagination.pageSize}\r\n          pageCount={pageCount}\r\n          setPageIndex={(index) => setPagination(p => ({ ...p, pageIndex: index }))}\r\n          setPageSize={(size) => setPagination({ pageIndex: 0, pageSize: size })}\r\n          canPreviousPage={pagination.pageIndex > 0}\r\n          canNextPage={pagination.pageIndex < pageCount - 1}\r\n          rowCount={rowCount}\r\n          selectedRowCount={numSelected}\r\n        />\r\n      </div>\r\n\r\n      <StickyScrollbar targetRef={tableContainerRef} />\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * MobileCardWrapper - Helper component for consistent mobile card styling\r\n */\r\nexport function MobileCardWrapper({\r\n  children,\r\n  onClick,\r\n  className,\r\n}: {\r\n  children: React.ReactNode;\r\n  onClick?: () => void;\r\n  className?: string;\r\n}) {\r\n  return (\r\n    <Card\r\n      className={cn(\r\n        \"hover:shadow-md transition-shadow\",\r\n        onClick && \"cursor-pointer\",\r\n        className\r\n      )}\r\n      onClick={onClick}\r\n    >\r\n      <CardContent className=\"p-4\">\r\n        {children}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6357, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/validation/product-mapping-validation.ts"],"sourcesContent":["import type { SystemId } from '@/lib/id-types';\r\nimport type { PkgxProduct } from '../types';\r\n\r\n// ========================================\r\n// Validation Types\r\n// ========================================\r\n\r\nexport interface ProductValidationResult {\r\n  isValid: boolean;\r\n  errors: ProductValidationError[];\r\n  warnings: ProductValidationWarning[];\r\n}\r\n\r\nexport interface ProductValidationError {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface ProductValidationWarning {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface ProductMappingInput {\r\n  hrmProductSystemId: SystemId | string;\r\n  hrmProductName: string;\r\n  hrmProductSku?: string;\r\n  pkgxProductId: number | string;\r\n  pkgxProductName: string;\r\n  pkgxProductSku?: string;\r\n}\r\n\r\n// ========================================\r\n// Error Codes\r\n// ========================================\r\n\r\nexport const PRODUCT_MAPPING_ERROR_CODES = {\r\n  // Required field errors\r\n  HRM_PRODUCT_REQUIRED: 'HRM_PRODUCT_REQUIRED',\r\n  PKGX_PRODUCT_REQUIRED: 'PKGX_PRODUCT_REQUIRED',\r\n  \r\n  // Duplicate/conflict errors\r\n  HRM_PRODUCT_ALREADY_LINKED: 'HRM_PRODUCT_ALREADY_LINKED',\r\n  PKGX_PRODUCT_ALREADY_LINKED: 'PKGX_PRODUCT_ALREADY_LINKED',\r\n  \r\n  // Not found errors\r\n  HRM_PRODUCT_NOT_FOUND: 'HRM_PRODUCT_NOT_FOUND',\r\n  PKGX_PRODUCT_NOT_FOUND: 'PKGX_PRODUCT_NOT_FOUND',\r\n  \r\n  // Inactive/deleted errors\r\n  HRM_PRODUCT_INACTIVE: 'HRM_PRODUCT_INACTIVE',\r\n} as const;\r\n\r\nexport const PRODUCT_MAPPING_WARNING_CODES = {\r\n  // Suggestions\r\n  SKU_MATCH_AVAILABLE: 'SKU_MATCH_AVAILABLE',\r\n  NAME_MISMATCH: 'NAME_MISMATCH',\r\n  SKU_MISMATCH: 'SKU_MISMATCH',\r\n} as const;\r\n\r\n// ========================================\r\n// Error Messages (Vietnamese)\r\n// ========================================\r\n\r\nexport const PRODUCT_MAPPING_ERROR_MESSAGES: Record<string, string> = {\r\n  [PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_REQUIRED]: 'Vui lòng chọn sản phẩm HRM',\r\n  [PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_REQUIRED]: 'Vui lòng chọn sản phẩm PKGX',\r\n  [PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_ALREADY_LINKED]: 'Sản phẩm HRM này đã được liên kết với sản phẩm PKGX khác',\r\n  [PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_ALREADY_LINKED]: 'Sản phẩm PKGX này đã được liên kết với sản phẩm HRM khác',\r\n  [PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_NOT_FOUND]: 'Không tìm thấy sản phẩm HRM trong hệ thống',\r\n  [PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_NOT_FOUND]: 'Không tìm thấy sản phẩm PKGX (có thể đã bị xóa trên PKGX)',\r\n  [PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_INACTIVE]: 'Sản phẩm HRM đã bị vô hiệu hóa hoặc xóa',\r\n};\r\n\r\nexport const PRODUCT_MAPPING_WARNING_MESSAGES: Record<string, string> = {\r\n  [PRODUCT_MAPPING_WARNING_CODES.SKU_MATCH_AVAILABLE]: 'Có sản phẩm HRM có SKU trùng khớp, có thể bạn muốn chọn sản phẩm đó',\r\n  [PRODUCT_MAPPING_WARNING_CODES.NAME_MISMATCH]: 'Tên sản phẩm HRM và PKGX khác nhau đáng kể',\r\n  [PRODUCT_MAPPING_WARNING_CODES.SKU_MISMATCH]: 'Mã SKU của sản phẩm HRM và PKGX không khớp',\r\n};\r\n\r\n// ========================================\r\n// Validation Context\r\n// ========================================\r\n\r\nexport interface ProductValidationContext {\r\n  hrmProducts: Array<{\r\n    systemId: SystemId;\r\n    name: string;\r\n    id: string; // SKU\r\n    pkgxId?: number;\r\n    status?: string;\r\n    isActive?: boolean;\r\n  }>;\r\n  pkgxProducts: PkgxProduct[];\r\n  editingProductId?: string; // HRM systemId đang edit\r\n}\r\n\r\n// ========================================\r\n// Validation Functions\r\n// ========================================\r\n\r\n/**\r\n * Validate required fields\r\n */\r\nexport function validateRequiredFields(input: ProductMappingInput): ProductValidationError[] {\r\n  const errors: ProductValidationError[] = [];\r\n\r\n  if (!input.hrmProductSystemId) {\r\n    errors.push({\r\n      code: PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_REQUIRED,\r\n      field: 'hrmProductSystemId',\r\n      message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_REQUIRED],\r\n    });\r\n  }\r\n\r\n  if (!input.pkgxProductId) {\r\n    errors.push({\r\n      code: PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_REQUIRED,\r\n      field: 'pkgxProductId',\r\n      message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_REQUIRED],\r\n    });\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate product exists\r\n */\r\nexport function validateProductExists(\r\n  input: ProductMappingInput,\r\n  context: ProductValidationContext\r\n): ProductValidationError[] {\r\n  const errors: ProductValidationError[] = [];\r\n\r\n  if (input.hrmProductSystemId) {\r\n    const hrmProduct = context.hrmProducts.find(p => p.systemId === input.hrmProductSystemId);\r\n    if (!hrmProduct) {\r\n      errors.push({\r\n        code: PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_NOT_FOUND,\r\n        field: 'hrmProductSystemId',\r\n        message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_NOT_FOUND],\r\n        details: { systemId: input.hrmProductSystemId },\r\n      });\r\n    } else if (hrmProduct.status === 'inactive' || hrmProduct.isActive === false) {\r\n      errors.push({\r\n        code: PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_INACTIVE,\r\n        field: 'hrmProductSystemId',\r\n        message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_INACTIVE],\r\n        details: { systemId: input.hrmProductSystemId, name: hrmProduct.name },\r\n      });\r\n    }\r\n  }\r\n\r\n  if (input.pkgxProductId) {\r\n    const pkgxProduct = context.pkgxProducts.find(p => p.goods_id === input.pkgxProductId);\r\n    if (!pkgxProduct) {\r\n      errors.push({\r\n        code: PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_NOT_FOUND,\r\n        field: 'pkgxProductId',\r\n        message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_NOT_FOUND],\r\n        details: { pkgxProductId: input.pkgxProductId },\r\n      });\r\n    }\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate duplicate links\r\n */\r\nexport function validateDuplicateLinks(\r\n  input: ProductMappingInput,\r\n  context: ProductValidationContext\r\n): ProductValidationError[] {\r\n  const errors: ProductValidationError[] = [];\r\n\r\n  if (input.hrmProductSystemId) {\r\n    const hrmProduct = context.hrmProducts.find(p => p.systemId === input.hrmProductSystemId);\r\n    // Check if HRM product already linked to another PKGX product\r\n    if (hrmProduct?.pkgxId && hrmProduct.pkgxId !== input.pkgxProductId && hrmProduct.systemId !== context.editingProductId) {\r\n      errors.push({\r\n        code: PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_ALREADY_LINKED,\r\n        field: 'hrmProductSystemId',\r\n        message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_ALREADY_LINKED],\r\n        details: {\r\n          linkedTo: hrmProduct.pkgxId,\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  if (input.pkgxProductId) {\r\n    // Check if PKGX product already linked to another HRM product\r\n    const linkedHrmProduct = context.hrmProducts.find(\r\n      p => p.pkgxId === input.pkgxProductId && p.systemId !== input.hrmProductSystemId\r\n    );\r\n    if (linkedHrmProduct) {\r\n      errors.push({\r\n        code: PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_ALREADY_LINKED,\r\n        field: 'pkgxProductId',\r\n        message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_ALREADY_LINKED],\r\n        details: {\r\n          linkedTo: linkedHrmProduct.name,\r\n          linkedSystemId: linkedHrmProduct.systemId,\r\n        },\r\n      });\r\n    }\r\n  }\r\n  \r\n  return errors;\r\n}\r\n\r\n/**\r\n * Check for warnings (không block nhưng cảnh báo)\r\n */\r\nexport function checkWarnings(\r\n  input: ProductMappingInput,\r\n  context: ProductValidationContext\r\n): ProductValidationWarning[] {\r\n  const warnings: ProductValidationWarning[] = [];\r\n\r\n  if (!input.hrmProductSystemId || !input.pkgxProductId) {\r\n    return warnings;\r\n  }\r\n\r\n  const hrmProduct = context.hrmProducts.find(p => p.systemId === input.hrmProductSystemId);\r\n  const pkgxProduct = context.pkgxProducts.find(p => p.goods_id === input.pkgxProductId);\r\n\r\n  if (!hrmProduct || !pkgxProduct) return warnings;\r\n\r\n  // 1. Check name mismatch\r\n  const normalizedHrmName = normalizeString(hrmProduct.name);\r\n  const normalizedPkgxName = normalizeString(pkgxProduct.goods_name);\r\n  const similarity = calculateSimilarity(normalizedHrmName, normalizedPkgxName);\r\n  \r\n  if (similarity < 0.3) {\r\n    warnings.push({\r\n      code: PRODUCT_MAPPING_WARNING_CODES.NAME_MISMATCH,\r\n      message: PRODUCT_MAPPING_WARNING_MESSAGES[PRODUCT_MAPPING_WARNING_CODES.NAME_MISMATCH],\r\n      details: { \r\n        hrmName: hrmProduct.name, \r\n        pkgxName: pkgxProduct.goods_name,\r\n        similarity: Math.round(similarity * 100) + '%',\r\n      },\r\n    });\r\n  }\r\n\r\n  // 2. Check SKU mismatch\r\n  if (hrmProduct.id && pkgxProduct.goods_sn && hrmProduct.id !== pkgxProduct.goods_sn) {\r\n    warnings.push({\r\n      code: PRODUCT_MAPPING_WARNING_CODES.SKU_MISMATCH,\r\n      message: PRODUCT_MAPPING_WARNING_MESSAGES[PRODUCT_MAPPING_WARNING_CODES.SKU_MISMATCH],\r\n      details: {\r\n        hrmSku: hrmProduct.id,\r\n        pkgxSku: pkgxProduct.goods_sn,\r\n      },\r\n    });\r\n  }\r\n\r\n  return warnings;\r\n}\r\n\r\n/**\r\n * Main validation function\r\n */\r\nexport function validateProductMapping(\r\n  input: ProductMappingInput,\r\n  context: ProductValidationContext\r\n): ProductValidationResult {\r\n  const errors: ProductValidationError[] = [];\r\n  const warnings: ProductValidationWarning[] = [];\r\n\r\n  // 1. Required fields\r\n  errors.push(...validateRequiredFields(input));\r\n\r\n  // If required fields are missing, stop here\r\n  if (errors.length > 0) {\r\n    return { isValid: false, errors, warnings };\r\n  }\r\n\r\n  // 2. Product exists\r\n  errors.push(...validateProductExists(input, context));\r\n\r\n  // 3. Duplicate links\r\n  errors.push(...validateDuplicateLinks(input, context));\r\n\r\n  // 4. Warnings (non-blocking)\r\n  warnings.push(...checkWarnings(input, context));\r\n\r\n  return {\r\n    isValid: errors.length === 0,\r\n    errors,\r\n    warnings,\r\n  };\r\n}\r\n\r\n// ========================================\r\n// Utility Functions\r\n// ========================================\r\n\r\n/**\r\n * Normalize string for comparison\r\n */\r\nfunction normalizeString(str: string): string {\r\n  return str\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '')\r\n    .replace(/đ/g, 'd')\r\n    .replace(/[^a-z0-9\\s]/g, '')\r\n    .trim();\r\n}\r\n\r\n/**\r\n * Calculate string similarity (Jaccard index)\r\n */\r\nfunction calculateSimilarity(str1: string, str2: string): number {\r\n  const words1 = new Set(str1.split(/\\s+/).filter(w => w.length > 0));\r\n  const words2 = new Set(str2.split(/\\s+/).filter(w => w.length > 0));\r\n  \r\n  if (words1.size === 0 && words2.size === 0) return 1;\r\n  if (words1.size === 0 || words2.size === 0) return 0;\r\n  \r\n  const intersection = new Set([...words1].filter(x => words2.has(x)));\r\n  const union = new Set([...words1, ...words2]);\r\n  \r\n  return intersection.size / union.size;\r\n}\r\n\r\n/**\r\n * Suggest matching HRM products based on PKGX product name/SKU\r\n */\r\nexport function suggestMatchingProducts(\r\n  pkgxProduct: { goods_name: string; goods_sn?: string },\r\n  hrmProducts: Array<{ systemId: SystemId; name: string; id: string; pkgxId?: number }>,\r\n  limit = 5\r\n): Array<{ product: typeof hrmProducts[0]; score: number; matchType: 'sku' | 'name' }> {\r\n  const results: Array<{ product: typeof hrmProducts[0]; score: number; matchType: 'sku' | 'name' }> = [];\r\n  \r\n  // Filter out already linked products\r\n  const availableProducts = hrmProducts.filter(p => !p.pkgxId);\r\n  \r\n  // 1. SKU exact match (highest priority)\r\n  if (pkgxProduct.goods_sn) {\r\n    const skuMatch = availableProducts.find(p => p.id === pkgxProduct.goods_sn);\r\n    if (skuMatch) {\r\n      results.push({ product: skuMatch, score: 1, matchType: 'sku' });\r\n    }\r\n  }\r\n  \r\n  // 2. Name similarity\r\n  const normalizedPkgxName = normalizeString(pkgxProduct.goods_name);\r\n  \r\n  const scored = availableProducts\r\n    .filter(p => !results.some(r => r.product.systemId === p.systemId))\r\n    .map(product => ({\r\n      product,\r\n      score: calculateSimilarity(normalizedPkgxName, normalizeString(product.name)),\r\n      matchType: 'name' as const,\r\n    }))\r\n    .filter(s => s.score > 0.2);\r\n  \r\n  results.push(...scored);\r\n  \r\n  return results\r\n    .sort((a, b) => b.score - a.score)\r\n    .slice(0, limit);\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6620, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/hooks/use-product-mapping-validation.ts"],"sourcesContent":["import * as React from 'react';\r\nimport type { SystemId } from '@/lib/id-types';\r\nimport type { PkgxProduct } from '../types';\r\nimport {\r\n  validateProductMapping,\r\n  suggestMatchingProducts,\r\n  type ProductValidationResult,\r\n  type ProductValidationContext,\r\n  type ProductMappingInput,\r\n} from '../validation/product-mapping-validation';\r\n\r\ninterface UseProductMappingValidationOptions {\r\n  hrmProducts: Array<{\r\n    systemId: SystemId;\r\n    name: string;\r\n    id: string;\r\n    pkgxId?: number;\r\n    status?: string;\r\n    isActive?: boolean;\r\n  }>;\r\n  pkgxProducts: PkgxProduct[];\r\n  editingProductId?: string;\r\n  debounceMs?: number;\r\n}\r\n\r\ninterface UseProductMappingValidationReturn {\r\n  // Validation state\r\n  validationResult: ProductValidationResult | null;\r\n  isValidating: boolean;\r\n  \r\n  // Suggestions\r\n  suggestions: Array<{ product: UseProductMappingValidationOptions['hrmProducts'][0]; score: number; matchType: 'sku' | 'name' }>;\r\n  \r\n  // Actions\r\n  validate: (input: ProductMappingInput) => ProductValidationResult;\r\n  validateAsync: (input: ProductMappingInput) => Promise<ProductValidationResult>;\r\n  clearValidation: () => void;\r\n  updateSuggestions: (pkgxProduct: PkgxProduct) => void;\r\n  \r\n  // Helpers\r\n  hasErrors: boolean;\r\n  hasWarnings: boolean;\r\n  getFieldError: (field: string) => string | undefined;\r\n  getFieldWarning: (field: string) => string | undefined;\r\n}\r\n\r\n/**\r\n * Hook để quản lý validation cho product mapping/linking\r\n */\r\nexport function useProductMappingValidation(\r\n  options: UseProductMappingValidationOptions\r\n): UseProductMappingValidationReturn {\r\n  const {\r\n    hrmProducts,\r\n    pkgxProducts,\r\n    editingProductId,\r\n    debounceMs = 300,\r\n  } = options;\r\n\r\n  const [validationResult, setValidationResult] = React.useState<ProductValidationResult | null>(null);\r\n  const [isValidating, setIsValidating] = React.useState(false);\r\n  const [suggestions, setSuggestions] = React.useState<Array<{ product: typeof hrmProducts[0]; score: number; matchType: 'sku' | 'name' }>>([]);\r\n  \r\n  const debounceTimerRef = React.useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Create validation context\r\n  const context = React.useMemo((): ProductValidationContext => ({\r\n    hrmProducts,\r\n    pkgxProducts,\r\n    editingProductId,\r\n  }), [hrmProducts, pkgxProducts, editingProductId]);\r\n\r\n  // Update suggestions based on PKGX product\r\n  const updateSuggestions = React.useCallback((pkgxProduct: PkgxProduct) => {\r\n    const newSuggestions = suggestMatchingProducts(\r\n      { goods_name: pkgxProduct.goods_name, goods_sn: pkgxProduct.goods_sn },\r\n      hrmProducts\r\n    );\r\n    setSuggestions(newSuggestions);\r\n  }, [hrmProducts]);\r\n\r\n  // Sync validation\r\n  const validate = React.useCallback((input: ProductMappingInput): ProductValidationResult => {\r\n    const result = validateProductMapping(input, context);\r\n    setValidationResult(result);\r\n    return result;\r\n  }, [context]);\r\n\r\n  // Async validation with debounce\r\n  const validateAsync = React.useCallback(async (input: ProductMappingInput): Promise<ProductValidationResult> => {\r\n    return new Promise((resolve) => {\r\n      setIsValidating(true);\r\n      \r\n      if (debounceTimerRef.current) {\r\n        clearTimeout(debounceTimerRef.current);\r\n      }\r\n      \r\n      debounceTimerRef.current = setTimeout(() => {\r\n        const result = validate(input);\r\n        setIsValidating(false);\r\n        resolve(result);\r\n      }, debounceMs);\r\n    });\r\n  }, [validate, debounceMs]);\r\n\r\n  // Clear validation\r\n  const clearValidation = React.useCallback(() => {\r\n    setValidationResult(null);\r\n    setSuggestions([]);\r\n    if (debounceTimerRef.current) {\r\n      clearTimeout(debounceTimerRef.current);\r\n    }\r\n  }, []);\r\n\r\n  // Cleanup on unmount\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (debounceTimerRef.current) {\r\n        clearTimeout(debounceTimerRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Computed values\r\n  const hasErrors = validationResult ? validationResult.errors.length > 0 : false;\r\n  const hasWarnings = validationResult ? validationResult.warnings.length > 0 : false;\r\n\r\n  const getFieldError = React.useCallback((field: string): string | undefined => {\r\n    if (!validationResult) return undefined;\r\n    const error = validationResult.errors.find(e => e.field === field);\r\n    return error?.message;\r\n  }, [validationResult]);\r\n\r\n  const getFieldWarning = React.useCallback((field: string): string | undefined => {\r\n    if (!validationResult) return undefined;\r\n    const warning = validationResult.warnings.find(w => w.field === field);\r\n    return warning?.message;\r\n  }, [validationResult]);\r\n\r\n  return {\r\n    validationResult,\r\n    isValidating,\r\n    suggestions,\r\n    validate,\r\n    validateAsync,\r\n    clearValidation,\r\n    updateSuggestions,\r\n    hasErrors,\r\n    hasWarnings,\r\n    getFieldError,\r\n    getFieldWarning,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAGA;;;;AA8CO,SAAS,4BACd,OAA2C;;IAE3C,MAAM,EACJ,WAAW,EACX,YAAY,EACZ,gBAAgB,EAChB,aAAa,GAAG,EACjB,GAAG;IAEJ,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,yKAAc,CAAiC;IAC/F,MAAM,CAAC,cAAc,gBAAgB,GAAG,yKAAc,CAAC;IACvD,MAAM,CAAC,aAAa,eAAe,GAAG,yKAAc,CAAsF,EAAE;IAE5I,MAAM,mBAAmB,uKAAY,CAAwB;IAE7D,4BAA4B;IAC5B,MAAM,UAAU,wKAAa;wDAAC,IAAgC,CAAC;gBAC7D;gBACA;gBACA;YACF,CAAC;uDAAG;QAAC;QAAa;QAAc;KAAiB;IAEjD,2CAA2C;IAC3C,MAAM,oBAAoB,4KAAiB;sEAAC,CAAC;YAC3C,MAAM,iBAAiB,IAAA,4MAAuB,EAC5C;gBAAE,YAAY,YAAY,UAAU;gBAAE,UAAU,YAAY,QAAQ;YAAC,GACrE;YAEF,eAAe;QACjB;qEAAG;QAAC;KAAY;IAEhB,kBAAkB;IAClB,MAAM,WAAW,4KAAiB;6DAAC,CAAC;YAClC,MAAM,SAAS,IAAA,2MAAsB,EAAC,OAAO;YAC7C,oBAAoB;YACpB,OAAO;QACT;4DAAG;QAAC;KAAQ;IAEZ,iCAAiC;IACjC,MAAM,gBAAgB,4KAAiB;kEAAC,OAAO;YAC7C,OAAO,IAAI;0EAAQ,CAAC;oBAClB,gBAAgB;oBAEhB,IAAI,iBAAiB,OAAO,EAAE;wBAC5B,aAAa,iBAAiB,OAAO;oBACvC;oBAEA,iBAAiB,OAAO,GAAG;kFAAW;4BACpC,MAAM,SAAS,SAAS;4BACxB,gBAAgB;4BAChB,QAAQ;wBACV;iFAAG;gBACL;;QACF;iEAAG;QAAC;QAAU;KAAW;IAEzB,mBAAmB;IACnB,MAAM,kBAAkB,4KAAiB;oEAAC;YACxC,oBAAoB;YACpB,eAAe,EAAE;YACjB,IAAI,iBAAiB,OAAO,EAAE;gBAC5B,aAAa,iBAAiB,OAAO;YACvC;QACF;mEAAG,EAAE;IAEL,qBAAqB;IACrB,0KAAe;iDAAC;YACd;yDAAO;oBACL,IAAI,iBAAiB,OAAO,EAAE;wBAC5B,aAAa,iBAAiB,OAAO;oBACvC;gBACF;;QACF;gDAAG,EAAE;IAEL,kBAAkB;IAClB,MAAM,YAAY,mBAAmB,iBAAiB,MAAM,CAAC,MAAM,GAAG,IAAI;IAC1E,MAAM,cAAc,mBAAmB,iBAAiB,QAAQ,CAAC,MAAM,GAAG,IAAI;IAE9E,MAAM,gBAAgB,4KAAiB;kEAAC,CAAC;YACvC,IAAI,CAAC,kBAAkB,OAAO;YAC9B,MAAM,QAAQ,iBAAiB,MAAM,CAAC,IAAI;gFAAC,CAAA,IAAK,EAAE,KAAK,KAAK;;YAC5D,OAAO,OAAO;QAChB;iEAAG;QAAC;KAAiB;IAErB,MAAM,kBAAkB,4KAAiB;oEAAC,CAAC;YACzC,IAAI,CAAC,kBAAkB,OAAO;YAC9B,MAAM,UAAU,iBAAiB,QAAQ,CAAC,IAAI;oFAAC,CAAA,IAAK,EAAE,KAAK,KAAK;;YAChE,OAAO,SAAS;QAClB;mEAAG;QAAC;KAAiB;IAErB,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACF;AACF;GAvGgB"}},
    {"offset": {"line": 6762, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/validation/category-mapping-validation.ts"],"sourcesContent":["import type { SystemId } from '@/lib/id-types';\r\nimport type { PkgxCategoryMapping, PkgxCategory } from '../types';\r\n\r\n// ========================================\r\n// Validation Types\r\n// ========================================\r\n\r\nexport interface ValidationResult {\r\n  isValid: boolean;\r\n  errors: ValidationError[];\r\n  warnings: ValidationWarning[];\r\n}\r\n\r\nexport interface ValidationError {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface ValidationWarning {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface CategoryMappingInput {\r\n  hrmCategorySystemId: SystemId | string;\r\n  hrmCategoryName: string;\r\n  pkgxCatId: number | string;\r\n  pkgxCatName: string;\r\n}\r\n\r\n// ========================================\r\n// Error Codes\r\n// ========================================\r\n\r\nexport const CATEGORY_MAPPING_ERROR_CODES = {\r\n  // Required field errors\r\n  HRM_CATEGORY_REQUIRED: 'HRM_CATEGORY_REQUIRED',\r\n  PKGX_CATEGORY_REQUIRED: 'PKGX_CATEGORY_REQUIRED',\r\n  \r\n  // Duplicate/conflict errors\r\n  HRM_CATEGORY_ALREADY_MAPPED: 'HRM_CATEGORY_ALREADY_MAPPED',\r\n  PKGX_CATEGORY_ALREADY_MAPPED: 'PKGX_CATEGORY_ALREADY_MAPPED',\r\n  \r\n  // Not found errors\r\n  HRM_CATEGORY_NOT_FOUND: 'HRM_CATEGORY_NOT_FOUND',\r\n  PKGX_CATEGORY_NOT_FOUND: 'PKGX_CATEGORY_NOT_FOUND',\r\n  \r\n  // Inactive/deleted errors\r\n  HRM_CATEGORY_INACTIVE: 'HRM_CATEGORY_INACTIVE',\r\n  PKGX_CATEGORY_INACTIVE: 'PKGX_CATEGORY_INACTIVE',\r\n  \r\n  // Structure errors\r\n  MAPPING_TO_PARENT_CATEGORY: 'MAPPING_TO_PARENT_CATEGORY',\r\n  HIERARCHY_MISMATCH: 'HIERARCHY_MISMATCH',\r\n} as const;\r\n\r\nexport const CATEGORY_MAPPING_WARNING_CODES = {\r\n  // Suggestions\r\n  SAME_NAME_AVAILABLE: 'SAME_NAME_AVAILABLE',\r\n  PARENT_NOT_MAPPED: 'PARENT_NOT_MAPPED',\r\n  CHILD_ALREADY_MAPPED: 'CHILD_ALREADY_MAPPED',\r\n  NAME_MISMATCH: 'NAME_MISMATCH',\r\n  MANY_TO_ONE_MAPPING: 'MANY_TO_ONE_MAPPING',\r\n} as const;\r\n\r\n// ========================================\r\n// Error Messages (Vietnamese)\r\n// ========================================\r\n\r\nexport const CATEGORY_MAPPING_ERROR_MESSAGES: Record<string, string> = {\r\n  [CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_REQUIRED]: 'Vui lòng chọn danh mục HRM',\r\n  [CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_REQUIRED]: 'Vui lòng chọn danh mục PKGX',\r\n  [CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_ALREADY_MAPPED]: 'Danh mục HRM này đã được mapping với danh mục PKGX khác',\r\n  [CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_ALREADY_MAPPED]: 'Danh mục PKGX này đã được mapping với danh mục HRM khác',\r\n  [CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_NOT_FOUND]: 'Không tìm thấy danh mục HRM trong hệ thống',\r\n  [CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_NOT_FOUND]: 'Không tìm thấy danh mục PKGX (có thể đã bị xóa trên PKGX)',\r\n  [CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_INACTIVE]: 'Danh mục HRM đã bị vô hiệu hóa hoặc xóa',\r\n  [CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_INACTIVE]: 'Danh mục PKGX không hoạt động',\r\n  [CATEGORY_MAPPING_ERROR_CODES.MAPPING_TO_PARENT_CATEGORY]: 'Không nên mapping với danh mục cha. Hãy chọn danh mục con cụ thể',\r\n  [CATEGORY_MAPPING_ERROR_CODES.HIERARCHY_MISMATCH]: 'Cấp danh mục không khớp (cha/con)',\r\n};\r\n\r\nexport const CATEGORY_MAPPING_WARNING_MESSAGES: Record<string, string> = {\r\n  [CATEGORY_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE]: 'Có danh mục PKGX trùng tên, có thể bạn muốn chọn danh mục đó',\r\n  [CATEGORY_MAPPING_WARNING_CODES.PARENT_NOT_MAPPED]: 'Danh mục cha chưa được mapping. Nên mapping danh mục cha trước',\r\n  [CATEGORY_MAPPING_WARNING_CODES.CHILD_ALREADY_MAPPED]: 'Đã có danh mục con được mapping. Kiểm tra lại cấu trúc',\r\n  [CATEGORY_MAPPING_WARNING_CODES.NAME_MISMATCH]: 'Tên danh mục HRM và PKGX khác nhau đáng kể',\r\n  [CATEGORY_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING]: 'Nhiều danh mục HRM đang mapping tới cùng một danh mục PKGX',\r\n};\r\n\r\n// ========================================\r\n// Validation Context\r\n// ========================================\r\n\r\nexport interface ValidationContext {\r\n  existingMappings: PkgxCategoryMapping[];\r\n  hrmCategories: Array<{\r\n    systemId: SystemId;\r\n    name: string;\r\n    parentId?: SystemId;\r\n    status?: string;\r\n    isActive?: boolean;\r\n    path?: string;\r\n  }>;\r\n  pkgxCategories: PkgxCategory[];\r\n  editingMappingId?: string; // ID của mapping đang edit (để exclude khỏi duplicate check)\r\n}\r\n\r\n// ========================================\r\n// Validation Functions\r\n// ========================================\r\n\r\n/**\r\n * Validate required fields\r\n */\r\nexport function validateRequiredFields(input: CategoryMappingInput): ValidationError[] {\r\n  const errors: ValidationError[] = [];\r\n\r\n  if (!input.hrmCategorySystemId) {\r\n    errors.push({\r\n      code: CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_REQUIRED,\r\n      field: 'hrmCategorySystemId',\r\n      message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_REQUIRED],\r\n    });\r\n  }\r\n\r\n  if (!input.pkgxCatId) {\r\n    errors.push({\r\n      code: CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_REQUIRED,\r\n      field: 'pkgxCatId',\r\n      message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_REQUIRED],\r\n    });\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate category exists\r\n */\r\nexport function validateCategoryExists(\r\n  input: CategoryMappingInput,\r\n  context: ValidationContext\r\n): ValidationError[] {\r\n  const errors: ValidationError[] = [];\r\n\r\n  if (input.hrmCategorySystemId) {\r\n    const hrmCat = context.hrmCategories.find(c => c.systemId === input.hrmCategorySystemId);\r\n    if (!hrmCat) {\r\n      errors.push({\r\n        code: CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_NOT_FOUND,\r\n        field: 'hrmCategorySystemId',\r\n        message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_NOT_FOUND],\r\n        details: { systemId: input.hrmCategorySystemId },\r\n      });\r\n    } else if (hrmCat.status === 'inactive' || hrmCat.isActive === false) {\r\n      errors.push({\r\n        code: CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_INACTIVE,\r\n        field: 'hrmCategorySystemId',\r\n        message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_INACTIVE],\r\n        details: { systemId: input.hrmCategorySystemId, name: hrmCat.name },\r\n      });\r\n    }\r\n  }\r\n\r\n  if (input.pkgxCatId) {\r\n    const pkgxCat = context.pkgxCategories.find(c => c.id === input.pkgxCatId);\r\n    if (!pkgxCat) {\r\n      errors.push({\r\n        code: CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_NOT_FOUND,\r\n        field: 'pkgxCatId',\r\n        message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_NOT_FOUND],\r\n        details: { pkgxCatId: input.pkgxCatId },\r\n      });\r\n    }\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate duplicate mappings\r\n */\r\nexport function validateDuplicateMappings(\r\n  input: CategoryMappingInput,\r\n  context: ValidationContext\r\n): ValidationError[] {\r\n  const errors: ValidationError[] = [];\r\n\r\n  if (input.hrmCategorySystemId) {\r\n    const existingHrmMapping = context.existingMappings.find(\r\n      m => m.hrmCategorySystemId === input.hrmCategorySystemId && m.id !== context.editingMappingId\r\n    );\r\n    if (existingHrmMapping) {\r\n      errors.push({\r\n        code: CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_ALREADY_MAPPED,\r\n        field: 'hrmCategorySystemId',\r\n        message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_ALREADY_MAPPED],\r\n        details: {\r\n          existingMapping: existingHrmMapping,\r\n          mappedTo: existingHrmMapping.pkgxCatName,\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // Note: PKGX category có thể mapping với nhiều HRM category (one-to-many)\r\n  // Nhưng vẫn cảnh báo nếu đã có mapping khác\r\n  \r\n  return errors;\r\n}\r\n\r\n/**\r\n * Check for warnings (không block nhưng cảnh báo)\r\n */\r\nexport function checkWarnings(\r\n  input: CategoryMappingInput,\r\n  context: ValidationContext\r\n): ValidationWarning[] {\r\n  const warnings: ValidationWarning[] = [];\r\n\r\n  if (!input.hrmCategorySystemId || !input.pkgxCatId) {\r\n    return warnings;\r\n  }\r\n\r\n  const hrmCat = context.hrmCategories.find(c => c.systemId === input.hrmCategorySystemId);\r\n  const pkgxCat = context.pkgxCategories.find(c => c.id === input.pkgxCatId);\r\n\r\n  if (!hrmCat || !pkgxCat) return warnings;\r\n\r\n  // 1. Check name mismatch\r\n  const normalizedHrmName = normalizeString(hrmCat.name);\r\n  const normalizedPkgxName = normalizeString(pkgxCat.name);\r\n  const similarity = calculateSimilarity(normalizedHrmName, normalizedPkgxName);\r\n  \r\n  if (similarity < 0.5) {\r\n    warnings.push({\r\n      code: CATEGORY_MAPPING_WARNING_CODES.NAME_MISMATCH,\r\n      message: CATEGORY_MAPPING_WARNING_MESSAGES[CATEGORY_MAPPING_WARNING_CODES.NAME_MISMATCH],\r\n      details: { \r\n        hrmName: hrmCat.name, \r\n        pkgxName: pkgxCat.name,\r\n        similarity: Math.round(similarity * 100) + '%',\r\n      },\r\n    });\r\n  }\r\n\r\n  // 2. Check if same name exists in PKGX\r\n  const sameNamePkgx = context.pkgxCategories.find(\r\n    c => c.id !== input.pkgxCatId && normalizeString(c.name) === normalizedHrmName\r\n  );\r\n  if (sameNamePkgx) {\r\n    warnings.push({\r\n      code: CATEGORY_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE,\r\n      message: CATEGORY_MAPPING_WARNING_MESSAGES[CATEGORY_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE],\r\n      details: {\r\n        suggestedCategory: sameNamePkgx,\r\n      },\r\n    });\r\n  }\r\n\r\n  // 3. Check if parent category is not mapped (for HRM categories with parent)\r\n  if (hrmCat.parentId) {\r\n    const parentMapping = context.existingMappings.find(\r\n      m => m.hrmCategorySystemId === hrmCat.parentId\r\n    );\r\n    if (!parentMapping) {\r\n      const parentCat = context.hrmCategories.find(c => c.systemId === hrmCat.parentId);\r\n      if (parentCat) {\r\n        warnings.push({\r\n          code: CATEGORY_MAPPING_WARNING_CODES.PARENT_NOT_MAPPED,\r\n          message: CATEGORY_MAPPING_WARNING_MESSAGES[CATEGORY_MAPPING_WARNING_CODES.PARENT_NOT_MAPPED],\r\n          details: {\r\n            parentName: parentCat.name,\r\n            parentId: hrmCat.parentId,\r\n          },\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  // 4. Check many-to-one mapping\r\n  const otherMappingsToSamePkgx = context.existingMappings.filter(\r\n    m => m.pkgxCatId === input.pkgxCatId && m.id !== context.editingMappingId\r\n  );\r\n  if (otherMappingsToSamePkgx.length > 0) {\r\n    warnings.push({\r\n      code: CATEGORY_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING,\r\n      message: CATEGORY_MAPPING_WARNING_MESSAGES[CATEGORY_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING],\r\n      details: {\r\n        count: otherMappingsToSamePkgx.length + 1,\r\n        existingMappings: otherMappingsToSamePkgx.map(m => m.hrmCategoryName),\r\n      },\r\n    });\r\n  }\r\n\r\n  // 5. Check if mapping to parent category when children exist\r\n  const pkgxChildren = context.pkgxCategories.filter(c => c.parentId === pkgxCat.id);\r\n  if (pkgxChildren.length > 0) {\r\n    warnings.push({\r\n      code: CATEGORY_MAPPING_WARNING_CODES.CHILD_ALREADY_MAPPED,\r\n      message: 'Danh mục PKGX này có danh mục con. Cân nhắc mapping với danh mục con cụ thể',\r\n      details: {\r\n        childCount: pkgxChildren.length,\r\n        children: pkgxChildren.slice(0, 5).map(c => c.name),\r\n      },\r\n    });\r\n  }\r\n\r\n  return warnings;\r\n}\r\n\r\n/**\r\n * Main validation function\r\n */\r\nexport function validateCategoryMapping(\r\n  input: CategoryMappingInput,\r\n  context: ValidationContext\r\n): ValidationResult {\r\n  const errors: ValidationError[] = [];\r\n  const warnings: ValidationWarning[] = [];\r\n\r\n  // 1. Required fields\r\n  errors.push(...validateRequiredFields(input));\r\n\r\n  // If required fields are missing, stop here\r\n  if (errors.length > 0) {\r\n    return { isValid: false, errors, warnings };\r\n  }\r\n\r\n  // 2. Category exists\r\n  errors.push(...validateCategoryExists(input, context));\r\n\r\n  // 3. Duplicate mappings\r\n  errors.push(...validateDuplicateMappings(input, context));\r\n\r\n  // 4. Warnings (non-blocking)\r\n  warnings.push(...checkWarnings(input, context));\r\n\r\n  return {\r\n    isValid: errors.length === 0,\r\n    errors,\r\n    warnings,\r\n  };\r\n}\r\n\r\n// ========================================\r\n// Utility Functions\r\n// ========================================\r\n\r\n/**\r\n * Normalize string for comparison\r\n */\r\nfunction normalizeString(str: string): string {\r\n  return str\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '') // Remove diacritics\r\n    .replace(/đ/g, 'd')\r\n    .replace(/[^a-z0-9\\s]/g, '')\r\n    .trim();\r\n}\r\n\r\n/**\r\n * Calculate string similarity (Jaccard index)\r\n */\r\nfunction calculateSimilarity(str1: string, str2: string): number {\r\n  const words1 = new Set(str1.split(/\\s+/).filter(w => w.length > 0));\r\n  const words2 = new Set(str2.split(/\\s+/).filter(w => w.length > 0));\r\n  \r\n  if (words1.size === 0 && words2.size === 0) return 1;\r\n  if (words1.size === 0 || words2.size === 0) return 0;\r\n  \r\n  const intersection = new Set([...words1].filter(x => words2.has(x)));\r\n  const union = new Set([...words1, ...words2]);\r\n  \r\n  return intersection.size / union.size;\r\n}\r\n\r\n/**\r\n * Suggest matching categories based on name\r\n */\r\nexport function suggestMatchingCategories(\r\n  hrmCategoryName: string,\r\n  pkgxCategories: PkgxCategory[],\r\n  limit = 5\r\n): Array<{ category: PkgxCategory; score: number }> {\r\n  const normalizedInput = normalizeString(hrmCategoryName);\r\n  \r\n  const scored = pkgxCategories.map(cat => ({\r\n    category: cat,\r\n    score: calculateSimilarity(normalizedInput, normalizeString(cat.name)),\r\n  }));\r\n  \r\n  return scored\r\n    .filter(s => s.score > 0.2)\r\n    .sort((a, b) => b.score - a.score)\r\n    .slice(0, limit);\r\n}\r\n\r\n/**\r\n * Find potential duplicate mappings\r\n */\r\nexport function findPotentialDuplicates(\r\n  mappings: PkgxCategoryMapping[]\r\n): Array<{ pkgxCatId: number; mappings: PkgxCategoryMapping[] }> {\r\n  const grouped = new Map<number, PkgxCategoryMapping[]>();\r\n  \r\n  for (const mapping of mappings) {\r\n    const existing = grouped.get(mapping.pkgxCatId) || [];\r\n    existing.push(mapping);\r\n    grouped.set(mapping.pkgxCatId, existing);\r\n  }\r\n  \r\n  return Array.from(grouped.entries())\r\n    .filter(([, mappings]) => mappings.length > 1)\r\n    .map(([pkgxCatId, mappings]) => ({ pkgxCatId, mappings }));\r\n}\r\n\r\n// ========================================\r\n// Batch Validation\r\n// ========================================\r\n\r\nexport interface BatchValidationResult {\r\n  valid: CategoryMappingInput[];\r\n  invalid: Array<{ input: CategoryMappingInput; errors: ValidationError[] }>;\r\n  withWarnings: Array<{ input: CategoryMappingInput; warnings: ValidationWarning[] }>;\r\n  summary: {\r\n    total: number;\r\n    validCount: number;\r\n    invalidCount: number;\r\n    warningCount: number;\r\n  };\r\n}\r\n\r\n/**\r\n * Validate multiple mappings at once\r\n */\r\nexport function validateBatchMappings(\r\n  inputs: CategoryMappingInput[],\r\n  context: ValidationContext\r\n): BatchValidationResult {\r\n  const valid: CategoryMappingInput[] = [];\r\n  const invalid: Array<{ input: CategoryMappingInput; errors: ValidationError[] }> = [];\r\n  const withWarnings: Array<{ input: CategoryMappingInput; warnings: ValidationWarning[] }> = [];\r\n\r\n  // Check for duplicates within the batch itself\r\n  const hrmIdsSeen = new Set<string>();\r\n  \r\n  for (const input of inputs) {\r\n    // Check batch internal duplicates\r\n    if (input.hrmCategorySystemId && hrmIdsSeen.has(input.hrmCategorySystemId)) {\r\n      invalid.push({\r\n        input,\r\n        errors: [{\r\n          code: CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_ALREADY_MAPPED,\r\n          field: 'hrmCategorySystemId',\r\n          message: 'Danh mục HRM này xuất hiện nhiều lần trong danh sách import',\r\n        }],\r\n      });\r\n      continue;\r\n    }\r\n    \r\n    if (input.hrmCategorySystemId) {\r\n      hrmIdsSeen.add(input.hrmCategorySystemId);\r\n    }\r\n    \r\n    const result = validateCategoryMapping(input, context);\r\n    \r\n    if (!result.isValid) {\r\n      invalid.push({ input, errors: result.errors });\r\n    } else {\r\n      valid.push(input);\r\n      if (result.warnings.length > 0) {\r\n        withWarnings.push({ input, warnings: result.warnings });\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    valid,\r\n    invalid,\r\n    withWarnings,\r\n    summary: {\r\n      total: inputs.length,\r\n      validCount: valid.length,\r\n      invalidCount: invalid.length,\r\n      warningCount: withWarnings.length,\r\n    },\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7116, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/validation/brand-mapping-validation.ts"],"sourcesContent":["import type { SystemId } from '@/lib/id-types';\r\nimport type { PkgxBrandMapping, PkgxBrand } from '../types';\r\n\r\n// ========================================\r\n// Validation Types\r\n// ========================================\r\n\r\nexport interface BrandValidationResult {\r\n  isValid: boolean;\r\n  errors: BrandValidationError[];\r\n  warnings: BrandValidationWarning[];\r\n}\r\n\r\nexport interface BrandValidationError {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface BrandValidationWarning {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface BrandMappingInput {\r\n  hrmBrandSystemId: SystemId | string;\r\n  hrmBrandName: string;\r\n  pkgxBrandId: number | string;\r\n  pkgxBrandName: string;\r\n}\r\n\r\n// ========================================\r\n// Error Codes\r\n// ========================================\r\n\r\nexport const BRAND_MAPPING_ERROR_CODES = {\r\n  // Required field errors\r\n  HRM_BRAND_REQUIRED: 'HRM_BRAND_REQUIRED',\r\n  PKGX_BRAND_REQUIRED: 'PKGX_BRAND_REQUIRED',\r\n  \r\n  // Duplicate/conflict errors\r\n  HRM_BRAND_ALREADY_MAPPED: 'HRM_BRAND_ALREADY_MAPPED',\r\n  PKGX_BRAND_ALREADY_MAPPED: 'PKGX_BRAND_ALREADY_MAPPED',\r\n  \r\n  // Not found errors\r\n  HRM_BRAND_NOT_FOUND: 'HRM_BRAND_NOT_FOUND',\r\n  PKGX_BRAND_NOT_FOUND: 'PKGX_BRAND_NOT_FOUND',\r\n  \r\n  // Inactive/deleted errors\r\n  HRM_BRAND_INACTIVE: 'HRM_BRAND_INACTIVE',\r\n} as const;\r\n\r\nexport const BRAND_MAPPING_WARNING_CODES = {\r\n  // Suggestions\r\n  SAME_NAME_AVAILABLE: 'SAME_NAME_AVAILABLE',\r\n  NAME_MISMATCH: 'NAME_MISMATCH',\r\n  MANY_TO_ONE_MAPPING: 'MANY_TO_ONE_MAPPING',\r\n} as const;\r\n\r\n// ========================================\r\n// Error Messages (Vietnamese)\r\n// ========================================\r\n\r\nexport const BRAND_MAPPING_ERROR_MESSAGES: Record<string, string> = {\r\n  [BRAND_MAPPING_ERROR_CODES.HRM_BRAND_REQUIRED]: 'Vui lòng chọn thương hiệu HRM',\r\n  [BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_REQUIRED]: 'Vui lòng chọn thương hiệu PKGX',\r\n  [BRAND_MAPPING_ERROR_CODES.HRM_BRAND_ALREADY_MAPPED]: 'Thương hiệu HRM này đã được mapping với thương hiệu PKGX khác',\r\n  [BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_ALREADY_MAPPED]: 'Thương hiệu PKGX này đã được mapping với thương hiệu HRM khác',\r\n  [BRAND_MAPPING_ERROR_CODES.HRM_BRAND_NOT_FOUND]: 'Không tìm thấy thương hiệu HRM trong hệ thống',\r\n  [BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_NOT_FOUND]: 'Không tìm thấy thương hiệu PKGX (có thể đã bị xóa trên PKGX)',\r\n  [BRAND_MAPPING_ERROR_CODES.HRM_BRAND_INACTIVE]: 'Thương hiệu HRM đã bị vô hiệu hóa hoặc xóa',\r\n};\r\n\r\nexport const BRAND_MAPPING_WARNING_MESSAGES: Record<string, string> = {\r\n  [BRAND_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE]: 'Có thương hiệu PKGX trùng tên, có thể bạn muốn chọn thương hiệu đó',\r\n  [BRAND_MAPPING_WARNING_CODES.NAME_MISMATCH]: 'Tên thương hiệu HRM và PKGX khác nhau đáng kể',\r\n  [BRAND_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING]: 'Nhiều thương hiệu HRM đang mapping tới cùng một thương hiệu PKGX',\r\n};\r\n\r\n// ========================================\r\n// Validation Context\r\n// ========================================\r\n\r\nexport interface BrandValidationContext {\r\n  existingMappings: PkgxBrandMapping[];\r\n  hrmBrands: Array<{\r\n    systemId: SystemId;\r\n    name: string;\r\n    status?: string;\r\n    isActive?: boolean;\r\n  }>;\r\n  pkgxBrands: PkgxBrand[];\r\n  editingMappingId?: string;\r\n}\r\n\r\n// ========================================\r\n// Validation Functions\r\n// ========================================\r\n\r\n/**\r\n * Validate required fields\r\n */\r\nexport function validateRequiredFields(input: BrandMappingInput): BrandValidationError[] {\r\n  const errors: BrandValidationError[] = [];\r\n\r\n  if (!input.hrmBrandSystemId) {\r\n    errors.push({\r\n      code: BRAND_MAPPING_ERROR_CODES.HRM_BRAND_REQUIRED,\r\n      field: 'hrmBrandSystemId',\r\n      message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.HRM_BRAND_REQUIRED],\r\n    });\r\n  }\r\n\r\n  if (!input.pkgxBrandId) {\r\n    errors.push({\r\n      code: BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_REQUIRED,\r\n      field: 'pkgxBrandId',\r\n      message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_REQUIRED],\r\n    });\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate brand exists\r\n */\r\nexport function validateBrandExists(\r\n  input: BrandMappingInput,\r\n  context: BrandValidationContext\r\n): BrandValidationError[] {\r\n  const errors: BrandValidationError[] = [];\r\n\r\n  if (input.hrmBrandSystemId) {\r\n    const hrmBrand = context.hrmBrands.find(b => b.systemId === input.hrmBrandSystemId);\r\n    if (!hrmBrand) {\r\n      errors.push({\r\n        code: BRAND_MAPPING_ERROR_CODES.HRM_BRAND_NOT_FOUND,\r\n        field: 'hrmBrandSystemId',\r\n        message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.HRM_BRAND_NOT_FOUND],\r\n        details: { systemId: input.hrmBrandSystemId },\r\n      });\r\n    } else if (hrmBrand.status === 'inactive' || hrmBrand.isActive === false) {\r\n      errors.push({\r\n        code: BRAND_MAPPING_ERROR_CODES.HRM_BRAND_INACTIVE,\r\n        field: 'hrmBrandSystemId',\r\n        message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.HRM_BRAND_INACTIVE],\r\n        details: { systemId: input.hrmBrandSystemId, name: hrmBrand.name },\r\n      });\r\n    }\r\n  }\r\n\r\n  if (input.pkgxBrandId) {\r\n    const pkgxBrand = context.pkgxBrands.find(b => b.id === input.pkgxBrandId);\r\n    if (!pkgxBrand) {\r\n      errors.push({\r\n        code: BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_NOT_FOUND,\r\n        field: 'pkgxBrandId',\r\n        message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_NOT_FOUND],\r\n        details: { pkgxBrandId: input.pkgxBrandId },\r\n      });\r\n    }\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate duplicate mappings\r\n */\r\nexport function validateDuplicateMappings(\r\n  input: BrandMappingInput,\r\n  context: BrandValidationContext\r\n): BrandValidationError[] {\r\n  const errors: BrandValidationError[] = [];\r\n\r\n  if (input.hrmBrandSystemId) {\r\n    const existingHrmMapping = context.existingMappings.find(\r\n      m => m.hrmBrandSystemId === input.hrmBrandSystemId && m.id !== context.editingMappingId\r\n    );\r\n    if (existingHrmMapping) {\r\n      errors.push({\r\n        code: BRAND_MAPPING_ERROR_CODES.HRM_BRAND_ALREADY_MAPPED,\r\n        field: 'hrmBrandSystemId',\r\n        message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.HRM_BRAND_ALREADY_MAPPED],\r\n        details: {\r\n          existingMapping: existingHrmMapping,\r\n          mappedTo: existingHrmMapping.pkgxBrandName,\r\n        },\r\n      });\r\n    }\r\n  }\r\n  \r\n  return errors;\r\n}\r\n\r\n/**\r\n * Check for warnings (không block nhưng cảnh báo)\r\n */\r\nexport function checkWarnings(\r\n  input: BrandMappingInput,\r\n  context: BrandValidationContext\r\n): BrandValidationWarning[] {\r\n  const warnings: BrandValidationWarning[] = [];\r\n\r\n  if (!input.hrmBrandSystemId || !input.pkgxBrandId) {\r\n    return warnings;\r\n  }\r\n\r\n  const hrmBrand = context.hrmBrands.find(b => b.systemId === input.hrmBrandSystemId);\r\n  const pkgxBrand = context.pkgxBrands.find(b => b.id === input.pkgxBrandId);\r\n\r\n  if (!hrmBrand || !pkgxBrand) return warnings;\r\n\r\n  // 1. Check name mismatch\r\n  const normalizedHrmName = normalizeString(hrmBrand.name);\r\n  const normalizedPkgxName = normalizeString(pkgxBrand.name);\r\n  const similarity = calculateSimilarity(normalizedHrmName, normalizedPkgxName);\r\n  \r\n  if (similarity < 0.5) {\r\n    warnings.push({\r\n      code: BRAND_MAPPING_WARNING_CODES.NAME_MISMATCH,\r\n      message: BRAND_MAPPING_WARNING_MESSAGES[BRAND_MAPPING_WARNING_CODES.NAME_MISMATCH],\r\n      details: { \r\n        hrmName: hrmBrand.name, \r\n        pkgxName: pkgxBrand.name,\r\n        similarity: Math.round(similarity * 100) + '%',\r\n      },\r\n    });\r\n  }\r\n\r\n  // 2. Check if same name exists in PKGX\r\n  const sameNamePkgx = context.pkgxBrands.find(\r\n    b => b.id !== input.pkgxBrandId && normalizeString(b.name) === normalizedHrmName\r\n  );\r\n  if (sameNamePkgx) {\r\n    warnings.push({\r\n      code: BRAND_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE,\r\n      message: BRAND_MAPPING_WARNING_MESSAGES[BRAND_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE],\r\n      details: {\r\n        suggestedBrand: sameNamePkgx,\r\n      },\r\n    });\r\n  }\r\n\r\n  // 3. Check many-to-one mapping\r\n  const otherMappingsToSamePkgx = context.existingMappings.filter(\r\n    m => m.pkgxBrandId === input.pkgxBrandId && m.id !== context.editingMappingId\r\n  );\r\n  if (otherMappingsToSamePkgx.length > 0) {\r\n    warnings.push({\r\n      code: BRAND_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING,\r\n      message: BRAND_MAPPING_WARNING_MESSAGES[BRAND_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING],\r\n      details: {\r\n        count: otherMappingsToSamePkgx.length + 1,\r\n        existingMappings: otherMappingsToSamePkgx.map(m => m.hrmBrandName),\r\n      },\r\n    });\r\n  }\r\n\r\n  return warnings;\r\n}\r\n\r\n/**\r\n * Main validation function\r\n */\r\nexport function validateBrandMapping(\r\n  input: BrandMappingInput,\r\n  context: BrandValidationContext\r\n): BrandValidationResult {\r\n  const errors: BrandValidationError[] = [];\r\n  const warnings: BrandValidationWarning[] = [];\r\n\r\n  // 1. Required fields\r\n  errors.push(...validateRequiredFields(input));\r\n\r\n  // If required fields are missing, stop here\r\n  if (errors.length > 0) {\r\n    return { isValid: false, errors, warnings };\r\n  }\r\n\r\n  // 2. Brand exists\r\n  errors.push(...validateBrandExists(input, context));\r\n\r\n  // 3. Duplicate mappings\r\n  errors.push(...validateDuplicateMappings(input, context));\r\n\r\n  // 4. Warnings (non-blocking)\r\n  warnings.push(...checkWarnings(input, context));\r\n\r\n  return {\r\n    isValid: errors.length === 0,\r\n    errors,\r\n    warnings,\r\n  };\r\n}\r\n\r\n// ========================================\r\n// Utility Functions\r\n// ========================================\r\n\r\n/**\r\n * Normalize string for comparison\r\n */\r\nfunction normalizeString(str: string): string {\r\n  return str\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '')\r\n    .replace(/đ/g, 'd')\r\n    .replace(/[^a-z0-9\\s]/g, '')\r\n    .trim();\r\n}\r\n\r\n/**\r\n * Calculate string similarity (Jaccard index)\r\n */\r\nfunction calculateSimilarity(str1: string, str2: string): number {\r\n  const words1 = new Set(str1.split(/\\s+/).filter(w => w.length > 0));\r\n  const words2 = new Set(str2.split(/\\s+/).filter(w => w.length > 0));\r\n  \r\n  if (words1.size === 0 && words2.size === 0) return 1;\r\n  if (words1.size === 0 || words2.size === 0) return 0;\r\n  \r\n  const intersection = new Set([...words1].filter(x => words2.has(x)));\r\n  const union = new Set([...words1, ...words2]);\r\n  \r\n  return intersection.size / union.size;\r\n}\r\n\r\n/**\r\n * Suggest matching brands based on name\r\n */\r\nexport function suggestMatchingBrands(\r\n  hrmBrandName: string,\r\n  pkgxBrands: PkgxBrand[],\r\n  limit = 5\r\n): Array<{ brand: PkgxBrand; score: number }> {\r\n  const normalizedInput = normalizeString(hrmBrandName);\r\n  \r\n  const scored = pkgxBrands.map(brand => ({\r\n    brand,\r\n    score: calculateSimilarity(normalizedInput, normalizeString(brand.name)),\r\n  }));\r\n  \r\n  return scored\r\n    .filter(s => s.score > 0.2)\r\n    .sort((a, b) => b.score - a.score)\r\n    .slice(0, limit);\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7359, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/validation/index.ts"],"sourcesContent":["// Category Mapping Validation\r\nexport {\r\n  // Types\r\n  type ValidationResult,\r\n  type ValidationError,\r\n  type ValidationWarning,\r\n  type CategoryMappingInput,\r\n  type ValidationContext,\r\n  type BatchValidationResult,\r\n  \r\n  // Error/Warning codes\r\n  CATEGORY_MAPPING_ERROR_CODES,\r\n  CATEGORY_MAPPING_WARNING_CODES,\r\n  CATEGORY_MAPPING_ERROR_MESSAGES,\r\n  CATEGORY_MAPPING_WARNING_MESSAGES,\r\n  \r\n  // Validation functions\r\n  validateCategoryMapping,\r\n  validateRequiredFields,\r\n  validateCategoryExists,\r\n  validateDuplicateMappings,\r\n  checkWarnings,\r\n  validateBatchMappings,\r\n  \r\n  // Utilities\r\n  suggestMatchingCategories,\r\n  findPotentialDuplicates,\r\n} from './category-mapping-validation';\r\n\r\n// Brand Mapping Validation\r\nexport {\r\n  // Types\r\n  type BrandValidationResult,\r\n  type BrandValidationError,\r\n  type BrandValidationWarning,\r\n  type BrandMappingInput,\r\n  type BrandValidationContext,\r\n  \r\n  // Error/Warning codes\r\n  BRAND_MAPPING_ERROR_CODES,\r\n  BRAND_MAPPING_WARNING_CODES,\r\n  BRAND_MAPPING_ERROR_MESSAGES,\r\n  BRAND_MAPPING_WARNING_MESSAGES,\r\n  \r\n  // Validation functions\r\n  validateBrandMapping,\r\n  validateRequiredFields as validateBrandRequiredFields,\r\n  validateBrandExists,\r\n  validateDuplicateMappings as validateBrandDuplicateMappings,\r\n  checkWarnings as checkBrandWarnings,\r\n  \r\n  // Utilities\r\n  suggestMatchingBrands,\r\n} from './brand-mapping-validation';\r\n\r\n// Product Mapping Validation\r\nexport {\r\n  // Types\r\n  type ProductValidationResult,\r\n  type ProductValidationError,\r\n  type ProductValidationWarning,\r\n  type ProductMappingInput,\r\n  type ProductValidationContext,\r\n  \r\n  // Error/Warning codes\r\n  PRODUCT_MAPPING_ERROR_CODES,\r\n  PRODUCT_MAPPING_WARNING_CODES,\r\n  PRODUCT_MAPPING_ERROR_MESSAGES,\r\n  PRODUCT_MAPPING_WARNING_MESSAGES,\r\n  \r\n  // Validation functions\r\n  validateProductMapping,\r\n  validateRequiredFields as validateProductRequiredFields,\r\n  validateProductExists,\r\n  validateDuplicateLinks,\r\n  checkWarnings as checkProductWarnings,\r\n  \r\n  // Utilities\r\n  suggestMatchingProducts,\r\n} from './product-mapping-validation';\r\n"],"names":[],"mappings":";AAAA,8BAA8B;AAC9B;AA4BA,2BAA2B;AAC3B;AAyBA,6BAA6B;AAC7B"}},
    {"offset": {"line": 7376, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/hooks/use-category-mapping-validation.ts"],"sourcesContent":["import * as React from 'react';\r\nimport type { SystemId } from '@/lib/id-types';\r\nimport type { PkgxCategoryMapping, PkgxCategory } from '../types';\r\nimport {\r\n  validateCategoryMapping,\r\n  suggestMatchingCategories,\r\n  type ValidationResult,\r\n  type ValidationContext,\r\n  type CategoryMappingInput,\r\n} from '../validation';\r\n\r\ninterface UseCategoryMappingValidationOptions {\r\n  existingMappings: PkgxCategoryMapping[];\r\n  hrmCategories: Array<{\r\n    systemId: SystemId;\r\n    name: string;\r\n    parentId?: SystemId;\r\n    status?: string;\r\n    isActive?: boolean;\r\n    path?: string;\r\n  }>;\r\n  pkgxCategories: PkgxCategory[];\r\n  editingMappingId?: string;\r\n  debounceMs?: number;\r\n}\r\n\r\ninterface UseCategoryMappingValidationReturn {\r\n  // Validation state\r\n  validationResult: ValidationResult | null;\r\n  isValidating: boolean;\r\n  \r\n  // Suggestions\r\n  suggestions: Array<{ category: PkgxCategory; score: number }>;\r\n  \r\n  // Actions\r\n  validate: (input: CategoryMappingInput) => ValidationResult;\r\n  validateAsync: (input: CategoryMappingInput) => Promise<ValidationResult>;\r\n  clearValidation: () => void;\r\n  \r\n  // Helpers\r\n  hasErrors: boolean;\r\n  hasWarnings: boolean;\r\n  getFieldError: (field: string) => string | undefined;\r\n  getFieldWarning: (field: string) => string | undefined;\r\n}\r\n\r\n/**\r\n * Hook để quản lý validation cho category mapping\r\n */\r\nexport function useCategoryMappingValidation(\r\n  options: UseCategoryMappingValidationOptions\r\n): UseCategoryMappingValidationReturn {\r\n  const {\r\n    existingMappings,\r\n    hrmCategories,\r\n    pkgxCategories,\r\n    editingMappingId,\r\n    debounceMs = 300,\r\n  } = options;\r\n\r\n  const [validationResult, setValidationResult] = React.useState<ValidationResult | null>(null);\r\n  const [isValidating, setIsValidating] = React.useState(false);\r\n  const [suggestions, setSuggestions] = React.useState<Array<{ category: PkgxCategory; score: number }>>([]);\r\n  \r\n  const debounceTimerRef = React.useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Create validation context\r\n  const context = React.useMemo((): ValidationContext => ({\r\n    existingMappings,\r\n    hrmCategories,\r\n    pkgxCategories,\r\n    editingMappingId,\r\n  }), [existingMappings, hrmCategories, pkgxCategories, editingMappingId]);\r\n\r\n  // Sync validation\r\n  const validate = React.useCallback((input: CategoryMappingInput): ValidationResult => {\r\n    const result = validateCategoryMapping(input, context);\r\n    setValidationResult(result);\r\n    \r\n    // Update suggestions based on HRM category name\r\n    if (input.hrmCategorySystemId) {\r\n      const hrmCat = hrmCategories.find(c => c.systemId === input.hrmCategorySystemId);\r\n      if (hrmCat) {\r\n        const newSuggestions = suggestMatchingCategories(hrmCat.name, pkgxCategories);\r\n        setSuggestions(newSuggestions);\r\n      }\r\n    }\r\n    \r\n    return result;\r\n  }, [context, hrmCategories, pkgxCategories]);\r\n\r\n  // Async validation with debounce\r\n  const validateAsync = React.useCallback(async (input: CategoryMappingInput): Promise<ValidationResult> => {\r\n    return new Promise((resolve) => {\r\n      setIsValidating(true);\r\n      \r\n      if (debounceTimerRef.current) {\r\n        clearTimeout(debounceTimerRef.current);\r\n      }\r\n      \r\n      debounceTimerRef.current = setTimeout(() => {\r\n        const result = validate(input);\r\n        setIsValidating(false);\r\n        resolve(result);\r\n      }, debounceMs);\r\n    });\r\n  }, [validate, debounceMs]);\r\n\r\n  // Clear validation\r\n  const clearValidation = React.useCallback(() => {\r\n    setValidationResult(null);\r\n    setSuggestions([]);\r\n    if (debounceTimerRef.current) {\r\n      clearTimeout(debounceTimerRef.current);\r\n    }\r\n  }, []);\r\n\r\n  // Cleanup on unmount\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (debounceTimerRef.current) {\r\n        clearTimeout(debounceTimerRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Computed values\r\n  const hasErrors = validationResult ? validationResult.errors.length > 0 : false;\r\n  const hasWarnings = validationResult ? validationResult.warnings.length > 0 : false;\r\n\r\n  const getFieldError = React.useCallback((field: string): string | undefined => {\r\n    if (!validationResult) return undefined;\r\n    const error = validationResult.errors.find(e => e.field === field);\r\n    return error?.message;\r\n  }, [validationResult]);\r\n\r\n  const getFieldWarning = React.useCallback((field: string): string | undefined => {\r\n    if (!validationResult) return undefined;\r\n    const warning = validationResult.warnings.find(w => w.field === field);\r\n    return warning?.message;\r\n  }, [validationResult]);\r\n\r\n  return {\r\n    validationResult,\r\n    isValidating,\r\n    suggestions,\r\n    validate,\r\n    validateAsync,\r\n    clearValidation,\r\n    hasErrors,\r\n    hasWarnings,\r\n    getFieldError,\r\n    getFieldWarning,\r\n  };\r\n}\r\n\r\n/**\r\n * Hook đơn giản để validate một field\r\n */\r\nexport function useFieldValidation<T>(\r\n  validator: (value: T) => string | undefined,\r\n  initialValue?: T\r\n) {\r\n  const [error, setError] = React.useState<string | undefined>();\r\n  const [touched, setTouched] = React.useState(false);\r\n\r\n  const validate = React.useCallback((value: T) => {\r\n    const errorMessage = validator(value);\r\n    setError(errorMessage);\r\n    return !errorMessage;\r\n  }, [validator]);\r\n\r\n  const handleBlur = React.useCallback(() => {\r\n    setTouched(true);\r\n  }, []);\r\n\r\n  const reset = React.useCallback(() => {\r\n    setError(undefined);\r\n    setTouched(false);\r\n  }, []);\r\n\r\n  // Validate initial value\r\n  React.useEffect(() => {\r\n    if (initialValue !== undefined) {\r\n      validate(initialValue);\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    error: touched ? error : undefined,\r\n    touched,\r\n    validate,\r\n    handleBlur,\r\n    reset,\r\n    isValid: !error,\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7564, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/hooks/use-brand-mapping-validation.ts"],"sourcesContent":["import * as React from 'react';\r\nimport type { SystemId } from '@/lib/id-types';\r\nimport type { PkgxBrandMapping, PkgxBrand } from '../types';\r\nimport {\r\n  validateBrandMapping,\r\n  suggestMatchingBrands,\r\n  type BrandValidationResult,\r\n  type BrandValidationContext,\r\n  type BrandMappingInput,\r\n} from '../validation';\r\n\r\ninterface UseBrandMappingValidationOptions {\r\n  existingMappings: PkgxBrandMapping[];\r\n  hrmBrands: Array<{\r\n    systemId: SystemId;\r\n    name: string;\r\n    status?: string;\r\n    isActive?: boolean;\r\n  }>;\r\n  pkgxBrands: PkgxBrand[];\r\n  editingMappingId?: string;\r\n  debounceMs?: number;\r\n}\r\n\r\ninterface UseBrandMappingValidationReturn {\r\n  // Validation state\r\n  validationResult: BrandValidationResult | null;\r\n  isValidating: boolean;\r\n  \r\n  // Suggestions\r\n  suggestions: Array<{ brand: PkgxBrand; score: number }>;\r\n  \r\n  // Actions\r\n  validate: (input: BrandMappingInput) => BrandValidationResult;\r\n  validateAsync: (input: BrandMappingInput) => Promise<BrandValidationResult>;\r\n  clearValidation: () => void;\r\n  \r\n  // Helpers\r\n  hasErrors: boolean;\r\n  hasWarnings: boolean;\r\n  getFieldError: (field: string) => string | undefined;\r\n  getFieldWarning: (field: string) => string | undefined;\r\n}\r\n\r\n/**\r\n * Hook để quản lý validation cho brand mapping\r\n */\r\nexport function useBrandMappingValidation(\r\n  options: UseBrandMappingValidationOptions\r\n): UseBrandMappingValidationReturn {\r\n  const {\r\n    existingMappings,\r\n    hrmBrands,\r\n    pkgxBrands,\r\n    editingMappingId,\r\n    debounceMs = 300,\r\n  } = options;\r\n\r\n  const [validationResult, setValidationResult] = React.useState<BrandValidationResult | null>(null);\r\n  const [isValidating, setIsValidating] = React.useState(false);\r\n  const [suggestions, setSuggestions] = React.useState<Array<{ brand: PkgxBrand; score: number }>>([]);\r\n  \r\n  const debounceTimerRef = React.useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Create validation context\r\n  const context = React.useMemo((): BrandValidationContext => ({\r\n    existingMappings,\r\n    hrmBrands,\r\n    pkgxBrands,\r\n    editingMappingId,\r\n  }), [existingMappings, hrmBrands, pkgxBrands, editingMappingId]);\r\n\r\n  // Sync validation\r\n  const validate = React.useCallback((input: BrandMappingInput): BrandValidationResult => {\r\n    const result = validateBrandMapping(input, context);\r\n    setValidationResult(result);\r\n    \r\n    // Update suggestions based on HRM brand name\r\n    if (input.hrmBrandSystemId) {\r\n      const hrmBrand = hrmBrands.find(b => b.systemId === input.hrmBrandSystemId);\r\n      if (hrmBrand) {\r\n        const newSuggestions = suggestMatchingBrands(hrmBrand.name, pkgxBrands);\r\n        setSuggestions(newSuggestions);\r\n      }\r\n    }\r\n    \r\n    return result;\r\n  }, [context, hrmBrands, pkgxBrands]);\r\n\r\n  // Async validation with debounce\r\n  const validateAsync = React.useCallback(async (input: BrandMappingInput): Promise<BrandValidationResult> => {\r\n    return new Promise((resolve) => {\r\n      setIsValidating(true);\r\n      \r\n      if (debounceTimerRef.current) {\r\n        clearTimeout(debounceTimerRef.current);\r\n      }\r\n      \r\n      debounceTimerRef.current = setTimeout(() => {\r\n        const result = validate(input);\r\n        setIsValidating(false);\r\n        resolve(result);\r\n      }, debounceMs);\r\n    });\r\n  }, [validate, debounceMs]);\r\n\r\n  // Clear validation\r\n  const clearValidation = React.useCallback(() => {\r\n    setValidationResult(null);\r\n    setSuggestions([]);\r\n    if (debounceTimerRef.current) {\r\n      clearTimeout(debounceTimerRef.current);\r\n    }\r\n  }, []);\r\n\r\n  // Cleanup on unmount\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (debounceTimerRef.current) {\r\n        clearTimeout(debounceTimerRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Computed values\r\n  const hasErrors = validationResult ? validationResult.errors.length > 0 : false;\r\n  const hasWarnings = validationResult ? validationResult.warnings.length > 0 : false;\r\n\r\n  const getFieldError = React.useCallback((field: string): string | undefined => {\r\n    if (!validationResult) return undefined;\r\n    const error = validationResult.errors.find(e => e.field === field);\r\n    return error?.message;\r\n  }, [validationResult]);\r\n\r\n  const getFieldWarning = React.useCallback((field: string): string | undefined => {\r\n    if (!validationResult) return undefined;\r\n    const warning = validationResult.warnings.find(w => w.field === field);\r\n    return warning?.message;\r\n  }, [validationResult]);\r\n\r\n  return {\r\n    validationResult,\r\n    isValidating,\r\n    suggestions,\r\n    validate,\r\n    validateAsync,\r\n    clearValidation,\r\n    hasErrors,\r\n    hasWarnings,\r\n    getFieldError,\r\n    getFieldWarning,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAGA;AAAA;;;;AA4CO,SAAS,0BACd,OAAyC;;IAEzC,MAAM,EACJ,gBAAgB,EAChB,SAAS,EACT,UAAU,EACV,gBAAgB,EAChB,aAAa,GAAG,EACjB,GAAG;IAEJ,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,yKAAc,CAA+B;IAC7F,MAAM,CAAC,cAAc,gBAAgB,GAAG,yKAAc,CAAC;IACvD,MAAM,CAAC,aAAa,eAAe,GAAG,yKAAc,CAA6C,EAAE;IAEnG,MAAM,mBAAmB,uKAAY,CAAwB;IAE7D,4BAA4B;IAC5B,MAAM,UAAU,wKAAa;sDAAC,IAA8B,CAAC;gBAC3D;gBACA;gBACA;gBACA;YACF,CAAC;qDAAG;QAAC;QAAkB;QAAW;QAAY;KAAiB;IAE/D,kBAAkB;IAClB,MAAM,WAAW,4KAAiB;2DAAC,CAAC;YAClC,MAAM,SAAS,IAAA,uMAAoB,EAAC,OAAO;YAC3C,oBAAoB;YAEpB,6CAA6C;YAC7C,IAAI,MAAM,gBAAgB,EAAE;gBAC1B,MAAM,WAAW,UAAU,IAAI;gFAAC,CAAA,IAAK,EAAE,QAAQ,KAAK,MAAM,gBAAgB;;gBAC1E,IAAI,UAAU;oBACZ,MAAM,iBAAiB,IAAA,wMAAqB,EAAC,SAAS,IAAI,EAAE;oBAC5D,eAAe;gBACjB;YACF;YAEA,OAAO;QACT;0DAAG;QAAC;QAAS;QAAW;KAAW;IAEnC,iCAAiC;IACjC,MAAM,gBAAgB,4KAAiB;gEAAC,OAAO;YAC7C,OAAO,IAAI;wEAAQ,CAAC;oBAClB,gBAAgB;oBAEhB,IAAI,iBAAiB,OAAO,EAAE;wBAC5B,aAAa,iBAAiB,OAAO;oBACvC;oBAEA,iBAAiB,OAAO,GAAG;gFAAW;4BACpC,MAAM,SAAS,SAAS;4BACxB,gBAAgB;4BAChB,QAAQ;wBACV;+EAAG;gBACL;;QACF;+DAAG;QAAC;QAAU;KAAW;IAEzB,mBAAmB;IACnB,MAAM,kBAAkB,4KAAiB;kEAAC;YACxC,oBAAoB;YACpB,eAAe,EAAE;YACjB,IAAI,iBAAiB,OAAO,EAAE;gBAC5B,aAAa,iBAAiB,OAAO;YACvC;QACF;iEAAG,EAAE;IAEL,qBAAqB;IACrB,0KAAe;+CAAC;YACd;uDAAO;oBACL,IAAI,iBAAiB,OAAO,EAAE;wBAC5B,aAAa,iBAAiB,OAAO;oBACvC;gBACF;;QACF;8CAAG,EAAE;IAEL,kBAAkB;IAClB,MAAM,YAAY,mBAAmB,iBAAiB,MAAM,CAAC,MAAM,GAAG,IAAI;IAC1E,MAAM,cAAc,mBAAmB,iBAAiB,QAAQ,CAAC,MAAM,GAAG,IAAI;IAE9E,MAAM,gBAAgB,4KAAiB;gEAAC,CAAC;YACvC,IAAI,CAAC,kBAAkB,OAAO;YAC9B,MAAM,QAAQ,iBAAiB,MAAM,CAAC,IAAI;8EAAC,CAAA,IAAK,EAAE,KAAK,KAAK;;YAC5D,OAAO,OAAO;QAChB;+DAAG;QAAC;KAAiB;IAErB,MAAM,kBAAkB,4KAAiB;kEAAC,CAAC;YACzC,IAAI,CAAC,kBAAkB,OAAO;YAC9B,MAAM,UAAU,iBAAiB,QAAQ,CAAC,IAAI;kFAAC,CAAA,IAAK,EAAE,KAAK,KAAK;;YAChE,OAAO,SAAS;QAClB;iEAAG;QAAC;KAAiB;IAErB,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACF;AACF;GAzGgB"}},
    {"offset": {"line": 7708, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/hooks/use-pkgx-entity-sync.ts"],"sourcesContent":["import * as React from 'react';\r\nimport { toast } from 'sonner';\r\nimport { RefreshCw, Search, AlignLeft, Globe, FolderEdit, DollarSign, Package, Tag, FileText } from 'lucide-react';\r\nimport { updateCategory, updateCategoryBasic, updateBrand, updateProduct as updatePkgxProduct } from '../../../../lib/pkgx/api-service';\r\nimport type { LucideIcon } from 'lucide-react';\r\n\r\n// ========================================\r\n// Types\r\n// ========================================\r\n\r\nexport type PkgxEntityType = 'category' | 'brand' | 'product';\r\n\r\nexport type SyncActionKey = \r\n  | 'sync_all' \r\n  | 'sync_basic' \r\n  | 'sync_seo' \r\n  | 'sync_description'\r\n  | 'sync_price'\r\n  | 'sync_inventory'\r\n  | 'sync_flags';\r\n\r\nexport interface SyncAction {\r\n  key: SyncActionKey;\r\n  label: string;\r\n  icon: LucideIcon;\r\n  title: string;\r\n  description: (name: string) => string;\r\n  confirmTitle: string;\r\n  confirmDescription: (name: string) => string;\r\n  /** Which entity types support this action */\r\n  supportedEntities: PkgxEntityType[];\r\n  /** Is this the primary action (shown with separator and bold) */\r\n  isPrimary?: boolean;\r\n}\r\n\r\nexport interface HrmCategoryData {\r\n  systemId: string;\r\n  name: string;\r\n  isActive?: boolean;\r\n  seoKeywords?: string;\r\n  seoTitle?: string;\r\n  metaDescription?: string;\r\n  shortDescription?: string;\r\n  longDescription?: string;\r\n  websiteSeo?: {\r\n    pkgx?: {\r\n      seoKeywords?: string;\r\n      seoTitle?: string;\r\n      metaDescription?: string;\r\n      shortDescription?: string;\r\n      longDescription?: string;\r\n    };\r\n  };\r\n}\r\n\r\nexport interface HrmBrandData {\r\n  systemId: string;\r\n  name: string;\r\n  website?: string;\r\n  seoKeywords?: string;\r\n  seoTitle?: string;\r\n  metaDescription?: string;\r\n  shortDescription?: string;\r\n  longDescription?: string;\r\n  websiteSeo?: {\r\n    pkgx?: {\r\n      seoKeywords?: string;\r\n      seoTitle?: string;\r\n      metaDescription?: string;\r\n      shortDescription?: string;\r\n      longDescription?: string;\r\n    };\r\n  };\r\n}\r\n\r\nexport interface HrmProductData {\r\n  systemId: string;\r\n  name: string;\r\n  sku?: string;\r\n  sellingPrice?: number;\r\n  costPrice?: number;\r\n  dealPrice?: number;\r\n  quantity?: number;\r\n  seoKeywords?: string;\r\n  ktitle?: string;\r\n  seoDescription?: string;\r\n  shortDescription?: string;\r\n  description?: string;\r\n  isBest?: boolean;\r\n  isNew?: boolean;\r\n  isHot?: boolean;\r\n  isHome?: boolean;\r\n  categorySystemId?: string;\r\n  brandSystemId?: string;\r\n}\r\n\r\nexport interface ConfirmActionState {\r\n  open: boolean;\r\n  title: string;\r\n  description: string;\r\n  action: (() => void) | null;\r\n}\r\n\r\nexport type PkgxSyncLogAction = \r\n  | 'test_connection'\r\n  | 'ping'\r\n  | 'sync_all'\r\n  | 'sync_price'\r\n  | 'sync_inventory'\r\n  | 'sync_seo'\r\n  | 'create_product'\r\n  | 'update_product'\r\n  | 'link_product'\r\n  | 'unlink_product'\r\n  | 'unlink_mapping'\r\n  | 'sync_categories'\r\n  | 'sync_brands'\r\n  | 'get_products'\r\n  | 'upload_image'\r\n  | 'save_config'\r\n  | 'save_mapping';\r\n\r\n// Helper to map SyncActionKey to PkgxSyncLogAction\r\nconst mapActionKeyToLogAction = (actionKey: SyncActionKey): PkgxSyncLogAction => {\r\n  switch (actionKey) {\r\n    case 'sync_all': return 'sync_all';\r\n    case 'sync_seo': return 'sync_seo';\r\n    case 'sync_price': return 'sync_price';\r\n    case 'sync_inventory': return 'sync_inventory';\r\n    case 'sync_basic':\r\n    case 'sync_description':\r\n    case 'sync_flags':\r\n    default:\r\n      return 'update_product'; // Map other actions to generic update\r\n  }\r\n};\r\n\r\nexport interface UsePkgxEntitySyncOptions {\r\n  entityType: PkgxEntityType;\r\n  onLog?: (log: {\r\n    action: PkgxSyncLogAction;\r\n    status: 'success' | 'error' | 'info';\r\n    message: string;\r\n    details?: Record<string, any>;\r\n  }) => void;\r\n  /** For products - get PKGX category ID from HRM category */\r\n  getPkgxCatIdByHrmCategory?: (hrmCategoryId: string) => number | undefined;\r\n  /** For products - get PKGX brand ID from HRM brand */\r\n  getPkgxBrandIdByHrmBrand?: (hrmBrandId: string) => number | undefined;\r\n}\r\n\r\n// ========================================\r\n// Action Definitions\r\n// ========================================\r\n\r\nexport const SYNC_ACTIONS: SyncAction[] = [\r\n  {\r\n    key: 'sync_all',\r\n    label: 'Đồng bộ tất cả',\r\n    icon: RefreshCw,\r\n    title: 'Đồng bộ tất cả',\r\n    description: (name) => `Đồng bộ TẤT CẢ thông tin của \"${name}\" lên PKGX`,\r\n    confirmTitle: 'Đồng bộ tất cả',\r\n    confirmDescription: (name) => `Bạn có chắc muốn đồng bộ TẤT CẢ thông tin \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['category', 'brand', 'product'],\r\n    isPrimary: true,\r\n  },\r\n  {\r\n    key: 'sync_basic',\r\n    label: 'Thông tin cơ bản',\r\n    icon: FolderEdit,\r\n    title: 'Đồng bộ thông tin cơ bản',\r\n    description: (name) => `Đồng bộ thông tin cơ bản của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ thông tin cơ bản',\r\n    confirmDescription: (name) => `Đồng bộ thông tin cơ bản của \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['category', 'brand', 'product'],\r\n  },\r\n  {\r\n    key: 'sync_seo',\r\n    label: 'SEO',\r\n    icon: Search,\r\n    title: 'Đồng bộ SEO',\r\n    description: (name) => `Đồng bộ SEO (keywords, meta title, meta description) của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ SEO',\r\n    confirmDescription: (name) => `Đồng bộ SEO của \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['category', 'brand', 'product'],\r\n  },\r\n  {\r\n    key: 'sync_description',\r\n    label: 'Mô tả',\r\n    icon: AlignLeft,\r\n    title: 'Đồng bộ mô tả',\r\n    description: (name) => `Đồng bộ mô tả (short desc, long desc) của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ mô tả',\r\n    confirmDescription: (name) => `Đồng bộ mô tả của \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['category', 'brand', 'product'],\r\n  },\r\n  {\r\n    key: 'sync_price',\r\n    label: 'Giá',\r\n    icon: DollarSign,\r\n    title: 'Đồng bộ giá',\r\n    description: (name) => `Đồng bộ giá bán, giá thị trường, giá khuyến mãi của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ giá',\r\n    confirmDescription: (name) => `Đồng bộ giá sản phẩm \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['product'],\r\n  },\r\n  {\r\n    key: 'sync_inventory',\r\n    label: 'Tồn kho',\r\n    icon: Package,\r\n    title: 'Đồng bộ tồn kho',\r\n    description: (name) => `Đồng bộ tổng số lượng tồn kho của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ tồn kho',\r\n    confirmDescription: (name) => `Đồng bộ tồn kho sản phẩm \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['product'],\r\n  },\r\n  {\r\n    key: 'sync_flags',\r\n    label: 'Flags',\r\n    icon: Tag,\r\n    title: 'Đồng bộ flags',\r\n    description: (name) => `Đồng bộ flags (nổi bật, mới, hot, trang chủ) của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ flags',\r\n    confirmDescription: (name) => `Đồng bộ flags của \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['product'],\r\n  },\r\n];\r\n\r\n// ========================================\r\n// Hook\r\n// ========================================\r\n\r\nexport function usePkgxEntitySync(options: UsePkgxEntitySyncOptions) {\r\n  const { entityType, onLog, getPkgxCatIdByHrmCategory, getPkgxBrandIdByHrmBrand } = options;\r\n  \r\n  const [isSyncing, setIsSyncing] = React.useState(false);\r\n  const [confirmAction, setConfirmAction] = React.useState<ConfirmActionState>({\r\n    open: false,\r\n    title: '',\r\n    description: '',\r\n    action: null,\r\n  });\r\n  \r\n  // Get available actions for this entity type\r\n  const availableActions = React.useMemo(() => \r\n    SYNC_ACTIONS.filter(action => action.supportedEntities.includes(entityType)),\r\n  [entityType]);\r\n  \r\n  // Primary action (sync all)\r\n  const primaryAction = React.useMemo(() => \r\n    availableActions.find(a => a.isPrimary),\r\n  [availableActions]);\r\n  \r\n  // Secondary actions (non-primary)\r\n  const secondaryActions = React.useMemo(() => \r\n    availableActions.filter(a => !a.isPrimary),\r\n  [availableActions]);\r\n  \r\n  // Confirm handler\r\n  const handleConfirm = React.useCallback((title: string, description: string, action: () => void) => {\r\n    setConfirmAction({ open: true, title, description, action });\r\n  }, []);\r\n  \r\n  // Execute confirmed action\r\n  const executeAction = React.useCallback(() => {\r\n    if (confirmAction.action) {\r\n      confirmAction.action();\r\n    }\r\n    setConfirmAction({ open: false, title: '', description: '', action: null });\r\n  }, [confirmAction.action]);\r\n  \r\n  // Cancel confirm dialog\r\n  const cancelConfirm = React.useCallback(() => {\r\n    setConfirmAction({ open: false, title: '', description: '', action: null });\r\n  }, []);\r\n  \r\n  // ========================================\r\n  // Category Sync Handlers\r\n  // ========================================\r\n  \r\n  const syncCategory = React.useCallback(async (\r\n    pkgxCatId: number,\r\n    hrmCategory: HrmCategoryData,\r\n    actionKey: SyncActionKey\r\n  ) => {\r\n    setIsSyncing(true);\r\n    try {\r\n      const pkgxSeo = hrmCategory.websiteSeo?.pkgx;\r\n      let payload: Record<string, any> = {};\r\n      let successMessage = '';\r\n      \r\n      switch (actionKey) {\r\n        case 'sync_all':\r\n          payload = {\r\n            cat_name: hrmCategory.name,\r\n            keywords: pkgxSeo?.seoKeywords || hrmCategory.seoKeywords || hrmCategory.name,\r\n            meta_title: pkgxSeo?.seoTitle || hrmCategory.seoTitle || hrmCategory.name,\r\n            meta_desc: pkgxSeo?.metaDescription || hrmCategory.metaDescription || '',\r\n            cat_desc: pkgxSeo?.shortDescription || hrmCategory.shortDescription || '',\r\n            long_desc: pkgxSeo?.longDescription || hrmCategory.longDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ tất cả cho danh mục: ${hrmCategory.name}`;\r\n          break;\r\n          \r\n        case 'sync_basic':\r\n          payload = {\r\n            cat_name: hrmCategory.name,\r\n            is_show: hrmCategory.isActive !== false ? 1 : 0,\r\n          };\r\n          successMessage = `Đã đồng bộ thông tin cơ bản cho danh mục: ${hrmCategory.name}`;\r\n          // Use updateCategoryBasic for basic info\r\n          const basicResponse = await updateCategoryBasic(pkgxCatId, payload);\r\n          if (basicResponse.success) {\r\n            toast.success(successMessage);\r\n            onLog?.({\r\n              action: 'update_product', // Map to valid log action\r\n              status: 'success',\r\n              message: successMessage,\r\n              details: { categoryId: pkgxCatId },\r\n            });\r\n          } else {\r\n            toast.error(basicResponse.error || 'Không thể đồng bộ');\r\n          }\r\n          setIsSyncing(false);\r\n          return basicResponse.success;\r\n          \r\n        case 'sync_seo':\r\n          payload = {\r\n            keywords: pkgxSeo?.seoKeywords || hrmCategory.seoKeywords || hrmCategory.name,\r\n            meta_title: pkgxSeo?.seoTitle || hrmCategory.seoTitle || hrmCategory.name,\r\n            meta_desc: pkgxSeo?.metaDescription || hrmCategory.metaDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ SEO cho danh mục: ${hrmCategory.name}`;\r\n          break;\r\n          \r\n        case 'sync_description':\r\n          payload = {\r\n            cat_desc: pkgxSeo?.shortDescription || hrmCategory.shortDescription || '',\r\n            long_desc: pkgxSeo?.longDescription || hrmCategory.longDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ mô tả cho danh mục: ${hrmCategory.name}`;\r\n          break;\r\n          \r\n        default:\r\n          setIsSyncing(false);\r\n          return false;\r\n      }\r\n      \r\n      const response = await updateCategory(pkgxCatId, payload);\r\n      if (response.success) {\r\n        toast.success(successMessage);\r\n        onLog?.({\r\n          action: mapActionKeyToLogAction(actionKey),\r\n          status: 'success',\r\n          message: successMessage,\r\n          details: { categoryId: pkgxCatId },\r\n        });\r\n      } else {\r\n        toast.error(response.error || 'Không thể đồng bộ');\r\n      }\r\n      \r\n      return response.success;\r\n    } catch (error) {\r\n      toast.error('Lỗi khi đồng bộ danh mục');\r\n      return false;\r\n    } finally {\r\n      setIsSyncing(false);\r\n    }\r\n  }, [onLog]);\r\n  \r\n  // ========================================\r\n  // Brand Sync Handlers\r\n  // ========================================\r\n  \r\n  const syncBrand = React.useCallback(async (\r\n    pkgxBrandId: number,\r\n    hrmBrand: HrmBrandData,\r\n    actionKey: SyncActionKey\r\n  ) => {\r\n    setIsSyncing(true);\r\n    try {\r\n      const pkgxSeo = hrmBrand.websiteSeo?.pkgx;\r\n      let payload: Record<string, any> = {};\r\n      let successMessage = '';\r\n      \r\n      switch (actionKey) {\r\n        case 'sync_all':\r\n          payload = {\r\n            brand_name: hrmBrand.name,\r\n            site_url: hrmBrand.website || '',\r\n            keywords: pkgxSeo?.seoKeywords || hrmBrand.seoKeywords || hrmBrand.name,\r\n            meta_title: pkgxSeo?.seoTitle || hrmBrand.seoTitle || hrmBrand.name,\r\n            meta_desc: pkgxSeo?.metaDescription || hrmBrand.metaDescription || '',\r\n            short_desc: pkgxSeo?.shortDescription || hrmBrand.shortDescription || '',\r\n            long_desc: pkgxSeo?.longDescription || hrmBrand.longDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ tất cả cho thương hiệu: ${hrmBrand.name}`;\r\n          break;\r\n          \r\n        case 'sync_basic':\r\n          payload = {\r\n            brand_name: hrmBrand.name,\r\n            site_url: hrmBrand.website || '',\r\n          };\r\n          successMessage = `Đã đồng bộ thông tin cơ bản cho thương hiệu: ${hrmBrand.name}`;\r\n          break;\r\n          \r\n        case 'sync_seo':\r\n          payload = {\r\n            keywords: pkgxSeo?.seoKeywords || hrmBrand.seoKeywords || hrmBrand.name,\r\n            meta_title: pkgxSeo?.seoTitle || hrmBrand.seoTitle || hrmBrand.name,\r\n            meta_desc: pkgxSeo?.metaDescription || hrmBrand.metaDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ SEO cho thương hiệu: ${hrmBrand.name}`;\r\n          break;\r\n          \r\n        case 'sync_description':\r\n          payload = {\r\n            short_desc: pkgxSeo?.shortDescription || hrmBrand.shortDescription || '',\r\n            long_desc: pkgxSeo?.longDescription || hrmBrand.longDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ mô tả cho thương hiệu: ${hrmBrand.name}`;\r\n          break;\r\n          \r\n        default:\r\n          setIsSyncing(false);\r\n          return false;\r\n      }\r\n      \r\n      const response = await updateBrand(pkgxBrandId, payload);\r\n      if (response.success) {\r\n        toast.success(successMessage);\r\n        onLog?.({\r\n          action: mapActionKeyToLogAction(actionKey),\r\n          status: 'success',\r\n          message: successMessage,\r\n          details: { brandId: pkgxBrandId },\r\n        });\r\n      } else {\r\n        toast.error(response.error || 'Không thể đồng bộ');\r\n      }\r\n      \r\n      return response.success;\r\n    } catch (error) {\r\n      toast.error('Lỗi khi đồng bộ thương hiệu');\r\n      return false;\r\n    } finally {\r\n      setIsSyncing(false);\r\n    }\r\n  }, [onLog]);\r\n  \r\n  // ========================================\r\n  // Product Sync Handlers\r\n  // ========================================\r\n  \r\n  const syncProduct = React.useCallback(async (\r\n    pkgxProductId: number,\r\n    hrmProduct: HrmProductData,\r\n    actionKey: SyncActionKey\r\n  ) => {\r\n    setIsSyncing(true);\r\n    try {\r\n      let payload: Record<string, any> = {};\r\n      let successMessage = '';\r\n      \r\n      switch (actionKey) {\r\n        case 'sync_all':\r\n          payload = {\r\n            goods_name: hrmProduct.name,\r\n            goods_sn: hrmProduct.sku || '',\r\n            shop_price: hrmProduct.sellingPrice || 0,\r\n            market_price: hrmProduct.costPrice || hrmProduct.sellingPrice || 0,\r\n            promote_price: hrmProduct.dealPrice || 0,\r\n            goods_number: hrmProduct.quantity || 0,\r\n            keywords: hrmProduct.seoKeywords || hrmProduct.name,\r\n            meta_title: hrmProduct.ktitle || hrmProduct.name,\r\n            meta_desc: hrmProduct.seoDescription || '',\r\n            goods_brief: hrmProduct.shortDescription || '',\r\n            goods_desc: hrmProduct.description || '',\r\n            is_best: hrmProduct.isBest ? 1 : 0,\r\n            is_new: hrmProduct.isNew ? 1 : 0,\r\n            is_hot: hrmProduct.isHot ? 1 : 0,\r\n            is_home: hrmProduct.isHome ? 1 : 0,\r\n          };\r\n          // Add category/brand if mapped\r\n          if (hrmProduct.categorySystemId && getPkgxCatIdByHrmCategory) {\r\n            const catId = getPkgxCatIdByHrmCategory(hrmProduct.categorySystemId);\r\n            if (catId) payload.cat_id = catId;\r\n          }\r\n          if (hrmProduct.brandSystemId && getPkgxBrandIdByHrmBrand) {\r\n            const brandId = getPkgxBrandIdByHrmBrand(hrmProduct.brandSystemId);\r\n            if (brandId) payload.brand_id = brandId;\r\n          }\r\n          successMessage = `Đã đồng bộ tất cả cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_basic':\r\n          payload = {\r\n            goods_name: hrmProduct.name,\r\n            goods_sn: hrmProduct.sku || '',\r\n          };\r\n          // Add category/brand if mapped\r\n          if (hrmProduct.categorySystemId && getPkgxCatIdByHrmCategory) {\r\n            const catId = getPkgxCatIdByHrmCategory(hrmProduct.categorySystemId);\r\n            if (catId) payload.cat_id = catId;\r\n          }\r\n          if (hrmProduct.brandSystemId && getPkgxBrandIdByHrmBrand) {\r\n            const brandId = getPkgxBrandIdByHrmBrand(hrmProduct.brandSystemId);\r\n            if (brandId) payload.brand_id = brandId;\r\n          }\r\n          successMessage = `Đã đồng bộ thông tin cơ bản cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_seo':\r\n          payload = {\r\n            keywords: hrmProduct.seoKeywords || hrmProduct.name,\r\n            meta_title: hrmProduct.ktitle || hrmProduct.name,\r\n            meta_desc: hrmProduct.seoDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ SEO cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_description':\r\n          payload = {\r\n            goods_brief: hrmProduct.shortDescription || '',\r\n            goods_desc: hrmProduct.description || '',\r\n          };\r\n          successMessage = `Đã đồng bộ mô tả cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_price':\r\n          payload = {\r\n            shop_price: hrmProduct.sellingPrice || 0,\r\n            market_price: hrmProduct.costPrice || hrmProduct.sellingPrice || 0,\r\n            promote_price: hrmProduct.dealPrice || 0,\r\n          };\r\n          successMessage = `Đã đồng bộ giá cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_inventory':\r\n          payload = {\r\n            goods_number: hrmProduct.quantity || 0,\r\n          };\r\n          successMessage = `Đã đồng bộ tồn kho cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_flags':\r\n          payload = {\r\n            is_best: hrmProduct.isBest ? 1 : 0,\r\n            is_new: hrmProduct.isNew ? 1 : 0,\r\n            is_hot: hrmProduct.isHot ? 1 : 0,\r\n            is_home: hrmProduct.isHome ? 1 : 0,\r\n          };\r\n          successMessage = `Đã đồng bộ flags cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        default:\r\n          setIsSyncing(false);\r\n          return false;\r\n      }\r\n      \r\n      const response = await updatePkgxProduct(pkgxProductId, payload);\r\n      if (response.success) {\r\n        toast.success(successMessage);\r\n        onLog?.({\r\n          action: mapActionKeyToLogAction(actionKey),\r\n          status: 'success',\r\n          message: successMessage,\r\n          details: { pkgxId: pkgxProductId },\r\n        });\r\n      } else {\r\n        toast.error(response.error || 'Không thể đồng bộ');\r\n      }\r\n      \r\n      return response.success;\r\n    } catch (error) {\r\n      toast.error('Lỗi khi đồng bộ sản phẩm');\r\n      return false;\r\n    } finally {\r\n      setIsSyncing(false);\r\n    }\r\n  }, [onLog, getPkgxCatIdByHrmCategory, getPkgxBrandIdByHrmBrand]);\r\n  \r\n  // ========================================\r\n  // Generic sync handler based on entity type\r\n  // ========================================\r\n  \r\n  const sync = React.useCallback(async (\r\n    pkgxId: number,\r\n    hrmData: HrmCategoryData | HrmBrandData | HrmProductData,\r\n    actionKey: SyncActionKey\r\n  ) => {\r\n    switch (entityType) {\r\n      case 'category':\r\n        return syncCategory(pkgxId, hrmData as HrmCategoryData, actionKey);\r\n      case 'brand':\r\n        return syncBrand(pkgxId, hrmData as HrmBrandData, actionKey);\r\n      case 'product':\r\n        return syncProduct(pkgxId, hrmData as HrmProductData, actionKey);\r\n      default:\r\n        return false;\r\n    }\r\n  }, [entityType, syncCategory, syncBrand, syncProduct]);\r\n  \r\n  // ========================================\r\n  // Action trigger with confirmation\r\n  // ========================================\r\n  \r\n  const triggerSyncAction = React.useCallback((\r\n    actionKey: SyncActionKey,\r\n    pkgxId: number,\r\n    hrmData: HrmCategoryData | HrmBrandData | HrmProductData,\r\n    entityName: string\r\n  ) => {\r\n    const action = SYNC_ACTIONS.find(a => a.key === actionKey);\r\n    if (!action) return;\r\n    \r\n    handleConfirm(\r\n      action.confirmTitle,\r\n      action.confirmDescription(entityName),\r\n      () => sync(pkgxId, hrmData, actionKey)\r\n    );\r\n  }, [handleConfirm, sync]);\r\n  \r\n  return {\r\n    // State\r\n    isSyncing,\r\n    confirmAction,\r\n    \r\n    // Actions config\r\n    availableActions,\r\n    primaryAction,\r\n    secondaryActions,\r\n    \r\n    // Handlers\r\n    handleConfirm,\r\n    executeAction,\r\n    cancelConfirm,\r\n    \r\n    // Sync methods\r\n    sync,\r\n    syncCategory,\r\n    syncBrand,\r\n    syncProduct,\r\n    triggerSyncAction,\r\n  };\r\n}\r\n\r\nexport type UsePkgxEntitySyncReturn = ReturnType<typeof usePkgxEntitySync>;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8268, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/hooks/use-pkgx-bulk-sync.ts"],"sourcesContent":["/**\r\n * usePkgxBulkSync - Shared hook for bulk PKGX sync operations\r\n * \r\n * Supports bulk sync for products and brands with:\r\n * - Progress tracking\r\n * - Confirmation dialog\r\n * - Error handling\r\n * - Logging\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { toast } from 'sonner';\r\nimport { updateProduct, updateBrand } from '../../../../lib/pkgx/api-service';\r\nimport { usePkgxSettingsStore } from '../store';\r\nimport type { Product } from '../../../products/types';\r\nimport type { Brand } from '../../../settings/inventory/types';\r\n\r\n// ========================================\r\n// Types\r\n// ========================================\r\n\r\nexport type BulkSyncEntityType = 'product' | 'brand';\r\n\r\nexport type BulkSyncActionKey = \r\n  | 'sync_all'\r\n  | 'sync_basic'\r\n  | 'sync_seo'\r\n  | 'sync_description'\r\n  | 'sync_price'\r\n  | 'sync_inventory'\r\n  | 'sync_flags'\r\n  | 'sync_images';\r\n\r\nexport interface BulkConfirmState {\r\n  open: boolean;\r\n  title: string;\r\n  description: string;\r\n  action: (() => Promise<void>) | null;\r\n  itemCount: number;\r\n}\r\n\r\nexport interface BulkSyncProgress {\r\n  total: number;\r\n  completed: number;\r\n  success: number;\r\n  error: number;\r\n  isRunning: boolean;\r\n}\r\n\r\nexport interface UsePkgxBulkSyncOptions {\r\n  entityType: BulkSyncEntityType;\r\n  onLog?: (log: {\r\n    action: `bulk_${BulkSyncActionKey}`;\r\n    status: 'success' | 'error' | 'info';\r\n    message: string;\r\n    details?: Record<string, unknown>;\r\n  }) => void;\r\n}\r\n\r\n// ========================================\r\n// Bulk Action Configs\r\n// ========================================\r\n\r\nconst BULK_ACTION_LABELS: Record<BulkSyncActionKey, { title: string; description: string }> = {\r\n  sync_all: {\r\n    title: 'Đồng bộ tất cả',\r\n    description: 'Đồng bộ toàn bộ thông tin (tên, SKU, giá, tồn kho, SEO, mô tả, flags)',\r\n  },\r\n  sync_basic: {\r\n    title: 'Đồng bộ thông tin cơ bản',\r\n    description: 'Đồng bộ tên, SKU, danh mục, thương hiệu',\r\n  },\r\n  sync_seo: {\r\n    title: 'Đồng bộ SEO',\r\n    description: 'Đồng bộ keywords, meta title, meta description',\r\n  },\r\n  sync_description: {\r\n    title: 'Đồng bộ mô tả',\r\n    description: 'Đồng bộ mô tả ngắn và mô tả chi tiết',\r\n  },\r\n  sync_price: {\r\n    title: 'Đồng bộ giá',\r\n    description: 'Đồng bộ giá bán, giá thị trường, giá khuyến mãi',\r\n  },\r\n  sync_inventory: {\r\n    title: 'Đồng bộ tồn kho',\r\n    description: 'Đồng bộ số lượng tồn kho',\r\n  },\r\n  sync_flags: {\r\n    title: 'Đồng bộ flags',\r\n    description: 'Đồng bộ trạng thái nổi bật, mới, hot, hiển thị',\r\n  },\r\n  sync_images: {\r\n    title: 'Đồng bộ hình ảnh',\r\n    description: 'Đồng bộ hình ảnh đại diện và album',\r\n  },\r\n};\r\n\r\n// ========================================\r\n// Payload Builders\r\n// ========================================\r\n\r\nfunction buildProductPayload(product: Product, actionKey: BulkSyncActionKey): Record<string, unknown> {\r\n  const pkgxSettings = usePkgxSettingsStore.getState();\r\n  const { categoryMappings, brandMappings } = pkgxSettings.settings;\r\n  \r\n  // Get PKGX category/brand IDs\r\n  const catMapping = categoryMappings.find(m => m.hrmCategorySystemId === product.categorySystemId);\r\n  const brandMapping = brandMappings.find(m => m.hrmBrandSystemId === product.brandSystemId);\r\n  \r\n  // Get website-specific SEO data\r\n  const pkgxSeo = product.seoPkgx;\r\n  \r\n  // Calculate total inventory\r\n  const totalInventory = Object.values(product.inventoryByBranch || {}).reduce((sum, qty) => sum + qty, 0);\r\n  \r\n  switch (actionKey) {\r\n    case 'sync_all':\r\n      return {\r\n        goods_name: product.name,\r\n        goods_sn: product.id,\r\n        shop_price: product.sellingPrice || 0,\r\n        market_price: product.costPrice || product.sellingPrice || 0,\r\n        promote_price: 0, // dealPrice not in Product type\r\n        goods_number: totalInventory,\r\n        keywords: pkgxSeo?.seoKeywords || product.seoKeywords || product.name,\r\n        meta_title: pkgxSeo?.seoTitle || product.ktitle || product.name,\r\n        meta_desc: pkgxSeo?.metaDescription || product.seoDescription || '',\r\n        goods_brief: pkgxSeo?.shortDescription || product.shortDescription || '',\r\n        goods_desc: pkgxSeo?.longDescription || product.description || '',\r\n        is_best: product.isFeatured ? 1 : 0,\r\n        is_new: product.isNewArrival ? 1 : 0,\r\n        is_hot: product.isBestSeller ? 1 : 0,\r\n        is_home: product.isPublished ? 1 : 0,\r\n        is_on_sale: product.isPublished ?? (product.status === 'active') ? 1 : 0,\r\n        ...(catMapping && { cat_id: catMapping.pkgxCatId }),\r\n        ...(brandMapping && { brand_id: brandMapping.pkgxBrandId }),\r\n      };\r\n      \r\n    case 'sync_basic':\r\n      return {\r\n        goods_name: product.name,\r\n        goods_sn: product.id,\r\n        ...(catMapping && { cat_id: catMapping.pkgxCatId }),\r\n        ...(brandMapping && { brand_id: brandMapping.pkgxBrandId }),\r\n      };\r\n      \r\n    case 'sync_price':\r\n      return {\r\n        shop_price: product.sellingPrice || 0,\r\n        market_price: product.costPrice || product.sellingPrice || 0,\r\n        promote_price: 0,\r\n      };\r\n      \r\n    case 'sync_inventory':\r\n      return {\r\n        goods_number: totalInventory,\r\n      };\r\n      \r\n    case 'sync_seo':\r\n      return {\r\n        keywords: pkgxSeo?.seoKeywords || product.seoKeywords || product.name,\r\n        meta_title: pkgxSeo?.seoTitle || product.ktitle || product.name,\r\n        meta_desc: pkgxSeo?.metaDescription || product.seoDescription || '',\r\n      };\r\n      \r\n    case 'sync_description':\r\n      return {\r\n        goods_brief: pkgxSeo?.shortDescription || product.shortDescription || '',\r\n        goods_desc: pkgxSeo?.longDescription || product.description || '',\r\n      };\r\n      \r\n    case 'sync_flags':\r\n      return {\r\n        is_best: product.isFeatured ? 1 : 0,\r\n        is_new: product.isNewArrival ? 1 : 0,\r\n        is_hot: product.isBestSeller ? 1 : 0,\r\n        is_home: product.isPublished ? 1 : 0,\r\n        is_on_sale: product.isPublished ?? (product.status === 'active') ? 1 : 0,\r\n      };\r\n      \r\n    default:\r\n      return {};\r\n  }\r\n}\r\n\r\nfunction buildBrandPayload(brand: Brand, actionKey: BulkSyncActionKey): Record<string, unknown> {\r\n  const pkgxSeo = brand.websiteSeo?.pkgx;\r\n  \r\n  switch (actionKey) {\r\n    case 'sync_all':\r\n      return {\r\n        brand_name: brand.name,\r\n        site_url: brand.website || '',\r\n        keywords: pkgxSeo?.seoKeywords || brand.seoKeywords || brand.name,\r\n        meta_title: pkgxSeo?.seoTitle || brand.seoTitle || brand.name,\r\n        meta_desc: pkgxSeo?.metaDescription || brand.metaDescription || '',\r\n        short_desc: pkgxSeo?.shortDescription || brand.shortDescription || '',\r\n        brand_desc: pkgxSeo?.longDescription || brand.longDescription || brand.description || '',\r\n      };\r\n      \r\n    case 'sync_basic':\r\n      return {\r\n        brand_name: brand.name,\r\n        site_url: brand.website || '',\r\n      };\r\n      \r\n    case 'sync_seo':\r\n      return {\r\n        keywords: pkgxSeo?.seoKeywords || brand.seoKeywords || brand.name,\r\n        meta_title: pkgxSeo?.seoTitle || brand.seoTitle || brand.name,\r\n        meta_desc: pkgxSeo?.metaDescription || brand.metaDescription || '',\r\n        short_desc: pkgxSeo?.shortDescription || brand.shortDescription || '',\r\n      };\r\n      \r\n    case 'sync_description':\r\n      return {\r\n        short_desc: pkgxSeo?.shortDescription || brand.shortDescription || '',\r\n        brand_desc: pkgxSeo?.longDescription || brand.longDescription || brand.description || '',\r\n      };\r\n      \r\n    default:\r\n      return {};\r\n  }\r\n}\r\n\r\n// ========================================\r\n// Main Hook\r\n// ========================================\r\n\r\nexport function usePkgxBulkSync(options: UsePkgxBulkSyncOptions) {\r\n  const { entityType, onLog } = options;\r\n  \r\n  // Confirmation dialog state\r\n  const [confirmAction, setConfirmAction] = React.useState<BulkConfirmState>({\r\n    open: false,\r\n    title: '',\r\n    description: '',\r\n    action: null,\r\n    itemCount: 0,\r\n  });\r\n  \r\n  // Progress state\r\n  const [progress, setProgress] = React.useState<BulkSyncProgress>({\r\n    total: 0,\r\n    completed: 0,\r\n    success: 0,\r\n    error: 0,\r\n    isRunning: false,\r\n  });\r\n  \r\n  // Check if PKGX is enabled\r\n  const checkPkgxEnabled = React.useCallback(() => {\r\n    const pkgxSettings = usePkgxSettingsStore.getState();\r\n    if (!pkgxSettings.settings.enabled) {\r\n      toast.error('PKGX chưa được bật');\r\n      return false;\r\n    }\r\n    return true;\r\n  }, []);\r\n  \r\n  // Helper to get PKGX brand ID from brand mappings\r\n  const getPkgxBrandId = React.useCallback((brand: Brand): number | undefined => {\r\n    const pkgxSettings = usePkgxSettingsStore.getState();\r\n    const mapping = pkgxSettings.settings.brandMappings.find(\r\n      m => m.hrmBrandSystemId === brand.systemId\r\n    );\r\n    return mapping?.pkgxBrandId;\r\n  }, []);\r\n  \r\n  // Execute bulk sync for products\r\n  const executeBulkSyncProducts = React.useCallback(async (\r\n    products: Product[],\r\n    actionKey: BulkSyncActionKey\r\n  ) => {\r\n    const linkedProducts = products.filter(p => p.pkgxId);\r\n    \r\n    if (linkedProducts.length === 0) {\r\n      toast.error('Không có sản phẩm nào đã liên kết PKGX');\r\n      return;\r\n    }\r\n    \r\n    setProgress({\r\n      total: linkedProducts.length,\r\n      completed: 0,\r\n      success: 0,\r\n      error: 0,\r\n      isRunning: true,\r\n    });\r\n    \r\n    const actionLabel = BULK_ACTION_LABELS[actionKey].title.toLowerCase();\r\n    toast.info(`Đang ${actionLabel} ${linkedProducts.length} sản phẩm...`);\r\n    \r\n    let successCount = 0;\r\n    let errorCount = 0;\r\n    \r\n    for (let i = 0; i < linkedProducts.length; i++) {\r\n      const product = linkedProducts[i];\r\n      try {\r\n        const payload = buildProductPayload(product, actionKey);\r\n        const response = await updateProduct(product.pkgxId!, payload);\r\n        \r\n        if (response.success) {\r\n          successCount++;\r\n        } else {\r\n          errorCount++;\r\n        }\r\n      } catch {\r\n        errorCount++;\r\n      }\r\n      \r\n      setProgress(prev => ({\r\n        ...prev,\r\n        completed: i + 1,\r\n        success: successCount,\r\n        error: errorCount,\r\n      }));\r\n    }\r\n    \r\n    setProgress(prev => ({ ...prev, isRunning: false }));\r\n    \r\n    // Show results\r\n    if (successCount > 0) {\r\n      toast.success(`Đã ${actionLabel} ${successCount} sản phẩm`);\r\n      onLog?.({\r\n        action: `bulk_${actionKey}`,\r\n        status: 'success',\r\n        message: `Đã ${actionLabel} ${successCount} sản phẩm`,\r\n        details: { successCount, errorCount },\r\n      });\r\n    }\r\n    if (errorCount > 0) {\r\n      toast.error(`Lỗi ${errorCount} sản phẩm`);\r\n    }\r\n  }, [onLog]);\r\n  \r\n  // Execute bulk sync for brands\r\n  const executeBulkSyncBrands = React.useCallback(async (\r\n    brands: Brand[],\r\n    actionKey: BulkSyncActionKey\r\n  ) => {\r\n    const linkedBrands = brands.filter(b => getPkgxBrandId(b));\r\n    \r\n    if (linkedBrands.length === 0) {\r\n      toast.error('Không có thương hiệu nào đã liên kết PKGX');\r\n      return;\r\n    }\r\n    \r\n    setProgress({\r\n      total: linkedBrands.length,\r\n      completed: 0,\r\n      success: 0,\r\n      error: 0,\r\n      isRunning: true,\r\n    });\r\n    \r\n    const actionLabel = BULK_ACTION_LABELS[actionKey].title.toLowerCase();\r\n    toast.info(`Đang ${actionLabel} ${linkedBrands.length} thương hiệu...`);\r\n    \r\n    let successCount = 0;\r\n    let errorCount = 0;\r\n    \r\n    for (let i = 0; i < linkedBrands.length; i++) {\r\n      const brand = linkedBrands[i];\r\n      const pkgxBrandId = getPkgxBrandId(brand);\r\n      \r\n      if (!pkgxBrandId) {\r\n        errorCount++;\r\n        continue;\r\n      }\r\n      \r\n      try {\r\n        const payload = buildBrandPayload(brand, actionKey);\r\n        const response = await updateBrand(pkgxBrandId, payload);\r\n        \r\n        if (response.success) {\r\n          successCount++;\r\n        } else {\r\n          errorCount++;\r\n        }\r\n      } catch {\r\n        errorCount++;\r\n      }\r\n      \r\n      setProgress(prev => ({\r\n        ...prev,\r\n        completed: i + 1,\r\n        success: successCount,\r\n        error: errorCount,\r\n      }));\r\n    }\r\n    \r\n    setProgress(prev => ({ ...prev, isRunning: false }));\r\n    \r\n    // Show results\r\n    if (successCount > 0) {\r\n      toast.success(`Đã ${actionLabel} ${successCount} thương hiệu`);\r\n      onLog?.({\r\n        action: `bulk_${actionKey}`,\r\n        status: 'success',\r\n        message: `Đã ${actionLabel} ${successCount} thương hiệu`,\r\n        details: { successCount, errorCount },\r\n      });\r\n    }\r\n    if (errorCount > 0) {\r\n      toast.error(`Lỗi ${errorCount} thương hiệu`);\r\n    }\r\n  }, [getPkgxBrandId, onLog]);\r\n  \r\n  // Trigger bulk sync with confirmation\r\n  const triggerBulkSync = React.useCallback(<T extends Product | Brand>(\r\n    items: T[],\r\n    actionKey: BulkSyncActionKey\r\n  ) => {\r\n    if (!checkPkgxEnabled()) return;\r\n    \r\n    // Filter linked items\r\n    let linkedCount = 0;\r\n    let unlinkedCount = 0;\r\n    \r\n    if (entityType === 'product') {\r\n      const products = items as Product[];\r\n      linkedCount = products.filter(p => p.pkgxId).length;\r\n      unlinkedCount = products.length - linkedCount;\r\n    } else {\r\n      const brands = items as Brand[];\r\n      linkedCount = brands.filter(b => getPkgxBrandId(b)).length;\r\n      unlinkedCount = brands.length - linkedCount;\r\n    }\r\n    \r\n    if (linkedCount === 0) {\r\n      toast.error(`Không có ${entityType === 'product' ? 'sản phẩm' : 'thương hiệu'} nào đã liên kết PKGX`);\r\n      return;\r\n    }\r\n    \r\n    const actionConfig = BULK_ACTION_LABELS[actionKey];\r\n    const entityLabel = entityType === 'product' ? 'sản phẩm' : 'thương hiệu';\r\n    \r\n    let description = `Bạn có chắc muốn ${actionConfig.title.toLowerCase()} cho ${linkedCount} ${entityLabel}?`;\r\n    if (unlinkedCount > 0) {\r\n      description += `\\n(${unlinkedCount} ${entityLabel} chưa liên kết sẽ bị bỏ qua)`;\r\n    }\r\n    \r\n    setConfirmAction({\r\n      open: true,\r\n      title: actionConfig.title,\r\n      description,\r\n      itemCount: linkedCount,\r\n      action: async () => {\r\n        if (entityType === 'product') {\r\n          await executeBulkSyncProducts(items as Product[], actionKey);\r\n        } else {\r\n          await executeBulkSyncBrands(items as Brand[], actionKey);\r\n        }\r\n      },\r\n    });\r\n  }, [entityType, checkPkgxEnabled, getPkgxBrandId, executeBulkSyncProducts, executeBulkSyncBrands]);\r\n  \r\n  // Execute confirmed action\r\n  const executeAction = React.useCallback(async () => {\r\n    if (confirmAction.action) {\r\n      await confirmAction.action();\r\n    }\r\n    setConfirmAction({\r\n      open: false,\r\n      title: '',\r\n      description: '',\r\n      action: null,\r\n      itemCount: 0,\r\n    });\r\n  }, [confirmAction.action]);\r\n  \r\n  // Cancel confirmation\r\n  const cancelConfirm = React.useCallback(() => {\r\n    setConfirmAction({\r\n      open: false,\r\n      title: '',\r\n      description: '',\r\n      action: null,\r\n      itemCount: 0,\r\n    });\r\n  }, []);\r\n  \r\n  return {\r\n    // Confirmation dialog state\r\n    confirmAction,\r\n    \r\n    // Progress state\r\n    progress,\r\n    \r\n    // Actions\r\n    triggerBulkSync,\r\n    executeAction,\r\n    cancelConfirm,\r\n    \r\n    // Helpers\r\n    checkPkgxEnabled,\r\n    getPkgxBrandId,\r\n    \r\n    // Direct execute (without confirm)\r\n    executeBulkSyncProducts,\r\n    executeBulkSyncBrands,\r\n  };\r\n}\r\n\r\n// Export types\r\nexport type UsePkgxBulkSyncReturn = ReturnType<typeof usePkgxBulkSync>;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8734, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/hooks/index.ts"],"sourcesContent":["export { useCategoryMappingValidation, useFieldValidation } from './use-category-mapping-validation';\r\nexport { useBrandMappingValidation } from './use-brand-mapping-validation';\r\nexport { usePkgxEntitySync, SYNC_ACTIONS } from './use-pkgx-entity-sync';\r\nexport { usePkgxBulkSync } from './use-pkgx-bulk-sync';\r\nexport type { \r\n  PkgxEntityType, \r\n  SyncActionKey, \r\n  SyncAction,\r\n  HrmCategoryData,\r\n  HrmBrandData,\r\n  HrmProductData,\r\n  ConfirmActionState,\r\n  UsePkgxEntitySyncOptions,\r\n  UsePkgxEntitySyncReturn,\r\n} from './use-pkgx-entity-sync';\r\nexport type {\r\n  BulkSyncEntityType,\r\n  BulkSyncActionKey,\r\n  BulkConfirmState,\r\n  BulkSyncProgress,\r\n  UsePkgxBulkSyncOptions,\r\n  UsePkgxBulkSyncReturn,\r\n} from './use-pkgx-bulk-sync';\r\n"],"names":[],"mappings":";AAAA;AACA;AACA;AACA"}},
    {"offset": {"line": 8750, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/hooks/use-debounce.ts"],"sourcesContent":["import * as React from 'react';\r\n\r\nexport function useDebounce<T>(value: T, delay: number): T {\r\n  const [debouncedValue, setDebouncedValue] = React.useState<T>(value);\r\n\r\n  React.useEffect(() => {\r\n    const handler = setTimeout(() => {\r\n      setDebouncedValue(value);\r\n    }, delay);\r\n\r\n    return () => {\r\n      clearTimeout(handler);\r\n    };\r\n  }, [value, delay]);\r\n\r\n  return debouncedValue;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;AAEO,SAAS,YAAe,KAAQ,EAAE,KAAa;;IACpD,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,yKAAc,CAAI;IAE9D,0KAAe;iCAAC;YACd,MAAM,UAAU;iDAAW;oBACzB,kBAAkB;gBACpB;gDAAG;YAEH;yCAAO;oBACL,aAAa;gBACf;;QACF;gCAAG;QAAC;QAAO;KAAM;IAEjB,OAAO;AACT;GAdgB"}},
    {"offset": {"line": 8787, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/command.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\r\nimport { Command as CommandPrimitive } from \"cmdk\"\r\nimport { Search } from \"lucide-react\"\r\n\r\nimport { cn } from \"../../lib/utils\"\r\nimport { Dialog, DialogContent } from \"./dialog\"\r\n\r\nconst Command = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\nCommand.displayName = CommandPrimitive.displayName\r\n\r\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\r\n  return (\r\n    <Dialog {...props}>\r\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\r\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\r\n          {children}\r\n        </Command>\r\n      </DialogContent>\r\n    </Dialog>\r\n  )\r\n}\r\n\r\nconst CommandInput = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Input>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\r\n>(({ className, ...props }, ref) => (\r\n  <div className=\"flex items-center border-b border-border px-3\" cmdk-input-wrapper=\"\">\r\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\r\n    <CommandPrimitive.Input\r\n      ref={ref}\r\n      className={cn(\r\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  </div>\r\n))\r\n\r\nCommandInput.displayName = CommandPrimitive.Input.displayName\r\n\r\nconst CommandList = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.List\r\n    ref={ref}\r\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\r\n    {...props}\r\n  />\r\n))\r\n\r\nCommandList.displayName = CommandPrimitive.List.displayName\r\n\r\nconst CommandEmpty = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Empty>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\r\n>((props, ref) => (\r\n  <CommandPrimitive.Empty\r\n    ref={ref}\r\n    className=\"py-6 text-center text-sm\"\r\n    {...props}\r\n  />\r\n))\r\n\r\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\r\n\r\nconst CommandGroup = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Group>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Group\r\n    ref={ref}\r\n    className={cn(\r\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\n\r\nCommandGroup.displayName = CommandPrimitive.Group.displayName\r\n\r\nconst CommandSeparator = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Separator>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Separator\r\n    ref={ref}\r\n    className={cn(\"-mx-1 h-px bg-border\", className)}\r\n    {...props}\r\n  />\r\n))\r\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\r\n\r\nconst CommandItem = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Item>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Item\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\r\n      className\r\n    )}\r\n    {...props}\r\n  />\r\n))\r\n\r\nCommandItem.displayName = CommandPrimitive.Item.displayName\r\n\r\nconst CommandShortcut = ({\r\n  className,\r\n  ...props\r\n}: React.HTMLAttributes<HTMLSpanElement>) => {\r\n  return (\r\n    <span\r\n      className={cn(\r\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n}\r\nCommandShortcut.displayName = \"CommandShortcut\"\r\n\r\nexport {\r\n  Command,\r\n  CommandDialog,\r\n  CommandInput,\r\n  CommandList,\r\n  CommandEmpty,\r\n  CommandGroup,\r\n  CommandItem,\r\n  CommandShortcut,\r\n  CommandSeparator,\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AAEA;AACA;AAEA;AACA;;;;;;;AAEA,MAAM,wBAAU,2KAAgB,CAG9B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,oJAAgB;QACf,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,6FACA;QAED,GAAG,KAAK;;;;;;KAVP;AAaN,QAAQ,WAAW,GAAG,oJAAgB,CAAC,WAAW;AAElD,MAAM,gBAAgB,CAAC,EAAE,QAAQ,EAAE,GAAG,OAAoB;IACxD,qBACE,6LAAC,wIAAM;QAAE,GAAG,KAAK;kBACf,cAAA,6LAAC,+IAAa;YAAC,WAAU;sBACvB,cAAA,6LAAC;gBAAQ,WAAU;0BAChB;;;;;;;;;;;;;;;;AAKX;MAVM;AAYN,MAAM,6BAAe,2KAAgB,OAGnC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QAAI,WAAU;QAAgD,sBAAmB;;0BAChF,6LAAC,mNAAM;gBAAC,WAAU;;;;;;0BAClB,6LAAC,oJAAgB,CAAC,KAAK;gBACrB,KAAK;gBACL,WAAW,IAAA,qHAAE,EACX,0JACA;gBAED,GAAG,KAAK;;;;;;;;;;;;;AAKf,aAAa,WAAW,GAAG,oJAAgB,CAAC,KAAK,CAAC,WAAW;AAE7D,MAAM,4BAAc,2KAAgB,OAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,oJAAgB,CAAC,IAAI;QACpB,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,mDAAmD;QAChE,GAAG,KAAK;;;;;;;AAIb,YAAY,WAAW,GAAG,oJAAgB,CAAC,IAAI,CAAC,WAAW;AAE3D,MAAM,6BAAe,2KAAgB,OAGnC,CAAC,OAAO,oBACR,6LAAC,oJAAgB,CAAC,KAAK;QACrB,KAAK;QACL,WAAU;QACT,GAAG,KAAK;;;;;;;AAIb,aAAa,WAAW,GAAG,oJAAgB,CAAC,KAAK,CAAC,WAAW;AAE7D,MAAM,6BAAe,2KAAgB,OAGnC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,oJAAgB,CAAC,KAAK;QACrB,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,0NACA;QAED,GAAG,KAAK;;;;;;;AAIb,aAAa,WAAW,GAAG,oJAAgB,CAAC,KAAK,CAAC,WAAW;AAE7D,MAAM,iCAAmB,2KAAgB,QAGvC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,oJAAgB,CAAC,SAAS;QACzB,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,wBAAwB;QACrC,GAAG,KAAK;;;;;;;AAGb,iBAAiB,WAAW,GAAG,oJAAgB,CAAC,SAAS,CAAC,WAAW;AAErE,MAAM,4BAAc,2KAAgB,QAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,oJAAgB,CAAC,IAAI;QACpB,KAAK;QACL,WAAW,IAAA,qHAAE,EACX,6TACA;QAED,GAAG,KAAK;;;;;;;AAIb,YAAY,WAAW,GAAG,oJAAgB,CAAC,IAAI,CAAC,WAAW;AAE3D,MAAM,kBAAkB,CAAC,EACvB,SAAS,EACT,GAAG,OACmC;IACtC,qBACE,6LAAC;QACC,WAAW,IAAA,qHAAE,EACX,yDACA;QAED,GAAG,KAAK;;;;;;AAGf;OAbM;AAcN,gBAAgB,WAAW,GAAG"}},
    {"offset": {"line": 8974, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/virtualized-combobox.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Check, ChevronsUpDown, Loader2 } from 'lucide-react';\r\nimport { useVirtualizer } from '@tanstack/react-virtual';\r\nimport { useDebounce } from '../../hooks/use-debounce';\r\nimport { cn } from '../../lib/utils';\r\nimport { Button } from './button';\r\nimport { Command, CommandInput, CommandEmpty } from './command';\r\nimport { Popover, PopoverContent, PopoverTrigger } from './popover';\r\n\r\nexport type ComboboxOption = {\r\n  value: string;\r\n  label: string;\r\n  subtitle?: string | undefined; // For additional info like ID, phone\r\n  acText?: string | undefined; // Accent-stripped text for resilient search\r\n  metadata?: any | undefined; // Optional metadata for custom rendering\r\n};\r\n\r\ntype VirtualizedComboboxProps = {\r\n  value: ComboboxOption | null;\r\n  onChange: (value: ComboboxOption | null) => void;\r\n  options: ComboboxOption[];\r\n  placeholder?: string;\r\n  searchPlaceholder?: string;\r\n  emptyPlaceholder?: string;\r\n  disabled?: boolean;\r\n  isLoading?: boolean;\r\n  onSearchChange?: (search: string) => void; // For server-side filtering\r\n  renderOption?: (option: ComboboxOption, isSelected: boolean) => React.ReactNode;\r\n  renderHeader?: () => React.ReactNode; // ✅ Custom header (e.g., \"Add new\" button)\r\n  estimatedItemHeight?: number; // Estimated height for better performance\r\n  maxHeight?: number;\r\n  minSearchLength?: number; // Minimum chars before showing results\r\n};\r\n\r\nconst defaultRenderOption = (option: ComboboxOption, isSelected: boolean) => (\r\n  <div className=\"flex items-center flex-1 min-w-0\">\r\n    <Check\r\n      className={cn(\r\n        'mr-2 h-4 w-4 flex-shrink-0',\r\n        isSelected ? 'opacity-100' : 'opacity-0'\r\n      )}\r\n    />\r\n    <div className=\"flex flex-col flex-1 min-w-0\">\r\n      <span className=\"font-medium text-sm truncate\">{option.label}</span>\r\n      {option.subtitle && (\r\n        <span className=\"text-xs text-muted-foreground truncate\">\r\n          {option.subtitle}\r\n        </span>\r\n      )}\r\n    </div>\r\n  </div>\r\n);\r\n\r\nexport function VirtualizedCombobox({\r\n  value,\r\n  onChange,\r\n  options,\r\n  placeholder = 'Chọn một tùy chọn',\r\n  searchPlaceholder = 'Tìm kiếm...',\r\n  emptyPlaceholder = 'Không tìm thấy kết quả.',\r\n  disabled = false,\r\n  isLoading = false,\r\n  onSearchChange,\r\n  renderOption = defaultRenderOption,\r\n  renderHeader, // ✅ NEW: Custom header\r\n  estimatedItemHeight = 48,\r\n  maxHeight = 320,\r\n  minSearchLength = 0,\r\n}: VirtualizedComboboxProps) {\r\n  const [open, setOpen] = React.useState(false);\r\n  const [searchQuery, setSearchQuery] = React.useState('');\r\n  const debouncedSearchQuery = useDebounce(searchQuery, 300);\r\n  \r\n  const parentRef = React.useRef<HTMLDivElement>(null);\r\n  const inputRef = React.useRef<HTMLInputElement>(null); // NEW: Ref for input\r\n\r\n  // Client-side filtering (if no server-side handler)\r\n  const filteredOptions = React.useMemo(() => {\r\n    if (onSearchChange) return options; // Server handles filtering\r\n    \r\n    // Use immediate search for instant filtering (no debounce lag)\r\n    const query = searchQuery.toLowerCase();\r\n    if (!query) return options;\r\n    \r\n    return options.filter(option => {\r\n      const subtitleMatch = option.subtitle?.toLowerCase().includes(query);\r\n      const acTextMatch = option.acText?.toLowerCase().includes(query);\r\n      return (\r\n        option.label.toLowerCase().includes(query) ||\r\n        option.value.toLowerCase().includes(query) ||\r\n        subtitleMatch ||\r\n        acTextMatch\r\n      );\r\n    });\r\n  }, [options, searchQuery, onSearchChange]);\r\n\r\n  // Show results: if minSearchLength > 0, check debounced search\r\n  // if minSearchLength = 0, always show (use current search, not debounced)\r\n  const shouldShowResults = minSearchLength > 0 \r\n    ? debouncedSearchQuery.length >= minSearchLength\r\n    : true;\r\n  \r\n  const displayOptions = shouldShowResults ? filteredOptions : [];\r\n\r\n  // Tanstack Virtual for 10K+ items performance\r\n  const virtualizer = useVirtualizer({\r\n    count: displayOptions.length,\r\n    getScrollElement: () => parentRef.current,\r\n    estimateSize: () => estimatedItemHeight,\r\n    overscan: 5, // Render 5 extra items outside viewport\r\n  });\r\n\r\n  // Call server-side search handler\r\n  React.useEffect(() => {\r\n    if (onSearchChange) {\r\n      onSearchChange(debouncedSearchQuery);\r\n    }\r\n  }, [debouncedSearchQuery, onSearchChange]);\r\n\r\n  // Reset scroll and force virtualizer measure when popup opens\r\n  React.useEffect(() => {\r\n    if (open) {\r\n      if (parentRef.current) {\r\n        parentRef.current.scrollTop = 0;\r\n      }\r\n      // Force virtualizer to measure after a tick\r\n      requestAnimationFrame(() => {\r\n        virtualizer.measure();\r\n      });\r\n      // NEW: Auto focus vào input khi mở popup\r\n      setTimeout(() => {\r\n        inputRef.current?.focus();\r\n      }, 50);\r\n    }\r\n  }, [open, virtualizer]);\r\n\r\n  const handleSelect = (option: ComboboxOption) => {\r\n    onChange(option.value === value?.value ? null : option);\r\n    setOpen(false);\r\n    setSearchQuery('');\r\n  };\r\n\r\n  const handleSearchChange = (newValue: string) => {\r\n    setSearchQuery(newValue);\r\n  };\r\n\r\n  return (\r\n    <Popover open={open} onOpenChange={setOpen}>\r\n      <PopoverTrigger asChild>\r\n        <Button\r\n          variant=\"outline\"\r\n          role=\"combobox\"\r\n          aria-expanded={open}\r\n          className=\"w-full justify-between font-normal h-9\"\r\n          disabled={disabled}\r\n        >\r\n          <span className=\"truncate\">{value ? value.label : placeholder}</span>\r\n          <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\r\n        </Button>\r\n      </PopoverTrigger>\r\n      <PopoverContent \r\n        className=\"w-[--radix-popover-trigger-width] p-0\" \r\n        align=\"start\"\r\n        side=\"bottom\"\r\n        sideOffset={4}\r\n        onOpenAutoFocus={(e) => {\r\n          e.preventDefault(); // Prevent default radix behavior\r\n          // Focus will be handled by useEffect\r\n        }}\r\n      >\r\n        <Command shouldFilter={false}>\r\n          <CommandInput\r\n            ref={inputRef}\r\n            placeholder={searchPlaceholder}\r\n            value={searchQuery}\r\n            onValueChange={handleSearchChange}\r\n          />\r\n          \r\n          {/* ✅ Custom header (e.g., \"Add new\" button) */}\r\n          {renderHeader && renderHeader()}\r\n          \r\n          {isLoading ? (\r\n            <div className=\"py-6 text-center\">\r\n              <Loader2 className=\"h-6 w-6 animate-spin mx-auto text-muted-foreground\" />\r\n              <p className=\"text-sm text-muted-foreground mt-2\">Đang tải...</p>\r\n            </div>\r\n          ) : !shouldShowResults && minSearchLength > 0 ? (\r\n            <div className=\"py-6 text-center text-sm text-muted-foreground\">\r\n              Nhập ít nhất {minSearchLength} ký tự để tìm kiếm\r\n            </div>\r\n          ) : displayOptions.length === 0 ? (\r\n            <CommandEmpty>{emptyPlaceholder}</CommandEmpty>\r\n          ) : (\r\n            <div \r\n              ref={parentRef}\r\n              className=\"overflow-y-auto overflow-x-hidden scrollbar-thin\"\r\n              style={{ \r\n                maxHeight: `${maxHeight}px`,\r\n                overscrollBehavior: 'contain',\r\n                WebkitOverflowScrolling: 'touch',\r\n              }}\r\n              onWheel={(e) => {\r\n                e.stopPropagation();\r\n              }}\r\n            >\r\n              {/* Total height placeholder for scroll */}\r\n              <div\r\n                style={{\r\n                  height: `${virtualizer.getTotalSize()}px`,\r\n                  width: '100%',\r\n                  position: 'relative',\r\n                  minHeight: displayOptions.length > 0 ? `${estimatedItemHeight}px` : '0px',\r\n                }}\r\n              >\r\n                {/* Only render visible items */}\r\n                {virtualizer.getVirtualItems().length > 0 ? (\r\n                  virtualizer.getVirtualItems().map((virtualItem) => {\r\n                    const option = displayOptions[virtualItem.index];\r\n                    const isSelected = value?.value === option.value;\r\n                    \r\n                    return (\r\n                      <div\r\n                        key={virtualItem.key}\r\n                        data-index={virtualItem.index}\r\n                        ref={virtualizer.measureElement}\r\n                        className={cn(\r\n                          \"absolute top-0 left-0 w-full\",\r\n                          \"flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none\",\r\n                          \"hover:bg-accent hover:text-accent-foreground\",\r\n                          \"data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\r\n                          isSelected && \"bg-accent\"\r\n                        )}\r\n                        style={{\r\n                          transform: `translateY(${virtualItem.start}px)`,\r\n                        }}\r\n                        onClick={() => handleSelect(option)}\r\n                      >\r\n                        {renderOption(option, isSelected)}\r\n                      </div>\r\n                    );\r\n                  })\r\n                ) : (\r\n                  /* Fallback: render first few items without virtualization */\r\n                  displayOptions.slice(0, 10).map((option, index) => {\r\n                    const isSelected = value?.value === option.value;\r\n                    return (\r\n                      <div\r\n                        key={option.value}\r\n                        className={cn(\r\n                          \"flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none\",\r\n                          \"hover:bg-accent hover:text-accent-foreground\",\r\n                          isSelected && \"bg-accent\"\r\n                        )}\r\n                        style={{ height: `${estimatedItemHeight}px` }}\r\n                        onClick={() => handleSelect(option)}\r\n                      >\r\n                        {renderOption(option, isSelected)}\r\n                      </div>\r\n                    );\r\n                  })\r\n                )}\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n          {/* Show count info */}\r\n          {displayOptions.length > 0 && (\r\n            <div className=\"border-t border-border px-2 py-1.5 text-xs text-muted-foreground\">\r\n              {displayOptions.length === options.length \r\n                ? `${displayOptions.length} kết quả`\r\n                : `${displayOptions.length} / ${options.length} kết quả`\r\n              }\r\n            </div>\r\n          )}\r\n        </Command>\r\n      </PopoverContent>\r\n    </Popover>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9330, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/alert.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport { cva, type VariantProps } from \"class-variance-authority\"\r\n\r\nimport { cn } from \"../../lib/utils\"\r\n\r\nconst alertVariants = cva(\r\n  \"relative w-full rounded-lg border border-border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"bg-background text-foreground\",\r\n        destructive:\r\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n    },\r\n  }\r\n)\r\n\r\nconst Alert = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\r\n>(({ className, variant, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    role=\"alert\"\r\n    className={cn(alertVariants({ variant }), className)}\r\n    {...props}\r\n  />\r\n))\r\nAlert.displayName = \"Alert\"\r\n\r\nconst AlertTitle = React.forwardRef<\r\n  HTMLParagraphElement,\r\n  React.HTMLAttributes<HTMLHeadingElement>\r\n>(({ className, ...props }, ref) => (\r\n  <h5\r\n    ref={ref}\r\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\r\n    {...props}\r\n  />\r\n))\r\nAlertTitle.displayName = \"AlertTitle\"\r\n\r\nconst AlertDescription = React.forwardRef<\r\n  HTMLParagraphElement,\r\n  React.HTMLAttributes<HTMLParagraphElement>\r\n>(({ className, ...props }, ref) => (\r\n  <div\r\n    ref={ref}\r\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\r\n    {...props}\r\n  />\r\n))\r\nAlertDescription.displayName = \"AlertDescription\"\r\n\r\nexport { Alert, AlertTitle, AlertDescription }\r\n"],"names":[],"mappings":";;;;;;;;;AAAA;AACA;AAEA;;;;;AAEA,MAAM,gBAAgB,IAAA,0KAAG,EACvB,2KACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;QACJ;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAGF,MAAM,sBAAQ,2KAAgB,MAG5B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAO,EAAE,oBACnC,6LAAC;QACC,KAAK;QACL,MAAK;QACL,WAAW,IAAA,qHAAE,EAAC,cAAc;YAAE;QAAQ,IAAI;QACzC,GAAG,KAAK;;;;;;;AAGb,MAAM,WAAW,GAAG;AAEpB,MAAM,2BAAa,2KAAgB,OAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,gDAAgD;QAC7D,GAAG,KAAK;;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,iCAAmB,2KAAgB,OAGvC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC;QACC,KAAK;QACL,WAAW,IAAA,qHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;;AAGb,iBAAiB,WAAW,GAAG"}},
    {"offset": {"line": 9408, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/shared/pkgx-mapping-dialog.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { VirtualizedCombobox, type ComboboxOption } from '@/components/ui/virtualized-combobox';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';\r\nimport { Link, AlertCircle, Lightbulb, AlertTriangle, Loader2 } from 'lucide-react';\r\n\r\n// ========================================\r\n// Types\r\n// ========================================\r\n\r\nexport type MappingEntityType = 'product' | 'brand' | 'category';\r\n\r\nexport interface MappingItem {\r\n  id: string;\r\n  name: string;\r\n  subText?: string; // e.g., SKU, ID display\r\n}\r\n\r\nexport interface MappingSuggestion {\r\n  item: MappingItem;\r\n  score: number;\r\n  matchType?: 'exact' | 'sku' | 'name';\r\n}\r\n\r\nexport interface MappingValidationError {\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface MappingValidationWarning {\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface MappingValidation {\r\n  isValid: boolean;\r\n  errors: MappingValidationError[];\r\n  warnings: MappingValidationWarning[];\r\n}\r\n\r\nexport interface PkgxMappingDialogProps {\r\n  // Dialog state\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  \r\n  // Entity type\r\n  type: MappingEntityType;\r\n  \r\n  // For editing existing mapping\r\n  isEditing?: boolean;\r\n  \r\n  // HRM items (source - to select from)\r\n  hrmItems: MappingItem[];\r\n  selectedHrmId: string;\r\n  onSelectHrmId: (id: string) => void;\r\n  \r\n  // PKGX items (target - to select from)\r\n  pkgxItems: MappingItem[];\r\n  selectedPkgxId: string;\r\n  onSelectPkgxId: (id: string) => void;\r\n  \r\n  // Suggestions for PKGX (based on selected HRM)\r\n  pkgxSuggestions?: MappingSuggestion[];\r\n  \r\n  // Validation\r\n  validation?: MappingValidation | null;\r\n  hasErrors?: boolean;\r\n  isValidating?: boolean;\r\n  \r\n  // Warning confirm state (need to click confirm twice if has warnings)\r\n  showWarningConfirm?: boolean;\r\n  \r\n  // Actions\r\n  onConfirm: () => void;\r\n  onCancel: () => void;\r\n  \r\n  // Loading state\r\n  isLoading?: boolean;\r\n}\r\n\r\n// ========================================\r\n// Entity Labels (Vietnamese)\r\n// ========================================\r\n\r\nconst ENTITY_LABELS: Record<MappingEntityType, {\r\n  title: string;\r\n  titleEdit: string;\r\n  description: string;\r\n  hrmLabel: string;\r\n  pkgxLabel: string;\r\n  hrmPlaceholder: string;\r\n  pkgxPlaceholder: string;\r\n  confirmTextAdd: string;\r\n  confirmTextUpdate: string;\r\n}> = {\r\n  product: {\r\n    title: 'Thêm liên kết sản phẩm',\r\n    titleEdit: 'Sửa liên kết sản phẩm',\r\n    description: 'Chọn sản phẩm HRM và sản phẩm PKGX tương ứng',\r\n    hrmLabel: 'Sản phẩm HRM',\r\n    pkgxLabel: 'Sản phẩm PKGX',\r\n    hrmPlaceholder: 'Chọn sản phẩm HRM...',\r\n    pkgxPlaceholder: 'Chọn sản phẩm PKGX...',\r\n    confirmTextAdd: 'Thêm',\r\n    confirmTextUpdate: 'Cập nhật',\r\n  },\r\n  brand: {\r\n    title: 'Thêm mapping thương hiệu',\r\n    titleEdit: 'Sửa mapping thương hiệu',\r\n    description: 'Chọn thương hiệu HRM và thương hiệu PKGX tương ứng',\r\n    hrmLabel: 'Thương hiệu HRM',\r\n    pkgxLabel: 'Thương hiệu PKGX',\r\n    hrmPlaceholder: 'Chọn thương hiệu HRM...',\r\n    pkgxPlaceholder: 'Chọn thương hiệu PKGX...',\r\n    confirmTextAdd: 'Thêm',\r\n    confirmTextUpdate: 'Cập nhật',\r\n  },\r\n  category: {\r\n    title: 'Thêm mapping danh mục',\r\n    titleEdit: 'Sửa mapping danh mục',\r\n    description: 'Chọn danh mục HRM và danh mục PKGX tương ứng',\r\n    hrmLabel: 'Danh mục HRM',\r\n    pkgxLabel: 'Danh mục PKGX',\r\n    hrmPlaceholder: 'Chọn danh mục HRM...',\r\n    pkgxPlaceholder: 'Chọn danh mục PKGX...',\r\n    confirmTextAdd: 'Thêm',\r\n    confirmTextUpdate: 'Cập nhật',\r\n  },\r\n};\r\n\r\n// ========================================\r\n// Component\r\n// ========================================\r\n\r\nexport function PkgxMappingDialog({\r\n  open,\r\n  onOpenChange,\r\n  type,\r\n  isEditing = false,\r\n  hrmItems,\r\n  selectedHrmId,\r\n  onSelectHrmId,\r\n  pkgxItems,\r\n  selectedPkgxId,\r\n  onSelectPkgxId,\r\n  pkgxSuggestions = [],\r\n  validation,\r\n  hasErrors = false,\r\n  isValidating = false,\r\n  showWarningConfirm = false,\r\n  onConfirm,\r\n  onCancel,\r\n  isLoading = false,\r\n}: PkgxMappingDialogProps) {\r\n  const labels = ENTITY_LABELS[type];\r\n  \r\n  // Determine title and confirm text\r\n  const title = isEditing ? labels.titleEdit : labels.title;\r\n  const confirmText = isEditing ? labels.confirmTextUpdate : labels.confirmTextAdd;\r\n  const confirmTextWithWarning = `Xác nhận ${confirmText.toLowerCase()}`;\r\n  \r\n  // Get field error from validation\r\n  const getFieldError = (field: string): string | undefined => {\r\n    if (!validation) return undefined;\r\n    const error = validation.errors.find(e => e.field === field);\r\n    return error?.message;\r\n  };\r\n  \r\n  // Field names vary by entity type\r\n  const hrmFieldName = type === 'product' ? 'hrmProductSystemId' : \r\n                       type === 'brand' ? 'hrmBrandSystemId' : 'hrmCategorySystemId';\r\n  const pkgxFieldName = type === 'product' ? 'pkgxProductId' : \r\n                        type === 'brand' ? 'pkgxBrandId' : 'pkgxCategoryId';\r\n\r\n  // Convert MappingItem[] to ComboboxOption[]\r\n  const hrmOptions: ComboboxOption[] = React.useMemo(() => \r\n    hrmItems.map((item) => ({\r\n      value: item.id,\r\n      label: item.name,\r\n      subtitle: item.subText,\r\n    })), [hrmItems]);\r\n  \r\n  const pkgxOptions: ComboboxOption[] = React.useMemo(() => \r\n    pkgxItems.map((item) => ({\r\n      value: item.id,\r\n      label: item.name,\r\n      subtitle: item.subText,\r\n    })), [pkgxItems]);\r\n  \r\n  // Get selected option objects\r\n  const selectedHrmOption = hrmOptions.find(o => o.value === selectedHrmId) || null;\r\n  const selectedPkgxOption = pkgxOptions.find(o => o.value === selectedPkgxId) || null;\r\n  \r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"max-w-lg\">\r\n        <DialogHeader>\r\n          <DialogTitle>{title}</DialogTitle>\r\n          <DialogDescription>{labels.description}</DialogDescription>\r\n        </DialogHeader>\r\n        \r\n        <div className=\"space-y-4 py-4\">\r\n          {/* HRM Select - Using VirtualizedCombobox for better UX with many items */}\r\n          <div className=\"space-y-2\">\r\n            <Label>{labels.hrmLabel}</Label>\r\n            <VirtualizedCombobox\r\n              value={selectedHrmOption}\r\n              onChange={(option) => onSelectHrmId(option?.value || '')}\r\n              options={hrmOptions}\r\n              placeholder={labels.hrmPlaceholder}\r\n              searchPlaceholder=\"Tìm kiếm...\"\r\n              emptyPlaceholder=\"Không tìm thấy kết quả\"\r\n            />\r\n            {getFieldError(hrmFieldName) && (\r\n              <p className=\"text-sm text-destructive flex items-center gap-1\">\r\n                <AlertCircle className=\"h-3 w-3\" />\r\n                {getFieldError(hrmFieldName)}\r\n              </p>\r\n            )}\r\n          </div>\r\n          \r\n          {/* PKGX Select - Using VirtualizedCombobox for better UX with many items */}\r\n          <div className=\"space-y-2\">\r\n            <Label>{labels.pkgxLabel}</Label>\r\n            <VirtualizedCombobox\r\n              value={selectedPkgxOption}\r\n              onChange={(option) => onSelectPkgxId(option?.value || '')}\r\n              options={pkgxOptions}\r\n              placeholder={labels.pkgxPlaceholder}\r\n              searchPlaceholder=\"Tìm kiếm...\"\r\n              emptyPlaceholder=\"Không tìm thấy kết quả\"\r\n            />\r\n            {getFieldError(pkgxFieldName) && (\r\n              <p className=\"text-sm text-destructive flex items-center gap-1\">\r\n                <AlertCircle className=\"h-3 w-3\" />\r\n                {getFieldError(pkgxFieldName)}\r\n              </p>\r\n            )}\r\n          </div>\r\n          \r\n          {/* PKGX Suggestions */}\r\n          {pkgxSuggestions.length > 0 && selectedHrmId && !selectedPkgxId && (\r\n            <div className=\"space-y-2\">\r\n              <Label className=\"text-sm text-muted-foreground flex items-center gap-1\">\r\n                <Lightbulb className=\"h-3 w-3\" />\r\n                Gợi ý {labels.pkgxLabel.toLowerCase()} phù hợp:\r\n              </Label>\r\n              <div className=\"flex flex-wrap gap-2\">\r\n                {pkgxSuggestions.slice(0, 3).map((s) => (\r\n                  <Button\r\n                    key={s.item.id}\r\n                    type=\"button\"\r\n                    variant=\"outline\"\r\n                    size=\"sm\"\r\n                    className=\"text-xs\"\r\n                    onClick={() => onSelectPkgxId(s.item.id)}\r\n                  >\r\n                    {s.item.name}\r\n                    <Badge \r\n                      variant={s.matchType === 'exact' ? 'default' : 'secondary'} \r\n                      className=\"ml-1 text-xs\"\r\n                    >\r\n                      {s.matchType === 'exact' ? 'Trùng tên' : Math.round(s.score * 100) + '%'}\r\n                    </Badge>\r\n                  </Button>\r\n                ))}\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n          {/* Validation Errors */}\r\n          {validation && validation.errors.length > 0 && (\r\n            <Alert variant=\"destructive\">\r\n              <AlertCircle className=\"h-4 w-4\" />\r\n              <AlertTitle>Lỗi validation</AlertTitle>\r\n              <AlertDescription>\r\n                <ul className=\"list-disc list-inside space-y-1 mt-2\">\r\n                  {validation.errors.map((err, i) => (\r\n                    <li key={i}>{err.message}</li>\r\n                  ))}\r\n                </ul>\r\n              </AlertDescription>\r\n            </Alert>\r\n          )}\r\n          \r\n          {/* Validation Warnings */}\r\n          {validation && validation.warnings.length > 0 && validation.errors.length === 0 && (\r\n            <Alert variant=\"default\" className=\"border-yellow-500 bg-yellow-50 dark:bg-yellow-950/20\">\r\n              <AlertTriangle className=\"h-4 w-4 text-yellow-600\" />\r\n              <AlertTitle className=\"text-yellow-700 dark:text-yellow-400\">Cảnh báo</AlertTitle>\r\n              <AlertDescription className=\"text-yellow-600 dark:text-yellow-300\">\r\n                <ul className=\"list-disc list-inside space-y-1 mt-2\">\r\n                  {validation.warnings.map((w, i) => (\r\n                    <li key={i}>\r\n                      {w.message}\r\n                      {/* Show suggestion button for suggestedBrand/suggestedCategory */}\r\n                      {w.details?.suggestedBrand && (\r\n                        <Button\r\n                          type=\"button\"\r\n                          variant=\"link\"\r\n                          size=\"sm\"\r\n                          className=\"h-auto p-0 ml-1 text-yellow-700\"\r\n                          onClick={() => onSelectPkgxId(w.details!.suggestedBrand.id.toString())}\r\n                        >\r\n                          → Chọn \"{w.details.suggestedBrand.name}\"\r\n                        </Button>\r\n                      )}\r\n                      {w.details?.suggestedCategory && (\r\n                        <Button\r\n                          type=\"button\"\r\n                          variant=\"link\"\r\n                          size=\"sm\"\r\n                          className=\"h-auto p-0 ml-1 text-yellow-700\"\r\n                          onClick={() => onSelectPkgxId(w.details!.suggestedCategory.id.toString())}\r\n                        >\r\n                          → Chọn \"{w.details.suggestedCategory.name}\"\r\n                        </Button>\r\n                      )}\r\n                    </li>\r\n                  ))}\r\n                </ul>\r\n                {showWarningConfirm && (\r\n                  <p className=\"mt-3 font-medium\">Bấm \"{confirmTextWithWarning}\" lần nữa để xác nhận.</p>\r\n                )}\r\n              </AlertDescription>\r\n            </Alert>\r\n          )}\r\n        </div>\r\n        \r\n        <DialogFooter>\r\n          <Button variant=\"outline\" onClick={onCancel} disabled={isLoading || isValidating}>\r\n            Hủy\r\n          </Button>\r\n          <Button \r\n            onClick={onConfirm} \r\n            disabled={hasErrors || isLoading || isValidating}\r\n          >\r\n            {(isLoading || isValidating) && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n            {!isLoading && !isValidating && <Link className=\"h-4 w-4 mr-2\" />}\r\n            {showWarningConfirm ? confirmTextWithWarning : confirmText}\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n\r\nexport default PkgxMappingDialog;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9906, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/components/pkgx-sync-confirm-dialog.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Loader2 } from 'lucide-react';\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '../../../../components/ui/alert-dialog';\r\nimport type { ConfirmActionState } from '../hooks/use-pkgx-entity-sync';\r\n\r\ninterface PkgxSyncConfirmDialogProps {\r\n  confirmAction: ConfirmActionState;\r\n  isSyncing: boolean;\r\n  onConfirm: () => void;\r\n  onCancel: () => void;\r\n}\r\n\r\n/**\r\n * Shared confirmation dialog for PKGX sync actions\r\n * Used by category-mapping-tab, brand-mapping-tab, product-mapping-tab\r\n */\r\nexport function PkgxSyncConfirmDialog({\r\n  confirmAction,\r\n  isSyncing,\r\n  onConfirm,\r\n  onCancel,\r\n}: PkgxSyncConfirmDialogProps) {\r\n  return (\r\n    <AlertDialog open={confirmAction.open} onOpenChange={(open) => !open && onCancel()}>\r\n      <AlertDialogContent>\r\n        <AlertDialogHeader>\r\n          <AlertDialogTitle>{confirmAction.title}</AlertDialogTitle>\r\n          <AlertDialogDescription>{confirmAction.description}</AlertDialogDescription>\r\n        </AlertDialogHeader>\r\n        <AlertDialogFooter>\r\n          <AlertDialogCancel>Hủy</AlertDialogCancel>\r\n          <AlertDialogAction onClick={onConfirm} disabled={isSyncing}>\r\n            {isSyncing && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n            Xác nhận\r\n          </AlertDialogAction>\r\n        </AlertDialogFooter>\r\n      </AlertDialogContent>\r\n    </AlertDialog>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;;;;AAcO,SAAS,sBAAsB,EACpC,aAAa,EACb,SAAS,EACT,SAAS,EACT,QAAQ,EACmB;IAC3B,qBACE,6LAAC,sJAAW;QAAC,MAAM,cAAc,IAAI;QAAE,cAAc,CAAC,OAAS,CAAC,QAAQ;kBACtE,cAAA,6LAAC,6JAAkB;;8BACjB,6LAAC,4JAAiB;;sCAChB,6LAAC,2JAAgB;sCAAE,cAAc,KAAK;;;;;;sCACtC,6LAAC,iKAAsB;sCAAE,cAAc,WAAW;;;;;;;;;;;;8BAEpD,6LAAC,4JAAiB;;sCAChB,6LAAC,4JAAiB;sCAAC;;;;;;sCACnB,6LAAC,4JAAiB;4BAAC,SAAS;4BAAW,UAAU;;gCAC9C,2BAAa,6LAAC,+NAAO;oCAAC,WAAU;;;;;;gCAA+B;;;;;;;;;;;;;;;;;;;;;;;;AAO5E;KAvBgB"}},
    {"offset": {"line": 9999, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/components/product-mapping-tab.tsx"],"sourcesContent":["'use client'\r\n\r\nimport * as React from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../../../../components/ui/card';\r\nimport { Button } from '../../../../components/ui/button';\r\nimport { Input } from '../../../../components/ui/input';\r\nimport { Badge } from '../../../../components/ui/badge';\r\nimport { Switch } from '../../../../components/ui/switch';\r\nimport { Checkbox } from '../../../../components/ui/checkbox';\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '../../../../components/ui/dialog';\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '../../../../components/ui/alert-dialog';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../../../../components/ui/select';\r\nimport { Label } from '../../../../components/ui/label';\r\nimport { ScrollArea } from '../../../../components/ui/scroll-area';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '../../../../components/ui/tabs';\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger } from '../../../../components/ui/dropdown-menu';\r\nimport { Search, ExternalLink, Link, Unlink, RefreshCw, Loader2, CheckCircle2, Upload, ArrowRight, Settings2, MoreHorizontal, Eye, TriangleAlert, Package, DollarSign, FileText, Link2, ImageIcon, Flame, Sparkles, Home, Star, ShoppingBag, Circle, XCircle, Trash2, AlertCircle, Lightbulb, AlertTriangle, AlignLeft, Tag, Image } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { useProductStore } from '../../../products/store';\r\nimport { usePkgxSettingsStore } from '../store';\r\nimport { getProducts as fetchPkgxProducts, updateProduct as updatePkgxProduct, getProductById as fetchPkgxProductById, getProductGallery as fetchPkgxGallery } from '../../../../lib/pkgx/api-service';\r\nimport type { PkgxProduct, PkgxGalleryImage } from '../types';\r\nimport type { SystemId } from '../../../../lib/id-types';\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '../../../../components/ui/tooltip';\r\nimport { ResponsiveDataTable } from '../../../../components/data-table/responsive-data-table';\r\nimport { useAuth, getCurrentUserName } from '../../../../contexts/auth-context';\r\nimport { Alert, AlertDescription, AlertTitle } from '../../../../components/ui/alert';\r\nimport { useProductMappingValidation } from '../hooks/use-product-mapping-validation';\r\nimport { usePkgxEntitySync } from '../hooks';\r\nimport type { HrmProductData } from '../hooks';\r\nimport type { ProductMappingInput } from '../validation/product-mapping-validation';\r\nimport { PkgxMappingDialog } from '../../../../components/shared/pkgx-mapping-dialog';\r\nimport { PkgxSyncConfirmDialog } from './pkgx-sync-confirm-dialog';\r\nimport type { ColumnDef } from '../../../../components/data-table/types';\r\n\r\n// ========================================\r\n// Mobile Dropdown Helper Component\r\n// ========================================\r\ninterface MobileProductDropdownProps {\r\n  row: PkgxProductRow;\r\n  entitySync: ReturnType<typeof usePkgxEntitySync>;\r\n  onViewOnPkgx: (goodsId: number) => void;\r\n  onOpenLinkDialog: (row: PkgxProduct) => void;\r\n  onOpenUnlinkDialog: (row: PkgxProduct) => void;\r\n}\r\n\r\nfunction MobileProductDropdown({ row, entitySync, onViewOnPkgx, onOpenLinkDialog, onOpenUnlinkDialog }: MobileProductDropdownProps) {\r\n  // Helper to build HRM product data for sync\r\n  const buildHrmData = (): HrmProductData | null => {\r\n    if (!row.linkedHrmProduct) return null;\r\n    return {\r\n      systemId: row.linkedHrmProduct.systemId,\r\n      name: row.linkedHrmProduct.name,\r\n      sku: row.linkedHrmProduct.sku,\r\n      sellingPrice: row.linkedHrmProduct.sellingPrice,\r\n      costPrice: row.linkedHrmProduct.costPrice,\r\n      dealPrice: row.linkedHrmProduct.dealPrice,\r\n      quantity: row.linkedHrmProduct.quantity,\r\n      seoKeywords: row.linkedHrmProduct.seoKeywords,\r\n      ktitle: row.linkedHrmProduct.ktitle,\r\n      seoDescription: row.linkedHrmProduct.seoDescription,\r\n      shortDescription: row.linkedHrmProduct.shortDescription,\r\n      description: row.linkedHrmProduct.description,\r\n      isBest: row.linkedHrmProduct.isBest,\r\n      isNew: row.linkedHrmProduct.isNew,\r\n      isHot: row.linkedHrmProduct.isHot,\r\n      isHome: row.linkedHrmProduct.isHome,\r\n      categorySystemId: row.linkedHrmProduct.categorySystemId,\r\n      brandSystemId: row.linkedHrmProduct.brandSystemId,\r\n    };\r\n  };\r\n  \r\n  // Helper to trigger sync with proper HRM data\r\n  const triggerSync = (actionKey: 'sync_all' | 'sync_basic' | 'sync_seo' | 'sync_description' | 'sync_price' | 'sync_inventory' | 'sync_flags') => {\r\n    const hrmData = buildHrmData();\r\n    if (!hrmData) {\r\n      toast.error('Sản phẩm chưa được liên kết với HRM');\r\n      return;\r\n    }\r\n    entitySync.triggerSyncAction(actionKey, row.goods_id, hrmData, row.goods_name);\r\n  };\r\n  \r\n  return (\r\n    <DropdownMenu>\r\n      <DropdownMenuTrigger asChild>\r\n        <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\r\n          <MoreHorizontal className=\"h-4 w-4\" />\r\n        </Button>\r\n      </DropdownMenuTrigger>\r\n      <DropdownMenuContent align=\"end\">\r\n        {row.linkedHrmProduct ? (\r\n          <>\r\n            {/* Sync All */}\r\n            <DropdownMenuItem \r\n              onClick={() => triggerSync('sync_all')}\r\n              className=\"font-medium\"\r\n            >\r\n              <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n              Đồng bộ tất cả\r\n            </DropdownMenuItem>\r\n            <DropdownMenuSeparator />\r\n            <DropdownMenuItem onClick={() => triggerSync('sync_basic')}>\r\n              <FileText className=\"h-4 w-4 mr-2\" />\r\n              Thông tin cơ bản\r\n            </DropdownMenuItem>\r\n            <DropdownMenuItem onClick={() => triggerSync('sync_price')}>\r\n              <DollarSign className=\"h-4 w-4 mr-2\" />\r\n              Giá\r\n            </DropdownMenuItem>\r\n            <DropdownMenuItem onClick={() => triggerSync('sync_inventory')}>\r\n              <Package className=\"h-4 w-4 mr-2\" />\r\n              Tồn kho\r\n            </DropdownMenuItem>\r\n            <DropdownMenuItem onClick={() => triggerSync('sync_seo')}>\r\n              <Search className=\"h-4 w-4 mr-2\" />\r\n              SEO\r\n            </DropdownMenuItem>\r\n            <DropdownMenuItem onClick={() => triggerSync('sync_description')}>\r\n              <AlignLeft className=\"h-4 w-4 mr-2\" />\r\n              Mô tả\r\n            </DropdownMenuItem>\r\n            <DropdownMenuItem onClick={() => triggerSync('sync_flags')}>\r\n              <Tag className=\"h-4 w-4 mr-2\" />\r\n              Flags\r\n            </DropdownMenuItem>\r\n            \r\n            <DropdownMenuSeparator />\r\n            <DropdownMenuItem onClick={() => onViewOnPkgx(row.goods_id)}>\r\n              <ExternalLink className=\"h-4 w-4 mr-2\" />\r\n              Xem trên PKGX\r\n            </DropdownMenuItem>\r\n            \r\n            <DropdownMenuSeparator />\r\n            <DropdownMenuItem \r\n              onClick={() => onOpenUnlinkDialog(row)}\r\n              className=\"text-destructive focus:text-destructive\"\r\n            >\r\n              <Unlink className=\"h-4 w-4 mr-2\" />\r\n              Hủy liên kết\r\n            </DropdownMenuItem>\r\n          </>\r\n        ) : (\r\n          <>\r\n            <DropdownMenuItem onClick={() => onOpenLinkDialog(row)}>\r\n              <Link2 className=\"h-4 w-4 mr-2\" />\r\n              Liên kết với HRM\r\n            </DropdownMenuItem>\r\n          </>\r\n        )}\r\n      </DropdownMenuContent>\r\n    </DropdownMenu>\r\n  );\r\n}\r\n\r\n// ========================================\r\n// PKGX Sync Fields Configuration\r\n// ========================================\r\n// \r\n// QUAN TRỌNG - Cấu trúc ID:\r\n// - goods_id (PKGX): PRIMARY KEY - Dùng cho TẤT CẢ API calls (update, delete, link)\r\n// - goods_sn (PKGX) = sku (HRM): Mã SKU sản phẩm, có thể sync 2 chiều\r\n// - pkgxId (HRM Product): Lưu trữ goods_id để link sản phẩm\r\n//\r\n// Sync fields configuration - HRM to PKGX (push only)\r\n// Giá sử dụng cấu hình từ tab \"Mapping giá\" (không chọn từng trường)\r\nconst PUSH_SYNC_FIELDS = [\r\n  // Thông tin cơ bản\r\n  { key: 'goods_name', label: 'Tên sản phẩm', hrmField: 'name', group: 'basic' },\r\n  { key: 'goods_sn', label: 'Mã SKU', hrmField: 'sku', group: 'basic' },\r\n  { key: 'goods_brief', label: 'Mô tả ngắn', hrmField: 'shortDescription', group: 'basic' },\r\n  { key: 'goods_desc', label: 'Mô tả chi tiết', hrmField: 'description', group: 'basic' },\r\n  \r\n  // Giá cả - Một toggle cho tất cả, sử dụng mapping từ tab Mapping giá\r\n  { key: 'sync_prices', label: 'Đồng bộ giá (theo cấu hình Mapping giá)', hrmField: 'prices', group: 'price', isSpecial: true },\r\n  \r\n  // Tồn kho\r\n  { key: 'goods_number', label: 'Số lượng tồn', hrmField: 'quantity', group: 'inventory' },\r\n  \r\n  // Phân loại\r\n  { key: 'cat_id', label: 'Danh mục', hrmField: 'categoryId', group: 'classification' },\r\n  { key: 'brand_id', label: 'Thương hiệu', hrmField: 'brandId', group: 'classification' },\r\n  \r\n  // SEO\r\n  { key: 'keywords', label: 'Từ khóa SEO', hrmField: 'seoKeywords', group: 'seo' },\r\n  { key: 'meta_title', label: 'Tiêu đề SEO', hrmField: 'ktitle', group: 'seo' },\r\n  { key: 'meta_desc', label: 'Mô tả SEO', hrmField: 'seoDescription', group: 'seo' },\r\n  \r\n  // Trạng thái hiển thị\r\n  { key: 'best', label: 'SP tốt nhất', hrmField: 'isBest', group: 'display' },\r\n  { key: 'hot', label: 'SP hot', hrmField: 'isHot', group: 'display' },\r\n  { key: 'new', label: 'SP mới', hrmField: 'isNew', group: 'display' },\r\n  { key: 'ishome', label: 'Hiển thị trang chủ', hrmField: 'isHome', group: 'display' },\r\n  \r\n  // Ghi chú\r\n  { key: 'seller_note', label: 'Ghi chú người bán', hrmField: 'sellerNote', group: 'other' },\r\n] as const;\r\n\r\ntype PushSyncFieldKey = typeof PUSH_SYNC_FIELDS[number]['key'];\r\n\r\n// Extended type for table display - MUST have systemId for ResponsiveDataTable\r\ninterface PkgxProductRow extends PkgxProduct {\r\n  systemId: string; // Required by ResponsiveDataTable - use goods_id.toString()\r\n  linkedHrmProduct?: {\r\n    systemId: string;\r\n    name: string;\r\n    id: string;\r\n    sku?: string;\r\n    // Giá cả\r\n    sellingPrice?: number;\r\n    costPrice?: number;\r\n    partnerPrice?: number;\r\n    acePrice?: number;\r\n    dealPrice?: number;\r\n    // Tồn kho\r\n    quantity?: number;\r\n    // Nội dung\r\n    description?: string;\r\n    shortDescription?: string;\r\n    // SEO\r\n    seoDescription?: string;\r\n    seoKeywords?: string;\r\n    ktitle?: string;\r\n    // Phân loại\r\n    categorySystemId?: SystemId;\r\n    brandSystemId?: SystemId;\r\n    // Trạng thái\r\n    isBest?: boolean;\r\n    isHot?: boolean;\r\n    isNew?: boolean;\r\n    isHome?: boolean;\r\n    // Khác\r\n    sellerNote?: string;\r\n  };\r\n}\r\n\r\nexport function ProductMappingTab() {\r\n  // Router & Auth\r\n  const router = useRouter();\r\n  const { user } = useAuth();\r\n  \r\n  // Stores\r\n  const { settings, addLog, getPkgxCatIdByHrmCategory, getPkgxBrandIdByHrmBrand, setPkgxProducts } = usePkgxSettingsStore();\r\n  const productStore = useProductStore();\r\n  \r\n  const [searchTerm, setSearchTerm] = React.useState('');\r\n  const [isSyncing, setIsSyncing] = React.useState(false);\r\n  \r\n  // Sử dụng pkgxProducts từ store (dùng chung với Link Dialog)\r\n  const pkgxProducts = settings.pkgxProducts || [];\r\n  \r\n  // Auto-fetch khi vào tab nếu chưa có data và PKGX đã được cấu hình\r\n  const hasAutoFetched = React.useRef(false);\r\n  \r\n  // Helper function để build URL ảnh PKGX\r\n  const buildPkgxImageUrl = React.useCallback((imagePath: string | undefined | null): string => {\r\n    if (!imagePath) return '';\r\n    if (imagePath.startsWith('http')) return imagePath;\r\n    // Xóa / ở đầu nếu có và build URL đầy đủ với /cdn/\r\n    const cleanPath = imagePath.replace(/^\\/+/, '');\r\n    return `https://phukiengiaxuong.com.vn/cdn/${cleanPath}`;\r\n  }, []);\r\n  \r\n  // Product detail dialog state\r\n  const [isDetailDialogOpen, setIsDetailDialogOpen] = React.useState(false);\r\n  const [selectedProductForDetail, setSelectedProductForDetail] = React.useState<PkgxProductRow | null>(null);\r\n  const [isLoadingProductDetail, setIsLoadingProductDetail] = React.useState(false);\r\n  \r\n  // Gallery state\r\n  const [galleryImages, setGalleryImages] = React.useState<PkgxGalleryImage[]>([]);\r\n  const [isLoadingGallery, setIsLoadingGallery] = React.useState(false);\r\n  \r\n  // Link dialog state\r\n  const [selectedPkgxProduct, setSelectedPkgxProduct] = React.useState<PkgxProduct | null>(null);\r\n  const [isLinkDialogOpen, setIsLinkDialogOpen] = React.useState(false);\r\n  const [selectedHrmProductId, setSelectedHrmProductId] = React.useState('');\r\n  const [showWarningConfirm, setShowWarningConfirm] = React.useState(false);\r\n  \r\n  // Unlink dialog state\r\n  const [isUnlinkDialogOpen, setIsUnlinkDialogOpen] = React.useState(false);\r\n  const [productToUnlink, setProductToUnlink] = React.useState<{ pkgxProduct: PkgxProduct; hrmProduct: any } | null>(null);\r\n  \r\n  // Row selection state\r\n  const [rowSelection, setRowSelection] = React.useState<Record<string, boolean>>({});\r\n  \r\n  // Bulk unlink dialog state\r\n  const [isBulkUnlinkDialogOpen, setIsBulkUnlinkDialogOpen] = React.useState(false);\r\n  \r\n  // Use shared PKGX entity sync hook\r\n  const entitySync = usePkgxEntitySync({\r\n    entityType: 'product',\r\n    onLog: addLog,\r\n    getPkgxCatIdByHrmCategory,\r\n    getPkgxBrandIdByHrmBrand,\r\n  });\r\n  \r\n  // Sync dialog state - Push (HRM to PKGX) - Default basic fields + prices\r\n  const [isPushDialogOpen, setIsPushDialogOpen] = React.useState(false);\r\n  const [productToPush, setProductToPush] = React.useState<PkgxProductRow | null>(null);\r\n  const [selectedPushFields, setSelectedPushFields] = React.useState<PushSyncFieldKey[]>(['goods_name', 'sync_prices', 'goods_number']);\r\n  const [isPushingProduct, setIsPushingProduct] = React.useState(false);\r\n  \r\n  // HRM products - sử dụng productStore.data trực tiếp để đảm bảo reactive\r\n  const hrmProducts = React.useMemo(\r\n    () => productStore.data.filter(p => !p.isDeleted).sort((a, b) => a.name.localeCompare(b.name)),\r\n    [productStore.data]\r\n  );\r\n  \r\n  // Validation hook\r\n  const validation = useProductMappingValidation({\r\n    hrmProducts: hrmProducts.map(p => ({\r\n      systemId: p.systemId,\r\n      name: p.name,\r\n      id: p.id,\r\n      pkgxId: p.pkgxId,\r\n      status: p.status,\r\n    })),\r\n    pkgxProducts: pkgxProducts,\r\n    editingProductId: undefined,\r\n    debounceMs: 300,\r\n  });\r\n  \r\n  // Count of linked HRM products\r\n  const linkedCount = React.useMemo(\r\n    () => hrmProducts.filter((p) => p.pkgxId).length,\r\n    [hrmProducts]\r\n  );\r\n  \r\n  // Find HRM product linked to a PKGX product\r\n  // FIX: Sử dụng == thay vì === để handle cả string và number (localStorage có thể lưu string)\r\n  const findLinkedHrmProduct = React.useCallback((pkgxId: number) => {\r\n    return hrmProducts.find((p) => p.pkgxId == pkgxId);\r\n  }, [hrmProducts]);\r\n  \r\n  // Filter and transform PKGX products\r\n  const tableData = React.useMemo((): PkgxProductRow[] => {\r\n    let filtered = pkgxProducts;\r\n    if (searchTerm) {\r\n      const term = searchTerm.toLowerCase();\r\n      filtered = pkgxProducts.filter(\r\n        (p) =>\r\n          p.goods_name.toLowerCase().includes(term) ||\r\n          p.goods_sn?.toLowerCase().includes(term) ||\r\n          p.goods_id.toString().includes(term)\r\n      );\r\n    }\r\n    \r\n    return filtered.map((p) => {\r\n      const linked = findLinkedHrmProduct(p.goods_id);\r\n      // Calculate total inventory from all branches\r\n      const totalInventory = linked \r\n        ? Object.values(linked.inventoryByBranch || {}).reduce((sum, qty) => sum + qty, 0)\r\n        : 0;\r\n      \r\n      return {\r\n        ...p,\r\n        linkedHrmProduct: linked ? {\r\n          systemId: linked.systemId,\r\n          name: linked.name,\r\n          id: linked.id,\r\n          sku: (linked as any).sku,\r\n          // Giá cả\r\n          sellingPrice: linked.sellingPrice,\r\n          costPrice: linked.costPrice,\r\n          partnerPrice: (linked as any).partnerPrice,\r\n          acePrice: (linked as any).acePrice,\r\n          dealPrice: (linked as any).dealPrice,\r\n          // Tồn kho\r\n          quantity: totalInventory,\r\n          // Nội dung\r\n          description: linked.description,\r\n          shortDescription: linked.shortDescription,\r\n          // SEO\r\n          seoDescription: linked.seoDescription,\r\n          seoKeywords: (linked as any).seoKeywords,\r\n          ktitle: linked.ktitle,\r\n          // Phân loại\r\n          categorySystemId: linked.categorySystemId,\r\n          brandSystemId: linked.brandSystemId,\r\n          // Trạng thái\r\n          isBest: (linked as any).isBest,\r\n          isHot: (linked as any).isHot,\r\n          isNew: (linked as any).isNew,\r\n          isHome: (linked as any).isHome,\r\n          // Khác\r\n          sellerNote: (linked as any).sellerNote,\r\n        } : undefined,\r\n        // Required by ResponsiveDataTable\r\n        systemId: p.goods_id.toString(),\r\n      };\r\n    });\r\n  }, [pkgxProducts, searchTerm, findLinkedHrmProduct]);\r\n  \r\n  // Pagination state for ResponsiveDataTable\r\n  const [pagination, setPagination] = React.useState({ pageIndex: 0, pageSize: 20 });\r\n  const [sorting, setSorting] = React.useState<{ id: string; desc: boolean }>({ id: 'goods_id', desc: true });\r\n  \r\n  // Paginated data for ResponsiveDataTable\r\n  const pageCount = Math.ceil(tableData.length / pagination.pageSize);\r\n  const paginatedData = React.useMemo(() => {\r\n    const start = pagination.pageIndex * pagination.pageSize;\r\n    return tableData.slice(start, start + pagination.pageSize);\r\n  }, [tableData, pagination]);\r\n  \r\n  // Reset page when search changes\r\n  React.useEffect(() => {\r\n    setPagination(prev => ({ ...prev, pageIndex: 0 }));\r\n  }, [searchTerm]);\r\n  \r\n  // Column definitions for ResponsiveDataTable\r\n  const columns = React.useMemo((): ColumnDef<PkgxProductRow>[] => [\r\n    // Checkbox column\r\n    {\r\n      id: 'select',\r\n      header: ({ isAllPageRowsSelected, isSomePageRowsSelected, onToggleAll }) => (\r\n        <Checkbox\r\n          checked={isAllPageRowsSelected ? true : isSomePageRowsSelected ? \"indeterminate\" : false}\r\n          onCheckedChange={(value) => onToggleAll?.(!!value)}\r\n          aria-label=\"Select all\"\r\n        />\r\n      ),\r\n      cell: ({ onToggleSelect, isSelected }) => (\r\n        <Checkbox\r\n          checked={isSelected}\r\n          onCheckedChange={onToggleSelect}\r\n          aria-label=\"Select row\"\r\n        />\r\n      ),\r\n      size: 40,\r\n      meta: { displayName: 'Chọn', excludeFromExport: true },\r\n    },\r\n    {\r\n      id: 'goods_id',\r\n      accessorKey: 'goods_id',\r\n      header: 'ID',\r\n      size: 70,\r\n      cell: ({ row }) => (\r\n        <span className=\"font-mono text-sm text-muted-foreground\">{row.goods_id}</span>\r\n      ),\r\n      meta: { displayName: 'ID' },\r\n    },\r\n    {\r\n      id: 'goods_sn',\r\n      accessorKey: 'goods_sn',\r\n      header: 'Mã SP',\r\n      size: 100,\r\n      cell: ({ row }) => (\r\n        <span className=\"font-mono text-xs truncate block max-w-[90px]\" title={row.goods_sn || '-'}>\r\n          {row.goods_sn || '-'}\r\n        </span>\r\n      ),\r\n      meta: { displayName: 'Mã SP' },\r\n    },\r\n    {\r\n      id: 'goods_name',\r\n      accessorKey: 'goods_name',\r\n      header: 'Tên sản phẩm PKGX',\r\n      size: 300,\r\n      cell: ({ row }) => (\r\n        <button\r\n          className=\"font-medium line-clamp-2 text-left hover:text-primary hover:underline cursor-pointer\"\r\n          title={`Click để xem chi tiết: ${row.goods_name}`}\r\n          onClick={() => handleOpenDetailDialog(row)}\r\n        >\r\n          {row.goods_name}\r\n        </button>\r\n      ),\r\n      meta: { displayName: 'Tên sản phẩm PKGX' },\r\n    },\r\n    {\r\n      id: 'linkedHrmProduct',\r\n      header: 'Sản phẩm HRM',\r\n      size: 200,\r\n      cell: ({ row }) => (\r\n        row.linkedHrmProduct ? (\r\n          <button \r\n            className=\"text-sm truncate block max-w-[190px] text-left hover:text-primary hover:underline cursor-pointer transition-colors\" \r\n            title={`Click để xem chi tiết: ${row.linkedHrmProduct.name}`}\r\n            onClick={(e) => {\r\n              e.stopPropagation();\r\n              // Mở trang sản phẩm trong tab mới\r\n              window.open(`/products?id=${row.linkedHrmProduct.id}`, '_blank');\r\n            }}\r\n          >\r\n            {row.linkedHrmProduct.name}\r\n          </button>\r\n        ) : (\r\n          <span className=\"text-sm text-muted-foreground\">Chưa liên kết</span>\r\n        )\r\n      ),\r\n      meta: { displayName: 'Sản phẩm HRM' },\r\n    },\r\n    {\r\n      id: 'status',\r\n      header: 'Trạng thái',\r\n      size: 110,\r\n      cell: ({ row }) => (\r\n        <div className=\"text-center\">\r\n          {row.linkedHrmProduct ? (\r\n            <Badge variant=\"default\" className=\"bg-green-500 text-xs\">\r\n              <CheckCircle2 className=\"h-3 w-3 mr-1\" />\r\n              Đã liên kết\r\n            </Badge>\r\n          ) : (\r\n            <Badge variant=\"secondary\" className=\"text-xs\">\r\n              Chưa liên kết\r\n            </Badge>\r\n          )}\r\n        </div>\r\n      ),\r\n      meta: { displayName: 'Trạng thái' },\r\n    },\r\n    {\r\n      id: 'actions',\r\n      header: '',\r\n      size: 50,\r\n      cell: ({ row }) => {\r\n        // Helper to build HRM product data for sync\r\n        const buildHrmData = (): HrmProductData | null => {\r\n          if (!row.linkedHrmProduct) return null;\r\n          return {\r\n            systemId: row.linkedHrmProduct.systemId,\r\n            name: row.linkedHrmProduct.name,\r\n            sku: row.linkedHrmProduct.sku,\r\n            sellingPrice: row.linkedHrmProduct.sellingPrice,\r\n            costPrice: row.linkedHrmProduct.costPrice,\r\n            dealPrice: row.linkedHrmProduct.dealPrice,\r\n            quantity: row.linkedHrmProduct.quantity,\r\n            seoKeywords: row.linkedHrmProduct.seoKeywords,\r\n            ktitle: row.linkedHrmProduct.ktitle,\r\n            seoDescription: row.linkedHrmProduct.seoDescription,\r\n            shortDescription: row.linkedHrmProduct.shortDescription,\r\n            description: row.linkedHrmProduct.description,\r\n            isBest: row.linkedHrmProduct.isBest,\r\n            isNew: row.linkedHrmProduct.isNew,\r\n            isHot: row.linkedHrmProduct.isHot,\r\n            isHome: row.linkedHrmProduct.isHome,\r\n            categorySystemId: row.linkedHrmProduct.categorySystemId,\r\n            brandSystemId: row.linkedHrmProduct.brandSystemId,\r\n          };\r\n        };\r\n        \r\n        // Helper to trigger sync with proper HRM data\r\n        const triggerSync = (actionKey: 'sync_all' | 'sync_basic' | 'sync_seo' | 'sync_description' | 'sync_price' | 'sync_inventory' | 'sync_flags') => {\r\n          const hrmData = buildHrmData();\r\n          if (!hrmData) {\r\n            toast.error('Sản phẩm chưa được liên kết với HRM');\r\n            return;\r\n          }\r\n          entitySync.triggerSyncAction(actionKey, row.goods_id, hrmData, row.goods_name);\r\n        };\r\n        \r\n        return (\r\n          <DropdownMenu>\r\n            <DropdownMenuTrigger asChild>\r\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\r\n                <MoreHorizontal className=\"h-4 w-4\" />\r\n              </Button>\r\n            </DropdownMenuTrigger>\r\n            <DropdownMenuContent align=\"end\">\r\n              {row.linkedHrmProduct ? (\r\n                <>\r\n                  {/* Sync All - Most important action */}\r\n                  <DropdownMenuItem \r\n                    onClick={() => triggerSync('sync_all')}\r\n                    className=\"font-medium\"\r\n                    title=\"Đồng bộ tên, SKU, giá, tồn kho, SEO, mô tả, flags\"\r\n                  >\r\n                    <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n                    Đồng bộ tất cả\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuSeparator />\r\n                  \r\n                  {/* Individual sync actions */}\r\n                  <DropdownMenuItem \r\n                    onClick={() => triggerSync('sync_basic')}\r\n                    title=\"Tên sản phẩm, mã SKU, danh mục, thương hiệu\"\r\n                  >\r\n                    <FileText className=\"h-4 w-4 mr-2\" />\r\n                    Thông tin cơ bản\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuItem \r\n                    onClick={() => triggerSync('sync_price')}\r\n                    title=\"Giá bán, giá thị trường, giá khuyến mãi\"\r\n                  >\r\n                    <DollarSign className=\"h-4 w-4 mr-2\" />\r\n                    Giá\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuItem \r\n                    onClick={() => triggerSync('sync_inventory')}\r\n                    title=\"Tổng số lượng tồn kho từ tất cả chi nhánh\"\r\n                  >\r\n                    <Package className=\"h-4 w-4 mr-2\" />\r\n                    Tồn kho\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuItem \r\n                    onClick={() => triggerSync('sync_seo')}\r\n                    title=\"Keywords, Meta Title, Meta Description\"\r\n                  >\r\n                    <Search className=\"h-4 w-4 mr-2\" />\r\n                    SEO\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuItem \r\n                    onClick={() => triggerSync('sync_description')}\r\n                    title=\"Mô tả ngắn (goods_brief), mô tả chi tiết (goods_desc)\"\r\n                  >\r\n                    <AlignLeft className=\"h-4 w-4 mr-2\" />\r\n                    Mô tả\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuItem \r\n                    onClick={() => triggerSync('sync_flags')}\r\n                    title=\"Nổi bật (best), Hot, Mới (new), Trang chủ\"\r\n                  >\r\n                    <Tag className=\"h-4 w-4 mr-2\" />\r\n                    Flags\r\n                  </DropdownMenuItem>\r\n                  \r\n                  <DropdownMenuSeparator />\r\n                  <DropdownMenuItem onClick={() => handleViewOnPkgx(row.goods_id)}>\r\n                    <ExternalLink className=\"h-4 w-4 mr-2\" />\r\n                    Xem trên PKGX\r\n                  </DropdownMenuItem>\r\n                  \r\n                  {/* Hủy liên kết */}\r\n                  <DropdownMenuSeparator />\r\n                  <DropdownMenuItem \r\n                    onClick={() => entitySync.handleConfirm(\r\n                      'Hủy liên kết PKGX',\r\n                      `Bạn có chắc muốn hủy liên kết sản phẩm \"${row.goods_name}\" với HRM?`,\r\n                      () => handleOpenUnlinkDialog(row)\r\n                    )}\r\n                    className=\"text-destructive focus:text-destructive\"\r\n                  >\r\n                    <Unlink className=\"h-4 w-4 mr-2\" />\r\n                    Hủy liên kết\r\n                  </DropdownMenuItem>\r\n                </>\r\n              ) : (\r\n                /* Not linked - show link option */\r\n                <>\r\n                  <DropdownMenuItem onClick={() => handleOpenLinkDialog(row)}>\r\n                    <Link2 className=\"h-4 w-4 mr-2\" />\r\n                    Liên kết với HRM\r\n                  </DropdownMenuItem>\r\n                </>\r\n              )}\r\n            </DropdownMenuContent>\r\n          </DropdownMenu>\r\n        );\r\n      },\r\n      meta: { displayName: '', excludeFromExport: true },\r\n    },\r\n  ], [hrmProducts, getPkgxCatIdByHrmCategory, getPkgxBrandIdByHrmBrand, entitySync]);\r\n  \r\n  // Mobile card renderer\r\n  const renderMobileCard = React.useCallback((row: PkgxProductRow, index: number) => (\r\n    <div className=\"p-4 space-y-3\">\r\n      <div className=\"flex items-start justify-between gap-2\">\r\n        <button \r\n          className=\"flex-1 min-w-0 text-left\"\r\n          onClick={() => handleOpenDetailDialog(row)}\r\n        >\r\n          <div className=\"font-medium line-clamp-2 hover:text-primary hover:underline\">{row.goods_name}</div>\r\n          <div className=\"text-xs text-muted-foreground mt-1\">\r\n            ID: {row.goods_id} | Mã: {row.goods_sn || '-'}\r\n          </div>\r\n        </button>\r\n        <div className=\"flex items-center gap-2\">\r\n          {row.linkedHrmProduct ? (\r\n            <Badge variant=\"default\" className=\"bg-green-500 text-xs shrink-0\">\r\n              <CheckCircle2 className=\"h-3 w-3 mr-1\" />\r\n              Đã liên kết\r\n            </Badge>\r\n          ) : (\r\n            <Badge variant=\"secondary\" className=\"text-xs shrink-0\">Chưa liên kết</Badge>\r\n          )}\r\n          <MobileProductDropdown \r\n            row={row} \r\n            entitySync={entitySync}\r\n            onViewOnPkgx={handleViewOnPkgx}\r\n            onOpenLinkDialog={handleOpenLinkDialog}\r\n            onOpenUnlinkDialog={handleOpenUnlinkDialog}\r\n          />\r\n        </div>\r\n      </div>\r\n      \r\n      {row.linkedHrmProduct && (\r\n        <div className=\"text-sm text-muted-foreground\">\r\n          <span className=\"font-medium text-foreground\">HRM:</span>{' '}\r\n          <button\r\n            className=\"hover:text-primary hover:underline cursor-pointer transition-colors\"\r\n            onClick={(e) => {\r\n              e.stopPropagation();\r\n              window.open(`/products?id=${row.linkedHrmProduct.id}`, '_blank');\r\n            }}\r\n          >\r\n            {row.linkedHrmProduct.name}\r\n          </button>\r\n        </div>\r\n      )}\r\n    </div>\r\n  ), [hrmProducts, getPkgxCatIdByHrmCategory, getPkgxBrandIdByHrmBrand]);\r\n  \r\n  // Handlers\r\n  const handleOpenDetailDialog = React.useCallback(async (row: PkgxProductRow) => {\r\n    setSelectedProductForDetail(row);\r\n    setIsDetailDialogOpen(true);\r\n    setGalleryImages([]); // Reset gallery\r\n    \r\n    // Fetch gallery ảnh\r\n    setIsLoadingGallery(true);\r\n    try {\r\n      const result = await fetchPkgxGallery(row.goods_id);\r\n      if (result.success && result.data) {\r\n        setGalleryImages(result.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching gallery:', error);\r\n    } finally {\r\n      setIsLoadingGallery(false);\r\n    }\r\n  }, []);\r\n  \r\n  const handleViewOnPkgx = React.useCallback((goodsId: number) => {\r\n    window.open(`https://phukiengiaxuong.com.vn/admin/goods.php?act=edit&goods_id=${goodsId}`, '_blank');\r\n  }, []);\r\n  \r\n  const handleOpenLinkDialog = React.useCallback((pkgxProduct: PkgxProduct) => {\r\n    setSelectedPkgxProduct(pkgxProduct);\r\n    // Auto-suggest matching products\r\n    validation.updateSuggestions(pkgxProduct);\r\n    // Try to find exact match by SKU first, then by name\r\n    const matchedProduct = hrmProducts.find(\r\n      (p) => p.id === pkgxProduct.goods_sn || p.name === pkgxProduct.goods_name\r\n    );\r\n    setSelectedHrmProductId(matchedProduct?.systemId || '');\r\n    setShowWarningConfirm(false);\r\n    validation.clearValidation();\r\n    setIsLinkDialogOpen(true);\r\n  }, [hrmProducts, validation]);\r\n  \r\n  const handleCloseLinkDialog = React.useCallback(() => {\r\n    setIsLinkDialogOpen(false);\r\n    setSelectedPkgxProduct(null);\r\n    setSelectedHrmProductId('');\r\n    setShowWarningConfirm(false);\r\n    validation.clearValidation();\r\n  }, [validation]);\r\n  \r\n  const handleOpenUnlinkDialog = React.useCallback((pkgxProduct: PkgxProduct) => {\r\n    const hrmProduct = findLinkedHrmProduct(pkgxProduct.goods_id);\r\n    if (hrmProduct) {\r\n      setProductToUnlink({ pkgxProduct, hrmProduct });\r\n      setIsUnlinkDialogOpen(true);\r\n    }\r\n  }, [findLinkedHrmProduct]);\r\n  \r\n  // Get selected products that are linked (for bulk unlink)\r\n  const selectedLinkedProducts = React.useMemo(() => {\r\n    const selectedIds = Object.keys(rowSelection).filter(id => rowSelection[id]);\r\n    return paginatedData.filter(p => selectedIds.includes(p.systemId) && p.linkedHrmProduct);\r\n  }, [rowSelection, paginatedData]);\r\n  \r\n  // All selected rows for bulk actions\r\n  const allSelectedRows = React.useMemo(() => \r\n    paginatedData.filter(p => rowSelection[p.systemId]),\r\n  [paginatedData, rowSelection]);\r\n  \r\n  // Bulk actions for ResponsiveDataTable\r\n  const bulkActions = React.useMemo(() => [\r\n    {\r\n      label: 'Hủy liên kết',\r\n      icon: Unlink,\r\n      variant: 'destructive' as const,\r\n      disabled: selectedLinkedProducts.length === 0,\r\n      onSelect: () => {\r\n        if (selectedLinkedProducts.length === 0) {\r\n          toast.error('Không có sản phẩm đã liên kết nào được chọn');\r\n          return;\r\n        }\r\n        setIsBulkUnlinkDialogOpen(true);\r\n      },\r\n    },\r\n  ], [selectedLinkedProducts]);\r\n  \r\n  const handleConfirmBulkUnlink = React.useCallback(() => {\r\n    let successCount = 0;\r\n    selectedLinkedProducts.forEach(product => {\r\n      if (product.linkedHrmProduct) {\r\n        productStore.update(product.linkedHrmProduct.systemId as SystemId, { pkgxId: undefined });\r\n        successCount++;\r\n      }\r\n    });\r\n    \r\n    setIsBulkUnlinkDialogOpen(false);\r\n    setRowSelection({});\r\n    toast.success(`Đã hủy liên kết ${successCount} sản phẩm`);\r\n    \r\n    addLog({\r\n      action: 'batch_unlink',\r\n      status: 'success',\r\n      message: `Đã hủy liên kết ${successCount} sản phẩm`,\r\n      details: { total: successCount },\r\n    });\r\n  }, [selectedLinkedProducts, productStore, addLog]);\r\n  \r\n  const handleOpenPushDialog = React.useCallback((row: PkgxProductRow) => {\r\n    setProductToPush(row);\r\n    // Reset to default fields when opening dialog\r\n    setSelectedPushFields(['goods_name', 'sync_prices', 'goods_number']);\r\n    setIsPushDialogOpen(true);\r\n  }, []);\r\n  \r\n  const handleTogglePushField = (field: PushSyncFieldKey) => {\r\n    setSelectedPushFields(prev => \r\n      prev.includes(field) \r\n        ? prev.filter(f => f !== field)\r\n        : [...prev, field]\r\n    );\r\n  };\r\n  \r\n  const handleSelectAllPushFields = () => {\r\n    if (selectedPushFields.length === PUSH_SYNC_FIELDS.length) {\r\n      setSelectedPushFields([]);\r\n    } else {\r\n      setSelectedPushFields(PUSH_SYNC_FIELDS.map(f => f.key));\r\n    }\r\n  };\r\n  \r\n  // Sync products from PKGX (limit 100 to fit localStorage)\r\n  const handleSyncFromPkgx = async () => {\r\n    setIsSyncing(true);\r\n    const startTime = Date.now();\r\n    try {\r\n      toast.info('Đang tải sản phẩm từ PKGX...');\r\n      const response = await fetchPkgxProducts(1, 100);\r\n      if (response.success && response.data && !response.data.error) {\r\n        // Lưu vào store để dùng chung với Link Dialog\r\n        setPkgxProducts(response.data.data);\r\n        setPagination(prev => ({ ...prev, pageIndex: 0 }));\r\n        \r\n        addLog({\r\n          action: 'get_products',\r\n          status: 'success',\r\n          message: `Đã lấy ${response.data.data.length}/${response.data.pagination.total_items} sản phẩm từ PKGX`,\r\n          details: { \r\n            total: response.data.pagination.total_items,\r\n            responseTime: Date.now() - startTime,\r\n          },\r\n        });\r\n        toast.success(`Đã lấy ${response.data.data.length}/${response.data.pagination.total_items} sản phẩm từ PKGX`);\r\n      } else {\r\n        throw new Error(response.error || 'Không thể lấy danh sách sản phẩm');\r\n      }\r\n    } catch (error) {\r\n      addLog({\r\n        action: 'get_products',\r\n        status: 'error',\r\n        message: 'Lỗi khi lấy sản phẩm từ PKGX',\r\n        details: { \r\n          error: error instanceof Error ? error.message : String(error),\r\n          responseTime: Date.now() - startTime,\r\n        },\r\n      });\r\n      toast.error(error instanceof Error ? error.message : 'Lỗi khi lấy sản phẩm từ PKGX');\r\n    } finally {\r\n      setIsSyncing(false);\r\n    }\r\n  };\r\n  \r\n  // Refresh single product from PKGX\r\n  const handleRefreshSingleProduct = async (goodsId: number) => {\r\n    setIsLoadingProductDetail(true);\r\n    try {\r\n      const response = await fetchPkgxProductById(goodsId);\r\n      if (response.success && response.data) {\r\n        // Update the product in the list\r\n        const updatedProducts = pkgxProducts.map(p => \r\n          p.goods_id === goodsId ? response.data! : p\r\n        );\r\n        setPkgxProducts(updatedProducts);\r\n        \r\n        // Also update the selected product for detail if it's open\r\n        if (selectedProductForDetail?.goods_id === goodsId) {\r\n          const linked = findLinkedHrmProduct(goodsId);\r\n          const totalInventory = linked \r\n            ? Object.values(linked.inventoryByBranch || {}).reduce((sum, qty) => sum + qty, 0)\r\n            : 0;\r\n          \r\n          setSelectedProductForDetail({\r\n            ...response.data,\r\n            linkedHrmProduct: linked ? {\r\n              systemId: linked.systemId,\r\n              name: linked.name,\r\n              id: linked.id,\r\n              sku: (linked as any).sku,\r\n              sellingPrice: linked.sellingPrice,\r\n              costPrice: linked.costPrice,\r\n              partnerPrice: (linked as any).partnerPrice,\r\n              acePrice: (linked as any).acePrice,\r\n              dealPrice: (linked as any).dealPrice,\r\n              quantity: totalInventory,\r\n              description: linked.description,\r\n              shortDescription: linked.shortDescription,\r\n              seoDescription: linked.seoDescription,\r\n              seoKeywords: (linked as any).seoKeywords,\r\n              ktitle: linked.ktitle,\r\n              categorySystemId: linked.categorySystemId,\r\n              brandSystemId: linked.brandSystemId,\r\n              isBest: (linked as any).isBest,\r\n              isHot: (linked as any).isHot,\r\n              isNew: (linked as any).isNew,\r\n              isHome: (linked as any).isHome,\r\n              sellerNote: (linked as any).sellerNote,\r\n            } : undefined,\r\n            systemId: response.data.goods_id.toString(),\r\n          });\r\n        }\r\n        \r\n        toast.success('Đã cập nhật thông tin sản phẩm');\r\n        return true;\r\n      } else {\r\n        toast.error(response.error || 'Không thể lấy thông tin sản phẩm');\r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      toast.error('Lỗi khi lấy thông tin sản phẩm');\r\n      return false;\r\n    } finally {\r\n      setIsLoadingProductDetail(false);\r\n    }\r\n  };\r\n  \r\n  // Validate when form values change\r\n  React.useEffect(() => {\r\n    if (isLinkDialogOpen && selectedPkgxProduct && selectedHrmProductId) {\r\n      const hrmProduct = hrmProducts.find(p => p.systemId === selectedHrmProductId);\r\n      const input: ProductMappingInput = {\r\n        hrmProductSystemId: selectedHrmProductId || '',\r\n        hrmProductName: hrmProduct?.name || '',\r\n        hrmProductSku: hrmProduct?.id,\r\n        pkgxProductId: selectedPkgxProduct.goods_id,\r\n        pkgxProductName: selectedPkgxProduct.goods_name,\r\n        pkgxProductSku: selectedPkgxProduct.goods_sn,\r\n      };\r\n      validation.validateAsync(input);\r\n    }\r\n  }, [selectedHrmProductId, selectedPkgxProduct, isLinkDialogOpen, hrmProducts, validation]);\r\n  \r\n  // Confirm link\r\n  const handleConfirmLink = () => {\r\n    if (!selectedPkgxProduct) {\r\n      toast.error('Vui lòng chọn sản phẩm PKGX');\r\n      return;\r\n    }\r\n    \r\n    // Build input for validation\r\n    const hrmProduct = hrmProducts.find(p => p.systemId === selectedHrmProductId);\r\n    const input: ProductMappingInput = {\r\n      hrmProductSystemId: selectedHrmProductId || '',\r\n      hrmProductName: hrmProduct?.name || '',\r\n      hrmProductSku: hrmProduct?.id,\r\n      pkgxProductId: selectedPkgxProduct.goods_id,\r\n      pkgxProductName: selectedPkgxProduct.goods_name,\r\n      pkgxProductSku: selectedPkgxProduct.goods_sn,\r\n    };\r\n    \r\n    // Run final validation\r\n    const result = validation.validate(input);\r\n    \r\n    // Block if there are errors\r\n    if (!result.isValid) {\r\n      toast.error(result.errors[0]?.message || 'Vui lòng kiểm tra lại thông tin');\r\n      return;\r\n    }\r\n    \r\n    // Show warning confirmation if there are warnings and not yet confirmed\r\n    if (result.warnings.length > 0 && !showWarningConfirm) {\r\n      setShowWarningConfirm(true);\r\n      return;\r\n    }\r\n    \r\n    if (!hrmProduct) {\r\n      toast.error('Không tìm thấy sản phẩm HRM');\r\n      return;\r\n    }\r\n    \r\n    productStore.update(selectedHrmProductId as any, { pkgxId: selectedPkgxProduct.goods_id });\r\n    toast.success(`Đã liên kết \"${selectedPkgxProduct.goods_name}\" với sản phẩm HRM`);\r\n    \r\n    addLog({\r\n      action: 'link_product',\r\n      status: 'success',\r\n      message: `Đã liên kết: ${hrmProduct.name} ↔ ${selectedPkgxProduct.goods_name}`,\r\n      details: { \r\n        pkgxId: selectedPkgxProduct.goods_id, \r\n        productId: selectedHrmProductId, \r\n        productName: hrmProduct.name,\r\n      },\r\n    });\r\n    \r\n    handleCloseLinkDialog();\r\n  };\r\n  \r\n  // Confirm unlink\r\n  const handleConfirmUnlink = () => {\r\n    if (productToUnlink?.hrmProduct) {\r\n      productStore.update(productToUnlink.hrmProduct.systemId, { pkgxId: undefined });\r\n      toast.success(`Đã hủy liên kết sản phẩm`);\r\n      \r\n      addLog({\r\n        action: 'unlink_product',\r\n        status: 'success',\r\n        message: `Đã hủy liên kết: ${productToUnlink.hrmProduct.name}`,\r\n        details: { \r\n          pkgxId: productToUnlink.pkgxProduct.goods_id, \r\n          productId: productToUnlink.hrmProduct.systemId,\r\n          productName: productToUnlink.hrmProduct.name,\r\n        },\r\n      });\r\n    }\r\n    setIsUnlinkDialogOpen(false);\r\n    setProductToUnlink(null);\r\n  };\r\n  \r\n  // Confirm push (Push: HRM → PKGX)\r\n  const handleConfirmPush = async () => {\r\n    if (!productToPush || !productToPush.linkedHrmProduct || selectedPushFields.length === 0) {\r\n      toast.error('Vui lòng chọn ít nhất một trường để đồng bộ');\r\n      return;\r\n    }\r\n    \r\n    setIsPushingProduct(true);\r\n    \r\n    try {\r\n      const hrm = productToPush.linkedHrmProduct;\r\n      const pushData: Record<string, any> = {};\r\n      \r\n      for (const field of selectedPushFields) {\r\n        switch (field) {\r\n          // Thông tin cơ bản\r\n          case 'goods_name':\r\n            pushData.goods_name = hrm.name;\r\n            break;\r\n          case 'goods_sn':\r\n            if (hrm.sku) pushData.goods_sn = hrm.sku;\r\n            break;\r\n          case 'goods_brief':\r\n            pushData.goods_brief = hrm.shortDescription || '';\r\n            break;\r\n          case 'goods_desc':\r\n            pushData.goods_desc = hrm.description || '';\r\n            break;\r\n            \r\n          // Giá cả - CHỈ đồng bộ nếu đã cấu hình mapping giá\r\n          case 'sync_prices': {\r\n            const { priceMapping } = settings;\r\n            const hasPriceMapping = priceMapping.shopPrice || priceMapping.marketPrice || priceMapping.partnerPrice || priceMapping.acePrice || priceMapping.dealPrice;\r\n            \r\n            if (!hasPriceMapping) {\r\n              toast.warning('Chưa cấu hình Mapping giá. Vui lòng vào tab \"Mapping giá\" để thiết lập trước khi đồng bộ giá.');\r\n            } else {\r\n              // Chỉ push giá nếu có mapping tương ứng\r\n              if (priceMapping.shopPrice && hrm.sellingPrice) {\r\n                pushData.shop_price = hrm.sellingPrice;\r\n              }\r\n              if (priceMapping.partnerPrice && hrm.partnerPrice) {\r\n                pushData.partner_price = hrm.partnerPrice;\r\n              }\r\n              if (priceMapping.acePrice && hrm.acePrice) {\r\n                pushData.ace_price = hrm.acePrice;\r\n              }\r\n              if (priceMapping.dealPrice && hrm.dealPrice) {\r\n                pushData.deal_price = hrm.dealPrice;\r\n              }\r\n            }\r\n            break;\r\n          }\r\n            \r\n          // Tồn kho\r\n          case 'goods_number':\r\n            pushData.goods_number = hrm.quantity || 0;\r\n            break;\r\n            \r\n          // Phân loại\r\n          case 'cat_id':\r\n            if (hrm.categorySystemId) {\r\n              const pkgxCatId = getPkgxCatIdByHrmCategory(hrm.categorySystemId);\r\n              if (pkgxCatId) {\r\n                pushData.cat_id = pkgxCatId;\r\n              }\r\n            }\r\n            break;\r\n          case 'brand_id':\r\n            if (hrm.brandSystemId) {\r\n              const pkgxBrandId = getPkgxBrandIdByHrmBrand(hrm.brandSystemId);\r\n              if (pkgxBrandId) {\r\n                pushData.brand_id = pkgxBrandId;\r\n              }\r\n            }\r\n            break;\r\n            \r\n          // SEO\r\n          case 'keywords':\r\n            pushData.keywords = hrm.seoKeywords || hrm.seoDescription || '';\r\n            break;\r\n          case 'meta_title':\r\n            pushData.meta_title = hrm.ktitle || hrm.name || '';\r\n            break;\r\n          case 'meta_desc':\r\n            pushData.meta_desc = hrm.seoDescription || '';\r\n            break;\r\n            \r\n          // Trạng thái hiển thị\r\n          case 'best':\r\n            pushData.best = hrm.isBest ? 1 : 0;\r\n            break;\r\n          case 'hot':\r\n            pushData.hot = hrm.isHot ? 1 : 0;\r\n            break;\r\n          case 'new':\r\n            pushData.new = hrm.isNew ? 1 : 0;\r\n            break;\r\n          case 'ishome':\r\n            pushData.ishome = hrm.isHome ? 1 : 0;\r\n            break;\r\n            \r\n          // Ghi chú\r\n          case 'seller_note':\r\n            pushData.seller_note = hrm.sellerNote || '';\r\n            break;\r\n        }\r\n      }\r\n      \r\n      // Call API to update PKGX\r\n      const response = await updatePkgxProduct(productToPush.goods_id, pushData);\r\n      \r\n      if (response.success) {\r\n        addLog({\r\n          action: 'update_product',\r\n          status: 'success',\r\n          message: `Đã đẩy ${selectedPushFields.length} trường từ HRM → PKGX`,\r\n          details: {\r\n            pkgxId: productToPush.goods_id,\r\n            productId: hrm.systemId,\r\n            productName: hrm.name,\r\n          },\r\n        });\r\n        \r\n        toast.success(`Đã đẩy ${selectedPushFields.length} trường lên PKGX`);\r\n        \r\n        // Only refresh the single product\r\n        await handleRefreshSingleProduct(productToPush.goods_id);\r\n        \r\n        setIsPushDialogOpen(false);\r\n        setProductToPush(null);\r\n      } else {\r\n        throw new Error(response.error || 'Không thể cập nhật sản phẩm trên PKGX');\r\n      }\r\n    } catch (error) {\r\n      toast.error(error instanceof Error ? error.message : 'Lỗi khi đẩy dữ liệu lên PKGX');\r\n      addLog({\r\n        action: 'update_product',\r\n        status: 'error',\r\n        message: 'Lỗi khi đẩy dữ liệu lên PKGX',\r\n        details: { error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    } finally {\r\n      setIsPushingProduct(false);\r\n    }\r\n  };\r\n  \r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card>\r\n        <CardHeader className=\"pb-4\">\r\n          <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\r\n            <div>\r\n              <CardTitle className=\"text-lg\">Sản phẩm đã liên kết</CardTitle>\r\n              <CardDescription>\r\n                Đồng bộ và liên kết sản phẩm PKGX với sản phẩm HRM\r\n              </CardDescription>\r\n            </div>\r\n            <div className=\"flex gap-2\">\r\n              <Button onClick={handleSyncFromPkgx} disabled={isSyncing}>\r\n                {isSyncing ? <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" /> : <RefreshCw className=\"h-4 w-4 mr-2\" />}\r\n                Đồng bộ từ PKGX\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-4\">\r\n            {/* Search and stats */}\r\n            <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-3\">\r\n              <div className=\"relative flex-1\">\r\n                <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\r\n                <Input\r\n                  placeholder=\"Tìm kiếm sản phẩm PKGX...\"\r\n                  value={searchTerm}\r\n                  onChange={(e) => setSearchTerm(e.target.value)}\r\n                  className=\"pl-9\"\r\n                />\r\n              </div>\r\n              <div className=\"text-sm text-muted-foreground whitespace-nowrap text-center sm:text-right\">\r\n                {pkgxProducts.length} SP | {linkedCount} đã liên kết\r\n                {settings.pkgxProductsLastFetch && (\r\n                  <span className=\"ml-2 text-xs opacity-70\">\r\n                    ({new Date(settings.pkgxProductsLastFetch).toLocaleString('vi-VN')})\r\n                  </span>\r\n                )}\r\n              </div>\r\n            </div>\r\n            \r\n            {/* Tabs - PKGX Products and Linked/Mapping */}\r\n            <Tabs defaultValue=\"pkgx-products\" className=\"w-full\">\r\n              <TabsList>\r\n                <TabsTrigger value=\"pkgx-products\">\r\n                  <Package className=\"h-4 w-4 mr-2\" />\r\n                  Sản phẩm PKGX ({pkgxProducts.length})\r\n                </TabsTrigger>\r\n                <TabsTrigger value=\"linked\">\r\n                  <Link className=\"h-4 w-4 mr-2\" />\r\n                  Đã liên kết ({linkedCount})\r\n                </TabsTrigger>\r\n              </TabsList>\r\n              \r\n              <TabsContent value=\"pkgx-products\" className=\"mt-4\">\r\n                {/* Warning if not enabled */}\r\n                {!settings.enabled && (\r\n                  <div className=\"flex items-center gap-2 rounded-lg border border-yellow-200 bg-yellow-50 p-3 text-sm text-yellow-800 mb-4\">\r\n                    <TriangleAlert className=\"h-4 w-4 flex-shrink-0\" />\r\n                    <p>Tích hợp PKGX chưa được bật. Vui lòng bật trong tab \"Cấu hình chung\".</p>\r\n                  </div>\r\n                )}\r\n                \r\n                {pkgxProducts.length === 0 ? (\r\n                  <div className=\"text-center py-8 text-muted-foreground\">\r\n                    <Package className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\r\n                    <p>Chưa có sản phẩm từ PKGX.</p>\r\n                    <p className=\"text-sm mt-1\">Bấm \"Đồng bộ từ PKGX\" để lấy danh sách.</p>\r\n                  </div>\r\n                ) : (\r\n                  <ResponsiveDataTable<PkgxProductRow>\r\n                    columns={columns}\r\n                    data={paginatedData}\r\n                    pageCount={pageCount}\r\n                    pagination={pagination}\r\n                    setPagination={setPagination}\r\n                    rowCount={tableData.length}\r\n                    sorting={sorting}\r\n                    setSorting={setSorting}\r\n                    rowSelection={rowSelection}\r\n                    setRowSelection={setRowSelection}\r\n                    renderMobileCard={renderMobileCard}\r\n                    isLoading={isSyncing}\r\n                    bulkActions={bulkActions}\r\n                    allSelectedRows={allSelectedRows}\r\n                    emptyTitle=\"Không tìm thấy sản phẩm\"\r\n                  />\r\n                )}\r\n              </TabsContent>\r\n              \r\n              <TabsContent value=\"linked\" className=\"mt-4\">\r\n                {linkedCount === 0 ? (\r\n                  <div className=\"text-center py-8 text-muted-foreground\">\r\n                    <Link className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\r\n                    <p>Chưa có sản phẩm nào được liên kết.</p>\r\n                    <p className=\"text-sm mt-1\">Chọn sản phẩm trong tab \"Sản phẩm PKGX\" và liên kết với HRM.</p>\r\n                  </div>\r\n                ) : (\r\n                  <ResponsiveDataTable<PkgxProductRow>\r\n                    columns={columns}\r\n                    data={paginatedData.filter(p => p.linkedHrmProduct)}\r\n                    pageCount={Math.ceil(tableData.filter(p => p.linkedHrmProduct).length / pagination.pageSize)}\r\n                    pagination={pagination}\r\n                    setPagination={setPagination}\r\n                    rowCount={tableData.filter(p => p.linkedHrmProduct).length}\r\n                    sorting={sorting}\r\n                    setSorting={setSorting}\r\n                    rowSelection={rowSelection}\r\n                    setRowSelection={setRowSelection}\r\n                    renderMobileCard={renderMobileCard}\r\n                    isLoading={isSyncing}\r\n                    bulkActions={bulkActions}\r\n                    allSelectedRows={allSelectedRows.filter(p => p.linkedHrmProduct)}\r\n                    emptyTitle=\"Không tìm thấy sản phẩm đã liên kết\"\r\n                  />\r\n                )}\r\n              </TabsContent>\r\n            </Tabs>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n      \r\n      {/* Link Dialog - Using shared PkgxMappingDialog component */}\r\n      <PkgxMappingDialog\r\n        open={isLinkDialogOpen}\r\n        onOpenChange={handleCloseLinkDialog}\r\n        type=\"product\"\r\n        hrmItems={hrmProducts\r\n          .filter((p) => !p.pkgxId || (selectedPkgxProduct && p.pkgxId === selectedPkgxProduct.goods_id))\r\n          .map((p) => ({\r\n            id: p.systemId,\r\n            name: p.name,\r\n            subText: p.id,\r\n          }))}\r\n        selectedHrmId={selectedHrmProductId}\r\n        onSelectHrmId={setSelectedHrmProductId}\r\n        pkgxItems={pkgxProducts.map((p) => ({\r\n          id: p.goods_id.toString(),\r\n          name: p.goods_name,\r\n          subText: `ID: ${p.goods_id}`,\r\n        }))}\r\n        selectedPkgxId={selectedPkgxProduct?.goods_id.toString() || ''}\r\n        onSelectPkgxId={(id) => {\r\n          const pkgx = pkgxProducts.find(p => p.goods_id.toString() === id);\r\n          if (pkgx) {\r\n            setSelectedPkgxProduct(pkgx);\r\n            validation.updateSuggestions(pkgx);\r\n          }\r\n        }}\r\n        pkgxSuggestions={validation.suggestions.map(s => ({\r\n          item: { id: s.product.systemId, name: s.product.name, subText: s.product.id },\r\n          score: s.score,\r\n          matchType: s.matchType,\r\n        }))}\r\n        validation={validation.validationResult}\r\n        hasErrors={validation.hasErrors}\r\n        isValidating={validation.isValidating}\r\n        showWarningConfirm={showWarningConfirm}\r\n        onConfirm={handleConfirmLink}\r\n        onCancel={handleCloseLinkDialog}\r\n      />\r\n      \r\n      {/* Unlink Dialog */}\r\n      <Dialog open={isUnlinkDialogOpen} onOpenChange={setIsUnlinkDialogOpen}>\r\n        <DialogContent>\r\n          <DialogHeader>\r\n            <DialogTitle>Xác nhận hủy liên kết</DialogTitle>\r\n            <DialogDescription>\r\n              Bạn có chắc muốn hủy liên kết sản phẩm này?\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          \r\n          {productToUnlink && (\r\n            <div className=\"space-y-2 py-4\">\r\n              <p className=\"text-sm\">\r\n                <span className=\"font-medium\">PKGX:</span> {productToUnlink.pkgxProduct.goods_name}\r\n              </p>\r\n              <p className=\"text-sm\">\r\n                <span className=\"font-medium\">HRM:</span> {productToUnlink.hrmProduct.name}\r\n              </p>\r\n              <p className=\"text-sm text-muted-foreground\">\r\n                Sau khi hủy, sản phẩm sẽ không còn được đồng bộ với PKGX.\r\n              </p>\r\n            </div>\r\n          )}\r\n          \r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setIsUnlinkDialogOpen(false)}>\r\n              Hủy\r\n            </Button>\r\n            <Button variant=\"destructive\" onClick={handleConfirmUnlink}>\r\n              <Unlink className=\"h-4 w-4 mr-2\" />\r\n              Hủy liên kết\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n      \r\n      {/* Push Dialog - Push (HRM → PKGX) */}\r\n      <Dialog open={isPushDialogOpen} onOpenChange={setIsPushDialogOpen}>\r\n        <DialogContent className=\"max-w-2xl max-h-[90vh]\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-2\">\r\n              <Upload className=\"h-5 w-5 text-green-600\" />\r\n              Đẩy dữ liệu từ HRM → PKGX\r\n            </DialogTitle>\r\n            <DialogDescription>\r\n              Chọn các trường cần đẩy từ HRM lên cập nhật PKGX\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          \r\n          {productToPush && (\r\n            <div className=\"space-y-4 py-4\">\r\n              {/* Product info */}\r\n              <div className=\"flex items-center gap-3 p-3 rounded-lg bg-green-50 border border-green-200\">\r\n                <div className=\"flex-1\">\r\n                  <div className=\"text-sm font-medium text-green-600\">HRM (Nguồn)</div>\r\n                  <div className=\"text-sm truncate\">{productToPush.linkedHrmProduct?.name}</div>\r\n                </div>\r\n                <ArrowRight className=\"h-4 w-4 text-green-600 shrink-0\" />\r\n                <div className=\"flex-1\">\r\n                  <div className=\"text-sm font-medium text-muted-foreground\">PKGX (Đích)</div>\r\n                  <div className=\"text-sm truncate\">{productToPush.goods_name}</div>\r\n                </div>\r\n              </div>\r\n              \r\n              {/* Field selection - Flat grid with tooltip and validation */}\r\n              <div className=\"space-y-3\">\r\n                <div className=\"flex items-center justify-between\">\r\n                  <Label className=\"text-sm font-medium\">Chọn trường cần đẩy lên:</Label>\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"sm\"\r\n                    onClick={handleSelectAllPushFields}\r\n                    className=\"text-xs h-7\"\r\n                  >\r\n                    {selectedPushFields.length === PUSH_SYNC_FIELDS.length ? 'Bỏ chọn tất cả' : 'Chọn tất cả'}\r\n                  </Button>\r\n                </div>\r\n                \r\n                <ScrollArea className=\"h-[350px] pr-4\">\r\n                  <TooltipProvider delayDuration={200}>\r\n                    <div className=\"grid grid-cols-4 gap-2\">\r\n                      {PUSH_SYNC_FIELDS.map((field) => {\r\n                        // Check if this is a special field (sync_prices)\r\n                        const isSpecialField = (field as any).isSpecial === true;\r\n                        \r\n                        // Get HRM value for this field\r\n                        const hrmValue = isSpecialField \r\n                          ? 'Sử dụng cấu hình từ tab Mapping giá'\r\n                          : productToPush?.linkedHrmProduct?.[field.hrmField as keyof typeof productToPush.linkedHrmProduct];\r\n                        const hasValue = isSpecialField || (hrmValue !== undefined && hrmValue !== null && hrmValue !== '');\r\n                        \r\n                        // Format display value\r\n                        const displayValue = (() => {\r\n                          if (isSpecialField) return 'Theo cấu hình Mapping giá';\r\n                          if (!hasValue) return 'Chưa có dữ liệu';\r\n                          if (typeof hrmValue === 'boolean') return hrmValue ? 'Có' : 'Không';\r\n                          if (typeof hrmValue === 'number') {\r\n                            return hrmValue.toLocaleString('vi-VN');\r\n                          }\r\n                          if (typeof hrmValue === 'string') {\r\n                            return hrmValue.length > 50 ? hrmValue.substring(0, 50) + '...' : hrmValue;\r\n                          }\r\n                          return String(hrmValue);\r\n                        })();\r\n                        \r\n                        return (\r\n                          <Tooltip key={field.key}>\r\n                            <TooltipTrigger asChild>\r\n                              <div \r\n                                className={`flex items-center justify-between p-2 rounded border hover:bg-muted/50 ${\r\n                                  isSpecialField ? 'col-span-2 bg-blue-50 border-blue-200' :\r\n                                  !hasValue ? 'border-dashed opacity-60' : ''\r\n                                }`}\r\n                              >\r\n                                <div className=\"flex items-center gap-1 min-w-0 flex-1\">\r\n                                  <span className=\"text-xs truncate\">{field.label}</span>\r\n                                  {isSpecialField && <Settings2 className=\"h-3 w-3 text-blue-500 shrink-0\" />}\r\n                                </div>\r\n                                <Switch \r\n                                  checked={selectedPushFields.includes(field.key)} \r\n                                  onCheckedChange={() => handleTogglePushField(field.key)} \r\n                                />\r\n                              </div>\r\n                            </TooltipTrigger>\r\n                            <TooltipContent side=\"top\" className=\"max-w-xs\">\r\n                              <div className=\"text-xs space-y-1\">\r\n                                <div className=\"font-medium\">{field.label}</div>\r\n                                {isSpecialField ? (\r\n                                  <div className=\"text-blue-600\">\r\n                                    Giá sẽ được đồng bộ theo cấu hình trong tab \"Mapping giá\"\r\n                                    <br />\r\n                                    (shop_price, market_price, partner_price, ace_price, deal_price)\r\n                                  </div>\r\n                                ) : (\r\n                                  <div className=\"text-muted-foreground\">\r\n                                    HRM ({field.hrmField}): <span className={hasValue ? 'text-green-600' : 'text-orange-500'}>{displayValue}</span>\r\n                                  </div>\r\n                                )}\r\n                              </div>\r\n                            </TooltipContent>\r\n                          </Tooltip>\r\n                        );\r\n                      })}\r\n                    </div>\r\n                  </TooltipProvider>\r\n                </ScrollArea>\r\n              </div>\r\n              \r\n              {/* Selected count */}\r\n              <div className=\"text-sm text-muted-foreground text-center\">\r\n                Đã chọn {selectedPushFields.length} / {PUSH_SYNC_FIELDS.length} trường\r\n              </div>\r\n            </div>\r\n          )}\r\n          \r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setIsPushDialogOpen(false)}>\r\n              Hủy\r\n            </Button>\r\n            <Button \r\n              onClick={handleConfirmPush} \r\n              disabled={selectedPushFields.length === 0 || isPushingProduct}\r\n              className=\"bg-green-600 hover:bg-green-700\"\r\n            >\r\n              {isPushingProduct ? (\r\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n              ) : (\r\n                <Upload className=\"h-4 w-4 mr-2\" />\r\n              )}\r\n              Đẩy lên PKGX ({selectedPushFields.length} trường)\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n      \r\n      {/* Product Detail Dialog - Tabbed design */}\r\n      <Dialog open={isDetailDialogOpen} onOpenChange={setIsDetailDialogOpen}>\r\n        <DialogContent className=\"max-w-5xl max-h-[90vh] overflow-hidden flex flex-col\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-2\">\r\n              {selectedProductForDetail?.goods_thumb && (\r\n                <img \r\n                  src={buildPkgxImageUrl(selectedProductForDetail.goods_thumb)}\r\n                  alt=\"\"\r\n                  className=\"w-12 h-12 object-contain rounded border\"\r\n                  onError={(e) => { (e.target as HTMLImageElement).style.display = 'none'; }}\r\n                />\r\n              )}\r\n              <div>\r\n                <span className=\"line-clamp-1\">{selectedProductForDetail?.goods_name}</span>\r\n                <DialogDescription className=\"font-normal\">\r\n                  ID: {selectedProductForDetail?.goods_id} | SKU: {selectedProductForDetail?.goods_sn || '-'} | Slug: {selectedProductForDetail?.slug || '-'}\r\n                </DialogDescription>\r\n              </div>\r\n            </DialogTitle>\r\n          </DialogHeader>\r\n          \r\n          {selectedProductForDetail && (\r\n            <Tabs defaultValue=\"basic\" className=\"flex-1 flex flex-col overflow-hidden\">\r\n              <TabsList className=\"grid w-full grid-cols-4\">\r\n                <TabsTrigger value=\"basic\" className=\"text-xs\">\r\n                  <Package className=\"h-3 w-3 mr-1\" />\r\n                  Cơ bản\r\n                </TabsTrigger>\r\n                <TabsTrigger value=\"price\" className=\"text-xs\">\r\n                  <DollarSign className=\"h-3 w-3 mr-1\" />\r\n                  Giá & Kho\r\n                </TabsTrigger>\r\n                <TabsTrigger value=\"seo\" className=\"text-xs\">\r\n                  <FileText className=\"h-3 w-3 mr-1\" />\r\n                  Nội dung & SEO\r\n                </TabsTrigger>\r\n                <TabsTrigger value=\"images\" className=\"text-xs\">\r\n                  <ImageIcon className=\"h-3 w-3 mr-1\" />\r\n                  Hình ảnh\r\n                </TabsTrigger>\r\n              </TabsList>\r\n              \r\n              {/* Tab: Thông tin cơ bản */}\r\n              <TabsContent value=\"basic\" className=\"flex-1 overflow-auto mt-4\">\r\n                <ScrollArea className=\"h-[350px] pr-4\">\r\n                <div className=\"space-y-4\">\r\n                  {/* Status flags + HRM Link - Cùng hàng */}\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    {/* Trạng thái hiển thị */}\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-sm font-medium\">Trạng thái hiển thị</Label>\r\n                      <div className=\"flex flex-wrap gap-1.5\">\r\n                        <Badge variant={selectedProductForDetail.is_on_sale == 1 ? 'default' : 'secondary'} className=\"gap-1\">\r\n                          {selectedProductForDetail.is_on_sale == 1 ? <CheckCircle2 className=\"h-3 w-3\" /> : <Circle className=\"h-3 w-3\" />}\r\n                          Đăng bán\r\n                        </Badge>\r\n                        <Badge variant={selectedProductForDetail.is_best == 1 ? 'default' : 'secondary'} className=\"gap-1\">\r\n                          {selectedProductForDetail.is_best == 1 ? <Star className=\"h-3 w-3\" /> : <Circle className=\"h-3 w-3\" />}\r\n                          Best\r\n                        </Badge>\r\n                        <Badge variant={selectedProductForDetail.is_hot == 1 ? 'destructive' : 'secondary'} className=\"gap-1\">\r\n                          {selectedProductForDetail.is_hot == 1 ? <Flame className=\"h-3 w-3\" /> : <Circle className=\"h-3 w-3\" />}\r\n                          Hot\r\n                        </Badge>\r\n                        <Badge variant={selectedProductForDetail.is_new == 1 ? 'default' : 'secondary'} className={`gap-1 ${selectedProductForDetail.is_new == 1 ? 'bg-purple-500 hover:bg-purple-600' : ''}`}>\r\n                          {selectedProductForDetail.is_new == 1 ? <Sparkles className=\"h-3 w-3\" /> : <Circle className=\"h-3 w-3\" />}\r\n                          New\r\n                        </Badge>\r\n                        <Badge variant={selectedProductForDetail.is_home == 1 ? 'outline' : 'secondary'} className={`gap-1 ${selectedProductForDetail.is_home == 1 ? 'border-orange-500 text-orange-600' : ''}`}>\r\n                          {selectedProductForDetail.is_home == 1 ? <Home className=\"h-3 w-3\" /> : <Circle className=\"h-3 w-3\" />}\r\n                          Home\r\n                        </Badge>\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    {/* Liên kết HRM */}\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-sm font-medium\">Liên kết HRM</Label>\r\n                      {selectedProductForDetail.linkedHrmProduct ? (\r\n                        <button\r\n                          onClick={() => {\r\n                            setIsDetailDialogOpen(false);\r\n                            router.push(`/products?id=${selectedProductForDetail.linkedHrmProduct!.id}`);\r\n                          }}\r\n                          className=\"w-full p-2 border rounded bg-green-50 border-green-200 hover:bg-green-100 transition-colors text-left\"\r\n                        >\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <CheckCircle2 className=\"h-4 w-4 text-green-600 flex-shrink-0\" />\r\n                            <span className=\"font-medium text-green-700 truncate text-sm\">{selectedProductForDetail.linkedHrmProduct.name}</span>\r\n                            <ArrowRight className=\"h-3 w-3 text-green-600 flex-shrink-0 ml-auto\" />\r\n                          </div>\r\n                          <div className=\"flex gap-3 mt-1 text-xs text-muted-foreground\">\r\n                            <span>SKU: {selectedProductForDetail.linkedHrmProduct.sku || '-'}</span>\r\n                            <span>Tồn: {selectedProductForDetail.linkedHrmProduct.quantity || 0}</span>\r\n                          </div>\r\n                        </button>\r\n                      ) : (\r\n                        <div className=\"p-2 border rounded text-center text-sm text-muted-foreground flex items-center justify-center gap-2\">\r\n                          <XCircle className=\"h-4 w-4\" />\r\n                          Chưa liên kết\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  {/* Classification */}\r\n                  <div className=\"grid grid-cols-2 gap-4\">\r\n                    <div className=\"space-y-1\">\r\n                      <Label className=\"text-xs text-muted-foreground\">Danh mục</Label>\r\n                      <div className=\"p-2 border rounded text-sm\">\r\n                        ID: {selectedProductForDetail.cat_id || '-'}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"space-y-1\">\r\n                      <Label className=\"text-xs text-muted-foreground\">Thương hiệu</Label>\r\n                      <div className=\"p-2 border rounded text-sm\">\r\n                        ID: {selectedProductForDetail.brand_id || '-'}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  {/* Timestamps */}\r\n                  <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n                    <div className=\"space-y-1\">\r\n                      <Label className=\"text-xs text-muted-foreground\">Ngày tạo</Label>\r\n                      <div className=\"p-2 border rounded\">\r\n                        {selectedProductForDetail.add_time \r\n                          ? new Date(selectedProductForDetail.add_time * 1000).toLocaleString('vi-VN')\r\n                          : '-'}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"space-y-1\">\r\n                      <Label className=\"text-xs text-muted-foreground\">Cập nhật</Label>\r\n                      <div className=\"p-2 border rounded\">\r\n                        {selectedProductForDetail.last_update \r\n                          ? new Date(selectedProductForDetail.last_update * 1000).toLocaleString('vi-VN')\r\n                          : '-'}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  {/* Seller note */}\r\n                  {selectedProductForDetail.seller_note && (\r\n                    <div className=\"space-y-1\">\r\n                      <Label className=\"text-xs text-muted-foreground\">Ghi chú người bán</Label>\r\n                      <div className=\"p-2 border rounded text-sm\">{selectedProductForDetail.seller_note}</div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n                </ScrollArea>\r\n              </TabsContent>\r\n              \r\n              {/* Tab: Giá & Tồn kho */}\r\n              <TabsContent value=\"price\" className=\"flex-1 overflow-auto mt-4\">\r\n                <ScrollArea className=\"h-[350px] pr-4\">\r\n                <div className=\"space-y-4\">\r\n                  {/* Prices */}\r\n                  <div className=\"space-y-2\">\r\n                    <Label className=\"text-sm font-medium\">Giá bán PKGX</Label>\r\n                    <div className=\"grid grid-cols-5 gap-2 text-sm\">\r\n                      <div className=\"p-3 border rounded text-center\">\r\n                        <div className=\"text-xs text-muted-foreground\">Shop</div>\r\n                        <div className=\"font-bold text-green-600\">{Number(selectedProductForDetail.shop_price || 0).toLocaleString('vi-VN')}đ</div>\r\n                      </div>\r\n                      <div className=\"p-3 border rounded text-center\">\r\n                        <div className=\"text-xs text-muted-foreground\">Thị trường</div>\r\n                        <div>{Number(selectedProductForDetail.market_price || 0).toLocaleString('vi-VN')}đ</div>\r\n                      </div>\r\n                      <div className=\"p-3 border rounded text-center\">\r\n                        <div className=\"text-xs text-muted-foreground\">Đối tác</div>\r\n                        <div>{Number(selectedProductForDetail.partner_price || 0).toLocaleString('vi-VN')}đ</div>\r\n                      </div>\r\n                      <div className=\"p-3 border rounded text-center\">\r\n                        <div className=\"text-xs text-muted-foreground\">ACE</div>\r\n                        <div>{Number(selectedProductForDetail.ace_price || 0).toLocaleString('vi-VN')}đ</div>\r\n                      </div>\r\n                      <div className=\"p-3 border rounded text-center\">\r\n                        <div className=\"text-xs text-muted-foreground\">Deal</div>\r\n                        <div>{Number(selectedProductForDetail.deal_price || 0).toLocaleString('vi-VN')}đ</div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  \r\n                  {/* Inventory */}\r\n                  <div className=\"space-y-2\">\r\n                    <Label className=\"text-sm font-medium\">Tồn kho</Label>\r\n                    <div className=\"p-4 border rounded\">\r\n                      <div className=\"text-3xl font-bold\">{selectedProductForDetail.goods_number || 0}</div>\r\n                      <div className=\"text-xs text-muted-foreground\">sản phẩm trong kho PKGX</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                </ScrollArea>\r\n              </TabsContent>\r\n              \r\n              {/* Tab: Nội dung & SEO */}\r\n              <TabsContent value=\"seo\" className=\"flex-1 overflow-auto mt-4\">\r\n                <ScrollArea className=\"h-[350px] pr-4\">\r\n                  <div className=\"space-y-4\">\r\n                    {/* SEO Fields */}\r\n                    <div className=\"space-y-3\">\r\n                      <Label className=\"text-sm font-medium\">Thông tin SEO</Label>\r\n                      <div className=\"space-y-2\">\r\n                        <div className=\"space-y-1\">\r\n                          <Label className=\"text-xs text-muted-foreground\">Meta Title</Label>\r\n                          <div className=\"p-2 border rounded text-sm\">{selectedProductForDetail.meta_title || '-'}</div>\r\n                        </div>\r\n                        <div className=\"space-y-1\">\r\n                          <Label className=\"text-xs text-muted-foreground\">Keywords</Label>\r\n                          <div className=\"p-2 border rounded text-sm\">{selectedProductForDetail.keywords || '-'}</div>\r\n                        </div>\r\n                        <div className=\"space-y-1\">\r\n                          <Label className=\"text-xs text-muted-foreground\">Meta Description</Label>\r\n                          <div className=\"p-2 border rounded text-sm max-h-20 overflow-y-auto\">{selectedProductForDetail.meta_desc || '-'}</div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    {/* Short description */}\r\n                    <div className=\"space-y-1\">\r\n                      <Label className=\"text-sm font-medium\">Mô tả ngắn</Label>\r\n                      <div className=\"p-2 border rounded text-sm max-h-24 overflow-y-auto\">\r\n                        {selectedProductForDetail.goods_brief || '-'}\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    {/* Long description */}\r\n                    <div className=\"space-y-1\">\r\n                      <Label className=\"text-sm font-medium\">Mô tả chi tiết</Label>\r\n                      <div \r\n                        className=\"p-3 border rounded text-sm max-h-60 overflow-y-auto bg-muted/30\"\r\n                        dangerouslySetInnerHTML={{ __html: selectedProductForDetail.goods_desc || '<span class=\"text-muted-foreground\">Không có mô tả</span>' }}\r\n                      />\r\n                    </div>\r\n                  </div>\r\n                </ScrollArea>\r\n              </TabsContent>\r\n              \r\n              {/* Tab: Hình ảnh */}\r\n              <TabsContent value=\"images\" className=\"flex-1 overflow-auto mt-4\">\r\n                <ScrollArea className=\"h-[350px] pr-4\">\r\n                  <div className=\"space-y-4\">\r\n                    {/* Ảnh đại diện - dùng iframe để bypass CORS */}\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-sm font-medium\">Ảnh sản phẩm</Label>\r\n                      <div className=\"grid grid-cols-3 gap-3\">\r\n                        {selectedProductForDetail.original_img && (\r\n                          <div className=\"space-y-1\">\r\n                            <Label className=\"text-xs text-muted-foreground\">Ảnh gốc</Label>\r\n                            <a \r\n                              href={buildPkgxImageUrl(selectedProductForDetail.original_img)}\r\n                              target=\"_blank\"\r\n                              rel=\"noopener noreferrer\"\r\n                              className=\"block border rounded p-2 hover:border-primary transition-colors bg-white\"\r\n                            >\r\n                              <div className=\"w-full h-28 flex items-center justify-center overflow-hidden\">\r\n                                <img \r\n                                  src={buildPkgxImageUrl(selectedProductForDetail.original_img)}\r\n                                  alt=\"Original\"\r\n                                  className=\"max-w-full max-h-full object-contain\"\r\n                                  loading=\"lazy\"\r\n                                  referrerPolicy=\"no-referrer\"\r\n                                  onError={(e) => { \r\n                                    const target = e.target as HTMLImageElement;\r\n                                    target.style.display = 'none';\r\n                                    target.parentElement!.innerHTML = '<div class=\"text-xs text-muted-foreground text-center py-8\">Click để xem</div>';\r\n                                  }}\r\n                                />\r\n                              </div>\r\n                              <div className=\"text-xs text-center text-primary mt-1\">Xem ảnh gốc</div>\r\n                            </a>\r\n                          </div>\r\n                        )}\r\n                        {selectedProductForDetail.goods_img && (\r\n                          <div className=\"space-y-1\">\r\n                            <Label className=\"text-xs text-muted-foreground\">Ảnh SP</Label>\r\n                            <a \r\n                              href={buildPkgxImageUrl(selectedProductForDetail.goods_img)}\r\n                              target=\"_blank\"\r\n                              rel=\"noopener noreferrer\"\r\n                              className=\"block border rounded p-2 hover:border-primary transition-colors bg-white\"\r\n                            >\r\n                              <div className=\"w-full h-28 flex items-center justify-center overflow-hidden\">\r\n                                <img \r\n                                  src={buildPkgxImageUrl(selectedProductForDetail.goods_img)}\r\n                                  alt=\"Goods\"\r\n                                  className=\"max-w-full max-h-full object-contain\"\r\n                                  loading=\"lazy\"\r\n                                  referrerPolicy=\"no-referrer\"\r\n                                  onError={(e) => { \r\n                                    const target = e.target as HTMLImageElement;\r\n                                    target.style.display = 'none';\r\n                                    target.parentElement!.innerHTML = '<div class=\"text-xs text-muted-foreground text-center py-8\">Click để xem</div>';\r\n                                  }}\r\n                                />\r\n                              </div>\r\n                              <div className=\"text-xs text-center text-primary mt-1\">Xem ảnh SP</div>\r\n                            </a>\r\n                          </div>\r\n                        )}\r\n                        {selectedProductForDetail.goods_thumb && (\r\n                          <div className=\"space-y-1\">\r\n                            <Label className=\"text-xs text-muted-foreground\">Thumbnail</Label>\r\n                            <a \r\n                              href={buildPkgxImageUrl(selectedProductForDetail.goods_thumb)}\r\n                              target=\"_blank\"\r\n                              rel=\"noopener noreferrer\"\r\n                              className=\"block border rounded p-2 hover:border-primary transition-colors bg-white\"\r\n                            >\r\n                              <div className=\"w-full h-28 flex items-center justify-center overflow-hidden\">\r\n                                <img \r\n                                  src={buildPkgxImageUrl(selectedProductForDetail.goods_thumb)}\r\n                                  alt=\"Thumbnail\"\r\n                                  className=\"max-w-full max-h-full object-contain\"\r\n                                  loading=\"lazy\"\r\n                                  referrerPolicy=\"no-referrer\"\r\n                                  onError={(e) => { \r\n                                    const target = e.target as HTMLImageElement;\r\n                                    target.style.display = 'none';\r\n                                    target.parentElement!.innerHTML = '<div class=\"text-xs text-muted-foreground text-center py-8\">Click để xem</div>';\r\n                                  }}\r\n                                />\r\n                              </div>\r\n                              <div className=\"text-xs text-center text-primary mt-1\">Xem thumbnail</div>\r\n                            </a>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                      {!selectedProductForDetail.original_img && !selectedProductForDetail.goods_img && !selectedProductForDetail.goods_thumb && (\r\n                        <div className=\"text-sm text-muted-foreground p-4 border rounded text-center\">\r\n                          Chưa có ảnh sản phẩm\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    \r\n                    {/* Đường dẫn ảnh - có thể copy */}\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-sm font-medium\">Đường dẫn ảnh (click để mở)</Label>\r\n                      <div className=\"space-y-2 text-xs\">\r\n                        {selectedProductForDetail.original_img && (\r\n                          <a \r\n                            href={buildPkgxImageUrl(selectedProductForDetail.original_img)}\r\n                            target=\"_blank\"\r\n                            rel=\"noopener noreferrer\"\r\n                            className=\"flex items-center gap-2 p-2 border rounded bg-muted/30 hover:bg-muted transition-colors break-all\"\r\n                          >\r\n                            <ExternalLink className=\"h-3 w-3 flex-shrink-0 text-muted-foreground\" />\r\n                            <span className=\"text-muted-foreground font-medium\">Original:</span>\r\n                            <span className=\"text-primary underline\">{selectedProductForDetail.original_img}</span>\r\n                          </a>\r\n                        )}\r\n                        {selectedProductForDetail.goods_img && (\r\n                          <a \r\n                            href={buildPkgxImageUrl(selectedProductForDetail.goods_img)}\r\n                            target=\"_blank\"\r\n                            rel=\"noopener noreferrer\"\r\n                            className=\"flex items-center gap-2 p-2 border rounded bg-muted/30 hover:bg-muted transition-colors break-all\"\r\n                          >\r\n                            <ExternalLink className=\"h-3 w-3 flex-shrink-0 text-muted-foreground\" />\r\n                            <span className=\"text-muted-foreground font-medium\">Goods:</span>\r\n                            <span className=\"text-primary underline\">{selectedProductForDetail.goods_img}</span>\r\n                          </a>\r\n                        )}\r\n                        {selectedProductForDetail.goods_thumb && (\r\n                          <a \r\n                            href={buildPkgxImageUrl(selectedProductForDetail.goods_thumb)}\r\n                            target=\"_blank\"\r\n                            rel=\"noopener noreferrer\"\r\n                            className=\"flex items-center gap-2 p-2 border rounded bg-muted/30 hover:bg-muted transition-colors break-all\"\r\n                          >\r\n                            <ExternalLink className=\"h-3 w-3 flex-shrink-0 text-muted-foreground\" />\r\n                            <span className=\"text-muted-foreground font-medium\">Thumb:</span>\r\n                            <span className=\"text-primary underline\">{selectedProductForDetail.goods_thumb}</span>\r\n                          </a>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                    \r\n                    {/* Album ảnh */}\r\n                    <div className=\"space-y-2\">\r\n                      <Label className=\"text-sm font-medium\">\r\n                        Album ảnh {galleryImages.length > 0 && `(${galleryImages.length})`}\r\n                      </Label>\r\n                      {isLoadingGallery ? (\r\n                        <div className=\"flex items-center justify-center p-4 border rounded\">\r\n                          <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\r\n                          <span className=\"ml-2 text-sm text-muted-foreground\">Đang tải gallery...</span>\r\n                        </div>\r\n                      ) : galleryImages.length > 0 ? (\r\n                        <div className=\"grid grid-cols-4 gap-2\">\r\n                          {galleryImages.map((img, index) => (\r\n                            <a\r\n                              key={img.img_id || index}\r\n                              href={buildPkgxImageUrl(img.img_url || img.img_original)}\r\n                              target=\"_blank\"\r\n                              rel=\"noopener noreferrer\"\r\n                              className=\"block border rounded p-1 hover:border-primary transition-colors bg-white\"\r\n                            >\r\n                              <div className=\"w-full h-20 flex items-center justify-center overflow-hidden\">\r\n                                <img\r\n                                  src={buildPkgxImageUrl(img.thumb_url || img.img_url)}\r\n                                  alt={img.img_desc || `Gallery ${index + 1}`}\r\n                                  className=\"max-w-full max-h-full object-contain\"\r\n                                  loading=\"lazy\"\r\n                                  onError={(e) => {\r\n                                    const target = e.target as HTMLImageElement;\r\n                                    target.style.display = 'none';\r\n                                    target.parentElement!.innerHTML = '<div class=\"text-xs text-muted-foreground text-center py-4\">Lỗi</div>';\r\n                                  }}\r\n                                />\r\n                              </div>\r\n                            </a>\r\n                          ))}\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"text-sm text-muted-foreground p-4 border rounded text-center\">\r\n                          <p>Chưa có ảnh trong album</p>\r\n                          <p className=\"text-xs mt-1 opacity-70\">\r\n                            Sản phẩm này chưa có ảnh gallery hoặc gallery trống\r\n                          </p>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </ScrollArea>\r\n              </TabsContent>\r\n            </Tabs>\r\n          )}\r\n          \r\n          <DialogFooter className=\"mt-4 flex-wrap gap-2\">\r\n            {selectedProductForDetail && (\r\n              <>\r\n                <Button variant=\"outline\" size=\"sm\" onClick={() => handleViewOnPkgx(selectedProductForDetail.goods_id)}>\r\n                  <ExternalLink className=\"h-4 w-4 mr-2\" />\r\n                  Xem trên PKGX\r\n                </Button>\r\n                {selectedProductForDetail.linkedHrmProduct && (\r\n                  <Button \r\n                    variant=\"outline\" \r\n                    size=\"sm\" \r\n                    className=\"text-destructive hover:text-destructive\"\r\n                    onClick={() => {\r\n                      setIsDetailDialogOpen(false);\r\n                      handleOpenUnlinkDialog(selectedProductForDetail);\r\n                    }}\r\n                  >\r\n                    <Unlink className=\"h-4 w-4 mr-2\" />\r\n                    Hủy liên kết\r\n                  </Button>\r\n                )}\r\n              </>\r\n            )}\r\n            <Button variant=\"outline\" onClick={() => setIsDetailDialogOpen(false)}>\r\n              Đóng\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n      \r\n      {/* Bulk Unlink Confirm Dialog */}\r\n      <AlertDialog open={isBulkUnlinkDialogOpen} onOpenChange={setIsBulkUnlinkDialogOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Hủy liên kết {selectedLinkedProducts.length} sản phẩm?</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              Bạn có chắc muốn hủy liên kết {selectedLinkedProducts.length} sản phẩm đã chọn với HRM? \r\n              Hành động này sẽ xóa liên kết giữa sản phẩm PKGX và HRM, không xóa dữ liệu sản phẩm.\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>Hủy</AlertDialogCancel>\r\n            <AlertDialogAction onClick={handleConfirmBulkUnlink} className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\">\r\n              Xác nhận hủy liên kết\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n      \r\n      {/* Confirmation Dialog for sync actions - using shared component */}\r\n      <PkgxSyncConfirmDialog\r\n        confirmAction={entitySync.confirmAction}\r\n        isSyncing={entitySync.isSyncing}\r\n        onConfirm={entitySync.executeAction}\r\n        onCancel={entitySync.cancelConfirm}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}