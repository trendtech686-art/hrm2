{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/orders/api/orders-api.ts"],"sourcesContent":["/**\r\n * Orders API - Isolated API functions\r\n * \r\n * ⚠️ IMPORTANT: This file should ONLY contain:\r\n * - Fetch functions\r\n * - Type imports from ../types\r\n * - NO store imports\r\n * - NO cross-feature imports\r\n */\r\n\r\nimport type { Order } from '../types';\r\n\r\nconst API_BASE = '/api/orders';\r\n\r\nexport interface OrdersParams {\r\n  page?: number;\r\n  limit?: number;\r\n  search?: string;\r\n  status?: string;\r\n  customerId?: string;\r\n  startDate?: string;\r\n  endDate?: string;\r\n  sortBy?: string;\r\n  sortOrder?: 'asc' | 'desc';\r\n}\r\n\r\nexport interface PaginatedResponse<T> {\r\n  data: T[];\r\n  pagination: {\r\n    page: number;\r\n    limit: number;\r\n    total: number;\r\n    totalPages: number;\r\n  };\r\n}\r\n\r\nexport interface CreateOrderInput {\r\n  // Required fields\r\n  customerSystemId: string;\r\n  customerName: string;\r\n  branchSystemId: string;\r\n  branchName: string;\r\n  salespersonSystemId: string;\r\n  salesperson: string;\r\n  lineItems: Array<{\r\n    productSystemId: string;\r\n    productId: string;\r\n    productName: string;\r\n    quantity: number;\r\n    unitPrice: number;\r\n    discount?: number;\r\n    discountType?: 'percentage' | 'fixed';\r\n    tax?: number;\r\n    note?: string;\r\n  }>;\r\n  orderDate: string;\r\n  \r\n  // Optional fields\r\n  shippingAddress?: string | Record<string, unknown>;\r\n  billingAddress?: string | Record<string, unknown>;\r\n  notes?: string;\r\n  tags?: string[];\r\n  status?: string;\r\n  paymentStatus?: string;\r\n  deliveryStatus?: string;\r\n  stockOutStatus?: string;\r\n  returnStatus?: string;\r\n  deliveryMethod?: string;\r\n  subtotal?: number;\r\n  shippingFee?: number;\r\n  tax?: number;\r\n  grandTotal?: number;\r\n  paidAmount?: number;\r\n  codAmount?: number;\r\n  packagings?: unknown[];\r\n  payments?: unknown[];\r\n  completedDate?: string | null;\r\n  createdAt?: string;\r\n}\r\n\r\nexport interface UpdateOrderInput {\r\n  id: string;\r\n  // Allow partial update of any Order field\r\n  [key: string]: unknown;\r\n}\r\n\r\n/**\r\n * Fetch paginated orders list\r\n */\r\nexport async function fetchOrders(params: OrdersParams = {}): Promise<PaginatedResponse<Order>> {\r\n  const { page = 1, limit = 50, ...rest } = params;\r\n  \r\n  const searchParams = new URLSearchParams({\r\n    page: String(page),\r\n    limit: String(limit),\r\n  });\r\n  \r\n  // Add optional params\r\n  Object.entries(rest).forEach(([key, value]) => {\r\n    if (value != null && value !== '') {\r\n      searchParams.set(key, String(value));\r\n    }\r\n  });\r\n  \r\n  const res = await fetch(`${API_BASE}?${searchParams}`);\r\n  if (!res.ok) {\r\n    throw new Error(`Failed to fetch orders: ${res.statusText}`);\r\n  }\r\n  \r\n  return res.json();\r\n}\r\n\r\n/**\r\n * Fetch single order by ID\r\n */\r\nexport async function fetchOrder(id: string): Promise<Order> {\r\n  const res = await fetch(`${API_BASE}/${id}`);\r\n  if (!res.ok) {\r\n    throw new Error(`Failed to fetch order ${id}: ${res.statusText}`);\r\n  }\r\n  return res.json();\r\n}\r\n\r\n/**\r\n * Create new order\r\n */\r\nexport async function createOrder(data: CreateOrderInput): Promise<Order> {\r\n  const res = await fetch(API_BASE, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    const error = await res.json().catch(() => ({}));\r\n    throw new Error(error.message || `Failed to create order: ${res.statusText}`);\r\n  }\r\n  \r\n  return res.json();\r\n}\r\n\r\n/**\r\n * Update existing order\r\n */\r\nexport async function updateOrder({ id, ...data }: UpdateOrderInput): Promise<Order> {\r\n  const res = await fetch(`${API_BASE}/${id}`, {\r\n    method: 'PUT',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    const error = await res.json().catch(() => ({}));\r\n    throw new Error(error.message || `Failed to update order: ${res.statusText}`);\r\n  }\r\n  \r\n  return res.json();\r\n}\r\n\r\n/**\r\n * Delete order\r\n */\r\nexport async function deleteOrder(id: string): Promise<void> {\r\n  const res = await fetch(`${API_BASE}/${id}`, {\r\n    method: 'DELETE',\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    const error = await res.json().catch(() => ({}));\r\n    throw new Error(error.message || `Failed to delete order: ${res.statusText}`);\r\n  }\r\n}\r\n\r\n/**\r\n * Fetch order stats (for dashboard)\r\n */\r\nexport async function fetchOrderStats(): Promise<{\r\n  totalOrders: number;\r\n  totalRevenue: number;\r\n  pendingOrders: number;\r\n  todayOrders: number;\r\n}> {\r\n  const res = await fetch(`${API_BASE}/stats`);\r\n  if (!res.ok) {\r\n    throw new Error(`Failed to fetch order stats: ${res.statusText}`);\r\n  }\r\n  return res.json();\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;;;;CAQC;;;;;;;;;;;;;;AAID,MAAM,WAAW;AA6EV,eAAe,YAAY,SAAuB,CAAC,CAAC;IACzD,MAAM,EAAE,OAAO,CAAC,EAAE,QAAQ,EAAE,EAAE,GAAG,MAAM,GAAG;IAE1C,MAAM,eAAe,IAAI,gBAAgB;QACvC,MAAM,OAAO;QACb,OAAO,OAAO;IAChB;IAEA,sBAAsB;IACtB,OAAO,OAAO,CAAC,MAAM,OAAO,CAAC,CAAC,CAAC,KAAK,MAAM;QACxC,IAAI,SAAS,QAAQ,UAAU,IAAI;YACjC,aAAa,GAAG,CAAC,KAAK,OAAO;QAC/B;IACF;IAEA,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,cAAc;IACrD,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,IAAI,MAAM,CAAC,wBAAwB,EAAE,IAAI,UAAU,EAAE;IAC7D;IAEA,OAAO,IAAI,IAAI;AACjB;AAKO,eAAe,WAAW,EAAU;IACzC,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,IAAI;IAC3C,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,IAAI,MAAM,CAAC,sBAAsB,EAAE,GAAG,EAAE,EAAE,IAAI,UAAU,EAAE;IAClE;IACA,OAAO,IAAI,IAAI;AACjB;AAKO,eAAe,YAAY,IAAsB;IACtD,MAAM,MAAM,MAAM,MAAM,UAAU;QAChC,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,QAAQ,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAC9C,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI,CAAC,wBAAwB,EAAE,IAAI,UAAU,EAAE;IAC9E;IAEA,OAAO,IAAI,IAAI;AACjB;AAKO,eAAe,YAAY,EAAE,EAAE,EAAE,GAAG,MAAwB;IACjE,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,IAAI,EAAE;QAC3C,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,QAAQ,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAC9C,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI,CAAC,wBAAwB,EAAE,IAAI,UAAU,EAAE;IAC9E;IAEA,OAAO,IAAI,IAAI;AACjB;AAKO,eAAe,YAAY,EAAU;IAC1C,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,IAAI,EAAE;QAC3C,QAAQ;IACV;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,QAAQ,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAC9C,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI,CAAC,wBAAwB,EAAE,IAAI,UAAU,EAAE;IAC9E;AACF;AAKO,eAAe;IAMpB,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,MAAM,CAAC;IAC3C,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,IAAI,MAAM,CAAC,6BAA6B,EAAE,IAAI,UAAU,EAAE;IAClE;IACA,OAAO,IAAI,IAAI;AACjB"}},
    {"offset": {"line": 103, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/orders/hooks/use-all-orders.ts"],"sourcesContent":["/**\r\n * useAllOrders - Convenience hook for components needing all orders as flat array\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { useOrders } from './use-orders';\r\nimport type { Order } from '../types';\r\nimport type { SystemId } from '@/lib/id-types';\r\n\r\nexport function useAllOrders() {\r\n  const query = useOrders({ limit: 30 });\r\n  \r\n  return {\r\n    data: query.data?.data || [],\r\n    isLoading: query.isLoading,\r\n    isError: query.isError,\r\n    error: query.error,\r\n  };\r\n}\r\n\r\n/**\r\n * Hook for finding order by systemId or business id from cached data\r\n * Replaces legacy store.findById() method\r\n */\r\nexport function useOrderFinder() {\r\n  const { data } = useAllOrders();\r\n  \r\n  const findById = React.useCallback(\r\n    (systemId: SystemId | string | undefined): Order | undefined => {\r\n      if (!systemId) return undefined;\r\n      return data.find(o => o.systemId === systemId);\r\n    },\r\n    [data]\r\n  );\r\n  \r\n  const findByBusinessId = React.useCallback(\r\n    (businessId: string | undefined): Order | undefined => {\r\n      if (!businessId) return undefined;\r\n      return data.find(o => o.id === businessId);\r\n    },\r\n    [data]\r\n  );\r\n  \r\n  return { findById, findByBusinessId };\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;CAEC,GAED;AACA;;;;AAIO,SAAS;;IACd,MAAM,QAAQ,IAAA,4KAAS,EAAC;QAAE,OAAO;IAAG;IAEpC,OAAO;QACL,MAAM,MAAM,IAAI,EAAE,QAAQ,EAAE;QAC5B,WAAW,MAAM,SAAS;QAC1B,SAAS,MAAM,OAAO;QACtB,OAAO,MAAM,KAAK;IACpB;AACF;GATgB;;QACA,4KAAS;;;AAclB,SAAS;;IACd,MAAM,EAAE,IAAI,EAAE,GAAG;IAEjB,MAAM,WAAW,4KAAiB;gDAChC,CAAC;YACC,IAAI,CAAC,UAAU,OAAO;YACtB,OAAO,KAAK,IAAI;wDAAC,CAAA,IAAK,EAAE,QAAQ,KAAK;;QACvC;+CACA;QAAC;KAAK;IAGR,MAAM,mBAAmB,4KAAiB;wDACxC,CAAC;YACC,IAAI,CAAC,YAAY,OAAO;YACxB,OAAO,KAAK,IAAI;gEAAC,CAAA,IAAK,EAAE,EAAE,KAAK;;QACjC;uDACA;QAAC;KAAK;IAGR,OAAO;QAAE;QAAU;IAAiB;AACtC;IApBgB;;QACG"}},
    {"offset": {"line": 173, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/orders/hooks/use-orders.ts"],"sourcesContent":["/**\r\n * useOrders - React Query hook for orders list\r\n * \r\n * ⚠️ IMPORTANT: Direct import pattern\r\n * - Import this file directly: import { useOrders } from '@/features/orders/hooks/use-orders'\r\n * - NEVER import from '@/features/orders' or '@/features/orders/store'\r\n * \r\n * This hook is ISOLATED - it only depends on:\r\n * - @tanstack/react-query\r\n * - Local API functions\r\n * - Local types\r\n */\r\n\r\nimport { useQuery, keepPreviousData } from '@tanstack/react-query';\r\nimport { fetchOrders, fetchOrder, fetchOrderStats, type OrdersParams } from '../api/orders-api';\r\n\r\n// Query keys - exported for invalidation\r\nexport const orderKeys = {\r\n  all: ['orders'] as const,\r\n  lists: () => [...orderKeys.all, 'list'] as const,\r\n  list: (params: OrdersParams) => [...orderKeys.lists(), params] as const,\r\n  details: () => [...orderKeys.all, 'detail'] as const,\r\n  detail: (id: string) => [...orderKeys.details(), id] as const,\r\n  stats: () => [...orderKeys.all, 'stats'] as const,\r\n};\r\n\r\n/**\r\n * Hook for fetching paginated orders list\r\n * \r\n * @example\r\n * ```tsx\r\n * function OrdersPage() {\r\n *   const [page, setPage] = useState(1);\r\n *   const { data, isLoading, error } = useOrders({ page, limit: 50 });\r\n *   \r\n *   if (isLoading) return <Skeleton />;\r\n *   if (error) return <ErrorMessage error={error} />;\r\n *   \r\n *   return (\r\n *     <DataTable \r\n *       data={data.data} \r\n *       pagination={data.pagination}\r\n *       onPageChange={setPage}\r\n *     />\r\n *   );\r\n * }\r\n * ```\r\n */\r\nexport function useOrders(params: OrdersParams = {}) {\r\n  return useQuery({\r\n    queryKey: orderKeys.list(params),\r\n    queryFn: () => fetchOrders(params),\r\n    staleTime: 30_000, // 30 seconds\r\n    gcTime: 5 * 60 * 1000, // 5 minutes (formerly cacheTime)\r\n    placeholderData: keepPreviousData, // Keep old data while fetching new page\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for fetching single order by ID\r\n * \r\n * @example\r\n * ```tsx\r\n * function OrderDetail({ orderId }: { orderId: string }) {\r\n *   const { data: order, isLoading } = useOrder(orderId);\r\n *   // ...\r\n * }\r\n * ```\r\n */\r\nexport function useOrder(id: string | null | undefined) {\r\n  return useQuery({\r\n    queryKey: orderKeys.detail(id!),\r\n    queryFn: () => fetchOrder(id!),\r\n    enabled: !!id, // Only fetch if id is provided\r\n    staleTime: 60_000, // 1 minute for detail view\r\n    gcTime: 10 * 60 * 1000, // 10 minutes\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for fetching order statistics (dashboard)\r\n */\r\nexport function useOrderStats() {\r\n  return useQuery({\r\n    queryKey: orderKeys.stats(),\r\n    queryFn: fetchOrderStats,\r\n    staleTime: 60_000, // 1 minute\r\n    gcTime: 5 * 60 * 1000,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for searching orders with debounce\r\n * \r\n * @example\r\n * ```tsx\r\n * function OrderSearch() {\r\n *   const [search, setSearch] = useState('');\r\n *   const debouncedSearch = useDebounce(search, 300);\r\n *   const { data } = useOrderSearch(debouncedSearch);\r\n *   // ...\r\n * }\r\n * ```\r\n */\r\nexport function useOrderSearch(search: string, limit = 20) {\r\n  return useQuery({\r\n    queryKey: orderKeys.list({ search, limit }),\r\n    queryFn: () => fetchOrders({ search, limit }),\r\n    enabled: search.length >= 2, // Only search with 2+ chars\r\n    staleTime: 30_000,\r\n  });\r\n}\r\n\r\n// Re-export from use-all-orders for backward compatibility\r\nexport { useAllOrders, useOrderFinder } from './use-all-orders';\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;;;;;;;;;;CAWC,GAED;AAAA;AACA;AAmGA,2DAA2D;AAC3D;;;;AAjGO,MAAM,YAAY;IACvB,KAAK;QAAC;KAAS;IACf,OAAO,IAAM;eAAI,UAAU,GAAG;YAAE;SAAO;IACvC,MAAM,CAAC,SAAyB;eAAI,UAAU,KAAK;YAAI;SAAO;IAC9D,SAAS,IAAM;eAAI,UAAU,GAAG;YAAE;SAAS;IAC3C,QAAQ,CAAC,KAAe;eAAI,UAAU,OAAO;YAAI;SAAG;IACpD,OAAO,IAAM;eAAI,UAAU,GAAG;YAAE;SAAQ;AAC1C;AAwBO,SAAS,UAAU,SAAuB,CAAC,CAAC;;IACjD,OAAO,IAAA,0LAAQ,EAAC;QACd,UAAU,UAAU,IAAI,CAAC;QACzB,OAAO;kCAAE,IAAM,IAAA,4JAAW,EAAC;;QAC3B,WAAW;QACX,QAAQ,IAAI,KAAK;QACjB,iBAAiB,8LAAgB;IACnC;AACF;GARgB;;QACP,0LAAQ;;;AAoBV,SAAS,SAAS,EAA6B;;IACpD,OAAO,IAAA,0LAAQ,EAAC;QACd,UAAU,UAAU,MAAM,CAAC;QAC3B,OAAO;iCAAE,IAAM,IAAA,2JAAU,EAAC;;QAC1B,SAAS,CAAC,CAAC;QACX,WAAW;QACX,QAAQ,KAAK,KAAK;IACpB;AACF;IARgB;;QACP,0LAAQ;;;AAYV,SAAS;;IACd,OAAO,IAAA,0LAAQ,EAAC;QACd,UAAU,UAAU,KAAK;QACzB,SAAS,gKAAe;QACxB,WAAW;QACX,QAAQ,IAAI,KAAK;IACnB;AACF;IAPgB;;QACP,0LAAQ;;;AAqBV,SAAS,eAAe,MAAc,EAAE,QAAQ,EAAE;;IACvD,OAAO,IAAA,0LAAQ,EAAC;QACd,UAAU,UAAU,IAAI,CAAC;YAAE;YAAQ;QAAM;QACzC,OAAO;uCAAE,IAAM,IAAA,4JAAW,EAAC;oBAAE;oBAAQ;gBAAM;;QAC3C,SAAS,OAAO,MAAM,IAAI;QAC1B,WAAW;IACb;AACF;IAPgB;;QACP,0LAAQ"}},
    {"offset": {"line": 307, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/orders/hooks/use-order-mutations.ts"],"sourcesContent":["/**\r\n * useOrderMutations - React Query mutations for orders\r\n * \r\n * ⚠️ IMPORTANT: Direct import pattern\r\n * Import this file directly: import { useOrderMutations } from '@/features/orders/hooks/use-order-mutations'\r\n */\r\n\r\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport { createOrder, updateOrder, deleteOrder, type CreateOrderInput, type UpdateOrderInput } from '../api/orders-api';\r\nimport { orderKeys } from './use-orders';\r\n\r\ninterface UseOrderMutationsOptions {\r\n  onCreateSuccess?: (order: unknown) => void;\r\n  onUpdateSuccess?: (order: unknown) => void;\r\n  onDeleteSuccess?: () => void;\r\n  onError?: (error: Error) => void;\r\n}\r\n\r\n/**\r\n * Hook for order CRUD mutations\r\n * \r\n * @example\r\n * ```tsx\r\n * function CreateOrderForm() {\r\n *   const { create, isCreating } = useOrderMutations({\r\n *     onCreateSuccess: (order) => {\r\n *       toast.success('Đơn hàng đã được tạo');\r\n *       router.push(`/orders/${order.id}`);\r\n *     },\r\n *   });\r\n *   \r\n *   const handleSubmit = (data: CreateOrderInput) => {\r\n *     create.mutate(data);\r\n *   };\r\n *   \r\n *   return (\r\n *     <form onSubmit={handleSubmit}>\r\n *       // ...\r\n *       <Button loading={isCreating}>Tạo đơn hàng</Button>\r\n *     </form>\r\n *   );\r\n * }\r\n * ```\r\n */\r\nexport function useOrderMutations(options: UseOrderMutationsOptions = {}) {\r\n  const queryClient = useQueryClient();\r\n  \r\n  const create = useMutation({\r\n    mutationFn: createOrder,\r\n    onSuccess: (data) => {\r\n      // Invalidate orders list to refetch\r\n      queryClient.invalidateQueries({ queryKey: orderKeys.lists() });\r\n      // Also invalidate stats\r\n      queryClient.invalidateQueries({ queryKey: orderKeys.stats() });\r\n      options.onCreateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const update = useMutation({\r\n    mutationFn: updateOrder,\r\n    onSuccess: (data, variables) => {\r\n      // Invalidate the specific order detail\r\n      queryClient.invalidateQueries({ queryKey: orderKeys.detail(variables.id) });\r\n      // Invalidate orders list\r\n      queryClient.invalidateQueries({ queryKey: orderKeys.lists() });\r\n      // Invalidate stats in case status changed\r\n      queryClient.invalidateQueries({ queryKey: orderKeys.stats() });\r\n      options.onUpdateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const remove = useMutation({\r\n    mutationFn: deleteOrder,\r\n    onSuccess: () => {\r\n      // Invalidate all order queries\r\n      queryClient.invalidateQueries({ queryKey: orderKeys.all });\r\n      options.onDeleteSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  return {\r\n    create,\r\n    update,\r\n    remove,\r\n    isCreating: create.isPending,\r\n    isUpdating: update.isPending,\r\n    isDeleting: remove.isPending,\r\n    isMutating: create.isPending || update.isPending || remove.isPending,\r\n  };\r\n}\r\n\r\n/**\r\n * Hook for optimistic order updates\r\n * \r\n * Use this when you want instant UI feedback before server response\r\n */\r\nexport function useOptimisticOrderUpdate() {\r\n  const queryClient = useQueryClient();\r\n  \r\n  return useMutation({\r\n    mutationFn: updateOrder,\r\n    // Optimistic update\r\n    onMutate: async (newData) => {\r\n      // Cancel outgoing refetches\r\n      await queryClient.cancelQueries({ queryKey: orderKeys.detail(newData.id) });\r\n      \r\n      // Snapshot previous value\r\n      const previousOrder = queryClient.getQueryData(orderKeys.detail(newData.id));\r\n      \r\n      // Optimistically update\r\n      queryClient.setQueryData(orderKeys.detail(newData.id), (old: unknown) => ({\r\n        ...(old as object),\r\n        ...newData,\r\n      }));\r\n      \r\n      return { previousOrder };\r\n    },\r\n    // Rollback on error\r\n    onError: (_err, newData, context) => {\r\n      if (context?.previousOrder) {\r\n        queryClient.setQueryData(orderKeys.detail(newData.id), context.previousOrder);\r\n      }\r\n    },\r\n    // Refetch after success or error\r\n    onSettled: (_data, _error, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: orderKeys.detail(variables.id) });\r\n    },\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;;;CAKC,GAED;AAAA;AACA;AACA;;;;;AAmCO,SAAS,kBAAkB,UAAoC,CAAC,CAAC;;IACtE,MAAM,cAAc,IAAA,2MAAc;IAElC,MAAM,SAAS,IAAA,gMAAW,EAAC;QACzB,YAAY,4JAAW;QACvB,SAAS;qDAAE,CAAC;gBACV,oCAAoC;gBACpC,YAAY,iBAAiB,CAAC;oBAAE,UAAU,4KAAS,CAAC,KAAK;gBAAG;gBAC5D,wBAAwB;gBACxB,YAAY,iBAAiB,CAAC;oBAAE,UAAU,4KAAS,CAAC,KAAK;gBAAG;gBAC5D,QAAQ,eAAe,GAAG;YAC5B;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,SAAS,IAAA,gMAAW,EAAC;QACzB,YAAY,4JAAW;QACvB,SAAS;qDAAE,CAAC,MAAM;gBAChB,uCAAuC;gBACvC,YAAY,iBAAiB,CAAC;oBAAE,UAAU,4KAAS,CAAC,MAAM,CAAC,UAAU,EAAE;gBAAE;gBACzE,yBAAyB;gBACzB,YAAY,iBAAiB,CAAC;oBAAE,UAAU,4KAAS,CAAC,KAAK;gBAAG;gBAC5D,0CAA0C;gBAC1C,YAAY,iBAAiB,CAAC;oBAAE,UAAU,4KAAS,CAAC,KAAK;gBAAG;gBAC5D,QAAQ,eAAe,GAAG;YAC5B;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,SAAS,IAAA,gMAAW,EAAC;QACzB,YAAY,4JAAW;QACvB,SAAS;qDAAE;gBACT,+BAA+B;gBAC/B,YAAY,iBAAiB,CAAC;oBAAE,UAAU,4KAAS,CAAC,GAAG;gBAAC;gBACxD,QAAQ,eAAe;YACzB;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,OAAO;QACL;QACA;QACA;QACA,YAAY,OAAO,SAAS;QAC5B,YAAY,OAAO,SAAS;QAC5B,YAAY,OAAO,SAAS;QAC5B,YAAY,OAAO,SAAS,IAAI,OAAO,SAAS,IAAI,OAAO,SAAS;IACtE;AACF;GAhDgB;;QACM,2MAAc;QAEnB,gMAAW;QAYX,gMAAW;QAcX,gMAAW;;;AA0BrB,SAAS;;IACd,MAAM,cAAc,IAAA,2MAAc;IAElC,OAAO,IAAA,gMAAW,EAAC;QACjB,YAAY,4JAAW;QACvB,oBAAoB;QACpB,QAAQ;oDAAE,OAAO;gBACf,4BAA4B;gBAC5B,MAAM,YAAY,aAAa,CAAC;oBAAE,UAAU,4KAAS,CAAC,MAAM,CAAC,QAAQ,EAAE;gBAAE;gBAEzE,0BAA0B;gBAC1B,MAAM,gBAAgB,YAAY,YAAY,CAAC,4KAAS,CAAC,MAAM,CAAC,QAAQ,EAAE;gBAE1E,wBAAwB;gBACxB,YAAY,YAAY,CAAC,4KAAS,CAAC,MAAM,CAAC,QAAQ,EAAE;4DAAG,CAAC,MAAiB,CAAC;4BACxE,GAAI,GAAG;4BACP,GAAG,OAAO;wBACZ,CAAC;;gBAED,OAAO;oBAAE;gBAAc;YACzB;;QACA,oBAAoB;QACpB,OAAO;oDAAE,CAAC,MAAM,SAAS;gBACvB,IAAI,SAAS,eAAe;oBAC1B,YAAY,YAAY,CAAC,4KAAS,CAAC,MAAM,CAAC,QAAQ,EAAE,GAAG,QAAQ,aAAa;gBAC9E;YACF;;QACA,iCAAiC;QACjC,SAAS;oDAAE,CAAC,OAAO,QAAQ;gBACzB,YAAY,iBAAiB,CAAC;oBAAE,UAAU,4KAAS,CAAC,MAAM,CAAC,UAAU,EAAE;gBAAE;YAC3E;;IACF;AACF;IAhCgB;;QACM,2MAAc;QAE3B,gMAAW"}},
    {"offset": {"line": 455, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/orders/columns.tsx"],"sourcesContent":["'use client'\r\n\r\nimport * as React from \"react\";\r\nimport type { AppRouterInstance } from 'next/dist/shared/lib/app-router-context.shared-runtime';\r\nimport Link from 'next/link';\r\nimport { formatDate, formatDateTime, formatDateTimeSeconds, formatDateCustom, parseDate, getCurrentDate } from '@/lib/date-utils';\r\nimport type { Order, OrderMainStatus, OrderPaymentStatus, OrderDeliveryStatus, OrderPrintStatus, OrderStockOutStatus, OrderReturnStatus, Packaging } from './types';\r\nimport { Checkbox } from \"../../components/ui/checkbox\";\r\nimport { DataTableColumnHeader } from \"../../components/data-table/data-table-column-header\";\r\nimport { Badge } from \"../../components/ui/badge\";\r\nimport type { ColumnDef } from '../../components/data-table/types';\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger } from \"../../components/ui/dropdown-menu\";\r\nimport { Button } from \"../../components/ui/button\";\r\nimport { MoreHorizontal } from \"lucide-react\";\r\n\r\n// This is a temporary type for the column until the Order type is fully updated.\r\ntype OrderPackagingStatus_DEPRECATED = 'Chưa đóng gói' | 'Chờ xác nhận đóng gói' | 'Đóng gói toàn bộ';\r\n\r\nconst formatCurrency = (value?: number) => {\r\n    if (typeof value !== 'number') return '';\r\n    return new Intl.NumberFormat('vi-VN').format(value);\r\n};\r\n\r\nconst mainStatusVariants: Record<OrderMainStatus, \"success\" | \"default\" | \"secondary\" | \"warning\" | \"destructive\"> = {\r\n    \"Đặt hàng\": \"secondary\",\r\n    \"Đang giao dịch\": \"warning\",\r\n    \"Hoàn thành\": \"success\",\r\n    \"Đã hủy\": \"destructive\",\r\n};\r\n\r\nconst paymentStatusVariants: Record<OrderPaymentStatus, \"success\" | \"warning\" | \"secondary\"> = {\r\n  'Chưa thanh toán': 'warning',\r\n  'Thanh toán 1 phần': 'warning',\r\n  'Thanh toán toàn bộ': 'success',\r\n};\r\n\r\nconst packagingStatusVariants: Record<OrderPackagingStatus_DEPRECATED, \"success\" | \"warning\" | \"secondary\"> = {\r\n  'Chưa đóng gói': 'secondary',\r\n  'Chờ xác nhận đóng gói': 'warning',\r\n  'Đóng gói toàn bộ': 'success',\r\n};\r\n\r\nconst deliveryStatusVariants: Record<OrderDeliveryStatus, \"success\" | \"warning\" | \"secondary\" | \"default\" | \"destructive\"> = {\r\n  'Chờ đóng gói': 'secondary',\r\n  'Đã đóng gói': 'default',\r\n  'Chờ lấy hàng': 'warning',\r\n  'Đang giao hàng': 'warning',\r\n  'Đã giao hàng': 'success',\r\n  'Chờ giao lại': 'destructive',\r\n  'Đã hủy': 'destructive',\r\n};\r\n\r\nconst printStatusVariants: Record<OrderPrintStatus, \"success\" | \"secondary\"> = {\r\n  'Đã in': 'success',\r\n  'Chưa in': 'secondary',\r\n};\r\n\r\nconst stockOutStatusVariants: Record<OrderStockOutStatus, \"success\" | \"secondary\"> = {\r\n  'Chưa xuất kho': 'secondary',\r\n  'Xuất kho toàn bộ': 'success',\r\n};\r\n\r\nconst returnStatusVariants: Record<OrderReturnStatus, \"warning\" | \"destructive\" | \"secondary\"> = {\r\n  'Chưa trả hàng': 'secondary',\r\n  'Trả hàng một phần': 'warning',\r\n  'Trả hàng toàn bộ': 'destructive',\r\n};\r\n\r\n\r\nexport interface OrderColumnActions {\r\n  onCancel: (systemId: string) => void;\r\n  router: AppRouterInstance;\r\n  onPrintOrder?: (order: Order) => void;\r\n  onPrintPacking?: (order: Order) => void;\r\n  onPrintShippingLabel?: (order: Order) => void;\r\n  onPrintDelivery?: (order: Order) => void;\r\n}\r\n\r\nexport const getColumns = (\r\n  onCancel: (systemId: string) => void,\r\n  router: AppRouterInstance,\r\n  printActions?: {\r\n    onPrintOrder?: (order: Order) => void;\r\n    onPrintPacking?: (order: Order) => void;\r\n    onPrintShippingLabel?: (order: Order) => void;\r\n    onPrintDelivery?: (order: Order) => void;\r\n  }\r\n): ColumnDef<Order>[] => [\r\n  {\r\n    id: \"select\",\r\n    header: ({ isAllPageRowsSelected, isSomePageRowsSelected, onToggleAll }) => (\r\n       <div className=\"flex items-center justify-center\">\r\n        <Checkbox\r\n          checked={isAllPageRowsSelected ? true : isSomePageRowsSelected ? \"indeterminate\" : false}\r\n          onCheckedChange={(value) => onToggleAll?.(!!value)}\r\n          aria-label=\"Select all\"\r\n        />\r\n      </div>\r\n    ),\r\n    cell: ({ isSelected, onToggleSelect }) => (\r\n       <div className=\"flex items-center justify-center\">\r\n        <Checkbox\r\n          checked={isSelected}\r\n          onCheckedChange={onToggleSelect}\r\n          aria-label=\"Select row\"\r\n        />\r\n      </div>\r\n    ),\r\n    size: 48,\r\n    meta: {\r\n      displayName: \"Select\",\r\n      sticky: \"left\",\r\n    },\r\n  },\r\n  {\r\n    id: \"id\",\r\n    accessorKey: \"id\",\r\n    header: \"Mã ĐH\",\r\n    cell: ({ row }) => (\r\n      <Link \r\n        href={`/orders/${row.systemId}`} \r\n        className=\"text-body-sm font-medium text-primary hover:underline\"\r\n      >\r\n        {row.id}\r\n      </Link>\r\n    ),\r\n    meta: { displayName: \"Mã ĐH\", group: \"Thông tin chung\" },\r\n    size: 120,\r\n  },\r\n  {\r\n    id: \"customerName\",\r\n    accessorKey: \"customerName\",\r\n    header: \"Tên khách hàng\",\r\n    cell: ({ row }) => row.customerName,\r\n    meta: { displayName: \"Tên khách hàng\", group: \"Thông tin chung\" },\r\n  },\r\n  {\r\n    id: \"orderDate\",\r\n    accessorKey: \"orderDate\",\r\n    header: \"Ngày tạo\",\r\n    cell: ({ row }) => formatDate(row.orderDate),\r\n    meta: { displayName: \"Ngày tạo\", group: \"Thông tin chung\" },\r\n  },\r\n  {\r\n    id: 'branchName',\r\n    accessorKey: 'branchName',\r\n    header: 'Chi nhánh',\r\n    cell: ({ row }) => row.branchName,\r\n    meta: { displayName: 'Chi nhánh', group: \"Thông tin chung\" }\r\n  },\r\n  {\r\n    id: \"salesperson\",\r\n    accessorKey: \"salesperson\",\r\n    header: \"NV Bán\",\r\n    cell: ({ row }) => row.salesperson,\r\n    meta: { displayName: \"NV Bán\", group: \"Nhân viên\" },\r\n  },\r\n  {\r\n    id: \"grandTotal\",\r\n    accessorKey: \"grandTotal\",\r\n    header: \"Tổng tiền\",\r\n    cell: ({ row }) => formatCurrency(row.grandTotal),\r\n    meta: { displayName: \"Tổng tiền\", group: \"Tài chính\" },\r\n  },\r\n  {\r\n    id: 'totalPaid',\r\n    header: 'Đã thanh toán',\r\n    cell: ({ row }) => {\r\n        const totalPaid = (row.payments || []).reduce((sum, p) => sum + p.amount, 0);\r\n        return formatCurrency(totalPaid);\r\n    },\r\n    meta: { displayName: 'Đã thanh toán', group: \"Tài chính\" }\r\n  },\r\n  {\r\n    id: 'debt',\r\n    header: 'Còn lại',\r\n    cell: ({ row }) => {\r\n        const totalPaid = (row.payments || []).reduce((sum, p) => sum + p.amount, 0);\r\n        const remaining = row.grandTotal - totalPaid;\r\n        return <span className={remaining > 0 ? 'text-body-sm text-destructive font-semibold' : ''}>{formatCurrency(remaining)}</span>;\r\n    },\r\n    meta: { displayName: 'Còn lại', group: \"Tài chính\" }\r\n  },\r\n  {\r\n    id: \"codAmount\",\r\n    accessorKey: \"codAmount\",\r\n    header: \"Thu hộ (COD)\",\r\n    cell: ({ row }) => formatCurrency(row.codAmount),\r\n    meta: { displayName: \"Thu hộ (COD)\", group: \"Tài chính\" },\r\n  },\r\n  {\r\n    id: \"status\",\r\n    accessorKey: \"status\",\r\n    header: \"Trạng thái\",\r\n    cell: ({ row }) => <Badge variant={mainStatusVariants[row.status]}>{row.status}</Badge>,\r\n    meta: { displayName: \"Trạng thái\", group: \"Trạng thái\" },\r\n  },\r\n  {\r\n    id: \"paymentStatus\",\r\n    accessorKey: \"paymentStatus\",\r\n    header: \"TT Thanh toán\",\r\n    cell: ({ row }) => <Badge variant={paymentStatusVariants[row.paymentStatus]}>{row.paymentStatus}</Badge>,\r\n    meta: { displayName: \"TT Thanh toán\", group: \"Trạng thái\" },\r\n  },\r\n  {\r\n    id: \"packagingStatus\",\r\n    accessorKey: \"packagings\",\r\n    header: \"TT Đóng gói\",\r\n    cell: ({ row }) => {\r\n      const packagings = row.packagings || [];\r\n      let status: OrderPackagingStatus_DEPRECATED = 'Chưa đóng gói';\r\n      if (packagings.some((p: Packaging) => p.status === 'Đã đóng gói')) {\r\n        status = 'Đóng gói toàn bộ';\r\n      } else if (packagings.some((p: Packaging) => p.status === 'Chờ đóng gói')) {\r\n        status = 'Chờ xác nhận đóng gói';\r\n      }\r\n      return <Badge variant={packagingStatusVariants[status]}>{status}</Badge>;\r\n    },\r\n    meta: { displayName: \"TT Đóng gói\", group: \"Trạng thái\" },\r\n  },\r\n  {\r\n    id: \"deliveryStatus\",\r\n    accessorKey: \"deliveryStatus\",\r\n    header: \"TT Giao hàng\",\r\n    cell: ({ row }) => <Badge variant={deliveryStatusVariants[row.deliveryStatus]}>{row.deliveryStatus}</Badge>,\r\n    meta: { displayName: \"TT Giao hàng\", group: \"Trạng thái\" },\r\n  },\r\n  {\r\n    id: \"printStatus\",\r\n    accessorKey: \"printStatus\",\r\n    header: \"TT In\",\r\n    cell: ({ row }) => <Badge variant={printStatusVariants[row.printStatus]}>{row.printStatus}</Badge>,\r\n    meta: { displayName: \"TT In\", group: \"Trạng thái\" },\r\n  },\r\n  {\r\n    id: \"stockOutStatus\",\r\n    accessorKey: \"stockOutStatus\",\r\n    header: \"TT Xuất kho\",\r\n    cell: ({ row }) => <Badge variant={stockOutStatusVariants[row.stockOutStatus]}>{row.stockOutStatus}</Badge>,\r\n    meta: { displayName: \"TT Xuất kho\", group: \"Trạng thái\" },\r\n  },\r\n  {\r\n    id: \"returnStatus\",\r\n    accessorKey: \"returnStatus\",\r\n    header: \"TT Trả hàng\",\r\n    cell: ({ row }) => <Badge variant={returnStatusVariants[row.returnStatus]}>{row.returnStatus}</Badge>,\r\n    meta: { displayName: \"TT Trả hàng\", group: \"Trạng thái\" },\r\n  },\r\n  {\r\n    id: 'packerName',\r\n    accessorKey: 'packagings',\r\n    header: 'NV Đóng gói',\r\n    cell: ({ row }) => {\r\n      const latestActive = [...(row.packagings || [])].reverse().find(p => p.status !== 'Hủy đóng gói');\r\n      // FIX: Changed `packerName` to `assignedEmployeeName` to match the `Packaging` type definition.\r\n      return latestActive?.assignedEmployeeName || '-';\r\n    },\r\n    meta: { displayName: 'NV Đóng gói', group: \"Nhân viên\" }\r\n  },\r\n  {\r\n    id: 'source',\r\n    accessorKey: 'source',\r\n    header: 'Nguồn',\r\n    cell: ({ row }) => row.source || '-',\r\n    meta: { displayName: 'Nguồn', group: \"Thông tin chung\" }\r\n  },\r\n  {\r\n    id: 'deliveryMethod',\r\n    accessorKey: 'deliveryMethod',\r\n    header: 'Hình thức giao',\r\n    cell: ({ row }) => row.deliveryMethod || '-',\r\n    meta: { displayName: 'Hình thức giao', group: \"Thông tin chung\" }\r\n  },\r\n   {\r\n    id: \"actions\",\r\n    header: () => <div className=\"text-center\">Hành động</div>,\r\n    cell: ({ row }) => {\r\n      const hasPackaging = row.packagings && row.packagings.length > 0;\r\n      const hasConfirmedPackaging = row.packagings?.some((p: Packaging) => p.status === 'Đã đóng gói');\r\n      \r\n      return (\r\n       <div className=\"flex items-center justify-center\">\r\n        <DropdownMenu>\r\n            <DropdownMenuTrigger asChild>\r\n              <Button variant=\"ghost\" className=\"h-8 w-8 p-0\">\r\n                <span className=\"sr-only\">Mở menu</span>\r\n                <MoreHorizontal className=\"h-4 w-4\" />\r\n              </Button>\r\n            </DropdownMenuTrigger>\r\n            <DropdownMenuContent align=\"end\">\r\n              <DropdownMenuItem onSelect={() => router.push(`/orders/${row.systemId}`)}>\r\n                Xem chi tiết\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onSelect={() => router.push(`/orders/${row.systemId}/edit`)}>\r\n                Sửa\r\n              </DropdownMenuItem>\r\n              \r\n              <DropdownMenuSeparator />\r\n              \r\n              <DropdownMenuItem onSelect={() => printActions?.onPrintOrder?.(row)}>\r\n                In đơn hàng\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem \r\n                onSelect={() => printActions?.onPrintPacking?.(row)}\r\n                disabled={!hasPackaging}\r\n              >\r\n                In phiếu đóng gói\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem \r\n                onSelect={() => printActions?.onPrintShippingLabel?.(row)}\r\n                disabled={!hasConfirmedPackaging}\r\n              >\r\n                In nhãn giao hàng\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem \r\n                onSelect={() => printActions?.onPrintDelivery?.(row)}\r\n                disabled={!hasConfirmedPackaging}\r\n              >\r\n                In phiếu giao hàng\r\n              </DropdownMenuItem>\r\n              \r\n              <DropdownMenuSeparator />\r\n              \r\n              <DropdownMenuItem className=\"text-destructive\" onSelect={() => onCancel(row.systemId)}>\r\n                Hủy đơn hàng\r\n              </DropdownMenuItem>\r\n            </DropdownMenuContent>\r\n          </DropdownMenu>\r\n       </div>\r\n      );\r\n    },\r\n    meta: {\r\n      displayName: \"Hành động\",\r\n      sticky: \"right\",\r\n    },\r\n    size: 90,\r\n  },\r\n];\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 988, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/orders/order-card.tsx"],"sourcesContent":["'use client'\r\n\r\nimport * as React from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { Badge } from '../../components/ui/badge';\r\nimport { StatusBadge, ORDER_MAIN_STATUS_MAP, PAYMENT_STATUS_MAP, DELIVERY_STATUS_MAP } from '../../components/StatusBadge';\r\nimport { TouchButton } from '../../components/mobile/touch-button';\r\nimport { \r\n  User, \r\n  Calendar, \r\n  Building2, \r\n  DollarSign,\r\n  Package,\r\n  Truck,\r\n  Printer,\r\n  MoreVertical\r\n} from 'lucide-react';\r\nimport type { Order } from './types';\r\nimport { formatDate } from '../../lib/date-utils';\r\n\r\nconst formatCurrency = (value?: number) => {\r\n  if (typeof value !== 'number') return '0 ₫';\r\n  return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(value);\r\n};\r\n\r\ninterface OrderCardProps {\r\n  order: Order;\r\n  onCancel?: (systemId: string) => void;\r\n}\r\n\r\nexport function OrderCard({ order, onCancel }: OrderCardProps) {\r\n  const router = useRouter();\r\n\r\n  const totalPaid = (order.payments || []).reduce((sum, p) => sum + p.amount, 0);\r\n  const remaining = order.grandTotal - totalPaid;\r\n\r\n  return (\r\n    <div \r\n      className=\"bg-card rounded-lg border p-4 space-y-3 hover:shadow-md transition-shadow\"\r\n      onClick={() => router.push(`/orders/${order.systemId}`)}\r\n    >\r\n      {/* Header: Code + Status */}\r\n      <div className=\"flex items-start justify-between\">\r\n        <div className=\"space-y-1\">\r\n          <div className=\"font-mono font-semibold text-body-sm\">{order.id}</div>\r\n          <StatusBadge status={order.status} statusMap={ORDER_MAIN_STATUS_MAP} />\r\n        </div>\r\n        <TouchButton\r\n          variant=\"ghost\"\r\n          size=\"sm\"\r\n          onClick={(e) => {\r\n            e.stopPropagation();\r\n          }}\r\n          className=\"h-8 w-8 p-0\"\r\n        >\r\n          <MoreVertical className=\"h-4 w-4\" />\r\n        </TouchButton>\r\n      </div>\r\n\r\n      {/* Customer Info */}\r\n      <div className=\"space-y-2\">\r\n        <div className=\"flex items-center gap-2 text-body-sm\">\r\n          <User className=\"h-4 w-4 text-muted-foreground\" />\r\n          <span className=\"font-medium\">{order.customerName}</span>\r\n        </div>\r\n        \r\n        <div className=\"flex items-center gap-2 text-body-sm text-muted-foreground\">\r\n          <Calendar className=\"h-4 w-4\" />\r\n          <span>{formatDate(order.orderDate)}</span>\r\n        </div>\r\n\r\n        {order.branchName && (\r\n          <div className=\"flex items-center gap-2 text-body-sm text-muted-foreground\">\r\n            <Building2 className=\"h-4 w-4\" />\r\n            <span>{order.branchName}</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Status Badges */}\r\n      <div className=\"flex flex-wrap gap-2\">\r\n        <StatusBadge status={order.paymentStatus} statusMap={PAYMENT_STATUS_MAP} className=\"text-body-xs\" />\r\n        <StatusBadge status={order.deliveryStatus} statusMap={DELIVERY_STATUS_MAP} className=\"text-body-xs\" />\r\n      </div>\r\n\r\n      {/* Financial Info */}\r\n      <div className=\"pt-2 border-t space-y-1\">\r\n        <div className=\"flex justify-between text-body-sm\">\r\n          <span className=\"text-muted-foreground\">Tổng tiền:</span>\r\n          <span className=\"font-semibold\">{formatCurrency(order.grandTotal)}</span>\r\n        </div>\r\n        <div className=\"flex justify-between text-body-sm\">\r\n          <span className=\"text-muted-foreground\">Đã thanh toán:</span>\r\n          <span className=\"text-green-600\">{formatCurrency(totalPaid)}</span>\r\n        </div>\r\n        {remaining > 0 && (\r\n          <div className=\"flex justify-between text-body-sm\">\r\n            <span className=\"text-muted-foreground\">Còn lại:</span>\r\n            <span className=\"font-semibold text-destructive\">{formatCurrency(remaining)}</span>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Salesperson */}\r\n      {order.salesperson && (\r\n        <div className=\"text-body-xs text-muted-foreground\">\r\n          NV: {order.salesperson}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAGA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAWA;;;AAlBA;;;;;;AAoBA,MAAM,iBAAiB,CAAC;IACtB,IAAI,OAAO,UAAU,UAAU,OAAO;IACtC,OAAO,IAAI,KAAK,YAAY,CAAC,SAAS;QAAE,OAAO;QAAY,UAAU;IAAM,GAAG,MAAM,CAAC;AACvF;AAOO,SAAS,UAAU,EAAE,KAAK,EAAE,QAAQ,EAAkB;;IAC3D,MAAM,SAAS,IAAA,kJAAS;IAExB,MAAM,YAAY,CAAC,MAAM,QAAQ,IAAI,EAAE,EAAE,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,MAAM,EAAE;IAC5E,MAAM,YAAY,MAAM,UAAU,GAAG;IAErC,qBACE,6LAAC;QACC,WAAU;QACV,SAAS,IAAM,OAAO,IAAI,CAAC,CAAC,QAAQ,EAAE,MAAM,QAAQ,EAAE;;0BAGtD,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAI,WAAU;0CAAwC,MAAM,EAAE;;;;;;0CAC/D,6LAAC,4IAAW;gCAAC,QAAQ,MAAM,MAAM;gCAAE,WAAW,sJAAqB;;;;;;;;;;;;kCAErE,6LAAC,0JAAW;wBACV,SAAQ;wBACR,MAAK;wBACL,SAAS,CAAC;4BACR,EAAE,eAAe;wBACnB;wBACA,WAAU;kCAEV,cAAA,6LAAC,6OAAY;4BAAC,WAAU;;;;;;;;;;;;;;;;;0BAK5B,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;0CACb,6LAAC,6MAAI;gCAAC,WAAU;;;;;;0CAChB,6LAAC;gCAAK,WAAU;0CAAe,MAAM,YAAY;;;;;;;;;;;;kCAGnD,6LAAC;wBAAI,WAAU;;0CACb,6LAAC,yNAAQ;gCAAC,WAAU;;;;;;0CACpB,6LAAC;0CAAM,IAAA,qIAAU,EAAC,MAAM,SAAS;;;;;;;;;;;;oBAGlC,MAAM,UAAU,kBACf,6LAAC;wBAAI,WAAU;;0CACb,6LAAC,gOAAS;gCAAC,WAAU;;;;;;0CACrB,6LAAC;0CAAM,MAAM,UAAU;;;;;;;;;;;;;;;;;;0BAM7B,6LAAC;gBAAI,WAAU;;kCACb,6LAAC,4IAAW;wBAAC,QAAQ,MAAM,aAAa;wBAAE,WAAW,mJAAkB;wBAAE,WAAU;;;;;;kCACnF,6LAAC,4IAAW;wBAAC,QAAQ,MAAM,cAAc;wBAAE,WAAW,oJAAmB;wBAAE,WAAU;;;;;;;;;;;;0BAIvF,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAK,WAAU;0CAAwB;;;;;;0CACxC,6LAAC;gCAAK,WAAU;0CAAiB,eAAe,MAAM,UAAU;;;;;;;;;;;;kCAElE,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAK,WAAU;0CAAwB;;;;;;0CACxC,6LAAC;gCAAK,WAAU;0CAAkB,eAAe;;;;;;;;;;;;oBAElD,YAAY,mBACX,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAK,WAAU;0CAAwB;;;;;;0CACxC,6LAAC;gCAAK,WAAU;0CAAkC,eAAe;;;;;;;;;;;;;;;;;;YAMtE,MAAM,WAAW,kBAChB,6LAAC;gBAAI,WAAU;;oBAAqC;oBAC7C,MAAM,WAAW;;;;;;;;;;;;;AAKhC;GAjFgB;;QACC,kJAAS;;;KADV"}},
    {"offset": {"line": 1301, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/orders/address-utils.ts"],"sourcesContent":["import type { OrderAddress } from './types';\r\n\r\nexport const formatOrderAddress = (address?: string | OrderAddress | null): string => {\r\n    if (!address) return '';\r\n    if (typeof address === 'string') {\r\n        return address;\r\n    }\r\n\r\n    if (address.formattedAddress) {\r\n        return address.formattedAddress;\r\n    }\r\n\r\n    return [\r\n        address.street,\r\n        address.ward,\r\n        address.district,\r\n        address.province\r\n    ].filter(Boolean).join(', ');\r\n};\r\n\r\nconst hasAddressValue = (value?: string | null) => typeof value === 'string' && value.trim().length > 0;\r\n\r\nexport const cloneOrderAddress = (address?: any | null): OrderAddress | undefined => {\r\n    if (!address) return undefined;\r\n\r\n    if (typeof address === 'string') {\r\n        const normalized = address.trim();\r\n        return normalized ? { street: normalized, formattedAddress: normalized } : undefined;\r\n    }\r\n\r\n    if (typeof address !== 'object') {\r\n        return undefined;\r\n    }\r\n\r\n    const snapshot: OrderAddress = {\r\n        street: address.street,\r\n        ward: address.ward,\r\n        district: address.district,\r\n        province: address.province,\r\n        contactName: address.contactName,\r\n        company: address.company,\r\n        note: address.note ?? address.notes,\r\n        id: address.id,\r\n        label: address.label,\r\n        provinceId: address.provinceId,\r\n        districtId: address.districtId,\r\n        wardId: address.wardId,\r\n    };\r\n\r\n    const phoneValue = address.phone ?? address.contactPhone;\r\n    if (hasAddressValue(phoneValue)) {\r\n        snapshot.phone = phoneValue;\r\n        snapshot.contactPhone = phoneValue;\r\n    }\r\n\r\n    const formatted = formatOrderAddress(snapshot);\r\n    if (hasAddressValue(formatted)) {\r\n        snapshot.formattedAddress = formatted;\r\n    } else if (hasAddressValue(address.formattedAddress)) {\r\n        snapshot.formattedAddress = address.formattedAddress;\r\n    }\r\n\r\n    return snapshot;\r\n};\r\n"],"names":[],"mappings":";;;;;;AAEO,MAAM,qBAAqB,CAAC;IAC/B,IAAI,CAAC,SAAS,OAAO;IACrB,IAAI,OAAO,YAAY,UAAU;QAC7B,OAAO;IACX;IAEA,IAAI,QAAQ,gBAAgB,EAAE;QAC1B,OAAO,QAAQ,gBAAgB;IACnC;IAEA,OAAO;QACH,QAAQ,MAAM;QACd,QAAQ,IAAI;QACZ,QAAQ,QAAQ;QAChB,QAAQ,QAAQ;KACnB,CAAC,MAAM,CAAC,SAAS,IAAI,CAAC;AAC3B;AAEA,MAAM,kBAAkB,CAAC,QAA0B,OAAO,UAAU,YAAY,MAAM,IAAI,GAAG,MAAM,GAAG;AAE/F,MAAM,oBAAoB,CAAC;IAC9B,IAAI,CAAC,SAAS,OAAO;IAErB,IAAI,OAAO,YAAY,UAAU;QAC7B,MAAM,aAAa,QAAQ,IAAI;QAC/B,OAAO,aAAa;YAAE,QAAQ;YAAY,kBAAkB;QAAW,IAAI;IAC/E;IAEA,IAAI,OAAO,YAAY,UAAU;QAC7B,OAAO;IACX;IAEA,MAAM,WAAyB;QAC3B,QAAQ,QAAQ,MAAM;QACtB,MAAM,QAAQ,IAAI;QAClB,UAAU,QAAQ,QAAQ;QAC1B,UAAU,QAAQ,QAAQ;QAC1B,aAAa,QAAQ,WAAW;QAChC,SAAS,QAAQ,OAAO;QACxB,MAAM,QAAQ,IAAI,IAAI,QAAQ,KAAK;QACnC,IAAI,QAAQ,EAAE;QACd,OAAO,QAAQ,KAAK;QACpB,YAAY,QAAQ,UAAU;QAC9B,YAAY,QAAQ,UAAU;QAC9B,QAAQ,QAAQ,MAAM;IAC1B;IAEA,MAAM,aAAa,QAAQ,KAAK,IAAI,QAAQ,YAAY;IACxD,IAAI,gBAAgB,aAAa;QAC7B,SAAS,KAAK,GAAG;QACjB,SAAS,YAAY,GAAG;IAC5B;IAEA,MAAM,YAAY,mBAAmB;IACrC,IAAI,gBAAgB,YAAY;QAC5B,SAAS,gBAAgB,GAAG;IAChC,OAAO,IAAI,gBAAgB,QAAQ,gBAAgB,GAAG;QAClD,SAAS,gBAAgB,GAAG,QAAQ,gBAAgB;IACxD;IAEA,OAAO;AACX"}},
    {"offset": {"line": 1369, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/orders/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport * as React from \"react\"\r\nimport { useRouter, usePathname } from 'next/navigation';\r\nimport { useColumnVisibility } from '@/hooks/use-column-visibility';\r\nimport { useAllOrders } from \"./hooks/use-orders\"\r\nimport { useOrderMutations } from \"./hooks/use-order-mutations\"\r\nimport { useOrderActions } from \"./hooks/use-order-actions\"\r\nimport { getColumns } from \"./columns\"\r\nimport { ResponsiveDataTable } from \"../../components/data-table/responsive-data-table\"\r\nimport { DataTableFacetedFilter } from \"../../components/data-table/data-table-faceted-filter\"\r\nimport { DataTableColumnCustomizer } from \"../../components/data-table/data-table-column-toggle\"\r\nimport { GenericImportDialogV2 } from \"../../components/shared/generic-import-dialog-v2\"\r\nimport { GenericExportDialogV2 } from \"../../components/shared/generic-export-dialog-v2\"\r\nimport { orderImportExportConfig, flattenOrdersForExport } from \"../../lib/import-export/configs/order.config\"\r\nimport { sapoOrderImportConfig } from \"../../lib/import-export/configs/order-sapo.config\"\r\nimport type { TemplateType, PaperSize } from \"../settings/printer/types\"\r\nimport type { PrintOptions } from \"../../lib/use-print\"\r\nimport { \r\n  Card, \r\n  CardContent, \r\n} from \"../../components/ui/card\"\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"../../components/ui/alert-dialog\"\r\nimport type { Order, OrderMainStatus, OrderPaymentStatus, OrderDeliveryStatus, OrderPrintStatus, OrderStockOutStatus, OrderReturnStatus } from \"./types\"\r\nimport { Button } from \"../../components/ui/button\"\r\nimport { Label } from \"../../components/ui/label\"\r\nimport { Checkbox } from \"../../components/ui/checkbox\"\r\nimport { Textarea } from \"../../components/ui/textarea\"\r\nimport { PlusCircle, FileText, FileUp, Download } from \"lucide-react\"\r\nimport { PrintOptionsDialog, type PrintOptionsResult, type OrderPrintTemplateType } from \"../../components/shared/print-options-dialog\"\r\nimport Fuse from \"fuse.js\"\r\nimport { usePageHeader } from \"../../contexts/page-header-context\"\r\nimport { useMediaQuery } from \"../../lib/use-media-query\"\r\nimport { OrderCard } from \"./order-card\"\r\nimport { PageFilters } from \"../../components/layout/page-filters\"\r\nimport { PageToolbar } from \"../../components/layout/page-toolbar\"\r\n// ✅ REMOVED: import { generateNextId } - not used in this file\r\n// ✅ REMOVED: Unused imports - ProductQuickViewCard and OrderFormDialog (components don't exist and are never used)\r\nimport { toast } from \"sonner\"\r\nimport { useAuth } from \"../../contexts/auth-context\"\r\nimport { asBusinessId, asSystemId, type SystemId } from \"../../lib/id-types\"\r\n// Print imports\r\nimport { usePrint } from \"../../lib/use-print\"\r\nimport { useCustomers } from \"../customers/hooks/use-customers\"\r\nimport { useAllBranches } from \"../settings/branches/hooks/use-branches\"\r\nimport { useProducts } from \"../products/hooks/use-products\"\r\nimport { useAllEmployees } from \"../employees/hooks/use-employees\"\r\nimport { \r\n  convertOrderForPrint,\r\n  convertPackagingToDeliveryForPrint,\r\n  convertToShippingLabelForPrint,\r\n  convertToPackingForPrint,\r\n  mapOrderToPrintData,\r\n  mapOrderLineItems,\r\n  mapDeliveryToPrintData,\r\n  mapDeliveryLineItems,\r\n  mapShippingLabelToPrintData,\r\n  mapPackingToPrintData,\r\n  mapPackingLineItems,\r\n  createStoreSettings,\r\n} from \"../../lib/print/order-print-helper\"\r\n\r\n\r\nconst statusOptions = (Object.keys({\r\n    \"Đặt hàng\": \"\", \"Đang giao dịch\": \"\", \"Hoàn thành\": \"\", \"Đã hủy\": \"\"\r\n}) as OrderMainStatus[]).map(status => ({\r\n    value: status,\r\n    label: status,\r\n}));\r\n\r\nexport function OrdersPage() {\r\n  // React Query hooks\r\n  const { data: ordersData } = useAllOrders();\r\n  const orders: Order[] = ordersData ?? [];\r\n  const { create: createOrderMutation, update: updateOrderMutation, remove: deleteOrderMutation } = useOrderMutations();\r\n  // ⚠️ Still needed for complex cancelOrder action (uncommit stock, refund, etc.)\r\n  const orderStore = useOrderStore();\r\n  \r\n  const router = useRouter();\r\n  const pathname = usePathname();\r\n  const { employee: authEmployee } = useAuth();\r\n  const currentEmployeeName = authEmployee?.fullName ?? 'Hệ thống';\r\n  const currentEmployeeSystemId: SystemId = authEmployee?.systemId ?? asSystemId('SYSTEM');\r\n  const isMobile = useMediaQuery(\"(max-width: 768px)\");\r\n  \r\n  // Data for print and import lookup\r\n  const { data: customersData } = useCustomers();\r\n  const customers = customersData?.data || [];\r\n  const { data: branchesData } = useAllBranches();\r\n  const branches = branchesData?.data || [];\r\n  const { data: productsData } = useProducts();\r\n  const products = productsData?.data || [];\r\n  const { data: employeesData } = useAllEmployees();\r\n  const employees = employeesData || [];\r\n  \r\n  // Helper functions\r\n  const findCustomerById = React.useCallback((systemId: string) => {\r\n    return customers.find(c => c.systemId === systemId);\r\n  }, [customers]);\r\n  \r\n  const findBranchById = React.useCallback((systemId: string) => {\r\n    return branches.find(b => b.systemId === systemId);\r\n  }, [branches]);\r\n  \r\n  const { print, printMultiple, printMixedDocuments } = usePrint();\r\n  \r\n  const [rowSelection, setRowSelection] = React.useState<Record<string, boolean>>({})\r\n  const [isCancelAlertOpen, setIsCancelAlertOpen] = React.useState(false)\r\n  const [idToCancel, setIdToCancel] = React.useState<SystemId | null>(null)\r\n  const [cancelReason, setCancelReason] = React.useState('')\r\n  const [restockItems, setRestockItems] = React.useState(true)\r\n\r\n  // Print options dialog state\r\n  const [isPrintDialogOpen, setIsPrintDialogOpen] = React.useState(false)\r\n  const [pendingPrintOrders, setPendingPrintOrders] = React.useState<Order[]>([])\r\n  const [initialPrintTemplateType, setInitialPrintTemplateType] = React.useState<OrderPrintTemplateType>('order')\r\n\r\n  // Import/Export dialog states\r\n  const [isImportOpen, setIsImportOpen] = React.useState(false)\r\n  const [isExportOpen, setIsExportOpen] = React.useState(false)\r\n  const [isSapoImportOpen, setIsSapoImportOpen] = React.useState(false)\r\n\r\n  const resetCancelForm = React.useCallback(() => {\r\n    setCancelReason('')\r\n    setRestockItems(true)\r\n  }, [])\r\n\r\n  React.useEffect(() => {\r\n    if (!isCancelAlertOpen) {\r\n      resetCancelForm()\r\n    }\r\n  }, [isCancelAlertOpen, resetCancelForm])\r\n  \r\n  // Table state - Sort by systemId (newer orders have higher systemId)\r\n  const [sorting, setSorting] = React.useState<{ id: string, desc: boolean }>({ id: 'createdAt', desc: true });\r\n  const [searchQuery, setSearchQuery] = React.useState('');\r\n  const [statusFilter, setStatusFilter] = React.useState<Set<string>>(new Set());\r\n  const [pagination, setPagination] = React.useState({ pageIndex: 0, pageSize: 20 });\r\n  const [columnVisibility, setColumnVisibility, isColumnVisibilityLoading] = useColumnVisibility('orders', {});\r\n  \r\n  const [columnOrder, setColumnOrder] = React.useState<string[]>([]);\r\n  const [pinnedColumns, setPinnedColumns] = React.useState<string[]>(['select', 'id']);\r\n  \r\n  // Mobile infinite scroll\r\n  const [mobileLoadedCount, setMobileLoadedCount] = React.useState(20);\r\n\r\n  // Note: For URL search params, use useSearchParams() from next/navigation if needed\r\n  // React.useEffect(() => {\r\n  //   const params = new URLSearchParams(window.location.search);\r\n  //   const status = params.get('status');\r\n  //   if (status) {\r\n  //     setStatusFilter(new Set([status]));\r\n  //   }\r\n  // }, []);\r\n  \r\n  // Reset mobile count when filters change\r\n  React.useEffect(() => {\r\n    setMobileLoadedCount(20);\r\n  }, [searchQuery, statusFilter]);\r\n\r\n  const handleCancelRequest = React.useCallback((systemId: SystemId) => {\r\n    setIdToCancel(systemId)\r\n    setIsCancelAlertOpen(true)\r\n  }, [])\r\n\r\n  const orderPendingCancel = React.useMemo(() => {\r\n    if (!idToCancel) return null\r\n    return orders.find(order => order.systemId === idToCancel) ?? null\r\n  }, [idToCancel, orders])\r\n\r\n  const pendingCancelQuantity = React.useMemo(() => {\r\n    if (!orderPendingCancel) return 0\r\n    return orderPendingCancel.lineItems.reduce((sum, item) => sum + item.quantity, 0)\r\n  }, [orderPendingCancel])\r\n  \r\n  // === PRINT HANDLERS ===\r\n  const handlePrintOrder = React.useCallback((order: Order) => {\r\n    const customer = findCustomerById(order.customerSystemId);\r\n    const branch = findBranchById(order.branchSystemId);\r\n    const storeSettings = createStoreSettings(branch);\r\n    const orderData = convertOrderForPrint(order, { customer });\r\n    \r\n    print('order', {\r\n      data: mapOrderToPrintData(orderData, storeSettings),\r\n      lineItems: mapOrderLineItems(orderData.items),\r\n    });\r\n    toast.success(`Đang in đơn hàng ${order.id}`);\r\n  }, [findCustomerById, findBranchById, print]);\r\n\r\n  const handlePrintPacking = React.useCallback((order: Order) => {\r\n    const packaging = order.packagings?.[order.packagings.length - 1];\r\n    if (!packaging) {\r\n      toast.error('Đơn hàng chưa có phiếu đóng gói');\r\n      return;\r\n    }\r\n    \r\n    const customer = findCustomerById(order.customerSystemId);\r\n    const branch = findBranchById(order.branchSystemId);\r\n    const storeSettings = createStoreSettings(branch);\r\n    const packingData = convertToPackingForPrint(order, packaging, { customer });\r\n    \r\n    print('packing', {\r\n      data: mapPackingToPrintData(packingData, storeSettings),\r\n      lineItems: mapPackingLineItems(packingData.items),\r\n    });\r\n    toast.success(`Đang in phiếu đóng gói ${packaging.id}`);\r\n  }, [findCustomerById, findBranchById, print]);\r\n\r\n  const handlePrintShippingLabel = React.useCallback((order: Order) => {\r\n    const packaging = order.packagings?.find(p => p.status === 'Đã đóng gói');\r\n    if (!packaging) {\r\n      toast.error('Đơn hàng chưa có đóng gói xác nhận');\r\n      return;\r\n    }\r\n    \r\n    const customer = findCustomerById(order.customerSystemId);\r\n    const branch = findBranchById(order.branchSystemId);\r\n    const storeSettings = createStoreSettings(branch);\r\n    const labelData = convertToShippingLabelForPrint(order, packaging, { customer });\r\n    \r\n    print('shipping-label', {\r\n      data: mapShippingLabelToPrintData(labelData, storeSettings),\r\n    });\r\n    toast.success(`Đang in nhãn giao hàng ${order.id}`);\r\n  }, [findCustomerById, findBranchById, print]);\r\n\r\n  const handlePrintDelivery = React.useCallback((order: Order) => {\r\n    const packaging = order.packagings?.find(p => p.status === 'Đã đóng gói');\r\n    if (!packaging) {\r\n      toast.error('Đơn hàng chưa có đóng gói xác nhận');\r\n      return;\r\n    }\r\n    \r\n    const customer = findCustomerById(order.customerSystemId);\r\n    const branch = findBranchById(order.branchSystemId);\r\n    const storeSettings = createStoreSettings(branch);\r\n    const deliveryData = convertPackagingToDeliveryForPrint(order, packaging, { customer });\r\n    \r\n    print('delivery', {\r\n      data: mapDeliveryToPrintData(deliveryData, storeSettings),\r\n      lineItems: mapDeliveryLineItems(deliveryData.items),\r\n    });\r\n    toast.success(`Đang in phiếu giao hàng ${order.id}`);\r\n  }, [findCustomerById, findBranchById, print]);\r\n\r\n  const printActions = React.useMemo(() => ({\r\n    onPrintOrder: handlePrintOrder,\r\n    onPrintPacking: handlePrintPacking,\r\n    onPrintShippingLabel: handlePrintShippingLabel,\r\n    onPrintDelivery: handlePrintDelivery,\r\n  }), [handlePrintOrder, handlePrintPacking, handlePrintShippingLabel, handlePrintDelivery]);\r\n  \r\n  const columns = React.useMemo(() => getColumns(handleCancelRequest, router, printActions), [handleCancelRequest, router, printActions]);\r\n  \r\n  // Set default visible columns only once when loaded from DB and visibility is empty\r\n  const hasInitializedVisibility = React.useRef(false);\r\n  React.useEffect(() => {\r\n    // Skip if still loading or already initialized\r\n    if (isColumnVisibilityLoading || hasInitializedVisibility.current) {\r\n      return;\r\n    }\r\n    \r\n    // Only set defaults if no saved visibility exists\r\n    const hasExistingVisibility = Object.keys(columnVisibility).length > 0;\r\n    if (hasExistingVisibility) {\r\n      hasInitializedVisibility.current = true;\r\n      return;\r\n    }\r\n    \r\n    const defaultVisibleColumns = [\r\n      'id', 'customerName', 'orderDate', 'branchName', 'salesperson', \r\n      'grandTotal', 'totalPaid', 'debt', 'codAmount', 'status', \r\n      'paymentStatus', 'packagingStatus', 'deliveryStatus', 'printStatus', 'stockOutStatus'\r\n    ];\r\n    const initialVisibility: Record<string, boolean> = {};\r\n    columns.forEach(c => {\r\n      if (c.id === 'select' || c.id === 'actions') {\r\n        initialVisibility[c.id!] = true;\r\n      } else {\r\n        initialVisibility[c.id!] = defaultVisibleColumns.includes(c.id!);\r\n      }\r\n    });\r\n    setColumnVisibility(initialVisibility);\r\n    setColumnOrder(columns.map(c => c.id).filter(Boolean) as string[]);\r\n    hasInitializedVisibility.current = true;\r\n  }, [columns, isColumnVisibilityLoading, columnVisibility, setColumnVisibility]);\r\n\r\n  const fuse = React.useMemo(() => new Fuse(orders, { \r\n    keys: [\"id\", \"customerName\", \"salesperson\"],\r\n    threshold: 0.3 \r\n  }), [orders]);\r\n  \r\n  const confirmCancel = () => {\r\n    if (!idToCancel) return\r\n\r\n    if (!orderPendingCancel) {\r\n      toast.error('Không tìm thấy đơn hàng cần hủy. Vui lòng tải lại danh sách.')\r\n      setIsCancelAlertOpen(false)\r\n      return\r\n    }\r\n\r\n    const finalReason = cancelReason.trim()\r\n    if (!finalReason) {\r\n      toast.error('Vui lòng nhập lý do hủy đơn hàng.')\r\n      return\r\n    }\r\n\r\n    // Update order status via mutation\r\n    updateOrderMutation.mutate({\r\n      id: idToCancel,\r\n      data: {\r\n        status: 'Đã hủy',\r\n        cancelledDate: new Date().toISOString(),\r\n        cancellationReason: finalReason,\r\n        deliveryStatus: 'Đã hủy',\r\n        stockOutStatus: restockItems ? 'Chưa xuất kho' : orderPendingCancel.stockOutStatus,\r\n        cancellationMetadata: {\r\n          restockItems,\r\n          notifyCustomer: false,\r\n        },\r\n      }\r\n    }, {\r\n      onSuccess: () => {\r\n        toast.success(`Đơn ${orderPendingCancel.id} đã được cập nhật trạng thái hủy.`)\r\n      },\r\n      onError: () => {\r\n        toast.error('Không thể hủy đơn hàng. Vui lòng thử lại.')\r\n      }\r\n    });\r\n    \r\n    setIsCancelAlertOpen(false)\r\n    setIdToCancel(null)\r\n    resetCancelForm()\r\n  }\r\n  \r\n  const filteredData = React.useMemo(() => {\r\n    let data = orders;\r\n    \r\n    // Search\r\n    if (searchQuery) {\r\n      data = fuse.search(searchQuery).map(result => result.item);\r\n    }\r\n    \r\n    // Status filter\r\n    if (statusFilter.size > 0) {\r\n      data = data.filter(order => statusFilter.has(order.status));\r\n    }\r\n    \r\n    return data;\r\n  }, [orders, searchQuery, fuse, statusFilter]);\r\n  \r\n  const sortedData = React.useMemo(() => {\r\n    const sorted = [...filteredData];\r\n    if (sorting.id) {\r\n      sorted.sort((a, b) => {\r\n        const aValue = (a as any)[sorting.id];\r\n        const bValue = (b as any)[sorting.id];\r\n        // Special handling for date columns - parse as Date for proper comparison\r\n        if (sorting.id === 'createdAt' || sorting.id === 'orderDate') {\r\n          const aTime = aValue ? new Date(aValue).getTime() : 0;\r\n          const bTime = bValue ? new Date(bValue).getTime() : 0;\r\n          return sorting.desc ? bTime - aTime : aTime - bTime;\r\n        }\r\n        if (aValue < bValue) return sorting.desc ? 1 : -1;\r\n        if (aValue > bValue) return sorting.desc ? -1 : 1;\r\n        return 0;\r\n      });\r\n    }\r\n    return sorted;\r\n  }, [filteredData, sorting]);\r\n\r\n  const pageCount = Math.ceil(sortedData.length / pagination.pageSize);\r\n  const paginatedData = React.useMemo(() => {\r\n    const start = pagination.pageIndex * pagination.pageSize;\r\n    const end = start + pagination.pageSize;\r\n    return sortedData.slice(start, end);\r\n  }, [sortedData, pagination]);\r\n  \r\n  // Mobile: Display data with infinite scroll\r\n  const displayData = isMobile \r\n    ? sortedData.slice(0, mobileLoadedCount)\r\n    : paginatedData;\r\n  \r\n  const allSelectedRows = React.useMemo(() => \r\n    sortedData.filter(o => rowSelection[o.systemId]),\r\n  [sortedData, rowSelection]);\r\n  \r\n  // Mobile infinite scroll listener\r\n  React.useEffect(() => {\r\n    if (!isMobile) return;\r\n\r\n    const handleScroll = () => {\r\n      const scrollPosition = window.scrollY + window.innerHeight;\r\n      const documentHeight = document.documentElement.scrollHeight;\r\n      const scrollPercentage = (scrollPosition / documentHeight) * 100;\r\n\r\n      if (scrollPercentage > 80 && mobileLoadedCount < sortedData.length) {\r\n        setMobileLoadedCount(prev => Math.min(prev + 20, sortedData.length));\r\n      }\r\n    };\r\n\r\n    window.addEventListener('scroll', handleScroll);\r\n    return () => window.removeEventListener('scroll', handleScroll);\r\n  }, [isMobile, mobileLoadedCount, sortedData.length]);\r\n\r\n  const handleRowClick = (row: Order) => {\r\n    router.push(`/orders/${row.systemId}`);\r\n  };\r\n  \r\n  const handleBulkDelete = React.useCallback(() => {\r\n    if (allSelectedRows.length === 0) return;\r\n    \r\n    const confirmMessage = `Bạn có chắc muốn hủy ${allSelectedRows.length} đơn hàng đã chọn?`;\r\n    if (!confirm(confirmMessage)) return;\r\n    \r\n    allSelectedRows.forEach(order => {\r\n      (orderStore as any).cancelOrder(order.systemId, currentEmployeeSystemId, {\r\n        reason: 'Hủy hàng loạt',\r\n        restock: true,\r\n      });\r\n    });\r\n    \r\n    setRowSelection({});\r\n  }, [allSelectedRows, orderStore, currentEmployeeSystemId]);\r\n  \r\n  // === BULK PRINT HANDLERS - Mở dialog với initial template type ===\r\n  const handleBulkPrintWithOptions = React.useCallback((selectedRows: Order[], templateType: OrderPrintTemplateType = 'order') => {\r\n    setPendingPrintOrders(selectedRows);\r\n    setInitialPrintTemplateType(templateType);\r\n    setIsPrintDialogOpen(true);\r\n  }, []);\r\n\r\n  // Xử lý khi xác nhận tùy chọn in từ dialog\r\n  const handlePrintConfirm = React.useCallback((options: PrintOptionsResult) => {\r\n    const { branchSystemId, paperSize, printOrder, printDelivery, printPacking, printShippingLabel } = options;\r\n    const ordersToProcess = pendingPrintOrders;\r\n    const printMessages: string[] = [];\r\n\r\n    // Mảng chứa tất cả documents để in gộp 1 lần\r\n    const allDocuments: Array<{ type: TemplateType; options: PrintOptions }> = [];\r\n\r\n    // Helper để tạo print options cho order\r\n    const createOrderPrintOptions = (order: Order) => {\r\n      const customer = findCustomerById(order.customerSystemId);\r\n      const branch = branchSystemId \r\n        ? findBranchById(branchSystemId)\r\n        : findBranchById(order.branchSystemId);\r\n      const storeSettings = createStoreSettings(branch);\r\n      const orderData = convertOrderForPrint(order, { customer });\r\n      \r\n      return {\r\n        data: mapOrderToPrintData(orderData, storeSettings),\r\n        lineItems: mapOrderLineItems(orderData.items),\r\n        paperSize,\r\n      };\r\n    };\r\n\r\n    // Helper để tạo print options cho delivery\r\n    const createDeliveryPrintOptions = (order: Order) => {\r\n      const packaging = order.packagings?.find(p => p.status === 'Đã đóng gói') \r\n        ?? order.packagings?.[order.packagings.length - 1];\r\n      if (!packaging) return null;\r\n\r\n      const customer = findCustomerById(order.customerSystemId);\r\n      const branch = branchSystemId \r\n        ? findBranchById(branchSystemId)\r\n        : findBranchById(order.branchSystemId);\r\n      const storeSettings = createStoreSettings(branch);\r\n      const deliveryData = convertPackagingToDeliveryForPrint(order, packaging, { customer });\r\n      \r\n      return {\r\n        data: mapDeliveryToPrintData(deliveryData, storeSettings),\r\n        lineItems: mapDeliveryLineItems(deliveryData.items),\r\n        paperSize,\r\n      };\r\n    };\r\n\r\n    // Helper để tạo print options cho packing\r\n    const createPackingPrintOptions = (order: Order) => {\r\n      const packaging = order.packagings?.[order.packagings.length - 1];\r\n      if (!packaging) return null;\r\n\r\n      const customer = findCustomerById(order.customerSystemId);\r\n      const branch = branchSystemId \r\n        ? findBranchById(branchSystemId)\r\n        : findBranchById(order.branchSystemId);\r\n      const storeSettings = createStoreSettings(branch);\r\n      const packingData = convertToPackingForPrint(order, packaging, { customer });\r\n      \r\n      return {\r\n        data: mapPackingToPrintData(packingData, storeSettings),\r\n        lineItems: mapPackingLineItems(packingData.items),\r\n        paperSize,\r\n      };\r\n    };\r\n\r\n    // Helper để tạo print options cho shipping label\r\n    const createShippingLabelPrintOptions = (order: Order) => {\r\n      const packaging = order.packagings?.find(p => p.status === 'Đã đóng gói');\r\n      if (!packaging) return null;\r\n\r\n      const customer = findCustomerById(order.customerSystemId);\r\n      const branch = branchSystemId \r\n        ? findBranchById(branchSystemId)\r\n        : findBranchById(order.branchSystemId);\r\n      const storeSettings = createStoreSettings(branch);\r\n      const labelData = convertToShippingLabelForPrint(order, packaging, { customer });\r\n      \r\n      return {\r\n        data: mapShippingLabelToPrintData(labelData, storeSettings),\r\n        paperSize,\r\n      };\r\n    };\r\n\r\n    // Thu thập tất cả documents cần in\r\n    ordersToProcess.forEach(order => {\r\n      // In đơn hàng\r\n      if (printOrder) {\r\n        const printOptions = createOrderPrintOptions(order);\r\n        allDocuments.push({ type: 'order', options: printOptions });\r\n      }\r\n\r\n      // In phiếu đóng gói\r\n      if (printPacking && order.packagings?.length > 0) {\r\n        const printOptions = createPackingPrintOptions(order);\r\n        if (printOptions) {\r\n          allDocuments.push({ type: 'packing', options: printOptions });\r\n        }\r\n      }\r\n\r\n      // In phiếu giao hàng\r\n      if (printDelivery && order.packagings?.length > 0) {\r\n        const printOptions = createDeliveryPrintOptions(order);\r\n        if (printOptions) {\r\n          allDocuments.push({ type: 'delivery', options: printOptions });\r\n        }\r\n      }\r\n\r\n      // In nhãn giao hàng\r\n      if (printShippingLabel && order.packagings?.some(p => p.status === 'Đã đóng gói')) {\r\n        const printOptions = createShippingLabelPrintOptions(order);\r\n        if (printOptions) {\r\n          allDocuments.push({ type: 'shipping-label', options: printOptions });\r\n        }\r\n      }\r\n    });\r\n\r\n    // Tạo message thống kê\r\n    if (printOrder) printMessages.push(`${ordersToProcess.length} đơn hàng`);\r\n    const ordersWithPackaging = ordersToProcess.filter(o => o.packagings?.length > 0);\r\n    if (printPacking && ordersWithPackaging.length > 0) printMessages.push(`${ordersWithPackaging.length} phiếu đóng gói`);\r\n    if (printDelivery && ordersWithPackaging.length > 0) printMessages.push(`${ordersWithPackaging.length} phiếu giao hàng`);\r\n    const ordersWithConfirmedPackaging = ordersToProcess.filter(o => o.packagings?.some(p => p.status === 'Đã đóng gói'));\r\n    if (printShippingLabel && ordersWithConfirmedPackaging.length > 0) printMessages.push(`${ordersWithConfirmedPackaging.length} nhãn giao hàng`);\r\n\r\n    // In gộp 1 lần duy nhất\r\n    if (allDocuments.length > 0) {\r\n      printMixedDocuments(allDocuments);\r\n      toast.success(`Đang in ${printMessages.join(', ')}`);\r\n    } else {\r\n      toast.error('Không có dữ liệu phù hợp để in');\r\n    }\r\n\r\n    // Reset state\r\n    setPendingPrintOrders([]);\r\n  }, [pendingPrintOrders, findCustomerById, findBranchById, printMixedDocuments]);\r\n\r\n  // Bulk Actions for DataTable - Gộp thành 1 nút In hàng loạt\r\n  const bulkActions = React.useMemo(() => [\r\n    {\r\n      label: 'In hàng loạt',\r\n      icon: FileText,\r\n      onSelect: (rows: Order[]) => handleBulkPrintWithOptions(rows, 'order'),\r\n    },\r\n  ], [handleBulkPrintWithOptions]);\r\n  \r\n  // Prepare orderImportExportConfig with data context for lookup\r\n  const orderConfigWithStores = React.useMemo(() => ({\r\n    ...orderImportExportConfig,\r\n    storeContext: {\r\n      customers,\r\n      products,\r\n      branches,\r\n      employees,\r\n    },\r\n  }), [customers, products, branches, employees]);\r\n\r\n  // Prepare sapoOrderImportConfig with data context for lookup\r\n  const sapoOrderConfigWithStores = React.useMemo(() => ({\r\n    ...sapoOrderImportConfig,\r\n    storeContext: {\r\n      customers,\r\n      products,\r\n      branches,\r\n      employees,\r\n    },\r\n  }), [customers, products, branches, employees]);\r\n\r\n  // Flatten orders for export (multi-line per product) - cast to Order[] for component compatibility\r\n  const ordersForExport = React.useMemo(() => flattenOrdersForExport(orders) as unknown as Order[], [orders]);\r\n  const filteredOrdersForExport = React.useMemo(() => flattenOrdersForExport(sortedData) as unknown as Order[], [sortedData]);\r\n  const pageOrdersForExport = React.useMemo(() => flattenOrdersForExport(paginatedData) as unknown as Order[], [paginatedData]);\r\n  const selectedOrdersForExport = React.useMemo(() => flattenOrdersForExport(allSelectedRows) as unknown as Order[], [allSelectedRows]);\r\n\r\n  // Import handler for GenericImportDialogV2\r\n  const handleImport = React.useCallback(async (\r\n    data: Partial<Order>[],\r\n    mode: 'insert-only' | 'update-only' | 'upsert',\r\n    branchId?: string\r\n  ) => {\r\n    const results = {\r\n      success: 0,\r\n      failed: 0,\r\n      inserted: 0,\r\n      updated: 0,\r\n      skipped: 0,\r\n      errors: [] as Array<{ row: number; message: string }>,\r\n    };\r\n\r\n    try {\r\n      for (let i = 0; i < data.length; i++) {\r\n        const order = data[i] as Order;\r\n        \r\n        // Tất cả đơn import đều là insert mới\r\n        if (mode === 'update-only') {\r\n          results.skipped++;\r\n          continue;\r\n        }\r\n\r\n        try {\r\n          // Add order via mutation\r\n          await createOrderMutation.mutateAsync(order as any);\r\n          results.inserted++;\r\n          results.success++;\r\n        } catch (err) {\r\n          results.failed++;\r\n          results.errors.push({\r\n            row: i + 1,\r\n            message: err instanceof Error ? err.message : 'Lỗi không xác định',\r\n          });\r\n        }\r\n      }\r\n\r\n      if (results.inserted > 0) {\r\n        toast.success(`Đã nhập ${results.inserted} đơn hàng thành công`);\r\n      }\r\n      if (results.skipped > 0) {\r\n        toast.info(`Bỏ qua ${results.skipped} đơn (chế độ update-only)`);\r\n      }\r\n      if (results.failed > 0) {\r\n        toast.error(`${results.failed} đơn nhập thất bại`);\r\n      }\r\n\r\n      return results;\r\n    } catch (error) {\r\n      console.error('[Orders Import] Error:', error);\r\n      throw error;\r\n    }\r\n  }, [createOrderMutation]);\r\n  \r\n  // Header actions - Chỉ còn nút Tạo đơn hàng\r\n  const headerActions = React.useMemo(() => [\r\n    <Button key=\"add\" size=\"sm\" className=\"h-9\" onClick={() => router.push('/orders/new')}>\r\n      <PlusCircle className=\"mr-2 h-4 w-4\" />\r\n      Tạo đơn hàng\r\n    </Button>\r\n  ], [router]);\r\n  \r\n  usePageHeader({\r\n    title: 'Danh sách đơn hàng',\r\n    breadcrumb: [\r\n      { label: 'Trang chủ', href: '/', isCurrent: false },\r\n      { label: 'Đơn hàng', href: '/orders', isCurrent: true },\r\n    ],\r\n    showBackButton: false,\r\n    actions: headerActions,\r\n  });\r\n\r\n  return (\r\n    <>\r\n      {/* HÀNG 2: TOOLBAR - Export/Import/Column Customizer (Desktop only) */}\r\n      {!isMobile && (\r\n        <PageToolbar\r\n          leftActions={\r\n            <>\r\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setIsImportOpen(true)}>\r\n                <FileUp className=\"mr-2 h-4 w-4\" />\r\n                Nhập file\r\n              </Button>\r\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setIsSapoImportOpen(true)}>\r\n                <FileUp className=\"mr-2 h-4 w-4\" />\r\n                Import Sapo\r\n              </Button>\r\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setIsExportOpen(true)}>\r\n                <Download className=\"mr-2 h-4 w-4\" />\r\n                Xuất Excel\r\n              </Button>\r\n            </>\r\n          }\r\n          rightActions={\r\n            <DataTableColumnCustomizer\r\n              columns={columns}\r\n              columnVisibility={columnVisibility}\r\n              setColumnVisibility={setColumnVisibility}\r\n              columnOrder={columnOrder}\r\n              setColumnOrder={setColumnOrder}\r\n              pinnedColumns={pinnedColumns}\r\n              setPinnedColumns={setPinnedColumns}\r\n            />\r\n          }\r\n        />\r\n      )}\r\n\r\n      {/* HÀNG 3: FILTERS - Search & Status Filter */}\r\n      <PageFilters\r\n        searchValue={searchQuery}\r\n        onSearchChange={setSearchQuery}\r\n        searchPlaceholder=\"Tìm kiếm đơn hàng...\"\r\n      >\r\n        <DataTableFacetedFilter\r\n          title=\"Trạng thái\"\r\n          selectedValues={statusFilter}\r\n          onSelectedValuesChange={setStatusFilter}\r\n          options={[\r\n            { label: 'Đặt hàng', value: 'Đặt hàng' },\r\n            { label: 'Đang giao dịch', value: 'Đang giao dịch' },\r\n            { label: 'Hoàn thành', value: 'Hoàn thành' },\r\n            { label: 'Đã hủy', value: 'Đã hủy' },\r\n          ]}\r\n        />\r\n      </PageFilters>\r\n\r\n      {/* Data Table - Không có padding wrapper */}\r\n      <div className=\"pb-4\">\r\n        <ResponsiveDataTable\r\n        columns={columns}\r\n        data={displayData}\r\n        renderMobileCard={(order) => (\r\n          <OrderCard \r\n            order={order} \r\n            onCancel={handleCancelRequest}\r\n          />\r\n        )}\r\n        pageCount={pageCount}\r\n        pagination={pagination}\r\n        setPagination={setPagination}\r\n        rowCount={sortedData.length}\r\n        rowSelection={rowSelection}\r\n        setRowSelection={setRowSelection}\r\n        allSelectedRows={allSelectedRows}\r\n        onBulkDelete={handleBulkDelete}\r\n        bulkActions={bulkActions}\r\n        sorting={sorting}\r\n        setSorting={setSorting}\r\n        columnVisibility={columnVisibility}\r\n        setColumnVisibility={setColumnVisibility}\r\n        columnOrder={columnOrder}\r\n        setColumnOrder={setColumnOrder}\r\n        pinnedColumns={pinnedColumns}\r\n        setPinnedColumns={setPinnedColumns}\r\n        onRowClick={handleRowClick}\r\n        emptyTitle=\"Không có đơn hàng\"\r\n        emptyDescription=\"Tạo đơn hàng đầu tiên để bắt đầu\"\r\n      />\r\n      </div>\r\n      \r\n      {/* Mobile loading indicator */}\r\n      {isMobile && (\r\n        <div className=\"py-6 text-center\">\r\n          {mobileLoadedCount < sortedData.length ? (\r\n            <div className=\"flex items-center justify-center gap-2 text-muted-foreground\">\r\n              <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent\" />\r\n              <span className=\"text-body-sm\">Đang tải thêm...</span>\r\n            </div>\r\n          ) : sortedData.length > 20 ? (\r\n            <p className=\"text-body-sm text-muted-foreground\">\r\n              Đã hiển thị tất cả {sortedData.length} kết quả\r\n            </p>\r\n          ) : null}\r\n        </div>\r\n      )}\r\n      \r\n      {/* Cancel Alert Dialog */}\r\n      <AlertDialog open={isCancelAlertOpen} onOpenChange={setIsCancelAlertOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Bạn có chắc chắn muốn hủy đơn hàng?</AlertDialogTitle>\r\n            <AlertDialogDescription className=\"space-y-4 text-left\">\r\n              <div className=\"space-y-2 text-body-sm\">\r\n                <p>Thao tác sẽ cập nhật trạng thái đơn thành \"Đã hủy\" và áp dụng các bước sau:</p>\r\n                <ul className=\"ml-4 list-disc space-y-1\">\r\n                  <li>Hoàn kho các sản phẩm (nếu bạn giữ tùy chọn này)</li>\r\n                  <li>Hủy vận đơn và chứng từ liên quan</li>\r\n                  <li>Tính lại công nợ khách hàng và đối tác vận chuyển</li>\r\n                </ul>\r\n              </div>\r\n\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"orders-cancel-reason\" className=\"text-body-sm font-semibold\">\r\n                  Lý do hủy (bắt buộc)\r\n                </Label>\r\n                <Textarea\r\n                  id=\"orders-cancel-reason\"\r\n                  value={cancelReason}\r\n                  onChange={(event) => setCancelReason(event.target.value)}\r\n                  placeholder=\"Nhập rõ lý do hủy để đội vận hành nắm được...\"\r\n                  rows={3}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"space-y-3\">\r\n                <Label className=\"text-body-sm font-semibold\">Tùy chọn bổ sung</Label>\r\n                <div className=\"space-y-2\">\r\n                  <div className=\"flex items-start gap-3 rounded-md border p-3\">\r\n                    <Checkbox\r\n                      id=\"orders-cancel-restock\"\r\n                      checked={restockItems}\r\n                      onCheckedChange={(checked) => setRestockItems(checked === true)}\r\n                    />\r\n                    <div className=\"space-y-1\">\r\n                      <Label htmlFor=\"orders-cancel-restock\" className=\"text-body-sm font-medium\">\r\n                        Hoàn kho {pendingCancelQuantity} sản phẩm\r\n                      </Label>\r\n                      <p className=\"text-body-xs text-muted-foreground\">\r\n                        Nếu bỏ chọn, bạn sẽ tự xử lý tồn kho thủ công.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>Thoát</AlertDialogCancel>\r\n            <AlertDialogAction onClick={confirmCancel}>Xác nhận hủy</AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Print Options Dialog */}\r\n      <PrintOptionsDialog\r\n        open={isPrintDialogOpen}\r\n        onOpenChange={setIsPrintDialogOpen}\r\n        onConfirm={handlePrintConfirm}\r\n        selectedCount={pendingPrintOrders.length}\r\n        initialTemplateType={initialPrintTemplateType}\r\n      />\r\n\r\n      {/* Import Dialog V2 */}\r\n      <GenericImportDialogV2<Order>\r\n        open={isImportOpen}\r\n        onOpenChange={setIsImportOpen}\r\n        config={orderConfigWithStores}\r\n        existingData={orders}\r\n        onImport={handleImport}\r\n        currentUser={authEmployee ? {\r\n          systemId: authEmployee.systemId,\r\n          name: authEmployee.fullName || authEmployee.id,\r\n        } : undefined}\r\n      />\r\n\r\n      {/* Export Dialog V2 */}\r\n      <GenericExportDialogV2<Order>\r\n        open={isExportOpen}\r\n        onOpenChange={setIsExportOpen}\r\n        config={orderImportExportConfig}\r\n        allData={ordersForExport}\r\n        filteredData={filteredOrdersForExport}\r\n        currentPageData={pageOrdersForExport}\r\n        selectedData={selectedOrdersForExport}\r\n        currentUser={authEmployee ? {\r\n          systemId: authEmployee.systemId,\r\n          name: authEmployee.fullName || authEmployee.id,\r\n        } : { systemId: asSystemId('SYSTEM'), name: 'System' }}\r\n      />\r\n\r\n      {/* Sapo Import Dialog V2 */}\r\n      <GenericImportDialogV2<Order>\r\n        open={isSapoImportOpen}\r\n        onOpenChange={setIsSapoImportOpen}\r\n        config={sapoOrderConfigWithStores}\r\n        existingData={orders}\r\n        onImport={handleImport}\r\n        currentUser={authEmployee ? {\r\n          systemId: authEmployee.systemId,\r\n          name: authEmployee.fullName || authEmployee.id,\r\n        } : undefined}\r\n      />\r\n    </>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}