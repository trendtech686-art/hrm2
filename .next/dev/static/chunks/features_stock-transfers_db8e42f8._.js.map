{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/stock-transfers/api/stock-transfers-api.ts"],"sourcesContent":["/**\r\n * Stock Transfers (Phiếu Chuyển Kho) API functions\r\n * \r\n * ⚠️ Direct import: import { fetchStockTransfers } from '@/features/stock-transfers/api/stock-transfers-api'\r\n */\r\n\r\nimport type { SystemId } from '@/lib/id-types';\r\nimport type { StockTransfer, StockTransferStatus } from '../types';\r\n\r\nconst BASE_URL = '/api/stock-transfers';\r\n\r\nexport interface StockTransfersParams {\r\n  page?: number;\r\n  limit?: number;\r\n  search?: string;\r\n  status?: StockTransferStatus;\r\n  fromBranchId?: string;\r\n  toBranchId?: string;\r\n  createdBy?: string;\r\n  startDate?: string;\r\n  endDate?: string;\r\n  sortBy?: string;\r\n  sortOrder?: 'asc' | 'desc';\r\n}\r\n\r\nexport interface StockTransfersResponse {\r\n  data: StockTransfer[];\r\n  total: number;\r\n  page: number;\r\n  pageSize: number;\r\n}\r\n\r\nexport async function fetchStockTransfers(params: StockTransfersParams = {}): Promise<StockTransfersResponse> {\r\n  const searchParams = new URLSearchParams();\r\n  \r\n  if (params.page) searchParams.set('page', String(params.page));\r\n  if (params.limit) searchParams.set('limit', String(params.limit));\r\n  if (params.search) searchParams.set('search', params.search);\r\n  if (params.status) searchParams.set('status', params.status);\r\n  if (params.fromBranchId) searchParams.set('fromBranchId', params.fromBranchId);\r\n  if (params.toBranchId) searchParams.set('toBranchId', params.toBranchId);\r\n  if (params.createdBy) searchParams.set('createdBy', params.createdBy);\r\n  if (params.startDate) searchParams.set('startDate', params.startDate);\r\n  if (params.endDate) searchParams.set('endDate', params.endDate);\r\n  if (params.sortBy) searchParams.set('sortBy', params.sortBy);\r\n  if (params.sortOrder) searchParams.set('sortOrder', params.sortOrder);\r\n  \r\n  const url = searchParams.toString() ? `${BASE_URL}?${searchParams}` : BASE_URL;\r\n  const response = await fetch(url);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch stock transfers: ${response.statusText}`);\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function fetchStockTransfer(systemId: SystemId): Promise<StockTransfer> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch stock transfer: ${response.statusText}`);\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function createStockTransfer(data: Omit<StockTransfer, 'systemId' | 'createdAt' | 'updatedAt'> & { id?: string }): Promise<StockTransfer> {\r\n  const response = await fetch(BASE_URL, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to create stock transfer');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function updateStockTransfer(systemId: SystemId, data: Partial<StockTransfer>): Promise<StockTransfer> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`, {\r\n    method: 'PUT',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to update stock transfer');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function deleteStockTransfer(systemId: SystemId): Promise<void> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`, {\r\n    method: 'DELETE',\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to delete stock transfer: ${response.statusText}`);\r\n  }\r\n}\r\n\r\nexport async function startTransfer(systemId: SystemId): Promise<StockTransfer> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}/start`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to start transfer');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function completeTransfer(systemId: SystemId, receivedItems?: { productSystemId: string; receivedQuantity: number }[]): Promise<StockTransfer> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}/complete`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ receivedItems }),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to complete transfer');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function cancelStockTransfer(systemId: SystemId, reason: string): Promise<StockTransfer> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}/cancel`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ reason }),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to cancel stock transfer');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function fetchStockTransferStats(): Promise<{\r\n  total: number;\r\n  pending: number;\r\n  transferring: number;\r\n  completed: number;\r\n  cancelled: number;\r\n}> {\r\n  const response = await fetch(`${BASE_URL}/stats`);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch stock transfer stats: ${response.statusText}`);\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 151, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/stock-transfers/hooks/use-stock-transfers.ts"],"sourcesContent":["/**\r\n * useStockTransfers - React Query hooks (Phiếu Chuyển Kho)\r\n * \r\n * ⚠️ Direct import: import { useStockTransfers } from '@/features/stock-transfers/hooks/use-stock-transfers'\r\n */\r\n\r\nimport { useQuery, useMutation, useQueryClient, keepPreviousData } from '@tanstack/react-query';\r\nimport {\r\n  fetchStockTransfers,\r\n  fetchStockTransfer,\r\n  createStockTransfer,\r\n  updateStockTransfer,\r\n  deleteStockTransfer,\r\n  startTransfer,\r\n  completeTransfer,\r\n  cancelStockTransfer,\r\n  fetchStockTransferStats,\r\n  type StockTransfersParams,\r\n} from '../api/stock-transfers-api';\r\nimport type { StockTransfer } from '../types';\r\nimport { asSystemId } from '@/lib/id-types';\r\n\r\nexport const stockTransferKeys = {\r\n  all: ['stock-transfers'] as const,\r\n  lists: () => [...stockTransferKeys.all, 'list'] as const,\r\n  list: (params: StockTransfersParams) => [...stockTransferKeys.lists(), params] as const,\r\n  details: () => [...stockTransferKeys.all, 'detail'] as const,\r\n  detail: (id: string) => [...stockTransferKeys.details(), id] as const,\r\n  stats: () => [...stockTransferKeys.all, 'stats'] as const,\r\n};\r\n\r\nexport function useStockTransfers(params: StockTransfersParams = {}) {\r\n  return useQuery({\r\n    queryKey: stockTransferKeys.list(params),\r\n    queryFn: () => fetchStockTransfers(params),\r\n    staleTime: 30_000,\r\n    gcTime: 5 * 60 * 1000,\r\n    placeholderData: keepPreviousData,\r\n  });\r\n}\r\n\r\nexport function useStockTransfer(id: string | null | undefined) {\r\n  return useQuery({\r\n    queryKey: stockTransferKeys.detail(id!),\r\n    queryFn: () => fetchStockTransfer(asSystemId(id!)),\r\n    enabled: !!id,\r\n    staleTime: 60_000,\r\n  });\r\n}\r\n\r\nexport function useStockTransferStats() {\r\n  return useQuery({\r\n    queryKey: stockTransferKeys.stats(),\r\n    queryFn: fetchStockTransferStats,\r\n    staleTime: 60_000,\r\n  });\r\n}\r\n\r\ninterface UseStockTransferMutationsOptions {\r\n  onCreateSuccess?: (transfer: StockTransfer) => void;\r\n  onUpdateSuccess?: (transfer: StockTransfer) => void;\r\n  onDeleteSuccess?: () => void;\r\n  onStartSuccess?: (transfer: StockTransfer) => void;\r\n  onCompleteSuccess?: (transfer: StockTransfer) => void;\r\n  onCancelSuccess?: (transfer: StockTransfer) => void;\r\n  onError?: (error: Error) => void;\r\n}\r\n\r\nexport function useStockTransferMutations(options: UseStockTransferMutationsOptions = {}) {\r\n  const queryClient = useQueryClient();\r\n  \r\n  const create = useMutation({\r\n    mutationFn: createStockTransfer,\r\n    onSuccess: (data) => {\r\n      queryClient.invalidateQueries({ queryKey: stockTransferKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: stockTransferKeys.stats() });\r\n      options.onCreateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const update = useMutation({\r\n    mutationFn: ({ systemId, data }: { systemId: string; data: Partial<StockTransfer> }) => \r\n      updateStockTransfer(asSystemId(systemId), data),\r\n    onSuccess: (data, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: stockTransferKeys.detail(variables.systemId) });\r\n      queryClient.invalidateQueries({ queryKey: stockTransferKeys.lists() });\r\n      options.onUpdateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const remove = useMutation({\r\n    mutationFn: (systemId: string) => deleteStockTransfer(asSystemId(systemId)),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: stockTransferKeys.all });\r\n      options.onDeleteSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const start = useMutation({\r\n    mutationFn: (systemId: string) => startTransfer(asSystemId(systemId)),\r\n    onSuccess: (data, systemId) => {\r\n      queryClient.invalidateQueries({ queryKey: stockTransferKeys.detail(systemId) });\r\n      queryClient.invalidateQueries({ queryKey: stockTransferKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: stockTransferKeys.stats() });\r\n      options.onStartSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const complete = useMutation({\r\n    mutationFn: ({ systemId, receivedItems }: { systemId: string; receivedItems?: { productSystemId: string; receivedQuantity: number }[] }) => \r\n      completeTransfer(asSystemId(systemId), receivedItems),\r\n    onSuccess: (data, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: stockTransferKeys.detail(variables.systemId) });\r\n      queryClient.invalidateQueries({ queryKey: stockTransferKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: stockTransferKeys.stats() });\r\n      options.onCompleteSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const cancel = useMutation({\r\n    mutationFn: ({ systemId, reason }: { systemId: string; reason: string }) => \r\n      cancelStockTransfer(asSystemId(systemId), reason),\r\n    onSuccess: (data, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: stockTransferKeys.detail(variables.systemId) });\r\n      queryClient.invalidateQueries({ queryKey: stockTransferKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: stockTransferKeys.stats() });\r\n      options.onCancelSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  return { create, update, remove, start, complete, cancel };\r\n}\r\n\r\nexport function usePendingStockTransfers() {\r\n  return useStockTransfers({ status: 'pending' });\r\n}\r\n\r\nexport function useTransferringStockTransfers() {\r\n  return useStockTransfers({ status: 'transferring' });\r\n}\r\n\r\nexport function useStockTransfersByBranch(branchId: string | null | undefined, direction: 'from' | 'to' = 'from') {\r\n  return useStockTransfers({\r\n    [direction === 'from' ? 'fromBranchId' : 'toBranchId']: branchId || undefined,\r\n    limit: 50,\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;;;CAIC,GAED;AAAA;AAAA;AAAA;AACA;AAaA;;;;;AAEO,MAAM,oBAAoB;IAC/B,KAAK;QAAC;KAAkB;IACxB,OAAO,IAAM;eAAI,kBAAkB,GAAG;YAAE;SAAO;IAC/C,MAAM,CAAC,SAAiC;eAAI,kBAAkB,KAAK;YAAI;SAAO;IAC9E,SAAS,IAAM;eAAI,kBAAkB,GAAG;YAAE;SAAS;IACnD,QAAQ,CAAC,KAAe;eAAI,kBAAkB,OAAO;YAAI;SAAG;IAC5D,OAAO,IAAM;eAAI,kBAAkB,GAAG;YAAE;SAAQ;AAClD;AAEO,SAAS,kBAAkB,SAA+B,CAAC,CAAC;;IACjE,OAAO,IAAA,0LAAQ,EAAC;QACd,UAAU,kBAAkB,IAAI,CAAC;QACjC,OAAO;0CAAE,IAAM,IAAA,4LAAmB,EAAC;;QACnC,WAAW;QACX,QAAQ,IAAI,KAAK;QACjB,iBAAiB,8LAAgB;IACnC;AACF;GARgB;;QACP,0LAAQ;;;AASV,SAAS,iBAAiB,EAA6B;;IAC5D,OAAO,IAAA,0LAAQ,EAAC;QACd,UAAU,kBAAkB,MAAM,CAAC;QACnC,OAAO;yCAAE,IAAM,IAAA,2LAAkB,EAAC,IAAA,mIAAU,EAAC;;QAC7C,SAAS,CAAC,CAAC;QACX,WAAW;IACb;AACF;IAPgB;;QACP,0LAAQ;;;AAQV,SAAS;;IACd,OAAO,IAAA,0LAAQ,EAAC;QACd,UAAU,kBAAkB,KAAK;QACjC,SAAS,gMAAuB;QAChC,WAAW;IACb;AACF;IANgB;;QACP,0LAAQ;;;AAiBV,SAAS,0BAA0B,UAA4C,CAAC,CAAC;;IACtF,MAAM,cAAc,IAAA,2MAAc;IAElC,MAAM,SAAS,IAAA,gMAAW,EAAC;QACzB,YAAY,4LAAmB;QAC/B,SAAS;6DAAE,CAAC;gBACV,YAAY,iBAAiB,CAAC;oBAAE,UAAU,kBAAkB,KAAK;gBAAG;gBACpE,YAAY,iBAAiB,CAAC;oBAAE,UAAU,kBAAkB,KAAK;gBAAG;gBACpE,QAAQ,eAAe,GAAG;YAC5B;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,SAAS,IAAA,gMAAW,EAAC;QACzB,UAAU;6DAAE,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAsD,GACjF,IAAA,4LAAmB,EAAC,IAAA,mIAAU,EAAC,WAAW;;QAC5C,SAAS;6DAAE,CAAC,MAAM;gBAChB,YAAY,iBAAiB,CAAC;oBAAE,UAAU,kBAAkB,MAAM,CAAC,UAAU,QAAQ;gBAAE;gBACvF,YAAY,iBAAiB,CAAC;oBAAE,UAAU,kBAAkB,KAAK;gBAAG;gBACpE,QAAQ,eAAe,GAAG;YAC5B;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,SAAS,IAAA,gMAAW,EAAC;QACzB,UAAU;6DAAE,CAAC,WAAqB,IAAA,4LAAmB,EAAC,IAAA,mIAAU,EAAC;;QACjE,SAAS;6DAAE;gBACT,YAAY,iBAAiB,CAAC;oBAAE,UAAU,kBAAkB,GAAG;gBAAC;gBAChE,QAAQ,eAAe;YACzB;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,QAAQ,IAAA,gMAAW,EAAC;QACxB,UAAU;4DAAE,CAAC,WAAqB,IAAA,sLAAa,EAAC,IAAA,mIAAU,EAAC;;QAC3D,SAAS;4DAAE,CAAC,MAAM;gBAChB,YAAY,iBAAiB,CAAC;oBAAE,UAAU,kBAAkB,MAAM,CAAC;gBAAU;gBAC7E,YAAY,iBAAiB,CAAC;oBAAE,UAAU,kBAAkB,KAAK;gBAAG;gBACpE,YAAY,iBAAiB,CAAC;oBAAE,UAAU,kBAAkB,KAAK;gBAAG;gBACpE,QAAQ,cAAc,GAAG;YAC3B;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,WAAW,IAAA,gMAAW,EAAC;QAC3B,UAAU;+DAAE,CAAC,EAAE,QAAQ,EAAE,aAAa,EAAiG,GACrI,IAAA,yLAAgB,EAAC,IAAA,mIAAU,EAAC,WAAW;;QACzC,SAAS;+DAAE,CAAC,MAAM;gBAChB,YAAY,iBAAiB,CAAC;oBAAE,UAAU,kBAAkB,MAAM,CAAC,UAAU,QAAQ;gBAAE;gBACvF,YAAY,iBAAiB,CAAC;oBAAE,UAAU,kBAAkB,KAAK;gBAAG;gBACpE,YAAY,iBAAiB,CAAC;oBAAE,UAAU,kBAAkB,KAAK;gBAAG;gBACpE,QAAQ,iBAAiB,GAAG;YAC9B;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,SAAS,IAAA,gMAAW,EAAC;QACzB,UAAU;6DAAE,CAAC,EAAE,QAAQ,EAAE,MAAM,EAAwC,GACrE,IAAA,4LAAmB,EAAC,IAAA,mIAAU,EAAC,WAAW;;QAC5C,SAAS;6DAAE,CAAC,MAAM;gBAChB,YAAY,iBAAiB,CAAC;oBAAE,UAAU,kBAAkB,MAAM,CAAC,UAAU,QAAQ;gBAAE;gBACvF,YAAY,iBAAiB,CAAC;oBAAE,UAAU,kBAAkB,KAAK;gBAAG;gBACpE,YAAY,iBAAiB,CAAC;oBAAE,UAAU,kBAAkB,KAAK;gBAAG;gBACpE,QAAQ,eAAe,GAAG;YAC5B;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,OAAO;QAAE;QAAQ;QAAQ;QAAQ;QAAO;QAAU;IAAO;AAC3D;IArEgB;;QACM,2MAAc;QAEnB,gMAAW;QAUX,gMAAW;QAWX,gMAAW;QASZ,gMAAW;QAWR,gMAAW;QAYb,gMAAW;;;AAerB,SAAS;;IACd,OAAO,kBAAkB;QAAE,QAAQ;IAAU;AAC/C;IAFgB;;QACP;;;AAGF,SAAS;;IACd,OAAO,kBAAkB;QAAE,QAAQ;IAAe;AACpD;IAFgB;;QACP;;;AAGF,SAAS,0BAA0B,QAAmC,EAAE,YAA2B,MAAM;;IAC9G,OAAO,kBAAkB;QACvB,CAAC,cAAc,SAAS,iBAAiB,aAAa,EAAE,YAAY;QACpE,OAAO;IACT;AACF;IALgB;;QACP"}},
    {"offset": {"line": 424, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/stock-transfers/hooks/use-all-stock-transfers.ts"],"sourcesContent":["/**\r\n * useAllStockTransfers - Convenience hook for flat array of stock transfers\r\n * Returns all stock transfers data without pagination\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { useStockTransfers } from './use-stock-transfers';\r\nimport { asBusinessId, type BusinessId } from '@/lib/id-types';\r\n\r\nexport function useAllStockTransfers() {\r\n  const { data, ...rest } = useStockTransfers({ limit: 30 });\r\n  return {\r\n    data: data?.data ?? [],\r\n    ...rest,\r\n  };\r\n}\r\n\r\n/**\r\n * Hook to generate next transfer ID and check for duplicates\r\n * Replaces legacy getNextId() and isBusinessIdExists() from store\r\n */\r\nexport function useStockTransferIdHelper() {\r\n  const { data: transfers } = useAllStockTransfers();\r\n  \r\n  const getNextId = React.useCallback((): BusinessId => {\r\n    const today = new Date();\r\n    const prefix = `CK${today.getFullYear().toString().slice(-2)}${String(today.getMonth() + 1).padStart(2, '0')}${String(today.getDate()).padStart(2, '0')}`;\r\n    \r\n    // Find highest number for today's prefix\r\n    const todayTransfers = transfers.filter(t => t.id.startsWith(prefix));\r\n    const maxNum = todayTransfers.reduce((max, t) => {\r\n      const numPart = parseInt(t.id.slice(prefix.length), 10);\r\n      return isNaN(numPart) ? max : Math.max(max, numPart);\r\n    }, 0);\r\n    \r\n    return asBusinessId(`${prefix}${String(maxNum + 1).padStart(3, '0')}`);\r\n  }, [transfers]);\r\n  \r\n  const isBusinessIdExists = React.useCallback((id: string): boolean => {\r\n    return transfers.some(t => t.id === id);\r\n  }, [transfers]);\r\n  \r\n  return { getNextId, isBusinessIdExists };\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;CAGC,GAED;AACA;AACA;;;;;AAEO,SAAS;;IACd,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,GAAG,IAAA,4LAAiB,EAAC;QAAE,OAAO;IAAG;IACxD,OAAO;QACL,MAAM,MAAM,QAAQ,EAAE;QACtB,GAAG,IAAI;IACT;AACF;GANgB;;QACY,4LAAiB;;;AAWtC,SAAS;;IACd,MAAM,EAAE,MAAM,SAAS,EAAE,GAAG;IAE5B,MAAM,YAAY,4KAAiB;2DAAC;YAClC,MAAM,QAAQ,IAAI;YAClB,MAAM,SAAS,CAAC,EAAE,EAAE,MAAM,WAAW,GAAG,QAAQ,GAAG,KAAK,CAAC,CAAC,KAAK,OAAO,MAAM,QAAQ,KAAK,GAAG,QAAQ,CAAC,GAAG,OAAO,OAAO,MAAM,OAAO,IAAI,QAAQ,CAAC,GAAG,MAAM;YAEzJ,yCAAyC;YACzC,MAAM,iBAAiB,UAAU,MAAM;kFAAC,CAAA,IAAK,EAAE,EAAE,CAAC,UAAU,CAAC;;YAC7D,MAAM,SAAS,eAAe,MAAM;0EAAC,CAAC,KAAK;oBACzC,MAAM,UAAU,SAAS,EAAE,EAAE,CAAC,KAAK,CAAC,OAAO,MAAM,GAAG;oBACpD,OAAO,MAAM,WAAW,MAAM,KAAK,GAAG,CAAC,KAAK;gBAC9C;yEAAG;YAEH,OAAO,IAAA,qIAAY,EAAC,GAAG,SAAS,OAAO,SAAS,GAAG,QAAQ,CAAC,GAAG,MAAM;QACvE;0DAAG;QAAC;KAAU;IAEd,MAAM,qBAAqB,4KAAiB;oEAAC,CAAC;YAC5C,OAAO,UAAU,IAAI;4EAAC,CAAA,IAAK,EAAE,EAAE,KAAK;;QACtC;mEAAG;QAAC;KAAU;IAEd,OAAO;QAAE;QAAW;IAAmB;AACzC;IAtBgB;;QACc"}},
    {"offset": {"line": 503, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/stock-transfers/columns.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\nimport type { StockTransfer, StockTransferStatus } from './types';\r\nimport type { ColumnDef } from '../../components/data-table/types';\r\nimport { Badge } from '../../components/ui/badge';\r\nimport { Button } from '../../components/ui/button';\r\nimport { Checkbox } from '../../components/ui/checkbox';\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger } from '../../components/ui/dropdown-menu';\r\nimport { MoreHorizontal, Printer } from 'lucide-react';\r\nimport { formatDate } from '@/lib/date-utils';\r\nimport { useProductStore } from '../products/store';\r\nimport { useStockTransferStore } from './store';\r\nimport { asSystemId } from '../../lib/id-types';\r\n\r\nconst getStatusVariant = (status: StockTransferStatus): 'default' | 'secondary' | 'success' | 'destructive' | 'outline' => {\r\n  switch (status) {\r\n    case 'pending': return 'secondary';\r\n    case 'transferring': return 'default';\r\n    case 'completed': return 'success';\r\n    case 'cancelled': return 'destructive';\r\n    default: return 'outline';\r\n  }\r\n};\r\n\r\nconst getStatusLabel = (status: StockTransferStatus): string => {\r\n  switch (status) {\r\n    case 'pending': return 'Chờ chuyển';\r\n    case 'transferring': return 'Đang chuyển';\r\n    case 'completed': return 'Hoàn thành';\r\n    case 'cancelled': return 'Đã hủy';\r\n    default: return status;\r\n  }\r\n};\r\n\r\nexport const getColumns = (onPrint?: (transfer: StockTransfer) => void): ColumnDef<StockTransfer>[] => [\r\n  {\r\n    id: 'select',\r\n    header: ({ isAllPageRowsSelected, isSomePageRowsSelected, onToggleAll }) => (\r\n      <div className=\"flex items-center justify-center\">\r\n        <Checkbox\r\n          checked={isAllPageRowsSelected ? true : isSomePageRowsSelected ? 'indeterminate' : false}\r\n          onCheckedChange={(value) => onToggleAll?.(!!value)}\r\n          aria-label=\"Chọn tất cả\"\r\n          className=\"h-4 w-4\"\r\n        />\r\n      </div>\r\n    ),\r\n    cell: ({ isSelected, onToggleSelect }) => (\r\n      <div className=\"flex items-center justify-center\">\r\n        <Checkbox\r\n          checked={isSelected}\r\n          onCheckedChange={onToggleSelect}\r\n          aria-label=\"Chọn hàng\"\r\n          className=\"h-4 w-4\"\r\n        />\r\n      </div>\r\n    ),\r\n    enableSorting: false,\r\n    size: 50,\r\n    meta: { displayName: 'Chọn' },\r\n  },\r\n  {\r\n    id: 'id',\r\n    accessorKey: 'id',\r\n    header: 'Mã phiếu',\r\n    cell: ({ row }) => (\r\n      <Link\r\n        href={`/stock-transfers/${(row as any).systemId}`}\r\n        className=\"font-medium text-primary hover:underline\"\r\n      >\r\n        {(row as any).id}\r\n      </Link>\r\n    ),\r\n    meta: { displayName: 'Mã phiếu' },\r\n  },\r\n  {\r\n    id: 'referenceCode',\r\n    accessorKey: 'referenceCode',\r\n    header: 'Mã tham chiếu',\r\n    cell: ({ row }) => (\r\n      <span className=\"text-muted-foreground\">\r\n        {(row as any).referenceCode || '-'}\r\n      </span>\r\n    ),\r\n    meta: { displayName: 'Mã tham chiếu' },\r\n  },\r\n  {\r\n    id: 'createdDate',\r\n    accessorKey: 'createdDate',\r\n    header: 'Ngày tạo',\r\n    cell: ({ row }) => formatDate((row as any).createdDate),\r\n    meta: { displayName: 'Ngày tạo' },\r\n  },\r\n  {\r\n    id: 'fromBranchName',\r\n    accessorKey: 'fromBranchName',\r\n    header: 'Chi nhánh chuyển',\r\n    cell: ({ row }) => (row as any).fromBranchName,\r\n    meta: { displayName: 'Chi nhánh chuyển' },\r\n  },\r\n  {\r\n    id: 'toBranchName',\r\n    accessorKey: 'toBranchName',\r\n    header: 'Chi nhánh nhận',\r\n    cell: ({ row }) => (row as any).toBranchName,\r\n    meta: { displayName: 'Chi nhánh nhận' },\r\n  },\r\n  {\r\n    id: 'itemCount',\r\n    accessorKey: 'items',\r\n    header: 'Số SP',\r\n    cell: ({ row }) => ((row as any).items?.length || 0),\r\n    meta: { displayName: 'Số sản phẩm' },\r\n  },\r\n  {\r\n    id: 'totalQuantity',\r\n    accessorKey: 'items',\r\n    header: 'Tổng SL',\r\n    cell: ({ row }) => ((row as any).items?.reduce((sum: number, item: any) => sum + item.quantity, 0) || 0),\r\n    meta: { displayName: 'Tổng số lượng' },\r\n  },\r\n  {\r\n    id: 'totalValue',\r\n    accessorKey: 'items',\r\n    header: 'Tổng giá trị chuyển',\r\n    cell: ({ row }) => {\r\n      const { findById: findProductById } = useProductStore.getState();\r\n      const totalValue = (row as any).items?.reduce((sum: number, item: any) => {\r\n        const product = findProductById(asSystemId(item.productSystemId));\r\n        const price = product?.costPrice || 0;\r\n        return sum + (price * item.quantity);\r\n      }, 0) || 0;\r\n      \r\n      return <span className=\"font-medium\">{totalValue.toLocaleString('vi-VN')} đ</span>;\r\n    },\r\n    meta: { displayName: 'Tổng giá trị chuyển' },\r\n  },\r\n  {\r\n    id: 'status',\r\n    accessorKey: 'status',\r\n    header: 'Trạng thái',\r\n    cell: ({ row }) => (\r\n      <Badge variant={getStatusVariant((row as any).status)}>\r\n        {getStatusLabel((row as any).status)}\r\n      </Badge>\r\n    ),\r\n    meta: { displayName: 'Trạng thái' },\r\n  },\r\n  {\r\n    id: 'createdByName',\r\n    accessorKey: 'createdByName',\r\n    header: 'Người tạo',\r\n    cell: ({ row }) => (row as any).createdByName,\r\n    meta: { displayName: 'Người tạo' },\r\n  },\r\n  {\r\n    id: 'note',\r\n    accessorKey: 'note',\r\n    header: 'Ghi chú',\r\n    cell: ({ row }) => (\r\n      <span className=\"text-muted-foreground truncate max-w-[200px] block\">\r\n        {(row as any).note || '-'}\r\n      </span>\r\n    ),\r\n    meta: { displayName: 'Ghi chú' },\r\n  },\r\n  {\r\n    id: 'actions',\r\n    header: 'Hành động',\r\n    cell: ({ row }) => {\r\n      const router = useRouter();\r\n      const transfer = row as any;\r\n      const isPending = transfer.status === 'pending';\r\n      const isTransferring = transfer.status === 'transferring';\r\n      const isCompleted = transfer.status === 'completed';\r\n      const isCancelled = transfer.status === 'cancelled';\r\n      \r\n      return (\r\n        <DropdownMenu>\r\n          <DropdownMenuTrigger asChild>\r\n            <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\r\n              <MoreHorizontal className=\"h-4 w-4\" />\r\n              <span className=\"sr-only\">Mở menu</span>\r\n            </Button>\r\n          </DropdownMenuTrigger>\r\n          <DropdownMenuContent align=\"end\">\r\n            <DropdownMenuItem onClick={() => onPrint?.(transfer)}>\r\n              <Printer className=\"mr-2 h-4 w-4\" />\r\n              In phiếu chuyển\r\n            </DropdownMenuItem>\r\n            {isPending && (\r\n              <>\r\n                <DropdownMenuItem onClick={() => router.push(`/stock-transfers/${transfer.systemId}/edit`)}>\r\n                  Chỉnh sửa\r\n                </DropdownMenuItem>\r\n                <DropdownMenuItem onClick={() => router.push(`/stock-transfers/${transfer.systemId}`)}>\r\n                  Chuyển hàng khỏi kho\r\n                </DropdownMenuItem>\r\n                <DropdownMenuSeparator />\r\n                <DropdownMenuItem \r\n                  className=\"text-destructive focus:text-destructive\"\r\n                  onClick={() => router.push(`/stock-transfers/${transfer.systemId}`)}\r\n                >\r\n                  Hủy phiếu\r\n                </DropdownMenuItem>\r\n              </>\r\n            )}\r\n            \r\n            {isTransferring && (\r\n              <>\r\n                <DropdownMenuItem onClick={() => router.push(`/stock-transfers/${transfer.systemId}`)}>\r\n                  Nhận hàng vào kho\r\n                </DropdownMenuItem>\r\n                <DropdownMenuSeparator />\r\n                <DropdownMenuItem \r\n                  className=\"text-destructive focus:text-destructive\"\r\n                  onClick={() => router.push(`/stock-transfers/${transfer.systemId}`)}\r\n                >\r\n                  Hủy phiếu\r\n                </DropdownMenuItem>\r\n              </>\r\n            )}\r\n          </DropdownMenuContent>\r\n        </DropdownMenu>\r\n      );\r\n    },\r\n    meta: { displayName: 'Hành động' },\r\n  },\r\n];\r\n\r\nexport const getStatusOptions = () => [\r\n  { value: 'all', label: 'Tất cả trạng thái' },\r\n  { value: 'pending', label: 'Chờ chuyển' },\r\n  { value: 'transferring', label: 'Đang chuyển' },\r\n  { value: 'completed', label: 'Hoàn thành' },\r\n  { value: 'cancelled', label: 'Đã hủy' },\r\n];\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 927, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/stock-transfers/stock-transfer-card.tsx"],"sourcesContent":["'use client'\r\n\r\nimport * as React from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport type { StockTransfer } from './types';\r\nimport { Card, CardContent } from '../../components/ui/card';\r\nimport { Badge } from '../../components/ui/badge';\r\nimport { Button } from '../../components/ui/button';\r\nimport { Truck, ArrowRight, Package, Calendar, User, MoreHorizontal, Eye, Edit, XCircle } from 'lucide-react';\r\nimport { formatDate } from '@/lib/date-utils';\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger } from '../../components/ui/dropdown-menu';\r\n\r\nconst getStatusVariant = (status: string): 'default' | 'secondary' | 'success' | 'destructive' | 'outline' => {\r\n  switch (status) {\r\n    case 'pending': return 'secondary';\r\n    case 'transferring': return 'default';\r\n    case 'completed': return 'success';\r\n    case 'cancelled': return 'destructive';\r\n    default: return 'outline';\r\n  }\r\n};\r\n\r\nconst getStatusLabel = (status: string): string => {\r\n  switch (status) {\r\n    case 'pending': return 'Chờ chuyển';\r\n    case 'transferring': return 'Đang chuyển';\r\n    case 'completed': return 'Hoàn thành';\r\n    case 'cancelled': return 'Đã hủy';\r\n    default: return status;\r\n  }\r\n};\r\n\r\ninterface StockTransferCardProps {\r\n  transfer: StockTransfer;\r\n  onDelete?: (systemId: string) => void;\r\n}\r\n\r\nexport function StockTransferCard({ transfer, onDelete }: StockTransferCardProps) {\r\n  const router = useRouter();\r\n  const isPending = transfer.status === 'pending';\r\n  const totalQuantity = transfer.items?.reduce((sum, item) => sum + item.quantity, 0) || 0;\r\n\r\n  return (\r\n    <Card className=\"mb-3\">\r\n      <CardContent className=\"p-4\">\r\n        <div className=\"flex items-start justify-between mb-3\">\r\n          <div className=\"flex-1\">\r\n            <div className=\"flex items-center gap-2 mb-1\">\r\n              <span className=\"font-semibold text-primary\">{transfer.id}</span>\r\n              <Badge variant={getStatusVariant(transfer.status)}>\r\n                {getStatusLabel(transfer.status)}\r\n              </Badge>\r\n            </div>\r\n            {transfer.referenceCode && (\r\n              <p className=\"text-body-xs text-muted-foreground\">\r\n                Mã tham chiếu: {transfer.referenceCode}\r\n              </p>\r\n            )}\r\n          </div>\r\n          \r\n          <DropdownMenu>\r\n            <DropdownMenuTrigger asChild>\r\n              <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\r\n                <MoreHorizontal className=\"h-4 w-4\" />\r\n              </Button>\r\n            </DropdownMenuTrigger>\r\n            <DropdownMenuContent align=\"end\">\r\n              <DropdownMenuItem onClick={() => router.push(`/stock-transfers/${transfer.systemId}`)}>\r\n                <Eye className=\"mr-2 h-4 w-4\" />\r\n                Xem chi tiết\r\n              </DropdownMenuItem>\r\n              {isPending && (\r\n                <>\r\n                  <DropdownMenuItem onClick={() => router.push(`/stock-transfers/${transfer.systemId}/edit`)}>\r\n                    <Edit className=\"mr-2 h-4 w-4\" />\r\n                    Chỉnh sửa\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuSeparator />\r\n                  <DropdownMenuItem \r\n                    className=\"text-destructive\"\r\n                    onClick={() => onDelete?.(transfer.systemId)}\r\n                  >\r\n                    <XCircle className=\"mr-2 h-4 w-4\" />\r\n                    Hủy phiếu\r\n                  </DropdownMenuItem>\r\n                </>\r\n              )}\r\n            </DropdownMenuContent>\r\n          </DropdownMenu>\r\n        </div>\r\n\r\n        {/* Branch Transfer Info */}\r\n        <div className=\"flex items-center gap-2 mb-3 p-2 bg-muted/50 rounded-md\">\r\n          <div className=\"flex-1 text-center\">\r\n            <p className=\"text-body-xs text-muted-foreground\">Từ</p>\r\n            <p className=\"font-medium text-body-sm\">{transfer.fromBranchName}</p>\r\n          </div>\r\n          <ArrowRight className=\"h-4 w-4 text-muted-foreground flex-shrink-0\" />\r\n          <div className=\"flex-1 text-center\">\r\n            <p className=\"text-body-xs text-muted-foreground\">Đến</p>\r\n            <p className=\"font-medium text-body-sm\">{transfer.toBranchName}</p>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Info Row */}\r\n        <div className=\"grid grid-cols-3 gap-2 text-body-sm\">\r\n          <div className=\"flex items-center gap-1 text-muted-foreground\">\r\n            <Package className=\"h-3.5 w-3.5\" />\r\n            <span>{transfer.items?.length || 0} SP</span>\r\n          </div>\r\n          <div className=\"flex items-center gap-1 text-muted-foreground\">\r\n            <Truck className=\"h-3.5 w-3.5\" />\r\n            <span>{totalQuantity} SL</span>\r\n          </div>\r\n          <div className=\"flex items-center gap-1 text-muted-foreground\">\r\n            <Calendar className=\"h-3.5 w-3.5\" />\r\n            <span>{formatDate(transfer.createdDate)}</span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Creator */}\r\n        <div className=\"flex items-center gap-1 mt-2 text-body-xs text-muted-foreground\">\r\n          <User className=\"h-3 w-3\" />\r\n          <span>{transfer.createdByName}</span>\r\n        </div>\r\n\r\n        {/* Note */}\r\n        {transfer.note && (\r\n          <p className=\"mt-2 text-body-xs text-muted-foreground line-clamp-2\">\r\n            {transfer.note}\r\n          </p>\r\n        )}\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1358, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/stock-transfers/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport * as React from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useAllStockTransfers } from './hooks/use-all-stock-transfers';\r\nimport { useStockTransferMutations } from './hooks/use-stock-transfers';\r\nimport { getColumns } from './columns';\r\nimport { ResponsiveDataTable, type BulkAction } from '../../components/data-table/responsive-data-table';\r\nimport { DataTableFacetedFilter } from '../../components/data-table/data-table-faceted-filter';\r\nimport { DataTableColumnCustomizer } from '../../components/data-table/data-table-column-toggle';\r\nimport { Button } from '../../components/ui/button';\r\nimport { Plus, Printer, FileSpreadsheet, Download } from 'lucide-react';\r\nimport { GenericImportDialogV2 } from '../../components/shared/generic-import-dialog-v2';\r\nimport { GenericExportDialogV2 } from '../../components/shared/generic-export-dialog-v2';\r\nimport { stockTransferImportExportConfig, flattenStockTransfersForExport } from '../../lib/import-export/configs/stock-transfer.config';\r\nimport { useAuth } from '../../contexts/auth-context';\r\nimport { asSystemId } from '../../lib/id-types';\r\nimport { SimplePrintOptionsDialog, type SimplePrintOptionsResult } from '../../components/shared/simple-print-options-dialog';\r\nimport { usePageHeader } from '../../contexts/page-header-context';\r\nimport { ROUTES } from '../../lib/router';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../../components/ui/select';\r\nimport { useAllBranches } from '../settings/branches/hooks/use-all-branches';\r\nimport { PageToolbar } from '../../components/layout/page-toolbar';\r\nimport { PageFilters } from '../../components/layout/page-filters';\r\nimport { useMediaQuery } from '../../lib/use-media-query';\r\nimport { toast } from 'sonner';\r\nimport Fuse from 'fuse.js';\r\nimport { StockTransferCard } from './stock-transfer-card';\r\nimport type { StockTransfer, StockTransferStatus } from './types';\r\nimport { formatDate, isValidDate, isDateAfter, isDateBefore, isDateSame, isDateBetween, getStartOfDay, getEndOfDay } from '../../lib/date-utils';\r\nimport { useStoreInfo } from '../settings/store-info/hooks/use-store-info';\r\nimport { usePrint } from '../../lib/use-print';\r\nimport { \r\n  convertStockTransferForPrint,\r\n  mapStockTransferToPrintData,\r\n  mapStockTransferLineItems,\r\n  createStoreSettings,\r\n} from '../../lib/print/stock-transfer-print-helper';\r\nimport { useColumnVisibility } from '../../hooks/use-column-visibility';\r\n\r\ntype StoredColumnLayout = {\r\n  order?: string[];\r\n  pinned?: string[];\r\n};\r\n\r\n\r\nexport function StockTransfersPage() {\r\n  const router = useRouter();\r\n  const { data: transfers = [] } = useAllStockTransfers();\r\n  const { create, update } = useStockTransferMutations();\r\n  const { data: branches = [] } = useAllBranches();\r\n  const { data: storeInfo } = useStoreInfo();\r\n  const { print, printMultiple } = usePrint();\r\n  const { employee: currentUser } = useAuth();\r\n  const isMobile = !useMediaQuery(\"(min-width: 768px)\");\r\n  \r\n  // Print dialog state\r\n  const [printDialogOpen, setPrintDialogOpen] = React.useState(false);\r\n  const [itemsToPrint, setItemsToPrint] = React.useState<StockTransfer[]>([]);\r\n  \r\n  // Import/Export dialog state\r\n  const [showImportDialog, setShowImportDialog] = React.useState(false);\r\n  const [showExportDialog, setShowExportDialog] = React.useState(false);\r\n  \r\n  // Table state\r\n  const [rowSelection, setRowSelection] = React.useState<Record<string, boolean>>({});\r\n  const [sorting, setSorting] = React.useState<{ id: string, desc: boolean }>({ id: 'createdAt', desc: true });\r\n  const [globalFilter, setGlobalFilter] = React.useState('');\r\n  const [debouncedGlobalFilter, setDebouncedGlobalFilter] = React.useState('');\r\n  const [pagination, setPagination] = React.useState({ pageIndex: 0, pageSize: 40 });\r\n  const [expanded, setExpanded] = React.useState<Record<string, boolean>>({});\r\n  \r\n  // Filters\r\n  const [statusFilter, setStatusFilter] = React.useState<Set<string>>(new Set());\r\n  const [fromBranchFilter, setFromBranchFilter] = React.useState<string>('all');\r\n  const [toBranchFilter, setToBranchFilter] = React.useState<string>('all');\r\n  const [dateFilter, setDateFilter] = React.useState<[string | undefined, string | undefined] | undefined>();\r\n\r\n  // Column customization state - use database-backed hook\r\n  const [columnVisibility, setColumnVisibility] = useColumnVisibility('stock-transfers', {});\r\n  const [columnOrder, setColumnOrder] = React.useState<string[]>([]);\r\n  const [pinnedColumns, setPinnedColumns] = React.useState<string[]>([]);\r\n\r\n  // Debounce search\r\n  React.useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      setDebouncedGlobalFilter(globalFilter);\r\n    }, 300);\r\n    return () => clearTimeout(timer);\r\n  }, [globalFilter]);\r\n\r\n  // Page header\r\n  const headerActions = React.useMemo(() => [\r\n    <Button \r\n      key=\"add\"\r\n      onClick={() => router.push(ROUTES.INVENTORY.STOCK_TRANSFER_NEW)}\r\n      className=\"h-9\"\r\n    >\r\n      <Plus className=\"mr-2 h-4 w-4\" />\r\n      Tạo phiếu chuyển kho\r\n    </Button>\r\n  ], [router]);\r\n\r\n  usePageHeader({\r\n    title: 'Danh sách chuyển kho',\r\n    breadcrumb: [\r\n      { label: 'Trang chủ', href: ROUTES.ROOT, isCurrent: false },\r\n      { label: 'Chuyển kho', href: '/stock-transfers', isCurrent: true },\r\n    ],\r\n    actions: headerActions,\r\n    showBackButton: false,\r\n  });\r\n\r\n  const handlePrint = React.useCallback((transfer: StockTransfer) => {\r\n    // Use helper to prepare print data\r\n    const fromBranch = branches.find(b => b.name === transfer.fromBranchName);\r\n    const toBranch = branches.find(b => b.name === transfer.toBranchName);\r\n    const storeSettings = fromBranch \r\n      ? createStoreSettings(fromBranch)\r\n      : createStoreSettings(storeInfo);\r\n    const transferData = convertStockTransferForPrint(transfer, { fromBranch, toBranch });\r\n    \r\n    print('stock-transfer', {\r\n      data: mapStockTransferToPrintData(transferData, storeSettings),\r\n      lineItems: mapStockTransferLineItems(transferData.items),\r\n    });\r\n  }, [branches, storeInfo, print]);\r\n\r\n  // Bulk print handlers\r\n  const handleBulkPrint = React.useCallback((rows: StockTransfer[]) => {\r\n    setItemsToPrint(rows);\r\n    setPrintDialogOpen(true);\r\n  }, []);\r\n\r\n  const handlePrintConfirm = React.useCallback((options: SimplePrintOptionsResult) => {\r\n    if (itemsToPrint.length === 0) return;\r\n    \r\n    const printItems = itemsToPrint.map(transfer => {\r\n      // Use branchSystemId from options if specified, otherwise use transfer's fromBranch\r\n      const selectedBranch = options.branchSystemId \r\n        ? branches.find(b => b.systemId === options.branchSystemId)\r\n        : branches.find(b => b.name === transfer.fromBranchName);\r\n      const toBranch = branches.find(b => b.name === transfer.toBranchName);\r\n      const storeSettings = selectedBranch \r\n        ? createStoreSettings(selectedBranch)\r\n        : createStoreSettings(storeInfo);\r\n      const transferData = convertStockTransferForPrint(transfer, { fromBranch: selectedBranch, toBranch });\r\n      \r\n      return {\r\n        data: mapStockTransferToPrintData(transferData, storeSettings),\r\n        lineItems: mapStockTransferLineItems(transferData.items),\r\n        paperSize: options.paperSize,\r\n      };\r\n    });\r\n\r\n    printMultiple('stock-transfer', printItems);\r\n    toast.success(`Đang in ${itemsToPrint.length} phiếu chuyển kho`);\r\n    setItemsToPrint([]);\r\n    setPrintDialogOpen(false);\r\n  }, [itemsToPrint, branches, storeInfo, printMultiple]);\r\n\r\n  // Bulk actions\r\n  const bulkActions: BulkAction<StockTransfer>[] = React.useMemo(() => [\r\n    {\r\n      label: 'In phiếu',\r\n      icon: Printer,\r\n      onSelect: handleBulkPrint,\r\n    },\r\n  ], [handleBulkPrint]);\r\n\r\n  // Import handler\r\n  const handleImport = React.useCallback(async (\r\n    importedTransfers: Partial<StockTransfer>[],\r\n    mode: 'insert-only' | 'update-only' | 'upsert',\r\n    _branchId?: string\r\n  ) => {\r\n    let addedCount = 0;\r\n    let updatedCount = 0;\r\n    let skippedCount = 0;\r\n    const errors: Array<{ row: number; message: string }> = [];\r\n    \r\n    for (const [index, transfer] of importedTransfers.entries()) {\r\n      try {\r\n        const existing = transfers.find(t => \r\n          t.id.toLowerCase() === (transfer.id || '').toLowerCase()\r\n        );\r\n        \r\n        if (existing) {\r\n          if (mode === 'update-only' || mode === 'upsert') {\r\n            update.mutate({ \r\n              systemId: existing.systemId as string, \r\n              data: { ...existing, ...transfer, systemId: existing.systemId }\r\n            });\r\n            updatedCount++;\r\n          } else {\r\n            skippedCount++;\r\n          }\r\n        } else {\r\n          if (mode === 'insert-only' || mode === 'upsert') {\r\n            create.mutate(transfer as Omit<StockTransfer, 'systemId' | 'createdAt' | 'updatedAt'>);\r\n            addedCount++;\r\n          } else {\r\n            skippedCount++;\r\n          }\r\n        }\r\n      } catch (error) {\r\n        errors.push({ row: index + 1, message: (error as Error).message });\r\n      }\r\n    }\r\n    \r\n    if (addedCount > 0 || updatedCount > 0) {\r\n      const messages = [];\r\n      if (addedCount > 0) messages.push(`${addedCount} phiếu chuyển kho mới`);\r\n      if (updatedCount > 0) messages.push(`${updatedCount} phiếu cập nhật`);\r\n      toast.success(`Đã import: ${messages.join(', ')}`);\r\n    }\r\n    \r\n    return {\r\n      success: addedCount + updatedCount,\r\n      failed: errors.length,\r\n      inserted: addedCount,\r\n      updated: updatedCount,\r\n      skipped: skippedCount,\r\n      errors,\r\n    };\r\n  }, [transfers, create, update]);\r\n\r\n  // Selected transfers for export\r\n  const selectedTransfers = React.useMemo(() => {\r\n    return transfers.filter(t => rowSelection[t.systemId]);\r\n  }, [transfers, rowSelection]);\r\n\r\n  // Columns\r\n  const columns = React.useMemo(() => getColumns(handlePrint), [handlePrint]);\r\n\r\n  // Column defaults\r\n  const buildDefaultVisibility = React.useCallback(() => {\r\n    const defaultVisibleColumns = new Set([\r\n      'id', 'createdDate', 'fromBranchName', 'toBranchName', 'itemCount', \r\n      'totalQuantity', 'totalValue', 'status', 'createdByName', 'note'\r\n    ]);\r\n    const initialVisibility: Record<string, boolean> = {};\r\n    columns.forEach(c => {\r\n      if (!c.id) return;\r\n      if (c.id === 'select' || c.id === 'actions') {\r\n        initialVisibility[c.id] = true;\r\n        return;\r\n      }\r\n      initialVisibility[c.id] = defaultVisibleColumns.has(c.id);\r\n    });\r\n    return initialVisibility;\r\n  }, []);\r\n\r\n  const buildDefaultOrder = React.useCallback(() => (\r\n    columns.map(c => c.id).filter(Boolean) as string[]\r\n  ), []);\r\n\r\n  // Track if we've initialized column visibility to prevent infinite loops\r\n  const hasInitializedVisibility = React.useRef(false);\r\n\r\n  React.useEffect(() => {\r\n    if (columns.length === 0) return;\r\n    if (hasInitializedVisibility.current) return;\r\n    hasInitializedVisibility.current = true;\r\n    \r\n    if (Object.keys(columnVisibility).length === 0) {\r\n      setColumnVisibility(buildDefaultVisibility());\r\n    }\r\n    if (columnOrder.length === 0) {\r\n      setColumnOrder(buildDefaultOrder());\r\n    }\r\n    if (!pinnedColumns || pinnedColumns.length === 0) {\r\n      setPinnedColumns([]);\r\n    }\r\n  }, [buildDefaultOrder, buildDefaultVisibility, columnVisibility, columnOrder, pinnedColumns, setColumnVisibility, setColumnOrder, setPinnedColumns]);\r\n\r\n  const resetColumnLayout = React.useCallback(() => {\r\n    setColumnVisibility(buildDefaultVisibility());\r\n    setColumnOrder(buildDefaultOrder());\r\n    setPinnedColumns([]);\r\n    toast.success('Đã khôi phục bố cục cột mặc định');\r\n  }, [buildDefaultVisibility, buildDefaultOrder, setColumnVisibility, setColumnOrder, setPinnedColumns]);\r\n\r\n  // Fuse search\r\n  const fuseInstance = React.useMemo(() => {\r\n    return new Fuse(transfers, {\r\n      keys: ['id', 'fromBranchName', 'toBranchName', 'createdByName', 'note', 'referenceCode'],\r\n      threshold: 0.3,\r\n      ignoreLocation: true,\r\n    });\r\n  }, [transfers]);\r\n\r\n  // Filter data\r\n  const filteredData = React.useMemo(() => {\r\n    let filtered = [...transfers];\r\n\r\n    // Status filter\r\n    if (statusFilter.size > 0) {\r\n      filtered = filtered.filter(t => statusFilter.has(t.status));\r\n    }\r\n\r\n    // Branch filters\r\n    if (fromBranchFilter !== 'all') {\r\n      filtered = filtered.filter(t => t.fromBranchSystemId === fromBranchFilter);\r\n    }\r\n    if (toBranchFilter !== 'all') {\r\n      filtered = filtered.filter(t => t.toBranchSystemId === toBranchFilter);\r\n    }\r\n\r\n    // Search filter\r\n    if (debouncedGlobalFilter.trim()) {\r\n      fuseInstance.setCollection(filtered);\r\n      filtered = fuseInstance.search(debouncedGlobalFilter.trim()).map(r => r.item);\r\n    }\r\n\r\n    // Date filter\r\n    if (dateFilter && (dateFilter[0] || dateFilter[1])) {\r\n      const [start, end] = dateFilter;\r\n      const startDate = start ? getStartOfDay(start) : null;\r\n      const endDate = end ? getEndOfDay(end) : null;\r\n      \r\n      filtered = filtered.filter(t => {\r\n        const rowDate = new Date(t.createdDate);\r\n        if (!isValidDate(rowDate)) return false;\r\n        if (startDate && !endDate) return isDateAfter(rowDate, startDate) || isDateSame(rowDate, startDate);\r\n        if (!startDate && endDate) return isDateBefore(rowDate, endDate) || isDateSame(rowDate, endDate);\r\n        if (startDate && endDate) return isDateBetween(rowDate, startDate, endDate);\r\n        return true;\r\n      });\r\n    }\r\n\r\n    return filtered;\r\n  }, [transfers, statusFilter, fromBranchFilter, toBranchFilter, debouncedGlobalFilter, dateFilter, fuseInstance]);\r\n\r\n  // Reset pagination on filter change\r\n  React.useEffect(() => {\r\n    setPagination(p => ({ ...p, pageIndex: 0 }));\r\n  }, [debouncedGlobalFilter, statusFilter, fromBranchFilter, toBranchFilter, dateFilter]);\r\n\r\n  // Sorting\r\n  const sortedData = React.useMemo(() => {\r\n    const sorted = [...filteredData];\r\n    if (sorting.id) {\r\n      sorted.sort((a, b) => {\r\n        const aValue = (a as any)[sorting.id];\r\n        const bValue = (b as any)[sorting.id];\r\n        if (aValue === null || aValue === undefined) return 1;\r\n        if (bValue === null || bValue === undefined) return -1;\r\n        // Special handling for date columns\r\n        if (sorting.id === 'createdAt' || sorting.id === 'createdDate' || sorting.id === 'transferDate') {\r\n          const aTime = aValue ? new Date(aValue).getTime() : 0;\r\n          const bTime = bValue ? new Date(bValue).getTime() : 0;\r\n          return sorting.desc ? bTime - aTime : aTime - bTime;\r\n        }\r\n        if (aValue < bValue) return sorting.desc ? 1 : -1;\r\n        if (aValue > bValue) return sorting.desc ? -1 : 1;\r\n        return 0;\r\n      });\r\n    }\r\n    return sorted;\r\n  }, [filteredData, sorting]);\r\n\r\n  // Pagination\r\n  const pageCount = Math.ceil(sortedData.length / pagination.pageSize);\r\n  const paginatedData = React.useMemo(() => {\r\n    const start = pagination.pageIndex * pagination.pageSize;\r\n    const end = start + pagination.pageSize;\r\n    return sortedData.slice(start, end);\r\n  }, [sortedData, pagination]);\r\n\r\n  // Selection\r\n  const allSelectedRows = React.useMemo(() =>\r\n    transfers.filter(t => rowSelection[t.systemId]),\r\n  [transfers, rowSelection]);\r\n\r\n  // Filter options\r\n  const statusOptions = React.useMemo(() => [\r\n    { value: 'pending', label: 'Chờ chuyển' },\r\n    { value: 'transferring', label: 'Đang chuyển' },\r\n    { value: 'completed', label: 'Hoàn thành' },\r\n    { value: 'cancelled', label: 'Đã hủy' },\r\n  ], []);\r\n\r\n  // Row click handler\r\n  const handleRowClick = (row: StockTransfer) => {\r\n    router.push(`/stock-transfers/${row.systemId}`);\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col w-full h-full\">\r\n      {/* PageToolbar - Desktop only */}\r\n      {!isMobile && (\r\n        <PageToolbar\r\n          leftActions={\r\n            <>\r\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setShowImportDialog(true)}>\r\n                <FileSpreadsheet className=\"mr-2 h-4 w-4\" />\r\n                Nhập file\r\n              </Button>\r\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setShowExportDialog(true)}>\r\n                <Download className=\"mr-2 h-4 w-4\" />\r\n                Xuất Excel\r\n              </Button>\r\n            </>\r\n          }\r\n          rightActions={\r\n            <DataTableColumnCustomizer\r\n              columns={columns}\r\n              columnVisibility={columnVisibility}\r\n              setColumnVisibility={setColumnVisibility}\r\n              columnOrder={columnOrder}\r\n              setColumnOrder={setColumnOrder}\r\n              pinnedColumns={pinnedColumns}\r\n              setPinnedColumns={setPinnedColumns}\r\n              onResetToDefault={resetColumnLayout}\r\n            />\r\n          }\r\n        />\r\n      )}\r\n\r\n      {/* PageFilters */}\r\n      <PageFilters\r\n        searchValue={globalFilter}\r\n        onSearchChange={setGlobalFilter}\r\n        searchPlaceholder=\"Tìm kiếm phiếu chuyển kho...\"\r\n      >\r\n        <Select value={fromBranchFilter} onValueChange={setFromBranchFilter}>\r\n          <SelectTrigger className=\"w-full sm:w-[180px] h-9\">\r\n            <SelectValue placeholder=\"Chi nhánh chuyển\" />\r\n          </SelectTrigger>\r\n          <SelectContent>\r\n            <SelectItem value=\"all\">Tất cả CN chuyển</SelectItem>\r\n            {branches.map(b => (\r\n              <SelectItem key={b.systemId} value={b.systemId}>{b.name}</SelectItem>\r\n            ))}\r\n          </SelectContent>\r\n        </Select>\r\n\r\n        <Select value={toBranchFilter} onValueChange={setToBranchFilter}>\r\n          <SelectTrigger className=\"w-full sm:w-[180px] h-9\">\r\n            <SelectValue placeholder=\"Chi nhánh nhận\" />\r\n          </SelectTrigger>\r\n          <SelectContent>\r\n            <SelectItem value=\"all\">Tất cả CN nhận</SelectItem>\r\n            {branches.map(b => (\r\n              <SelectItem key={b.systemId} value={b.systemId}>{b.name}</SelectItem>\r\n            ))}\r\n          </SelectContent>\r\n        </Select>\r\n\r\n        <DataTableFacetedFilter\r\n          title=\"Trạng thái\"\r\n          options={statusOptions}\r\n          selectedValues={statusFilter}\r\n          onSelectedValuesChange={setStatusFilter}\r\n        />\r\n      </PageFilters>\r\n\r\n      {/* Data Table */}\r\n      <div className=\"w-full py-4\">\r\n        <ResponsiveDataTable\r\n          columns={columns}\r\n          data={paginatedData}\r\n          renderMobileCard={(transfer) => (\r\n            <StockTransferCard transfer={transfer} />\r\n          )}\r\n          pageCount={pageCount}\r\n          pagination={pagination}\r\n          setPagination={setPagination}\r\n          rowCount={filteredData.length}\r\n          rowSelection={rowSelection}\r\n          setRowSelection={setRowSelection}\r\n          allSelectedRows={allSelectedRows}\r\n          expanded={expanded}\r\n          setExpanded={setExpanded}\r\n          sorting={sorting}\r\n          setSorting={setSorting as React.Dispatch<React.SetStateAction<{ id: string; desc: boolean }>>}\r\n          columnVisibility={columnVisibility}\r\n          setColumnVisibility={setColumnVisibility}\r\n          columnOrder={columnOrder}\r\n          setColumnOrder={setColumnOrder}\r\n          pinnedColumns={pinnedColumns}\r\n          setPinnedColumns={setPinnedColumns}\r\n          onRowClick={handleRowClick}\r\n          bulkActions={bulkActions}\r\n        />\r\n      </div>\r\n\r\n      {/* Print Options Dialog */}\r\n      <SimplePrintOptionsDialog\r\n        open={printDialogOpen}\r\n        onOpenChange={setPrintDialogOpen}\r\n        onConfirm={handlePrintConfirm}\r\n        selectedCount={itemsToPrint.length}\r\n        title=\"In phiếu chuyển kho\"\r\n      />\r\n\r\n      {/* Import Dialog */}\r\n      <GenericImportDialogV2<StockTransfer>\r\n        open={showImportDialog}\r\n        onOpenChange={setShowImportDialog}\r\n        config={stockTransferImportExportConfig}\r\n        branches={branches.map(b => ({ systemId: b.systemId, name: b.name }))}\r\n        existingData={transfers}\r\n        onImport={handleImport}\r\n        currentUser={{\r\n          name: currentUser?.fullName || 'Hệ thống',\r\n          systemId: currentUser?.systemId || asSystemId('SYSTEM'),\r\n        }}\r\n      />\r\n\r\n      {/* Export Dialog */}\r\n      <GenericExportDialogV2<StockTransfer>\r\n        open={showExportDialog}\r\n        onOpenChange={setShowExportDialog}\r\n        config={stockTransferImportExportConfig}\r\n        allData={transfers}\r\n        filteredData={sortedData}\r\n        currentPageData={paginatedData}\r\n        selectedData={selectedTransfers}\r\n        currentUser={{\r\n          name: currentUser?.fullName || 'Hệ thống',\r\n          systemId: currentUser?.systemId || asSystemId('SYSTEM'),\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}