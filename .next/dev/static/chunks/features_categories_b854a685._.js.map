{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/categories/columns.tsx"],"sourcesContent":["import * as React from \"react\";\r\nimport type { ProductCategory } from '../settings/inventory/types';\r\nimport { Checkbox } from \"../../components/ui/checkbox\";\r\nimport { DataTableColumnHeader } from \"../../components/data-table/data-table-column-header\";\r\nimport { Badge } from \"../../components/ui/badge\";\r\nimport type { ColumnDef } from '../../components/data-table/types';\r\nimport { Button } from \"../../components/ui/button\";\r\nimport { Switch } from \"../../components/ui/switch\";\r\nimport { MoreHorizontal, Image as ImageIcon, Package, Pencil, CheckCircle, AlertTriangle, XCircle, RefreshCw, Search, AlignLeft, ExternalLink, Unlink, Globe, Link2, FolderEdit } from \"lucide-react\";\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger } from \"../../components/ui/dropdown-menu\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"../../components/ui/avatar\";\r\nimport { useProductStore } from '../products/store';\r\nimport { InlineEditableCell, InlineEditableNumberCell } from '../../components/shared/inline-editable-cell';\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"../../components/ui/alert-dialog\";\r\n\r\nconst formatDate = (dateString?: string) => {\r\n  if (!dateString) return '';\r\n  const date = new Date(dateString);\r\n  return new Intl.DateTimeFormat('vi-VN', {\r\n    day: '2-digit',\r\n    month: '2-digit',\r\n    year: 'numeric'\r\n  }).format(date);\r\n};\r\n\r\n// SEO Score calculation\r\nconst calculateSeoScore = (category: ProductCategory, website: 'pkgx' | 'trendtech'): number => {\r\n  const seo = category.websiteSeo?.[website];\r\n  if (!seo) return 0;\r\n  \r\n  let score = 0;\r\n  if (seo.seoTitle && seo.seoTitle.length >= 30) score += 25;\r\n  if (seo.metaDescription && seo.metaDescription.length >= 100) score += 25;\r\n  if (seo.seoKeywords) score += 15;\r\n  if (seo.shortDescription) score += 15;\r\n  if (seo.longDescription && seo.longDescription.length >= 200) score += 20;\r\n  \r\n  return score;\r\n};\r\n\r\nconst getSeoStatusBadge = (score: number) => {\r\n  if (score >= 80) return <Badge variant=\"default\" className=\"bg-green-100 text-green-800 hover:bg-green-100\"><CheckCircle className=\"h-3 w-3 mr-1\" /> {score}%</Badge>;\r\n  if (score >= 50) return <Badge variant=\"secondary\" className=\"bg-yellow-100 text-yellow-800 hover:bg-yellow-100\"><AlertTriangle className=\"h-3 w-3 mr-1\" /> {score}%</Badge>;\r\n  if (score > 0) return <Badge variant=\"secondary\" className=\"bg-red-100 text-red-800 hover:bg-red-100\"><XCircle className=\"h-3 w-3 mr-1\" /> {score}%</Badge>;\r\n  return <Badge variant=\"outline\" className=\"text-muted-foreground\">—</Badge>;\r\n};\r\n\r\n// ═══════════════════════════════════════════════════════════════\r\n// PKGX Actions Cell Component\r\n// ═══════════════════════════════════════════════════════════════\r\ntype PkgxActionsCellProps = {\r\n  row: ProductCategory;\r\n  hasPkgxMapping: boolean;\r\n  pkgxCatId?: number;\r\n  onPkgxSyncSeo?: (category: ProductCategory) => void;\r\n  onPkgxSyncDescription?: (category: ProductCategory) => void;\r\n  onPkgxSyncAll?: (category: ProductCategory) => void;\r\n  onPkgxSyncBasic?: (category: ProductCategory) => void;\r\n  onPkgxLink?: (category: ProductCategory) => void;\r\n  onPkgxUnlink?: (category: ProductCategory) => void;\r\n};\r\n\r\nfunction PkgxActionsCell({\r\n  row,\r\n  hasPkgxMapping,\r\n  pkgxCatId,\r\n  onPkgxSyncSeo,\r\n  onPkgxSyncDescription,\r\n  onPkgxSyncAll,\r\n  onPkgxSyncBasic,\r\n  onPkgxLink,\r\n  onPkgxUnlink,\r\n}: PkgxActionsCellProps) {\r\n  const [confirmAction, setConfirmAction] = React.useState<{\r\n    open: boolean;\r\n    title: string;\r\n    description: string;\r\n    action: (() => void) | null;\r\n  }>({ open: false, title: '', description: '', action: null });\r\n\r\n  const handleConfirm = (title: string, description: string, action: () => void) => {\r\n    setConfirmAction({ open: true, title, description, action });\r\n  };\r\n\r\n  const executeAction = () => {\r\n    if (confirmAction.action) {\r\n      confirmAction.action();\r\n    }\r\n    setConfirmAction({ open: false, title: '', description: '', action: null });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div className=\"flex items-center justify-center\" onClick={(e) => e.stopPropagation()}>\r\n        <DropdownMenu>\r\n          <DropdownMenuTrigger asChild onClick={(e) => e.stopPropagation()}>\r\n            <Button \r\n              variant=\"ghost\" \r\n              className={`h-8 w-8 p-0 ${hasPkgxMapping ? \"text-primary\" : \"text-muted-foreground\"}`}\r\n              onClick={(e) => e.stopPropagation()}\r\n            >\r\n              <span className=\"sr-only\">PKGX menu</span>\r\n              <MoreHorizontal className=\"h-4 w-4\" />\r\n            </Button>\r\n          </DropdownMenuTrigger>\r\n          <DropdownMenuContent align=\"end\" onClick={(e) => e.stopPropagation()}>\r\n            {hasPkgxMapping ? (\r\n              <>\r\n                {/* Sync All */}\r\n                {onPkgxSyncAll && (\r\n                  <DropdownMenuItem \r\n                    onSelect={() => handleConfirm(\r\n                      'Đồng bộ tất cả',\r\n                      `Bạn có chắc muốn đồng bộ TẤT CẢ thông tin danh mục \"${row.name}\" lên PKGX?`,\r\n                      () => onPkgxSyncAll(row)\r\n                    )}\r\n                    className=\"font-medium\"\r\n                    title=\"Đồng bộ: Keywords, Meta Title, Meta Desc, Mô tả ngắn, Mô tả dài\"\r\n                  >\r\n                    <RefreshCw className=\"mr-2 h-4 w-4\" />\r\n                    Đồng bộ tất cả\r\n                  </DropdownMenuItem>\r\n                )}\r\n                <DropdownMenuSeparator />\r\n                \r\n                {/* Individual sync actions */}\r\n                {onPkgxSyncSeo && (\r\n                  <DropdownMenuItem \r\n                    onSelect={() => handleConfirm(\r\n                      'Đồng bộ SEO',\r\n                      `Đồng bộ SEO (keywords, meta title, meta description) của \"${row.name}\" lên PKGX?`,\r\n                      () => onPkgxSyncSeo(row)\r\n                    )}\r\n                    title=\"Đồng bộ: Keywords, Meta Title, Meta Desc\"\r\n                  >\r\n                    <Search className=\"mr-2 h-4 w-4\" />\r\n                    SEO\r\n                  </DropdownMenuItem>\r\n                )}\r\n                {onPkgxSyncDescription && (\r\n                  <DropdownMenuItem \r\n                    onSelect={() => handleConfirm(\r\n                      'Đồng bộ mô tả',\r\n                      `Đồng bộ mô tả danh mục \"${row.name}\" lên PKGX?`,\r\n                      () => onPkgxSyncDescription(row)\r\n                    )}\r\n                    title=\"Đồng bộ: Mô tả ngắn (Short Desc), Mô tả dài (Long Desc)\"\r\n                  >\r\n                    <AlignLeft className=\"mr-2 h-4 w-4\" />\r\n                    Mô tả\r\n                  </DropdownMenuItem>\r\n                )}\r\n                {onPkgxSyncBasic && (\r\n                  <DropdownMenuItem \r\n                    onSelect={() => handleConfirm(\r\n                      'Đồng bộ thông tin cơ bản',\r\n                      `Đồng bộ thông tin cơ bản (Tên, Trạng thái hiển thị) của \"${row.name}\" lên PKGX?`,\r\n                      () => onPkgxSyncBasic(row)\r\n                    )}\r\n                    title=\"Đồng bộ: Tên danh mục, Trạng thái hiển thị\"\r\n                  >\r\n                    <FolderEdit className=\"mr-2 h-4 w-4\" />\r\n                    Thông tin cơ bản\r\n                  </DropdownMenuItem>\r\n                )}\r\n                \r\n                <DropdownMenuSeparator />\r\n                <DropdownMenuItem \r\n                  onSelect={() => window.open(`https://phukiengiaxuong.com.vn/admin/category.php?act=edit&cat_id=${pkgxCatId}`, '_blank')}\r\n                >\r\n                  <ExternalLink className=\"mr-2 h-4 w-4\" />\r\n                  Xem trên PKGX\r\n                </DropdownMenuItem>\r\n                \r\n                {/* Hủy liên kết */}\r\n                {onPkgxUnlink && (\r\n                  <>\r\n                    <DropdownMenuSeparator />\r\n                    <DropdownMenuItem \r\n                      onSelect={() => handleConfirm(\r\n                        'Hủy liên kết PKGX',\r\n                        `Bạn có chắc muốn hủy liên kết danh mục \"${row.name}\" với PKGX?`,\r\n                        () => onPkgxUnlink(row)\r\n                      )}\r\n                      className=\"text-destructive\"\r\n                    >\r\n                      <Unlink className=\"mr-2 h-4 w-4\" />\r\n                      Hủy liên kết\r\n                    </DropdownMenuItem>\r\n                  </>\r\n                )}\r\n              </>\r\n            ) : (\r\n              /* Not linked - show link option */\r\n              <>\r\n                {onPkgxLink && (\r\n                  <DropdownMenuItem onSelect={() => onPkgxLink(row)}>\r\n                    <Link2 className=\"mr-2 h-4 w-4\" />\r\n                    Liên kết với PKGX\r\n                  </DropdownMenuItem>\r\n                )}\r\n              </>\r\n            )}\r\n          </DropdownMenuContent>\r\n        </DropdownMenu>\r\n      </div>\r\n      \r\n      {/* Confirmation Dialog */}\r\n      <AlertDialog open={confirmAction.open} onOpenChange={(open) => !open && setConfirmAction({ open: false, title: '', description: '', action: null })}>\r\n        <AlertDialogContent onClick={(e) => e.stopPropagation()}>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{confirmAction.title}</AlertDialogTitle>\r\n            <AlertDialogDescription>{confirmAction.description}</AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel onClick={(e) => e.stopPropagation()}>Hủy</AlertDialogCancel>\r\n            <AlertDialogAction onClick={(e) => { e.stopPropagation(); executeAction(); }}>Xác nhận</AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n    </>\r\n  );\r\n}\r\n\r\nexport const getColumns = (\r\n  onDelete: (systemId: string) => void,\r\n  onToggleActive: (systemId: string, isActive: boolean) => void,\r\n  navigate: (path: string) => void,\r\n  allCategories: ProductCategory[], // Để tính số danh mục con\r\n  onUpdateName?: (systemId: string, name: string) => void, // Inline edit handler\r\n  onUpdateSortOrder?: (systemId: string, sortOrder: number) => void, // Sort order handler\r\n  // PKGX handlers\r\n  onPkgxSyncSeo?: (category: ProductCategory) => void,\r\n  onPkgxSyncDescription?: (category: ProductCategory) => void,\r\n  onPkgxSyncAll?: (category: ProductCategory) => void,\r\n  onPkgxSyncBasic?: (category: ProductCategory) => void,\r\n  hasPkgxMapping?: (category: ProductCategory) => boolean,\r\n  getPkgxCatId?: (category: ProductCategory) => number | undefined,\r\n  onPkgxLink?: (category: ProductCategory) => void,\r\n  onPkgxUnlink?: (category: ProductCategory) => void,\r\n): ColumnDef<ProductCategory>[] => {\r\n  // Get product counts per category - không dùng useMemo vì đây không phải React component\r\n  const productStore = useProductStore.getState();\r\n  const productCountByCategory: Record<string, number> = {};\r\n  productStore.data.forEach(p => {\r\n    if (p.categorySystemId && !p.isDeleted) {\r\n      productCountByCategory[String(p.categorySystemId)] = (productCountByCategory[String(p.categorySystemId)] || 0) + 1;\r\n    }\r\n  });\r\n\r\n  return [\r\n  {\r\n    id: \"select\",\r\n    header: ({ isAllPageRowsSelected, isSomePageRowsSelected, onToggleAll }) => (\r\n      <Checkbox\r\n        checked={isAllPageRowsSelected ? true : isSomePageRowsSelected ? \"indeterminate\" : false}\r\n        onCheckedChange={(value) => onToggleAll?.(!!value)}\r\n        aria-label=\"Select all\"\r\n      />\r\n    ),\r\n    cell: ({ onToggleSelect, isSelected }) => (\r\n      <Checkbox\r\n        checked={isSelected}\r\n        onCheckedChange={onToggleSelect}\r\n        aria-label=\"Select row\"\r\n      />\r\n    ),\r\n    size: 48,\r\n    meta: {\r\n      displayName: \"Chọn\",\r\n      sticky: \"left\",\r\n    }\r\n  },\r\n  // Thumbnail Image\r\n  {\r\n    id: \"thumbnailImage\",\r\n    accessorKey: \"thumbnailImage\",\r\n    header: \"Ảnh\",\r\n    cell: ({ row }) => {\r\n      const category = row as ProductCategory;\r\n      return (\r\n        <Avatar className=\"h-10 w-10 rounded-md\">\r\n          {category.thumbnailImage ? (\r\n            <AvatarImage src={category.thumbnailImage} alt={category.name} className=\"object-cover\" />\r\n          ) : null}\r\n          <AvatarFallback className=\"rounded-md bg-muted\">\r\n            <ImageIcon className=\"h-4 w-4 text-muted-foreground\" />\r\n          </AvatarFallback>\r\n        </Avatar>\r\n      );\r\n    },\r\n    size: 60,\r\n    meta: {\r\n      displayName: \"Ảnh\",\r\n      group: \"Thông tin cơ bản\"\r\n    },\r\n  },\r\n  // Mã danh mục\r\n  {\r\n    id: \"id\",\r\n    accessorKey: \"id\",\r\n    header: ({ sorting, setSorting }) => (\r\n      <DataTableColumnHeader \r\n        title=\"Mã\"\r\n        sortKey=\"id\"\r\n        isSorted={sorting?.id === 'id'}\r\n        sortDirection={sorting?.desc ? 'desc' : 'asc'}\r\n        onSort={() => setSorting?.((s: any) => ({ id: 'id', desc: s.id === 'id' ? !s.desc : false }))}\r\n      />\r\n    ),\r\n    cell: ({ row }) => {\r\n      const category = row as ProductCategory;\r\n      return (\r\n        <span className=\"font-mono text-xs text-muted-foreground\">\r\n          {category.id}\r\n        </span>\r\n      );\r\n    },\r\n    size: 100,\r\n    meta: {\r\n      displayName: \"Mã danh mục\",\r\n      group: \"Thông tin cơ bản\"\r\n    },\r\n  },\r\n  // Tên danh mục với indent + inline editing\r\n  {\r\n    id: \"name\",\r\n    accessorKey: \"name\",\r\n    header: ({ sorting, setSorting }) => (\r\n      <DataTableColumnHeader \r\n        title=\"Tên danh mục\"\r\n        sortKey=\"name\"\r\n        isSorted={sorting?.id === 'name'}\r\n        sortDirection={sorting?.desc ? 'desc' : 'asc'}\r\n        onSort={() => setSorting?.((s: any) => ({ id: 'name', desc: s.id === 'name' ? !s.desc : false }))}\r\n      />\r\n    ),\r\n    cell: ({ row }) => {\r\n      const category = row as ProductCategory;\r\n      const level = category.level ?? 0;\r\n      const indent = level * 24;\r\n      const hasMapping = hasPkgxMapping?.(category) ?? false;\r\n      \r\n      if (onUpdateName) {\r\n        return (\r\n          <div style={{ paddingLeft: `${indent}px` }} className=\"flex items-center gap-1\">\r\n            {level > 0 && <span className=\"text-muted-foreground/50\">└</span>}\r\n            <InlineEditableCell\r\n              value={category.name}\r\n              onSave={(newName) => onUpdateName(String(category.systemId), newName)}\r\n              inputClassName=\"h-7 text-sm w-48\"\r\n              renderDisplay={(value, onEdit) => (\r\n                <div className=\"flex items-center gap-2 group\">\r\n                  <span \r\n                    className=\"font-medium truncate cursor-pointer hover:text-primary\"\r\n                    onClick={() => navigate(`/categories/${category.systemId}`)}\r\n                  >\r\n                    {value}\r\n                  </span>\r\n                  {hasMapping && (\r\n                    <Badge variant=\"secondary\" className=\"text-xs\">\r\n                      <Globe className=\"h-3 w-3 mr-1\" />\r\n                      PKGX\r\n                    </Badge>\r\n                  )}\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"icon\"\r\n                    className=\"h-5 w-5 opacity-0 group-hover:opacity-100 transition-opacity shrink-0\"\r\n                    onClick={(e) => {\r\n                      e.stopPropagation();\r\n                      onEdit();\r\n                    }}\r\n                  >\r\n                    <Pencil className=\"h-3 w-3\" />\r\n                  </Button>\r\n                </div>\r\n              )}\r\n            />\r\n          </div>\r\n        );\r\n      }\r\n      \r\n      return (\r\n        <div \r\n          className=\"flex items-center gap-2 cursor-pointer hover:text-primary\"\r\n          style={{ paddingLeft: `${indent}px` }}\r\n          onClick={() => navigate(`/categories/${category.systemId}`)}\r\n        >\r\n          {level > 0 && <span className=\"text-muted-foreground/50\">└</span>}\r\n          <span className=\"font-medium truncate\">{category.name}</span>\r\n          {hasMapping && (\r\n            <Badge variant=\"secondary\" className=\"text-xs\">\r\n              <Globe className=\"h-3 w-3 mr-1\" />\r\n              PKGX\r\n            </Badge>\r\n          )}\r\n        </div>\r\n      );\r\n    },\r\n    size: 300,\r\n    meta: {\r\n      displayName: \"Tên danh mục\",\r\n      group: \"Thông tin cơ bản\"\r\n    },\r\n  },\r\n  // Thứ tự sắp xếp\r\n  {\r\n    id: \"sortOrder\",\r\n    accessorKey: \"sortOrder\",\r\n    header: ({ sorting, setSorting }) => (\r\n      <DataTableColumnHeader \r\n        title=\"STT\"\r\n        sortKey=\"sortOrder\"\r\n        isSorted={sorting?.id === 'sortOrder'}\r\n        sortDirection={sorting?.desc ? 'desc' : 'asc'}\r\n        onSort={() => setSorting?.((s: any) => ({ id: 'sortOrder', desc: s.id === 'sortOrder' ? !s.desc : false }))}\r\n      />\r\n    ),\r\n    cell: ({ row }) => {\r\n      const category = row as ProductCategory;\r\n      \r\n      if (onUpdateSortOrder) {\r\n        return (\r\n          <InlineEditableNumberCell\r\n            value={category.sortOrder ?? 0}\r\n            onSave={(newValue) => onUpdateSortOrder(String(category.systemId), newValue)}\r\n            inputClassName=\"h-7 w-16 text-center text-sm\"\r\n            renderDisplay={(value, onEdit) => (\r\n              <div \r\n                className=\"flex items-center justify-center cursor-pointer\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  onEdit();\r\n                }}\r\n              >\r\n                <Badge variant=\"outline\" className=\"font-mono text-xs hover:bg-muted transition-colors\">\r\n                  {value}\r\n                </Badge>\r\n              </div>\r\n            )}\r\n          />\r\n        );\r\n      }\r\n      \r\n      return (\r\n        <div className=\"flex items-center justify-center\">\r\n          <Badge variant=\"outline\" className=\"font-mono text-xs\">\r\n            {category.sortOrder ?? 0}\r\n          </Badge>\r\n        </div>\r\n      );\r\n    },\r\n    size: 70,\r\n    meta: {\r\n      displayName: \"Thứ tự\",\r\n      group: \"Thông tin cơ bản\"\r\n    },\r\n  },\r\n  // Cấp (Level)\r\n  {\r\n    id: \"level\",\r\n    accessorKey: \"level\",\r\n    header: ({ sorting, setSorting }) => (\r\n      <DataTableColumnHeader \r\n        title=\"Cấp\"\r\n        sortKey=\"level\"\r\n        isSorted={sorting?.id === 'level'}\r\n        sortDirection={sorting?.desc ? 'desc' : 'asc'}\r\n        onSort={() => setSorting?.((s: any) => ({ id: 'level', desc: s.id === 'level' ? !s.desc : false }))}\r\n      />\r\n    ),\r\n    cell: ({ row }) => {\r\n      const category = row as ProductCategory;\r\n      const level = category.level ?? 0;\r\n      return (\r\n        <Badge variant=\"outline\" className=\"font-mono\">\r\n          {level}\r\n        </Badge>\r\n      );\r\n    },\r\n    size: 70,\r\n    meta: {\r\n      displayName: \"Cấp\",\r\n      group: \"Phân cấp\"\r\n    },\r\n  },\r\n  // Số danh mục con\r\n  {\r\n    id: \"childCount\",\r\n    header: \"DM con\",\r\n    cell: ({ row }) => {\r\n      const category = row as ProductCategory;\r\n      const childCount = allCategories.filter(c => c.parentId === category.systemId && !c.isDeleted).length;\r\n      return childCount > 0 ? (\r\n        <Badge variant=\"secondary\">{childCount}</Badge>\r\n      ) : (\r\n        <span className=\"text-muted-foreground\">—</span>\r\n      );\r\n    },\r\n    size: 80,\r\n    meta: {\r\n      displayName: \"DM con\",\r\n      group: \"Phân cấp\"\r\n    },\r\n  },\r\n  // Số sản phẩm\r\n  {\r\n    id: \"productCount\",\r\n    header: () => (\r\n      <div className=\"flex items-center gap-1\">\r\n        <Package className=\"h-3.5 w-3.5\" />\r\n        <span>SP</span>\r\n      </div>\r\n    ),\r\n    cell: ({ row }) => {\r\n      const category = row as ProductCategory;\r\n      const count = productCountByCategory[String(category.systemId)] || 0;\r\n      return count > 0 ? (\r\n        <Badge variant=\"outline\" className=\"text-primary\">\r\n          {count}\r\n        </Badge>\r\n      ) : (\r\n        <span className=\"text-muted-foreground\">—</span>\r\n      );\r\n    },\r\n    size: 70,\r\n    meta: {\r\n      displayName: \"Sản phẩm\",\r\n      group: \"Thống kê\"\r\n    },\r\n  },\r\n  // SEO PKGX Status\r\n  {\r\n    id: \"seoPkgx\",\r\n    header: () => (\r\n      <div className=\"flex items-center gap-1\">\r\n        <span className=\"text-red-500\">●</span>\r\n        <span>PKGX</span>\r\n      </div>\r\n    ),\r\n    cell: ({ row }) => {\r\n      const category = row as ProductCategory;\r\n      const score = calculateSeoScore(category, 'pkgx');\r\n      return getSeoStatusBadge(score);\r\n    },\r\n    size: 90,\r\n    meta: {\r\n      displayName: \"SEO PKGX\",\r\n      group: \"SEO\"\r\n    },\r\n  },\r\n  // SEO Trendtech Status\r\n  {\r\n    id: \"seoTrendtech\",\r\n    header: () => (\r\n      <div className=\"flex items-center gap-1\">\r\n        <span className=\"text-blue-500\">●</span>\r\n        <span>Trendtech</span>\r\n      </div>\r\n    ),\r\n    cell: ({ row }) => {\r\n      const category = row as ProductCategory;\r\n      const score = calculateSeoScore(category, 'trendtech');\r\n      return getSeoStatusBadge(score);\r\n    },\r\n    size: 100,\r\n    meta: {\r\n      displayName: \"SEO Trendtech\",\r\n      group: \"SEO\"\r\n    },\r\n  },\r\n  // PKGX Status - Hiển thị trạng thái liên kết\r\n  {\r\n    id: \"pkgxStatus\",\r\n    header: \"Liên kết PKGX\",\r\n    cell: ({ row }) => {\r\n      const category = row as ProductCategory;\r\n      const hasMapping = hasPkgxMapping?.(category) ?? false;\r\n      const pkgxId = getPkgxCatId?.(category);\r\n      \r\n      return hasMapping ? (\r\n        <Badge variant=\"default\" className=\"bg-green-500 text-xs\">\r\n          <Globe className=\"h-3 w-3 mr-1\" />\r\n          {pkgxId}\r\n        </Badge>\r\n      ) : (\r\n        <Badge variant=\"secondary\" className=\"text-xs\">Chưa liên kết</Badge>\r\n      );\r\n    },\r\n    size: 110,\r\n    meta: {\r\n      displayName: \"Liên kết PKGX\",\r\n      group: \"PKGX\"\r\n    },\r\n  },\r\n  // Trạng thái - Switch\r\n  {\r\n    id: \"isActive\",\r\n    accessorKey: \"isActive\",\r\n    header: \"Trạng thái\",\r\n    cell: ({ row }) => {\r\n      const category = row as ProductCategory;\r\n      const isActive = category.isActive !== false;\r\n      return (\r\n        <div className=\"flex items-center\" onClick={(e) => e.stopPropagation()}>\r\n          <Switch\r\n            checked={isActive}\r\n            onCheckedChange={(checked) => onToggleActive(String(category.systemId), checked)}\r\n          />\r\n        </div>\r\n      );\r\n    },\r\n    size: 80,\r\n    meta: {\r\n      displayName: \"Trạng thái\",\r\n      group: \"Trạng thái\"\r\n    },\r\n  },\r\n  // Ngày tạo\r\n  {\r\n    id: \"createdAt\",\r\n    accessorKey: \"createdAt\",\r\n    header: ({ sorting, setSorting }) => (\r\n      <DataTableColumnHeader \r\n        title=\"Ngày tạo\"\r\n        sortKey=\"createdAt\"\r\n        isSorted={sorting?.id === 'createdAt'}\r\n        sortDirection={sorting?.desc ? 'desc' : 'asc'}\r\n        onSort={() => setSorting?.((s: any) => ({ id: 'createdAt', desc: s.id === 'createdAt' ? !s.desc : false }))}\r\n      />\r\n    ),\r\n    cell: ({ row }) => {\r\n      const category = row as ProductCategory;\r\n      return (\r\n        <span className=\"text-sm text-muted-foreground\">\r\n          {formatDate(category.createdAt)}\r\n        </span>\r\n      );\r\n    },\r\n    size: 110,\r\n    meta: {\r\n      displayName: \"Ngày tạo\",\r\n      group: \"Thời gian\"\r\n    },\r\n  },\r\n  // PKGX Actions Column\r\n  {\r\n    id: \"pkgx\",\r\n    header: \"PKGX\",\r\n    cell: ({ row }) => {\r\n      const category = row as ProductCategory;\r\n      const hasMapping = hasPkgxMapping?.(category) ?? false;\r\n      const pkgxId = getPkgxCatId?.(category);\r\n      \r\n      return (\r\n        <PkgxActionsCell\r\n          row={category}\r\n          hasPkgxMapping={hasMapping}\r\n          pkgxCatId={pkgxId}\r\n          onPkgxSyncSeo={onPkgxSyncSeo}\r\n          onPkgxSyncDescription={onPkgxSyncDescription}\r\n          onPkgxSyncAll={onPkgxSyncAll}\r\n          onPkgxSyncBasic={onPkgxSyncBasic}\r\n          onPkgxLink={onPkgxLink}\r\n          onPkgxUnlink={onPkgxUnlink}\r\n        />\r\n      );\r\n    },\r\n    size: 70,\r\n    meta: {\r\n      displayName: \"PKGX\",\r\n      group: \"PKGX\"\r\n    },\r\n  },\r\n  // Actions\r\n  {\r\n    id: \"actions\",\r\n    header: () => <span className=\"sr-only\">Thao tác</span>,\r\n    cell: ({ row }) => {\r\n      const category = row as ProductCategory;\r\n      \r\n      return (\r\n        <DropdownMenu>\r\n          <DropdownMenuTrigger asChild>\r\n            <Button variant=\"ghost\" className=\"h-8 w-8 p-0\">\r\n              <span className=\"sr-only\">Mở menu</span>\r\n              <MoreHorizontal className=\"h-4 w-4\" />\r\n            </Button>\r\n          </DropdownMenuTrigger>\r\n          <DropdownMenuContent align=\"end\">\r\n            <DropdownMenuItem onClick={() => navigate(`/categories/${category.systemId}`)}>\r\n              Xem chi tiết\r\n            </DropdownMenuItem>\r\n            <DropdownMenuItem onClick={() => navigate(`/categories/${category.systemId}/edit`)}>\r\n              Chỉnh sửa\r\n            </DropdownMenuItem>\r\n            <DropdownMenuSeparator />\r\n            <DropdownMenuItem \r\n              className=\"text-destructive\"\r\n              onClick={() => onDelete(String(category.systemId))}\r\n            >\r\n              Xóa danh mục\r\n            </DropdownMenuItem>\r\n          </DropdownMenuContent>\r\n        </DropdownMenu>\r\n      );\r\n    },\r\n    size: 60,\r\n    meta: {\r\n      displayName: \"Thao tác\",\r\n      sticky: \"right\",\r\n    }\r\n  },\r\n];\r\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1250, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/categories/card.tsx"],"sourcesContent":["import * as React from \"react\";\r\nimport type { ProductCategory } from '../settings/inventory/types';\r\nimport { Card, CardContent, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { Switch } from \"@/components/ui/switch\";\r\nimport { TouchButton } from \"@/components/mobile/touch-button\";\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\r\nimport { MoreHorizontal, Eye, Pencil, Trash2, Image as ImageIcon, MapPin } from \"lucide-react\";\r\n\r\nconst formatDate = (dateString?: string) => {\r\n  if (!dateString) return '';\r\n  const date = new Date(dateString);\r\n  return new Intl.DateTimeFormat('vi-VN', {\r\n    day: '2-digit',\r\n    month: '2-digit',\r\n    year: 'numeric'\r\n  }).format(date);\r\n};\r\n\r\n// SEO Score calculation\r\nconst calculateSeoScore = (category: ProductCategory, website: 'pkgx' | 'trendtech'): number => {\r\n  const seo = category.websiteSeo?.[website];\r\n  if (!seo) return 0;\r\n  \r\n  let score = 0;\r\n  if (seo.seoTitle && seo.seoTitle.length >= 30) score += 25;\r\n  if (seo.metaDescription && seo.metaDescription.length >= 100) score += 25;\r\n  if (seo.seoKeywords) score += 15;\r\n  if (seo.shortDescription) score += 15;\r\n  if (seo.longDescription && seo.longDescription.length >= 200) score += 20;\r\n  \r\n  return score;\r\n};\r\n\r\nconst getSeoStatusBadge = (score: number, website: string) => {\r\n  const color = website === 'pkgx' ? 'text-red-500' : 'text-blue-500';\r\n  if (score >= 80) return <Badge variant=\"outline\" className=\"text-green-600 text-[10px]\"><span className={color}>●</span> {score}%</Badge>;\r\n  if (score >= 50) return <Badge variant=\"outline\" className=\"text-yellow-600 text-[10px]\"><span className={color}>●</span> {score}%</Badge>;\r\n  if (score > 0) return <Badge variant=\"outline\" className=\"text-red-600 text-[10px]\"><span className={color}>●</span> {score}%</Badge>;\r\n  return null;\r\n};\r\n\r\nexport interface MobileCategoryCardProps {\r\n  category: ProductCategory;\r\n  childCount: number;\r\n  onDelete: (systemId: string) => void;\r\n  onToggleActive: (systemId: string, isActive: boolean) => void;\r\n  navigate: (path: string) => void;\r\n  handleRowClick: (category: ProductCategory) => void;\r\n}\r\n\r\nexport const MobileCategoryCard = ({ \r\n  category, \r\n  childCount,\r\n  onDelete, \r\n  onToggleActive, \r\n  navigate, \r\n  handleRowClick \r\n}: MobileCategoryCardProps) => {\r\n  const level = category.level ?? 0;\r\n  const pkgxScore = calculateSeoScore(category, 'pkgx');\r\n  const trendtechScore = calculateSeoScore(category, 'trendtech');\r\n\r\n  return (\r\n    <Card \r\n      className=\"hover:shadow-md transition-shadow cursor-pointer\"\r\n      onClick={() => handleRowClick(category)}\r\n    >\r\n      <CardContent className=\"p-4\">\r\n        {/* Header: Image + Name + Switch + Menu */}\r\n        <div className=\"flex items-start justify-between gap-3 mb-3\">\r\n          <div className=\"flex items-center gap-3 flex-1 min-w-0\">\r\n            {/* Thumbnail */}\r\n            <Avatar className=\"h-12 w-12 rounded-md flex-shrink-0\">\r\n              {category.thumbnailImage ? (\r\n                <AvatarImage src={category.thumbnailImage} alt={category.name} className=\"object-cover\" />\r\n              ) : null}\r\n              <AvatarFallback className=\"rounded-md bg-muted\">\r\n                <ImageIcon className=\"h-5 w-5 text-muted-foreground\" />\r\n              </AvatarFallback>\r\n            </Avatar>\r\n            \r\n            <div className=\"flex flex-col min-w-0\">\r\n              <div className=\"flex items-center gap-2 flex-wrap\">\r\n                <CardTitle className=\"font-semibold text-sm truncate\">{category.name}</CardTitle>\r\n              </div>\r\n              <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\r\n                <span className=\"font-mono\">{category.id}</span>\r\n                <span>•</span>\r\n                <span>Cấp {level}</span>\r\n                {childCount > 0 && (\r\n                  <>\r\n                    <span>•</span>\r\n                    <span>{childCount} danh mục con</span>\r\n                  </>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"flex items-center gap-2\">\r\n            {/* Switch trạng thái */}\r\n            <Switch\r\n              checked={category.isActive !== false}\r\n              onCheckedChange={(checked) => {\r\n                onToggleActive(String(category.systemId), checked);\r\n              }}\r\n              onClick={(e) => e.stopPropagation()}\r\n            />\r\n            \r\n            <DropdownMenu>\r\n              <DropdownMenuTrigger asChild>\r\n                <TouchButton\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  className=\"h-9 w-10 p-0 flex-shrink-0\"\r\n                  onClick={(e) => e.stopPropagation()}\r\n                >\r\n                  <MoreHorizontal className=\"h-4 w-4\" />\r\n                </TouchButton>\r\n              </DropdownMenuTrigger>\r\n              <DropdownMenuContent align=\"end\">\r\n                <DropdownMenuItem onClick={(e) => { e.stopPropagation(); navigate(`/categories/${category.systemId}`); }}>\r\n                  <Eye className=\"mr-2 h-4 w-4\" />\r\n                  Xem chi tiết\r\n                </DropdownMenuItem>\r\n                <DropdownMenuItem onClick={(e) => { e.stopPropagation(); navigate(`/categories/${category.systemId}/edit`); }}>\r\n                  <Pencil className=\"mr-2 h-4 w-4\" />\r\n                  Chỉnh sửa\r\n                </DropdownMenuItem>\r\n                <DropdownMenuSeparator />\r\n                <DropdownMenuItem \r\n                  className=\"text-destructive focus:text-destructive\"\r\n                  onClick={(e) => { e.stopPropagation(); onDelete(String(category.systemId)); }}\r\n                >\r\n                  <Trash2 className=\"mr-2 h-4 w-4\" />\r\n                  Xóa danh mục\r\n                </DropdownMenuItem>\r\n              </DropdownMenuContent>\r\n            </DropdownMenu>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Path (nếu có parent) */}\r\n        {category.path && level > 0 && (\r\n          <p className=\"text-xs text-muted-foreground mb-2 truncate flex items-center gap-1\">\r\n            <MapPin className=\"h-3 w-3\" /> {category.path}\r\n          </p>\r\n        )}\r\n\r\n        {/* Footer: SEO Status */}\r\n        {(pkgxScore > 0 || trendtechScore > 0) && (\r\n          <div className=\"flex items-center gap-2 mt-2 pt-2 border-t\">\r\n            <span className=\"text-xs text-muted-foreground\">SEO:</span>\r\n            {getSeoStatusBadge(pkgxScore, 'pkgx')}\r\n            {getSeoStatusBadge(trendtechScore, 'trendtech')}\r\n          </div>\r\n        )}\r\n\r\n        {/* Created date */}\r\n        <div className=\"text-[10px] text-muted-foreground mt-2\">\r\n          Tạo: {formatDate(category.createdAt)}\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1699, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/categories/hooks/use-pkgx-category-sync.ts"],"sourcesContent":["/**\r\n * Hook chứa tất cả các handlers để đồng bộ danh mục (Category) với PKGX\r\n * Tương tự như use-pkgx-sync.ts của products\r\n */\r\nimport React from 'react';\r\nimport { toast } from 'sonner';\r\nimport type { ProductCategory } from '@/features/settings/inventory/types';\r\nimport { updateCategory, updateCategoryBasic, getCategoryById } from '@/lib/pkgx/api-service';\r\nimport { usePkgxSettingsStore } from '@/features/settings/pkgx/store';\r\n\r\n// Types\r\ntype PkgxLogEntry = {\r\n  action: \r\n    | 'sync_category_seo'\r\n    | 'sync_category_description'\r\n    | 'sync_category_all'\r\n    | 'sync_category_basic';\r\n  status: 'success' | 'error' | 'partial' | 'info';\r\n  message: string;\r\n  details?: Record<string, unknown>;\r\n};\r\n\r\ntype UsePkgxCategorySyncOptions = {\r\n  addPkgxLog?: (entry: PkgxLogEntry) => void;\r\n};\r\n\r\n/**\r\n * Lấy pkgxCatId từ category mapping\r\n */\r\nfunction getPkgxCatId(category: ProductCategory, categoryMappings?: Array<{ hrmCategorySystemId: string; pkgxCatId: number }>) {\r\n  console.log('[getPkgxCatId] Input category:', { systemId: category.systemId, name: category.name });\r\n  console.log('[getPkgxCatId] Available mappings:', categoryMappings);\r\n  \r\n  if (!categoryMappings) {\r\n    console.log('[getPkgxCatId] No mappings found');\r\n    return undefined;\r\n  }\r\n  const mapping = categoryMappings.find(m => m.hrmCategorySystemId === category.systemId);\r\n  console.log('[getPkgxCatId] Found mapping:', mapping);\r\n  return mapping?.pkgxCatId;\r\n}\r\n\r\n/**\r\n * Hook cung cấp các handlers để đồng bộ Category với PKGX\r\n */\r\nexport function usePkgxCategorySync({ addPkgxLog }: UsePkgxCategorySyncOptions = {}) {\r\n  const { settings: pkgxSettings, updateCategory: updateCategoryInStore } = usePkgxSettingsStore();\r\n\r\n  // Default log function if not provided\r\n  const logAction = React.useCallback((entry: PkgxLogEntry) => {\r\n    if (addPkgxLog) {\r\n      addPkgxLog(entry);\r\n    }\r\n    console.log('[PKGX Category Sync]', entry.action, entry.status, entry.message);\r\n  }, [addPkgxLog]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // HELPER: Refresh category data từ PKGX sau khi sync thành công\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const refreshCategoryFromPkgx = React.useCallback(async (pkgxCatId: number) => {\r\n    try {\r\n      const response = await getCategoryById(pkgxCatId);\r\n      if (response.success && response.data?.data?.[0]) {\r\n        const data = response.data.data[0];\r\n        // Cập nhật vào store\r\n        updateCategoryInStore(pkgxCatId, {\r\n          id: data.cat_id,\r\n          name: data.cat_name,\r\n          parentId: data.parent_id || 0,\r\n          sortOrder: data.sort_order || 0,\r\n          isShow: data.is_show ?? 1,\r\n          cat_desc: data.cat_desc || '',\r\n          long_desc: data.long_desc || '',\r\n          keywords: data.keywords || '',\r\n          meta_title: data.meta_title || '',\r\n          meta_desc: data.meta_desc || '',\r\n          cat_alias: data.cat_alias || '',\r\n          style: data.style || '',\r\n          grade: data.grade || 0,\r\n        });\r\n        console.log('[PKGX Category Sync] Auto-refreshed category data from PKGX:', pkgxCatId);\r\n      }\r\n    } catch (error) {\r\n      console.warn('[PKGX Category Sync] Failed to refresh category data:', error);\r\n    }\r\n  }, [updateCategoryInStore]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // 1. SYNC SEO (keywords, meta_title, meta_desc)\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const handleSyncSeo = React.useCallback(async (category: ProductCategory) => {\r\n    const pkgxCatId = getPkgxCatId(category, pkgxSettings?.categoryMappings);\r\n    \r\n    if (!pkgxCatId) {\r\n      toast.error('Danh mục chưa được liên kết với PKGX. Vui lòng mapping trong Cài đặt > PKGX.');\r\n      return;\r\n    }\r\n    \r\n    toast.loading(`Đang đồng bộ SEO danh mục...`, { id: 'pkgx-category-sync-seo' });\r\n    \r\n    try {\r\n      const pkgxSeo = category.websiteSeo?.pkgx;\r\n      // Fallback chain: SEO PKGX → SEO Chung → name\r\n      // Category DB columns: keywords, meta_title, meta_desc (NO cat_alias, NO short_desc!)\r\n      const seoPayload = {\r\n        keywords: pkgxSeo?.seoKeywords || category.seoKeywords || category.name,\r\n        meta_title: pkgxSeo?.seoTitle || category.seoTitle || category.name,\r\n        meta_desc: pkgxSeo?.metaDescription || category.metaDescription || '',\r\n      };\r\n      \r\n      // DEBUG\r\n      console.log('[PKGX Category SEO Sync] Category:', category.name);\r\n      console.log('[PKGX Category SEO Sync] websiteSeo.pkgx:', pkgxSeo);\r\n      console.log('[PKGX Category SEO Sync] SEO Chung - seoKeywords:', category.seoKeywords);\r\n      console.log('[PKGX Category SEO Sync] Payload:', seoPayload);\r\n      console.log('[PKGX Category SEO Sync] Calling updateCategory with catId:', pkgxCatId);\r\n      \r\n      const response = await updateCategory(pkgxCatId, seoPayload);\r\n      \r\n      console.log('[PKGX Category SEO Sync] API Response:', response);\r\n      \r\n      if (response.success) {\r\n        // Auto-refresh để cập nhật store\r\n        await refreshCategoryFromPkgx(pkgxCatId);\r\n        \r\n        toast.success(`Đã đồng bộ SEO cho danh mục: ${category.name}`, { id: 'pkgx-category-sync-seo' });\r\n        logAction({\r\n          action: 'sync_category_seo',\r\n          status: 'success',\r\n          message: `Đã đồng bộ SEO: ${category.name}`,\r\n          details: { categoryId: category.systemId, pkgxCatId, payload: seoPayload },\r\n        });\r\n      } else {\r\n        throw new Error(response.error);\r\n      }\r\n    } catch (error) {\r\n      toast.error(`Lỗi đồng bộ SEO danh mục: ${error instanceof Error ? error.message : 'Unknown error'}`, { id: 'pkgx-category-sync-seo' });\r\n      logAction({\r\n        action: 'sync_category_seo',\r\n        status: 'error',\r\n        message: `Lỗi đồng bộ SEO: ${category.name}`,\r\n        details: { categoryId: category.systemId, error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    }\r\n  }, [pkgxSettings?.categoryMappings, logAction, refreshCategoryFromPkgx]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // 2. SYNC MÔ TẢ (cat_desc = longDescription)\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const handleSyncDescription = React.useCallback(async (category: ProductCategory) => {\r\n    const pkgxCatId = getPkgxCatId(category, pkgxSettings?.categoryMappings);\r\n    \r\n    if (!pkgxCatId) {\r\n      toast.error('Danh mục chưa được liên kết với PKGX. Vui lòng mapping trong Cài đặt > PKGX.');\r\n      return;\r\n    }\r\n    \r\n    toast.loading(`Đang đồng bộ mô tả danh mục...`, { id: 'pkgx-category-sync-desc' });\r\n    \r\n    try {\r\n      const pkgxSeo = category.websiteSeo?.pkgx;\r\n      // Category DB: cat_desc = mô tả ngắn, long_desc = mô tả dài (NO short_desc column!)\r\n      const descPayload = {\r\n        cat_desc: pkgxSeo?.shortDescription || category.shortDescription || '',\r\n        long_desc: pkgxSeo?.longDescription || category.longDescription || '',\r\n      };\r\n      \r\n      console.log('[PKGX Category Desc Sync] Payload:', descPayload);\r\n      \r\n      const response = await updateCategory(pkgxCatId, descPayload);\r\n      \r\n      if (response.success) {\r\n        // Auto-refresh để cập nhật store\r\n        await refreshCategoryFromPkgx(pkgxCatId);\r\n        \r\n        toast.success(`Đã đồng bộ mô tả cho danh mục: ${category.name}`, { id: 'pkgx-category-sync-desc' });\r\n        logAction({\r\n          action: 'sync_category_description',\r\n          status: 'success',\r\n          message: `Đã đồng bộ mô tả: ${category.name}`,\r\n          details: { categoryId: category.systemId, pkgxCatId },\r\n        });\r\n      } else {\r\n        throw new Error(response.error);\r\n      }\r\n    } catch (error) {\r\n      toast.error(`Lỗi đồng bộ mô tả danh mục: ${error instanceof Error ? error.message : 'Unknown error'}`, { id: 'pkgx-category-sync-desc' });\r\n      logAction({\r\n        action: 'sync_category_description',\r\n        status: 'error',\r\n        message: `Lỗi đồng bộ mô tả: ${category.name}`,\r\n        details: { categoryId: category.systemId, error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    }\r\n  }, [pkgxSettings?.categoryMappings, logAction, refreshCategoryFromPkgx]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // 3. SYNC TẤT CẢ (SEO + Mô tả + Slug)\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const handleSyncAll = React.useCallback(async (category: ProductCategory) => {\r\n    const pkgxCatId = getPkgxCatId(category, pkgxSettings?.categoryMappings);\r\n    \r\n    if (!pkgxCatId) {\r\n      toast.error('Danh mục chưa được liên kết với PKGX. Vui lòng mapping trong Cài đặt > PKGX.');\r\n      return;\r\n    }\r\n    \r\n    toast.loading(`Đang đồng bộ tất cả thông tin danh mục...`, { id: 'pkgx-category-sync-all' });\r\n    \r\n    try {\r\n      const pkgxSeo = category.websiteSeo?.pkgx;\r\n      \r\n      // Build full payload\r\n      // Category DB: cat_desc = mô tả ngắn, long_desc = mô tả dài (NO short_desc column!)\r\n      const fullPayload = {\r\n        // Basic info\r\n        cat_name: category.name,\r\n        cat_alias: pkgxSeo?.slug || category.slug || '',\r\n        // SEO fields - Fallback chain: SEO PKGX → SEO Chung → name\r\n        keywords: pkgxSeo?.seoKeywords || category.seoKeywords || category.name,\r\n        meta_title: pkgxSeo?.seoTitle || category.seoTitle || category.name,\r\n        meta_desc: pkgxSeo?.metaDescription || category.metaDescription || '',\r\n        // Descriptions\r\n        cat_desc: pkgxSeo?.shortDescription || category.shortDescription || '',\r\n        long_desc: pkgxSeo?.longDescription || category.longDescription || '',\r\n      };\r\n      \r\n      console.log('[PKGX Category Sync All] Payload:', fullPayload);\r\n      \r\n      const response = await updateCategory(pkgxCatId, fullPayload);\r\n      \r\n      if (response.success) {\r\n        // Auto-refresh để cập nhật store\r\n        await refreshCategoryFromPkgx(pkgxCatId);\r\n        \r\n        toast.success(`Đã đồng bộ tất cả thông tin danh mục: ${category.name}`, { id: 'pkgx-category-sync-all' });\r\n        logAction({\r\n          action: 'sync_category_all',\r\n          status: 'success',\r\n          message: `Đã đồng bộ tất cả: ${category.name}`,\r\n          details: { categoryId: category.systemId, pkgxCatId },\r\n        });\r\n      } else {\r\n        throw new Error(response.error);\r\n      }\r\n    } catch (error) {\r\n      toast.error(`Lỗi đồng bộ danh mục: ${error instanceof Error ? error.message : 'Unknown error'}`, { id: 'pkgx-category-sync-all' });\r\n      logAction({\r\n        action: 'sync_category_all',\r\n        status: 'error',\r\n        message: `Lỗi đồng bộ: ${category.name}`,\r\n        details: { categoryId: category.systemId, error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    }\r\n  }, [pkgxSettings?.categoryMappings, logAction, refreshCategoryFromPkgx]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // 4. SYNC BASIC (cat_name, is_show)\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const handleSyncBasic = React.useCallback(async (category: ProductCategory) => {\r\n    const pkgxCatId = getPkgxCatId(category, pkgxSettings?.categoryMappings);\r\n    \r\n    if (!pkgxCatId) {\r\n      toast.error('Danh mục chưa được liên kết với PKGX. Vui lòng mapping trong Cài đặt > PKGX.');\r\n      return;\r\n    }\r\n    \r\n    toast.loading(`Đang đồng bộ thông tin cơ bản danh mục...`, { id: 'pkgx-category-sync-basic' });\r\n    \r\n    try {\r\n      // Build payload - chỉ tên và trạng thái hiển thị\r\n      const basicPayload = {\r\n        cat_name: category.name,\r\n        is_show: category.isActive ? 1 : 0,\r\n      };\r\n      \r\n      console.log('[PKGX Category Basic Sync] Payload:', basicPayload);\r\n      \r\n      const response = await updateCategoryBasic(pkgxCatId, basicPayload);\r\n      \r\n      if (response.success) {\r\n        // Auto-refresh để cập nhật store\r\n        await refreshCategoryFromPkgx(pkgxCatId);\r\n        \r\n        toast.success(`Đã đồng bộ thông tin cơ bản danh mục: ${category.name}`, { id: 'pkgx-category-sync-basic' });\r\n        logAction({\r\n          action: 'sync_category_basic',\r\n          status: 'success',\r\n          message: `Đã đồng bộ thông tin cơ bản: ${category.name}`,\r\n          details: { categoryId: category.systemId, pkgxCatId, payload: basicPayload },\r\n        });\r\n      } else {\r\n        throw new Error(response.error);\r\n      }\r\n    } catch (error) {\r\n      toast.error(`Lỗi đồng bộ thông tin cơ bản: ${error instanceof Error ? error.message : 'Unknown error'}`, { id: 'pkgx-category-sync-basic' });\r\n      logAction({\r\n        action: 'sync_category_basic',\r\n        status: 'error',\r\n        message: `Lỗi đồng bộ thông tin cơ bản: ${category.name}`,\r\n        details: { categoryId: category.systemId, error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    }\r\n  }, [pkgxSettings?.categoryMappings, logAction, refreshCategoryFromPkgx]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // HELPER: Kiểm tra category có mapping với PKGX không\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const hasPkgxMapping = React.useCallback((category: ProductCategory) => {\r\n    return !!getPkgxCatId(category, pkgxSettings?.categoryMappings);\r\n  }, [pkgxSettings?.categoryMappings]);\r\n\r\n  return {\r\n    handleSyncSeo,\r\n    handleSyncDescription,\r\n    handleSyncAll,\r\n    handleSyncBasic,\r\n    hasPkgxMapping,\r\n    getPkgxCatId: (category: ProductCategory) => getPkgxCatId(category, pkgxSettings?.categoryMappings),\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2068, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/categories/components/pkgx-link-dialog.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Link2 } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { Button } from '@/components/ui/button';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog';\r\nimport { VirtualizedCombobox, type ComboboxOption } from '@/components/ui/virtualized-combobox';\r\nimport { usePkgxSettingsStore } from '@/features/settings/pkgx/store';\r\nimport type { ProductCategory } from '@/features/settings/inventory/types';\r\nimport type { PkgxCategory } from '@/features/settings/pkgx/types';\r\nimport { getCategories as fetchPkgxCategories } from '@/lib/pkgx/api-service';\r\n\r\ninterface PkgxCategoryLinkDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  category: ProductCategory | null;\r\n  onSuccess?: (pkgxCatId: number) => void;\r\n}\r\n\r\nexport function PkgxCategoryLinkDialog({\r\n  open,\r\n  onOpenChange,\r\n  category,\r\n  onSuccess,\r\n}: PkgxCategoryLinkDialogProps) {\r\n  const pkgxSettingsStore = usePkgxSettingsStore();\r\n  const cachedPkgxCategories = pkgxSettingsStore.settings.categories;\r\n  const categoryMappings = pkgxSettingsStore.settings.categoryMappings;\r\n  const addCategoryMapping = pkgxSettingsStore.addCategoryMapping;\r\n  const setCategories = pkgxSettingsStore.setCategories;\r\n  \r\n  const [selectedPkgxCategory, setSelectedPkgxCategory] = React.useState<ComboboxOption | null>(null);\r\n  const [pkgxCategories, setPkgxCategoriesLocal] = React.useState<PkgxCategory[]>([]);\r\n  const [isLoading, setIsLoading] = React.useState(false);\r\n  const [isSyncing, setIsSyncing] = React.useState(false);\r\n  const [hasFetched, setHasFetched] = React.useState(false);\r\n\r\n  // Load PKGX categories khi mở dialog - chỉ chạy 1 lần\r\n  React.useEffect(() => {\r\n    if (open && !hasFetched) {\r\n      if (cachedPkgxCategories && cachedPkgxCategories.length > 0) {\r\n        setPkgxCategoriesLocal(cachedPkgxCategories);\r\n        setHasFetched(true);\r\n      } else {\r\n        loadPkgxCategories();\r\n      }\r\n    }\r\n  }, [open, hasFetched, cachedPkgxCategories]);\r\n\r\n  // Reset state khi đóng dialog\r\n  React.useEffect(() => {\r\n    if (!open) {\r\n      setSelectedPkgxCategory(null);\r\n    }\r\n  }, [open]);\r\n\r\n  const loadPkgxCategories = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      const response = await fetchPkgxCategories();\r\n      if (response.success && response.data && response.data.data) {\r\n        // API trả về { error, message, total, data: PkgxCategoryFromApi[] }\r\n        // Cần map từ PkgxCategoryFromApi -> PkgxCategory\r\n        const categoriesArray = response.data.data.map(c => ({\r\n          id: c.cat_id,\r\n          name: c.cat_name,\r\n          parentId: c.parent_id || undefined,\r\n          cat_desc: c.cat_desc,\r\n          keywords: c.keywords,\r\n          cat_alias: c.cat_alias,\r\n          grade: c.grade,\r\n        }));\r\n        setPkgxCategoriesLocal(categoriesArray);\r\n        setCategories(categoriesArray); // Lưu vào store để dùng chung\r\n        setHasFetched(true);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load PKGX categories:', error);\r\n      toast.error('Không thể tải danh sách danh mục PKGX');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Filter out categories that are already linked\r\n  const linkedPkgxCatIds = React.useMemo(() => {\r\n    return new Set(categoryMappings.map(m => m.pkgxCatId));\r\n  }, [categoryMappings]);\r\n\r\n  // Convert PKGX categories to combobox options\r\n  const pkgxOptions: ComboboxOption[] = React.useMemo(() => {\r\n    return pkgxCategories\r\n      .filter(c => !linkedPkgxCatIds.has(c.id)) // Exclude already linked\r\n      .map(c => ({\r\n        value: String(c.id),\r\n        label: c.name,\r\n        subtitle: `ID: ${c.id}${c.parentId ? ` | Parent: ${c.parentId}` : ''}`,\r\n        metadata: c,\r\n      }));\r\n  }, [pkgxCategories, linkedPkgxCatIds]);\r\n\r\n  const handleConfirmLink = async () => {\r\n    if (!category || !selectedPkgxCategory) {\r\n      toast.error('Vui lòng chọn danh mục PKGX để liên kết');\r\n      return;\r\n    }\r\n\r\n    setIsSyncing(true);\r\n    try {\r\n      const pkgxCatId = Number(selectedPkgxCategory.value);\r\n      \r\n      // Add mapping to store\r\n      addCategoryMapping({\r\n        id: `category-mapping-${category.systemId}-${pkgxCatId}`,\r\n        hrmCategorySystemId: category.systemId,\r\n        hrmCategoryName: category.name,\r\n        pkgxCatId: pkgxCatId,\r\n        pkgxCatName: selectedPkgxCategory.label,\r\n      });\r\n      \r\n      // Log to console\r\n      console.log('[PKGX Category Link]', {\r\n        action: 'link_category',\r\n        status: 'success',\r\n        categoryId: category.systemId,\r\n        pkgxCatId,\r\n        pkgxCatName: selectedPkgxCategory.label,\r\n      });\r\n\r\n      toast.success(`Đã liên kết với danh mục PKGX: ${selectedPkgxCategory.label}`);\r\n      onSuccess?.(pkgxCatId);\r\n      onOpenChange(false);\r\n    } catch (error) {\r\n      console.error('[PKGX Category Link Error]', error);\r\n      toast.error('Lỗi khi liên kết danh mục');\r\n    } finally {\r\n      setIsSyncing(false);\r\n    }\r\n  };\r\n\r\n  if (!category) return null;\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-[500px]\">\r\n        <DialogHeader>\r\n          <DialogTitle>Liên kết với danh mục PKGX</DialogTitle>\r\n          <DialogDescription>\r\n            Chọn danh mục PKGX để liên kết với danh mục HRM này\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-4 py-4\">\r\n          {/* HRM Category Info */}\r\n          <div className=\"rounded-lg bg-muted p-3\">\r\n            <p className=\"text-sm font-medium\">Danh mục HRM:</p>\r\n            <p className=\"text-sm\">{category.name}</p>\r\n            <p className=\"text-xs text-muted-foreground\">\r\n              Mã: {category.id} | SystemID: {category.systemId}\r\n            </p>\r\n          </div>\r\n\r\n          {/* PKGX Category Selector */}\r\n          <div className=\"space-y-2\">\r\n            <label className=\"text-sm font-medium\">Chọn danh mục PKGX</label>\r\n            <VirtualizedCombobox\r\n              value={selectedPkgxCategory}\r\n              onChange={setSelectedPkgxCategory}\r\n              options={pkgxOptions}\r\n              placeholder=\"Tìm và chọn danh mục PKGX...\"\r\n              searchPlaceholder=\"Tìm theo tên...\"\r\n              emptyPlaceholder={isLoading ? 'Đang tải...' : 'Không tìm thấy danh mục PKGX'}\r\n              isLoading={isLoading}\r\n              disabled={isLoading}\r\n            />\r\n            {pkgxOptions.length === 0 && !isLoading && (\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                Tất cả danh mục PKGX đã được liên kết. Hãy đồng bộ danh sách mới từ PKGX.\r\n              </p>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <DialogFooter>\r\n          <Button\r\n            variant=\"outline\"\r\n            onClick={() => onOpenChange(false)}\r\n            disabled={isSyncing}\r\n          >\r\n            Hủy\r\n          </Button>\r\n          <Button\r\n            onClick={handleConfirmLink}\r\n            disabled={!selectedPkgxCategory || isSyncing}\r\n          >\r\n            <Link2 className=\"h-4 w-4 mr-2\" />\r\n            {isSyncing ? 'Đang liên kết...' : 'Liên kết'}\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2398, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/categories/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport * as React from \"react\";\r\nimport { useRouter } from 'next/navigation';\r\nimport { useShallow } from 'zustand/react/shallow';\r\nimport { useColumnVisibility, useColumnOrder, usePinnedColumns } from '@/hooks/use-column-visibility';\r\nimport { Plus, Power, PowerOff, Trash2, RefreshCw, Search, AlignLeft, ExternalLink, Link2, FolderEdit, FileUp, Download } from \"lucide-react\";\r\nimport { asSystemId, asBusinessId, type SystemId } from \"@/lib/id-types\";\r\nimport { usePageHeader } from \"../../contexts/page-header-context\";\r\nimport { useProductCategoryStore } from \"../settings/inventory/product-category-store\";\r\nimport type { ProductCategory } from \"../settings/inventory/types\";\r\nimport { Button } from \"../../components/ui/button\";\r\nimport { ResponsiveDataTable } from \"@/components/data-table/responsive-data-table\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\r\nimport { DataTableColumnCustomizer } from \"@/components/data-table/data-table-column-toggle\";\r\nimport { DataTableExportDialog } from \"@/components/data-table/data-table-export-dialog\";\r\nimport { DataTableFacetedFilter } from \"@/components/data-table/data-table-faceted-filter\";\r\nimport { PageToolbar } from \"@/components/layout/page-toolbar\";\r\nimport { PageFilters } from \"@/components/layout/page-filters\";\r\nimport { useMediaQuery } from \"@/lib/use-media-query\";\r\nimport { toast } from \"sonner\";\r\nimport Fuse from \"fuse.js\";\r\nimport { getColumns } from \"./columns\";\r\nimport { MobileCategoryCard } from \"./card\";\r\nimport { usePkgxCategorySync } from \"./hooks/use-pkgx-category-sync\";\r\nimport { usePkgxSettingsStore } from \"../settings/pkgx/store\";\r\nimport { updateCategory, updateCategoryBasic } from \"@/lib/pkgx/api-service\";\r\nimport { PkgxCategoryLinkDialog } from \"./components/pkgx-link-dialog\";\r\nimport { GenericImportDialogV2 } from \"../../components/shared/generic-import-dialog-v2\";\r\nimport { GenericExportDialogV2 } from \"../../components/shared/generic-export-dialog-v2\";\r\nimport { categoryImportExportConfig } from \"@/lib/import-export/configs/category.config\";\r\nimport { useAuth } from \"@/contexts/auth-context\";\r\n\r\nexport function ProductCategoriesPage() {\r\n  const router = useRouter();\r\n  const isMobile = useMediaQuery(\"(max-width: 768px)\");\r\n  const { employee: authEmployee } = useAuth();\r\n  \r\n  // ✅ Use shallow comparison to prevent unnecessary re-renders\r\n  const { data, add, update, remove, loadFromAPI } = useProductCategoryStore(\r\n    useShallow((state) => ({\r\n      data: state.data,\r\n      add: state.add,\r\n      update: state.update,\r\n      remove: state.remove,\r\n      loadFromAPI: state.loadFromAPI,\r\n    }))\r\n  );\r\n\r\n  // Load data from API on mount\r\n  React.useEffect(() => {\r\n    loadFromAPI();\r\n  }, [loadFromAPI]);\r\n\r\n  const activeCategories = React.useMemo(() => data.filter(c => !c.isDeleted), [data]);\r\n\r\n  // State\r\n  const [rowSelection, setRowSelection] = React.useState<Record<string, boolean>>({});\r\n  const [isAlertOpen, setIsAlertOpen] = React.useState(false);\r\n  const [idToDelete, setIdToDelete] = React.useState<string | null>(null);\r\n  const [isBulkDeleteAlertOpen, setIsBulkDeleteAlertOpen] = React.useState(false);\r\n\r\n  const [sorting, setSorting] = React.useState({ id: 'path', desc: false });\r\n  const [globalFilter, setGlobalFilter] = React.useState('');\r\n  const [debouncedGlobalFilter, setDebouncedGlobalFilter] = React.useState('');\r\n  const [pagination, setPagination] = React.useState({ pageIndex: 0, pageSize: 20 });\r\n  const [mobileLoadedCount, setMobileLoadedCount] = React.useState(20);\r\n  \r\n  const [columnVisibility, setColumnVisibility] = useColumnVisibility('categories', {});\r\n\r\n  // Column order and pinned columns - synced to database\r\n  const [columnOrder, setColumnOrder] = useColumnOrder('categories', []);\r\n  const [pinnedColumns, setPinnedColumns] = usePinnedColumns('categories', ['select', 'thumbnailImage', 'name']);\r\n\r\n  // Filters\r\n  const [statusFilter, setStatusFilter] = React.useState<Set<string>>(new Set());\r\n  const [levelFilter, setLevelFilter] = React.useState<Set<string>>(new Set());\r\n\r\n  // Debounce search\r\n  React.useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      setDebouncedGlobalFilter(globalFilter);\r\n    }, 300);\r\n    return () => clearTimeout(timer);\r\n  }, [globalFilter]);\r\n\r\n  // Handlers\r\n  const handleDelete = React.useCallback((systemId: string) => {\r\n    // Check if has children\r\n    const hasChildren = data.some(c => c.parentId === systemId && !c.isDeleted);\r\n    if (hasChildren) {\r\n      toast.error('Không thể xóa danh mục có danh mục con');\r\n      return;\r\n    }\r\n    setIdToDelete(systemId);\r\n    setIsAlertOpen(true);\r\n  }, [data]);\r\n\r\n  const handleToggleActive = React.useCallback((systemId: string, isActive: boolean) => {\r\n    update(asSystemId(systemId), { isActive });\r\n    toast.success(isActive ? 'Đã kích hoạt danh mục' : 'Đã tắt danh mục');\r\n  }, [update]);\r\n\r\n  // Inline edit handlers\r\n  const handleUpdateName = React.useCallback((systemId: string, name: string) => {\r\n    update(asSystemId(systemId), { name });\r\n    toast.success('Đã cập nhật tên danh mục');\r\n  }, [update]);\r\n\r\n  const handleUpdateSortOrder = React.useCallback((systemId: string, sortOrder: number) => {\r\n    update(asSystemId(systemId), { sortOrder });\r\n    toast.success('Đã cập nhật thứ tự');\r\n  }, [update]);\r\n\r\n  // Bulk actions\r\n  const handleBulkActivate = React.useCallback(() => {\r\n    const ids = Object.keys(rowSelection);\r\n    ids.forEach(id => update(asSystemId(id), { isActive: true }));\r\n    toast.success(`Đã kích hoạt ${ids.length} danh mục`);\r\n    setRowSelection({});\r\n  }, [rowSelection, update]);\r\n\r\n  const handleBulkDeactivate = React.useCallback(() => {\r\n    const ids = Object.keys(rowSelection);\r\n    ids.forEach(id => update(asSystemId(id), { isActive: false }));\r\n    toast.success(`Đã tắt ${ids.length} danh mục`);\r\n    setRowSelection({});\r\n  }, [rowSelection, update]);\r\n\r\n  const handleRowClick = React.useCallback((category: ProductCategory) => {\r\n    router.push(`/categories/${category.systemId}`);\r\n  }, [router]);\r\n\r\n  // PKGX Sync Hook\r\n  const { handleSyncSeo, handleSyncDescription, handleSyncAll, handleSyncBasic, hasPkgxMapping, getPkgxCatId } = usePkgxCategorySync();\r\n  const pkgxSettings = usePkgxSettingsStore((s) => s.settings);\r\n  const deleteCategoryMapping = usePkgxSettingsStore((s) => s.deleteCategoryMapping);\r\n  const getCategoryMappingByHrmId = usePkgxSettingsStore((s) => s.getCategoryMappingByHrmId);\r\n\r\n  // PKGX Link Dialog state\r\n  const [pkgxLinkDialogOpen, setPkgxLinkDialogOpen] = React.useState(false);\r\n  const [categoryToLink, setCategoryToLink] = React.useState<ProductCategory | null>(null);\r\n\r\n  // Import/Export Dialog states\r\n  const [isImportOpen, setIsImportOpen] = React.useState(false);\r\n  const [isExportOpen, setIsExportOpen] = React.useState(false);\r\n\r\n  // PKGX Link handlers\r\n  const handlePkgxLink = React.useCallback((category: ProductCategory) => {\r\n    setCategoryToLink(category);\r\n    setPkgxLinkDialogOpen(true);\r\n  }, []);\r\n\r\n  const handlePkgxUnlink = React.useCallback((category: ProductCategory) => {\r\n    const mapping = getCategoryMappingByHrmId(category.systemId);\r\n    if (mapping) {\r\n      deleteCategoryMapping(mapping.id);\r\n      toast.success(`Đã hủy liên kết danh mục \"${category.name}\" với PKGX`);\r\n    }\r\n  }, [getCategoryMappingByHrmId, deleteCategoryMapping]);\r\n\r\n  const handlePkgxLinkSuccess = React.useCallback(() => {\r\n    // Refresh handled by store update\r\n  }, []);\r\n\r\n  // Import handler\r\n  const handleImport = React.useCallback(async (importData: Partial<ProductCategory>[], mode: 'insert-only' | 'update-only' | 'upsert', _branchId?: string) => {\r\n    const results = {\r\n      success: 0,\r\n      failed: 0,\r\n      inserted: 0,\r\n      updated: 0,\r\n      skipped: 0,\r\n      errors: [] as Array<{ row: number; message: string }>,\r\n    };\r\n    \r\n    try {\r\n      for (let i = 0; i < importData.length; i++) {\r\n        const item = importData[i];\r\n        try {\r\n          // Check if category exists (by id)\r\n          const existingCategory = activeCategories.find(c => \r\n            item.id && c.id === item.id\r\n          );\r\n          \r\n          if (existingCategory) {\r\n            // Category exists\r\n            if (mode === 'insert-only') {\r\n              // Skip in insert-only mode\r\n              results.skipped++;\r\n              continue;\r\n            }\r\n            \r\n            // Update existing category\r\n            const updatedFields: Partial<ProductCategory> = {\r\n              ...item,\r\n              updatedAt: new Date().toISOString(),\r\n            };\r\n            // Remove fields that shouldn't be overwritten\r\n            delete (updatedFields as any).systemId;\r\n            delete (updatedFields as any).createdAt;\r\n            \r\n            // Recalculate path if parentId changed\r\n            if (item.parentId && item.parentId !== existingCategory.parentId) {\r\n              const parent = data.find(c => c.systemId === item.parentId);\r\n              if (parent) {\r\n                updatedFields.path = parent.path ? `${parent.path} > ${item.name || existingCategory.name}` : (item.name || existingCategory.name);\r\n                updatedFields.level = (parent.level ?? 0) + 1;\r\n              }\r\n            }\r\n            \r\n            update(existingCategory.systemId, updatedFields);\r\n            results.updated++;\r\n            results.success++;\r\n          } else {\r\n            // Category does not exist\r\n            if (mode === 'update-only') {\r\n              // Skip in update-only mode\r\n              results.skipped++;\r\n              continue;\r\n            }\r\n            \r\n            // Calculate path and level based on parentId\r\n            let path = item.name || '';\r\n            let level = 0;\r\n            if (item.parentId) {\r\n              const parent = data.find(c => c.systemId === item.parentId);\r\n              if (parent) {\r\n                path = parent.path ? `${parent.path} > ${item.name}` : (item.name || '');\r\n                level = (parent.level ?? 0) + 1;\r\n              }\r\n            }\r\n            \r\n            // Insert new category\r\n            const newCategory = {\r\n              ...item,\r\n              id: asBusinessId(item.id || `CAT-${Date.now()}`),\r\n              name: item.name || '',\r\n              path,\r\n              level,\r\n              sortOrder: item.sortOrder ?? 0,\r\n              isActive: item.isActive !== false,\r\n              isDeleted: false,\r\n              createdAt: new Date().toISOString(),\r\n              updatedAt: new Date().toISOString(),\r\n            } as Omit<ProductCategory, 'systemId'>;\r\n            \r\n            add(newCategory);\r\n            results.inserted++;\r\n            results.success++;\r\n          }\r\n        } catch (err) {\r\n          results.failed++;\r\n          results.errors.push({\r\n            row: i + 1,\r\n            message: err instanceof Error ? err.message : 'Lỗi không xác định',\r\n          });\r\n        }\r\n      }\r\n      \r\n      return results;\r\n    } catch (error) {\r\n      console.error('[Categories Importer] Lỗi nhập danh mục', error);\r\n      throw error;\r\n    }\r\n  }, [activeCategories, data, add, update]);\r\n\r\n  const columns = React.useMemo(() => getColumns(\r\n    handleDelete, \r\n    handleToggleActive, \r\n    (path: string) => router.push(path), \r\n    data,\r\n    handleUpdateName,\r\n    handleUpdateSortOrder,\r\n    // PKGX handlers\r\n    handleSyncSeo,\r\n    handleSyncDescription,\r\n    handleSyncAll,\r\n    handleSyncBasic,\r\n    hasPkgxMapping,\r\n    getPkgxCatId,\r\n    handlePkgxLink,\r\n    handlePkgxUnlink,\r\n  ), [handleDelete, handleToggleActive, router, data, handleUpdateName, handleUpdateSortOrder, handleSyncSeo, handleSyncDescription, handleSyncAll, handleSyncBasic, hasPkgxMapping, getPkgxCatId, handlePkgxLink, handlePkgxUnlink]);\r\n\r\n  // Export config\r\n  const exportConfig = {\r\n    fileName: 'Danh_muc_san_pham',\r\n    columns,\r\n  };\r\n\r\n  // Set default column visibility - only on mount\r\n  React.useEffect(() => {\r\n    // Skip if already has stored visibility (hook handles loading from database/localStorage)\r\n    if (Object.keys(columnVisibility).length > 0 && columnOrder.length > 0) return;\r\n    \r\n    const defaultVisibleColumns = ['thumbnailImage', 'id', 'name', 'sortOrder', 'level', 'childCount', 'productCount', 'seoPkgx', 'seoTrendtech', 'pkgxStatus', 'pkgx', 'isActive', 'createdAt'];\r\n    const columnIds = ['select', 'thumbnailImage', 'id', 'name', 'sortOrder', 'level', 'childCount', 'productCount', 'seoPkgx', 'seoTrendtech', 'pkgxStatus', 'pkgx', 'isActive', 'createdAt', 'actions'];\r\n    const initialVisibility: Record<string, boolean> = {};\r\n    columnIds.forEach(id => {\r\n      if (id === 'select' || id === 'actions') {\r\n        initialVisibility[id] = true;\r\n      } else {\r\n        initialVisibility[id] = defaultVisibleColumns.includes(id);\r\n      }\r\n    });\r\n    if (Object.keys(columnVisibility).length === 0) {\r\n      setColumnVisibility(initialVisibility);\r\n    }\r\n    if (columnOrder.length === 0) {\r\n      setColumnOrder(columnIds);\r\n    }\r\n  }, [columnVisibility, columnOrder]);\r\n\r\n  const fuse = React.useMemo(() => new Fuse(activeCategories, {\r\n    keys: [\"id\", \"name\", \"path\", \"slug\"],\r\n    threshold: 0.3,\r\n    ignoreLocation: true\r\n  }), [activeCategories]);\r\n\r\n  const confirmDelete = () => {\r\n    if (idToDelete) {\r\n      remove(asSystemId(idToDelete));\r\n      toast.success(\"Đã xóa danh mục\");\r\n    }\r\n    setIsAlertOpen(false);\r\n    setIdToDelete(null);\r\n  };\r\n\r\n  const confirmBulkDelete = () => {\r\n    const idsToDelete = Object.keys(rowSelection);\r\n    // Check for children\r\n    const hasChildrenIds = idsToDelete.filter(id => \r\n      data.some(c => c.parentId === id && !c.isDeleted)\r\n    );\r\n    if (hasChildrenIds.length > 0) {\r\n      toast.error('Không thể xóa danh mục có danh mục con');\r\n      return;\r\n    }\r\n    idsToDelete.forEach(id => remove(asSystemId(id)));\r\n    toast.success(`Đã xóa ${idsToDelete.length} danh mục`);\r\n    setRowSelection({});\r\n    setIsBulkDeleteAlertOpen(false);\r\n  };\r\n\r\n  // Filter options\r\n  const statusOptions = React.useMemo(() => [\r\n    { value: 'active', label: 'Hoạt động' },\r\n    { value: 'inactive', label: 'Tạm tắt' }\r\n  ], []);\r\n\r\n  const levelOptions = React.useMemo(() => {\r\n    const maxLevel = Math.max(...activeCategories.map(c => c.level ?? 0), 0);\r\n    return Array.from({ length: maxLevel + 1 }, (_, i) => ({\r\n      value: String(i),\r\n      label: `Cấp ${i}`\r\n    }));\r\n  }, [activeCategories]);\r\n\r\n  // Apply all filters\r\n  const filteredData = React.useMemo(() => {\r\n    let result = activeCategories;\r\n\r\n    // Status filter\r\n    if (statusFilter.size > 0) {\r\n      result = result.filter(c => {\r\n        const status = c.isActive !== false ? 'active' : 'inactive';\r\n        return statusFilter.has(status);\r\n      });\r\n    }\r\n\r\n    // Level filter\r\n    if (levelFilter.size > 0) {\r\n      result = result.filter(c => levelFilter.has(String(c.level ?? 0)));\r\n    }\r\n\r\n    // Text search (debounced)\r\n    if (debouncedGlobalFilter) {\r\n      const searchResults = fuse.search(debouncedGlobalFilter);\r\n      const searchIds = new Set(searchResults.map(r => r.item.systemId));\r\n      result = result.filter(c => searchIds.has(c.systemId));\r\n    }\r\n\r\n    return result;\r\n  }, [activeCategories, statusFilter, levelFilter, debouncedGlobalFilter, fuse]);\r\n\r\n  const sortedData = React.useMemo(() => {\r\n    const sorted = [...filteredData];\r\n    if (sorting.id) {\r\n      sorted.sort((a, b) => {\r\n        const aValue = (a as any)[sorting.id];\r\n        const bValue = (b as any)[sorting.id];\r\n        if (sorting.id === 'createdAt') {\r\n          const aTime = aValue ? new Date(aValue).getTime() : 0;\r\n          const bTime = bValue ? new Date(bValue).getTime() : 0;\r\n          return sorting.desc ? bTime - aTime : aTime - bTime;\r\n        }\r\n        if (sorting.id === 'level') {\r\n          const aNum = typeof aValue === 'number' ? aValue : 0;\r\n          const bNum = typeof bValue === 'number' ? bValue : 0;\r\n          return sorting.desc ? bNum - aNum : aNum - bNum;\r\n        }\r\n        if (aValue < bValue) return sorting.desc ? 1 : -1;\r\n        if (aValue > bValue) return sorting.desc ? -1 : 1;\r\n        return 0;\r\n      });\r\n    }\r\n    return sorted;\r\n  }, [filteredData, sorting]);\r\n\r\n  const allSelectedRows = React.useMemo(() =>\r\n    activeCategories.filter(c => rowSelection[String(c.systemId)]),\r\n    [activeCategories, rowSelection]);\r\n\r\n  // Mobile infinite scroll\r\n  React.useEffect(() => {\r\n    if (!isMobile) return;\r\n\r\n    const handleScroll = () => {\r\n      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\r\n      const scrollHeight = document.documentElement.scrollHeight;\r\n      const clientHeight = window.innerHeight;\r\n      const scrollPercentage = (scrollTop + clientHeight) / scrollHeight;\r\n\r\n      if (scrollPercentage > 0.8 && mobileLoadedCount < sortedData.length) {\r\n        setMobileLoadedCount(prev => Math.min(prev + 20, sortedData.length));\r\n      }\r\n    };\r\n\r\n    window.addEventListener('scroll', handleScroll);\r\n    return () => window.removeEventListener('scroll', handleScroll);\r\n  }, [isMobile, mobileLoadedCount, sortedData.length]);\r\n\r\n  // Reset mobile loaded count when filters change\r\n  React.useEffect(() => {\r\n    setMobileLoadedCount(20);\r\n  }, [debouncedGlobalFilter, statusFilter, levelFilter]);\r\n\r\n  const pageCount = Math.ceil(sortedData.length / pagination.pageSize);\r\n  const paginatedData = React.useMemo(() => sortedData.slice(pagination.pageIndex * pagination.pageSize, (pagination.pageIndex + 1) * pagination.pageSize), [sortedData, pagination]);\r\n\r\n  // Header actions\r\n  const headerActions = React.useMemo(() => [\r\n    <Button key=\"add\" size=\"sm\" className=\"h-9\" onClick={() => router.push('/categories/new')}>\r\n      <Plus className=\"mr-2 h-4 w-4\" />\r\n      Thêm danh mục\r\n    </Button>\r\n  ], [router]);\r\n\r\n  // Dùng auto-generated title từ PATH_PATTERNS\r\n  usePageHeader({\r\n    actions: headerActions,\r\n    showBackButton: false,\r\n  });\r\n\r\n  return (\r\n    <div className=\"space-y-4 h-full flex flex-col\">\r\n      {/* Desktop-only Toolbar */}\r\n      {!isMobile && (\r\n        <PageToolbar\r\n          leftActions={\r\n            <>\r\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setIsImportOpen(true)}>\r\n                <FileUp className=\"mr-2 h-4 w-4\" />\r\n                Nhập file\r\n              </Button>\r\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setIsExportOpen(true)}>\r\n                <Download className=\"mr-2 h-4 w-4\" />\r\n                Xuất Excel\r\n              </Button>\r\n            </>\r\n          }\r\n          rightActions={[\r\n            <DataTableColumnCustomizer\r\n              key=\"customizer\"\r\n              columns={columns}\r\n              columnVisibility={columnVisibility}\r\n              setColumnVisibility={setColumnVisibility}\r\n              columnOrder={columnOrder}\r\n              setColumnOrder={setColumnOrder}\r\n              pinnedColumns={pinnedColumns}\r\n              setPinnedColumns={setPinnedColumns}\r\n            />\r\n          ]}\r\n        />\r\n      )}\r\n\r\n      {/* Filters Row */}\r\n      <PageFilters\r\n        searchValue={globalFilter}\r\n        onSearchChange={setGlobalFilter}\r\n        searchPlaceholder=\"Tìm theo mã, tên danh mục...\"\r\n        rightFilters={\r\n          <>\r\n            <DataTableFacetedFilter\r\n              title=\"Cấp độ\"\r\n              options={levelOptions}\r\n              selectedValues={levelFilter}\r\n              onSelectedValuesChange={setLevelFilter}\r\n            />\r\n            <DataTableFacetedFilter\r\n              title=\"Trạng thái\"\r\n              options={statusOptions}\r\n              selectedValues={statusFilter}\r\n              onSelectedValuesChange={setStatusFilter}\r\n            />\r\n          </>\r\n        }\r\n      />\r\n\r\n      {/* Mobile View - Cards */}\r\n      {isMobile ? (\r\n        <div className=\"space-y-2 flex-1 overflow-y-auto\">\r\n          {sortedData.length === 0 ? (\r\n            <Card>\r\n              <CardContent className=\"p-8 text-center text-muted-foreground\">\r\n                Không tìm thấy danh mục nào\r\n              </CardContent>\r\n            </Card>\r\n          ) : (\r\n            <>\r\n              {sortedData.slice(0, mobileLoadedCount).map(category => (\r\n                <MobileCategoryCard\r\n                  key={String(category.systemId)}\r\n                  category={category}\r\n                  onDelete={handleDelete}\r\n                  onToggleActive={handleToggleActive}\r\n                  navigate={(path) => router.push(path)}\r\n                  handleRowClick={handleRowClick}\r\n                  childCount={data.filter(c => c.parentId === category.systemId && !c.isDeleted).length}\r\n                />\r\n              ))}\r\n              {mobileLoadedCount < sortedData.length && (\r\n                <Card>\r\n                  <CardContent className=\"p-4 text-center text-muted-foreground\">\r\n                    <div className=\"flex items-center justify-center gap-2\">\r\n                      <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-primary\"></div>\r\n                      <span>Đang tải thêm...</span>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              )}\r\n              {mobileLoadedCount >= sortedData.length && sortedData.length > 20 && (\r\n                <Card>\r\n                  <CardContent className=\"p-4 text-center text-muted-foreground text-sm\">\r\n                    Đã hiển thị tất cả {sortedData.length} danh mục\r\n                  </CardContent>\r\n                </Card>\r\n              )}\r\n            </>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        /* Desktop View - Table */\r\n        <div className=\"w-full py-4\">\r\n          <ResponsiveDataTable\r\n            columns={columns}\r\n            data={paginatedData}\r\n            pageCount={pageCount}\r\n            pagination={pagination}\r\n            setPagination={setPagination}\r\n            rowCount={sortedData.length}\r\n            rowSelection={rowSelection}\r\n            setRowSelection={setRowSelection}\r\n            onBulkDelete={() => setIsBulkDeleteAlertOpen(true)}\r\n            sorting={sorting}\r\n            setSorting={setSorting as React.Dispatch<React.SetStateAction<{ id: string; desc: boolean; }>>}\r\n            allSelectedRows={allSelectedRows}\r\n            bulkActions={[\r\n              {\r\n                label: 'Kích hoạt',\r\n                icon: Power,\r\n                onSelect: handleBulkActivate,\r\n              },\r\n              {\r\n                label: 'Tắt',\r\n                icon: PowerOff,\r\n                onSelect: handleBulkDeactivate,\r\n              },\r\n              {\r\n                label: 'Xóa',\r\n                icon: Trash2,\r\n                onSelect: () => setIsBulkDeleteAlertOpen(true),\r\n              },\r\n            ]}\r\n            pkgxBulkActions={[\r\n              {\r\n                label: \"Đồng bộ tất cả\",\r\n                icon: RefreshCw,\r\n                onSelect: async (selectedRows: ProductCategory[]) => {\r\n                  if (!pkgxSettings.enabled) {\r\n                    toast.error('PKGX chưa được bật');\r\n                    return;\r\n                  }\r\n                  \r\n                  const linkedCategories = selectedRows.filter(c => hasPkgxMapping(c));\r\n                  if (linkedCategories.length === 0) {\r\n                    toast.error('Không có danh mục nào đã liên kết PKGX');\r\n                    return;\r\n                  }\r\n                  \r\n                  if (!confirm(`Bạn có chắc muốn đồng bộ tất cả thông tin cho ${linkedCategories.length} danh mục?`)) {\r\n                    return;\r\n                  }\r\n                  \r\n                  toast.info(`Đang đồng bộ ${linkedCategories.length} danh mục...`);\r\n                  \r\n                  let successCount = 0;\r\n                  let errorCount = 0;\r\n                  \r\n                  for (const category of linkedCategories) {\r\n                    try {\r\n                      const pkgxCatId = getPkgxCatId(category);\r\n                      if (!pkgxCatId) continue;\r\n                      \r\n                      const pkgxSeo = category.websiteSeo?.pkgx;\r\n                      const payload = {\r\n                        cat_name: category.name,\r\n                        cat_alias: pkgxSeo?.slug || category.slug || '',\r\n                        keywords: pkgxSeo?.seoKeywords || category.seoKeywords || category.name,\r\n                        meta_title: pkgxSeo?.seoTitle || category.seoTitle || category.name,\r\n                        meta_desc: pkgxSeo?.metaDescription || category.metaDescription || '',\r\n                        short_desc: pkgxSeo?.shortDescription || category.shortDescription || '',\r\n                        cat_desc: pkgxSeo?.longDescription || category.longDescription || '',\r\n                      };\r\n                      \r\n                      const response = await updateCategory(pkgxCatId, payload);\r\n                      if (response.success) successCount++;\r\n                      else errorCount++;\r\n                    } catch {\r\n                      errorCount++;\r\n                    }\r\n                  }\r\n                  \r\n                  setRowSelection({});\r\n                  if (successCount > 0) toast.success(`Đã đồng bộ ${successCount} danh mục`);\r\n                  if (errorCount > 0) toast.error(`Lỗi ${errorCount} danh mục`);\r\n                }\r\n              },\r\n              {\r\n                label: \"SEO\",\r\n                icon: Search,\r\n                onSelect: async (selectedRows: ProductCategory[]) => {\r\n                  if (!pkgxSettings.enabled) {\r\n                    toast.error('PKGX chưa được bật');\r\n                    return;\r\n                  }\r\n                  \r\n                  const linkedCategories = selectedRows.filter(c => hasPkgxMapping(c));\r\n                  if (linkedCategories.length === 0) {\r\n                    toast.error('Không có danh mục nào đã liên kết PKGX');\r\n                    return;\r\n                  }\r\n                  \r\n                  toast.info(`Đang đồng bộ SEO ${linkedCategories.length} danh mục...`);\r\n                  \r\n                  let successCount = 0;\r\n                  let errorCount = 0;\r\n                  \r\n                  for (const category of linkedCategories) {\r\n                    try {\r\n                      const pkgxCatId = getPkgxCatId(category);\r\n                      if (!pkgxCatId) continue;\r\n                      \r\n                      const pkgxSeo = category.websiteSeo?.pkgx;\r\n                      const payload = {\r\n                        cat_alias: pkgxSeo?.slug || category.slug || '',\r\n                        keywords: pkgxSeo?.seoKeywords || category.seoKeywords || category.name,\r\n                        meta_title: pkgxSeo?.seoTitle || category.seoTitle || category.name,\r\n                        meta_desc: pkgxSeo?.metaDescription || category.metaDescription || '',\r\n                        short_desc: pkgxSeo?.shortDescription || category.shortDescription || '',\r\n                      };\r\n                      \r\n                      const response = await updateCategory(pkgxCatId, payload);\r\n                      if (response.success) successCount++;\r\n                      else errorCount++;\r\n                    } catch {\r\n                      errorCount++;\r\n                    }\r\n                  }\r\n                  \r\n                  setRowSelection({});\r\n                  if (successCount > 0) toast.success(`Đã đồng bộ SEO ${successCount} danh mục`);\r\n                  if (errorCount > 0) toast.error(`Lỗi ${errorCount} danh mục`);\r\n                }\r\n              },\r\n              {\r\n                label: \"Mô tả\",\r\n                icon: AlignLeft,\r\n                onSelect: async (selectedRows: ProductCategory[]) => {\r\n                  if (!pkgxSettings.enabled) {\r\n                    toast.error('PKGX chưa được bật');\r\n                    return;\r\n                  }\r\n                  \r\n                  const linkedCategories = selectedRows.filter(c => hasPkgxMapping(c));\r\n                  if (linkedCategories.length === 0) {\r\n                    toast.error('Không có danh mục nào đã liên kết PKGX');\r\n                    return;\r\n                  }\r\n                  \r\n                  toast.info(`Đang đồng bộ mô tả ${linkedCategories.length} danh mục...`);\r\n                  \r\n                  let successCount = 0;\r\n                  let errorCount = 0;\r\n                  \r\n                  for (const category of linkedCategories) {\r\n                    try {\r\n                      const pkgxCatId = getPkgxCatId(category);\r\n                      if (!pkgxCatId) continue;\r\n                      \r\n                      const pkgxSeo = category.websiteSeo?.pkgx;\r\n                      const payload = {\r\n                        cat_desc: pkgxSeo?.longDescription || category.longDescription || '',\r\n                        short_desc: pkgxSeo?.shortDescription || category.shortDescription || '',\r\n                      };\r\n                      \r\n                      const response = await updateCategory(pkgxCatId, payload);\r\n                      if (response.success) successCount++;\r\n                      else errorCount++;\r\n                    } catch {\r\n                      errorCount++;\r\n                    }\r\n                  }\r\n                  \r\n                  setRowSelection({});\r\n                  if (successCount > 0) toast.success(`Đã đồng bộ mô tả ${successCount} danh mục`);\r\n                  if (errorCount > 0) toast.error(`Lỗi ${errorCount} danh mục`);\r\n                }\r\n              },\r\n              {\r\n                label: \"Thông tin cơ bản\",\r\n                icon: FolderEdit,\r\n                onSelect: async (selectedRows: ProductCategory[]) => {\r\n                  if (!pkgxSettings.enabled) {\r\n                    toast.error('PKGX chưa được bật');\r\n                    return;\r\n                  }\r\n                  \r\n                  const linkedCategories = selectedRows.filter(c => hasPkgxMapping(c));\r\n                  if (linkedCategories.length === 0) {\r\n                    toast.error('Không có danh mục nào đã liên kết PKGX');\r\n                    return;\r\n                  }\r\n                  \r\n                  if (!confirm(`Bạn có chắc muốn đồng bộ thông tin cơ bản (Tên, Hiển thị) cho ${linkedCategories.length} danh mục?`)) {\r\n                    return;\r\n                  }\r\n                  \r\n                  toast.info(`Đang đồng bộ thông tin cơ bản ${linkedCategories.length} danh mục...`);\r\n                  \r\n                  let successCount = 0;\r\n                  let errorCount = 0;\r\n                  \r\n                  for (const category of linkedCategories) {\r\n                    try {\r\n                      const pkgxCatId = getPkgxCatId(category);\r\n                      if (!pkgxCatId) continue;\r\n                      \r\n                      const payload = {\r\n                        cat_name: category.name,\r\n                        is_show: category.isActive ? 1 : 0,\r\n                      };\r\n                      \r\n                      const response = await updateCategoryBasic(pkgxCatId, payload);\r\n                      if (response.success) successCount++;\r\n                      else errorCount++;\r\n                    } catch {\r\n                      errorCount++;\r\n                    }\r\n                  }\r\n                  \r\n                  setRowSelection({});\r\n                  if (successCount > 0) toast.success(`Đã đồng bộ thông tin cơ bản ${successCount} danh mục`);\r\n                  if (errorCount > 0) toast.error(`Lỗi ${errorCount} danh mục`);\r\n                }\r\n              },\r\n              {\r\n                label: \"Xem trên PKGX\",\r\n                icon: ExternalLink,\r\n                onSelect: (selectedRows: ProductCategory[]) => {\r\n                  const linkedCategories = selectedRows.filter(c => hasPkgxMapping(c));\r\n                  if (linkedCategories.length === 0) {\r\n                    toast.error('Không có danh mục nào đã liên kết PKGX');\r\n                    return;\r\n                  }\r\n                  const firstCategory = linkedCategories[0];\r\n                  const pkgxId = getPkgxCatId(firstCategory);\r\n                  if (pkgxId) {\r\n                    window.open(`https://phukiengiaxuong.com.vn/admin/category.php?act=edit&cat_id=${pkgxId}`, '_blank');\r\n                  }\r\n                }\r\n              },\r\n            ]}\r\n            expanded={{}}\r\n            setExpanded={() => {}}\r\n            columnVisibility={columnVisibility}\r\n            setColumnVisibility={setColumnVisibility}\r\n            columnOrder={columnOrder}\r\n            setColumnOrder={setColumnOrder}\r\n            pinnedColumns={pinnedColumns}\r\n            setPinnedColumns={setPinnedColumns}\r\n            onRowClick={handleRowClick}\r\n            renderMobileCard={(category) => (\r\n              <MobileCategoryCard\r\n                category={category}\r\n                onDelete={handleDelete}\r\n                onToggleActive={handleToggleActive}\r\n                navigate={(path) => router.push(path)}\r\n                handleRowClick={handleRowClick}\r\n                childCount={data.filter(c => c.parentId === category.systemId && !c.isDeleted).length}\r\n              />\r\n            )}\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      {/* Delete Alert Dialog */}\r\n      <AlertDialog open={isAlertOpen} onOpenChange={setIsAlertOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Xóa danh mục?</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              Danh mục sẽ bị xóa khỏi hệ thống. Hành động này không thể hoàn tác.\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>Đóng</AlertDialogCancel>\r\n            <AlertDialogAction onClick={confirmDelete}>Xóa</AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Bulk Delete Alert Dialog */}\r\n      <AlertDialog open={isBulkDeleteAlertOpen} onOpenChange={setIsBulkDeleteAlertOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Xóa {Object.keys(rowSelection).length} danh mục?</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              Các danh mục sẽ bị xóa khỏi hệ thống. Hành động này không thể hoàn tác.\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>Đóng</AlertDialogCancel>\r\n            <AlertDialogAction onClick={confirmBulkDelete}>Xóa tất cả</AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* PKGX Link Dialog */}\r\n      <PkgxCategoryLinkDialog\r\n        open={pkgxLinkDialogOpen}\r\n        onOpenChange={setPkgxLinkDialogOpen}\r\n        category={categoryToLink}\r\n        onSuccess={handlePkgxLinkSuccess}\r\n      />\r\n\r\n      {/* Import Dialog V2 */}\r\n      <GenericImportDialogV2<ProductCategory>\r\n        open={isImportOpen}\r\n        onOpenChange={setIsImportOpen}\r\n        config={categoryImportExportConfig}\r\n        existingData={activeCategories}\r\n        onImport={handleImport}\r\n        currentUser={authEmployee ? {\r\n          systemId: authEmployee.systemId,\r\n          name: authEmployee.fullName || authEmployee.id,\r\n        } : undefined}\r\n      />\r\n\r\n      {/* Export Dialog V2 */}\r\n      <GenericExportDialogV2<ProductCategory>\r\n        open={isExportOpen}\r\n        onOpenChange={setIsExportOpen}\r\n        config={categoryImportExportConfig}\r\n        allData={activeCategories}\r\n        filteredData={sortedData}\r\n        currentPageData={paginatedData}\r\n        selectedData={allSelectedRows}\r\n        currentUser={authEmployee ? {\r\n          systemId: authEmployee.systemId,\r\n          name: authEmployee.fullName || authEmployee.id,\r\n        } : { systemId: asSystemId('SYSTEM'), name: 'System' }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}