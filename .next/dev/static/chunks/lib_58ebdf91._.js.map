{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/id-types.ts"],"sourcesContent":["/**\r\n * Type-safe ID System\r\n * \r\n * Prevents mixing systemId with business ID at compile time\r\n */\r\n\r\n// Branded types for type safety\r\nexport type SystemId = string & { readonly __brand: 'SystemId' };\r\nexport type BusinessId = string & { readonly __brand: 'BusinessId' };\r\n\r\n/**\r\n * Create a SystemId from a string\r\n * Use this when you know for sure it's a systemId\r\n */\r\nexport function asSystemId(id: string): SystemId {\r\n  return id as SystemId;\r\n}\r\n\r\n/**\r\n * Create a BusinessId from a string\r\n * Use this when you know for sure it's a business ID\r\n */\r\nexport function asBusinessId(id: string): BusinessId {\r\n  return id as BusinessId;\r\n}\r\n\r\n/**\r\n * Check if a string is a valid systemId format\r\n */\r\nexport function isSystemIdFormat(id: string): boolean {\r\n  // SystemId: 8 digits + prefix (e.g., NV00000001, VOUCHER00000123)\r\n  return /^[A-Z]+\\d{8}$/.test(id);\r\n}\r\n\r\n/**\r\n * Check if a string is a valid business ID format\r\n */\r\nexport function isBusinessIdFormat(id: string): boolean {\r\n  // Business ID: shorter, variable length (e.g., NV001, PT000001)\r\n  return /^[A-Z]+\\d{3,6}$/.test(id);\r\n}\r\n\r\n/**\r\n * Safely convert unknown ID to proper type\r\n */\r\nexport function parseId(id: string): { type: 'system' | 'business'; value: SystemId | BusinessId } {\r\n  if (isSystemIdFormat(id)) {\r\n    return { type: 'system', value: asSystemId(id) };\r\n  }\r\n  if (isBusinessIdFormat(id)) {\r\n    return { type: 'business', value: asBusinessId(id) };\r\n  }\r\n  throw new Error(`Invalid ID format: ${id}`);\r\n}\r\n\r\n/**\r\n * ID Pair - Always keep systemId and businessId together\r\n */\r\nexport interface IDPair {\r\n  systemId: SystemId;\r\n  businessId: BusinessId;\r\n}\r\n\r\n/**\r\n * Entity with dual IDs\r\n */\r\nexport interface DualIDEntity {\r\n  systemId: SystemId;\r\n  id: BusinessId;\r\n}\r\n\r\n/**\r\n * Store methods with type-safe IDs\r\n */\r\nexport interface TypeSafeStore<T extends DualIDEntity> {\r\n  /** Find by systemId (for queries, relationships) */\r\n  findBySystemId(systemId: SystemId): T | null;\r\n  \r\n  /** Find by business ID (for user input, display) */\r\n  findByBusinessId(businessId: BusinessId): T | null;\r\n  \r\n  /** Update by systemId (always use systemId for updates) */\r\n  updateBySystemId(systemId: SystemId, updates: Partial<T>): void;\r\n  \r\n  /** Delete by systemId (always use systemId for deletes) */\r\n  deleteBySystemId(systemId: SystemId): void;\r\n}\r\n\r\n/**\r\n * Route params with type-safe IDs\r\n */\r\nexport interface RouteParams {\r\n  systemId?: SystemId;\r\n  id?: BusinessId;\r\n}\r\n\r\n/**\r\n * Link builder - always uses systemId\r\n */\r\nexport function buildEntityLink(path: string, entity: DualIDEntity): string {\r\n  return path.replace(':systemId', entity.systemId);\r\n}\r\n\r\n/**\r\n * Display ID - always uses business ID\r\n */\r\nexport function getDisplayId(entity: DualIDEntity): string {\r\n  return entity.id;\r\n}\r\n\r\n/**\r\n * Runtime guard: ensures a string is valid SystemId format and casts it\r\n * Logs warning if format is invalid\r\n */\r\nexport function ensureSystemId(id: string, context?: string): SystemId {\r\n  if (!isSystemIdFormat(id)) {\r\n    console.warn(`[ensureSystemId] Invalid SystemId format: \"${id}\"${context ? ` in ${context}` : ''}`);\r\n  }\r\n  return asSystemId(id);\r\n}\r\n\r\n/**\r\n * Runtime guard: ensures a string is valid BusinessId format and casts it\r\n * Logs warning if format is invalid\r\n */\r\nexport function ensureBusinessId(id: string, context?: string): BusinessId {\r\n  if (!isBusinessIdFormat(id)) {\r\n    console.warn(`[ensureBusinessId] Invalid BusinessId format: \"${id}\"${context ? ` in ${context}` : ''}`);\r\n  }\r\n  return asBusinessId(id);\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;CAIC,GAED,gCAAgC;;;;;;;;;;;;;;;;;;;;;AAQzB,SAAS,WAAW,EAAU;IACnC,OAAO;AACT;AAMO,SAAS,aAAa,EAAU;IACrC,OAAO;AACT;AAKO,SAAS,iBAAiB,EAAU;IACzC,kEAAkE;IAClE,OAAO,gBAAgB,IAAI,CAAC;AAC9B;AAKO,SAAS,mBAAmB,EAAU;IAC3C,gEAAgE;IAChE,OAAO,kBAAkB,IAAI,CAAC;AAChC;AAKO,SAAS,QAAQ,EAAU;IAChC,IAAI,iBAAiB,KAAK;QACxB,OAAO;YAAE,MAAM;YAAU,OAAO,WAAW;QAAI;IACjD;IACA,IAAI,mBAAmB,KAAK;QAC1B,OAAO;YAAE,MAAM;YAAY,OAAO,aAAa;QAAI;IACrD;IACA,MAAM,IAAI,MAAM,CAAC,mBAAmB,EAAE,IAAI;AAC5C;AA8CO,SAAS,gBAAgB,IAAY,EAAE,MAAoB;IAChE,OAAO,KAAK,OAAO,CAAC,aAAa,OAAO,QAAQ;AAClD;AAKO,SAAS,aAAa,MAAoB;IAC/C,OAAO,OAAO,EAAE;AAClB;AAMO,SAAS,eAAe,EAAU,EAAE,OAAgB;IACzD,IAAI,CAAC,iBAAiB,KAAK;QACzB,QAAQ,IAAI,CAAC,CAAC,2CAA2C,EAAE,GAAG,CAAC,EAAE,UAAU,CAAC,IAAI,EAAE,SAAS,GAAG,IAAI;IACpG;IACA,OAAO,WAAW;AACpB;AAMO,SAAS,iBAAiB,EAAU,EAAE,OAAgB;IAC3D,IAAI,CAAC,mBAAmB,KAAK;QAC3B,QAAQ,IAAI,CAAC,CAAC,+CAA+C,EAAE,GAAG,CAAC,EAAE,UAAU,CAAC,IAAI,EAAE,SAAS,GAAG,IAAI;IACxG;IACA,OAAO,aAAa;AACtB"}},
    {"offset": {"line": 83, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/smart-prefix.ts"],"sourcesContent":["/**\r\n * Smart Prefix System\r\n * Mapping entity types to their unique prefixes\r\n */\r\n\r\nexport const ENTITY_PREFIXES = {\r\n  // ========================================\r\n  // NH√ÇN S·ª∞ & T·ªî CH·ª®C (HR & ORGANIZATION)\r\n  // ========================================\r\n  'employees': 'NV',           // Nh√¢n vi√™n (Employee)\r\n  'departments': 'PB',         // Ph√≤ng ban (Department)\r\n  'branches': 'CN',            // Chi nh√°nh (Branch)\r\n  'job-titles': 'CV',          // Ch·ª©c v·ª• (Job Title)\r\n  \r\n  // ========================================\r\n  // KH√ÅCH H√ÄNG & ƒê·ªêI T√ÅC (CUSTOMERS & PARTNERS)\r\n  // ========================================\r\n  'customers': 'KH',           // Kh√°ch h√†ng (Customer)\r\n  'suppliers': 'NCC',          // Nh√† cung c·∫•p (Supplier)\r\n  'shipping-partners': 'DVVC', // ƒê∆°n v·ªã v·∫≠n chuy·ªÉn (Shipping Partner)\r\n  \r\n  // ========================================\r\n  // S·∫¢N PH·∫®M & KHO (PRODUCTS & INVENTORY)\r\n  // ========================================\r\n  'products': 'SP',            // S·∫£n ph·∫©m (Product)\r\n  'brands': 'TH',              // Th∆∞∆°ng hi·ªáu (Brand)\r\n  'categories': 'DM',          // Danh m·ª•c (Category)\r\n  'units': 'DVT',              // ƒê∆°n v·ªã t√≠nh (Unit)\r\n  'stock-locations': 'KHO',    // Kho h√†ng (Stock Location)\r\n  'inventory-receipts': 'NK',  // Nh·∫≠p kho (Inventory Receipt)\r\n  'inventory-checks': 'PKK',   // Phi·∫øu ki·ªÉm kho (Inventory Check)\r\n  'stock-transfers': 'PCK',    // Phi·∫øu chuy·ªÉn kho (Stock Transfer)\r\n  'stock-history': 'LS',       // L·ªãch s·ª≠ kho (Stock History)\r\n  \r\n  // ========================================\r\n  // B√ÅN H√ÄNG (SALES)\r\n  // ========================================\r\n  'orders': 'DH',              // ƒê∆°n h√†ng (Sales Order)\r\n  'sales-returns': 'TH',       // Tr·∫£ h√†ng (Sales Return)\r\n  'sales-channels': 'KENH',    // K√™nh b√°n h√†ng (Sales Channel)\r\n  'shipments': 'VC',           // V·∫≠n chuy·ªÉn (Shipment)\r\n  \r\n  // ========================================\r\n  // MUA H√ÄNG (PURCHASING)\r\n  // ========================================\r\n  'purchase-orders': 'PO',     // ƒê∆°n mua h√†ng (Purchase Order)\r\n  'purchase-returns': 'TM',    // Tr·∫£ mua (Purchase Return)\r\n  \r\n  // ========================================\r\n  // T√ÄI CH√çNH (FINANCE)\r\n  // ========================================\r\n  'receipts': 'PT',            // Phi·∫øu thu (Receipt)\r\n  'payments': 'PC',            // Phi·∫øu chi (Payment)\r\n  'voucher-receipt': 'PT',     // Alias phi·∫øu thu t·ª´ workflow voucher\r\n  'voucher-payment': 'PC',     // Alias phi·∫øu chi t·ª´ workflow voucher\r\n  'cashbook': 'SCT',           // S·ªï qu·ªπ (Cashbook)\r\n  'reconciliation': 'DT',      // ƒê·ªëi t√†i (Reconciliation)\r\n  \r\n  // C√†i ƒë·∫∑t t√†i ch√≠nh\r\n  'receipt-types': 'LT',       // Lo·∫°i thu (Receipt Type)\r\n  'payment-types': 'LC',       // Lo·∫°i chi (Payment Type)\r\n  'cash-accounts': 'TK',       // T√†i kho·∫£n ti·ªÅn (Cash Account)\r\n  'payment-methods': 'PTTT',   // Ph∆∞∆°ng th·ª©c thanh to√°n (Payment Method)\r\n  'pricing-settings': 'GIA',   // Ch√≠nh s√°ch gi√° (Pricing Policy)\r\n  'taxes': 'TAX',              // Thu·∫ø (Tax)\r\n  \r\n  // ========================================\r\n  // L∆Ø∆†NG & NH√ÇN S·ª∞ (PAYROLL & HR)\r\n  // ========================================\r\n  'payroll': 'BL',             // B·∫£ng l∆∞∆°ng (Payroll)\r\n  'payslips': 'PL',            // Phi·∫øu l∆∞∆°ng (Payslip)\r\n  'payroll-audit-log': 'PAL',  // Nh·∫≠t k√Ω payroll\r\n  'payroll-templates': 'BTP',  // M·∫´u b·∫£ng l∆∞∆°ng (Payroll Template)\r\n  'penalties': 'PF',           // Phi·∫øu ph·∫°t (Penalty)\r\n  'leaves': 'PN',              // Ph√©p ngh·ªâ (Leave)\r\n  'attendance': 'CC',          // Ch·∫•m c√¥ng (Attendance)\r\n  'duty-schedule': 'PC',       // Ph√¢n c√¥ng (Duty Schedule)\r\n  \r\n  // ========================================\r\n  // KPI & M·ª§C TI√äU (KPI & TARGETS)\r\n  // ========================================\r\n  'kpi': 'KPI',                // KPI\r\n  'target-groups': 'NHOM',     // Nh√≥m m·ª•c ti√™u (Target Group)\r\n  'other-targets': 'MT',       // M·ª•c ti√™u kh√°c (Other Target)\r\n  \r\n  // ========================================\r\n  // C√îNG VI·ªÜC & D·ªäCH V·ª§ (TASKS & SERVICES)\r\n  // ========================================\r\n  'internal-tasks': 'CVNB',    // C√¥ng vi·ªác n·ªôi b·ªô (Internal Task)\r\n  'task-templates': 'TMPL',    // M·∫´u c√¥ng vi·ªác (Task Template)\r\n  'custom-fields': 'FIELD',    // Tr∆∞·ªùng t√πy ch·ªânh (Custom Field)\r\n  'warranty': 'BH',            // B·∫£o h√†nh (Warranty)\r\n  'complaints': 'PKN',         // Khi·∫øu n·∫°i (Complaint)\r\n  \r\n  // ========================================\r\n  // C√ÄI ƒê·∫∂T & DANH M·ª§C (SETTINGS & CATEGORIES)\r\n  // ========================================\r\n  'provinces': 'TP',           // T·ªânh/Th√†nh ph·ªë (Province)\r\n  'districts': 'QH',           // Qu·∫≠n/Huy·ªán (District)\r\n  'wards': 'PX',               // Ph∆∞·ªùng/X√£ (Ward)\r\n  'wiki': 'TL',                // T√†i li·ªáu (Wiki)\r\n  'packaging': 'DG',           // ƒê√≥ng g√≥i (Packaging)\r\n  'audit-log': 'LOG',          // Nh·∫≠t k√Ω (Audit Log)\r\n  \r\n  // ========================================\r\n  // C√ÄI ƒê·∫∂T KH√ÅCH H√ÄNG (CUSTOMER SETTINGS)\r\n  // ========================================\r\n  'customer-types': 'LKH',     // Lo·∫°i kh√°ch h√†ng (Customer Type)\r\n  'customer-groups': 'NHKH',   // Nh√≥m kh√°ch h√†ng (Customer Group)\r\n  'customer-sources': 'NKH',   // Ngu·ªìn kh√°ch h√†ng (Customer Source)\r\n  'payment-terms': 'HTTT',     // H·∫°n thanh to√°n (Payment Term)\r\n  'credit-ratings': 'XHTD',    // X·∫øp h·∫°ng t√≠n d·ª•ng (Credit Rating)\r\n  'lifecycle-stages': 'GDL',   // Giai ƒëo·∫°n v√≤ng ƒë·ªùi kh√°ch h√†ng\r\n  'sla-settings': 'SLA',       // C√†i ƒë·∫∑t SLA kh√°ch h√†ng\r\n  \r\n  // ========================================\r\n  // C√ÄI ƒê·∫∂T NH√ÇN VI√äN (EMPLOYEE SETTINGS)\r\n  // ========================================\r\n  'employee-types': 'LNV',     // Lo·∫°i nh√¢n vi√™n (Employee Type)\r\n  'employee-statuses': 'TTNV', // Tr·∫°ng th√°i nh√¢n vi√™n (Employee Status)\r\n  'contract-types': 'LHD',     // Lo·∫°i h·ª£p ƒë·ªìng (Contract Type)\r\n  'work-shifts': 'CA',         // Ca l√†m vi·ªác (Work Shift)\r\n  'leave-types': 'LP',         // Lo·∫°i ngh·ªâ ph√©p (Leave Type)\r\n  'salary-components': 'SC',   // Th√†nh ph·∫ßn l∆∞∆°ng (Salary Component)\r\n  \r\n  // ========================================\r\n  // C√ÄI ƒê·∫∂T KH√ÅC (OTHER SETTINGS)\r\n  // ========================================\r\n  'settings': 'CFG',           // C·∫•u h√¨nh (Configuration)\r\n  \r\n  // ========================================\r\n  // AUTHENTICATION & USERS\r\n  // ========================================\r\n  'users': 'USER',             // User accounts (for admin management)\r\n  \r\n} as const;\r\n\r\nexport type EntityType = keyof typeof ENTITY_PREFIXES;\r\n\r\n/**\r\n * Get prefix for an entity type\r\n */\r\nexport function getPrefix(entityType: EntityType): string {\r\n  return ENTITY_PREFIXES[entityType];\r\n}\r\n\r\n/**\r\n * Get all entity types\r\n */\r\nexport function getAllEntityTypes(): EntityType[] {\r\n  return Object.keys(ENTITY_PREFIXES) as EntityType[];\r\n}\r\n\r\n/**\r\n * Check if an entity type exists\r\n */\r\nexport function isValidEntityType(entityType: string): entityType is EntityType {\r\n  return entityType in ENTITY_PREFIXES;\r\n}\r\n\r\n/**\r\n * Get entity type from prefix\r\n */\r\nexport function getEntityTypeFromPrefix(prefix: string): EntityType | null {\r\n  const entry = Object.entries(ENTITY_PREFIXES).find(([_, p]) => p === prefix);\r\n  return entry ? (entry[0] as EntityType) : null;\r\n}\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;;;;;AAEM,MAAM,kBAAkB;IAC7B,2CAA2C;IAC3C,wCAAwC;IACxC,2CAA2C;IAC3C,aAAa;IACb,eAAe;IACf,YAAY;IACZ,cAAc;IAEd,2CAA2C;IAC3C,8CAA8C;IAC9C,2CAA2C;IAC3C,aAAa;IACb,aAAa;IACb,qBAAqB;IAErB,2CAA2C;IAC3C,wCAAwC;IACxC,2CAA2C;IAC3C,YAAY;IACZ,UAAU;IACV,cAAc;IACd,SAAS;IACT,mBAAmB;IACnB,sBAAsB;IACtB,oBAAoB;IACpB,mBAAmB;IACnB,iBAAiB;IAEjB,2CAA2C;IAC3C,mBAAmB;IACnB,2CAA2C;IAC3C,UAAU;IACV,iBAAiB;IACjB,kBAAkB;IAClB,aAAa;IAEb,2CAA2C;IAC3C,wBAAwB;IACxB,2CAA2C;IAC3C,mBAAmB;IACnB,oBAAoB;IAEpB,2CAA2C;IAC3C,sBAAsB;IACtB,2CAA2C;IAC3C,YAAY;IACZ,YAAY;IACZ,mBAAmB;IACnB,mBAAmB;IACnB,YAAY;IACZ,kBAAkB;IAElB,oBAAoB;IACpB,iBAAiB;IACjB,iBAAiB;IACjB,iBAAiB;IACjB,mBAAmB;IACnB,oBAAoB;IACpB,SAAS;IAET,2CAA2C;IAC3C,iCAAiC;IACjC,2CAA2C;IAC3C,WAAW;IACX,YAAY;IACZ,qBAAqB;IACrB,qBAAqB;IACrB,aAAa;IACb,UAAU;IACV,cAAc;IACd,iBAAiB;IAEjB,2CAA2C;IAC3C,iCAAiC;IACjC,2CAA2C;IAC3C,OAAO;IACP,iBAAiB;IACjB,iBAAiB;IAEjB,2CAA2C;IAC3C,yCAAyC;IACzC,2CAA2C;IAC3C,kBAAkB;IAClB,kBAAkB;IAClB,iBAAiB;IACjB,YAAY;IACZ,cAAc;IAEd,2CAA2C;IAC3C,6CAA6C;IAC7C,2CAA2C;IAC3C,aAAa;IACb,aAAa;IACb,SAAS;IACT,QAAQ;IACR,aAAa;IACb,aAAa;IAEb,2CAA2C;IAC3C,yCAAyC;IACzC,2CAA2C;IAC3C,kBAAkB;IAClB,mBAAmB;IACnB,oBAAoB;IACpB,iBAAiB;IACjB,kBAAkB;IAClB,oBAAoB;IACpB,gBAAgB;IAEhB,2CAA2C;IAC3C,wCAAwC;IACxC,2CAA2C;IAC3C,kBAAkB;IAClB,qBAAqB;IACrB,kBAAkB;IAClB,eAAe;IACf,eAAe;IACf,qBAAqB;IAErB,2CAA2C;IAC3C,gCAAgC;IAChC,2CAA2C;IAC3C,YAAY;IAEZ,2CAA2C;IAC3C,yBAAyB;IACzB,2CAA2C;IAC3C,SAAS;AAEX;AAOO,SAAS,UAAU,UAAsB;IAC9C,OAAO,eAAe,CAAC,WAAW;AACpC;AAKO,SAAS;IACd,OAAO,OAAO,IAAI,CAAC;AACrB;AAKO,SAAS,kBAAkB,UAAkB;IAClD,OAAO,cAAc;AACvB;AAKO,SAAS,wBAAwB,MAAc;IACpD,MAAM,QAAQ,OAAO,OAAO,CAAC,iBAAiB,IAAI,CAAC,CAAC,CAAC,GAAG,EAAE,GAAK,MAAM;IACrE,OAAO,QAAS,KAAK,CAAC,EAAE,GAAkB;AAC5C"}},
    {"offset": {"line": 234, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/id-config.ts"],"sourcesContent":["/**\r\n * ‚ö° ENTERPRISE ID MANAGEMENT SYSTEM v2.0\r\n * \r\n * SINGLE SOURCE OF TRUTH - Synced with smart-prefix.ts\r\n * \r\n * Features:\r\n * - 60+ entity configurations\r\n * - TypeScript branded types (SystemId, BusinessId)\r\n * - Category grouping for UI\r\n * - Validation rules\r\n * - Store factory integration\r\n * - Backward compatibility\r\n * \r\n * @version 2.0.0\r\n * @date 2025-11-10\r\n */\r\n\r\nimport { ENTITY_PREFIXES, type EntityType } from './smart-prefix';\r\n\r\n// Re-export EntityType for external use\r\nexport type { EntityType };\r\n\r\n// ========================================\r\n// üè∑Ô∏è BRANDED TYPES FOR TYPE SAFETY\r\n// ========================================\r\n\r\n/**\r\n * SystemId - Internal unique identifier (6 digits)\r\n * Used for: Database queries, foreign keys, routing\r\n * Example: \"EMP000001\", \"CUSTOMER000001\", \"ORDER000001\"\r\n */\r\nexport type SystemId = string & { readonly __brand: 'SystemId' };\r\n\r\n/**\r\n * BusinessId - User-facing display identifier (6 digits)\r\n * Used for: UI display, breadcrumbs, user communication\r\n * Example: \"NV000001\", \"KH000001\", \"DH000001\"\r\n */\r\nexport type BusinessId = string & { readonly __brand: 'BusinessId' };\r\n\r\n/**\r\n * Create a branded SystemId (use with caution - prefer auto-generation)\r\n */\r\nexport function createSystemId(id: string): SystemId {\r\n  return id as SystemId;\r\n}\r\n\r\n/**\r\n * Create a branded BusinessId (use with caution - prefer auto-generation)\r\n */\r\nexport function createBusinessId(id: string): BusinessId {\r\n  return id as BusinessId;\r\n}\r\n\r\nexport interface FormattedCounterInfo {\r\n  currentBusinessCounter: number;\r\n  currentSystemCounter: number;\r\n  nextBusinessId: BusinessId;\r\n  nextSystemId: SystemId;\r\n  digitCount: number;\r\n  prefix: string;\r\n  systemIdPrefix: string;\r\n  displayName: string;\r\n}\r\n\r\nexport function formatCounterInfo(\r\n  entityType: EntityType,\r\n  counters?: { business?: number | null; system?: number | null }\r\n): FormattedCounterInfo {\r\n  const config = ID_CONFIG[entityType];\r\n  if (!config) {\r\n    throw new Error(`Unknown entity type: ${entityType}`);\r\n  }\r\n\r\n  const currentBusinessCounter = Math.max(0, counters?.business ?? 0);\r\n  const currentSystemCounter = Math.max(0, counters?.system ?? currentBusinessCounter);\r\n  const nextBusinessCounter = currentBusinessCounter + 1;\r\n  const nextSystemCounter = currentSystemCounter + 1;\r\n  const paddedBusiness = String(nextBusinessCounter).padStart(config.digitCount, '0');\r\n  const paddedSystem = String(nextSystemCounter).padStart(config.digitCount, '0');\r\n\r\n  return {\r\n    currentBusinessCounter,\r\n    currentSystemCounter,\r\n    nextBusinessId: createBusinessId(`${config.prefix}${paddedBusiness}`),\r\n    nextSystemId: createSystemId(`${config.systemIdPrefix}${paddedSystem}`),\r\n    digitCount: config.digitCount,\r\n    prefix: config.prefix,\r\n    systemIdPrefix: config.systemIdPrefix,\r\n    displayName: config.displayName,\r\n  };\r\n}\r\n\r\n// ========================================\r\n// üìã CONFIGURATION INTERFACE\r\n// ========================================\r\n\r\nexport interface EntityIDConfig {\r\n  /** Entity type identifier */\r\n  entityType: EntityType;\r\n  \r\n  /** Prefix for business ID (user-facing) - from smart-prefix.ts */\r\n  prefix: string;\r\n  \r\n  /** Prefix for system ID (internal) - usually same or 'entity-name' */\r\n  systemIdPrefix: string;\r\n  \r\n  /** Number of digits for business ID (e.g., 6 ‚Üí NV000001) */\r\n  digitCount: number;\r\n  \r\n  /** Display name (Vietnamese) */\r\n  displayName: string;\r\n  \r\n  /** Category for settings UI grouping */\r\n  category: 'hr' | 'finance' | 'inventory' | 'sales' | 'purchasing' | 'service' | 'settings' | 'system';\r\n  \r\n  /** Description or notes */\r\n  description?: string;\r\n  \r\n  /** Custom validation rules */\r\n  validation?: {\r\n    /** Allow users to input custom ID */\r\n    allowCustomId?: boolean;\r\n    /** Regex pattern for validation */\r\n    pattern?: RegExp;\r\n    /** Minimum counter value */\r\n    minValue?: number;\r\n    /** Maximum counter value */\r\n    maxValue?: number;\r\n  };\r\n  \r\n  /** Whether entity uses store-factory auto-generation */\r\n  usesStoreFactory?: boolean;\r\n  \r\n  /** Special handling notes for developers */\r\n  notes?: string;\r\n}\r\n\r\n// ========================================\r\n// üóÇÔ∏è COMPLETE CONFIGURATION REGISTRY\r\n// ========================================\r\n\r\n/**\r\n * ID_CONFIG - Central registry for all 60+ entities\r\n * \r\n * ‚úÖ Synced with smart-prefix.ts\r\n * ‚úÖ Includes all missing entities\r\n * ‚úÖ Category organization\r\n */\r\nexport const ID_CONFIG: Record<EntityType, EntityIDConfig> = {\r\n  // ========================================\r\n  // üë• HR & ORGANIZATION (NH√ÇN S·ª∞)\r\n  // ========================================\r\n  \r\n  'employees': {\r\n    entityType: 'employees',\r\n    prefix: ENTITY_PREFIXES['employees'], // 'NV'\r\n    systemIdPrefix: 'EMP',\r\n    digitCount: 6,\r\n    displayName: 'Nh√¢n vi√™n',\r\n    category: 'hr',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'departments': {\r\n    entityType: 'departments',\r\n    prefix: ENTITY_PREFIXES['departments'], // 'PB'\r\n    systemIdPrefix: 'DEPT',\r\n    digitCount: 6,\r\n    displayName: 'Ph√≤ng ban',\r\n    category: 'hr',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'branches': {\r\n    entityType: 'branches',\r\n    prefix: ENTITY_PREFIXES['branches'], // 'CN'\r\n    systemIdPrefix: 'BRANCH',\r\n    digitCount: 6,\r\n    displayName: 'Chi nh√°nh',\r\n    category: 'hr',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'job-titles': {\r\n    entityType: 'job-titles',\r\n    prefix: ENTITY_PREFIXES['job-titles'], // 'CV'\r\n    systemIdPrefix: 'JOB',\r\n    digitCount: 6,\r\n    displayName: 'Ch·ª©c v·ª•',\r\n    category: 'hr',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'attendance': {\r\n    entityType: 'attendance',\r\n    prefix: ENTITY_PREFIXES['attendance'], // 'CC'\r\n    systemIdPrefix: 'ATTEND',\r\n    digitCount: 6,\r\n    displayName: 'Ch·∫•m c√¥ng',\r\n    category: 'hr',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  'duty-schedule': {\r\n    entityType: 'duty-schedule',\r\n    prefix: ENTITY_PREFIXES['duty-schedule'], // 'PC'\r\n    systemIdPrefix: 'DUTY',\r\n    digitCount: 6,\r\n    displayName: 'Ph√¢n c√¥ng',\r\n    category: 'hr',\r\n    notes: 'Prefix conflict with \"payments\" (PC)',\r\n  },\r\n  \r\n  'payroll': {\r\n    entityType: 'payroll',\r\n    prefix: ENTITY_PREFIXES['payroll'], // 'BL'\r\n    systemIdPrefix: 'PAYROLL',\r\n    digitCount: 6,\r\n    displayName: 'B·∫£ng l∆∞∆°ng',\r\n    category: 'hr',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  'payslips': {\r\n    entityType: 'payslips',\r\n    prefix: ENTITY_PREFIXES['payslips'], // 'PL'\r\n    systemIdPrefix: 'PAYSLIP',\r\n    digitCount: 6,\r\n    displayName: 'Phi·∫øu l∆∞∆°ng',\r\n    category: 'hr',\r\n    usesStoreFactory: false,\r\n    notes: 'Sinh t·ª´ payroll batch store',\r\n  },\r\n  \r\n  'payroll-audit-log': {\r\n    entityType: 'payroll-audit-log',\r\n    prefix: ENTITY_PREFIXES['payroll-audit-log'], // 'PAL'\r\n    systemIdPrefix: 'PAYROLLLOG',\r\n    digitCount: 6,\r\n    displayName: 'Nh·∫≠t k√Ω payroll',\r\n    category: 'hr',\r\n    usesStoreFactory: false,\r\n  },\r\n  'payroll-templates': {\r\n    entityType: 'payroll-templates',\r\n    prefix: ENTITY_PREFIXES['payroll-templates'], // 'BTP'\r\n    systemIdPrefix: 'PAYTPL',\r\n    digitCount: 6,\r\n    displayName: 'M·∫´u b·∫£ng l∆∞∆°ng',\r\n    category: 'hr',\r\n    usesStoreFactory: false,\r\n    notes: 'D√πng cho trang template payroll Phase 3',\r\n  },\r\n  \r\n  'penalties': {\r\n    entityType: 'penalties',\r\n    prefix: ENTITY_PREFIXES['penalties'], // 'PF'\r\n    systemIdPrefix: 'PENALTY',\r\n    digitCount: 6,\r\n    displayName: 'Phi·∫øu ph·∫°t',\r\n    category: 'hr',\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'leaves': {\r\n    entityType: 'leaves',\r\n    prefix: ENTITY_PREFIXES['leaves'], // 'PN'\r\n    systemIdPrefix: 'LEAVE',\r\n    digitCount: 6,\r\n    displayName: 'Ngh·ªâ ph√©p',\r\n    category: 'hr',\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  // ========================================\r\n  // üë§ CUSTOMERS & PARTNERS (KH√ÅCH H√ÄNG)\r\n  // ========================================\r\n  \r\n  'customers': {\r\n    entityType: 'customers',\r\n    prefix: ENTITY_PREFIXES['customers'], // 'KH'\r\n    systemIdPrefix: 'CUSTOMER',\r\n    digitCount: 6,\r\n    displayName: 'Kh√°ch h√†ng',\r\n    category: 'sales',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'suppliers': {\r\n    entityType: 'suppliers',\r\n    prefix: ENTITY_PREFIXES['suppliers'], // 'NCC'\r\n    systemIdPrefix: 'SUPPLIER',\r\n    digitCount: 6,\r\n    displayName: 'Nh√† cung c·∫•p',\r\n    category: 'purchasing',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'shipping-partners': {\r\n    entityType: 'shipping-partners',\r\n    prefix: ENTITY_PREFIXES['shipping-partners'], // 'DVVC'\r\n    systemIdPrefix: 'SHIPPING',\r\n    digitCount: 6,\r\n    displayName: 'ƒê∆°n v·ªã v·∫≠n chuy·ªÉn',\r\n    category: 'settings',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  // ========================================\r\n  // üì¶ PRODUCTS & INVENTORY (S·∫¢N PH·∫®M & KHO)\r\n  // ========================================\r\n  \r\n  'products': {\r\n    entityType: 'products',\r\n    prefix: ENTITY_PREFIXES['products'], // 'SP'\r\n    systemIdPrefix: 'PRODUCT',\r\n    digitCount: 6,\r\n    displayName: 'S·∫£n ph·∫©m',\r\n    category: 'inventory',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'brands': {\r\n    entityType: 'brands',\r\n    prefix: ENTITY_PREFIXES['brands'], // 'TH'\r\n    systemIdPrefix: 'BRAND',\r\n    digitCount: 6,\r\n    displayName: 'Th∆∞∆°ng hi·ªáu',\r\n    category: 'inventory',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'categories': {\r\n    entityType: 'categories',\r\n    prefix: ENTITY_PREFIXES['categories'], // 'DM'\r\n    systemIdPrefix: 'CATEGORY',\r\n    digitCount: 6,\r\n    displayName: 'Danh m·ª•c',\r\n    category: 'inventory',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'units': {\r\n    entityType: 'units',\r\n    prefix: ENTITY_PREFIXES['units'], // 'DVT'\r\n    systemIdPrefix: 'UNIT',\r\n    digitCount: 6,\r\n    displayName: 'ƒê∆°n v·ªã t√≠nh',\r\n    category: 'inventory',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'stock-locations': {\r\n    entityType: 'stock-locations',\r\n    prefix: ENTITY_PREFIXES['stock-locations'], // 'KHO'\r\n    systemIdPrefix: 'STOCK',\r\n    digitCount: 6,\r\n    displayName: 'V·ªã tr√≠ kho',\r\n    category: 'inventory',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'inventory-receipts': {\r\n    entityType: 'inventory-receipts',\r\n    prefix: ENTITY_PREFIXES['inventory-receipts'], // 'NK'\r\n    systemIdPrefix: 'INVRECEIPT',\r\n    digitCount: 6,\r\n    displayName: 'Nh·∫≠p kho',\r\n    category: 'inventory',\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'inventory-checks': {\r\n    entityType: 'inventory-checks',\r\n    prefix: ENTITY_PREFIXES['inventory-checks'], // 'PKK'\r\n    systemIdPrefix: 'INVCHECK',\r\n    digitCount: 6,\r\n    displayName: 'Phi·∫øu ki·ªÉm kho',\r\n    category: 'inventory',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'stock-transfers': {\r\n    entityType: 'stock-transfers',\r\n    prefix: ENTITY_PREFIXES['stock-transfers'], // 'PCK'\r\n    systemIdPrefix: 'TRANSFER',\r\n    digitCount: 6,\r\n    displayName: 'Phi·∫øu chuy·ªÉn kho',\r\n    category: 'inventory',\r\n    usesStoreFactory: true,\r\n    notes: 'systemId: TRANSFER000001, Business ID: PCK000001',\r\n  },\r\n  \r\n  'stock-history': {\r\n    entityType: 'stock-history',\r\n    prefix: ENTITY_PREFIXES['stock-history'], // 'LS'\r\n    systemIdPrefix: 'HISTORY',\r\n    digitCount: 6,\r\n    displayName: 'L·ªãch s·ª≠ kho',\r\n    category: 'inventory',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  // ========================================\r\n  // üõí SALES (B√ÅN H√ÄNG)\r\n  // ========================================\r\n  \r\n  'orders': {\r\n    entityType: 'orders',\r\n    prefix: ENTITY_PREFIXES['orders'], // 'DH'\r\n    systemIdPrefix: 'ORDER',\r\n    digitCount: 6,\r\n    displayName: 'ƒê∆°n h√†ng',\r\n    category: 'sales',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'sales-returns': {\r\n    entityType: 'sales-returns',\r\n    prefix: ENTITY_PREFIXES['sales-returns'], // 'TH'\r\n    systemIdPrefix: 'RETURN',\r\n    digitCount: 6,\r\n    displayName: 'Tr·∫£ h√†ng',\r\n    category: 'sales',\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'sales-channels': {\r\n    entityType: 'sales-channels',\r\n    prefix: ENTITY_PREFIXES['sales-channels'], // 'KENH'\r\n    systemIdPrefix: 'CHANNEL',\r\n    digitCount: 6,\r\n    displayName: 'K√™nh b√°n h√†ng',\r\n    category: 'sales',\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'shipments': {\r\n    entityType: 'shipments',\r\n    prefix: ENTITY_PREFIXES['shipments'], // 'VC'\r\n    systemIdPrefix: 'SHIPMENT',\r\n    digitCount: 6,\r\n    displayName: 'V·∫≠n chuy·ªÉn',\r\n    category: 'sales',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  // ========================================\r\n  // üè≠ PURCHASING (MUA H√ÄNG)\r\n  // ========================================\r\n  \r\n  'purchase-orders': {\r\n    entityType: 'purchase-orders',\r\n    prefix: ENTITY_PREFIXES['purchase-orders'], // 'PO'\r\n    systemIdPrefix: 'PURCHASE',\r\n    digitCount: 6,\r\n    displayName: 'ƒê∆°n mua h√†ng',\r\n    category: 'purchasing',\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'purchase-returns': {\r\n    entityType: 'purchase-returns',\r\n    prefix: ENTITY_PREFIXES['purchase-returns'], // 'TM'\r\n    systemIdPrefix: 'PRETURN',\r\n    digitCount: 6,\r\n    displayName: 'Tr·∫£ h√†ng NCC',\r\n    category: 'purchasing',\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  // ========================================\r\n  // üí∞ FINANCE (T√ÄI CH√çNH)\r\n  // ========================================\r\n  \r\n  'receipts': {\r\n    entityType: 'receipts',\r\n    prefix: ENTITY_PREFIXES['receipts'], // 'PT'\r\n    systemIdPrefix: 'RECEIPT',\r\n    digitCount: 6,\r\n    displayName: 'Phi·∫øu thu',\r\n    category: 'finance',\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'payments': {\r\n    entityType: 'payments',\r\n    prefix: ENTITY_PREFIXES['payments'], // 'PC'\r\n    systemIdPrefix: 'PAYMENT',\r\n    digitCount: 6,\r\n    displayName: 'Phi·∫øu chi',\r\n    category: 'finance',\r\n    usesStoreFactory: true,\r\n  },\r\n\r\n  'voucher-receipt': {\r\n    entityType: 'voucher-receipt',\r\n    prefix: ENTITY_PREFIXES['voucher-receipt'], // Alias 'PT'\r\n    systemIdPrefix: 'RECEIPT',\r\n    digitCount: 6,\r\n    displayName: 'Phi·∫øu thu (Voucher)',\r\n    category: 'finance',\r\n    usesStoreFactory: true,\r\n    notes: 'Alias d√πng cho c√°c workflow voucher-only ho·∫∑c m√†n h√¨nh t·ªïng h·ª£p phi·∫øu thu/chi.',\r\n  },\r\n  \r\n  'voucher-payment': {\r\n    entityType: 'voucher-payment',\r\n    prefix: ENTITY_PREFIXES['voucher-payment'], // Alias 'PC'\r\n    systemIdPrefix: 'PAYMENT',\r\n    digitCount: 6,\r\n    displayName: 'Phi·∫øu chi (Voucher)',\r\n    category: 'finance',\r\n    usesStoreFactory: true,\r\n    notes: 'Alias d√πng cho c√°c workflow voucher-only ho·∫∑c m√†n h√¨nh t·ªïng h·ª£p phi·∫øu thu/chi.',\r\n  },\r\n  \r\n  'cashbook': {\r\n    entityType: 'cashbook',\r\n    prefix: ENTITY_PREFIXES['cashbook'], // 'SCT'\r\n    systemIdPrefix: 'CASHBOOK',\r\n    digitCount: 6,\r\n    displayName: 'S·ªï qu·ªπ ti·ªÅn m·∫∑t',\r\n    category: 'finance',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  'reconciliation': {\r\n    entityType: 'reconciliation',\r\n    prefix: ENTITY_PREFIXES['reconciliation'], // 'DT'\r\n    systemIdPrefix: 'RECON',\r\n    digitCount: 6,\r\n    displayName: 'ƒê·ªëi chi·∫øu',\r\n    category: 'finance',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  // Finance Settings\r\n  'receipt-types': {\r\n    entityType: 'receipt-types',\r\n    prefix: ENTITY_PREFIXES['receipt-types'], // 'LT'\r\n    systemIdPrefix: 'RECTYPE',\r\n    digitCount: 6,\r\n    displayName: 'Lo·∫°i thu',\r\n    category: 'finance',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'payment-types': {\r\n    entityType: 'payment-types',\r\n    prefix: ENTITY_PREFIXES['payment-types'], // 'LC'\r\n    systemIdPrefix: 'PAYTYPE',\r\n    digitCount: 6,\r\n    displayName: 'Lo·∫°i chi',\r\n    category: 'finance',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'cash-accounts': {\r\n    entityType: 'cash-accounts',\r\n    prefix: ENTITY_PREFIXES['cash-accounts'], // 'TK'\r\n    systemIdPrefix: 'ACCOUNT',\r\n    digitCount: 6,\r\n    displayName: 'T√†i kho·∫£n',\r\n    category: 'finance',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'payment-methods': {\r\n    entityType: 'payment-methods',\r\n    prefix: ENTITY_PREFIXES['payment-methods'], // 'PTTT'\r\n    systemIdPrefix: 'METHOD',\r\n    digitCount: 6,\r\n    displayName: 'Ph∆∞∆°ng th·ª©c thanh to√°n',\r\n    category: 'finance',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'pricing-settings': {\r\n    entityType: 'pricing-settings',\r\n    prefix: ENTITY_PREFIXES['pricing-settings'], // 'GIA'\r\n    systemIdPrefix: 'PRICING',\r\n    digitCount: 6,\r\n    displayName: 'C√†i ƒë·∫∑t gi√°',\r\n    category: 'settings',\r\n    usesStoreFactory: false,\r\n  },\r\n\r\n  'taxes': {\r\n    entityType: 'taxes',\r\n    prefix: ENTITY_PREFIXES['taxes'], // 'TAX'\r\n    systemIdPrefix: 'TAX',\r\n    digitCount: 6,\r\n    displayName: 'Thu·∫ø',\r\n    category: 'settings',\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  // ========================================\r\n  // üéØ KPI & TARGETS (M·ª§C TI√äU)\r\n  // ========================================\r\n  \r\n  'kpi': {\r\n    entityType: 'kpi',\r\n    prefix: ENTITY_PREFIXES['kpi'], // 'KPI'\r\n    systemIdPrefix: 'KPI',\r\n    digitCount: 6,\r\n    displayName: 'KPI',\r\n    category: 'hr',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  'target-groups': {\r\n    entityType: 'target-groups',\r\n    prefix: ENTITY_PREFIXES['target-groups'], // 'NHOM'\r\n    systemIdPrefix: 'TARGET',\r\n    digitCount: 6,\r\n    displayName: 'Nh√≥m m·ª•c ti√™u',\r\n    category: 'settings',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'other-targets': {\r\n    entityType: 'other-targets',\r\n    prefix: ENTITY_PREFIXES['other-targets'], // 'MT'\r\n    systemIdPrefix: 'OTHERTARGET',\r\n    digitCount: 6,\r\n    displayName: 'M·ª•c ti√™u kh√°c',\r\n    category: 'sales',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  // ========================================\r\n  // CUSTOMER SERVICE (D·ªäCH V·ª§)\r\n  // ========================================\r\n  \r\n  'internal-tasks': {\r\n    entityType: 'internal-tasks',\r\n    prefix: ENTITY_PREFIXES['internal-tasks'], // 'CVNB'\r\n    systemIdPrefix: 'TASK',\r\n    digitCount: 6,\r\n    displayName: 'C√¥ng vi·ªác n·ªôi b·ªô',\r\n    category: 'system',\r\n    usesStoreFactory: true,\r\n    validation: { allowCustomId: true },\r\n  },\r\n  \r\n  'task-templates': {\r\n    entityType: 'task-templates',\r\n    prefix: ENTITY_PREFIXES['task-templates'], // 'TMPL'\r\n    systemIdPrefix: 'TMPL',\r\n    digitCount: 6,\r\n    displayName: 'M·∫´u c√¥ng vi·ªác',\r\n    category: 'system',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  'custom-fields': {\r\n    entityType: 'custom-fields',\r\n    prefix: ENTITY_PREFIXES['custom-fields'], // 'FIELD'\r\n    systemIdPrefix: 'FIELD',\r\n    digitCount: 6,\r\n    displayName: 'Tr∆∞·ªùng t√πy ch·ªânh',\r\n    category: 'settings',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  'warranty': {\r\n    entityType: 'warranty',\r\n    prefix: ENTITY_PREFIXES['warranty'], // 'BH'\r\n    systemIdPrefix: 'WARRANTY',\r\n    digitCount: 6,\r\n    displayName: 'B·∫£o h√†nh',\r\n    category: 'service',\r\n    usesStoreFactory: true,\r\n    notes: 'systemId: WARRANTY000001, Business ID: BH000001',\r\n  },\r\n  \r\n  'complaints': {\r\n    entityType: 'complaints',\r\n    prefix: ENTITY_PREFIXES['complaints'], // 'PKN'\r\n    systemIdPrefix: 'COMPLAINT',\r\n    digitCount: 6,\r\n    displayName: 'Khi·∫øu n·∫°i',\r\n    category: 'service',\r\n    usesStoreFactory: true,\r\n    notes: 'systemId: COMPLAINT000001, Business ID: PKN000001',\r\n  },\r\n  \r\n  // ========================================\r\n  // ‚öôÔ∏è SETTINGS & CATEGORIES\r\n  // ========================================\r\n  \r\n  'provinces': {\r\n    entityType: 'provinces',\r\n    prefix: ENTITY_PREFIXES['provinces'], // 'TP'\r\n    systemIdPrefix: 'PROVINCE',\r\n    digitCount: 6,\r\n    displayName: 'T·ªânh/Th√†nh ph·ªë',\r\n    category: 'settings',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  'districts': {\r\n    entityType: 'districts',\r\n    prefix: ENTITY_PREFIXES['districts'], // 'QH'\r\n    systemIdPrefix: 'DISTRICT',\r\n    digitCount: 6,\r\n    displayName: 'Qu·∫≠n/Huy·ªán',\r\n    category: 'settings',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  'wards': {\r\n    entityType: 'wards',\r\n    prefix: ENTITY_PREFIXES['wards'], // 'PX'\r\n    systemIdPrefix: 'WARD',\r\n    digitCount: 6,\r\n    displayName: 'Ph∆∞·ªùng/X√£',\r\n    category: 'settings',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  'wiki': {\r\n    entityType: 'wiki',\r\n    prefix: ENTITY_PREFIXES['wiki'], // 'TL'\r\n    systemIdPrefix: 'WIKI',\r\n    digitCount: 6,\r\n    displayName: 'T√†i li·ªáu',\r\n    category: 'system',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  'packaging': {\r\n    entityType: 'packaging',\r\n    prefix: ENTITY_PREFIXES['packaging'], // 'DG'\r\n    systemIdPrefix: 'PACKAGE',\r\n    digitCount: 6,\r\n    displayName: 'ƒê√≥ng g√≥i',\r\n    category: 'inventory',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  'audit-log': {\r\n    entityType: 'audit-log',\r\n    prefix: ENTITY_PREFIXES['audit-log'], // 'LOG'\r\n    systemIdPrefix: 'LOG',\r\n    digitCount: 10,\r\n    displayName: 'Nh·∫≠t k√Ω',\r\n    category: 'system',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  // Customer Settings\r\n  'customer-types': {\r\n    entityType: 'customer-types',\r\n    prefix: ENTITY_PREFIXES['customer-types'], // 'LKH'\r\n    systemIdPrefix: 'CUSTTYPE',\r\n    digitCount: 6,\r\n    displayName: 'Lo·∫°i kh√°ch h√†ng',\r\n    category: 'settings',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  'customer-groups': {\r\n    entityType: 'customer-groups',\r\n    prefix: ENTITY_PREFIXES['customer-groups'], // 'NHKH'\r\n    systemIdPrefix: 'CUSTGROUP',\r\n    digitCount: 6,\r\n    displayName: 'Nh√≥m kh√°ch h√†ng',\r\n    category: 'settings',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  'customer-sources': {\r\n    entityType: 'customer-sources',\r\n    prefix: ENTITY_PREFIXES['customer-sources'], // 'NKH'\r\n    systemIdPrefix: 'CUSTSOURCE',\r\n    digitCount: 6,\r\n    displayName: 'Ngu·ªìn kh√°ch h√†ng',\r\n    category: 'settings',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  'payment-terms': {\r\n    entityType: 'payment-terms',\r\n    prefix: ENTITY_PREFIXES['payment-terms'], // 'HTTT'\r\n    systemIdPrefix: 'PAYTERM',\r\n    digitCount: 6,\r\n    displayName: 'H√¨nh th·ª©c thanh to√°n',\r\n    category: 'settings',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  'credit-ratings': {\r\n    entityType: 'credit-ratings',\r\n    prefix: ENTITY_PREFIXES['credit-ratings'], // 'XHTD'\r\n    systemIdPrefix: 'CREDIT',\r\n    digitCount: 6,\r\n    displayName: 'X·∫øp h·∫°ng t√≠n d·ª•ng',\r\n    category: 'settings',\r\n    usesStoreFactory: false,\r\n  },\r\n  'lifecycle-stages': {\r\n    entityType: 'lifecycle-stages',\r\n    prefix: ENTITY_PREFIXES['lifecycle-stages'], // 'GDL'\r\n    systemIdPrefix: 'LIFECYCLE',\r\n    digitCount: 6,\r\n    displayName: 'Giai ƒëo·∫°n v√≤ng ƒë·ªùi kh√°ch h√†ng',\r\n    category: 'sales',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  'sla-settings': {\r\n    entityType: 'sla-settings',\r\n    prefix: ENTITY_PREFIXES['sla-settings'], // 'SLA'\r\n    systemIdPrefix: 'SLACFG',\r\n    digitCount: 6,\r\n    displayName: 'C√†i ƒë·∫∑t SLA kh√°ch h√†ng',\r\n    category: 'sales',\r\n    validation: { allowCustomId: true },\r\n    usesStoreFactory: true,\r\n  },\r\n  \r\n  // Employee Settings\r\n  'employee-types': {\r\n    entityType: 'employee-types',\r\n    prefix: ENTITY_PREFIXES['employee-types'], // 'LNV'\r\n    systemIdPrefix: 'EMPTYPE',\r\n    digitCount: 6,\r\n    displayName: 'Lo·∫°i nh√¢n vi√™n',\r\n    category: 'settings',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  'employee-statuses': {\r\n    entityType: 'employee-statuses',\r\n    prefix: ENTITY_PREFIXES['employee-statuses'], // 'TTNV'\r\n    systemIdPrefix: 'EMPSTATUS',\r\n    digitCount: 6,\r\n    displayName: 'Tr·∫°ng th√°i nh√¢n vi√™n',\r\n    category: 'settings',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  'contract-types': {\r\n    entityType: 'contract-types',\r\n    prefix: ENTITY_PREFIXES['contract-types'], // 'LHD'\r\n    systemIdPrefix: 'CONTRACT',\r\n    digitCount: 6,\r\n    displayName: 'Lo·∫°i h·ª£p ƒë·ªìng',\r\n    category: 'settings',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  'work-shifts': {\r\n    entityType: 'work-shifts',\r\n    prefix: ENTITY_PREFIXES['work-shifts'], // 'CA'\r\n    systemIdPrefix: 'WSHIFT',\r\n    digitCount: 6,\r\n    displayName: 'Ca l√†m vi·ªác',\r\n    category: 'settings',\r\n    usesStoreFactory: false,\r\n    notes: 'D√πng cho c√†i ƒë·∫∑t ca l√†m vi·ªác & Dual ID trong attendance',\r\n  },\r\n  \r\n  'leave-types': {\r\n    entityType: 'leave-types',\r\n    prefix: ENTITY_PREFIXES['leave-types'], // 'LP'\r\n    systemIdPrefix: 'LEAVETYPE',\r\n    digitCount: 6,\r\n    displayName: 'Lo·∫°i ngh·ªâ ph√©p',\r\n    category: 'settings',\r\n    usesStoreFactory: false,\r\n    notes: 'Qu·∫£n l√Ω danh m·ª•c ph√©p nƒÉm/ph√©p ƒë·∫∑c bi·ªát',\r\n  },\r\n  \r\n  'salary-components': {\r\n    entityType: 'salary-components',\r\n    prefix: ENTITY_PREFIXES['salary-components'], // 'SC'\r\n    systemIdPrefix: 'SALCOMP',\r\n    digitCount: 6,\r\n    displayName: 'Th√†nh ph·∫ßn l∆∞∆°ng',\r\n    category: 'settings',\r\n    usesStoreFactory: false,\r\n    notes: 'D√πng cho c·∫•u h√¨nh payroll engine',\r\n  },\r\n  \r\n  // ========================================\r\n  // üîê SYSTEM & AUTH\r\n  // ========================================\r\n  \r\n  'settings': {\r\n    entityType: 'settings',\r\n    prefix: ENTITY_PREFIXES['settings'], // 'CFG'\r\n    systemIdPrefix: 'CONFIG',\r\n    digitCount: 6,\r\n    displayName: 'C·∫•u h√¨nh',\r\n    category: 'system',\r\n    usesStoreFactory: false,\r\n  },\r\n  \r\n  'users': {\r\n    entityType: 'users',\r\n    prefix: ENTITY_PREFIXES['users'], // 'USER'\r\n    systemIdPrefix: 'USER',\r\n    digitCount: 6,\r\n    displayName: 'Ng∆∞·ªùi d√πng',\r\n    category: 'system',\r\n    usesStoreFactory: false,\r\n  },\r\n};\r\n\r\n// ========================================\r\n// üõ†Ô∏è HELPER FUNCTIONS\r\n// ========================================\r\n\r\n/**\r\n * Get configuration for an entity type\r\n */\r\nexport function getEntityConfig(entityType: EntityType): EntityIDConfig {\r\n  const config = ID_CONFIG[entityType];\r\n  if (!config) {\r\n    throw new Error(`No configuration found for entity type: ${entityType}`);\r\n  }\r\n  return config;\r\n}\r\n\r\n/**\r\n * Get all entity types in a category\r\n */\r\nexport function getEntitiesByCategory(category: EntityIDConfig['category']): EntityType[] {\r\n  return Object.values(ID_CONFIG)\r\n    .filter(config => config.category === category)\r\n    .map(config => config.entityType);\r\n}\r\n\r\n/**\r\n * Get entities grouped by category\r\n */\r\nexport function getEntityCategories(): Record<string, EntityType[]> {\r\n  const categories: Record<string, EntityType[]> = {\r\n    'hr': [],\r\n    'finance': [],\r\n    'inventory': [],\r\n    'sales': [],\r\n    'purchasing': [],\r\n    'service': [],\r\n    'settings': [],\r\n    'system': [],\r\n  };\r\n  \r\n  Object.values(ID_CONFIG).forEach(config => {\r\n    categories[config.category].push(config.entityType);\r\n  });\r\n  \r\n  return categories;\r\n}\r\n\r\n/**\r\n * Validate ID format for an entity\r\n * Returns validation result with detailed error message\r\n */\r\nexport function validateIdFormat(\r\n  id: string,\r\n  entityType: EntityType\r\n): { valid: boolean; error?: string } {\r\n  const config = getEntityConfig(entityType);\r\n  \r\n  // Check prefix\r\n  if (!id.startsWith(config.prefix)) {\r\n    return { \r\n      valid: false, \r\n      error: `Invalid prefix. Expected \"${config.prefix}\", got \"${id.slice(0, config.prefix.length)}\"` \r\n    };\r\n  }\r\n  \r\n  // Check digit count\r\n  const numberPart = id.substring(config.prefix.length);\r\n  if (numberPart.length !== config.digitCount) {\r\n    const expectedLength = config.prefix.length + config.digitCount;\r\n    return { \r\n      valid: false, \r\n      error: `Invalid length. Expected ${expectedLength} characters, got ${id.length}` \r\n    };\r\n  }\r\n  \r\n  // Check if numeric\r\n  if (!/^\\d+$/.test(numberPart)) {\r\n    return { \r\n      valid: false, \r\n      error: 'Numeric part must contain only digits' \r\n    };\r\n  }\r\n  \r\n  // Custom pattern validation\r\n  if (config.validation?.pattern && !config.validation.pattern.test(id)) {\r\n    return { \r\n      valid: false, \r\n      error: 'ID does not match required pattern' \r\n    };\r\n  }\r\n  \r\n  return { valid: true };\r\n}\r\n\r\n/**\r\n * Check if entity allows custom ID input\r\n */\r\nexport function allowsCustomId(entityType: EntityType): boolean {\r\n  return getEntityConfig(entityType).validation?.allowCustomId ?? false;\r\n}\r\n\r\n/**\r\n * Get entities that use store factory\r\n */\r\nexport function getStoreFactoryEntities(): EntityType[] {\r\n  return Object.values(ID_CONFIG)\r\n    .filter(config => config.usesStoreFactory === true)\r\n    .map(config => config.entityType);\r\n}\r\n\r\n/**\r\n * Get display label for category\r\n */\r\nexport function getCategoryLabel(category: EntityIDConfig['category']): string {\r\n  const labels: Record<EntityIDConfig['category'], string> = {\r\n    'hr': 'Nh√¢n s·ª± & T·ªï ch·ª©c',\r\n    'finance': 'T√†i ch√≠nh',\r\n    'inventory': 'Kho h√†ng',\r\n    'sales': 'B√°n h√†ng',\r\n    'purchasing': 'Mua h√†ng',\r\n    'service': 'D·ªãch v·ª• kh√°ch h√†ng',\r\n    'settings': 'C√†i ƒë·∫∑t',\r\n    'system': 'H·ªá th·ªëng',\r\n  };\r\n  return labels[category];\r\n}\r\n\r\n/**\r\n * Search entities by name or prefix\r\n */\r\nexport function searchEntities(query: string): EntityIDConfig[] {\r\n  const lowerQuery = query.toLowerCase();\r\n  return Object.values(ID_CONFIG).filter(config => \r\n    config.displayName.toLowerCase().includes(lowerQuery) ||\r\n    config.prefix.toLowerCase().includes(lowerQuery) ||\r\n    config.entityType.includes(lowerQuery)\r\n  );\r\n}\r\n\r\n/**\r\n * Get total entity count\r\n */\r\nexport function getTotalEntityCount(): number {\r\n  return Object.keys(ID_CONFIG).length;\r\n}\r\n\r\n/**\r\n * Export configuration for backup/import\r\n */\r\nexport function exportConfig(): string {\r\n  return JSON.stringify(ID_CONFIG, null, 2);\r\n}\r\n\r\n// ========================================\r\n// üìä STATISTICS & ANALYTICS\r\n// ========================================\r\n\r\nexport interface IDSystemStats {\r\n  totalEntities: number;\r\n  byCategory: Record<string, number>;\r\n  storeFactoryEnabled: number;\r\n  customIdAllowed: number;\r\n  averageDigitCount: number;\r\n}\r\n\r\n/**\r\n * Get ID system statistics\r\n */\r\nexport function getIDSystemStats(): IDSystemStats {\r\n  const configs = Object.values(ID_CONFIG);\r\n  \r\n  const byCategory: Record<string, number> = {};\r\n  let storeFactoryEnabled = 0;\r\n  let customIdAllowed = 0;\r\n  let totalDigits = 0;\r\n  \r\n  configs.forEach(config => {\r\n    // Count by category\r\n    byCategory[config.category] = (byCategory[config.category] || 0) + 1;\r\n    \r\n    // Count features\r\n    if (config.usesStoreFactory) storeFactoryEnabled++;\r\n    if (config.validation?.allowCustomId) customIdAllowed++;\r\n    totalDigits += config.digitCount;\r\n  });\r\n  \r\n  return {\r\n    totalEntities: configs.length,\r\n    byCategory,\r\n    storeFactoryEnabled,\r\n    customIdAllowed,\r\n    averageDigitCount: Math.round(totalDigits / configs.length * 10) / 10,\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1190, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/id-utils.ts"],"sourcesContent":["/**\r\n * ID Utilities\r\n * Helpers for generating and validating IDs (systemId & business id)\r\n */\r\n\r\nimport { getPrefix, type EntityType } from './smart-prefix';\r\nimport { ID_CONFIG } from './id-config';\r\n\r\n// Re-export EntityType for convenience\r\nexport type { EntityType } from './smart-prefix';\r\n\r\n/**\r\n * Generate SystemId (6 digits, immutable, internal use only)\r\n * Format: SYSTEMID_PREFIX + 6 digits (e.g., \"EMP000001\", \"CUSTOMER000001\", \"ORDER000001\")\r\n * Uses systemIdPrefix from ID_CONFIG (English full words)\r\n */\r\nexport function generateSystemId(entityType: EntityType, counter: number): string {\r\n  const config = ID_CONFIG[entityType];\r\n  if (!config) {\r\n    throw new Error(`No configuration found for entity type: ${entityType}`);\r\n  }\r\n  const prefix = config.systemIdPrefix;\r\n  const digitCount = config.digitCount || 6;\r\n  return `${prefix}${String(counter).padStart(digitCount, '0')}`;\r\n}\r\n\r\n/**\r\n * Generate Business ID (6 digits, user-facing, editable)\r\n * Format: PREFIX + 6 digits (e.g., \"NV000001\", \"KH000001\", \"CTV000001\")\r\n * All entities use same 6-digit format for consistency\r\n * \r\n * @param entityType - Entity type from smart-prefix\r\n * @param counter - Current counter value\r\n * @param customId - Optional custom ID from user input\r\n * @returns Generated ID or validated custom ID\r\n */\r\nexport function generateBusinessId(\r\n  entityType: EntityType, \r\n  counter: number,\r\n  customId?: string\r\n): string {\r\n  // If user provided custom ID, validate and return it\r\n  if (customId && customId.trim()) {\r\n    const sanitized = sanitizeBusinessId(customId);\r\n    if (!sanitized) {\r\n      throw new Error('M√£ kh√¥ng h·ª£p l·ªá! Ch·ªâ ƒë∆∞·ª£c ph√©p s·ª≠ d·ª•ng ch·ªØ c√°i v√† s·ªë.');\r\n    }\r\n    return sanitized;\r\n  }\r\n  \r\n  // Otherwise, auto-generate\r\n  const prefix = getPrefix(entityType);\r\n  return `${prefix}${String(counter).padStart(6, '0')}`;\r\n}\r\n\r\n/**\r\n * Sanitize business ID\r\n * - Remove special characters (keep only letters and numbers)\r\n * - Convert to uppercase\r\n * - Trim whitespace\r\n * \r\n * @param id - Raw user input\r\n * @returns Sanitized ID or null if invalid\r\n */\r\nexport function sanitizeBusinessId(id: string): string | null {\r\n  if (!id || typeof id !== 'string') return null;\r\n  \r\n  // Remove all special characters, keep only alphanumeric\r\n  const cleaned = id.trim().replace(/[^a-zA-Z0-9]/g, '');\r\n  \r\n  if (!cleaned) return null;\r\n  \r\n  // Convert to uppercase for consistency\r\n  return cleaned.toUpperCase();\r\n}\r\n\r\n/**\r\n * Validate business ID uniqueness (case-insensitive)\r\n * \r\n * @param id - ID to check\r\n * @param existingIds - Array of existing IDs in the system\r\n * @param currentId - Current ID (for edit mode, to exclude self)\r\n * @returns true if unique, false if duplicate\r\n */\r\nexport function isBusinessIdUnique(\r\n  id: string,\r\n  existingIds: string[],\r\n  currentId?: string\r\n): boolean {\r\n  if (!id) return false;\r\n  \r\n  const normalizedId = id.toUpperCase();\r\n  const normalizedCurrentId = currentId?.toUpperCase();\r\n  \r\n  return !existingIds.some(existingId => {\r\n    // ‚úÖ Filter out empty/undefined IDs\r\n    if (!existingId || existingId.trim() === '') return false;\r\n    \r\n    const normalizedExisting = existingId.toUpperCase();\r\n    // Skip self-comparison in edit mode\r\n    if (normalizedCurrentId && normalizedExisting === normalizedCurrentId) {\r\n      return false;\r\n    }\r\n    return normalizedExisting === normalizedId;\r\n  });\r\n}\r\n\r\n/**\r\n * Extract counter from system ID\r\n * Used to initialize counter when loading from localStorage\r\n * Supports both 6, 7 and 8 digits\r\n * \r\n * @param systemId - System ID to parse (e.g., \"EMP000001\", \"CUSTOMER000001\", \"WARRANTY0000001\")\r\n * @param prefix - Expected systemIdPrefix (e.g., \"EMP\", \"CUSTOMER\", \"WARRANTY\")\r\n * @returns Counter value or 0 if invalid\r\n */\r\nexport function extractCounterFromSystemId(systemId: string, prefix: string): number {\r\n  if (!systemId || typeof systemId !== 'string') return 0;\r\n  \r\n  // Try different digit counts (most entities use 6 digits, some use 7-8)\r\n  const regex8 = new RegExp(`^${prefix}(\\\\d{8})$`);\r\n  const regex7 = new RegExp(`^${prefix}(\\\\d{7})$`);\r\n  const regex6 = new RegExp(`^${prefix}(\\\\d{6})$`);\r\n  \r\n  const match8 = systemId.match(regex8);\r\n  if (match8) return parseInt(match8[1], 10);\r\n  \r\n  const match7 = systemId.match(regex7);\r\n  if (match7) return parseInt(match7[1], 10);\r\n  \r\n  const match6 = systemId.match(regex6);\r\n  if (match6) return parseInt(match6[1], 10);\r\n  \r\n  return 0;\r\n}\r\n\r\n/**\r\n * Extract counter from business ID\r\n * Used to initialize counter when loading from localStorage\r\n * \r\n * @param businessId - Business ID to parse (e.g., \"NV000001\")\r\n * @param prefix - Expected prefix (e.g., \"NV\")\r\n * @returns Counter value or 0 if invalid\r\n */\r\nexport function extractCounterFromBusinessId(businessId: string, prefix: string): number {\r\n  if (!businessId || typeof businessId !== 'string') return 0;\r\n  const regex = new RegExp(`^${prefix}(\\\\d+)$`);\r\n  const match = businessId.match(regex);\r\n  return match ? parseInt(match[1], 10) : 0;\r\n}\r\n\r\n/**\r\n * Get max counter from array of items (for systemId)\r\n * \r\n * @param items - Array of items with systemId\r\n * @param prefix - Prefix to match\r\n * @returns Maximum counter value\r\n */\r\nexport function getMaxSystemIdCounter<T extends { systemId: string }>(\r\n  items: T[],\r\n  prefix: string\r\n): number {\r\n  if (!items || !Array.isArray(items)) return 0;\r\n  \r\n  let maxCounter = 0;\r\n  \r\n  items.forEach(item => {\r\n    if (!item || !item.systemId) return;\r\n    const counter = extractCounterFromSystemId(item.systemId, prefix);\r\n    if (counter > maxCounter) {\r\n      maxCounter = counter;\r\n    }\r\n  });\r\n  \r\n  return maxCounter;\r\n}\r\n\r\n/**\r\n * Get max counter from array of items (for business id)\r\n * Only counts auto-generated IDs (PREFIX + digits)\r\n * \r\n * @param items - Array of items with id\r\n * @param prefix - Prefix to match\r\n * @returns Maximum counter value\r\n */\r\nexport function getMaxBusinessIdCounter<T extends { id: string }>(\r\n  items: T[],\r\n  prefix: string\r\n): number {\r\n  if (!items || !Array.isArray(items)) return 0;\r\n  \r\n  let maxCounter = 0;\r\n  \r\n  items.forEach(item => {\r\n    if (!item || !item.id) return;\r\n    const counter = extractCounterFromBusinessId(item.id, prefix);\r\n    if (counter > maxCounter) {\r\n      maxCounter = counter;\r\n    }\r\n  });\r\n  \r\n  return maxCounter;\r\n}\r\n\r\n/**\r\n * Format ID for display\r\n * Adds spacing for readability\r\n * \r\n * @param id - ID to format\r\n * @returns Formatted ID (e.g., \"NV-000001\", \"KH-000123\")\r\n */\r\nexport function formatIdForDisplay(id: string): string {\r\n  // Match pattern: PREFIX followed by numbers\r\n  const match = id.match(/^([A-Z]+)(\\d+)$/);\r\n  if (!match) return id;\r\n  \r\n  const [, prefix, numbers] = match;\r\n  return `${prefix}-${numbers}`;\r\n}\r\n\r\n/**\r\n * Validate ID format\r\n * Check if ID follows valid pattern (letters + numbers only)\r\n * \r\n * @param id - ID to validate\r\n * @returns true if valid format\r\n */\r\nexport function isValidIdFormat(id: string): boolean {\r\n  if (!id || typeof id !== 'string') return false;\r\n  \r\n  // Only alphanumeric characters allowed\r\n  const regex = /^[A-Z0-9]+$/i;\r\n  return regex.test(id);\r\n}\r\n\r\n/**\r\n * Generate suggested IDs based on entity type\r\n * Useful for autocomplete or placeholder text\r\n * \r\n * @param entityType - Entity type\r\n * @param counter - Current counter\r\n * @param count - Number of suggestions\r\n * @returns Array of suggested IDs\r\n */\r\nexport function generateSuggestedIds(\r\n  entityType: EntityType,\r\n  counter: number,\r\n  count: number = 3\r\n): string[] {\r\n  const suggestions: string[] = [];\r\n  const prefix = getPrefix(entityType);\r\n  \r\n  for (let i = 0; i < count; i++) {\r\n    suggestions.push(`${prefix}${String(counter + i + 1).padStart(6, '0')}`);\r\n  }\r\n  \r\n  return suggestions;\r\n}\r\n\r\n/**\r\n * ‚ú® Find next available business ID\r\n * Checks existing IDs and increments counter until finding a unique ID\r\n * \r\n * @param prefix - ID prefix (e.g., 'PT', 'PC', 'NV')\r\n * @param existingIds - Array of existing business IDs\r\n * @param startCounter - Starting counter value\r\n * @param digitCount - Number of digits (default: 6)\r\n * @returns Object with nextId and updatedCounter\r\n */\r\nexport function findNextAvailableBusinessId(\r\n  prefix: string,\r\n  existingIds: string[],\r\n  startCounter: number,\r\n  digitCount: number = 6\r\n): { nextId: string; updatedCounter: number } {\r\n  let counter = startCounter;\r\n  let nextId: string;\r\n  \r\n  // Keep incrementing until we find a unique ID\r\n  do {\r\n    counter++;\r\n    nextId = `${prefix}${String(counter).padStart(digitCount, '0')}`;\r\n  } while (existingIds.some(id => id === nextId));\r\n  \r\n  return {\r\n    nextId,\r\n    updatedCounter: counter\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1353, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/store-factory.ts"],"sourcesContent":["import { create } from 'zustand';\r\n// persist, createJSONStorage removed - database is now source of truth\r\nimport { \r\n  generateSystemId, \r\n  generateBusinessId, \r\n  isBusinessIdUnique,\r\n  getMaxSystemIdCounter,\r\n  getMaxBusinessIdCounter,\r\n  findNextAvailableBusinessId,\r\n  type EntityType \r\n} from './id-utils';\r\nimport { getPrefix } from './smart-prefix';\r\nimport { ID_CONFIG, type SystemId, type BusinessId, createSystemId, createBusinessId as brandBusinessId } from './id-config';\r\n\r\nconst SYSTEM_FALLBACK_ID: SystemId = createSystemId('SYS000000');\r\n\r\nconst asSystemIdFallback = (): SystemId => SYSTEM_FALLBACK_ID;\r\n\r\n// ‚úÖ API Sync helper for store-factory\r\nasync function syncToAPI<T>(\r\n  apiEndpoint: string,\r\n  action: 'create' | 'update' | 'delete' | 'restore',\r\n  data: T | { systemId: SystemId },\r\n  systemId?: SystemId\r\n): Promise<boolean> {\r\n  try {\r\n    const endpoint = action === 'create' \r\n      ? apiEndpoint \r\n      : `${apiEndpoint}/${systemId || (data as any).systemId}`;\r\n    \r\n    const method = action === 'create' ? 'POST' \r\n      : action === 'update' ? 'PATCH' \r\n      : action === 'delete' ? 'DELETE'\r\n      : 'PATCH'; // restore uses PATCH\r\n    \r\n    const response = await fetch(endpoint, {\r\n      method,\r\n      headers: { 'Content-Type': 'application/json' },\r\n      credentials: 'include',\r\n      body: action !== 'delete' ? JSON.stringify(data) : undefined,\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      console.warn(`[Store Factory API] ${action} failed for ${apiEndpoint}:`, response.status);\r\n    }\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error(`[Store Factory API] ${action} error for ${apiEndpoint}:`, error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Item with SystemId (branded type)\r\nexport type ItemWithSystemId = { systemId: SystemId; [key: string]: any };\r\n\r\n// ‚úÖ Counter state for ID generation\r\nexport type CounterState = {\r\n  systemId: number;\r\n  businessId: number;\r\n};\r\n\r\nexport type CrudState<T extends ItemWithSystemId> = {\r\n  data: T[];\r\n  _counters: CounterState; // ‚úÖ Persisted counters\r\n  _initialized: boolean; // ‚úÖ Track if loaded from API\r\n  add: (item: Omit<T, 'systemId'>) => T;\r\n  addMultiple: (items: Omit<T, 'systemId'>[]) => void;\r\n  update: (systemId: SystemId, item: Partial<T>) => void; // ‚úÖ Accept partial updates\r\n  remove: (systemId: SystemId) => void; // ‚úÖ Branded type\r\n  hardDelete: (systemId: SystemId) => void; // ‚úÖ Branded type\r\n  restore: (systemId: SystemId) => void; // ‚úÖ Branded type\r\n  findById: (systemId: SystemId | string) => T | undefined; // ‚úÖ Branded type\r\n  getActive: () => T[];\r\n  getDeleted: () => T[];\r\n  loadFromAPI: () => Promise<void>; // ‚úÖ Load data from database\r\n};\r\n\r\nexport const createCrudStore = <T extends ItemWithSystemId>(\r\n  _initialData: T[], // @deprecated - Kept for backward compatibility but NO LONGER USED\r\n  entityType: EntityType, // Changed from idPrefix to entityType\r\n  options?: {\r\n    businessIdField?: keyof T; // Field name for business ID (default: 'id')\r\n    persistKey?: string; // @deprecated - No longer used, kept for backward compatibility\r\n    getCurrentUser?: () => string | undefined; // Function to get current user systemId\r\n    apiEndpoint?: string; // ‚úÖ API endpoint for database sync (e.g., '/api/employees')\r\n  }\r\n) => {\r\n  const businessPrefix = getPrefix(entityType); // Vietnamese prefix for Business ID (NV, KH, DH)\r\n  const config = ID_CONFIG[entityType];\r\n  const systemIdPrefix = config?.systemIdPrefix || entityType.toUpperCase(); // English prefix for SystemId (EMP, CUSTOMER, ORDER)\r\n  \r\n  const businessIdField = options?.businessIdField ?? 'id';\r\n  // const persistKey = options?.persistKey; // @deprecated - No longer used\r\n  const getCurrentUser = options?.getCurrentUser;\r\n  const apiEndpoint = options?.apiEndpoint;\r\n\r\n  // ‚úÖ CHANGED: Start with empty array - database is source of truth\r\n  // Mock data files (data.ts) are NO LONGER USED for runtime\r\n  const normalizedInitialData: T[] = [];\r\n\r\n  const storeConfig = (set: any, get: any) => ({\r\n    data: normalizedInitialData, // ‚úÖ Start empty - data loaded via React Query\r\n    // ‚úÖ Counters start at 0 - will be initialized from API via loadFromAPI()\r\n    _counters: {\r\n      systemId: 0,\r\n      businessId: 0\r\n    },\r\n    _initialized: false, // ‚úÖ Track API initialization\r\n    add: (item: Omit<T, 'systemId'>): T => {\r\n        // ‚úÖ Get counters from state (persisted)\r\n        const currentCounters = get()._counters;\r\n        const newSystemIdCounter = currentCounters.systemId + 1;\r\n        const newSystemId = createSystemId(generateSystemId(entityType, newSystemIdCounter));\r\n        \r\n        // Generate or validate Business ID (if field exists)\r\n        let finalItem = { ...item } as any;\r\n        let newBusinessIdCounter = currentCounters.businessId;\r\n        \r\n        if (businessIdField in item) {\r\n          const customId = (item as any)[businessIdField];\r\n          const existingIds = get().data.map((d: any) => d[businessIdField]);\r\n          \r\n          // ‚úÖ If customId provided, validate uniqueness\r\n          if (customId && customId.trim()) {\r\n            if (!isBusinessIdUnique(customId, existingIds)) {\r\n              throw new Error(`M√£ \"${customId}\" ƒë√£ t·ªìn t·∫°i! Vui l√≤ng s·ª≠ d·ª•ng m√£ kh√°c.`);\r\n            }\r\n            finalItem[businessIdField] = customId.trim().toUpperCase();\r\n          } else {\r\n            // ‚úÖ Auto-generate with findNextAvailableBusinessId\r\n            const digitCount = 6; // All entities use 6 digits\r\n            const result = findNextAvailableBusinessId(businessPrefix, existingIds, newBusinessIdCounter, digitCount);\r\n            finalItem[businessIdField] = result.nextId;\r\n            newBusinessIdCounter = result.updatedCounter;\r\n          }\r\n        }\r\n        \r\n        const now = new Date().toISOString();\r\n        const currentUser = getCurrentUser?.();\r\n        const newItem = { \r\n          ...finalItem, \r\n          systemId: newSystemId, // ‚úÖ Branded SystemId\r\n          createdAt: finalItem.createdAt || now,\r\n          updatedAt: now,\r\n          createdBy: finalItem.createdBy || currentUser,\r\n          updatedBy: currentUser,\r\n        } as unknown as T;\r\n        \r\n        // ‚úÖ Update both data and counters atomically\r\n        set((state: any) => ({ \r\n          data: [...state.data, newItem],\r\n          _counters: {\r\n            systemId: newSystemIdCounter,\r\n            businessId: newBusinessIdCounter\r\n          }\r\n        }));\r\n        \r\n        // ‚úÖ Sync to API in background\r\n        if (apiEndpoint) {\r\n          syncToAPI(apiEndpoint, 'create', newItem).catch(console.error);\r\n        }\r\n        \r\n        return newItem;\r\n    },\r\n    addMultiple: (items: Omit<T, 'systemId'>[]) => \r\n        set((state: any) => {\r\n            const now = new Date().toISOString();\r\n            const currentUser = getCurrentUser?.();\r\n            const newItems: T[] = [];\r\n            const digitCount = 6; // All entities use 6 digits\r\n            \r\n            // ‚úÖ Start from current counters\r\n            let currentSystemIdCounter = state._counters.systemId;\r\n            let currentBusinessIdCounter = state._counters.businessId;\r\n            \r\n            items.forEach(item => {\r\n                // ‚úÖ Generate SystemId from current counter\r\n                currentSystemIdCounter++;\r\n                const newSystemId = createSystemId(generateSystemId(entityType, currentSystemIdCounter));\r\n                \r\n                // Generate or validate Business ID (if field exists)\r\n                let finalItem = { ...item } as any;\r\n                if (businessIdField in item) {\r\n                  const customId = (item as any)[businessIdField];\r\n                  \r\n                  // Collect existing IDs (from state + already added in this batch)\r\n                  const existingIds = [\r\n                    ...state.data.map((d: any) => d[businessIdField]),\r\n                    ...newItems.map((d: any) => d[businessIdField])\r\n                  ];\r\n                  \r\n                  // ‚úÖ If customId provided, validate uniqueness\r\n                  if (customId && customId.trim()) {\r\n                    if (!isBusinessIdUnique(customId, existingIds)) {\r\n                      throw new Error(`M√£ \"${customId}\" ƒë√£ t·ªìn t·∫°i! Vui l√≤ng s·ª≠ d·ª•ng m√£ kh√°c.`);\r\n                    }\r\n                    finalItem[businessIdField] = customId.trim().toUpperCase();\r\n                  } else {\r\n                    // ‚úÖ Auto-generate with findNextAvailableBusinessId\r\n                    const result = findNextAvailableBusinessId(businessPrefix, existingIds, currentBusinessIdCounter, digitCount);\r\n                    finalItem[businessIdField] = result.nextId;\r\n                    currentBusinessIdCounter = result.updatedCounter;\r\n                  }\r\n                }\r\n                \r\n                newItems.push({ \r\n                  ...finalItem, \r\n                  systemId: newSystemId,\r\n                  createdAt: now,\r\n                  updatedAt: now,\r\n                  createdBy: currentUser,\r\n                  updatedBy: currentUser,\r\n                } as unknown as T);\r\n            });\r\n            \r\n            // ‚úÖ Update both data and counters\r\n            const result = { \r\n              data: [...state.data, ...newItems],\r\n              _counters: {\r\n                systemId: currentSystemIdCounter,\r\n                businessId: currentBusinessIdCounter\r\n              }\r\n            };\r\n            \r\n            // ‚úÖ Sync to API in background (batch)\r\n            if (apiEndpoint) {\r\n              newItems.forEach(item => {\r\n                syncToAPI(apiEndpoint, 'create', item).catch(console.error);\r\n              });\r\n            }\r\n            \r\n            return result;\r\n        }),\r\n    update: (systemId: SystemId, updatedItem: Partial<T>) => {\r\n      // Validate unique business ID (case-insensitive, skip self)\r\n      if (businessIdField in updatedItem) {\r\n        const businessId = (updatedItem as any)[businessIdField];\r\n        const existingIds = get().data\r\n          .filter((d: any) => d.systemId !== systemId)\r\n          .map((d: any) => d[businessIdField]);\r\n        \r\n        if (businessId && !isBusinessIdUnique(businessId, existingIds)) {\r\n          throw new Error(`M√£ \"${businessId}\" ƒë√£ t·ªìn t·∫°i! Vui l√≤ng s·ª≠ d·ª•ng m√£ kh√°c.`);\r\n        }\r\n      }\r\n\r\n      const now = new Date().toISOString();\r\n      const currentUser = getCurrentUser?.();\r\n      set((state: any) => ({\r\n        data: state.data.map((item: T) =>\r\n          item.systemId === systemId \r\n            ? { ...item, ...updatedItem, updatedAt: now, updatedBy: currentUser } as T\r\n            : item\r\n        ),\r\n      }));\r\n      \r\n      // ‚úÖ Sync to API in background\r\n      if (apiEndpoint) {\r\n        const fullItem = get().data.find((item: T) => item.systemId === systemId);\r\n        if (fullItem) {\r\n          syncToAPI(apiEndpoint, 'update', fullItem, systemId).catch(console.error);\r\n        }\r\n      }\r\n    },\r\n    remove: (systemId: SystemId) => {\r\n      // Soft delete - mark as deleted\r\n      const now = new Date().toISOString();\r\n      set((state: any) => ({\r\n        data: state.data.map((item: T) =>\r\n          item.systemId === systemId\r\n            ? { ...item, isDeleted: true, deletedAt: now } as T\r\n            : item\r\n        ),\r\n      }));\r\n      \r\n      // ‚úÖ Sync to API in background\r\n      if (apiEndpoint) {\r\n        const item = get().data.find((item: T) => item.systemId === systemId);\r\n        if (item) {\r\n          syncToAPI(apiEndpoint, 'update', { ...item, isDeleted: true, deletedAt: now }, systemId).catch(console.error);\r\n        }\r\n      }\r\n    },\r\n    hardDelete: (systemId: SystemId) => {\r\n      // Permanent delete - remove from array\r\n      set((state: any) => ({\r\n        data: state.data.filter((item: T) => item.systemId !== systemId),\r\n      }));\r\n      \r\n      // ‚úÖ Sync to API in background\r\n      if (apiEndpoint) {\r\n        syncToAPI(apiEndpoint, 'delete', { systemId }, systemId).catch(console.error);\r\n      }\r\n    },\r\n    restore: (systemId: SystemId) => {\r\n      // Restore soft-deleted item\r\n      set((state: any) => ({\r\n        data: state.data.map((item: T) =>\r\n          item.systemId === systemId\r\n            ? { ...item, isDeleted: false, deletedAt: null } as T\r\n            : item\r\n        ),\r\n      }));\r\n      \r\n      // ‚úÖ Sync to API in background\r\n      if (apiEndpoint) {\r\n        const item = get().data.find((item: T) => item.systemId === systemId);\r\n        if (item) {\r\n          syncToAPI(apiEndpoint, 'restore', { ...item, isDeleted: false, deletedAt: null }, systemId).catch(console.error);\r\n        }\r\n      }\r\n    },\r\n    getActive: () => get().data.filter((item: any) => !item.isDeleted),\r\n    getDeleted: () => get().data.filter((item: any) => item.isDeleted),\r\n    findById: (id: SystemId | string) => get().data.find((item: T) => item.systemId === id || (item as any).id === id),\r\n    \r\n    // ‚úÖ Load data from database API - OPTIMIZED: No more limit=10000!\r\n    // This is now only used for counter initialization, NOT for loading all data\r\n    // Use React Query hooks for data fetching with proper pagination\r\n    loadFromAPI: async () => {\r\n      if (!apiEndpoint) return;\r\n      if (get()._initialized) return;\r\n      \r\n      try {\r\n        // Only fetch minimal data needed to initialize counters\r\n        // Actual data loading should be done via React Query hooks\r\n        const response = await fetch(`${apiEndpoint}?limit=1&sortBy=systemId&sortOrder=desc`, {\r\n          credentials: 'include',\r\n        });\r\n        if (response.ok) {\r\n          const json = await response.json();\r\n          const pagination = json.pagination || {};\r\n          const lastItem = json.data?.[0];\r\n          \r\n          // Initialize counters from the latest item (highest IDs)\r\n          const newCounters = {\r\n            systemId: lastItem ? getMaxSystemIdCounter([lastItem], systemIdPrefix) : 0,\r\n            businessId: (lastItem && options?.businessIdField)\r\n              ? getMaxBusinessIdCounter([lastItem] as any[], businessPrefix)\r\n              : 0\r\n          };\r\n          \r\n          set({ \r\n            data: [], // Don't store data in Zustand anymore - use React Query\r\n            _counters: newCounters,\r\n            _initialized: true \r\n          });\r\n          \r\n          console.log(`[Store Factory] ${apiEndpoint} initialized. Total records: ${pagination.total || 'unknown'}`);\r\n        }\r\n      } catch (error) {\r\n        console.error(`[Store Factory] loadFromAPI error for ${apiEndpoint}:`, error);\r\n        // Still mark as initialized to prevent infinite retry\r\n        set({ _initialized: true });\r\n      }\r\n    },\r\n  });\r\n\r\n  // ‚úÖ SIMPLIFIED: No localStorage persistence, database is source of truth\r\n  // Data is loaded via ApiSyncProvider on app init\r\n  return create<CrudState<T>>(storeConfig);\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1664, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/activity-history-helper.ts"],"sourcesContent":["/**\r\n * Activity History Helper\r\n * \r\n * Helper ƒë·ªÉ t·∫°o c√°c entry l·ªãch s·ª≠ ho·∫°t ƒë·ªông m·ªôt c√°ch nh·∫•t qu√°n\r\n * D√πng chung cho t·∫•t c·∫£ c√°c modules trong h·ªá th·ªëng\r\n * \r\n * NOTE: ƒê√£ remove import useEmployeeStore ƒë·ªÉ tr√°nh circular dependency\r\n * v√† c·∫£i thi·ªán compile time\r\n */\r\n\r\nimport type { HistoryEntry } from '../components/ActivityHistory';\r\nimport { getCurrentUserInfo as getAuthUserInfo } from '../contexts/auth-context';\r\nimport type { SystemId } from './id-types';\r\n\r\n// Re-export HistoryEntry type for convenience\r\nexport type { HistoryEntry } from '../components/ActivityHistory';\r\n\r\n/**\r\n * L·∫•y th√¥ng tin ng∆∞·ªùi d√πng hi·ªán t·∫°i t·ª´ auth context\r\n * NOTE: Avatar lookup t·ª´ employee store ƒë√£ b·ªã remove ƒë·ªÉ tr√°nh circular dependency\r\n */\r\nexport function getCurrentUserInfo(): { systemId: string; name: string; avatar?: string } {\r\n  const authInfo = getAuthUserInfo();\r\n  \r\n  return {\r\n    systemId: authInfo.systemId || 'SYSTEM',\r\n    name: authInfo.name || 'H·ªá th·ªëng',\r\n    avatar: undefined, // Avatar will be fetched by component if needed\r\n  };\r\n}\r\n\r\n/**\r\n * L·∫•y th√¥ng tin nh√¢n vi√™n t·ª´ systemId\r\n * NOTE: This function now requires employee data to be passed in\r\n * to avoid circular dependency with employee store\r\n */\r\nexport function getEmployeeInfoFromData(\r\n  employeeSystemId: SystemId | string,\r\n  employees: Array<{ systemId: string; fullName: string; avatarUrl?: string }>\r\n): { systemId: string; name: string; avatar?: string } {\r\n  const employee = employees.find(e => e.systemId === employeeSystemId);\r\n  \r\n  if (employee) {\r\n    return {\r\n      systemId: employee.systemId,\r\n      name: employee.fullName,\r\n      avatar: employee.avatarUrl,\r\n    };\r\n  }\r\n  \r\n  // Fallback to system\r\n  return {\r\n    systemId: String(employeeSystemId) || 'SYSTEM',\r\n    name: 'H·ªá th·ªëng',\r\n  };\r\n}\r\n\r\n/**\r\n * @deprecated Use getEmployeeInfoFromData instead\r\n */\r\nexport function getEmployeeInfo(employeeSystemId: SystemId | string): { systemId: string; name: string; avatar?: string } {\r\n  // Return minimal info without employee store lookup\r\n  return {\r\n    systemId: String(employeeSystemId) || 'SYSTEM',\r\n    name: 'H·ªá th·ªëng',\r\n  };\r\n}\r\n\r\n/**\r\n * T·∫°o m·ªôt history entry m·ªõi\r\n */\r\nexport function createHistoryEntry(\r\n  action: HistoryEntry['action'],\r\n  userOrDescription: { systemId: string; name: string; avatar?: string } | string,\r\n  descriptionOrMetadata?: string | HistoryEntry['metadata'],\r\n  metadata?: HistoryEntry['metadata']\r\n): HistoryEntry {\r\n  const hasUserObject = typeof userOrDescription === 'object' && userOrDescription !== null;\r\n  const user = hasUserObject ? userOrDescription : getCurrentUserInfo();\r\n  const description = (hasUserObject ? descriptionOrMetadata : userOrDescription) as string | undefined;\r\n  const meta = (hasUserObject ? metadata : descriptionOrMetadata) as HistoryEntry['metadata'] | undefined;\r\n\r\n  return {\r\n    id: `history-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n    action,\r\n    timestamp: new Date(),\r\n    user: {\r\n      systemId: user.systemId,\r\n      name: user.name,\r\n      avatar: user.avatar,\r\n    },\r\n    description: description ?? '',\r\n    metadata: meta,\r\n  };\r\n}\r\n\r\n/**\r\n * T·∫°o history entry cho action \"created\"\r\n */\r\nexport function createCreatedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('created', user, description);\r\n}\r\n\r\n/**\r\n * T·∫°o history entry cho action \"updated\"\r\n */\r\nexport function createUpdatedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('updated', user, description);\r\n}\r\n\r\n/**\r\n * T·∫°o history entry cho action \"status_changed\"\r\n */\r\nexport function createStatusChangedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  oldStatus: string,\r\n  newStatus: string,\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry(\r\n    'status_changed',\r\n    user,\r\n    description,\r\n    { field: 'status', oldValue: oldStatus, newValue: newStatus }\r\n  );\r\n}\r\n\r\n/**\r\n * T·∫°o history entry cho action \"deleted\"\r\n */\r\nexport function createDeletedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('deleted', user, description);\r\n}\r\n\r\n/**\r\n * T·∫°o history entry cho action \"assigned\"\r\n */\r\nexport function createAssignedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('assigned', user, description);\r\n}\r\n\r\n/**\r\n * T·∫°o history entry cho action \"payment_made\"\r\n */\r\nexport function createPaymentEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('payment_made', user, description);\r\n}\r\n\r\n/**\r\n * T·∫°o history entry cho action \"comment_added\"\r\n */\r\nexport function createCommentEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('comment_added', user, description);\r\n}\r\n\r\n/**\r\n * T·∫°o history entry cho action \"cancelled\"\r\n */\r\nexport function createCancelledEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('cancelled', user, description);\r\n}\r\n\r\n/**\r\n * T·∫°o history entry cho action \"verified\"\r\n */\r\nexport function createVerifiedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('verified', user, description);\r\n}\r\n\r\n/**\r\n * T·∫°o history entry cho action \"ended\"\r\n */\r\nexport function createEndedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('ended', user, description);\r\n}\r\n\r\n/**\r\n * T·∫°o history entry cho action \"reopened\"\r\n */\r\nexport function createReopenedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('reopened', user, description);\r\n}\r\n\r\n/**\r\n * T·∫°o history entry cho product actions\r\n */\r\nexport function createProductEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  action: 'product_added' | 'product_updated' | 'product_removed',\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry(action, user, description);\r\n}\r\n\r\n/**\r\n * Helper ƒë·ªÉ append history entry v√†o existing array\r\n */\r\nexport function appendHistoryEntry(\r\n  existingHistory: HistoryEntry[] | undefined,\r\n  ...newEntries: HistoryEntry[]\r\n): HistoryEntry[] {\r\n  return [...(existingHistory || []), ...newEntries];\r\n}\r\n\r\n/**\r\n * Helper ƒë·ªÉ t·∫°o nhi·ªÅu history entries c√πng l√∫c\r\n */\r\nexport function createBulkUpdateEntries(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  changes: Array<{ field: string; description: string }>\r\n): HistoryEntry[] {\r\n  return changes.map(change => createHistoryEntry('updated', user, change.description));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1816, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/import-export/import-export-store.ts"],"sourcesContent":["/**\r\n * Import/Export Store\r\n * \r\n * L∆∞u l·ªãch s·ª≠ import/export v·ªõi Zustand persist (localStorage)\r\n * Khi migrate sang Next.js, s·∫Ω chuy·ªÉn sang API\r\n */\r\n\r\nimport { create } from 'zustand';\r\nimport type { ImportLogEntry, ExportLogEntry } from './types';\r\n\r\nconst MAX_LOGS = 200;  // Gi·ªõi h·∫°n ƒë·ªÉ tr√°nh localStorage qu√° t·∫£i\r\n\r\n// Generate simple ID\r\nconst generateLogId = (prefix: string): string => {\r\n  const timestamp = Date.now().toString(36);\r\n  const random = Math.random().toString(36).substring(2, 8);\r\n  return `${prefix}_${timestamp}_${random}`;\r\n};\r\n\r\ninterface ImportExportState {\r\n  importLogs: ImportLogEntry[];\r\n  exportLogs: ExportLogEntry[];\r\n  initialized: boolean;\r\n  \r\n  // Actions\r\n  addImportLog: (log: Omit<ImportLogEntry, 'id'>) => string;\r\n  addExportLog: (log: Omit<ExportLogEntry, 'id'>) => string;\r\n  \r\n  // Queries\r\n  getLogsByEntity: (entityType: string) => {\r\n    imports: ImportLogEntry[];\r\n    exports: ExportLogEntry[];\r\n  };\r\n  getRecentLogs: (limit?: number) => Array<(ImportLogEntry | ExportLogEntry) & { _type: 'import' | 'export' }>;\r\n  getImportLogById: (id: string) => ImportLogEntry | undefined;\r\n  getExportLogById: (id: string) => ExportLogEntry | undefined;\r\n  \r\n  // Management\r\n  deleteLog: (id: string, type: 'import' | 'export') => void;\r\n  clearLogs: (entityType?: string) => void;\r\n}\r\n\r\nexport const useImportExportStore = create<ImportExportState>()(\r\n  (set, get) => ({\r\n    importLogs: [],\r\n    exportLogs: [],\r\n    initialized: false,\r\n    \r\n    addImportLog: (log) => {\r\n        const id = generateLogId('IMP');\r\n        const newLog: ImportLogEntry = { ...log, id };\r\n        \r\n        set((state) => ({\r\n          importLogs: [newLog, ...state.importLogs].slice(0, MAX_LOGS),\r\n        }));\r\n        \r\n        return id;\r\n      },\r\n      \r\n      addExportLog: (log) => {\r\n        const id = generateLogId('EXP');\r\n        const newLog: ExportLogEntry = { ...log, id };\r\n        \r\n        set((state) => ({\r\n          exportLogs: [newLog, ...state.exportLogs].slice(0, MAX_LOGS),\r\n        }));\r\n        \r\n        return id;\r\n      },\r\n      \r\n      getLogsByEntity: (entityType) => ({\r\n        imports: get().importLogs.filter((l) => l.entityType === entityType),\r\n        exports: get().exportLogs.filter((l) => l.entityType === entityType),\r\n      }),\r\n      \r\n      getRecentLogs: (limit = 50) => {\r\n        const all = [\r\n          ...get().importLogs.map((l) => ({ ...l, _type: 'import' as const })),\r\n          ...get().exportLogs.map((l) => ({ ...l, _type: 'export' as const })),\r\n        ];\r\n        return all\r\n          .sort((a, b) => new Date(b.performedAt).getTime() - new Date(a.performedAt).getTime())\r\n          .slice(0, limit);\r\n      },\r\n      \r\n      getImportLogById: (id) => {\r\n        return get().importLogs.find((l) => l.id === id);\r\n      },\r\n      \r\n      getExportLogById: (id) => {\r\n        return get().exportLogs.find((l) => l.id === id);\r\n      },\r\n      \r\n      deleteLog: (id, type) => {\r\n        if (type === 'import') {\r\n          set((state) => ({\r\n            importLogs: state.importLogs.filter((l) => l.id !== id),\r\n          }));\r\n        } else {\r\n          set((state) => ({\r\n            exportLogs: state.exportLogs.filter((l) => l.id !== id),\r\n          }));\r\n        }\r\n      },\r\n      \r\n      clearLogs: (entityType) => {\r\n        if (entityType) {\r\n          set((state) => ({\r\n            importLogs: state.importLogs.filter((l) => l.entityType !== entityType),\r\n            exportLogs: state.exportLogs.filter((l) => l.entityType !== entityType),\r\n          }));\r\n        } else {\r\n          set({ importLogs: [], exportLogs: [] });\r\n        }\r\n      },\r\n      \r\n      loadFromAPI: async () => {\r\n        if (get().initialized) return;\r\n        try {\r\n          const response = await fetch('/api/import-export-logs?limit=500');\r\n          if (response.ok) {\r\n            const json = await response.json();\r\n            const data = json.data || {};\r\n            set({ \r\n              importLogs: data.importLogs || [], \r\n              exportLogs: data.exportLogs || [],\r\n              initialized: true \r\n            });\r\n          }\r\n        } catch (error) {\r\n          console.error('[Import Export Store] loadFromAPI error:', error);\r\n        }\r\n      },\r\n    })\r\n);\r\n\r\n// ============================================\r\n// SELECTORS (for optimization)\r\n// ============================================\r\n\r\nexport const selectImportLogs = (state: ImportExportState) => state.importLogs;\r\nexport const selectExportLogs = (state: ImportExportState) => state.exportLogs;\r\n\r\nexport const selectImportLogsByEntity = (entityType: string) => (state: ImportExportState) =>\r\n  state.importLogs.filter((l) => l.entityType === entityType);\r\n\r\nexport const selectExportLogsByEntity = (entityType: string) => (state: ImportExportState) =>\r\n  state.exportLogs.filter((l) => l.entityType === entityType);\r\n\r\n// ============================================\r\n// FUTURE: API Service (Next.js migration)\r\n// ============================================\r\n// \r\n// export async function saveImportLog(log: Omit<ImportLogEntry, 'id'>) {\r\n//   return fetch('/api/import-export/logs', {\r\n//     method: 'POST',\r\n//     headers: { 'Content-Type': 'application/json' },\r\n//     body: JSON.stringify({ type: 'import', ...log }),\r\n//   }).then(r => r.json());\r\n// }\r\n// \r\n// export async function getImportExportLogs(params: {\r\n//   entityType?: string;\r\n//   type?: 'import' | 'export';\r\n//   limit?: number;\r\n// }) {\r\n//   const query = new URLSearchParams(params as Record<string, string>);\r\n//   return fetch(`/api/import-export/logs?${query}`).then(r => r.json());\r\n// }\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1969, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/import-export/employee-mapping-store.ts"],"sourcesContent":["/**\r\n * Employee Mapping Store\r\n * \r\n * L∆∞u mapping gi·ªØa t√™n NV m√°y ch·∫•m c√¥ng ‚Üí M√£ NV h·ªá th·ªëng\r\n * Mapping ƒë∆∞·ª£c l∆∞u ƒë·ªÉ t√°i s·ª≠ d·ª•ng cho c√°c l·∫ßn import sau\r\n */\r\n\r\nimport { create } from 'zustand';\r\nimport type { EmployeeMappingEntry } from './types';\r\n\r\n// Generate simple ID\r\nconst generateMappingId = (): string => {\r\n  const timestamp = Date.now().toString(36);\r\n  const random = Math.random().toString(36).substring(2, 6);\r\n  return `MAP_${timestamp}_${random}`;\r\n};\r\n\r\ninterface EmployeeMappingState {\r\n  mappings: EmployeeMappingEntry[];\r\n  initialized: boolean;\r\n  \r\n  // Actions\r\n  addMapping: (entry: Omit<EmployeeMappingEntry, 'id' | 'createdAt' | 'updatedAt'>) => string;\r\n  updateMapping: (id: string, updates: Partial<Omit<EmployeeMappingEntry, 'id'>>) => void;\r\n  deleteMapping: (id: string) => void;\r\n  \r\n  // Bulk actions\r\n  addMappings: (entries: Array<Omit<EmployeeMappingEntry, 'id' | 'createdAt' | 'updatedAt'>>) => void;\r\n  clearMappings: () => void;\r\n  \r\n  // Queries\r\n  findByMachineName: (machineName: string) => EmployeeMappingEntry | undefined;\r\n  findByMachineId: (machineId: number) => EmployeeMappingEntry | undefined;\r\n  findBySystemId: (systemId: string) => EmployeeMappingEntry | undefined;\r\n  \r\n  // Auto-mapping helper\r\n  autoMapEmployees: (\r\n    machineNames: string[],\r\n    systemEmployees: Array<{ systemId: string; businessId: string; fullName: string }>\r\n  ) => {\r\n    mapped: Array<{ machineName: string; systemId: string; systemName: string }>;\r\n    unmapped: string[];\r\n  };\r\n}\r\n\r\n/**\r\n * Normalize t√™n ƒë·ªÉ so s√°nh (lowercase, remove diacritics, trim)\r\n */\r\nfunction normalizeName(name: string): string {\r\n  return name\r\n    .toLowerCase()\r\n    .trim()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '') // Remove diacritics\r\n    .replace(/ƒë/g, 'd')\r\n    .replace(/ƒê/g, 'D')\r\n    .replace(/\\s+/g, ' '); // Normalize spaces\r\n}\r\n\r\n/**\r\n * Check if two names match (fuzzy matching)\r\n */\r\nfunction namesMatch(machineName: string, systemName: string): boolean {\r\n  const normalizedMachine = normalizeName(machineName);\r\n  const normalizedSystem = normalizeName(systemName);\r\n  \r\n  // Exact match\r\n  if (normalizedMachine === normalizedSystem) return true;\r\n  \r\n  // Machine name is part of system name\r\n  if (normalizedSystem.includes(normalizedMachine)) return true;\r\n  \r\n  // System name parts match machine name\r\n  const systemParts = normalizedSystem.split(' ');\r\n  const machineParts = normalizedMachine.split(' ');\r\n  \r\n  // Check if all machine parts are in system name\r\n  const allPartsMatch = machineParts.every((part) =>\r\n    systemParts.some((sp) => sp === part || sp.includes(part) || part.includes(sp))\r\n  );\r\n  if (allPartsMatch && machineParts.length >= 2) return true;\r\n  \r\n  // Check last name + first name match\r\n  // VD: \"duc dat\" matches \"Nguy·ªÖn ƒê·ª©c ƒê·∫°t\" (ƒë·ª©c ƒë·∫°t)\r\n  if (systemParts.length >= 2 && machineParts.length >= 2) {\r\n    const systemLastParts = systemParts.slice(-2).join(' ');\r\n    if (normalizedMachine === systemLastParts) return true;\r\n  }\r\n  \r\n  return false;\r\n}\r\n\r\nexport const useEmployeeMappingStore = create<EmployeeMappingState>()(\r\n  (set, get) => ({\r\n    mappings: [],\r\n    initialized: false,\r\n    \r\n    addMapping: (entry) => {\r\n        const id = generateMappingId();\r\n        const now = new Date().toISOString();\r\n        const newEntry: EmployeeMappingEntry = {\r\n          ...entry,\r\n          id,\r\n          createdAt: now,\r\n          updatedAt: now,\r\n        };\r\n        \r\n        set((state) => ({\r\n          mappings: [...state.mappings, newEntry],\r\n        }));\r\n        \r\n        return id;\r\n      },\r\n      \r\n      updateMapping: (id, updates) => {\r\n        set((state) => ({\r\n          mappings: state.mappings.map((m) =>\r\n            m.id === id\r\n              ? { ...m, ...updates, updatedAt: new Date().toISOString() }\r\n              : m\r\n          ),\r\n        }));\r\n      },\r\n      \r\n      deleteMapping: (id) => {\r\n        set((state) => ({\r\n          mappings: state.mappings.filter((m) => m.id !== id),\r\n        }));\r\n      },\r\n      \r\n      addMappings: (entries) => {\r\n        const now = new Date().toISOString();\r\n        const newEntries: EmployeeMappingEntry[] = entries.map((entry) => ({\r\n          ...entry,\r\n          id: generateMappingId(),\r\n          createdAt: now,\r\n          updatedAt: now,\r\n        }));\r\n        \r\n        set((state) => ({\r\n          mappings: [...state.mappings, ...newEntries],\r\n        }));\r\n      },\r\n      \r\n      clearMappings: () => {\r\n        set({ mappings: [] });\r\n      },\r\n      \r\n      findByMachineName: (machineName) => {\r\n        const normalized = normalizeName(machineName);\r\n        return get().mappings.find(\r\n          (m) => normalizeName(m.machineName) === normalized\r\n        );\r\n      },\r\n      \r\n      findByMachineId: (machineId) => {\r\n        return get().mappings.find((m) => m.machineEmployeeId === machineId);\r\n      },\r\n      \r\n      findBySystemId: (systemId) => {\r\n        return get().mappings.find((m) => m.systemEmployeeId === systemId);\r\n      },\r\n      \r\n      autoMapEmployees: (machineNames, systemEmployees) => {\r\n        const mapped: Array<{ machineName: string; systemId: string; systemName: string }> = [];\r\n        const unmapped: string[] = [];\r\n        const existingMappings = get().mappings;\r\n        \r\n        for (const machineName of machineNames) {\r\n          // 1. Check existing mapping first\r\n          const existingMapping = existingMappings.find(\r\n            (m) => normalizeName(m.machineName) === normalizeName(machineName)\r\n          );\r\n          \r\n          if (existingMapping) {\r\n            mapped.push({\r\n              machineName,\r\n              systemId: existingMapping.systemEmployeeId,\r\n              systemName: existingMapping.systemEmployeeName,\r\n            });\r\n            continue;\r\n          }\r\n          \r\n          // 2. Try to auto-match with system employees\r\n          const matchedEmployee = systemEmployees.find((emp) =>\r\n            namesMatch(machineName, emp.fullName)\r\n          );\r\n          \r\n          if (matchedEmployee) {\r\n            mapped.push({\r\n              machineName,\r\n              systemId: matchedEmployee.businessId,\r\n              systemName: matchedEmployee.fullName,\r\n            });\r\n          } else {\r\n            unmapped.push(machineName);\r\n          }\r\n        }\r\n        \r\n        return { mapped, unmapped };\r\n      },\r\n      \r\n      loadFromAPI: async () => {\r\n        if (get().initialized) return;\r\n        try {\r\n          // NOTE: Employee mappings are typically small dataset\r\n          const response = await fetch('/api/employee-mappings?limit=100');\r\n          if (response.ok) {\r\n            const json = await response.json();\r\n            const data = json.data || [];\r\n            if (data.length > 0) {\r\n              set({ mappings: data, initialized: true });\r\n            } else {\r\n              set({ initialized: true });\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('[Employee Mapping Store] loadFromAPI error:', error);\r\n        }\r\n      },\r\n    })\r\n);\r\n\r\n// ============================================\r\n// HELPER FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Save auto-mapped results to store\r\n */\r\nexport function saveMappingsFromAutoMap(\r\n  autoMapResult: ReturnType<EmployeeMappingState['autoMapEmployees']>,\r\n  machineIds: Map<string, number> // Map<machineName, machineId>\r\n): void {\r\n  const store = useEmployeeMappingStore.getState();\r\n  \r\n  const newMappings = autoMapResult.mapped\r\n    .filter((m) => !store.findByMachineName(m.machineName)) // Skip existing\r\n    .map((m) => ({\r\n      machineEmployeeId: machineIds.get(m.machineName) || 0,\r\n      machineName: m.machineName,\r\n      systemEmployeeId: m.systemId,\r\n      systemEmployeeName: m.systemName,\r\n    }));\r\n  \r\n  if (newMappings.length > 0) {\r\n    store.addMappings(newMappings);\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2157, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/import-export/utils.ts"],"sourcesContent":["/**\r\n * Import/Export Utilities\r\n * \r\n * C√°c h√†m ti·ªán √≠ch cho import/export:\r\n * - Preview (r√† so√°t) d·ªØ li·ªáu tr∆∞·ªõc khi import\r\n * - Validate fields v√† rows\r\n * - Transform data\r\n */\r\n\r\nimport type {\r\n  ImportExportConfig,\r\n  ImportPreviewRow,\r\n  ImportPreviewResult,\r\n  ImportPreviewStatus,\r\n  FieldConfig,\r\n} from './types';\r\nimport { formatDateForDisplay } from '@/lib/date-utils';\r\n\r\n// ============================================\r\n// PREVIEW IMPORT DATA\r\n// ============================================\r\n\r\ntype ImportMode = 'insert-only' | 'update-only' | 'upsert';\r\n\r\n/**\r\n * R√† so√°t d·ªØ li·ªáu tr∆∞·ªõc khi import\r\n * Tr·∫£ v·ªÅ preview v·ªõi status t·ª´ng d√≤ng\r\n */\r\nexport function previewImportData<T>(\r\n  rawRows: Record<string, unknown>[],\r\n  config: ImportExportConfig<T>,\r\n  existingData: T[],\r\n  mode: ImportMode = 'upsert',\r\n  branchSystemId?: string\r\n): ImportPreviewResult<T> {\r\n  const rows: ImportPreviewRow<T>[] = [];\r\n  let validCount = 0;\r\n  let warningCount = 0;\r\n  let errorCount = 0;\r\n  let duplicateCount = 0;\r\n\r\n  // 0. Pre-process all rows if defined (for fill-down logic, multi-row grouping)\r\n  let processedRawRows = rawRows;\r\n  if (config.preProcessRows) {\r\n    processedRawRows = config.preProcessRows(rawRows) as Record<string, unknown>[];\r\n  }\r\n\r\n  processedRawRows.forEach((rawData, index) => {\r\n    const rowErrors: Array<{ field?: string; message: string }> = [];\r\n    const rowWarnings: Array<{ field?: string; message: string }> = [];\r\n\r\n    // 0.5. Apply preTransformRawRow if defined (normalize/merge raw columns)\r\n    let normalizedRawData = rawData;\r\n    if (config.preTransformRawRow) {\r\n      normalizedRawData = config.preTransformRawRow(rawData);\r\n    }\r\n\r\n    // 1. Transform raw data to typed data\r\n    let transformedData = transformImportRow<T>(normalizedRawData, config.fields);\r\n\r\n    // 1.5. Apply postTransformRow if defined (enrich data, lookup IDs, etc.)\r\n    if (config.postTransformRow) {\r\n      transformedData = config.postTransformRow(transformedData, index, branchSystemId);\r\n    }\r\n\r\n    // 2. Validate t·ª´ng field theo config\r\n    for (const field of config.fields) {\r\n      if (field.hidden) continue; // Skip hidden fields\r\n      \r\n      const value = transformedData[field.key as keyof typeof transformedData];\r\n      const fieldErrors = validateField(value, field, transformedData);\r\n      \r\n      // Separate warnings from errors (warnings start with [Warning])\r\n      fieldErrors.forEach(err => {\r\n        if (err.message.startsWith('[Warning]')) {\r\n          rowWarnings.push({ ...err, message: err.message.replace('[Warning] ', '') });\r\n        } else {\r\n          rowErrors.push(err);\r\n        }\r\n      });\r\n    }\r\n\r\n    // 3. Validate row-level (custom validation) - pass mode so it can skip duplicate checks in upsert\r\n    if (config.validateRow) {\r\n      const rowLevelErrors = config.validateRow(transformedData as T, index, existingData, mode);\r\n      rowLevelErrors.forEach(err => {\r\n        if (err.message.startsWith('[Warning]')) {\r\n          rowWarnings.push({ ...err, message: err.message.replace('[Warning] ', '') });\r\n        } else {\r\n          rowErrors.push(err);\r\n        }\r\n      });\r\n    }\r\n\r\n    // 4. Check existing record (upsert logic)\r\n    let existingRecord: T | null = null;\r\n    let isExisting = false;\r\n    let status: ImportPreviewStatus = 'valid';\r\n\r\n    if (config.findExisting) {\r\n      existingRecord = config.findExisting(transformedData as T, existingData);\r\n    } else if (config.upsertKey) {\r\n      // Default: find by upsertKey\r\n      const businessId = transformedData[config.upsertKey as keyof typeof transformedData];\r\n      existingRecord = existingData.find(\r\n        (e) => e[config.upsertKey as keyof T] === businessId\r\n      ) || null;\r\n    }\r\n\r\n    isExisting = existingRecord !== null;\r\n\r\n    // 5. Determine status based on mode and validation\r\n    if (rowErrors.length > 0) {\r\n      status = 'error';\r\n      errorCount++;\r\n    } else if (isExisting) {\r\n      if (mode === 'insert-only') {\r\n        status = 'duplicate';\r\n        duplicateCount++;\r\n      } else if (mode === 'update-only' || mode === 'upsert') {\r\n        status = 'will-update';\r\n        if (rowWarnings.length > 0) {\r\n          status = 'warning';\r\n          warningCount++;\r\n        } else {\r\n          validCount++;\r\n        }\r\n      }\r\n    } else {\r\n      if (mode === 'update-only') {\r\n        status = 'error';\r\n        errorCount++;\r\n        rowErrors.push({ message: 'Kh√¥ng t√¨m th·∫•y record ƒë·ªÉ c·∫≠p nh·∫≠t' });\r\n      } else if (mode === 'insert-only' || mode === 'upsert') {\r\n        status = 'will-insert';\r\n        if (rowWarnings.length > 0) {\r\n          status = 'warning';\r\n          warningCount++;\r\n        } else {\r\n          validCount++;\r\n        }\r\n      }\r\n    }\r\n\r\n    rows.push({\r\n      rowNumber: index + 2, // Excel row (header = row 1)\r\n      rawData,\r\n      transformedData: rowErrors.length > 0 ? null : transformedData as Partial<T>,\r\n      status,\r\n      errors: rowErrors,\r\n      warnings: rowWarnings,\r\n      isExisting,\r\n      existingRecord: existingRecord || undefined,\r\n    });\r\n  });\r\n\r\n  return {\r\n    rows,\r\n    totalRows: rawRows.length,\r\n    validCount,\r\n    warningCount,\r\n    errorCount,\r\n    duplicateCount,\r\n    isValid: (validCount + warningCount) > 0,\r\n  };\r\n}\r\n\r\n// ============================================\r\n// FIELD VALIDATION\r\n// ============================================\r\n\r\n/**\r\n * Validate m·ªôt field theo config\r\n */\r\nexport function validateField<T>(\r\n  value: unknown,\r\n  field: FieldConfig<T>,\r\n  row: Partial<T>\r\n): Array<{ field?: string; message: string }> {\r\n  const errors: Array<{ field?: string; message: string }> = [];\r\n  const fieldKey = field.key as string;\r\n\r\n  // Check required\r\n  if (field.required && (value === undefined || value === null || value === '')) {\r\n    errors.push({ field: fieldKey, message: `${field.label} l√† b·∫Øt bu·ªôc` });\r\n    return errors; // Skip other validations if required field is empty\r\n  }\r\n\r\n  // Skip validation if value is empty and not required\r\n  if (value === undefined || value === null || value === '') {\r\n    return errors;\r\n  }\r\n\r\n  // Type-specific validation\r\n  switch (field.type) {\r\n    case 'email':\r\n      if (typeof value === 'string' && !/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(value)) {\r\n        errors.push({ field: fieldKey, message: `${field.label} kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng email` });\r\n      }\r\n      break;\r\n\r\n    case 'phone':\r\n      if (typeof value === 'string') {\r\n        const cleaned = value.replace(/\\s/g, '');\r\n        if (!/^0\\d{9,10}$/.test(cleaned)) {\r\n          errors.push({ field: fieldKey, message: `${field.label} kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng SƒêT` });\r\n        }\r\n      }\r\n      break;\r\n\r\n    case 'number':\r\n      if (typeof value !== 'number' && isNaN(Number(value))) {\r\n        errors.push({ field: fieldKey, message: `${field.label} ph·∫£i l√† s·ªë` });\r\n      }\r\n      break;\r\n\r\n    case 'date':\r\n      if (typeof value === 'string') {\r\n        const date = new Date(value);\r\n        if (isNaN(date.getTime())) {\r\n          errors.push({ field: fieldKey, message: `${field.label} kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng ng√†y` });\r\n        }\r\n      }\r\n      break;\r\n\r\n    case 'enum':\r\n      if (field.enumValues && !field.enumValues.includes(String(value))) {\r\n        errors.push({\r\n          field: fieldKey,\r\n          message: `${field.label} ph·∫£i l√† m·ªôt trong: ${field.enumValues.join(', ')}`,\r\n        });\r\n      }\r\n      break;\r\n\r\n    case 'boolean':\r\n      const boolValues = ['true', 'false', '1', '0', 'yes', 'no', 'c√≥', 'kh√¥ng'];\r\n      if (typeof value === 'string' && !boolValues.includes(value.toLowerCase())) {\r\n        errors.push({ field: fieldKey, message: `${field.label} ph·∫£i l√† C√≥/Kh√¥ng` });\r\n      }\r\n      break;\r\n  }\r\n\r\n  // Custom validator\r\n  if (field.validator) {\r\n    const customError = field.validator(value, row);\r\n    if (customError && customError !== true) {\r\n      errors.push({ field: fieldKey, message: customError as string });\r\n    }\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n// ============================================\r\n// DATA TRANSFORMATION\r\n// ============================================\r\n\r\n/**\r\n * Set nested value in object using dot notation key\r\n * e.g., setNestedValue(obj, 'permanentAddress.street', '123 ABC')\r\n */\r\nfunction setNestedValue(obj: Record<string, unknown>, path: string, value: unknown): void {\r\n  const keys = path.split('.');\r\n  let current = obj;\r\n  \r\n  for (let i = 0; i < keys.length - 1; i++) {\r\n    const key = keys[i];\r\n    if (current[key] === undefined) {\r\n      current[key] = {};\r\n    }\r\n    current = current[key] as Record<string, unknown>;\r\n  }\r\n  \r\n  current[keys[keys.length - 1]] = value;\r\n}\r\n\r\n/**\r\n * Get nested value from object using dot notation key\r\n * e.g., getNestedValue(obj, 'permanentAddress.street')\r\n */\r\nfunction getNestedValue(obj: unknown, path: string): unknown {\r\n  if (!obj || typeof obj !== 'object') return undefined;\r\n  \r\n  const keys = path.split('.');\r\n  let current = obj as Record<string, unknown>;\r\n  \r\n  for (const key of keys) {\r\n    if (current === undefined || current === null) return undefined;\r\n    current = current[key] as Record<string, unknown>;\r\n  }\r\n  \r\n  return current;\r\n}\r\n\r\n/**\r\n * Transform d·ªØ li·ªáu t·ª´ Excel sang App format\r\n * H·ªó tr·ª£ nested keys nh∆∞ 'permanentAddress.street'\r\n */\r\nexport function transformImportRow<T>(\r\n  row: Record<string, unknown>,\r\n  fields: FieldConfig<T>[]\r\n): Partial<T> {\r\n  const result: Record<string, unknown> = {};\r\n\r\n  for (const field of fields) {\r\n    const key = field.key as string;\r\n    let value = row[field.label] ?? row[key]; // Try label first, then key\r\n\r\n    // Apply import transform\r\n    if (field.importTransform && value !== undefined) {\r\n      value = field.importTransform(value);\r\n    } else {\r\n      // Default transforms\r\n      switch (field.type) {\r\n        case 'number':\r\n          value = value !== undefined && value !== '' ? Number(value) || 0 : undefined;\r\n          break;\r\n        case 'boolean':\r\n          if (typeof value === 'string') {\r\n            value = ['true', '1', 'yes', 'c√≥'].includes(value.toLowerCase());\r\n          }\r\n          break;\r\n        case 'date':\r\n          // Excel serial date ‚Üí ISO string\r\n          if (typeof value === 'number') {\r\n            const date = new Date((value - 25569) * 86400 * 1000);\r\n            value = date.toISOString().split('T')[0];\r\n          }\r\n          break;\r\n      }\r\n    }\r\n\r\n    // Apply default value if empty\r\n    if ((value === undefined || value === null || value === '') && field.defaultValue !== undefined) {\r\n      value = field.defaultValue;\r\n    }\r\n\r\n    if (value !== undefined && value !== '') {\r\n      // Support nested keys like 'permanentAddress.street'\r\n      if (key.includes('.')) {\r\n        setNestedValue(result, key, value);\r\n      } else {\r\n        result[key] = value;\r\n      }\r\n    }\r\n  }\r\n\r\n  return result as Partial<T>;\r\n}\r\n\r\n/**\r\n * Transform d·ªØ li·ªáu t·ª´ App sang Excel format\r\n * H·ªó tr·ª£ nested keys nh∆∞ 'permanentAddress.street'\r\n */\r\nexport function transformExportRow<T>(\r\n  row: T,\r\n  fields: FieldConfig<T>[],\r\n  selectedColumns?: string[]\r\n): Record<string, unknown> {\r\n  const result: Record<string, unknown> = {};\r\n\r\n  for (const field of fields) {\r\n    // Skip if not selected\r\n    if (selectedColumns && !selectedColumns.includes(field.key as string)) {\r\n      continue;\r\n    }\r\n\r\n    // Skip if not exportable\r\n    if (field.exportable === false) {\r\n      continue;\r\n    }\r\n\r\n    const key = field.key as string;\r\n    // Support nested keys like 'permanentAddress.street'\r\n    let value = key.includes('.') \r\n      ? getNestedValue(row, key) \r\n      : row[key as keyof T];\r\n\r\n    // Apply export transform\r\n    if (field.exportTransform && value !== undefined) {\r\n      value = field.exportTransform(value) as T[keyof T];\r\n    } else if (field.transform && value !== undefined) {\r\n      // Also use 'transform' for display purposes\r\n      value = field.transform(value) as T[keyof T];\r\n    } else {\r\n      // Default transforms\r\n      switch (field.type) {\r\n        case 'date':\r\n          if (value) {\r\n            value = formatDateForDisplay(value as string) as T[keyof T];\r\n          }\r\n          break;\r\n        case 'boolean':\r\n          value = (value ? 'C√≥' : 'Kh√¥ng') as T[keyof T];\r\n          break;\r\n      }\r\n    }\r\n\r\n    result[field.label] = value;\r\n  }\r\n\r\n  return result;\r\n}\r\n\r\n// ============================================\r\n// UNIQUE CHECK\r\n// ============================================\r\n\r\n/**\r\n * Check unique fields trong existing data\r\n */\r\nexport function checkUniqueFields<T>(\r\n  row: Partial<T>,\r\n  uniqueFields: (keyof T)[],\r\n  existingData: T[],\r\n  currentBusinessId?: unknown\r\n): Array<{ field: string; message: string }> {\r\n  const errors: Array<{ field: string; message: string }> = [];\r\n\r\n  for (const field of uniqueFields) {\r\n    const value = row[field];\r\n    if (!value) continue;\r\n\r\n    const duplicate = existingData.find((e) => {\r\n      // Skip if same record (updating)\r\n      if (currentBusinessId && e[field as keyof T] === currentBusinessId) {\r\n        return false;\r\n      }\r\n      return e[field] === value;\r\n    });\r\n\r\n    if (duplicate) {\r\n      errors.push({\r\n        field: field as string,\r\n        message: `${field as string} ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng`,\r\n      });\r\n    }\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n// ============================================\r\n// FILE HELPERS\r\n// ============================================\r\n\r\n/**\r\n * Generate export filename\r\n */\r\nexport function generateExportFileName(\r\n  entityDisplayName: string,\r\n  scope: string\r\n): string {\r\n  const date = new Date().toISOString().split('T')[0];\r\n  const scopeLabel = scope === 'all' ? 'TatCa' : scope === 'current-page' ? 'TrangHienTai' : 'DaLoc';\r\n  return `${entityDisplayName.replace(/\\s+/g, '_')}_${scopeLabel}_${date}.xlsx`;\r\n}\r\n\r\n/**\r\n * Format file size\r\n */\r\nexport function formatFileSize(bytes: number): string {\r\n  if (bytes === 0) return '0 B';\r\n  const k = 1024;\r\n  const sizes = ['B', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return `${parseFloat((bytes / Math.pow(k, i)).toFixed(1))} ${sizes[i]}`;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2560, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/import-export/attendance-parser.ts"],"sourcesContent":["/**\r\n * Attendance Parser\r\n * \r\n * Parser ri√™ng cho file t·ª´ m√°y ch·∫•m c√¥ng\r\n * File c√≥ format ƒë·∫∑c bi·ªát: header ph·ª©c t·∫°p, merged cells, etc.\r\n * \r\n * C·∫•u tr√∫c file t11.xls:\r\n * - Sheet \"B·∫£ng t·ªïng h·ª£p ch·∫•m c√¥ng\": T·ªïng h·ª£p theo th√°ng (D√ôNG CH√çNH)\r\n * - Row 0: Ti√™u ƒë·ªÅ\r\n * - Row 1: Ng√†y th·ªëng k√™ (VD: \"Ng√†y th·ªëng k√™:2025-11-01~2025-11-30\")\r\n * - Row 2-3: Headers\r\n * - Row 4+: D·ªØ li·ªáu nh√¢n vi√™n\r\n */\r\n\r\nimport * as XLSX from 'xlsx';\r\nimport type { AttendanceImportRow } from './types';\r\n\r\n// ============================================\r\n// TYPES\r\n// ============================================\r\n\r\nexport interface AttendanceParseResult {\r\n  success: boolean;\r\n  data: AttendanceImportRow[];\r\n  month: number;\r\n  year: number;\r\n  dateRange: { from: string; to: string };\r\n  errors: Array<{ row: number; message: string }>;\r\n}\r\n\r\n// ============================================\r\n// PARSER\r\n// ============================================\r\n\r\n/**\r\n * Parse file ch·∫•m c√¥ng t·ª´ m√°y CC\r\n */\r\nexport function parseAttendanceFile(file: ArrayBuffer): AttendanceParseResult {\r\n  try {\r\n    const workbook = XLSX.read(file, { type: 'array' });\r\n    \r\n    // T√¨m sheet \"B·∫£ng t·ªïng h·ª£p ch·∫•m c√¥ng\"\r\n    const sheetName = 'B·∫£ng t·ªïng h·ª£p ch·∫•m c√¥ng';\r\n    const sheet = workbook.Sheets[sheetName];\r\n    \r\n    if (!sheet) {\r\n      return {\r\n        success: false,\r\n        data: [],\r\n        month: 0,\r\n        year: 0,\r\n        dateRange: { from: '', to: '' },\r\n        errors: [{ row: 0, message: `Kh√¥ng t√¨m th·∫•y sheet \"${sheetName}\"` }],\r\n      };\r\n    }\r\n    \r\n    // Convert to array\r\n    const rawData = XLSX.utils.sheet_to_json<unknown[]>(sheet, { header: 1 });\r\n    \r\n    // Parse date range t·ª´ row 1\r\n    const dateRangeRow = rawData[1] as string[];\r\n    const dateRange = parseDateRange(dateRangeRow?.[0] || '');\r\n    \r\n    // Parse data t·ª´ row 4 tr·ªü ƒëi\r\n    const data: AttendanceImportRow[] = [];\r\n    const errors: Array<{ row: number; message: string }> = [];\r\n    \r\n    for (let i = 4; i < rawData.length; i++) {\r\n      const row = rawData[i] as unknown[];\r\n      if (!row || row.length === 0) continue;\r\n      \r\n      // Skip if no employee ID\r\n      const machineId = row[0];\r\n      if (machineId === undefined || machineId === null || machineId === '') continue;\r\n      \r\n      try {\r\n        const parsed = parseAttendanceRow(row, i + 1); // Excel row = index + 1\r\n        data.push(parsed);\r\n      } catch (err) {\r\n        errors.push({\r\n          row: i + 1,\r\n          message: err instanceof Error ? err.message : 'L·ªói kh√¥ng x√°c ƒë·ªãnh',\r\n        });\r\n      }\r\n    }\r\n    \r\n    return {\r\n      success: errors.length === 0,\r\n      data,\r\n      month: dateRange.month,\r\n      year: dateRange.year,\r\n      dateRange: { from: dateRange.from, to: dateRange.to },\r\n      errors,\r\n    };\r\n  } catch (err) {\r\n    return {\r\n      success: false,\r\n      data: [],\r\n      month: 0,\r\n      year: 0,\r\n      dateRange: { from: '', to: '' },\r\n      errors: [{ row: 0, message: `L·ªói ƒë·ªçc file: ${err instanceof Error ? err.message : 'Unknown'}` }],\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Parse date range t·ª´ string \"Ng√†y th·ªëng k√™:2025-11-01~2025-11-30\"\r\n */\r\nfunction parseDateRange(text: string): { from: string; to: string; month: number; year: number } {\r\n  const match = text.match(/(\\d{4}-\\d{2}-\\d{2})~(\\d{4}-\\d{2}-\\d{2})/);\r\n  \r\n  if (match) {\r\n    const from = match[1];\r\n    const to = match[2];\r\n    const [year, month] = from.split('-').map(Number);\r\n    return { from, to, month, year };\r\n  }\r\n  \r\n  // Default to current month\r\n  const now = new Date();\r\n  return {\r\n    from: '',\r\n    to: '',\r\n    month: now.getMonth() + 1,\r\n    year: now.getFullYear(),\r\n  };\r\n}\r\n\r\n/**\r\n * Parse m·ªôt d√≤ng d·ªØ li·ªáu nh√¢n vi√™n\r\n * \r\n * C·ªôt trong file:\r\n * A (0): M√£ NV (m√°y)\r\n * B (1): H·ªç t√™n\r\n * C (2): Ph√≤ng ban\r\n * D (3): TG l√†m vi·ªác chu·∫©n\r\n * E (4): TG l√†m vi·ªác th·ª±c t·∫ø\r\n * F (5): ƒê·∫øn mu·ªôn (l·∫ßn)\r\n * G (6): ƒê·∫øn mu·ªôn (ph√∫t)\r\n * H (7): V·ªÅ s·ªõm (l·∫ßn)\r\n * I (8): V·ªÅ s·ªõm (ph√∫t)\r\n * J (9): TƒÉng ca b√¨nh th∆∞·ªùng\r\n * K (10): TƒÉng ca ƒë·∫∑c bi·ªát\r\n * L (11): S·ªë ng√†y (chu·∫©n/th·ª±c)\r\n * M (12): C√¥ng t√°c\r\n * N (13): Ngh·ªâ kh√¥ng ph√©p\r\n * O (14): Ngh·ªâ ph√©p\r\n */\r\nfunction parseAttendanceRow(row: unknown[], excelRow: number): AttendanceImportRow {\r\n  const getNumber = (value: unknown): number => {\r\n    if (value === undefined || value === null || value === '') return 0;\r\n    const num = Number(value);\r\n    return isNaN(num) ? 0 : num;\r\n  };\r\n  \r\n  const getString = (value: unknown): string => {\r\n    if (value === undefined || value === null) return '';\r\n    return String(value).trim();\r\n  };\r\n  \r\n  return {\r\n    machineEmployeeId: getNumber(row[0]),\r\n    employeeName: getString(row[1]),\r\n    department: getString(row[2]),\r\n    standardHours: getNumber(row[3]),\r\n    actualHours: getNumber(row[4]),\r\n    lateCount: getNumber(row[5]),\r\n    lateMinutes: getNumber(row[6]),\r\n    earlyLeaveCount: getNumber(row[7]),\r\n    earlyLeaveMinutes: getNumber(row[8]),\r\n    overtimeNormal: getNumber(row[9]),\r\n    overtimeSpecial: getNumber(row[10]),\r\n    workDays: getString(row[11]),\r\n    businessTrip: getNumber(row[12]),\r\n    absentWithoutLeave: getNumber(row[13]),\r\n    paidLeave: getNumber(row[14]),\r\n  };\r\n}\r\n\r\n// ============================================\r\n// UTILITIES\r\n// ============================================\r\n\r\n/**\r\n * Parse workDays string \"20/19\" ‚Üí { standard: 20, actual: 19 }\r\n */\r\nexport function parseWorkDays(workDays: string): { standard: number; actual: number } {\r\n  const cleaned = workDays.replace(/\\s/g, '');\r\n  const match = cleaned.match(/(\\d+)\\/(\\d+)/);\r\n  \r\n  if (match) {\r\n    return {\r\n      standard: parseInt(match[1], 10),\r\n      actual: parseInt(match[2], 10),\r\n    };\r\n  }\r\n  \r\n  return { standard: 0, actual: 0 };\r\n}\r\n\r\n/**\r\n * Get available sheets in workbook\r\n */\r\nexport function getAvailableSheets(file: ArrayBuffer): string[] {\r\n  const workbook = XLSX.read(file, { type: 'array' });\r\n  return workbook.SheetNames;\r\n}\r\n\r\n/**\r\n * Preview first N rows of a sheet\r\n */\r\nexport function previewSheet(\r\n  file: ArrayBuffer,\r\n  sheetName: string,\r\n  maxRows = 10\r\n): unknown[][] {\r\n  const workbook = XLSX.read(file, { type: 'array' });\r\n  const sheet = workbook.Sheets[sheetName];\r\n  \r\n  if (!sheet) return [];\r\n  \r\n  const data = XLSX.utils.sheet_to_json<unknown[]>(sheet, { header: 1 });\r\n  return data.slice(0, maxRows);\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2775, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/seed-audit.ts"],"sourcesContent":["import { asSystemId, type SystemId } from './id-types';\r\n\r\nexport const DEFAULT_SEED_AUTHOR = asSystemId('EMP000001');\r\n\r\ntype SeedAuditInput = {\r\n  createdAt: string;\r\n  createdBy?: SystemId;\r\n  updatedAt?: string;\r\n  updatedBy?: SystemId;\r\n};\r\n\r\nexport const buildSeedAuditFields = ({\r\n  createdAt,\r\n  createdBy = DEFAULT_SEED_AUTHOR,\r\n  updatedAt,\r\n  updatedBy,\r\n}: SeedAuditInput) => ({\r\n  createdAt,\r\n  updatedAt: updatedAt ?? createdAt,\r\n  createdBy,\r\n  updatedBy: updatedBy ?? createdBy,\r\n});\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,MAAM,sBAAsB,IAAA,mIAAU,EAAC;AASvC,MAAM,uBAAuB,CAAC,EACnC,SAAS,EACT,YAAY,mBAAmB,EAC/B,SAAS,EACT,SAAS,EACM,GAAK,CAAC;QACrB;QACA,WAAW,aAAa;QACxB;QACA,WAAW,aAAa;IAC1B,CAAC"}},
    {"offset": {"line": 2797, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/import-export/address-lookup.ts"],"sourcesContent":["/**\r\n * Address Lookup Helper for Import\r\n * \r\n * Chuy·ªÉn ƒë·ªïi t√™n ƒë·ªãa ch·ªâ th√†nh ID ƒë·ªÉ form edit c√≥ th·ªÉ populate ƒë√∫ng dropdown\r\n * \r\n * L∆ØU √ù QUAN TR·ªåNG:\r\n * - D·ªØ li·ªáu 2-level: 34 t·ªânh m·ªõi (provinces-data) + wards-2level-data\r\n * - D·ªØ li·ªáu 3-level: 63 t·ªânh c≈© (wards-3level-data c√≥ provinceName ri√™ng)\r\n * - C·∫ßn lookup t·ª´ WARD tr∆∞·ªõc ƒë·ªÉ l·∫•y ƒë√∫ng provinceId/districtId t·ª´ ward data\r\n */\r\n\r\nimport { useProvinceStore } from '@/features/settings/provinces/store';\r\nimport type { EmployeeAddress, AddressInputLevel } from '@/features/employees/types';\r\n\r\n// Common aliases for provinces\r\n// KEY = name in provinces-data (TP HCM, H√† N·ªôi, etc.)\r\n// VALUES = all possible variants including 3-level names\r\nconst PROVINCE_ALIASES: Record<string, string[]> = {\r\n  'TP HCM': [\r\n    'tp hcm', 'tphcm', 'hcm', 'sai gon', 'saigon',\r\n    'thanh pho ho chi minh', 'tp ho chi minh', 'ho chi minh',\r\n    'th√†nh ph·ªë h·ªì ch√≠ minh', // with diacritics for exact match\r\n  ],\r\n  'H√† N·ªôi': [\r\n    'ha noi', 'hanoi', 'hn',\r\n    'thanh pho ha noi', 'tp ha noi',\r\n    'th√†nh ph·ªë h√† n·ªôi',\r\n  ],\r\n  'ƒê√† N·∫µng': [\r\n    'da nang', 'danang',\r\n    'thanh pho da nang', 'tp da nang',\r\n    'th√†nh ph·ªë ƒë√† n·∫µng',\r\n  ],\r\n  'H·∫£i Ph√≤ng': [\r\n    'hai phong', 'haiphong', 'hp',\r\n    'thanh pho hai phong', 'tp hai phong',\r\n    'th√†nh ph·ªë h·∫£i ph√≤ng',\r\n  ],\r\n  'C·∫ßn Th∆°': [\r\n    'can tho', 'cantho',\r\n    'thanh pho can tho', 'tp can tho',\r\n    'th√†nh ph·ªë c·∫ßn th∆°',\r\n  ],\r\n};\r\n\r\n/**\r\n * Normalize t√™n ƒë·ªÉ so s√°nh (b·ªè d·∫•u, lowercase)\r\n */\r\nfunction normalizeText(text: string): string {\r\n  return text\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '')\r\n    .replace(/ƒë/g, 'd')\r\n    .replace(/ƒê/g, 'D')\r\n    .trim();\r\n}\r\n\r\n/**\r\n * So s√°nh 2 string ƒë√£ normalize\r\n */\r\nfunction matchText(a: string, b: string): boolean {\r\n  return normalizeText(a) === normalizeText(b);\r\n}\r\n\r\n/**\r\n * T√¨m t·ªânh/th√†nh ph·ªë theo t√™n\r\n */\r\nexport function findProvinceByName(provinceName: string): { id: string; name: string } | null {\r\n  if (!provinceName) return null;\r\n  \r\n  const store = useProvinceStore.getState();\r\n  const provinces = store.data;\r\n  \r\n  // Exact match first\r\n  let found = provinces.find(p => p.name === provinceName);\r\n  if (found) return { id: found.id, name: found.name };\r\n  \r\n  // Normalized match\r\n  found = provinces.find(p => matchText(p.name, provinceName));\r\n  if (found) return { id: found.id, name: found.name };\r\n  \r\n  // Try alias match\r\n  const normalizedInput = normalizeText(provinceName);\r\n  for (const [standardName, aliases] of Object.entries(PROVINCE_ALIASES)) {\r\n    if (aliases.some(alias => alias === normalizedInput || normalizedInput.includes(alias) || alias.includes(normalizedInput))) {\r\n      found = provinces.find(p => p.name === standardName);\r\n      if (found) return { id: found.id, name: found.name };\r\n    }\r\n  }\r\n  \r\n  // Partial match (contains) - last resort\r\n  found = provinces.find(p => \r\n    normalizeText(p.name).includes(normalizedInput) || \r\n    normalizedInput.includes(normalizeText(p.name))\r\n  );\r\n  \r\n  return found ? { id: found.id, name: found.name } : null;\r\n}\r\n\r\n/**\r\n * Remove common prefixes from district/ward names for better matching\r\n */\r\nfunction removeCommonPrefixes(text: string): string {\r\n  const prefixes = [\r\n    'quan ', 'huyen ', 'thi xa ', 'thanh pho ', 'tp ',\r\n    'phuong ', 'xa ', 'thi tran ', 'tt ',\r\n  ];\r\n  const normalized = normalizeText(text);\r\n  for (const prefix of prefixes) {\r\n    if (normalized.startsWith(prefix)) {\r\n      return normalized.slice(prefix.length);\r\n    }\r\n  }\r\n  return normalized;\r\n}\r\n\r\n/**\r\n * T√¨m qu·∫≠n/huy·ªán theo t√™n v√† provinceId\r\n */\r\nexport function findDistrictByName(\r\n  districtName: string, \r\n  provinceId: string\r\n): { id: number; name: string } | null {\r\n  if (!districtName || !provinceId) return null;\r\n  \r\n  const store = useProvinceStore.getState();\r\n  const districts = store.districts.filter(d => d.provinceId === provinceId);\r\n  \r\n  // Exact match first\r\n  let found = districts.find(d => d.name === districtName);\r\n  if (found) return { id: found.id, name: found.name };\r\n  \r\n  // Normalized match\r\n  found = districts.find(d => matchText(d.name, districtName));\r\n  if (found) return { id: found.id, name: found.name };\r\n  \r\n  // Try matching without prefixes\r\n  const inputWithoutPrefix = removeCommonPrefixes(districtName);\r\n  found = districts.find(d => {\r\n    const dbWithoutPrefix = removeCommonPrefixes(d.name);\r\n    return dbWithoutPrefix === inputWithoutPrefix;\r\n  });\r\n  if (found) return { id: found.id, name: found.name };\r\n  \r\n  // Partial match - last resort\r\n  const normalizedInput = normalizeText(districtName);\r\n  found = districts.find(d => \r\n    normalizeText(d.name).includes(normalizedInput) || \r\n    normalizedInput.includes(normalizeText(d.name))\r\n  );\r\n  \r\n  return found ? { id: found.id, name: found.name } : null;\r\n}\r\n\r\n/**\r\n * T√¨m ph∆∞·ªùng/x√£ theo t√™n, districtId v√† inputLevel\r\n */\r\nexport function findWardByName(\r\n  wardName: string,\r\n  provinceId: string,\r\n  districtId: number | null,\r\n  inputLevel: AddressInputLevel\r\n): { id: string; name: string; districtId?: number; districtName?: string } | null {\r\n  if (!wardName || !provinceId) return null;\r\n  \r\n  const store = useProvinceStore.getState();\r\n  \r\n  let wards = store.wards.filter(w => w.provinceId === provinceId);\r\n  \r\n  // Filter by level\r\n  if (inputLevel === '3-level' && districtId) {\r\n    wards = wards.filter(w => w.level === '3-level' && w.districtId === districtId);\r\n  } else if (inputLevel === '2-level') {\r\n    wards = wards.filter(w => w.level === '2-level');\r\n  }\r\n  \r\n  // Exact match first\r\n  let found = wards.find(w => w.name === wardName);\r\n  if (found) {\r\n    return { \r\n      id: found.id, \r\n      name: found.name,\r\n      districtId: found.districtId,\r\n      districtName: found.districtName,\r\n    };\r\n  }\r\n  \r\n  // Normalized match\r\n  found = wards.find(w => matchText(w.name, wardName));\r\n  if (found) {\r\n    return { \r\n      id: found.id, \r\n      name: found.name,\r\n      districtId: found.districtId,\r\n      districtName: found.districtName,\r\n    };\r\n  }\r\n  \r\n  // Try matching without prefixes\r\n  const inputWithoutPrefix = removeCommonPrefixes(wardName);\r\n  found = wards.find(w => {\r\n    const dbWithoutPrefix = removeCommonPrefixes(w.name);\r\n    return dbWithoutPrefix === inputWithoutPrefix;\r\n  });\r\n  if (found) {\r\n    return { \r\n      id: found.id, \r\n      name: found.name,\r\n      districtId: found.districtId,\r\n      districtName: found.districtName,\r\n    };\r\n  }\r\n  \r\n  // Partial match - last resort\r\n  const normalizedInput = normalizeText(wardName);\r\n  found = wards.find(w => \r\n    normalizeText(w.name).includes(normalizedInput) || \r\n    normalizedInput.includes(normalizeText(w.name))\r\n  );\r\n  \r\n  return found ? { \r\n    id: found.id, \r\n    name: found.name,\r\n    districtId: found.districtId,\r\n    districtName: found.districtName,\r\n  } : null;\r\n}\r\n\r\n/**\r\n * Lookup ƒë·∫ßy ƒë·ªß ƒë·ªãa ch·ªâ t·ª´ text sang EmployeeAddress v·ªõi IDs\r\n * \r\n * STRATEGY M·ªöI: Lookup t·ª´ WARD tr∆∞·ªõc ƒë·ªÉ l·∫•y ƒë√∫ng provinceId/districtId\r\n * v√¨ ward data c√≥ ƒë·ªß th√¥ng tin v·ªÅ province v√† district\r\n * \r\n * @param address - Partial address v·ªõi text names\r\n * @returns EmployeeAddress ho√†n ch·ªânh v·ªõi IDs\r\n */\r\nexport function lookupAddressIds(address: Partial<EmployeeAddress> | null | undefined): EmployeeAddress | null {\r\n  if (!address) return null;\r\n  if (!address.street && !address.province && !address.ward) return null;\r\n  \r\n  const inputLevel = address.inputLevel || '3-level';\r\n  const store = useProvinceStore.getState();\r\n  \r\n  console.log('[lookupAddressIds] Input address:', address);\r\n  console.log('[lookupAddressIds] inputLevel:', inputLevel);\r\n  \r\n  let provinceId = address.provinceId || '';\r\n  let provinceName = address.province || '';\r\n  let districtId = address.districtId || 0;\r\n  let districtName = address.district || '';\r\n  let wardId = address.wardId || '';\r\n  let wardName = address.ward || '';\r\n  \r\n  // === STRATEGY: Lookup t·ª´ ward tr∆∞·ªõc (c√≥ ƒë·∫ßy ƒë·ªß th√¥ng tin) ===\r\n  if (address.ward) {\r\n    const allWards = store.wards;\r\n    const normalizedWardInput = normalizeText(address.ward);\r\n    const wardWithoutPrefix = removeCommonPrefixes(address.ward);\r\n    \r\n    // Filter wards by level\r\n    const wardsOfLevel = allWards.filter(w => \r\n      inputLevel === '2-level' ? w.level === '2-level' : w.level === '3-level'\r\n    );\r\n    \r\n    // Try to find ward matching name AND province/district context\r\n    let foundWard = wardsOfLevel.find(w => {\r\n      const nameMatch = w.name === address.ward || \r\n                       matchText(w.name, address.ward!) ||\r\n                       removeCommonPrefixes(w.name) === wardWithoutPrefix;\r\n      if (!nameMatch) return false;\r\n      \r\n      // If province name provided, check if it matches ward's province\r\n      if (address.province) {\r\n        const normalizedProvince = normalizeText(address.province);\r\n        const wardProvince = normalizeText(w.provinceName || '');\r\n        // Check various matching patterns\r\n        if (!wardProvince.includes(normalizedProvince) && \r\n            !normalizedProvince.includes(wardProvince) &&\r\n            !matchProvinceAlias(address.province, w.provinceName || '')) {\r\n          return false;\r\n        }\r\n      }\r\n      \r\n      // If district name provided (3-level), check if it matches\r\n      if (inputLevel === '3-level' && address.district && w.districtName) {\r\n        const normalizedDistrict = normalizeText(address.district);\r\n        const wardDistrict = normalizeText(w.districtName);\r\n        const districtWithoutPrefix = removeCommonPrefixes(address.district);\r\n        const wardDistrictWithoutPrefix = removeCommonPrefixes(w.districtName);\r\n        \r\n        if (!wardDistrict.includes(normalizedDistrict) && \r\n            !normalizedDistrict.includes(wardDistrict) &&\r\n            wardDistrictWithoutPrefix !== districtWithoutPrefix) {\r\n          return false;\r\n        }\r\n      }\r\n      \r\n      return true;\r\n    });\r\n    \r\n    // If not found with context, try just by ward name\r\n    if (!foundWard) {\r\n      foundWard = wardsOfLevel.find(w => \r\n        w.name === address.ward || \r\n        matchText(w.name, address.ward!) ||\r\n        removeCommonPrefixes(w.name) === wardWithoutPrefix\r\n      );\r\n    }\r\n    \r\n    if (foundWard) {\r\n      console.log('[lookupAddressIds] Found ward:', foundWard);\r\n      wardId = foundWard.id;\r\n      wardName = foundWard.name;\r\n      \r\n      // IMPORTANT: Get provinceId from provinces-data (not from ward's provinceId)\r\n      // because ward data might have different provinceId (e.g. \"00\" vs \"24\" for HCM)\r\n      const provinceFromData = findProvinceByName(foundWard.provinceName || address.province || '');\r\n      if (provinceFromData) {\r\n        provinceId = provinceFromData.id;\r\n        provinceName = provinceFromData.name;\r\n      } else {\r\n        // Fallback to ward's data if not found in provinces-data\r\n        provinceId = foundWard.provinceId;\r\n        provinceName = foundWard.provinceName || address.province || '';\r\n      }\r\n      \r\n      if (foundWard.districtId) {\r\n        districtId = foundWard.districtId;\r\n        districtName = foundWard.districtName || address.district || '';\r\n      }\r\n    } else {\r\n      console.log('[lookupAddressIds] Ward NOT FOUND for:', address.ward);\r\n    }\r\n  }\r\n  \r\n  // === Fallback: If no ward found, try province lookup ===\r\n  if (!wardId && address.province) {\r\n    const province = findProvinceByName(address.province);\r\n    if (province) {\r\n      provinceId = province.id;\r\n      provinceName = province.name;\r\n    }\r\n    \r\n    // Try district lookup if province found\r\n    if (provinceId && address.district && inputLevel === '3-level') {\r\n      const district = findDistrictByName(address.district, provinceId);\r\n      if (district) {\r\n        districtId = district.id;\r\n        districtName = district.name;\r\n      }\r\n    }\r\n  }\r\n  \r\n  console.log('[lookupAddressIds] Result:', { provinceId, provinceName, districtId, districtName, wardId, wardName });\r\n  \r\n  return {\r\n    street: address.street || '',\r\n    province: provinceName,\r\n    provinceId: provinceId,\r\n    district: districtName,\r\n    districtId: districtId,\r\n    ward: wardName,\r\n    wardId: wardId,\r\n    inputLevel: inputLevel,\r\n  } as EmployeeAddress;\r\n}\r\n\r\n/**\r\n * Check if province names match (including aliases)\r\n */\r\nfunction matchProvinceAlias(input: string, dbName: string): boolean {\r\n  const normalizedInput = normalizeText(input);\r\n  const normalizedDb = normalizeText(dbName);\r\n  \r\n  // Direct match\r\n  if (normalizedInput === normalizedDb) return true;\r\n  \r\n  // Check aliases\r\n  for (const [standardName, aliases] of Object.entries(PROVINCE_ALIASES)) {\r\n    const normalizedStandard = normalizeText(standardName);\r\n    const inputIsAlias = aliases.some(a => a === normalizedInput || normalizedInput.includes(a));\r\n    const dbIsStandard = normalizedDb === normalizedStandard || normalizedDb.includes(normalizedStandard);\r\n    const dbIsAlias = aliases.some(a => normalizedDb.includes(a));\r\n    \r\n    if (inputIsAlias && (dbIsStandard || dbIsAlias)) return true;\r\n    if (dbIsAlias && normalizedInput === normalizedStandard) return true;\r\n  }\r\n  \r\n  return false;\r\n}\r\n\r\n/**\r\n * Post-process imported employee data ƒë·ªÉ lookup address IDs\r\n * G·ªçi h√†m n√†y sau khi transform import row\r\n */\r\nexport function enrichEmployeeAddresses<T extends { \r\n  permanentAddress?: EmployeeAddress | null;\r\n  temporaryAddress?: EmployeeAddress | null;\r\n}>(data: Partial<T>): Partial<T> {\r\n  const result = { ...data };\r\n  \r\n  console.log('[Address Lookup] Input:', {\r\n    permanentAddress: data.permanentAddress,\r\n    temporaryAddress: data.temporaryAddress,\r\n  });\r\n  \r\n  if (data.permanentAddress) {\r\n    const enriched = lookupAddressIds(data.permanentAddress);\r\n    console.log('[Address Lookup] permanentAddress enriched:', enriched);\r\n    if (enriched) {\r\n      result.permanentAddress = enriched;\r\n    }\r\n  }\r\n  \r\n  if (data.temporaryAddress) {\r\n    const enriched = lookupAddressIds(data.temporaryAddress);\r\n    console.log('[Address Lookup] temporaryAddress enriched:', enriched);\r\n    if (enriched) {\r\n      result.temporaryAddress = enriched;\r\n    }\r\n  }\r\n  \r\n  return result;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3176, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/import-export/configs/employee.config.ts"],"sourcesContent":["import type { Employee } from '@/features/employees/types';\r\nimport type { ImportExportConfig, FieldConfig } from '../types';\r\nimport { enrichEmployeeAddresses } from '../address-lookup';\r\n\r\n/**\r\n * Parse ƒë·ªãa ch·ªâ t·ª´ template m·ªõi\r\n * C·∫•u tr√∫c ƒë·ªãa ch·ªâ nh√¢n vi√™n (h·ªá th·ªëng 2 c·∫•p):\r\n * - ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫: T·ªânh/TP th∆∞·ªùng tr√∫, Ph∆∞·ªùng/X√£ th∆∞·ªùng tr√∫, S·ªë nh√† ƒë∆∞·ªùng th∆∞·ªùng tr√∫\r\n * - ƒê·ªãa ch·ªâ t·∫°m tr√∫: T·ªânh/TP t·∫°m tr√∫, Ph∆∞·ªùng/X√£ t·∫°m tr√∫, S·ªë nh√† ƒë∆∞·ªùng t·∫°m tr√∫\r\n */\r\n\r\ntype AddressType = 'permanent' | 'temporary';\r\n\r\ninterface ParsedAddress {\r\n  type: AddressType;\r\n  province: string;\r\n  ward: string;\r\n  street: string;\r\n}\r\n\r\nfunction parseEmployeeAddresses(rawRow: Record<string, unknown>): ParsedAddress[] {\r\n  const addresses: ParsedAddress[] = [];\r\n  \r\n  // ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫\r\n  const permanentProvince = rawRow['T·ªânh/TP th∆∞·ªùng tr√∫'];\r\n  const permanentWard = rawRow['Ph∆∞·ªùng/X√£ th∆∞·ªùng tr√∫'];\r\n  const permanentStreet = rawRow['S·ªë nh√†, ƒë∆∞·ªùng th∆∞·ªùng tr√∫'];\r\n  \r\n  if (permanentProvince || permanentWard || permanentStreet) {\r\n    addresses.push({\r\n      type: 'permanent',\r\n      province: String(permanentProvince || ''),\r\n      ward: String(permanentWard || ''),\r\n      street: String(permanentStreet || ''),\r\n    });\r\n  }\r\n  \r\n  // ƒê·ªãa ch·ªâ t·∫°m tr√∫\r\n  const temporaryProvince = rawRow['T·ªânh/TP t·∫°m tr√∫'];\r\n  const temporaryWard = rawRow['Ph∆∞·ªùng/X√£ t·∫°m tr√∫'];\r\n  const temporaryStreet = rawRow['S·ªë nh√†, ƒë∆∞·ªùng t·∫°m tr√∫'];\r\n  \r\n  if (temporaryProvince || temporaryWard || temporaryStreet) {\r\n    addresses.push({\r\n      type: 'temporary',\r\n      province: String(temporaryProvince || ''),\r\n      ward: String(temporaryWard || ''),\r\n      street: String(temporaryStreet || ''),\r\n    });\r\n  }\r\n  \r\n  return addresses;\r\n}\r\n\r\n/**\r\n * Normalize raw row t·ª´ template\r\n * Convert ƒë·ªãa ch·ªâ th∆∞·ªùng tr√∫/t·∫°m tr√∫ th√†nh permanentAddress/temporaryAddress\r\n */\r\nfunction normalizeEmployeeRawRow(rawRow: Record<string, unknown>): Record<string, unknown> {\r\n  const result = { ...rawRow };\r\n  \r\n  const parsedAddresses = parseEmployeeAddresses(rawRow);\r\n  \r\n  for (const addr of parsedAddresses) {\r\n    if (addr.type === 'permanent') {\r\n      // ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫ -> permanentAddress\r\n      result['__permanentAddress__'] = {\r\n        province: addr.province,\r\n        ward: addr.ward,\r\n        street: addr.street,\r\n        inputLevel: '2-level' as const,\r\n      };\r\n    } else if (addr.type === 'temporary') {\r\n      // ƒê·ªãa ch·ªâ t·∫°m tr√∫ -> temporaryAddress\r\n      result['__temporaryAddress__'] = {\r\n        province: addr.province,\r\n        ward: addr.ward,\r\n        street: addr.street,\r\n        inputLevel: '2-level' as const,\r\n      };\r\n    }\r\n  }\r\n  \r\n  return result;\r\n}\r\n\r\n// Field definitions cho Employee - ƒê·∫¶Y ƒê·ª¶ t·∫•t c·∫£ fields\r\n// CH·ªà B·∫ÆT BU·ªòC: id (M√£ nh√¢n vi√™n) v√† fullName (H·ªç v√† t√™n)\r\nconst employeeFields: FieldConfig<Employee>[] = [\r\n  // ===== TH√îNG TIN C∆† B·∫¢N =====\r\n  {\r\n    key: 'id',\r\n    label: 'M√£ nh√¢n vi√™n (*)',\r\n    required: true,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'NV001',\r\n  },\r\n  {\r\n    key: 'fullName',\r\n    label: 'H·ªç v√† t√™n (*)',\r\n    required: true,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'Nguy·ªÖn VƒÉn A',\r\n  },\r\n  {\r\n    key: 'gender',\r\n    label: 'Gi·ªõi t√≠nh',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'male',\r\n  },\r\n  {\r\n    key: 'dateOfBirth',\r\n    label: 'Ng√†y sinh',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: '1990-01-15',\r\n  },\r\n  {\r\n    key: 'placeOfBirth',\r\n    label: 'N∆°i sinh',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'H√† N·ªôi',\r\n  },\r\n  {\r\n    key: 'nationality',\r\n    label: 'Qu·ªëc t·ªãch',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'Vi·ªát Nam',\r\n  },\r\n  {\r\n    key: 'religion',\r\n    label: 'T√¥n gi√°o',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'Kh√¥ng',\r\n  },\r\n  {\r\n    key: 'maritalStatus',\r\n    label: 'T√¨nh tr·∫°ng h√¥n nh√¢n',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'single',\r\n  },\r\n  {\r\n    key: 'avatar',\r\n    label: '·∫¢nh ƒë·∫°i di·ªán',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    hidden: true,\r\n  },\r\n\r\n  // ===== TH√îNG TIN ƒêƒÇNG NH·∫¨P =====\r\n  {\r\n    key: 'workEmail',\r\n    label: 'Email c√¥ng ty',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin ƒëƒÉng nh·∫≠p',\r\n    example: 'nguyenvana@company.com',\r\n    validator: (value: unknown) => {\r\n      if (!value) return true;\r\n      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n      return emailRegex.test(String(value)) || 'Email kh√¥ng h·ª£p l·ªá';\r\n    },\r\n  },\r\n  {\r\n    key: 'password',\r\n    label: 'M·∫≠t kh·∫©u',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin ƒëƒÉng nh·∫≠p',\r\n    example: '********',\r\n    hidden: true, // Kh√¥ng export m·∫≠t kh·∫©u\r\n  },\r\n  {\r\n    key: 'role',\r\n    label: 'Vai tr√≤ h·ªá th·ªëng (*M·∫∑c ƒë·ªãnh: employee)',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin ƒëƒÉng nh·∫≠p',\r\n    example: 'employee',\r\n    defaultValue: 'employee',\r\n  },\r\n\r\n  // ===== GI·∫§Y T·ªú T√ôY TH√ÇN =====\r\n  {\r\n    key: 'nationalId',\r\n    label: 'CMND/CCCD',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Gi·∫•y t·ªù t√πy th√¢n',\r\n    example: '012345678901',\r\n  },\r\n  {\r\n    key: 'nationalIdIssueDate',\r\n    label: 'Ng√†y c·∫•p CMND/CCCD',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'Gi·∫•y t·ªù t√πy th√¢n',\r\n    example: '2020-01-15',\r\n  },\r\n  {\r\n    key: 'nationalIdIssuePlace',\r\n    label: 'N∆°i c·∫•p CMND/CCCD',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Gi·∫•y t·ªù t√πy th√¢n',\r\n    example: 'CA TP H√† N·ªôi',\r\n  },\r\n  {\r\n    key: 'personalTaxId',\r\n    label: 'M√£ s·ªë thu·∫ø c√° nh√¢n',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Gi·∫•y t·ªù t√πy th√¢n',\r\n    example: '0123456789',\r\n  },\r\n  {\r\n    key: 'socialInsuranceNumber',\r\n    label: 'S·ªë s·ªï BHXH',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Gi·∫•y t·ªù t√πy th√¢n',\r\n    example: '1234567890',\r\n  },\r\n\r\n  // ===== LI√äN H·ªÜ =====\r\n  {\r\n    key: 'personalEmail',\r\n    label: 'Email c√° nh√¢n',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Li√™n h·ªá',\r\n    example: 'nguyenvana@gmail.com',\r\n    validator: (value: unknown) => {\r\n      if (!value) return true;\r\n      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n      return emailRegex.test(String(value)) || 'Email kh√¥ng h·ª£p l·ªá';\r\n    },\r\n  },\r\n  {\r\n    key: 'phone',\r\n    label: 'S·ªë ƒëi·ªán tho·∫°i',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Li√™n h·ªá',\r\n    example: '0901234567',\r\n  },\r\n  \r\n  // ===== ƒê·ªäA CH·ªà TH∆Ø·ªúNG TR√ö (h·ªá th·ªëng 2 c·∫•p) =====\r\n  {\r\n    key: 'permanentAddress.province',\r\n    label: 'T·ªânh/TP th∆∞·ªùng tr√∫',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫',\r\n    example: 'H√† N·ªôi',\r\n  },\r\n  {\r\n    key: 'permanentAddress.ward',\r\n    label: 'Ph∆∞·ªùng/X√£ th∆∞·ªùng tr√∫',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫',\r\n    example: 'Ph∆∞·ªùng ƒêi·ªán Bi√™n',\r\n  },\r\n  {\r\n    key: 'permanentAddress.street',\r\n    label: 'S·ªë nh√†, ƒë∆∞·ªùng th∆∞·ªùng tr√∫',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫',\r\n    example: '123 ƒê∆∞·ªùng ABC',\r\n  },\r\n\r\n  // ===== ƒê·ªäA CH·ªà T·∫†M TR√ö (h·ªá th·ªëng 2 c·∫•p) =====\r\n  {\r\n    key: 'temporaryAddress.province',\r\n    label: 'T·ªânh/TP t·∫°m tr√∫',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'ƒê·ªãa ch·ªâ t·∫°m tr√∫',\r\n    example: 'H√† N·ªôi',\r\n  },\r\n  {\r\n    key: 'temporaryAddress.ward',\r\n    label: 'Ph∆∞·ªùng/X√£ t·∫°m tr√∫',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'ƒê·ªãa ch·ªâ t·∫°m tr√∫',\r\n    example: 'Ph∆∞·ªùng C·ªëng V·ªã',\r\n  },\r\n  {\r\n    key: 'temporaryAddress.street',\r\n    label: 'S·ªë nh√†, ƒë∆∞·ªùng t·∫°m tr√∫',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'ƒê·ªãa ch·ªâ t·∫°m tr√∫',\r\n    example: '456 ƒê∆∞·ªùng XYZ',\r\n  },\r\n\r\n  // ===== LI√äN H·ªÜ KH·∫®N C·∫§P =====\r\n  {\r\n    key: 'emergencyContactName',\r\n    label: 'Ng∆∞·ªùi li√™n h·ªá kh·∫©n c·∫•p',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Li√™n h·ªá kh·∫©n c·∫•p',\r\n    example: 'Nguy·ªÖn VƒÉn B',\r\n  },\r\n  {\r\n    key: 'emergencyContactPhone',\r\n    label: 'SƒêT kh·∫©n c·∫•p',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Li√™n h·ªá kh·∫©n c·∫•p',\r\n    example: '0908765432',\r\n  },\r\n\r\n  // ===== C√îNG VI·ªÜC =====\r\n  {\r\n    key: 'departmentId',\r\n    label: 'M√£ ph√≤ng ban',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'C√¥ng vi·ªác',\r\n    example: 'PB001',\r\n  },\r\n  {\r\n    key: 'departmentName',\r\n    label: 'T√™n ph√≤ng ban',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'C√¥ng vi·ªác',\r\n    example: 'Ph√≤ng Kinh doanh',\r\n  },\r\n  {\r\n    key: 'department',\r\n    label: 'B·ªô ph·∫≠n',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'C√¥ng vi·ªác',\r\n    example: 'Kinh doanh',\r\n  },\r\n  {\r\n    key: 'positionId',\r\n    label: 'M√£ ch·ª©c v·ª•',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'C√¥ng vi·ªác',\r\n    example: 'CV001',\r\n  },\r\n  {\r\n    key: 'positionName',\r\n    label: 'T√™n ch·ª©c v·ª•',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'C√¥ng vi·ªác',\r\n    example: 'Tr∆∞·ªüng ph√≤ng',\r\n  },\r\n  {\r\n    key: 'jobTitle',\r\n    label: 'Ch·ª©c danh',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'C√¥ng vi·ªác',\r\n    example: 'Nh√¢n vi√™n kinh doanh',\r\n  },\r\n  {\r\n    key: 'employeeType',\r\n    label: 'Lo·∫°i nh√¢n vi√™n',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'C√¥ng vi·ªác',\r\n    example: 'Ch√≠nh th·ª©c',\r\n  },\r\n  {\r\n    key: 'employmentStatus',\r\n    label: 'Tr·∫°ng th√°i l√†m vi·ªác (*M·∫∑c ƒë·ªãnh: ƒêang l√†m vi·ªác)',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'C√¥ng vi·ªác',\r\n    example: 'ƒêang l√†m vi·ªác',\r\n    defaultValue: 'ƒêang l√†m vi·ªác',\r\n  },\r\n  {\r\n    key: 'status',\r\n    label: 'Tr·∫°ng th√°i (*M·∫∑c ƒë·ªãnh: active)',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'C√¥ng vi·ªác',\r\n    example: 'active',\r\n    defaultValue: 'active',\r\n  },\r\n  {\r\n    key: 'hireDate',\r\n    label: 'Ng√†y tuy·ªÉn d·ª•ng',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'C√¥ng vi·ªác',\r\n    example: '2023-01-01',\r\n  },\r\n  {\r\n    key: 'startDate',\r\n    label: 'Ng√†y b·∫Øt ƒë·∫ßu l√†m vi·ªác',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'C√¥ng vi·ªác',\r\n    example: '2023-01-15',\r\n  },\r\n  {\r\n    key: 'endDate',\r\n    label: 'Ng√†y k·∫øt th√∫c',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'C√¥ng vi·ªác',\r\n    example: '',\r\n  },\r\n  {\r\n    key: 'terminationDate',\r\n    label: 'Ng√†y ngh·ªâ vi·ªác',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'C√¥ng vi·ªác',\r\n    example: '',\r\n  },\r\n  {\r\n    key: 'reasonForLeaving',\r\n    label: 'L√Ω do ngh·ªâ vi·ªác',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'C√¥ng vi·ªác',\r\n    example: '',\r\n  },\r\n  {\r\n    key: 'branchSystemId',\r\n    label: 'M√£ chi nh√°nh',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'C√¥ng vi·ªác',\r\n    example: 'CN001',\r\n  },\r\n\r\n  // ===== TH·ª¨ VI·ªÜC & H·ª¢P ƒê·ªíNG =====\r\n  {\r\n    key: 'probationEndDate',\r\n    label: 'Ng√†y k·∫øt th√∫c th·ª≠ vi·ªác',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'Th·ª≠ vi·ªác & H·ª£p ƒë·ªìng',\r\n    example: '2023-03-31',\r\n  },\r\n  {\r\n    key: 'contractNumber',\r\n    label: 'S·ªë h·ª£p ƒë·ªìng',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th·ª≠ vi·ªác & H·ª£p ƒë·ªìng',\r\n    example: 'HD-2023-001',\r\n  },\r\n  {\r\n    key: 'contractType',\r\n    label: 'Lo·∫°i h·ª£p ƒë·ªìng',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th·ª≠ vi·ªác & H·ª£p ƒë·ªìng',\r\n    example: 'definite',\r\n  },\r\n  {\r\n    key: 'contractStartDate',\r\n    label: 'Ng√†y b·∫Øt ƒë·∫ßu Hƒê',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'Th·ª≠ vi·ªác & H·ª£p ƒë·ªìng',\r\n    example: '2023-04-01',\r\n  },\r\n  {\r\n    key: 'contractEndDate',\r\n    label: 'Ng√†y k·∫øt th√∫c Hƒê',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'Th·ª≠ vi·ªác & H·ª£p ƒë·ªìng',\r\n    example: '2024-03-31',\r\n  },\r\n\r\n  // ===== TH·ªúI GIAN L√ÄM VI·ªÜC =====\r\n  {\r\n    key: 'workingHoursPerDay',\r\n    label: 'S·ªë gi·ªù/ng√†y (*M·∫∑c ƒë·ªãnh: 8)',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Th·ªùi gian l√†m vi·ªác',\r\n    example: '8',\r\n    defaultValue: 8,\r\n  },\r\n  {\r\n    key: 'workingDaysPerWeek',\r\n    label: 'S·ªë ng√†y/tu·∫ßn (*M·∫∑c ƒë·ªãnh: 5)',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Th·ªùi gian l√†m vi·ªác',\r\n    example: '5',\r\n    defaultValue: 5,\r\n  },\r\n  {\r\n    key: 'shiftType',\r\n    label: 'Ca l√†m vi·ªác',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th·ªùi gian l√†m vi·ªác',\r\n    example: 'day',\r\n  },\r\n\r\n  // ===== L∆Ø∆†NG & THU NH·∫¨P =====\r\n  {\r\n    key: 'baseSalary',\r\n    label: 'L∆∞∆°ng c∆° b·∫£n',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'L∆∞∆°ng & Thu nh·∫≠p',\r\n    example: '15000000',\r\n  },\r\n  {\r\n    key: 'socialInsuranceSalary',\r\n    label: 'L∆∞∆°ng ƒë√≥ng BHXH',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'L∆∞∆°ng & Thu nh·∫≠p',\r\n    example: '10000000',\r\n  },\r\n  {\r\n    key: 'positionAllowance',\r\n    label: 'Ph·ª• c·∫•p ch·ª©c v·ª•',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'L∆∞∆°ng & Thu nh·∫≠p',\r\n    example: '2000000',\r\n  },\r\n  {\r\n    key: 'mealAllowance',\r\n    label: 'Ph·ª• c·∫•p ƒÉn tr∆∞a',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'L∆∞∆°ng & Thu nh·∫≠p',\r\n    example: '730000',\r\n  },\r\n  {\r\n    key: 'otherAllowances',\r\n    label: 'Ph·ª• c·∫•p kh√°c',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'L∆∞∆°ng & Thu nh·∫≠p',\r\n    example: '500000',\r\n  },\r\n  {\r\n    key: 'numberOfDependents',\r\n    label: 'S·ªë ng∆∞·ªùi ph·ª• thu·ªôc',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'L∆∞∆°ng & Thu nh·∫≠p',\r\n    example: '1',\r\n  },\r\n\r\n  // ===== NG√ÇN H√ÄNG =====\r\n  {\r\n    key: 'bankAccountNumber',\r\n    label: 'S·ªë t√†i kho·∫£n',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Ng√¢n h√†ng',\r\n    example: '1234567890123',\r\n  },\r\n  {\r\n    key: 'bankName',\r\n    label: 'Ng√¢n h√†ng',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Ng√¢n h√†ng',\r\n    example: 'Vietcombank',\r\n  },\r\n  {\r\n    key: 'bankBranch',\r\n    label: 'Chi nh√°nh',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Ng√¢n h√†ng',\r\n    example: 'CN H√† N·ªôi',\r\n  },\r\n\r\n  // ===== NGH·ªà PH√âP =====\r\n  {\r\n    key: 'annualLeaveBalance',\r\n    label: 'S·ªë ng√†y ph√©p c√≤n',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Ngh·ªâ ph√©p',\r\n    example: '12',\r\n  },\r\n  {\r\n    key: 'leaveTaken',\r\n    label: 'S·ªë ng√†y ƒë√£ ngh·ªâ (*M·∫∑c ƒë·ªãnh: 0)',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Ngh·ªâ ph√©p',\r\n    example: '3',\r\n    defaultValue: 0,\r\n  },\r\n  {\r\n    key: 'paidLeaveTaken',\r\n    label: 'Ngh·ªâ ph√©p c√≥ l∆∞∆°ng',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Ngh·ªâ ph√©p',\r\n    example: '2',\r\n  },\r\n  {\r\n    key: 'unpaidLeaveTaken',\r\n    label: 'Ngh·ªâ ph√©p kh√¥ng l∆∞∆°ng',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Ngh·ªâ ph√©p',\r\n    example: '1',\r\n  },\r\n  {\r\n    key: 'annualLeaveTaken',\r\n    label: 'Ngh·ªâ ph√©p nƒÉm ƒë√£ d√πng',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Ngh·ªâ ph√©p',\r\n    example: '5',\r\n  },\r\n\r\n  // ===== ƒê√ÅNH GI√Å =====\r\n  {\r\n    key: 'performanceRating',\r\n    label: 'ƒê√°nh gi√° hi·ªáu su·∫•t',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'ƒê√°nh gi√°',\r\n    example: '4',\r\n  },\r\n  {\r\n    key: 'lastReviewDate',\r\n    label: 'Ng√†y ƒë√°nh gi√° g·∫ßn nh·∫•t',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'ƒê√°nh gi√°',\r\n    example: '2023-12-15',\r\n  },\r\n  {\r\n    key: 'nextReviewDate',\r\n    label: 'Ng√†y ƒë√°nh gi√° ti·∫øp theo',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'ƒê√°nh gi√°',\r\n    example: '2024-06-15',\r\n  },\r\n\r\n  // ===== K·ª∏ NƒÇNG & CH·ª®NG CH·ªà =====\r\n  {\r\n    key: 'skills',\r\n    label: 'K·ªπ nƒÉng',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'K·ªπ nƒÉng & Ch·ª©ng ch·ªâ',\r\n    example: 'Excel, PowerPoint, Qu·∫£n l√Ω d·ª± √°n',\r\n    transform: (value) => {\r\n      if (Array.isArray(value)) return value.join(', ');\r\n      return value;\r\n    },\r\n    reverseTransform: (value) => {\r\n      if (typeof value === 'string') {\r\n        return value.split(',').map(s => s.trim()).filter(Boolean);\r\n      }\r\n      return value;\r\n    },\r\n  },\r\n  {\r\n    key: 'certifications',\r\n    label: 'Ch·ª©ng ch·ªâ',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'K·ªπ nƒÉng & Ch·ª©ng ch·ªâ',\r\n    example: 'PMP, IELTS 7.0',\r\n    transform: (value) => {\r\n      if (Array.isArray(value)) return value.join(', ');\r\n      return value;\r\n    },\r\n    reverseTransform: (value) => {\r\n      if (typeof value === 'string') {\r\n        return value.split(',').map(s => s.trim()).filter(Boolean);\r\n      }\r\n      return value;\r\n    },\r\n  },\r\n\r\n  // ===== S∆† ƒê·ªí T·ªî CH·ª®C =====\r\n  {\r\n    key: 'managerId',\r\n    label: 'M√£ qu·∫£n l√Ω tr·ª±c ti·∫øp',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'S∆° ƒë·ªì t·ªï ch·ª©c',\r\n    example: 'NV000',\r\n  },\r\n\r\n  // ===== H·ªåC V·∫§N =====\r\n  {\r\n    key: 'educationLevel',\r\n    label: 'Tr√¨nh ƒë·ªô h·ªçc v·∫•n',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'H·ªçc v·∫•n',\r\n    example: 'ƒê·∫°i h·ªçc',\r\n  },\r\n  {\r\n    key: 'major',\r\n    label: 'Chuy√™n ng√†nh',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'H·ªçc v·∫•n',\r\n    example: 'Qu·∫£n tr·ªã kinh doanh',\r\n  },\r\n  {\r\n    key: 'graduationYear',\r\n    label: 'NƒÉm t·ªët nghi·ªáp',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'H·ªçc v·∫•n',\r\n    example: '2018',\r\n  },\r\n  {\r\n    key: 'school',\r\n    label: 'Tr∆∞·ªùng',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'H·ªçc v·∫•n',\r\n    example: 'ƒê·∫°i h·ªçc Kinh t·∫ø Qu·ªëc d√¢n',\r\n  },\r\n\r\n  // ===== GHI CH√ö =====\r\n  {\r\n    key: 'notes',\r\n    label: 'Ghi ch√∫',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Kh√°c',\r\n    example: '',\r\n  },\r\n\r\n  // ===== D·ªÆ LI·ªÜU H·ªÜ TH·ªêNG (hidden, kh√¥ng import) =====\r\n  {\r\n    key: 'systemId',\r\n    label: 'System ID',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'H·ªá th·ªëng',\r\n    hidden: true, // Kh√¥ng hi·ªÉn th·ªã khi import\r\n  },\r\n  {\r\n    key: 'avatarUrl',\r\n    label: 'URL ·∫£nh ƒë·∫°i di·ªán',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'H·ªá th·ªëng',\r\n    hidden: true,\r\n  },\r\n  {\r\n    key: 'createdAt',\r\n    label: 'Ng√†y t·∫°o',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'H·ªá th·ªëng',\r\n    hidden: true,\r\n  },\r\n  {\r\n    key: 'updatedAt',\r\n    label: 'Ng√†y c·∫≠p nh·∫≠t',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'H·ªá th·ªëng',\r\n    hidden: true,\r\n  },\r\n];\r\n\r\n/**\r\n * Post-transform ƒë·ªÉ x·ª≠ l√Ω ƒë·ªãa ch·ªâ th∆∞·ªùng tr√∫ v√† t·∫°m tr√∫\r\n * ƒê∆∞·ª£c t·∫°o b·ªüi normalizeEmployeeRawRow t·ª´ c√°c c·ªôt:\r\n * - __permanentAddress__: ƒê·ªãa ch·ªâ th∆∞·ªùng tr√∫\r\n * - __temporaryAddress__: ƒê·ªãa ch·ªâ t·∫°m tr√∫\r\n */\r\nfunction processEmployeeAddresses(row: Partial<Employee>): Partial<Employee> {\r\n  const result = { ...row };\r\n  const rawData = row as Record<string, unknown>;\r\n  \r\n  // X·ª≠ l√Ω ƒë·ªãa ch·ªâ th∆∞·ªùng tr√∫\r\n  const permanentRaw = rawData['__permanentAddress__'] as {\r\n    province?: string;\r\n    ward?: string;\r\n    street?: string;\r\n    inputLevel?: '2-level' | '3-level';\r\n  } | undefined;\r\n  \r\n  if (permanentRaw && (permanentRaw.province || permanentRaw.ward || permanentRaw.street)) {\r\n    // Enrich with IDs using address lookup\r\n    const enriched = enrichEmployeeAddresses({\r\n      permanentAddress: {\r\n        province: permanentRaw.province || '',\r\n        ward: permanentRaw.ward || '',\r\n        street: permanentRaw.street || '',\r\n        inputLevel: permanentRaw.inputLevel || '2-level',\r\n      } as Employee['permanentAddress'],\r\n    });\r\n    \r\n    if (enriched.permanentAddress) {\r\n      result.permanentAddress = enriched.permanentAddress;\r\n    }\r\n    \r\n    // Remove temporary field\r\n    delete (result as Record<string, unknown>)['__permanentAddress__'];\r\n  }\r\n  \r\n  // X·ª≠ l√Ω ƒë·ªãa ch·ªâ t·∫°m tr√∫\r\n  const temporaryRaw = rawData['__temporaryAddress__'] as {\r\n    province?: string;\r\n    ward?: string;\r\n    street?: string;\r\n    inputLevel?: '2-level' | '3-level';\r\n  } | undefined;\r\n  \r\n  if (temporaryRaw && (temporaryRaw.province || temporaryRaw.ward || temporaryRaw.street)) {\r\n    // Enrich with IDs using address lookup\r\n    const enriched = enrichEmployeeAddresses({\r\n      temporaryAddress: {\r\n        province: temporaryRaw.province || '',\r\n        ward: temporaryRaw.ward || '',\r\n        street: temporaryRaw.street || '',\r\n        inputLevel: temporaryRaw.inputLevel || '2-level',\r\n      } as Employee['temporaryAddress'],\r\n    });\r\n    \r\n    if (enriched.temporaryAddress) {\r\n      result.temporaryAddress = enriched.temporaryAddress;\r\n    }\r\n    \r\n    // Remove temporary field\r\n    delete (result as Record<string, unknown>)['__temporaryAddress__'];\r\n  }\r\n  \r\n  return result;\r\n}\r\n\r\nexport const employeeConfig: ImportExportConfig<Employee> = {\r\n  entityType: 'employees',\r\n  entityDisplayName: 'Nh√¢n vi√™n',\r\n  fields: employeeFields,\r\n  upsertKey: 'id', // D√πng m√£ nh√¢n vi√™n ƒë·ªÉ ƒë·ªëi chi·∫øu khi UPDATE\r\n  templateFileName: 'mau-import-nhan-vien.xlsx',\r\n  \r\n  // Pre-transform: Normalize raw row t·ª´ template m·ªõi (merge 2-level/3-level columns)\r\n  preTransformRawRow: normalizeEmployeeRawRow,\r\n  \r\n  // Post-transform: Process addresses and lookup IDs\r\n  postTransformRow: processEmployeeAddresses,\r\n};\r\n\r\n// Re-export with old names for backward compatibility\r\nexport const employeeImportExportConfig = employeeConfig;\r\nexport { employeeFields };\r\n\r\nexport default employeeConfig;\r\n"],"names":[],"mappings":";;;;;;;;;;AAEA;;AAkBA,SAAS,uBAAuB,MAA+B;IAC7D,MAAM,YAA6B,EAAE;IAErC,qBAAqB;IACrB,MAAM,oBAAoB,MAAM,CAAC,qBAAqB;IACtD,MAAM,gBAAgB,MAAM,CAAC,uBAAuB;IACpD,MAAM,kBAAkB,MAAM,CAAC,2BAA2B;IAE1D,IAAI,qBAAqB,iBAAiB,iBAAiB;QACzD,UAAU,IAAI,CAAC;YACb,MAAM;YACN,UAAU,OAAO,qBAAqB;YACtC,MAAM,OAAO,iBAAiB;YAC9B,QAAQ,OAAO,mBAAmB;QACpC;IACF;IAEA,kBAAkB;IAClB,MAAM,oBAAoB,MAAM,CAAC,kBAAkB;IACnD,MAAM,gBAAgB,MAAM,CAAC,oBAAoB;IACjD,MAAM,kBAAkB,MAAM,CAAC,wBAAwB;IAEvD,IAAI,qBAAqB,iBAAiB,iBAAiB;QACzD,UAAU,IAAI,CAAC;YACb,MAAM;YACN,UAAU,OAAO,qBAAqB;YACtC,MAAM,OAAO,iBAAiB;YAC9B,QAAQ,OAAO,mBAAmB;QACpC;IACF;IAEA,OAAO;AACT;AAEA;;;CAGC,GACD,SAAS,wBAAwB,MAA+B;IAC9D,MAAM,SAAS;QAAE,GAAG,MAAM;IAAC;IAE3B,MAAM,kBAAkB,uBAAuB;IAE/C,KAAK,MAAM,QAAQ,gBAAiB;QAClC,IAAI,KAAK,IAAI,KAAK,aAAa;YAC7B,yCAAyC;YACzC,MAAM,CAAC,uBAAuB,GAAG;gBAC/B,UAAU,KAAK,QAAQ;gBACvB,MAAM,KAAK,IAAI;gBACf,QAAQ,KAAK,MAAM;gBACnB,YAAY;YACd;QACF,OAAO,IAAI,KAAK,IAAI,KAAK,aAAa;YACpC,sCAAsC;YACtC,MAAM,CAAC,uBAAuB,GAAG;gBAC/B,UAAU,KAAK,QAAQ;gBACvB,MAAM,KAAK,IAAI;gBACf,QAAQ,KAAK,MAAM;gBACnB,YAAY;YACd;QACF;IACF;IAEA,OAAO;AACT;AAEA,wDAAwD;AACxD,0DAA0D;AAC1D,MAAM,iBAA0C;IAC9C,+BAA+B;IAC/B;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,QAAQ;IACV;IAEA,kCAAkC;IAClC;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,WAAW,CAAC;YACV,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,aAAa;YACnB,OAAO,WAAW,IAAI,CAAC,OAAO,WAAW;QAC3C;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,QAAQ;IACV;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,cAAc;IAChB;IAEA,+BAA+B;IAC/B;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IAEA,sBAAsB;IACtB;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,WAAW,CAAC;YACV,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,aAAa;YACnB,OAAO,WAAW,IAAI,CAAC,OAAO,WAAW;QAC3C;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IAEA,kDAAkD;IAClD;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IAEA,+CAA+C;IAC/C;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IAEA,+BAA+B;IAC/B;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IAEA,wBAAwB;IACxB;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,cAAc;IAChB;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,cAAc;IAChB;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IAEA,kCAAkC;IAClC;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IAEA,iCAAiC;IACjC;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,cAAc;IAChB;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,cAAc;IAChB;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IAEA,+BAA+B;IAC/B;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IAEA,wBAAwB;IACxB;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IAEA,wBAAwB;IACxB;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,cAAc;IAChB;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QAC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"}},
    {"offset": {"line": 4006, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/import-export/configs/attendance.config.ts"],"sourcesContent":["/**\r\n * Attendance Import/Export Config\r\n * \r\n * C·∫•u h√¨nh import ch·∫•m c√¥ng t·ª´ m√°y CC\r\n * \r\n * ‚ö†Ô∏è L∆ØU √ù: File t·ª´ m√°y CC c√≥ format ƒë·∫∑c bi·ªát\r\n * - Sheet \"B·∫£ng t·ªïng h·ª£p ch·∫•m c√¥ng\"\r\n * - Header ph·ª©c t·∫°p (2 d√≤ng, merged cells)\r\n * - M√£ NV m√°y CC kh√°c m√£ NV h·ªá th·ªëng ‚Üí c·∫ßn mapping\r\n */\r\n\r\nimport type { ImportExportConfig, FieldConfig, AttendanceImportRow } from '../types';\r\n\r\n// ============================================\r\n// FIELD DEFINITIONS\r\n// ============================================\r\n\r\nconst attendanceFields: FieldConfig<AttendanceImportRow>[] = [\r\n  {\r\n    key: 'machineEmployeeId',\r\n    label: 'M√£ NV (m√°y) (*)',\r\n    required: true,\r\n    type: 'number',\r\n    example: '1',\r\n    exportGroup: 'Th√¥ng tin NV',\r\n    defaultSelected: true,\r\n  },\r\n  {\r\n    key: 'employeeName',\r\n    label: 'H·ªç t√™n (*)',\r\n    required: true,\r\n    type: 'string',\r\n    example: 'nguyen van a',\r\n    exportGroup: 'Th√¥ng tin NV',\r\n    defaultSelected: true,\r\n  },\r\n  {\r\n    key: 'department',\r\n    label: 'Ph√≤ng ban',\r\n    type: 'string',\r\n    example: 'C√îNG TY',\r\n    exportGroup: 'Th√¥ng tin NV',\r\n  },\r\n  {\r\n    key: 'standardHours',\r\n    label: 'Gi·ªù chu·∫©n',\r\n    type: 'number',\r\n    example: '160',\r\n    exportGroup: 'Th·ªùi gian',\r\n    defaultSelected: true,\r\n  },\r\n  {\r\n    key: 'actualHours',\r\n    label: 'Gi·ªù th·ª±c t·∫ø',\r\n    type: 'number',\r\n    example: '145.28',\r\n    exportGroup: 'Th·ªùi gian',\r\n    defaultSelected: true,\r\n  },\r\n  {\r\n    key: 'lateCount',\r\n    label: 'ƒê·∫øn mu·ªôn (l·∫ßn)',\r\n    type: 'number',\r\n    example: '3',\r\n    exportGroup: 'ƒê·∫øn mu·ªôn/V·ªÅ s·ªõm',\r\n    defaultSelected: true,\r\n  },\r\n  {\r\n    key: 'lateMinutes',\r\n    label: 'ƒê·∫øn mu·ªôn (ph√∫t)',\r\n    type: 'number',\r\n    example: '97',\r\n    exportGroup: 'ƒê·∫øn mu·ªôn/V·ªÅ s·ªõm',\r\n    defaultSelected: true,\r\n  },\r\n  {\r\n    key: 'earlyLeaveCount',\r\n    label: 'V·ªÅ s·ªõm (l·∫ßn)',\r\n    type: 'number',\r\n    example: '2',\r\n    exportGroup: 'ƒê·∫øn mu·ªôn/V·ªÅ s·ªõm',\r\n  },\r\n  {\r\n    key: 'earlyLeaveMinutes',\r\n    label: 'V·ªÅ s·ªõm (ph√∫t)',\r\n    type: 'number',\r\n    example: '36',\r\n    exportGroup: 'ƒê·∫øn mu·ªôn/V·ªÅ s·ªõm',\r\n  },\r\n  {\r\n    key: 'overtimeNormal',\r\n    label: 'TƒÉng ca th∆∞·ªùng (gi·ªù)',\r\n    type: 'number',\r\n    example: '6.55',\r\n    exportGroup: 'TƒÉng ca',\r\n    defaultSelected: true,\r\n  },\r\n  {\r\n    key: 'overtimeSpecial',\r\n    label: 'TƒÉng ca ƒë·∫∑c bi·ªát (gi·ªù)',\r\n    type: 'number',\r\n    example: '43.5',\r\n    exportGroup: 'TƒÉng ca',\r\n  },\r\n  {\r\n    key: 'workDays',\r\n    label: 'Ng√†y c√¥ng (chu·∫©n/th·ª±c)',\r\n    type: 'string',\r\n    example: '20/19',\r\n    exportGroup: 'Ng√†y c√¥ng',\r\n    defaultSelected: true,\r\n  },\r\n  {\r\n    key: 'businessTrip',\r\n    label: 'C√¥ng t√°c (ng√†y)',\r\n    type: 'number',\r\n    example: '2',\r\n    exportGroup: 'Ngh·ªâ ph√©p',\r\n  },\r\n  {\r\n    key: 'absentWithoutLeave',\r\n    label: 'Ngh·ªâ kh√¥ng ph√©p (ng√†y)',\r\n    type: 'number',\r\n    example: '1',\r\n    exportGroup: 'Ngh·ªâ ph√©p',\r\n    defaultSelected: true,\r\n  },\r\n  {\r\n    key: 'paidLeave',\r\n    label: 'Ngh·ªâ ph√©p (ng√†y)',\r\n    type: 'number',\r\n    example: '0',\r\n    exportGroup: 'Ngh·ªâ ph√©p',\r\n  },\r\n];\r\n\r\n// ============================================\r\n// CONFIG\r\n// ============================================\r\n\r\nexport const attendanceImportExportConfig: ImportExportConfig<AttendanceImportRow> = {\r\n  entityType: 'attendance',\r\n  entityDisplayName: 'Ch·∫•m c√¥ng (t·ª´ m√°y CC)',\r\n\r\n  // Template - d√πng file g·ªëc t·ª´ m√°y CC\r\n  templateFileName: 'Mau_ChamCong_MayCC.xls',\r\n  templateDownloadUrl: '/templates/Mau_ChamCong_MayCC.xls',\r\n  \r\n  // ‚ö†Ô∏è SPECIAL: Custom parser\r\n  customParser: true,\r\n  sourceSheetName: 'B·∫£ng t·ªïng h·ª£p ch·∫•m c√¥ng',\r\n  headerRowIndex: 2,        // 0-indexed (row 3 trong Excel)\r\n  dataStartRowIndex: 4,     // 0-indexed (row 5 trong Excel)\r\n\r\n  // Fields\r\n  fields: attendanceFields,\r\n\r\n  // ‚ö†Ô∏è KH√îNG d√πng upsertKey th√¥ng th∆∞·ªùng\r\n  // V√¨ m√°y CC d√πng m√£ 1,2,3... kh√¥ng ph·∫£i NV000001\r\n  upsertKey: undefined,\r\n  \r\n  // Thay v√†o ƒë√≥: Composite key cho upsert\r\n  compositeKey: ['employeeSystemId', 'month', 'year'],\r\n\r\n  // Employee mapping\r\n  requireEmployeeMapping: true,\r\n  mappingField: 'employeeName',\r\n\r\n  // Upsert config\r\n  allowUpdate: true,        // Cho ph√©p update n·∫øu th√°ng ƒë√£ c√≥\r\n  allowInsert: true,        // Cho ph√©p th√™m m·ªõi\r\n\r\n  // Preview config\r\n  requirePreview: true,\r\n  stopOnFirstError: false,\r\n  maxErrorsAllowed: 0,\r\n\r\n  maxRows: 100,             // Th∆∞·ªùng m·ªói th√°ng < 100 NV\r\n\r\n  // Validation\r\n  validateRow: (row, _index, _existingData) => {\r\n    const errors: Array<{ field?: string; message: string }> = [];\r\n\r\n    // Check t√™n kh√¥ng r·ªóng\r\n    if (!row.employeeName || row.employeeName.trim() === '') {\r\n      errors.push({ field: 'employeeName', message: 'H·ªç t√™n kh√¥ng ƒë∆∞·ª£c tr·ªëng' });\r\n    }\r\n\r\n    // Check gi·ªù th·ª±c t·∫ø kh√¥ng √¢m\r\n    if (row.actualHours < 0) {\r\n      errors.push({ field: 'actualHours', message: 'Gi·ªù th·ª±c t·∫ø kh√¥ng ƒë∆∞·ª£c √¢m' });\r\n    }\r\n\r\n    // Check gi·ªù th·ª±c t·∫ø kh√¥ng v∆∞·ª£t qu√° chu·∫©n + tƒÉng ca qu√° nhi·ªÅu\r\n    const maxHours = row.standardHours + 100; // T·ªëi ƒëa 100 gi·ªù tƒÉng ca/th√°ng\r\n    if (row.actualHours > maxHours) {\r\n      errors.push({ \r\n        field: 'actualHours', \r\n        message: `Gi·ªù th·ª±c t·∫ø (${row.actualHours}h) v∆∞·ª£t qu√° gi·ªõi h·∫°n (${maxHours}h)` \r\n      });\r\n    }\r\n\r\n    // Check s·ªë ph√∫t ƒë·∫øn mu·ªôn h·ª£p l√Ω\r\n    if (row.lateMinutes > 0 && row.lateCount === 0) {\r\n      errors.push({ \r\n        field: 'lateCount', \r\n        message: 'C√≥ ph√∫t ƒë·∫øn mu·ªôn nh∆∞ng s·ªë l·∫ßn = 0' \r\n      });\r\n    }\r\n\r\n    return errors;\r\n  },\r\n\r\n  // After import hook\r\n  afterImport: (results) => {\r\n    console.log(`Import ch·∫•m c√¥ng ho√†n t·∫•t:\r\n      - Th√™m m·ªõi: ${results.inserted.length}\r\n      - C·∫≠p nh·∫≠t: ${results.updated.length}\r\n      - L·ªói: ${results.failed.length}\r\n      - B·ªè qua: ${results.skipped.length}`);\r\n  },\r\n};\r\n\r\n// Export fields cho re-use\r\nexport { attendanceFields };\r\n"],"names":[],"mappings":"AAAA;;;;;;;;;CASC;;;;;;AAID,+CAA+C;AAC/C,oBAAoB;AACpB,+CAA+C;AAE/C,MAAM,mBAAuD;IAC3D;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,SAAS;QACT,aAAa;QACb,iBAAiB;IACnB;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,SAAS;QACT,aAAa;QACb,iBAAiB;IACnB;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM;QACN,SAAS;QACT,aAAa;IACf;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,iBAAiB;IACnB;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,iBAAiB;IACnB;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,iBAAiB;IACnB;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,iBAAiB;IACnB;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM;QACN,SAAS;QACT,aAAa;IACf;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM;QACN,SAAS;QACT,aAAa;IACf;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,iBAAiB;IACnB;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM;QACN,SAAS;QACT,aAAa;IACf;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,iBAAiB;IACnB;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM;QACN,SAAS;QACT,aAAa;IACf;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM;QACN,SAAS;QACT,aAAa;QACb,iBAAiB;IACnB;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM;QACN,SAAS;QACT,aAAa;IACf;CACD;AAMM,MAAM,+BAAwE;IACnF,YAAY;IACZ,mBAAmB;IAEnB,qCAAqC;IACrC,kBAAkB;IAClB,qBAAqB;IAErB,4BAA4B;IAC5B,cAAc;IACd,iBAAiB;IACjB,gBAAgB;IAChB,mBAAmB;IAEnB,SAAS;IACT,QAAQ;IAER,uCAAuC;IACvC,iDAAiD;IACjD,WAAW;IAEX,wCAAwC;IACxC,cAAc;QAAC;QAAoB;QAAS;KAAO;IAEnD,mBAAmB;IACnB,wBAAwB;IACxB,cAAc;IAEd,gBAAgB;IAChB,aAAa;IACb,aAAa;IAEb,iBAAiB;IACjB,gBAAgB;IAChB,kBAAkB;IAClB,kBAAkB;IAElB,SAAS;IAET,aAAa;IACb,aAAa,CAAC,KAAK,QAAQ;QACzB,MAAM,SAAqD,EAAE;QAE7D,uBAAuB;QACvB,IAAI,CAAC,IAAI,YAAY,IAAI,IAAI,YAAY,CAAC,IAAI,OAAO,IAAI;YACvD,OAAO,IAAI,CAAC;gBAAE,OAAO;gBAAgB,SAAS;YAA0B;QAC1E;QAEA,6BAA6B;QAC7B,IAAI,IAAI,WAAW,GAAG,GAAG;YACvB,OAAO,IAAI,CAAC;gBAAE,OAAO;gBAAe,SAAS;YAA4B;QAC3E;QAEA,6DAA6D;QAC7D,MAAM,WAAW,IAAI,aAAa,GAAG,KAAK,+BAA+B;QACzE,IAAI,IAAI,WAAW,GAAG,UAAU;YAC9B,OAAO,IAAI,CAAC;gBACV,OAAO;gBACP,SAAS,CAAC,aAAa,EAAE,IAAI,WAAW,CAAC,sBAAsB,EAAE,SAAS,EAAE,CAAC;YAC/E;QACF;QAEA,gCAAgC;QAChC,IAAI,IAAI,WAAW,GAAG,KAAK,IAAI,SAAS,KAAK,GAAG;YAC9C,OAAO,IAAI,CAAC;gBACV,OAAO;gBACP,SAAS;YACX;QACF;QAEA,OAAO;IACT;IAEA,oBAAoB;IACpB,aAAa,CAAC;QACZ,QAAQ,GAAG,CAAC,CAAC;kBACC,EAAE,QAAQ,QAAQ,CAAC,MAAM,CAAC;kBAC1B,EAAE,QAAQ,OAAO,CAAC,MAAM,CAAC;aAC9B,EAAE,QAAQ,MAAM,CAAC,MAAM,CAAC;gBACrB,EAAE,QAAQ,OAAO,CAAC,MAAM,EAAE;IACxC;AACF"}},
    {"offset": {"line": 4226, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/import-export/configs/customer.config.ts"],"sourcesContent":["import type { Customer } from '@/features/customers/types';\r\nimport type { ImportExportConfig, FieldConfig } from '../types';\r\n\r\n/**\r\n * Customer Import/Export Configuration\r\n * Theo chu·∫©n ImportExportConfig ƒë·ªÉ d√πng v·ªõi GenericImportDialogV2 v√† GenericExportDialogV2\r\n */\r\n\r\n// ===== FIELD DEFINITIONS =====\r\nexport const customerFields: FieldConfig<Customer>[] = [\r\n  // ===== TH√îNG TIN C∆† B·∫¢N =====\r\n  {\r\n    key: 'id',\r\n    label: 'M√£ kh√°ch h√†ng',\r\n    required: false, // T·ª± generate n·∫øu ƒë·ªÉ tr·ªëng\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'KH000001',\r\n  },\r\n  {\r\n    key: 'name',\r\n    label: 'T√™n kh√°ch h√†ng (*)',\r\n    required: true,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'C√¥ng ty TNHH ABC',\r\n  },\r\n  {\r\n    key: 'status',\r\n    label: 'Tr·∫°ng th√°i',\r\n    required: false,\r\n    type: 'enum',\r\n    enumValues: ['ƒêang giao d·ªãch', 'Ng·ª´ng Giao D·ªãch'],\r\n    enumLabels: {\r\n      'ƒêang giao d·ªãch': 'ƒêang giao d·ªãch',\r\n      'Ng·ª´ng Giao D·ªãch': 'Ng·ª´ng giao d·ªãch',\r\n    },\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'ƒêang giao d·ªãch',\r\n    defaultValue: 'ƒêang giao d·ªãch',\r\n  },\r\n  {\r\n    key: 'phone',\r\n    label: 'S·ªë ƒëi·ªán tho·∫°i',\r\n    required: false,\r\n    type: 'phone',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: '0901234567',\r\n    validator: (value: unknown) => {\r\n      if (!value) return null;\r\n      const phone = String(value).replace(/\\s/g, '');\r\n      if (!/^0\\d{9,10}$/.test(phone)) {\r\n        return '[Warning] S·ªë ƒëi·ªán tho·∫°i kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng';\r\n      }\r\n      return null;\r\n    },\r\n  },\r\n  {\r\n    key: 'email',\r\n    label: 'Email',\r\n    required: false,\r\n    type: 'email',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'contact@abc.com',\r\n    validator: (value: unknown) => {\r\n      if (!value) return null;\r\n      const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n      if (!emailRegex.test(String(value))) {\r\n        return 'Email kh√¥ng h·ª£p l·ªá';\r\n      }\r\n      return null;\r\n    },\r\n  },\r\n  {\r\n    key: 'type',\r\n    label: 'Lo·∫°i kh√°ch h√†ng',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'Doanh nghi·ªáp',\r\n  },\r\n  {\r\n    key: 'customerGroup',\r\n    label: 'Nh√≥m kh√°ch h√†ng',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'Kh√°ch s·ªâ',\r\n  },\r\n  {\r\n    key: 'lifecycleStage',\r\n    label: 'Giai ƒëo·∫°n v√≤ng ƒë·ªùi',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'Kh√°ch m·ªõi',\r\n  },\r\n  {\r\n    key: 'source',\r\n    label: 'Ngu·ªìn kh√°ch h√†ng',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'Facebook',\r\n  },\r\n  {\r\n    key: 'notes',\r\n    label: 'Ghi ch√∫',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'Kh√°ch h√†ng ti·ªÅm nƒÉng',\r\n  },\r\n\r\n  // ===== TH√îNG TIN DOANH NGHI·ªÜP =====\r\n  {\r\n    key: 'company',\r\n    label: 'T√™n c√¥ng ty / HKD',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin doanh nghi·ªáp',\r\n    example: 'C√¥ng ty TNHH ABC',\r\n  },\r\n  {\r\n    key: 'taxCode',\r\n    label: 'M√£ s·ªë thu·∫ø',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin doanh nghi·ªáp',\r\n    example: '0123456789',\r\n    validator: (value: unknown) => {\r\n      if (!value) return null;\r\n      const taxCode = String(value);\r\n      if (!/^\\d{10}(\\d{3})?$/.test(taxCode)) {\r\n        return '[Warning] M√£ s·ªë thu·∫ø ph·∫£i c√≥ 10 ho·∫∑c 13 s·ªë';\r\n      }\r\n      return null;\r\n    },\r\n  },\r\n  {\r\n    key: 'representative',\r\n    label: 'Ng∆∞·ªùi ƒë·∫°i di·ªán',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin doanh nghi·ªáp',\r\n    example: 'Nguy·ªÖn VƒÉn A',\r\n  },\r\n  {\r\n    key: 'position',\r\n    label: 'Ch·ª©c v·ª•',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin doanh nghi·ªáp',\r\n    example: 'Gi√°m ƒë·ªëc',\r\n  },\r\n  {\r\n    key: 'bankName',\r\n    label: 'Ng√¢n h√†ng',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin doanh nghi·ªáp',\r\n    example: 'Vietcombank',\r\n  },\r\n  {\r\n    key: 'bankAccount',\r\n    label: 'S·ªë t√†i kho·∫£n',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin doanh nghi·ªáp',\r\n    example: '0123456789',\r\n  },\r\n\r\n  // ===== THANH TO√ÅN & GI√Å =====\r\n  {\r\n    key: 'paymentTerms',\r\n    label: 'H·∫°n thanh to√°n',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Thanh to√°n & Gi√°',\r\n    example: 'NET15',\r\n  },\r\n  {\r\n    key: 'creditRating',\r\n    label: 'X·∫øp h·∫°ng t√≠n d·ª•ng',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Thanh to√°n & Gi√°',\r\n    example: 'AAA',\r\n  },\r\n  {\r\n    key: 'currentDebt',\r\n    label: 'C√¥ng n·ª£ hi·ªán t·∫°i',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Thanh to√°n & Gi√°',\r\n    example: '0',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return 0;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) ? 0 : num;\r\n    },\r\n    exportTransform: (value: unknown) => {\r\n      if (!value) return '0';\r\n      return Number(value).toLocaleString('vi-VN');\r\n    },\r\n  },\r\n  {\r\n    key: 'maxDebt',\r\n    label: 'H·∫°n m·ª©c c√¥ng n·ª£',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Thanh to√°n & Gi√°',\r\n    example: '50000000',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) ? undefined : num;\r\n    },\r\n    exportTransform: (value: unknown) => {\r\n      if (!value) return '';\r\n      return Number(value).toLocaleString('vi-VN');\r\n    },\r\n  },\r\n  {\r\n    key: 'allowCredit',\r\n    label: 'Cho ph√©p c√¥ng n·ª£',\r\n    required: false,\r\n    type: 'boolean',\r\n    exportGroup: 'Thanh to√°n & Gi√°',\r\n    example: 'C√≥',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const str = String(value).toLowerCase();\r\n      return str === 'c√≥' || str === 'yes' || str === 'true' || str === '1';\r\n    },\r\n    exportTransform: (value: unknown) => value ? 'C√≥' : 'Kh√¥ng',\r\n  },\r\n  {\r\n    key: 'pricingLevel',\r\n    label: 'B·∫£ng gi√° √°p d·ª•ng',\r\n    required: false,\r\n    type: 'enum',\r\n    enumValues: ['Retail', 'Wholesale', 'VIP', 'Partner'],\r\n    enumLabels: {\r\n      'Retail': 'B√°n l·∫ª',\r\n      'Wholesale': 'B√°n s·ªâ',\r\n      'VIP': 'VIP',\r\n      'Partner': 'ƒê·ªëi t√°c',\r\n    },\r\n    exportGroup: 'Thanh to√°n & Gi√°',\r\n    example: 'Retail',\r\n  },\r\n  {\r\n    key: 'defaultDiscount',\r\n    label: 'Chi·∫øt kh·∫•u m·∫∑c ƒë·ªãnh (%)',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Thanh to√°n & Gi√°',\r\n    example: '5',\r\n    validator: (value: unknown) => {\r\n      if (!value) return null;\r\n      const num = Number(value);\r\n      if (num < 0 || num > 100) {\r\n        return 'Chi·∫øt kh·∫•u ph·∫£i t·ª´ 0 ƒë·∫øn 100%';\r\n      }\r\n      return null;\r\n    },\r\n  },\r\n\r\n  // ===== PH√ÇN LO·∫†I & QU·∫¢N L√ù =====\r\n  {\r\n    key: 'accountManagerName',\r\n    label: 'Nh√¢n vi√™n ph·ª• tr√°ch',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Ph√¢n lo·∫°i & Qu·∫£n l√Ω',\r\n    example: 'Nguy·ªÖn VƒÉn B',\r\n  },\r\n  {\r\n    key: 'campaign',\r\n    label: 'Chi·∫øn d·ªãch',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Ph√¢n lo·∫°i & Qu·∫£n l√Ω',\r\n    example: 'Summer Sale 2024',\r\n  },\r\n  {\r\n    key: 'tags',\r\n    label: 'Th·∫ª (Tags)',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Ph√¢n lo·∫°i & Qu·∫£n l√Ω',\r\n    example: 'VIP, ∆Øu ti√™n',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      return String(value).split(',').map(s => s.trim()).filter(Boolean);\r\n    },\r\n    exportTransform: (value: unknown) => {\r\n      if (!value || !Array.isArray(value)) return '';\r\n      return value.join(', ');\r\n    },\r\n  },\r\n\r\n  // ===== SOCIAL MEDIA =====\r\n  {\r\n    key: 'zaloPhone',\r\n    label: 'Zalo',\r\n    required: false,\r\n    type: 'phone',\r\n    exportGroup: 'Social Media',\r\n    example: '0901234567',\r\n  },\r\n\r\n  // ===== H·ªÜ TH·ªêNG (hidden) =====\r\n  {\r\n    key: 'systemId',\r\n    label: 'System ID',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'H·ªá th·ªëng',\r\n    hidden: true,\r\n  },\r\n  {\r\n    key: 'createdAt',\r\n    label: 'Ng√†y t·∫°o',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'H·ªá th·ªëng',\r\n    hidden: true,\r\n  },\r\n  {\r\n    key: 'updatedAt',\r\n    label: 'Ng√†y c·∫≠p nh·∫≠t',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'H·ªá th·ªëng',\r\n    hidden: true,\r\n  },\r\n];\r\n\r\n// ===== MAIN CONFIG =====\r\nexport const customerImportExportConfig: ImportExportConfig<Customer> = {\r\n  entityType: 'customers',\r\n  entityDisplayName: 'Kh√°ch h√†ng',\r\n  fields: customerFields,\r\n  upsertKey: 'id', // D√πng m√£ kh√°ch h√†ng ƒë·ªÉ ƒë·ªëi chi·∫øu khi UPDATE\r\n  templateFileName: 'mau-import-khach-hang.xlsx',\r\n  requireBranch: false, // Kh√°ch h√†ng kh√¥ng b·∫Øt bu·ªôc chi nh√°nh\r\n  \r\n  // Pre-transform raw row (normalize column names)\r\n  preTransformRawRow: (rawRow: Record<string, unknown>) => {\r\n    const normalized: Record<string, unknown> = {};\r\n    \r\n    // Map t·ª´ label ti·∫øng Vi·ªát sang key\r\n    const labelToKey: Record<string, string> = {};\r\n    customerFields.forEach(field => {\r\n      labelToKey[field.label.toLowerCase()] = field.key as string;\r\n      // Also map without (*) marker\r\n      const labelWithoutStar = field.label.replace(/\\s*\\(\\*\\)\\s*$/, '').toLowerCase();\r\n      labelToKey[labelWithoutStar] = field.key as string;\r\n    });\r\n    \r\n    Object.entries(rawRow).forEach(([key, value]) => {\r\n      // Normalize Excel header: strip (*) marker and lowercase\r\n      const normalizedExcelHeader = key.replace(/\\s*\\(\\*\\)\\s*$/, '').toLowerCase();\r\n      const normalizedKey = labelToKey[normalizedExcelHeader] || labelToKey[key.toLowerCase()] || key;\r\n      normalized[normalizedKey] = value;\r\n    });\r\n    \r\n    return normalized;\r\n  },\r\n  \r\n  // Post-transform row (set defaults, enrich data)\r\n  postTransformRow: (row: Partial<Customer>) => {\r\n    return {\r\n      ...row,\r\n      status: row.status || 'ƒêang giao d·ªãch',\r\n      pricingLevel: row.pricingLevel || 'Retail',\r\n      currentDebt: row.currentDebt ?? 0,\r\n      defaultDiscount: row.defaultDiscount ?? 0,\r\n      tags: row.tags || [],\r\n    };\r\n  },\r\n  \r\n  // Validate row level (check duplicate taxCode)\r\n  // Skip duplicate check in upsert/update mode since we're updating existing records\r\n  validateRow: (row, _index, existingData, mode) => {\r\n    const errors: Array<{ field?: string; message: string }> = [];\r\n    \r\n    // Check unique taxCode - only in insert-only mode\r\n    // In upsert/update mode, duplicate is expected and allowed\r\n    if (row.taxCode && mode === 'insert-only') {\r\n      const duplicate = existingData.find(\r\n        c => c.taxCode === row.taxCode && c.id !== row.id\r\n      );\r\n      if (duplicate) {\r\n        errors.push({\r\n          field: 'taxCode',\r\n          message: `M√£ s·ªë thu·∫ø ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng b·ªüi ${duplicate.name} (${duplicate.id})`,\r\n        });\r\n      }\r\n    }\r\n    \r\n    return errors;\r\n  },\r\n};\r\n\r\n// Re-export cho backward compatibility\r\nexport default customerImportExportConfig;\r\n"],"names":[],"mappings":";;;;;;;;AASO,MAAM,iBAA0C;IACrD,+BAA+B;IAC/B;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,YAAY;YAAC;YAAkB;SAAkB;QACjD,YAAY;YACV,kBAAkB;YAClB,mBAAmB;QACrB;QACA,aAAa;QACb,SAAS;QACT,cAAc;IAChB;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,WAAW,CAAC;YACV,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,QAAQ,OAAO,OAAO,OAAO,CAAC,OAAO;YAC3C,IAAI,CAAC,cAAc,IAAI,CAAC,QAAQ;gBAC9B,OAAO;YACT;YACA,OAAO;QACT;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,WAAW,CAAC;YACV,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,aAAa;YACnB,IAAI,CAAC,WAAW,IAAI,CAAC,OAAO,SAAS;gBACnC,OAAO;YACT;YACA,OAAO;QACT;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IAEA,qCAAqC;IACrC;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,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"}},
    {"offset": {"line": 4630, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/import-export/configs/product.config.ts"],"sourcesContent":["import type { Product, ProductType as ProductTypeEnum } from '@/features/products/types';\r\nimport type { ImportExportConfig, FieldConfig } from '../types';\r\nimport { usePricingPolicyStore } from '@/features/settings/pricing/store';\r\nimport { useProductTypeStore } from '@/features/settings/inventory/product-type-store';\r\nimport { asSystemId } from '@/lib/id-types';\r\n\r\n/**\r\n * Product Import/Export Configuration\r\n * Theo chu·∫©n ImportExportConfig ƒë·ªÉ d√πng v·ªõi GenericImportDialogV2 v√† GenericExportDialogV2\r\n */\r\n\r\n// Helper: Get all pricing policies\r\nconst getAllPricingPolicies = () => {\r\n  return usePricingPolicyStore.getState().data;\r\n};\r\n\r\n// ===== PRODUCT TYPE HELPERS =====\r\n// Helper: Get all active product types from settings\r\nconst getAllProductTypes = () => {\r\n  return useProductTypeStore.getState().getActive();\r\n};\r\n\r\n// Helper: Get ProductType systemId from name (t√™n lo·∫°i s·∫£n ph·∫©m)\r\nconst getProductTypeSystemIdByName = (name: string): string | null => {\r\n  if (!name) return null;\r\n  const productTypes = getAllProductTypes();\r\n  const normalizedName = name.toLowerCase().trim();\r\n  \r\n  // T√¨m theo t√™n ch√≠nh x√°c (case-insensitive)\r\n  const productType = productTypes.find(pt => \r\n    pt.name.toLowerCase() === normalizedName ||\r\n    pt.id.toLowerCase() === normalizedName\r\n  );\r\n  \r\n  return productType?.systemId || null;\r\n};\r\n\r\n// Helper: Get ProductType name from systemId\r\nconst getProductTypeNameById = (systemId: string): string => {\r\n  if (!systemId) return '';\r\n  const productTypes = getAllProductTypes();\r\n  const productType = productTypes.find(pt => pt.systemId === systemId);\r\n  return productType?.name || '';\r\n};\r\n\r\n// Helper: Get default ProductType systemId\r\nconst getDefaultProductTypeSystemId = (): string | null => {\r\n  const productTypes = getAllProductTypes();\r\n  const defaultType = productTypes.find(pt => pt.isDefault);\r\n  return defaultType?.systemId || productTypes[0]?.systemId || null;\r\n};\r\n\r\n// Helper: Map enum type ('physical', 'service', 'digital') to ProductType systemId\r\n// Fallback khi user import b·∫±ng type c≈©\r\nconst getProductTypeSystemIdByEnumType = (enumType: ProductTypeEnum | string): string | null => {\r\n  if (!enumType) return getDefaultProductTypeSystemId();\r\n  \r\n  const productTypes = getAllProductTypes();\r\n  const normalizedType = String(enumType).toLowerCase().trim();\r\n  \r\n  // Map t·ª´ enum type sang t√™n ti·∫øng Vi·ªát ƒë·ªÉ t√¨m ProductType\r\n  const typeNameMapping: Record<string, string[]> = {\r\n    'physical': ['h√†ng h√≥a', 'hang hoa', 'physical', 'h√†ng ho√°'],\r\n    'service': ['d·ªãch v·ª•', 'dich vu', 'service'],\r\n    'digital': ['digital', 's·∫£n ph·∫©m s·ªë', 'san pham so', 'k·ªπ thu·∫≠t s·ªë', 'ky thuat so'],\r\n    'combo': ['combo', 'b·ªô s·∫£n ph·∫©m', 'bo san pham'],\r\n  };\r\n  \r\n  for (const [_enumKey, names] of Object.entries(typeNameMapping)) {\r\n    if (names.includes(normalizedType)) {\r\n      // T√¨m ProductType c√≥ t√™n match v·ªõi m·ªôt trong c√°c aliases\r\n      const productType = productTypes.find(pt => \r\n        names.some(name => pt.name.toLowerCase().includes(name) || name.includes(pt.name.toLowerCase()))\r\n      );\r\n      if (productType) return productType.systemId;\r\n    }\r\n  }\r\n  \r\n  // Fallback: t√¨m tr·ª±c ti·∫øp theo t√™n\r\n  const productType = productTypes.find(pt => \r\n    pt.name.toLowerCase().includes(normalizedType) ||\r\n    normalizedType.includes(pt.name.toLowerCase())\r\n  );\r\n  \r\n  return productType?.systemId || getDefaultProductTypeSystemId();\r\n};\r\n\r\n// ===== PRICING POLICY HELPERS =====\r\n// Helper: Get pricing policy systemId from code (id) OR name\r\n// H·ªó tr·ª£ nhi·ªÅu format c·ªôt gi√° trong Excel:\r\n// - \"Gi√°: Gi√° b√°n l·∫ª\" ho·∫∑c \"Gi√°: BANLE\" (c√≥ prefix \"Gi√°:\")\r\n// - \"Gi√° b√°n l·∫ª\" ho·∫∑c \"BANLE\" (kh√¥ng c√≥ prefix)\r\nconst getPricingPolicySystemId = (columnName: string): string | null => {\r\n  const policies = getAllPricingPolicies();\r\n  \r\n  // Normalize: b·ªè prefix \"Gi√°:\" ho·∫∑c \"Gia:\" n·∫øu c√≥\r\n  let normalizedName = columnName.trim();\r\n  const pricePrefix = /^(gi√°|gia)\\s*:\\s*/i;\r\n  if (pricePrefix.test(normalizedName)) {\r\n    normalizedName = normalizedName.replace(pricePrefix, '').trim();\r\n  }\r\n  \r\n  const upperName = normalizedName.toUpperCase();\r\n  \r\n  // T√¨m theo id (m√£ b·∫£ng gi√°) tr∆∞·ªõc\r\n  const policyById = policies.find(p => p.id.toUpperCase() === upperName);\r\n  if (policyById) return policyById.systemId;\r\n  \r\n  // T√¨m theo name (t√™n b·∫£ng gi√°)\r\n  const policyByName = policies.find(p => p.name.toUpperCase() === upperName);\r\n  if (policyByName) return policyByName.systemId;\r\n  \r\n  // T√¨m theo name ch·ª©a (partial match)\r\n  const policyByPartialName = policies.find(p => \r\n    p.name.toUpperCase().includes(upperName) || \r\n    upperName.includes(p.name.toUpperCase())\r\n  );\r\n  if (policyByPartialName) return policyByPartialName.systemId;\r\n  \r\n  return null;\r\n};\r\n\r\n// Helper: Get pricing policy code (id) from systemId  \r\nconst getPricingPolicyCode = (systemId: string): string => {\r\n  const policies = getAllPricingPolicies();\r\n  const policy = policies.find(p => p.systemId === systemId);\r\n  return policy?.id || systemId;\r\n};\r\n\r\n// Helper: Get pricing policy name from systemId  \r\nconst getPricingPolicyName = (systemId: string): string => {\r\n  const policies = getAllPricingPolicies();\r\n  const policy = policies.find(p => p.systemId === systemId);\r\n  return policy?.name || systemId;\r\n};\r\n\r\n// Helper: Check if a column name matches a pricing policy (by id or name)\r\nconst isPricingPolicyColumn = (columnName: string): boolean => {\r\n  return getPricingPolicySystemId(columnName) !== null;\r\n};\r\n\r\n// ===== FIELD DEFINITIONS =====\r\nexport const productFields: FieldConfig<Product>[] = [\r\n  // ===== TH√îNG TIN C∆† B·∫¢N =====\r\n  {\r\n    key: 'id',\r\n    label: 'M√£ s·∫£n ph·∫©m',\r\n    required: false, // T·ª± generate n·∫øu ƒë·ªÉ tr·ªëng\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'SP000001',\r\n  },\r\n  {\r\n    key: 'name',\r\n    label: 'T√™n s·∫£n ph·∫©m (*)',\r\n    required: true,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: '√Åo s∆° mi nam',\r\n  },\r\n  {\r\n    key: 'sku',\r\n    label: 'SKU',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'ASM-001',\r\n  },\r\n  {\r\n    key: 'barcode',\r\n    label: 'M√£ v·∫°ch',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: '8934567890123',\r\n  },\r\n  {\r\n    key: 'type',\r\n    label: 'Lo·∫°i SP (H·ªá th·ªëng)',\r\n    required: false,\r\n    type: 'enum',\r\n    enumValues: ['physical', 'service', 'digital'], // Kh√¥ng cho ph√©p import combo\r\n    enumLabels: {\r\n      'physical': 'H√†ng h√≥a',\r\n      'service': 'D·ªãch v·ª•',\r\n      'digital': 'S·∫£n ph·∫©m s·ªë',\r\n    },\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'H√†ng h√≥a',\r\n    defaultValue: 'physical',\r\n    hidden: true, // ·∫®n field c≈©, khuy·∫øn kh√≠ch d√πng \"Lo·∫°i s·∫£n ph·∫©m\" m·ªõi (productTypeSystemId)\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return 'physical';\r\n      const str = String(value).toLowerCase().trim();\r\n      // Map ti·∫øng Vi·ªát sang English\r\n      if (str === 'h√†ng h√≥a' || str === 'hang hoa' || str === 'physical' || str === 'h√†ng ho√°') return 'physical';\r\n      if (str === 'd·ªãch v·ª•' || str === 'dich vu' || str === 'service') return 'service';\r\n      if (str === 's·∫£n ph·∫©m s·ªë' || str === 'san pham so' || str === 'k·ªπ thu·∫≠t s·ªë' || str === 'digital' || str === 'ky thuat so') return 'digital';\r\n      if (str === 'combo' || str === 'b·ªô s·∫£n ph·∫©m' || str === 'bo san pham') return 'combo';\r\n      return 'physical';\r\n    },\r\n    validator: (value: unknown) => {\r\n      if (value === 'combo') {\r\n        return 'Kh√¥ng h·ªó tr·ª£ import s·∫£n ph·∫©m Combo. Vui l√≤ng t·∫°o Combo tr·ª±c ti·∫øp trong h·ªá th·ªëng.';\r\n      }\r\n      return null;\r\n    },\r\n  },\r\n  // NEW: Lo·∫°i s·∫£n ph·∫©m t·ª´ Settings (ProductType) - Khuy·∫øn kh√≠ch d√πng thay cho field \"type\" c≈©\r\n  {\r\n    key: 'productTypeSystemId',\r\n    label: 'Lo·∫°i s·∫£n ph·∫©m',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'H√†ng h√≥a', // User nh·∫≠p t√™n lo·∫°i SP, h·ªá th·ªëng t·ª± map sang systemId\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const str = String(value).trim();\r\n      if (!str) return undefined;\r\n      \r\n      // Tr∆∞·ªõc ti√™n th·ª≠ t√¨m theo t√™n/id trong ProductType settings\r\n      const systemId = getProductTypeSystemIdByName(str);\r\n      if (systemId) return systemId;\r\n      \r\n      // Fallback: map t·ª´ enum type c≈©\r\n      const enumSystemId = getProductTypeSystemIdByEnumType(str);\r\n      return enumSystemId || undefined;\r\n    },\r\n    exportTransform: (value: unknown) => {\r\n      // Export ra t√™n lo·∫°i SP thay v√¨ systemId\r\n      return getProductTypeNameById(value as string);\r\n    },\r\n    validator: (value: unknown) => {\r\n      if (!value) return null; // Optional field\r\n      const str = String(value).trim();\r\n      if (!str) return null;\r\n      \r\n      // Validate: t√™n lo·∫°i SP ph·∫£i t·ªìn t·∫°i trong settings\r\n      const systemId = getProductTypeSystemIdByName(str);\r\n      if (!systemId) {\r\n        // Fallback check enum type\r\n        const enumSystemId = getProductTypeSystemIdByEnumType(str);\r\n        if (!enumSystemId) {\r\n          return `Lo·∫°i s·∫£n ph·∫©m \"${str}\" kh√¥ng t·ªìn t·∫°i trong h·ªá th·ªëng. Vui l√≤ng ki·ªÉm tra danh s√°ch lo·∫°i SP trong C√†i ƒë·∫∑t > Kho h√†ng.`;\r\n        }\r\n      }\r\n      return null;\r\n    },\r\n  },\r\n  {\r\n    key: 'status',\r\n    label: 'Tr·∫°ng th√°i',\r\n    required: false,\r\n    type: 'enum',\r\n    enumValues: ['active', 'inactive', 'discontinued'],\r\n    enumLabels: {\r\n      'active': 'ƒêang kinh doanh',\r\n      'inactive': 'Ng·ª´ng kinh doanh',\r\n      'discontinued': 'Ng·ª´ng nh·∫≠p',\r\n    },\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'ƒêang kinh doanh',\r\n    defaultValue: 'active',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return 'active';\r\n      const str = String(value).toLowerCase().trim();\r\n      // Map ti·∫øng Vi·ªát sang English\r\n      if (str === 'ƒëang kinh doanh' || str === 'dang kinh doanh' || str === 'active') return 'active';\r\n      if (str === 'ng·ª´ng kinh doanh' || str === 'ngung kinh doanh' || str === 'inactive') return 'inactive';\r\n      if (str === 'ng·ª´ng nh·∫≠p' || str === 'ngung nhap' || str === 'discontinued') return 'discontinued';\r\n      return 'active';\r\n    },\r\n  },\r\n  {\r\n    key: 'unit',\r\n    label: 'ƒê∆°n v·ªã t√≠nh',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'C√°i',\r\n    defaultValue: 'C√°i',\r\n  },\r\n  {\r\n    key: 'categories',\r\n    label: 'Danh m·ª•c',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: 'Th·ªùi trang > √Åo nam; Sale > Hot deal', // Nhi·ªÅu danh m·ª•c ph√¢n c√°ch b·∫±ng ;\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const str = String(value).trim();\r\n      if (!str) return undefined;\r\n      // Split by semicolon to get multiple categories, each category can have multi-level with >\r\n      return str.split(';').map(s => s.trim()).filter(Boolean);\r\n    },\r\n    exportTransform: (value: unknown) => {\r\n      const categories = value as string[] | undefined;\r\n      return categories?.join('; ') || '';\r\n    },\r\n  },\r\n  // Legacy single category field (backward compatibility)\r\n  {\r\n    key: 'category',\r\n    label: 'Danh m·ª•c (c≈©)',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    hidden: true, // ·∫®n trong import, ch·ªâ d√πng cho backward compatibility\r\n    example: 'Th·ªùi trang > √Åo nam > √Åo s∆° mi',\r\n  },\r\n  {\r\n    key: 'description',\r\n    label: 'M√¥ t·∫£',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: '√Åo s∆° mi nam cao c·∫•p',\r\n  },\r\n  {\r\n    key: 'shortDescription',\r\n    label: 'M√¥ t·∫£ ng·∫Øn',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: '√Åo s∆° mi nam',\r\n  },\r\n\r\n  // ===== H√åNH ·∫¢NH =====\r\n  // NOTE: H√¨nh ·∫£nh ƒë∆∞·ª£c upload l√™n server tr∆∞·ªõc, sau ƒë√≥ import ƒë∆∞·ªùng d·∫´n\r\n  // Format: /products/{ma_sp}/{ten_file}.jpg ho·∫∑c URL ƒë·∫ßy ƒë·ªß\r\n  {\r\n    key: 'thumbnailImage',\r\n    label: '·∫¢nh ƒë·∫°i di·ªán',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'H√¨nh ·∫£nh',\r\n    example: '/products/SP001/main.jpg',\r\n    validator: (value: unknown) => {\r\n      if (!value) return null; // Optional\r\n      const str = String(value).trim();\r\n      // Cho ph√©p: /path/to/file.ext ho·∫∑c http(s)://...\r\n      if (!str.startsWith('/') && !str.startsWith('http')) {\r\n        return 'ƒê∆∞·ªùng d·∫´n ·∫£nh ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng / ho·∫∑c http(s)://';\r\n      }\r\n      // Check extension\r\n      const validExts = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.svg'];\r\n      const hasValidExt = validExts.some(ext => str.toLowerCase().endsWith(ext));\r\n      if (!hasValidExt && !str.includes('?')) { // Ignore if has query params\r\n        return 'ƒê·ªãnh d·∫°ng ·∫£nh kh√¥ng h·ª£p l·ªá (jpg, png, gif, webp, svg)';\r\n      }\r\n      return null;\r\n    },\r\n  },\r\n  {\r\n    key: 'galleryImages',\r\n    label: '·∫¢nh b·ªô s∆∞u t·∫≠p',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'H√¨nh ·∫£nh',\r\n    example: '/products/SP001/1.jpg, /products/SP001/2.jpg',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const str = String(value).trim();\r\n      if (!str) return undefined;\r\n      return str.split(/[,;|]/).map(s => s.trim()).filter(Boolean);\r\n    },\r\n    exportTransform: (value: unknown) => {\r\n      const images = value as string[] | undefined;\r\n      return images?.join(', ') || '';\r\n    },\r\n    validator: (value: unknown) => {\r\n      if (!value) return null;\r\n      const str = String(value).trim();\r\n      if (!str) return null;\r\n      const paths = str.split(/[,;|]/).map(s => s.trim()).filter(Boolean);\r\n      const validExts = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.svg'];\r\n      for (const path of paths) {\r\n        if (!path.startsWith('/') && !path.startsWith('http')) {\r\n          return `ƒê∆∞·ªùng d·∫´n \"${path}\" ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng / ho·∫∑c http(s)://`;\r\n        }\r\n        const hasValidExt = validExts.some(ext => path.toLowerCase().endsWith(ext));\r\n        if (!hasValidExt && !path.includes('?')) {\r\n          return `ƒê∆∞·ªùng d·∫´n \"${path}\" c√≥ ƒë·ªãnh d·∫°ng ·∫£nh kh√¥ng h·ª£p l·ªá`;\r\n        }\r\n      }\r\n      return null;\r\n    },\r\n  },\r\n\r\n  // ===== VIDEO LINKS =====\r\n  {\r\n    key: 'videoLinks',\r\n    label: 'Video link',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Media',\r\n    example: 'https://youtube.com/watch?v=xxx; https://drive.google.com/file/xxx',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const str = String(value).trim();\r\n      if (!str) return undefined;\r\n      return str.split(/[,;|]/).map(s => s.trim()).filter(Boolean);\r\n    },\r\n    exportTransform: (value: unknown) => {\r\n      const links = value as string[] | undefined;\r\n      return links?.join('; ') || '';\r\n    },\r\n    validator: (value: unknown) => {\r\n      if (!value) return null;\r\n      const str = String(value).trim();\r\n      if (!str) return null;\r\n      const links = str.split(/[,;|]/).map(s => s.trim()).filter(Boolean);\r\n      for (const link of links) {\r\n        if (!link.startsWith('http')) {\r\n          return `Link \"${link}\" ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng http:// ho·∫∑c https://`;\r\n        }\r\n        // Ki·ªÉm tra domain h·ª£p l·ªá (YouTube, TikTok, Drive, Vimeo, etc.)\r\n        const validDomains = ['youtube.com', 'youtu.be', 'tiktok.com', 'drive.google.com', 'vimeo.com', 'facebook.com', 'fb.watch'];\r\n        const isValidDomain = validDomains.some(domain => link.includes(domain));\r\n        if (!isValidDomain) {\r\n          // Cho ph√©p c√°c domain kh√°c nh∆∞ng c·∫£nh b√°o\r\n          console.warn(`Link \"${link}\" kh√¥ng thu·ªôc c√°c n·ªÅn t·∫£ng video ph·ªï bi·∫øn`);\r\n        }\r\n      }\r\n      return null;\r\n    },\r\n  },\r\n\r\n  // ===== GI√Å =====\r\n  {\r\n    key: 'costPrice',\r\n    label: 'Gi√° v·ªën',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Gi√°',\r\n    example: '150000',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return 0;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) ? 0 : num;\r\n    },\r\n  },\r\n  {\r\n    key: 'sellingPrice',\r\n    label: 'Gi√° b√°n',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Gi√°',\r\n    example: '250000',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return 0;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) ? 0 : num;\r\n    },\r\n  },\r\n  {\r\n    key: 'minPrice',\r\n    label: 'Gi√° t·ªëi thi·ªÉu',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Gi√°',\r\n    example: '200000',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) ? undefined : num;\r\n    },\r\n  },\r\n  {\r\n    key: 'taxRate',\r\n    label: 'Thu·∫ø su·∫•t (%)',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Gi√°',\r\n    example: '10',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const num = Number(String(value).replace(/[%\\s]/g, ''));\r\n      return isNaN(num) ? undefined : num;\r\n    },\r\n  },\r\n  // NOTE: Gi√° theo b·∫£ng gi√° (prices) ƒë∆∞·ª£c x·ª≠ l√Ω ƒë·ªông trong preTransformRawRow\r\n  // User t·∫°o c·ªôt v·ªõi t√™n = m√£ b·∫£ng gi√° (VD: PL_10, BANLE, VIP...)\r\n  // H·ªá th·ªëng t·ª± detect v√† gom v√†o field prices\r\n\r\n  // ===== T·ªíN KHO =====\r\n  // NOTE: initialStock ch·ªâ √°p d·ª•ng khi T·∫†O M·ªöI s·∫£n ph·∫©m (mode insert-only)\r\n  // T·ªìn kho sau ƒë√≥ ƒë∆∞·ª£c qu·∫£n l√Ω qua phi·∫øu nh·∫≠p/xu·∫•t/ki·ªÉm k√™\r\n  {\r\n    key: 'initialStock',\r\n    label: 'T·ªìn kho ban ƒë·∫ßu',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'T·ªìn kho',\r\n    example: '100',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) || num < 0 ? undefined : num;\r\n    },\r\n    // NOTE: Field n√†y ch·ªâ d√πng khi import t·∫°o m·ªõi\r\n    // Kh√¥ng export v√¨ t·ªìn kho th·ª±c t·∫ø n·∫±m trong inventoryByBranch\r\n  },\r\n  {\r\n    key: 'isStockTracked',\r\n    label: 'Theo d√µi t·ªìn kho',\r\n    required: false,\r\n    type: 'boolean',\r\n    exportGroup: 'T·ªìn kho',\r\n    example: 'C√≥',\r\n    defaultValue: true,\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return true;\r\n      const str = String(value).toLowerCase();\r\n      return str === 'c√≥' || str === 'yes' || str === 'true' || str === '1';\r\n    },\r\n  },\r\n  {\r\n    key: 'reorderLevel',\r\n    label: 'M·ª©c ƒë·∫∑t h√†ng l·∫°i',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'T·ªìn kho',\r\n    example: '10',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) ? undefined : num;\r\n    },\r\n  },\r\n  {\r\n    key: 'safetyStock',\r\n    label: 'T·ªìn kho an to√†n',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'T·ªìn kho',\r\n    example: '5',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) ? undefined : num;\r\n    },\r\n  },\r\n  {\r\n    key: 'maxStock',\r\n    label: 'T·ªìn kho t·ªëi ƒëa',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'T·ªìn kho',\r\n    example: '100',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) ? undefined : num;\r\n    },\r\n  },\r\n\r\n  // ===== V·∫¨T L√ù =====\r\n  {\r\n    key: 'weight',\r\n    label: 'Tr·ªçng l∆∞·ª£ng',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'V·∫≠t l√Ω',\r\n    example: '200',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) ? undefined : num;\r\n    },\r\n  },\r\n  {\r\n    key: 'weightUnit',\r\n    label: 'ƒê∆°n v·ªã tr·ªçng l∆∞·ª£ng',\r\n    required: false,\r\n    type: 'enum',\r\n    enumValues: ['g', 'kg'],\r\n    exportGroup: 'V·∫≠t l√Ω',\r\n    example: 'g',\r\n    defaultValue: 'g',\r\n  },\r\n\r\n  // ===== B·∫¢O H√ÄNH =====\r\n  {\r\n    key: 'warrantyPeriodMonths',\r\n    label: 'B·∫£o h√†nh (th√°ng)',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'B·∫£o h√†nh',\r\n    example: '12',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) ? undefined : num;\r\n    },\r\n  },\r\n\r\n  // ===== K√çCH TH∆Ø·ªöC =====\r\n  {\r\n    key: 'dimensions',\r\n    label: 'K√≠ch th∆∞·ªõc (DxRxC cm)',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'V·∫≠t l√Ω',\r\n    example: '30x20x10',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const str = String(value).trim();\r\n      const match = str.match(/^(\\d+(?:\\.\\d+)?)\\s*[xX√ó]\\s*(\\d+(?:\\.\\d+)?)\\s*[xX√ó]\\s*(\\d+(?:\\.\\d+)?)$/);\r\n      if (match) {\r\n        return {\r\n          length: parseFloat(match[1]),\r\n          width: parseFloat(match[2]),\r\n          height: parseFloat(match[3]),\r\n        };\r\n      }\r\n      return undefined;\r\n    },\r\n    exportTransform: (value: unknown) => {\r\n      const dims = value as { length?: number; width?: number; height?: number } | undefined;\r\n      if (dims && typeof dims === 'object' && 'length' in dims) {\r\n        return `${dims.length || 0}x${dims.width || 0}x${dims.height || 0}`;\r\n      }\r\n      return '';\r\n    },\r\n  },\r\n\r\n  // ===== TH√îNG TIN M·ªû R·ªòNG =====\r\n  {\r\n    key: 'ktitle',\r\n    label: 'Ti√™u ƒë·ªÅ SEO',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'M√¥ t·∫£',\r\n    example: '√Åo s∆° mi nam cao c·∫•p | Th·ªùi trang ABC',\r\n  },\r\n  {\r\n    key: 'seoDescription',\r\n    label: 'M√¥ t·∫£ SEO',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'M√¥ t·∫£',\r\n    example: '√Åo s∆° mi nam ch·∫•t li·ªáu cotton cao c·∫•p...',\r\n  },\r\n  {\r\n    key: 'subCategories',\r\n    label: 'Danh m·ª•c ph·ª•',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Ph√¢n lo·∫°i',\r\n    example: 'Slim fit > Form √¥m; Cotton > Cao c·∫•p', // Nhi·ªÅu danh m·ª•c ph·ª• ph√¢n c√°ch b·∫±ng ;\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const str = String(value).trim();\r\n      if (!str) return undefined;\r\n      // Split by semicolon to get multiple sub-categories\r\n      return str.split(';').map(s => s.trim()).filter(Boolean);\r\n    },\r\n    exportTransform: (value: unknown) => {\r\n      const subCategories = value as string[] | undefined;\r\n      return subCategories?.join('; ') || '';\r\n    },\r\n  },\r\n  // Legacy single subCategory field (backward compatibility)\r\n  {\r\n    key: 'subCategory',\r\n    label: 'Danh m·ª•c ph·ª• (c≈©)',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Ph√¢n lo·∫°i',\r\n    hidden: true,\r\n    example: '√Åo s∆° mi > D√†i tay > Slim fit',\r\n  },\r\n  {\r\n    key: 'tags',\r\n    label: 'Tags',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Ph√¢n lo·∫°i',\r\n    example: 'nam,c√¥ng s·ªü,cotton',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const str = String(value).trim();\r\n      return str.split(/[,;]/).map(s => s.trim()).filter(Boolean);\r\n    },\r\n    exportTransform: (value: unknown) => {\r\n      const tags = value as string[] | undefined;\r\n      return tags?.join(', ') || '';\r\n    },\r\n  },\r\n  {\r\n    key: 'pkgxId',\r\n    label: 'ID PKGX',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: '12345',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) || num <= 0 ? undefined : num;\r\n    },\r\n  },\r\n  {\r\n    key: 'trendtechId',\r\n    label: 'ID Trendtech',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    example: '67890',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) || num <= 0 ? undefined : num;\r\n    },\r\n  },\r\n  {\r\n    key: 'warehouseLocation',\r\n    label: 'V·ªã tr√≠ kho',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'T·ªìn kho',\r\n    example: 'A1-01',\r\n  },\r\n\r\n  // ===== GI√Å B·ªî SUNG =====\r\n  {\r\n    key: 'lastPurchasePrice',\r\n    label: 'Gi√° nh·∫≠p g·∫ßn nh·∫•t',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Gi√°',\r\n    example: '140000',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) ? undefined : num;\r\n    },\r\n  },\r\n\r\n  // ===== TH√îNG TIN TEM =====\r\n  {\r\n    key: 'nameVat',\r\n    label: 'T√™n VAT',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Tem ph·ª•',\r\n    example: '√Åo s∆° mi nam cotton',\r\n  },\r\n  {\r\n    key: 'origin',\r\n    label: 'Xu·∫•t x·ª©',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Tem ph·ª•',\r\n    example: 'Vi·ªát Nam',\r\n  },\r\n  {\r\n    key: 'usageGuide',\r\n    label: 'H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Tem ph·ª•',\r\n    example: 'Gi·∫∑t m√°y ·ªü nhi·ªát ƒë·ªô th·∫•p',\r\n  },\r\n  {\r\n    key: 'importerName',\r\n    label: 'ƒê∆°n v·ªã nh·∫≠p kh·∫©u',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Tem ph·ª•',\r\n    example: 'C√¥ng ty TNHH ABC',\r\n  },\r\n  {\r\n    key: 'importerAddress',\r\n    label: 'ƒê·ªãa ch·ªâ nh·∫≠p kh·∫©u',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'Tem ph·ª•',\r\n    example: '123 Nguy·ªÖn VƒÉn A, Q.1, TP.HCM',\r\n  },\r\n\r\n  // ===== E-COMMERCE (b√°n h√†ng website) =====\r\n  // Slug chung (legacy - kh√¥ng khuy·∫øn kh√≠ch d√πng n·ªØa)\r\n  {\r\n    key: 'slug',\r\n    label: 'Slug (URL)',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'E-commerce',\r\n    hidden: true, // ·∫®n field c≈©, d√πng pkgxSlug/trendtechSlug thay th·∫ø\r\n    example: 'ao-so-mi-nam-trang-oxford',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      // Convert to URL-friendly slug\r\n      return String(value).trim()\r\n        .toLowerCase()\r\n        .normalize('NFD')\r\n        .replace(/[\\u0300-\\u036f]/g, '') // Remove diacritics\r\n        .replace(/ƒë/g, 'd')\r\n        .replace(/[^a-z0-9]+/g, '-')\r\n        .replace(/^-+|-+$/g, '');\r\n    },\r\n  },\r\n  // Slug ri√™ng cho PKGX website\r\n  {\r\n    key: 'pkgxSlug',\r\n    label: 'Slug PKGX',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'E-commerce PKGX',\r\n    example: 'ao-so-mi-nam-trang-oxford',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      // Convert to URL-friendly slug\r\n      return String(value).trim()\r\n        .toLowerCase()\r\n        .normalize('NFD')\r\n        .replace(/[\\u0300-\\u036f]/g, '') // Remove diacritics\r\n        .replace(/ƒë/g, 'd')\r\n        .replace(/[^a-z0-9]+/g, '-')\r\n        .replace(/^-+|-+$/g, '');\r\n    },\r\n  },\r\n  // Slug ri√™ng cho Trendtech website\r\n  {\r\n    key: 'trendtechSlug',\r\n    label: 'Slug Trendtech',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'E-commerce Trendtech',\r\n    example: 'ao-so-mi-nam-trang-oxford',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      // Convert to URL-friendly slug\r\n      return String(value).trim()\r\n        .toLowerCase()\r\n        .normalize('NFD')\r\n        .replace(/[\\u0300-\\u036f]/g, '') // Remove diacritics\r\n        .replace(/ƒë/g, 'd')\r\n        .replace(/[^a-z0-9]+/g, '-')\r\n        .replace(/^-+|-+$/g, '');\r\n    },\r\n  },\r\n  {\r\n    key: 'isPublished',\r\n    label: 'ƒêƒÉng web',\r\n    required: false,\r\n    type: 'boolean',\r\n    exportGroup: 'E-commerce',\r\n    example: 'C√≥',\r\n    defaultValue: false,\r\n    importTransform: (value: unknown) => {\r\n      if (value === undefined || value === null || value === '') return false;\r\n      const str = String(value).toLowerCase().trim();\r\n      return str === 'c√≥' || str === 'yes' || str === '1' || str === 'true' || str === 'x';\r\n    },\r\n    exportTransform: (value: unknown) => (value ? 'C√≥' : 'Kh√¥ng'),\r\n  },\r\n  {\r\n    key: 'isFeatured',\r\n    label: 'N·ªïi b·∫≠t',\r\n    required: false,\r\n    type: 'boolean',\r\n    exportGroup: 'E-commerce',\r\n    example: 'C√≥',\r\n    defaultValue: false,\r\n    importTransform: (value: unknown) => {\r\n      if (value === undefined || value === null || value === '') return false;\r\n      const str = String(value).toLowerCase().trim();\r\n      return str === 'c√≥' || str === 'yes' || str === '1' || str === 'true' || str === 'x';\r\n    },\r\n    exportTransform: (value: unknown) => (value ? 'C√≥' : 'Kh√¥ng'),\r\n  },\r\n  {\r\n    key: 'isNewArrival',\r\n    label: 'M·ªõi v·ªÅ',\r\n    required: false,\r\n    type: 'boolean',\r\n    exportGroup: 'E-commerce',\r\n    example: 'C√≥',\r\n    defaultValue: false,\r\n    importTransform: (value: unknown) => {\r\n      if (value === undefined || value === null || value === '') return false;\r\n      const str = String(value).toLowerCase().trim();\r\n      return str === 'c√≥' || str === 'yes' || str === '1' || str === 'true' || str === 'x';\r\n    },\r\n    exportTransform: (value: unknown) => (value ? 'C√≥' : 'Kh√¥ng'),\r\n  },\r\n  {\r\n    key: 'isBestSeller',\r\n    label: 'B√°n ch·∫°y',\r\n    required: false,\r\n    type: 'boolean',\r\n    exportGroup: 'E-commerce',\r\n    example: 'C√≥',\r\n    defaultValue: false,\r\n    importTransform: (value: unknown) => {\r\n      if (value === undefined || value === null || value === '') return false;\r\n      const str = String(value).toLowerCase().trim();\r\n      return str === 'c√≥' || str === 'yes' || str === '1' || str === 'true' || str === 'x';\r\n    },\r\n    exportTransform: (value: unknown) => (value ? 'C√≥' : 'Kh√¥ng'),\r\n  },\r\n  {\r\n    key: 'isOnSale',\r\n    label: 'ƒêang gi·∫£m gi√°',\r\n    required: false,\r\n    type: 'boolean',\r\n    exportGroup: 'E-commerce',\r\n    example: 'C√≥',\r\n    defaultValue: false,\r\n    importTransform: (value: unknown) => {\r\n      if (value === undefined || value === null || value === '') return false;\r\n      const str = String(value).toLowerCase().trim();\r\n      return str === 'c√≥' || str === 'yes' || str === '1' || str === 'true' || str === 'x';\r\n    },\r\n    exportTransform: (value: unknown) => (value ? 'C√≥' : 'Kh√¥ng'),\r\n  },\r\n  {\r\n    key: 'sortOrder',\r\n    label: 'Th·ª© t·ª± hi·ªÉn th·ªã',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'E-commerce',\r\n    example: '1',\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) ? undefined : num;\r\n    },\r\n  },\r\n  {\r\n    key: 'publishedAt',\r\n    label: 'Ng√†y ƒëƒÉng web',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'E-commerce',\r\n    example: '2024-01-15',\r\n  },\r\n\r\n  // ===== PH√ÇN T√çCH B√ÅN H√ÄNG =====\r\n  {\r\n    key: 'totalSold',\r\n    label: 'T·ªïng ƒë√£ b√°n',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Ph√¢n t√≠ch',\r\n    hidden: true, // Ch·ªâ export, kh√¥ng import\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) ? undefined : num;\r\n    },\r\n  },\r\n  {\r\n    key: 'totalRevenue',\r\n    label: 'T·ªïng doanh thu',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Ph√¢n t√≠ch',\r\n    hidden: true, // Ch·ªâ export, kh√¥ng import\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) ? undefined : num;\r\n    },\r\n  },\r\n  {\r\n    key: 'lastSoldDate',\r\n    label: 'Ng√†y b√°n g·∫ßn nh·∫•t',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'Ph√¢n t√≠ch',\r\n    hidden: true,\r\n  },\r\n  {\r\n    key: 'viewCount',\r\n    label: 'L∆∞·ª£t xem',\r\n    required: false,\r\n    type: 'number',\r\n    exportGroup: 'Ph√¢n t√≠ch',\r\n    hidden: true,\r\n    importTransform: (value: unknown) => {\r\n      if (!value) return undefined;\r\n      const num = Number(String(value).replace(/[,.\\s]/g, ''));\r\n      return isNaN(num) ? undefined : num;\r\n    },\r\n  },\r\n\r\n  // ===== V√íNG ƒê·ªúI S·∫¢N PH·∫®M =====\r\n  {\r\n    key: 'launchedDate',\r\n    label: 'Ng√†y ra m·∫Øt',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'V√≤ng ƒë·ªùi',\r\n    example: '2024-01-15',\r\n  },\r\n  {\r\n    key: 'lastPurchaseDate',\r\n    label: 'Ng√†y nh·∫≠p g·∫ßn nh·∫•t',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'V√≤ng ƒë·ªùi',\r\n    hidden: true,\r\n  },\r\n  {\r\n    key: 'discontinuedDate',\r\n    label: 'Ng√†y ng·ª´ng kinh doanh',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'V√≤ng ƒë·ªùi',\r\n    example: '2025-12-31',\r\n  },\r\n\r\n  // ===== H·ªÜ TH·ªêNG (hidden) =====\r\n  {\r\n    key: 'systemId',\r\n    label: 'System ID',\r\n    required: false,\r\n    type: 'string',\r\n    exportGroup: 'H·ªá th·ªëng',\r\n    hidden: true,\r\n  },\r\n  {\r\n    key: 'createdAt',\r\n    label: 'Ng√†y t·∫°o',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'H·ªá th·ªëng',\r\n    hidden: true,\r\n  },\r\n  {\r\n    key: 'updatedAt',\r\n    label: 'Ng√†y c·∫≠p nh·∫≠t',\r\n    required: false,\r\n    type: 'date',\r\n    exportGroup: 'H·ªá th·ªëng',\r\n    hidden: true,\r\n  },\r\n];\r\n\r\n// ===== MAIN CONFIG =====\r\nexport const productImportExportConfig: ImportExportConfig<Product> = {\r\n  entityType: 'products',\r\n  entityDisplayName: 'S·∫£n ph·∫©m',\r\n  fields: productFields,\r\n  upsertKey: 'id', // D√πng m√£ s·∫£n ph·∫©m ƒë·ªÉ ƒë·ªëi chi·∫øu khi UPDATE\r\n  templateFileName: 'mau-import-san-pham.xlsx',\r\n  requireBranch: true, // B·∫Øt bu·ªôc chi nh√°nh ƒë·ªÉ x·ª≠ l√Ω t·ªìn kho ban ƒë·∫ßu\r\n  \r\n  // Pre-transform raw row (normalize column names + detect pricing columns)\r\n  preTransformRawRow: (rawRow: Record<string, unknown>) => {\r\n    const normalized: Record<string, unknown> = {};\r\n    const prices: Record<string, number> = {};\r\n    \r\n    // Map t·ª´ label ti·∫øng Vi·ªát sang key\r\n    const labelToKey: Record<string, string> = {};\r\n    productFields.forEach(field => {\r\n      labelToKey[field.label.toLowerCase()] = field.key as string;\r\n      // Also map without (*) marker\r\n      const labelWithoutStar = field.label.replace(/\\s*\\(\\*\\)\\s*$/, '').toLowerCase();\r\n      labelToKey[labelWithoutStar] = field.key as string;\r\n    });\r\n    \r\n    Object.entries(rawRow).forEach(([key, value]) => {\r\n      // Normalize Excel header: strip (*) marker and lowercase\r\n      const normalizedExcelHeader = key.replace(/\\s*\\(\\*\\)\\s*$/, '').toLowerCase();\r\n      \r\n      // Check if this column is a pricing policy code (e.g., PL_10, BANLE, VIP)\r\n      const policySystemId = getPricingPolicySystemId(key);\r\n      if (policySystemId && value !== undefined && value !== null && value !== '') {\r\n        // This is a pricing column - parse price value\r\n        const priceValue = Number(String(value).replace(/[,.\\s]/g, ''));\r\n        if (!isNaN(priceValue) && priceValue > 0) {\r\n          prices[policySystemId] = priceValue;\r\n        }\r\n      } else {\r\n        // Normal field - map to key\r\n        const normalizedKey = labelToKey[normalizedExcelHeader] || labelToKey[key.toLowerCase()] || key;\r\n        normalized[normalizedKey] = value;\r\n      }\r\n    });\r\n    \r\n    // Add prices if any pricing columns were found\r\n    if (Object.keys(prices).length > 0) {\r\n      normalized.prices = prices;\r\n    }\r\n    \r\n    return normalized;\r\n  },\r\n  \r\n  // Post-transform row (set defaults, enrich data)\r\n  // NOTE: branchSystemId ƒë∆∞·ª£c truy·ªÅn t·ª´ import dialog ƒë·ªÉ x·ª≠ l√Ω t·ªìn kho ban ƒë·∫ßu\r\n  postTransformRow: (row: Partial<Product & { initialStock?: number }>, _index?: number, branchSystemId?: string) => {\r\n    // X·ª≠ l√Ω t·ªìn kho ban ƒë·∫ßu - ch·ªâ √°p d·ª•ng khi c√≥ initialStock v√† branchSystemId\r\n    let inventoryByBranch = row.inventoryByBranch || {};\r\n    const initialStock = (row as { initialStock?: number }).initialStock;\r\n    \r\n    if (initialStock !== undefined && initialStock > 0 && branchSystemId) {\r\n      inventoryByBranch = {\r\n        ...inventoryByBranch,\r\n        [branchSystemId]: initialStock,\r\n      };\r\n    }\r\n    \r\n    // Remove initialStock from final data (kh√¥ng l∆∞u v√†o Product)\r\n    const { initialStock: _removed, ...cleanRow } = row as Partial<Product> & { initialStock?: number };\r\n    \r\n    // Auto-set productTypeSystemId n·∫øu ch∆∞a c√≥\r\n    // ∆Øu ti√™n: productTypeSystemId > type enum mapping > default\r\n    let productTypeSystemIdStr = cleanRow.productTypeSystemId as string | undefined;\r\n    if (!productTypeSystemIdStr && cleanRow.type) {\r\n      // Map t·ª´ type enum sang productTypeSystemId\r\n      productTypeSystemIdStr = getProductTypeSystemIdByEnumType(cleanRow.type) || undefined;\r\n    }\r\n    if (!productTypeSystemIdStr) {\r\n      // Fallback: l·∫•y default ProductType\r\n      productTypeSystemIdStr = getDefaultProductTypeSystemId() || undefined;\r\n    }\r\n    \r\n    // Cast to SystemId if we have a value\r\n    const productTypeSystemId = productTypeSystemIdStr ? asSystemId(productTypeSystemIdStr) : undefined;\r\n    \r\n    return {\r\n      ...cleanRow,\r\n      type: cleanRow.type || 'physical',\r\n      productTypeSystemId, // Lu√¥n set productTypeSystemId\r\n      status: cleanRow.status || 'active',\r\n      unit: cleanRow.unit || 'C√°i',\r\n      costPrice: cleanRow.costPrice ?? 0,\r\n      sellingPrice: cleanRow.sellingPrice ?? 0,\r\n      isStockTracked: cleanRow.isStockTracked ?? true,\r\n      prices: cleanRow.prices || {},\r\n      inventoryByBranch,\r\n      committedByBranch: cleanRow.committedByBranch || {},\r\n      inTransitByBranch: cleanRow.inTransitByBranch || {},\r\n    };\r\n  },\r\n  \r\n  // Validate row level (check duplicate SKU/barcode + warnings)\r\n  validateRow: (row, _index, existingData, mode) => {\r\n    const errors: Array<{ field?: string; message: string; type?: 'error' | 'warning' }> = [];\r\n    const rowWithInitialStock = row as Partial<Product> & { initialStock?: number };\r\n    \r\n    // Check unique SKU - only in insert-only mode\r\n    if (row.sku && mode === 'insert-only') {\r\n      const duplicate = existingData.find(\r\n        p => p.sku === row.sku && p.id !== row.id\r\n      );\r\n      if (duplicate) {\r\n        errors.push({\r\n          field: 'sku',\r\n          message: `SKU ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng b·ªüi ${duplicate.name} (${duplicate.id})`,\r\n        });\r\n      }\r\n    }\r\n    \r\n    // Check unique barcode - only in insert-only mode\r\n    if (row.barcode && mode === 'insert-only') {\r\n      const duplicate = existingData.find(\r\n        p => p.barcode === row.barcode && p.id !== row.id\r\n      );\r\n      if (duplicate) {\r\n        errors.push({\r\n          field: 'barcode',\r\n          message: `M√£ v·∫°ch ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng b·ªüi ${duplicate.name} (${duplicate.id})`,\r\n        });\r\n      }\r\n    }\r\n    \r\n    // C·∫£nh b√°o: initialStock ch·ªâ c√≥ t√°c d·ª•ng khi t·∫°o m·ªõi\r\n    if (rowWithInitialStock.initialStock !== undefined && rowWithInitialStock.initialStock > 0) {\r\n      if (mode === 'update-only') {\r\n        errors.push({\r\n          field: 'initialStock',\r\n          message: 'T·ªìn kho ban ƒë·∫ßu s·∫Ω b·ªã B·ªé QUA v√¨ ƒëang ·ªü ch·∫ø ƒë·ªô C·∫≠p nh·∫≠t',\r\n          type: 'warning',\r\n        });\r\n      } else if (mode === 'upsert') {\r\n        // Check if product exists\r\n        const exists = existingData.find(p => p.id === row.id);\r\n        if (exists) {\r\n          errors.push({\r\n            field: 'initialStock',\r\n            message: `SP ƒë√£ t·ªìn t·∫°i - t·ªìn kho ban ƒë·∫ßu s·∫Ω B·ªé QUA (gi·ªØ nguy√™n t·ªìn kho hi·ªán t·∫°i)`,\r\n            type: 'warning',\r\n          });\r\n        }\r\n      }\r\n    }\r\n    \r\n    // C·∫£nh b√°o gi√° b√°n < gi√° v·ªën\r\n    if (row.costPrice && row.sellingPrice && row.costPrice > row.sellingPrice) {\r\n      errors.push({\r\n        field: 'sellingPrice',\r\n        message: `Gi√° b√°n (${row.sellingPrice?.toLocaleString()}) th·∫•p h∆°n gi√° v·ªën (${row.costPrice?.toLocaleString()})`,\r\n        type: 'warning',\r\n      });\r\n    }\r\n    \r\n    return errors;\r\n  },\r\n};\r\n\r\n// Re-export cho backward compatibility\r\nexport default productImportExportConfig;\r\n"],"names":[],"mappings":";;;;;;;;AAEA;AACA;AACA;;;;AAEA;;;CAGC,GAED,mCAAmC;AACnC,MAAM,wBAAwB;IAC5B,OAAO,oKAAqB,CAAC,QAAQ,GAAG,IAAI;AAC9C;AAEA,mCAAmC;AACnC,qDAAqD;AACrD,MAAM,qBAAqB;IACzB,OAAO,uLAAmB,CAAC,QAAQ,GAAG,SAAS;AACjD;AAEA,iEAAiE;AACjE,MAAM,+BAA+B,CAAC;IACpC,IAAI,CAAC,MAAM,OAAO;IAClB,MAAM,eAAe;IACrB,MAAM,iBAAiB,KAAK,WAAW,GAAG,IAAI;IAE9C,4CAA4C;IAC5C,MAAM,cAAc,aAAa,IAAI,CAAC,CAAA,KACpC,GAAG,IAAI,CAAC,WAAW,OAAO,kBAC1B,GAAG,EAAE,CAAC,WAAW,OAAO;IAG1B,OAAO,aAAa,YAAY;AAClC;AAEA,6CAA6C;AAC7C,MAAM,yBAAyB,CAAC;IAC9B,IAAI,CAAC,UAAU,OAAO;IACtB,MAAM,eAAe;IACrB,MAAM,cAAc,aAAa,IAAI,CAAC,CAAA,KAAM,GAAG,QAAQ,KAAK;IAC5D,OAAO,aAAa,QAAQ;AAC9B;AAEA,2CAA2C;AAC3C,MAAM,gCAAgC;IACpC,MAAM,eAAe;IACrB,MAAM,cAAc,aAAa,IAAI,CAAC,CAAA,KAAM,GAAG,SAAS;IACxD,OAAO,aAAa,YAAY,YAAY,CAAC,EAAE,EAAE,YAAY;AAC/D;AAEA,mFAAmF;AACnF,wCAAwC;AACxC,MAAM,mCAAmC,CAAC;IACxC,IAAI,CAAC,UAAU,OAAO;IAEtB,MAAM,eAAe;IACrB,MAAM,iBAAiB,OAAO,UAAU,WAAW,GAAG,IAAI;IAE1D,0DAA0D;IAC1D,MAAM,kBAA4C;QAChD,YAAY;YAAC;YAAY;YAAY;YAAY;SAAW;QAC5D,WAAW;YAAC;YAAW;YAAW;SAAU;QAC5C,WAAW;YAAC;YAAW;YAAe;YAAe;YAAe;SAAc;QAClF,SAAS;YAAC;YAAS;YAAe;SAAc;IAClD;IAEA,KAAK,MAAM,CAAC,UAAU,MAAM,IAAI,OAAO,OAAO,CAAC,iBAAkB;QAC/D,IAAI,MAAM,QAAQ,CAAC,iBAAiB;YAClC,yDAAyD;YACzD,MAAM,cAAc,aAAa,IAAI,CAAC,CAAA,KACpC,MAAM,IAAI,CAAC,CAAA,OAAQ,GAAG,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC,SAAS,KAAK,QAAQ,CAAC,GAAG,IAAI,CAAC,WAAW;YAE9F,IAAI,aAAa,OAAO,YAAY,QAAQ;QAC9C;IACF;IAEA,mCAAmC;IACnC,MAAM,cAAc,aAAa,IAAI,CAAC,CAAA,KACpC,GAAG,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC,mBAC/B,eAAe,QAAQ,CAAC,GAAG,IAAI,CAAC,WAAW;IAG7C,OAAO,aAAa,YAAY;AAClC;AAEA,qCAAqC;AACrC,6DAA6D;AAC7D,2CAA2C;AAC3C,2DAA2D;AAC3D,gDAAgD;AAChD,MAAM,2BAA2B,CAAC;IAChC,MAAM,WAAW;IAEjB,iDAAiD;IACjD,IAAI,iBAAiB,WAAW,IAAI;IACpC,MAAM,cAAc;IACpB,IAAI,YAAY,IAAI,CAAC,iBAAiB;QACpC,iBAAiB,eAAe,OAAO,CAAC,aAAa,IAAI,IAAI;IAC/D;IAEA,MAAM,YAAY,eAAe,WAAW;IAE5C,kCAAkC;IAClC,MAAM,aAAa,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,CAAC,WAAW,OAAO;IAC7D,IAAI,YAAY,OAAO,WAAW,QAAQ;IAE1C,+BAA+B;IAC/B,MAAM,eAAe,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,IAAI,CAAC,WAAW,OAAO;IACjE,IAAI,cAAc,OAAO,aAAa,QAAQ;IAE9C,qCAAqC;IACrC,MAAM,sBAAsB,SAAS,IAAI,CAAC,CAAA,IACxC,EAAE,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC,cAC9B,UAAU,QAAQ,CAAC,EAAE,IAAI,CAAC,WAAW;IAEvC,IAAI,qBAAqB,OAAO,oBAAoB,QAAQ;IAE5D,OAAO;AACT;AAEA,uDAAuD;AACvD,MAAM,uBAAuB,CAAC;IAC5B,MAAM,WAAW;IACjB,MAAM,SAAS,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK;IACjD,OAAO,QAAQ,MAAM;AACvB;AAEA,kDAAkD;AAClD,MAAM,uBAAuB,CAAC;IAC5B,MAAM,WAAW;IACjB,MAAM,SAAS,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK;IACjD,OAAO,QAAQ,QAAQ;AACzB;AAEA,0EAA0E;AAC1E,MAAM,wBAAwB,CAAC;IAC7B,OAAO,yBAAyB,gBAAgB;AAClD;AAGO,MAAM,gBAAwC;IACnD,+BAA+B;IAC/B;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,YAAY;YAAC;YAAY;YAAW;SAAU;QAC9C,YAAY;YACV,YAAY;YACZ,WAAW;YACX,WAAW;QACb;QACA,aAAa;QACb,SAAS;QACT,cAAc;QACd,QAAQ;QACR,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,WAAW,GAAG,IAAI;YAC5C,8BAA8B;YAC9B,IAAI,QAAQ,cAAc,QAAQ,cAAc,QAAQ,cAAc,QAAQ,YAAY,OAAO;YACjG,IAAI,QAAQ,aAAa,QAAQ,aAAa,QAAQ,WAAW,OAAO;YACxE,IAAI,QAAQ,iBAAiB,QAAQ,iBAAiB,QAAQ,iBAAiB,QAAQ,aAAa,QAAQ,eAAe,OAAO;YAClI,IAAI,QAAQ,WAAW,QAAQ,iBAAiB,QAAQ,eAAe,OAAO;YAC9E,OAAO;QACT;QACA,WAAW,CAAC;YACV,IAAI,UAAU,SAAS;gBACrB,OAAO;YACT;YACA,OAAO;QACT;IACF;IACA,4FAA4F;IAC5F;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,IAAI;YAC9B,IAAI,CAAC,KAAK,OAAO;YAEjB,4DAA4D;YAC5D,MAAM,WAAW,6BAA6B;YAC9C,IAAI,UAAU,OAAO;YAErB,gCAAgC;YAChC,MAAM,eAAe,iCAAiC;YACtD,OAAO,gBAAgB;QACzB;QACA,iBAAiB,CAAC;YAChB,yCAAyC;YACzC,OAAO,uBAAuB;QAChC;QACA,WAAW,CAAC;YACV,IAAI,CAAC,OAAO,OAAO,MAAM,iBAAiB;YAC1C,MAAM,MAAM,OAAO,OAAO,IAAI;YAC9B,IAAI,CAAC,KAAK,OAAO;YAEjB,oDAAoD;YACpD,MAAM,WAAW,6BAA6B;YAC9C,IAAI,CAAC,UAAU;gBACb,2BAA2B;gBAC3B,MAAM,eAAe,iCAAiC;gBACtD,IAAI,CAAC,cAAc;oBACjB,OAAO,CAAC,eAAe,EAAE,IAAI,6FAA6F,CAAC;gBAC7H;YACF;YACA,OAAO;QACT;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,YAAY;YAAC;YAAU;YAAY;SAAe;QAClD,YAAY;YACV,UAAU;YACV,YAAY;YACZ,gBAAgB;QAClB;QACA,aAAa;QACb,SAAS;QACT,cAAc;QACd,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,WAAW,GAAG,IAAI;YAC5C,8BAA8B;YAC9B,IAAI,QAAQ,qBAAqB,QAAQ,qBAAqB,QAAQ,UAAU,OAAO;YACvF,IAAI,QAAQ,sBAAsB,QAAQ,sBAAsB,QAAQ,YAAY,OAAO;YAC3F,IAAI,QAAQ,gBAAgB,QAAQ,gBAAgB,QAAQ,gBAAgB,OAAO;YACnF,OAAO;QACT;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,cAAc;IAChB;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,IAAI;YAC9B,IAAI,CAAC,KAAK,OAAO;YACjB,2FAA2F;YAC3F,OAAO,IAAI,KAAK,CAAC,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,IAAI,MAAM,CAAC;QAClD;QACA,iBAAiB,CAAC;YAChB,MAAM,aAAa;YACnB,OAAO,YAAY,KAAK,SAAS;QACnC;IACF;IACA,wDAAwD;IACxD;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,QAAQ;QACR,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IAEA,uBAAuB;IACvB,uEAAuE;IACvE,2DAA2D;IAC3D;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,WAAW,CAAC;YACV,IAAI,CAAC,OAAO,OAAO,MAAM,WAAW;YACpC,MAAM,MAAM,OAAO,OAAO,IAAI;YAC9B,iDAAiD;YACjD,IAAI,CAAC,IAAI,UAAU,CAAC,QAAQ,CAAC,IAAI,UAAU,CAAC,SAAS;gBACnD,OAAO;YACT;YACA,kBAAkB;YAClB,MAAM,YAAY;gBAAC;gBAAQ;gBAAS;gBAAQ;gBAAQ;gBAAS;aAAO;YACpE,MAAM,cAAc,UAAU,IAAI,CAAC,CAAA,MAAO,IAAI,WAAW,GAAG,QAAQ,CAAC;YACrE,IAAI,CAAC,eAAe,CAAC,IAAI,QAAQ,CAAC,MAAM;gBACtC,OAAO;YACT;YACA,OAAO;QACT;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,IAAI;YAC9B,IAAI,CAAC,KAAK,OAAO;YACjB,OAAO,IAAI,KAAK,CAAC,SAAS,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,IAAI,MAAM,CAAC;QACtD;QACA,iBAAiB,CAAC;YAChB,MAAM,SAAS;YACf,OAAO,QAAQ,KAAK,SAAS;QAC/B;QACA,WAAW,CAAC;YACV,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,IAAI;YAC9B,IAAI,CAAC,KAAK,OAAO;YACjB,MAAM,QAAQ,IAAI,KAAK,CAAC,SAAS,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,IAAI,MAAM,CAAC;YAC3D,MAAM,YAAY;gBAAC;gBAAQ;gBAAS;gBAAQ;gBAAQ;gBAAS;aAAO;YACpE,KAAK,MAAM,QAAQ,MAAO;gBACxB,IAAI,CAAC,KAAK,UAAU,CAAC,QAAQ,CAAC,KAAK,UAAU,CAAC,SAAS;oBACrD,OAAO,CAAC,WAAW,EAAE,KAAK,qCAAqC,CAAC;gBAClE;gBACA,MAAM,cAAc,UAAU,IAAI,CAAC,CAAA,MAAO,KAAK,WAAW,GAAG,QAAQ,CAAC;gBACtE,IAAI,CAAC,eAAe,CAAC,KAAK,QAAQ,CAAC,MAAM;oBACvC,OAAO,CAAC,WAAW,EAAE,KAAK,+BAA+B,CAAC;gBAC5D;YACF;YACA,OAAO;QACT;IACF;IAEA,0BAA0B;IAC1B;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,IAAI;YAC9B,IAAI,CAAC,KAAK,OAAO;YACjB,OAAO,IAAI,KAAK,CAAC,SAAS,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,IAAI,MAAM,CAAC;QACtD;QACA,iBAAiB,CAAC;YAChB,MAAM,QAAQ;YACd,OAAO,OAAO,KAAK,SAAS;QAC9B;QACA,WAAW,CAAC;YACV,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,IAAI;YAC9B,IAAI,CAAC,KAAK,OAAO;YACjB,MAAM,QAAQ,IAAI,KAAK,CAAC,SAAS,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,IAAI,MAAM,CAAC;YAC3D,KAAK,MAAM,QAAQ,MAAO;gBACxB,IAAI,CAAC,KAAK,UAAU,CAAC,SAAS;oBAC5B,OAAO,CAAC,MAAM,EAAE,KAAK,yCAAyC,CAAC;gBACjE;gBACA,+DAA+D;gBAC/D,MAAM,eAAe;oBAAC;oBAAe;oBAAY;oBAAc;oBAAoB;oBAAa;oBAAgB;iBAAW;gBAC3H,MAAM,gBAAgB,aAAa,IAAI,CAAC,CAAA,SAAU,KAAK,QAAQ,CAAC;gBAChE,IAAI,CAAC,eAAe;oBAClB,0CAA0C;oBAC1C,QAAQ,IAAI,CAAC,CAAC,MAAM,EAAE,KAAK,yCAAyC,CAAC;gBACvE;YACF;YACA,OAAO;QACT;IACF;IAEA,kBAAkB;IAClB;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,OAAO,OAAO,CAAC,WAAW;YACpD,OAAO,MAAM,OAAO,IAAI;QAC1B;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,OAAO,OAAO,CAAC,WAAW;YACpD,OAAO,MAAM,OAAO,IAAI;QAC1B;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,OAAO,OAAO,CAAC,WAAW;YACpD,OAAO,MAAM,OAAO,YAAY;QAClC;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,OAAO,OAAO,CAAC,UAAU;YACnD,OAAO,MAAM,OAAO,YAAY;QAClC;IACF;IACA,4EAA4E;IAC5E,gEAAgE;IAChE,6CAA6C;IAE7C,sBAAsB;IACtB,yEAAyE;IACzE,0DAA0D;IAC1D;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,OAAO,OAAO,CAAC,WAAW;YACpD,OAAO,MAAM,QAAQ,MAAM,IAAI,YAAY;QAC7C;IAGF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,cAAc;QACd,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,WAAW;YACrC,OAAO,QAAQ,QAAQ,QAAQ,SAAS,QAAQ,UAAU,QAAQ;QACpE;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,OAAO,OAAO,CAAC,WAAW;YACpD,OAAO,MAAM,OAAO,YAAY;QAClC;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,OAAO,OAAO,CAAC,WAAW;YACpD,OAAO,MAAM,OAAO,YAAY;QAClC;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,OAAO,OAAO,CAAC,WAAW;YACpD,OAAO,MAAM,OAAO,YAAY;QAClC;IACF;IAEA,qBAAqB;IACrB;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,OAAO,OAAO,CAAC,WAAW;YACpD,OAAO,MAAM,OAAO,YAAY;QAClC;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,YAAY;YAAC;YAAK;SAAK;QACvB,aAAa;QACb,SAAS;QACT,cAAc;IAChB;IAEA,uBAAuB;IACvB;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,OAAO,OAAO,CAAC,WAAW;YACpD,OAAO,MAAM,OAAO,YAAY;QAClC;IACF;IAEA,yBAAyB;IACzB;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,IAAI;YAC9B,MAAM,QAAQ,IAAI,KAAK,CAAC;YACxB,IAAI,OAAO;gBACT,OAAO;oBACL,QAAQ,WAAW,KAAK,CAAC,EAAE;oBAC3B,OAAO,WAAW,KAAK,CAAC,EAAE;oBAC1B,QAAQ,WAAW,KAAK,CAAC,EAAE;gBAC7B;YACF;YACA,OAAO;QACT;QACA,iBAAiB,CAAC;YAChB,MAAM,OAAO;YACb,IAAI,QAAQ,OAAO,SAAS,YAAY,YAAY,MAAM;gBACxD,OAAO,GAAG,KAAK,MAAM,IAAI,EAAE,CAAC,EAAE,KAAK,KAAK,IAAI,EAAE,CAAC,EAAE,KAAK,MAAM,IAAI,GAAG;YACrE;YACA,OAAO;QACT;IACF;IAEA,gCAAgC;IAChC;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,IAAI;YAC9B,IAAI,CAAC,KAAK,OAAO;YACjB,oDAAoD;YACpD,OAAO,IAAI,KAAK,CAAC,KAAK,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,IAAI,MAAM,CAAC;QAClD;QACA,iBAAiB,CAAC;YAChB,MAAM,gBAAgB;YACtB,OAAO,eAAe,KAAK,SAAS;QACtC;IACF;IACA,2DAA2D;IAC3D;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,QAAQ;QACR,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,IAAI;YAC9B,OAAO,IAAI,KAAK,CAAC,QAAQ,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,IAAI,MAAM,CAAC;QACrD;QACA,iBAAiB,CAAC;YAChB,MAAM,OAAO;YACb,OAAO,MAAM,KAAK,SAAS;QAC7B;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,OAAO,OAAO,CAAC,WAAW;YACpD,OAAO,MAAM,QAAQ,OAAO,IAAI,YAAY;QAC9C;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,OAAO,OAAO,CAAC,WAAW;YACpD,OAAO,MAAM,QAAQ,OAAO,IAAI,YAAY;QAC9C;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IAEA,0BAA0B;IAC1B;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,OAAO,OAAO,CAAC,WAAW;YACpD,OAAO,MAAM,OAAO,YAAY;QAClC;IACF;IAEA,4BAA4B;IAC5B;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IAEA,4CAA4C;IAC5C,oDAAoD;IACpD;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,QAAQ;QACR,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,+BAA+B;YAC/B,OAAO,OAAO,OAAO,IAAI,GACtB,WAAW,GACX,SAAS,CAAC,OACV,OAAO,CAAC,oBAAoB,IAAI,oBAAoB;aACpD,OAAO,CAAC,MAAM,KACd,OAAO,CAAC,eAAe,KACvB,OAAO,CAAC,YAAY;QACzB;IACF;IACA,8BAA8B;IAC9B;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,+BAA+B;YAC/B,OAAO,OAAO,OAAO,IAAI,GACtB,WAAW,GACX,SAAS,CAAC,OACV,OAAO,CAAC,oBAAoB,IAAI,oBAAoB;aACpD,OAAO,CAAC,MAAM,KACd,OAAO,CAAC,eAAe,KACvB,OAAO,CAAC,YAAY;QACzB;IACF;IACA,mCAAmC;IACnC;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,+BAA+B;YAC/B,OAAO,OAAO,OAAO,IAAI,GACtB,WAAW,GACX,SAAS,CAAC,OACV,OAAO,CAAC,oBAAoB,IAAI,oBAAoB;aACpD,OAAO,CAAC,MAAM,KACd,OAAO,CAAC,eAAe,KACvB,OAAO,CAAC,YAAY;QACzB;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,cAAc;QACd,iBAAiB,CAAC;YAChB,IAAI,UAAU,aAAa,UAAU,QAAQ,UAAU,IAAI,OAAO;YAClE,MAAM,MAAM,OAAO,OAAO,WAAW,GAAG,IAAI;YAC5C,OAAO,QAAQ,QAAQ,QAAQ,SAAS,QAAQ,OAAO,QAAQ,UAAU,QAAQ;QACnF;QACA,iBAAiB,CAAC,QAAoB,QAAQ,OAAO;IACvD;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,cAAc;QACd,iBAAiB,CAAC;YAChB,IAAI,UAAU,aAAa,UAAU,QAAQ,UAAU,IAAI,OAAO;YAClE,MAAM,MAAM,OAAO,OAAO,WAAW,GAAG,IAAI;YAC5C,OAAO,QAAQ,QAAQ,QAAQ,SAAS,QAAQ,OAAO,QAAQ,UAAU,QAAQ;QACnF;QACA,iBAAiB,CAAC,QAAoB,QAAQ,OAAO;IACvD;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,cAAc;QACd,iBAAiB,CAAC;YAChB,IAAI,UAAU,aAAa,UAAU,QAAQ,UAAU,IAAI,OAAO;YAClE,MAAM,MAAM,OAAO,OAAO,WAAW,GAAG,IAAI;YAC5C,OAAO,QAAQ,QAAQ,QAAQ,SAAS,QAAQ,OAAO,QAAQ,UAAU,QAAQ;QACnF;QACA,iBAAiB,CAAC,QAAoB,QAAQ,OAAO;IACvD;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,cAAc;QACd,iBAAiB,CAAC;YAChB,IAAI,UAAU,aAAa,UAAU,QAAQ,UAAU,IAAI,OAAO;YAClE,MAAM,MAAM,OAAO,OAAO,WAAW,GAAG,IAAI;YAC5C,OAAO,QAAQ,QAAQ,QAAQ,SAAS,QAAQ,OAAO,QAAQ,UAAU,QAAQ;QACnF;QACA,iBAAiB,CAAC,QAAoB,QAAQ,OAAO;IACvD;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,cAAc;QACd,iBAAiB,CAAC;YAChB,IAAI,UAAU,aAAa,UAAU,QAAQ,UAAU,IAAI,OAAO;YAClE,MAAM,MAAM,OAAO,OAAO,WAAW,GAAG,IAAI;YAC5C,OAAO,QAAQ,QAAQ,QAAQ,SAAS,QAAQ,OAAO,QAAQ,UAAU,QAAQ;QACnF;QACA,iBAAiB,CAAC,QAAoB,QAAQ,OAAO;IACvD;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;QACT,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,OAAO,OAAO,CAAC,WAAW;YACpD,OAAO,MAAM,OAAO,YAAY;QAClC;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IAEA,iCAAiC;IACjC;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,QAAQ;QACR,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,OAAO,OAAO,CAAC,WAAW;YACpD,OAAO,MAAM,OAAO,YAAY;QAClC;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,QAAQ;QACR,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,OAAO,OAAO,CAAC,WAAW;YACpD,OAAO,MAAM,OAAO,YAAY;QAClC;IACF;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,QAAQ;IACV;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,QAAQ;QACR,iBAAiB,CAAC;YAChB,IAAI,CAAC,OAAO,OAAO;YACnB,MAAM,MAAM,OAAO,OAAO,OAAO,OAAO,CAAC,WAAW;YACpD,OAAO,MAAM,OAAO,YAAY;QAClC;IACF;IAEA,gCAAgC;IAChC;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,QAAQ;IACV;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,SAAS;IACX;IAEA,gCAAgC;IAChC;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,QAAQ;IACV;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,QAAQ;IACV;IACA;QACE,KAAK;QACL,OAAO;QACP,UAAU;QACV,MAAM;QACN,aAAa;QACb,QAAQ;IACV;CACD;AAGM,MAAM,4BAAyD;IACpE,YAAY;IACZ,mBAAmB;IACnB,QAAQ;IACR,WAAW;IACX,kBAAkB;IAClB,eAAe;IAEf,0EAA0E;IAC1E,oBAAoB,CAAC;QACnB,MAAM,aAAsC,CAAC;QAC7C,MAAM,SAAiC,CAAC;QAExC,mCAAmC;QACnC,MAAM,aAAqC,CAAC;QAC5C,cAAc,OAAO,CAAC,CAAA;YACpB,UAAU,CAAC,MAAM,KAAK,CAAC,WAAW,GAAG,GAAG,MAAM,GAAG;YACjD,8BAA8B;YAC9B,MAAM,mBAAmB,MAAM,KAAK,CAAC,OAAO,CAAC,iBAAiB,IAAI,WAAW;YAC7E,UAAU,CAAC,iBAAiB,GAAG,MAAM,GAAG;QAC1C;QAEA,OAAO,OAAO,CAAC,QAAQ,OAAO,CAAC,CAAC,CAAC,KAAK,MAAM;YAC1C,yDAAyD;YACzD,MAAM,wBAAwB,IAAI,OAAO,CAAC,iBAAiB,IAAI,WAAW;YAE1E,0EAA0E;YAC1E,MAAM,iBAAiB,yBAAyB;YAChD,IAAI,kBAAkB,UAAU,aAAa,UAAU,QAAQ,UAAU,IAAI;gBAC3E,+CAA+C;gBAC/C,MAAM,aAAa,OAAO,OAAO,OAAO,OAAO,CAAC,WAAW;gBAC3D,IAAI,CAAC,MAAM,eAAe,aAAa,GAAG;oBACxC,MAAM,CAAC,eAAe,GAAG;gBAC3B;YACF,OAAO;gBACL,4BAA4B;gBAC5B,MAAM,gBAAgB,UAAU,CAAC,sBAAsB,IAAI,UAAU,CAAC,IAAI,WAAW,GAAG,IAAI;gBAC5F,UAAU,CAAC,cAAc,GAAG;YAC9B;QACF;QAEA,+CAA+C;QAC/C,IAAI,OAAO,IAAI,CAAC,QAAQ,MAAM,GAAG,GAAG;YAClC,WAAW,MAAM,GAAG;QACtB;QAEA,OAAO;IACT;IAEA,iDAAiD;IACjD,6EAA6E;IAC7E,kBAAkB,CAAC,KAAmD,QAAiB;QACrF,4EAA4E;QAC5E,IAAI,oBAAoB,IAAI,iBAAiB,IAAI,CAAC;QAClD,MAAM,eAAe,AAAC,IAAkC,YAAY;QAEpE,IAAI,iBAAiB,aAAa,eAAe,KAAK,gBAAgB;YACpE,oBAAoB;gBAClB,GAAG,iBAAiB;gBACpB,CAAC,eAAe,EAAE;YACpB;QACF;QAEA,8DAA8D;QAC9D,MAAM,EAAE,cAAc,QAAQ,EAAE,GAAG,UAAU,GAAG;QAEhD,2CAA2C;QAC3C,6DAA6D;QAC7D,IAAI,yBAAyB,SAAS,mBAAmB;QACzD,IAAI,CAAC,0BAA0B,SAAS,IAAI,EAAE;YAC5C,4CAA4C;YAC5C,yBAAyB,iCAAiC,SAAS,IAAI,KAAK;QAC9E;QACA,IAAI,CAAC,wBAAwB;YAC3B,oCAAoC;YACpC,yBAAyB,mCAAmC;QAC9D;QAEA,sCAAsC;QACtC,MAAM,sBAAsB,yBAAyB,IAAA,mIAAU,EAAC,0BAA0B;QAE1F,OAAO;YACL,GAAG,QAAQ;YACX,MAAM,SAAS,IAAI,IAAI;YACvB;YACA,QAAQ,SAAS,MAAM,IAAI;YAC3B,MAAM,SAAS,IAAI,IAAI;YACvB,WAAW,SAAS,SAAS,IAAI;YACjC,cAAc,SAAS,YAAY,IAAI;YACvC,gBAAgB,SAAS,cAAc,IAAI;YAC3C,QAAQ,SAAS,MAAM,IAAI,CAAC;YAC5B;YACA,mBAAmB,SAAS,iBAAiB,IAAI,CAAC;YAClD,mBAAmB,SAAS,iBAAiB,IAAI,CAAC;QACpD;IACF;IAEA,8DAA8D;IAC9D,aAAa,CAAC,KAAK,QAAQ,cAAc;QACvC,MAAM,SAAiF,EAAE;QACzF,MAAM,sBAAsB;QAE5B,8CAA8C;QAC9C,IAAI,IAAI,GAAG,IAAI,SAAS,eAAe;YACrC,MAAM,YAAY,aAAa,IAAI,CACjC,CAAA,IAAK,EAAE,GAAG,KAAK,IAAI,GAAG,IAAI,EAAE,EAAE,KAAK,IAAI,EAAE;YAE3C,IAAI,WAAW;gBACb,OAAO,IAAI,CAAC;oBACV,OAAO;oBACP,SAAS,CAAC,wBAAwB,EAAE,UAAU,IAAI,CAAC,EAAE,EAAE,UAAU,EAAE,CAAC,CAAC,CAAC;gBACxE;YACF;QACF;QAEA,kDAAkD;QAClD,IAAI,IAAI,OAAO,IAAI,SAAS,eAAe;YACzC,MAAM,YAAY,aAAa,IAAI,CACjC,CAAA,IAAK,EAAE,OAAO,KAAK,IAAI,OAAO,IAAI,EAAE,EAAE,KAAK,IAAI,EAAE;YAEnD,IAAI,WAAW;gBACb,OAAO,IAAI,CAAC;oBACV,OAAO;oBACP,SAAS,CAAC,4BAA4B,EAAE,UAAU,IAAI,CAAC,EAAE,EAAE,UAAU,EAAE,CAAC,CAAC,CAAC;gBAC5E;YACF;QACF;QAEA,qDAAqD;QACrD,IAAI,oBAAoB,YAAY,KAAK,aAAa,oBAAoB,YAAY,GAAG,GAAG;YAC1F,IAAI,SAAS,eAAe;gBAC1B,OAAO,IAAI,CAAC;oBACV,OAAO;oBACP,SAAS;oBACT,MAAM;gBACR;YACF,OAAO,IAAI,SAAS,UAAU;gBAC5B,0BAA0B;gBAC1B,MAAM,SAAS,aAAa,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,IAAI,EAAE;gBACrD,IAAI,QAAQ;oBACV,OAAO,IAAI,CAAC;wBACV,OAAO;wBACP,SAAS,CAAC,uEAAuE,CAAC;wBAClF,MAAM;oBACR;gBACF;YACF;QACF;QAEA,6BAA6B;QAC7B,IAAI,IAAI,SAAS,IAAI,IAAI,YAAY,IAAI,IAAI,SAAS,GAAG,IAAI,YAAY,EAAE;YACzE,OAAO,IAAI,CAAC;gBACV,OAAO;gBACP,SAAS,CAAC,SAAS,EAAE,IAAI,YAAY,EAAE,iBAAiB,oBAAoB,EAAE,IAAI,SAAS,EAAE,iBAAiB,CAAC,CAAC;gBAChH,MAAM;YACR;QACF;QAEA,OAAO;IACT;AACF;uCAGe"}},
    {"offset": {"line": 5810, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/import-export/configs/brand.config.ts"],"sourcesContent":["import type { Brand } from '@/features/settings/inventory/types';\r\nimport type { ImportExportConfig, FieldConfig } from '../types';\r\n\r\n/**\r\n * Brand Import/Export Configuration\r\n * Theo chu·∫©n ImportExportConfig ƒë·ªÉ d√πng v·ªõi GenericImportDialogV2 v√† GenericExportDialogV2\r\n */\r\n\r\n// Field definitions for Brand import/export\r\nexport const brandFields: FieldConfig<Brand>[] = [\r\n  // === Basic Info ===\r\n  {\r\n    key: 'id',\r\n    label: 'M√£ th∆∞∆°ng hi·ªáu (*)',\r\n    type: 'string',\r\n    required: true,\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    exportable: true,\r\n    example: 'BRAND001',\r\n    validator: (value) => {\r\n      if (!value || String(value).trim() === '') {\r\n        return 'M√£ th∆∞∆°ng hi·ªáu l√† b·∫Øt bu·ªôc';\r\n      }\r\n      return null;\r\n    }\r\n  },\r\n  {\r\n    key: 'name',\r\n    label: 'T√™n th∆∞∆°ng hi·ªáu (*)',\r\n    type: 'string',\r\n    required: true,\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    exportable: true,\r\n    example: 'Apple',\r\n    validator: (value) => {\r\n      if (!value || String(value).trim() === '') {\r\n        return 'T√™n th∆∞∆°ng hi·ªáu l√† b·∫Øt bu·ªôc';\r\n      }\r\n      return null;\r\n    }\r\n  },\r\n  {\r\n    key: 'description',\r\n    label: 'M√¥ t·∫£',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    exportable: true,\r\n    example: 'Th∆∞∆°ng hi·ªáu c√¥ng ngh·ªá h√†ng ƒë·∫ßu th·∫ø gi·ªõi',\r\n  },\r\n  {\r\n    key: 'website',\r\n    label: 'Website',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    exportable: true,\r\n    example: 'https://www.apple.com',\r\n    validator: (value) => {\r\n      if (value && typeof value === 'string') {\r\n        const trimmed = value.trim();\r\n        if (trimmed && !trimmed.match(/^https?:\\/\\/.+/i)) {\r\n          return 'Website ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng http:// ho·∫∑c https://';\r\n        }\r\n      }\r\n      return null;\r\n    }\r\n  },\r\n  {\r\n    key: 'logo',\r\n    label: 'Logo URL',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    exportable: true,\r\n    example: 'https://example.com/logo.png',\r\n  },\r\n  \r\n  // === SEO Fields ===\r\n  {\r\n    key: 'seoTitle',\r\n    label: 'SEO Title',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'SEO & M√¥ t·∫£',\r\n    exportable: true,\r\n    example: 'Apple - Th∆∞∆°ng hi·ªáu c√¥ng ngh·ªá cao c·∫•p',\r\n  },\r\n  {\r\n    key: 'metaDescription',\r\n    label: 'Meta Description',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'SEO & M√¥ t·∫£',\r\n    exportable: true,\r\n    example: 'Apple Inc. l√† t·∫≠p ƒëo√†n c√¥ng ngh·ªá ƒëa qu·ªëc gia...',\r\n  },\r\n  {\r\n    key: 'seoKeywords',\r\n    label: 'SEO Keywords',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'SEO & M√¥ t·∫£',\r\n    exportable: true,\r\n    example: 'apple, iphone, macbook, c√¥ng ngh·ªá',\r\n  },\r\n  {\r\n    key: 'shortDescription',\r\n    label: 'M√¥ t·∫£ ng·∫Øn',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'SEO & M√¥ t·∫£',\r\n    exportable: true,\r\n    example: 'Th∆∞∆°ng hi·ªáu c√¥ng ngh·ªá h√†ng ƒë·∫ßu t·ª´ M·ªπ',\r\n  },\r\n  {\r\n    key: 'longDescription',\r\n    label: 'M√¥ t·∫£ chi ti·∫øt',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'SEO & M√¥ t·∫£',\r\n    exportable: true,\r\n    example: '<p>Apple Inc. ƒë∆∞·ª£c th√†nh l·∫≠p nƒÉm 1976...</p>',\r\n  },\r\n  \r\n  // === Settings ===\r\n  {\r\n    key: 'isActive',\r\n    label: 'Tr·∫°ng th√°i',\r\n    type: 'boolean',\r\n    required: false,\r\n    exportGroup: 'C√†i ƒë·∫∑t',\r\n    exportable: true,\r\n    example: 'Ho·∫°t ƒë·ªông',\r\n    importTransform: (value) => {\r\n      if (typeof value === 'boolean') return value;\r\n      if (typeof value === 'number') return value === 1;\r\n      const strValue = String(value).toLowerCase().trim();\r\n      return strValue === 'true' || strValue === '1' || strValue === 'ho·∫°t ƒë·ªông' || strValue === 'hoat dong' || strValue === 'c√≥' || strValue === 'co' || strValue === 'yes' || strValue === 'active';\r\n    },\r\n    exportTransform: (value) => value ? 'Ho·∫°t ƒë·ªông' : 'Ng·ª´ng'\r\n  },\r\n];\r\n\r\n// Group labels for UI organization\r\nexport const brandFieldGroups = {\r\n  'Th√¥ng tin c∆° b·∫£n': 'Th√¥ng tin c∆° b·∫£n',\r\n  'SEO & M√¥ t·∫£': 'SEO & M√¥ t·∫£',\r\n  'C√†i ƒë·∫∑t': 'C√†i ƒë·∫∑t',\r\n} as const;\r\n\r\n// Full config object\r\nexport const brandImportExportConfig: ImportExportConfig<Brand> = {\r\n  entityType: 'brands',\r\n  entityDisplayName: 'Th∆∞∆°ng hi·ªáu',\r\n  fields: brandFields,\r\n  \r\n  // Template file\r\n  templateFileName: 'Mau_Nhap_Thuong_Hieu.xlsx',\r\n  sheetName: 'Th∆∞∆°ng hi·ªáu',\r\n  \r\n  // Upsert config - d√πng id l√†m key\r\n  upsertKey: 'id',\r\n  allowUpdate: true,\r\n  allowInsert: true,\r\n  \r\n  // Max rows\r\n  maxRows: 500,\r\n  \r\n  // Row-level transform after all field transforms\r\n  postTransformRow: (row: Partial<Brand>) => {\r\n    // Ensure isActive defaults to true for new brands\r\n    if (row.isActive === undefined) {\r\n      row.isActive = true;\r\n    }\r\n    return row;\r\n  },\r\n  \r\n  // Validate entire row\r\n  validateRow: (row: Brand, _index: number, _existingData: Brand[], _mode) => {\r\n    const errors: Array<{ field?: string; message: string }> = [];\r\n    \r\n    if (!row.id || String(row.id).trim() === '') {\r\n      errors.push({ field: 'id', message: 'M√£ th∆∞∆°ng hi·ªáu l√† b·∫Øt bu·ªôc' });\r\n    }\r\n    \r\n    if (!row.name || String(row.name).trim() === '') {\r\n      errors.push({ field: 'name', message: 'T√™n th∆∞∆°ng hi·ªáu l√† b·∫Øt bu·ªôc' });\r\n    }\r\n    \r\n    return errors;\r\n  }\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6001, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/import-export/configs/category.config.ts"],"sourcesContent":["import type { ProductCategory } from '@/features/settings/inventory/types';\r\nimport type { ImportExportConfig, FieldConfig } from '../types';\r\nimport { useProductCategoryStore } from '@/features/settings/inventory/product-category-store';\r\n\r\n/**\r\n * Product Category Import/Export Configuration\r\n * Theo chu·∫©n ImportExportConfig ƒë·ªÉ d√πng v·ªõi GenericImportDialogV2 v√† GenericExportDialogV2\r\n */\r\n\r\n// ===== CATEGORY HELPERS =====\r\n// Helper: Get all categories for parent lookup\r\nconst getAllCategories = () => {\r\n  return useProductCategoryStore.getState().data.filter(c => !c.isDeleted);\r\n};\r\n\r\n// Helper: Get parent category systemId from name or path\r\nconst getParentCategorySystemId = (value: string): string | null => {\r\n  if (!value || String(value).trim() === '') return null;\r\n  \r\n  const categories = getAllCategories();\r\n  const normalizedValue = String(value).trim().toLowerCase();\r\n  \r\n  // Try exact match by name first\r\n  const byName = categories.find(c => \r\n    c.name.toLowerCase() === normalizedValue ||\r\n    c.id.toLowerCase() === normalizedValue\r\n  );\r\n  if (byName) return byName.systemId;\r\n  \r\n  // Try match by path (e.g., \"ƒêi·ªán t·ª≠ > M√°y t√≠nh\")\r\n  const byPath = categories.find(c => \r\n    c.path?.toLowerCase() === normalizedValue\r\n  );\r\n  if (byPath) return byPath.systemId;\r\n  \r\n  return null;\r\n};\r\n\r\n// Helper: Get parent category display name from systemId\r\nconst getParentCategoryName = (systemId: string | undefined): string => {\r\n  if (!systemId) return '';\r\n  const categories = getAllCategories();\r\n  const parent = categories.find(c => c.systemId === systemId);\r\n  return parent?.name || '';\r\n};\r\n\r\n// Field definitions for ProductCategory import/export\r\nexport const categoryFields: FieldConfig<ProductCategory>[] = [\r\n  // === Basic Info ===\r\n  {\r\n    key: 'id',\r\n    label: 'M√£ danh m·ª•c (*)',\r\n    type: 'string',\r\n    required: true,\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    exportable: true,\r\n    example: 'CAT001',\r\n    validator: (value) => {\r\n      if (!value || String(value).trim() === '') {\r\n        return 'M√£ danh m·ª•c l√† b·∫Øt bu·ªôc';\r\n      }\r\n      return null;\r\n    }\r\n  },\r\n  {\r\n    key: 'name',\r\n    label: 'T√™n danh m·ª•c (*)',\r\n    type: 'string',\r\n    required: true,\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    exportable: true,\r\n    example: 'ƒêi·ªán tho·∫°i',\r\n    validator: (value) => {\r\n      if (!value || String(value).trim() === '') {\r\n        return 'T√™n danh m·ª•c l√† b·∫Øt bu·ªôc';\r\n      }\r\n      return null;\r\n    }\r\n  },\r\n  {\r\n    key: 'slug',\r\n    label: 'Slug',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'Th√¥ng tin c∆° b·∫£n',\r\n    exportable: true,\r\n    example: 'dien-thoai',\r\n  },\r\n  \r\n  // === Hierarchy ===\r\n  {\r\n    key: 'parentId',\r\n    label: 'Danh m·ª•c cha',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'Ph√¢n c·∫•p',\r\n    exportable: true,\r\n    example: 'ƒêi·ªán t·ª≠',\r\n    importTransform: (value) => {\r\n      if (!value) return undefined;\r\n      const systemId = getParentCategorySystemId(String(value));\r\n      return systemId || undefined;\r\n    },\r\n    exportTransform: (value) => {\r\n      // Value is the parentId systemId\r\n      return getParentCategoryName(value as string);\r\n    }\r\n  },\r\n  {\r\n    key: 'path',\r\n    label: 'ƒê∆∞·ªùng d·∫´n',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'Ph√¢n c·∫•p',\r\n    exportable: true,\r\n    hidden: true, // Don't show in import (auto-generated)\r\n    example: 'ƒêi·ªán t·ª≠ > ƒêi·ªán tho·∫°i',\r\n  },\r\n  {\r\n    key: 'level',\r\n    label: 'C·∫•p ƒë·ªô',\r\n    type: 'number',\r\n    required: false,\r\n    exportGroup: 'Ph√¢n c·∫•p',\r\n    exportable: true,\r\n    hidden: true, // Don't show in import (auto-calculated)\r\n    example: '1',\r\n  },\r\n  \r\n  // === Display ===\r\n  {\r\n    key: 'color',\r\n    label: 'M√†u s·∫Øc',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'Hi·ªÉn th·ªã',\r\n    exportable: true,\r\n    example: '#3b82f6',\r\n  },\r\n  {\r\n    key: 'icon',\r\n    label: 'Icon',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'Hi·ªÉn th·ªã',\r\n    exportable: true,\r\n    example: 'üì±',\r\n  },\r\n  {\r\n    key: 'thumbnailImage',\r\n    label: '·∫¢nh ƒë·∫°i di·ªán',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'Hi·ªÉn th·ªã',\r\n    exportable: true,\r\n    example: 'https://example.com/category.jpg',\r\n  },\r\n  {\r\n    key: 'sortOrder',\r\n    label: 'Th·ª© t·ª±',\r\n    type: 'number',\r\n    required: false,\r\n    exportGroup: 'Hi·ªÉn th·ªã',\r\n    exportable: true,\r\n    example: '1',\r\n    importTransform: (value) => {\r\n      if (value === undefined || value === null || value === '') return 0;\r\n      const num = Number(value);\r\n      return isNaN(num) ? 0 : num;\r\n    }\r\n  },\r\n  \r\n  // === SEO Fields ===\r\n  {\r\n    key: 'seoTitle',\r\n    label: 'SEO Title',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'SEO & M√¥ t·∫£',\r\n    exportable: true,\r\n    example: 'ƒêi·ªán tho·∫°i ch√≠nh h√£ng - Gi√° t·ªët nh·∫•t',\r\n  },\r\n  {\r\n    key: 'metaDescription',\r\n    label: 'Meta Description',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'SEO & M√¥ t·∫£',\r\n    exportable: true,\r\n    example: 'Mua ƒëi·ªán tho·∫°i ch√≠nh h√£ng gi√° t·ªët nh·∫•t...',\r\n  },\r\n  {\r\n    key: 'seoKeywords',\r\n    label: 'SEO Keywords',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'SEO & M√¥ t·∫£',\r\n    exportable: true,\r\n    example: 'ƒëi·ªán tho·∫°i, smartphone, iphone, samsung',\r\n  },\r\n  {\r\n    key: 'shortDescription',\r\n    label: 'M√¥ t·∫£ ng·∫Øn',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'SEO & M√¥ t·∫£',\r\n    exportable: true,\r\n    example: 'Danh m·ª•c ƒëi·ªán tho·∫°i di ƒë·ªông c√°c h√£ng',\r\n  },\r\n  {\r\n    key: 'longDescription',\r\n    label: 'M√¥ t·∫£ chi ti·∫øt',\r\n    type: 'string',\r\n    required: false,\r\n    exportGroup: 'SEO & M√¥ t·∫£',\r\n    exportable: true,\r\n    example: '<p>ƒêi·ªán tho·∫°i di ƒë·ªông t·ª´ c√°c th∆∞∆°ng hi·ªáu...</p>',\r\n  },\r\n  \r\n  // === Settings ===\r\n  {\r\n    key: 'isActive',\r\n    label: 'Tr·∫°ng th√°i',\r\n    type: 'boolean',\r\n    required: false,\r\n    exportGroup: 'C√†i ƒë·∫∑t',\r\n    exportable: true,\r\n    example: 'Ho·∫°t ƒë·ªông',\r\n    importTransform: (value) => {\r\n      if (typeof value === 'boolean') return value;\r\n      if (typeof value === 'number') return value === 1;\r\n      const strValue = String(value).toLowerCase().trim();\r\n      return strValue === 'true' || strValue === '1' || strValue === 'ho·∫°t ƒë·ªông' || strValue === 'hoat dong' || strValue === 'c√≥' || strValue === 'co' || strValue === 'yes' || strValue === 'active';\r\n    },\r\n    exportTransform: (value) => value ? 'Ho·∫°t ƒë·ªông' : 'Ng·ª´ng'\r\n  },\r\n];\r\n\r\n// Group labels for UI organization\r\nexport const categoryFieldGroups = {\r\n  'Th√¥ng tin c∆° b·∫£n': 'Th√¥ng tin c∆° b·∫£n',\r\n  'Ph√¢n c·∫•p': 'Ph√¢n c·∫•p',\r\n  'Hi·ªÉn th·ªã': 'Hi·ªÉn th·ªã',\r\n  'SEO & M√¥ t·∫£': 'SEO & M√¥ t·∫£',\r\n  'C√†i ƒë·∫∑t': 'C√†i ƒë·∫∑t',\r\n} as const;\r\n\r\n// Full config object\r\nexport const categoryImportExportConfig: ImportExportConfig<ProductCategory> = {\r\n  entityType: 'categories',\r\n  entityDisplayName: 'Danh m·ª•c s·∫£n ph·∫©m',\r\n  fields: categoryFields,\r\n  \r\n  // Template file\r\n  templateFileName: 'Mau_Nhap_Danh_Muc.xlsx',\r\n  sheetName: 'Danh m·ª•c',\r\n  \r\n  // Upsert config - d√πng id l√†m key\r\n  upsertKey: 'id',\r\n  allowUpdate: true,\r\n  allowInsert: true,\r\n  \r\n  // Max rows\r\n  maxRows: 500,\r\n  \r\n  // Row-level transform after all field transforms\r\n  postTransformRow: (row: Partial<ProductCategory>) => {\r\n    // Ensure isActive defaults to true for new categories\r\n    if (row.isActive === undefined) {\r\n      row.isActive = true;\r\n    }\r\n    \r\n    // Default sortOrder to 0\r\n    if (row.sortOrder === undefined) {\r\n      row.sortOrder = 0;\r\n    }\r\n    \r\n    // Generate slug from name if not provided\r\n    if (!row.slug && row.name) {\r\n      row.slug = String(row.name)\r\n        .toLowerCase()\r\n        .normalize('NFD')\r\n        .replace(/[\\u0300-\\u036f]/g, '') // Remove diacritics\r\n        .replace(/ƒë/g, 'd')\r\n        .replace(/ƒê/g, 'D')\r\n        .replace(/[^a-z0-9\\s-]/g, '')\r\n        .replace(/\\s+/g, '-')\r\n        .replace(/-+/g, '-')\r\n        .trim();\r\n    }\r\n    \r\n    return row;\r\n  },\r\n  \r\n  // Validate entire row\r\n  validateRow: (row: ProductCategory, _index: number, _existingData: ProductCategory[], _mode) => {\r\n    const errors: Array<{ field?: string; message: string }> = [];\r\n    \r\n    if (!row.id || String(row.id).trim() === '') {\r\n      errors.push({ field: 'id', message: 'M√£ danh m·ª•c l√† b·∫Øt bu·ªôc' });\r\n    }\r\n    \r\n    if (!row.name || String(row.name).trim() === '') {\r\n      errors.push({ field: 'name', message: 'T√™n danh m·ª•c l√† b·∫Øt bu·ªôc' });\r\n    }\r\n    \r\n    return errors;\r\n  }\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6287, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/breadcrumb-generator.ts"],"sourcesContent":["/**\r\n * üçû BREADCRUMB AUTO-GENERATION SYSTEM\r\n * \r\n * Automatically generates breadcrumbs from route metadata + entity data\r\n * \r\n * Features:\r\n * - Auto-lookup entity name from systemId\r\n * - Falls back to route metadata if entity not found\r\n * - Type-safe with SystemId branded types\r\n * - Supports all entity types from id-config.ts\r\n * \r\n * @example\r\n * ```typescript\r\n * // Route: /receipts/VOUCHER00000123\r\n * const crumbs = generateBreadcrumb(location.pathname);\r\n * // Result: ['Phi·∫øu thu/chi', 'PT000051']\r\n * ```\r\n * \r\n * @version 1.0.0\r\n * @date 2025-11-11\r\n */\r\n\r\nimport { type EntityType, getEntityConfig } from './id-config';\r\nimport { type SystemId } from './id-config';\r\n\r\n// Store registry - lazy loaded to avoid circular dependencies\r\ntype StoreGetter<T> = () => { data: T[] };\r\n\r\ninterface StoreRegistry {\r\n  [key: string]: StoreGetter<any>;\r\n}\r\n\r\nlet storeRegistry: StoreRegistry = {};\r\n\r\n/**\r\n * Register a store for breadcrumb lookup\r\n * Call this in store files to enable auto breadcrumb\r\n */\r\nexport function registerBreadcrumbStore<T extends { systemId: string; id?: string; name?: string }>(\r\n  entityType: EntityType,\r\n  getStore: StoreGetter<T>\r\n) {\r\n  storeRegistry[entityType] = getStore;\r\n}\r\n\r\n/**\r\n * Find entity by systemId and return display name\r\n */\r\nfunction findEntityDisplayName(entityType: EntityType, systemId: string): string | null {\r\n  const getStore = storeRegistry[entityType];\r\n  if (!getStore) return null;\r\n\r\n  try {\r\n    const store = getStore();\r\n    const item = store.data.find((d: any) => d.systemId === systemId);\r\n    \r\n    if (!item) return null;\r\n\r\n    // Priority: name > title > id (business ID) > systemId\r\n    return item.name || item.title || item.id || systemId;\r\n  } catch (error) {\r\n    console.warn(`[Breadcrumb] Failed to lookup ${entityType}:`, error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Parse route path and extract entity info\r\n */\r\ninterface RouteEntityInfo {\r\n  entityType: EntityType | null;\r\n  systemId: string | null;\r\n  displayName: string | null;\r\n}\r\n\r\nfunction parseRouteEntity(pathname: string): RouteEntityInfo {\r\n  // Pattern: /{entity-type}/{systemId}\r\n  const match = pathname.match(/^\\/([^/]+)\\/([^/]+)$/);\r\n  \r\n  if (!match) {\r\n    return { entityType: null, systemId: null, displayName: null };\r\n  }\r\n\r\n  const [, routeType, id] = match;\r\n  \r\n  // Map route type to entity type\r\n  const routeToEntityMap: Record<string, EntityType> = {\r\n    'receipts': 'voucher-receipt',\r\n    'payments': 'voucher-payment',\r\n    'employees': 'employees',\r\n    'customers': 'customers',\r\n    'products': 'products',\r\n    'orders': 'orders',\r\n    'suppliers': 'suppliers',\r\n    'complaints': 'complaints',\r\n    'warranty': 'warranty',\r\n    'purchase-orders': 'purchase-orders',\r\n    'sales-returns': 'sales-returns',\r\n    'purchase-returns': 'purchase-returns',\r\n    'inventory-checks': 'inventory-checks',\r\n  };\r\n\r\n  const entityType = routeToEntityMap[routeType] || null;\r\n  \r\n  if (!entityType) {\r\n    return { entityType: null, systemId: id, displayName: null };\r\n  }\r\n\r\n  // Lookup display name\r\n  const displayName = findEntityDisplayName(entityType, id);\r\n  \r\n  return { entityType, systemId: id, displayName };\r\n}\r\n\r\n/**\r\n * Generate breadcrumb trail from pathname\r\n * \r\n * @param pathname - Current route pathname\r\n * @param routeMeta - Optional route metadata with static breadcrumb\r\n * @returns Array of breadcrumb labels\r\n */\r\nexport function generateBreadcrumb(\r\n  pathname: string,\r\n  routeMeta?: { breadcrumb?: string[] }\r\n): string[] {\r\n  // If route has static breadcrumb metadata, use it as base\r\n  const baseCrumbs = routeMeta?.breadcrumb || [];\r\n  \r\n  // Try to enhance with entity data\r\n  const entityInfo = parseRouteEntity(pathname);\r\n  \r\n  if (entityInfo.displayName) {\r\n    // Replace last breadcrumb with entity display name\r\n    return [...baseCrumbs.slice(0, -1), entityInfo.displayName];\r\n  }\r\n  \r\n  // Fallback to route metadata\r\n  return baseCrumbs;\r\n}\r\n\r\n/**\r\n * Generate breadcrumb for detail page\r\n * \r\n * @example\r\n * ```typescript\r\n * // In voucher detail page (phi·∫øu chi)\r\n * const crumbs = generateDetailBreadcrumb('voucher-payment', voucher.systemId, 'Phi·∫øu thu/chi');\r\n * // Result: ['Phi·∫øu thu/chi', 'PT000051']\r\n * ```\r\n */\r\nexport function generateDetailBreadcrumb(\r\n  entityType: EntityType,\r\n  systemId: string,\r\n  listPageLabel: string\r\n): string[] {\r\n  const displayName = findEntityDisplayName(entityType, systemId);\r\n  return [listPageLabel, displayName || systemId];\r\n}\r\n\r\n/**\r\n * Generate breadcrumb for form page (create/edit)\r\n * \r\n * @example\r\n * ```typescript\r\n * const crumbs = generateFormBreadcrumb('employees', employeeSystemId, 'Nh√¢n vi√™n');\r\n * // Create: ['Nh√¢n vi√™n', 'Th√™m m·ªõi']\r\n * // Edit: ['Nh√¢n vi√™n', 'NV000001']\r\n * ```\r\n */\r\nexport function generateFormBreadcrumb(\r\n  entityType: EntityType,\r\n  systemId: string | null | undefined,\r\n  listPageLabel: string\r\n): string[] {\r\n  if (!systemId) {\r\n    return [listPageLabel, 'Th√™m m·ªõi'];\r\n  }\r\n  \r\n  const displayName = findEntityDisplayName(entityType, systemId);\r\n  return [listPageLabel, displayName || 'Ch·ªânh s·ª≠a'];\r\n}\r\n\r\n/**\r\n * Hook for breadcrumb in React components\r\n * \r\n * @example\r\n * ```typescript\r\n * function EmployeeDetailPage() {\r\n *   const { systemId } = useParams();\r\n *   const crumbs = useBreadcrumb('employees', systemId, 'Nh√¢n vi√™n');\r\n *   usePageHeader({ breadcrumb: crumbs });\r\n * }\r\n * ```\r\n */\r\nexport function useBreadcrumb(\r\n  entityType: EntityType,\r\n  systemId: string | null | undefined,\r\n  listPageLabel: string\r\n): string[] {\r\n  if (!systemId) {\r\n    return [listPageLabel, 'Th√™m m·ªõi'];\r\n  }\r\n  \r\n  return generateDetailBreadcrumb(entityType, systemId, listPageLabel);\r\n}\r\n\r\n/**\r\n * Get entity config for breadcrumb display\r\n */\r\nexport function getEntityDisplayInfo(entityType: EntityType) {\r\n  try {\r\n    const config = getEntityConfig(entityType);\r\n    return {\r\n      displayName: config.displayName,\r\n      prefix: config.prefix,\r\n      category: config.category,\r\n    };\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Clear store registry (for testing)\r\n */\r\nexport function clearBreadcrumbStores() {\r\n  storeRegistry = {};\r\n}\r\n\r\n/**\r\n * Get all registered stores (for debugging)\r\n */\r\nexport function getRegisteredStores(): string[] {\r\n  return Object.keys(storeRegistry);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;CAoBC,GAED;;AAUA,IAAI,gBAA+B,CAAC;AAM7B,SAAS,wBACd,UAAsB,EACtB,QAAwB;IAExB,aAAa,CAAC,WAAW,GAAG;AAC9B;AAEA;;CAEC,GACD,SAAS,sBAAsB,UAAsB,EAAE,QAAgB;IACrE,MAAM,WAAW,aAAa,CAAC,WAAW;IAC1C,IAAI,CAAC,UAAU,OAAO;IAEtB,IAAI;QACF,MAAM,QAAQ;QACd,MAAM,OAAO,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,IAAW,EAAE,QAAQ,KAAK;QAExD,IAAI,CAAC,MAAM,OAAO;QAElB,uDAAuD;QACvD,OAAO,KAAK,IAAI,IAAI,KAAK,KAAK,IAAI,KAAK,EAAE,IAAI;IAC/C,EAAE,OAAO,OAAO;QACd,QAAQ,IAAI,CAAC,CAAC,8BAA8B,EAAE,WAAW,CAAC,CAAC,EAAE;QAC7D,OAAO;IACT;AACF;AAWA,SAAS,iBAAiB,QAAgB;IACxC,qCAAqC;IACrC,MAAM,QAAQ,SAAS,KAAK,CAAC;IAE7B,IAAI,CAAC,OAAO;QACV,OAAO;YAAE,YAAY;YAAM,UAAU;YAAM,aAAa;QAAK;IAC/D;IAEA,MAAM,GAAG,WAAW,GAAG,GAAG;IAE1B,gCAAgC;IAChC,MAAM,mBAA+C;QACnD,YAAY;QACZ,YAAY;QACZ,aAAa;QACb,aAAa;QACb,YAAY;QACZ,UAAU;QACV,aAAa;QACb,cAAc;QACd,YAAY;QACZ,mBAAmB;QACnB,iBAAiB;QACjB,oBAAoB;QACpB,oBAAoB;IACtB;IAEA,MAAM,aAAa,gBAAgB,CAAC,UAAU,IAAI;IAElD,IAAI,CAAC,YAAY;QACf,OAAO;YAAE,YAAY;YAAM,UAAU;YAAI,aAAa;QAAK;IAC7D;IAEA,sBAAsB;IACtB,MAAM,cAAc,sBAAsB,YAAY;IAEtD,OAAO;QAAE;QAAY,UAAU;QAAI;IAAY;AACjD;AASO,SAAS,mBACd,QAAgB,EAChB,SAAqC;IAErC,0DAA0D;IAC1D,MAAM,aAAa,WAAW,cAAc,EAAE;IAE9C,kCAAkC;IAClC,MAAM,aAAa,iBAAiB;IAEpC,IAAI,WAAW,WAAW,EAAE;QAC1B,mDAAmD;QACnD,OAAO;eAAI,WAAW,KAAK,CAAC,GAAG,CAAC;YAAI,WAAW,WAAW;SAAC;IAC7D;IAEA,6BAA6B;IAC7B,OAAO;AACT;AAYO,SAAS,yBACd,UAAsB,EACtB,QAAgB,EAChB,aAAqB;IAErB,MAAM,cAAc,sBAAsB,YAAY;IACtD,OAAO;QAAC;QAAe,eAAe;KAAS;AACjD;AAYO,SAAS,uBACd,UAAsB,EACtB,QAAmC,EACnC,aAAqB;IAErB,IAAI,CAAC,UAAU;QACb,OAAO;YAAC;YAAe;SAAW;IACpC;IAEA,MAAM,cAAc,sBAAsB,YAAY;IACtD,OAAO;QAAC;QAAe,eAAe;KAAY;AACpD;AAcO,SAAS,cACd,UAAsB,EACtB,QAAmC,EACnC,aAAqB;IAErB,IAAI,CAAC,UAAU;QACb,OAAO;YAAC;YAAe;SAAW;IACpC;IAEA,OAAO,yBAAyB,YAAY,UAAU;AACxD;AAKO,SAAS,qBAAqB,UAAsB;IACzD,IAAI;QACF,MAAM,SAAS,IAAA,yIAAe,EAAC;QAC/B,OAAO;YACL,aAAa,OAAO,WAAW;YAC/B,QAAQ,OAAO,MAAM;YACrB,UAAU,OAAO,QAAQ;QAC3B;IACF,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAKO,SAAS;IACd,gBAAgB,CAAC;AACnB;AAKO,SAAS;IACd,OAAO,OAAO,IAAI,CAAC;AACrB"}},
    {"offset": {"line": 6459, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/import-export/configs/order.config.ts"],"sourcesContent":["/**\r\n * Order Import/Export Configuration\r\n * \r\n * Import ƒë∆°n h√†ng v·ªõi c√°c ƒë·∫∑c ƒëi·ªÉm:\r\n * - Multi-line: M·ªói s·∫£n ph·∫©m 1 d√≤ng, c√°c d√≤ng c√πng M√£ ƒë∆°n s·∫Ω ƒë∆∞·ª£c g·ªôp th√†nh 1 Order\r\n * - Lookup kh√°ch h√†ng theo M√£ KH (id field)\r\n * - Lookup s·∫£n ph·∫©m theo SKU\r\n * - Tr·∫°ng th√°i m·∫∑c ƒë·ªãnh: \"ƒê·∫∑t h√†ng\"\r\n * - L·∫•y ƒë·ªãa ch·ªâ giao h√†ng t·ª´ kh√°ch h√†ng\r\n * - Kh√¥ng import ph√≠ ship, chi·∫øt kh·∫•u\r\n */\r\n\r\nimport type { Order, LineItem, OrderAddress } from '@/features/orders/types';\r\nimport type { ImportExportConfig, FieldConfig } from '../types';\r\nimport { useCustomerStore } from '@/features/customers/store';\r\nimport { useProductStore } from '@/features/products/store';\r\nimport { useBranchStore } from '@/features/settings/branches/store';\r\nimport { useEmployeeStore } from '@/features/employees/store';\r\nimport { asSystemId, asBusinessId, type SystemId, type BusinessId } from '@/lib/id-types';\r\nimport type { Customer } from '@/features/customers/types';\r\n\r\n// ============================================\r\n// HELPER FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Lookup kh√°ch h√†ng theo M√£ KH (id field)\r\n */\r\nconst findCustomerById = (customerId: string): Customer | undefined => {\r\n  if (!customerId) return undefined;\r\n  const customers = useCustomerStore.getState().data;\r\n  const normalizedId = String(customerId).trim().toUpperCase();\r\n  \r\n  return customers.find(c => \r\n    c.id.toUpperCase() === normalizedId ||\r\n    c.systemId.toUpperCase() === normalizedId\r\n  );\r\n};\r\n\r\n/**\r\n * Lookup s·∫£n ph·∫©m theo SKU\r\n */\r\nconst findProductBySku = (sku: string) => {\r\n  if (!sku) return undefined;\r\n  const products = useProductStore.getState().data;\r\n  const normalizedSku = String(sku).trim().toUpperCase();\r\n  \r\n  return products.find(p => \r\n    p.id.toUpperCase() === normalizedSku ||\r\n    p.sku?.toUpperCase() === normalizedSku ||\r\n    p.systemId.toUpperCase() === normalizedSku\r\n  );\r\n};\r\n\r\n/**\r\n * Lookup chi nh√°nh theo t√™n ho·∫∑c m√£\r\n */\r\nconst findBranch = (branchIdOrName: string) => {\r\n  if (!branchIdOrName) return undefined;\r\n  const branches = useBranchStore.getState().data;\r\n  const normalized = String(branchIdOrName).trim().toLowerCase();\r\n  \r\n  return branches.find(b => \r\n    b.id.toLowerCase() === normalized ||\r\n    b.name.toLowerCase() === normalized ||\r\n    b.systemId.toLowerCase() === normalized\r\n  );\r\n};\r\n\r\n/**\r\n * Lookup nh√¢n vi√™n theo t√™n ho·∫∑c m√£\r\n */\r\nconst findEmployee = (employeeIdOrName: string) => {\r\n  if (!employeeIdOrName) return undefined;\r\n  const employees = useEmployeeStore.getState().data;\r\n  const normalized = String(employeeIdOrName).trim().toLowerCase();\r\n  \r\n  return employees.find(e => \r\n    e.id.toLowerCase() === normalized ||\r\n    e.fullName.toLowerCase() === normalized ||\r\n    e.systemId.toLowerCase() === normalized\r\n  );\r\n};\r\n\r\n/**\r\n * Get default branch\r\n */\r\nconst getDefaultBranch = () => {\r\n  const branches = useBranchStore.getState().data;\r\n  return branches.find(b => b.isDefault) || branches[0];\r\n};\r\n\r\n/**\r\n * Get default shipping address from customer\r\n */\r\nconst getCustomerShippingAddress = (customer: Customer): OrderAddress | undefined => {\r\n  if (!customer) return undefined;\r\n  \r\n  // T√¨m ƒë·ªãa ch·ªâ m·∫∑c ƒë·ªãnh ho·∫∑c ƒë·ªãa ch·ªâ ƒë·∫ßu ti√™n\r\n  const defaultAddr = customer.addresses?.find(a => a.isDefault || a.isDefaultShipping) || customer.addresses?.[0];\r\n  \r\n  if (defaultAddr) {\r\n    const formattedAddress = [defaultAddr.street, defaultAddr.ward, defaultAddr.district, defaultAddr.province]\r\n      .filter(Boolean)\r\n      .join(', ');\r\n    return {\r\n      street: defaultAddr.street,\r\n      ward: defaultAddr.ward,\r\n      district: defaultAddr.district,\r\n      province: defaultAddr.province,\r\n      contactName: customer.name,\r\n      phone: customer.phone,\r\n      formattedAddress,\r\n    };\r\n  }\r\n  \r\n  return undefined;\r\n};\r\n\r\n// ============================================\r\n// INTERMEDIATE TYPE FOR IMPORT\r\n// ============================================\r\n\r\n/**\r\n * Type cho row nh·∫≠p t·ª´ Excel (flat structure - 1 d√≤ng = 1 s·∫£n ph·∫©m)\r\n * \r\n * FORMAT EXCEL M·∫™U:\r\n * ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\r\n * ‚îÇ M√£ ƒë∆°n(*) ‚îÇ M√£ KH(*) ‚îÇ Chi nh√°nh ‚îÇ Nh√¢n vi√™n  ‚îÇ SKU(*) ‚îÇ S·ªë l∆∞·ª£ng ‚îÇ ƒê∆°n gi√° ‚îÇ\r\n * ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\r\n * ‚îÇ DH001    ‚îÇ KH001  ‚îÇ CN-A      ‚îÇ Nguy·ªÖn A   ‚îÇ SP001  ‚îÇ 2        ‚îÇ 100000  ‚îÇ ‚Üê ƒê∆°n 1, SP 1\r\n * ‚îÇ          ‚îÇ        ‚îÇ           ‚îÇ            ‚îÇ SP002  ‚îÇ 1        ‚îÇ 200000  ‚îÇ ‚Üê ƒê∆°n 1, SP 2 (k·∫ø th·ª´a m√£ ƒë∆°n + KH)\r\n * ‚îÇ DH002    ‚îÇ KH002  ‚îÇ CN-B      ‚îÇ Tr·∫ßn B     ‚îÇ SP003  ‚îÇ 3        ‚îÇ 150000  ‚îÇ ‚Üê ƒê∆°n 2, SP 1\r\n * ‚îÇ          ‚îÇ        ‚îÇ           ‚îÇ            ‚îÇ SP004  ‚îÇ 1        ‚îÇ 300000  ‚îÇ ‚Üê ƒê∆°n 2, SP 2\r\n * ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\r\n * \r\n * LOGIC:\r\n * - M√£ ƒë∆°n (*): B·∫ÆT BU·ªòC ƒëi·ªÅn ·ªü d√≤ng ƒë·∫ßu c·ªßa m·ªói ƒë∆°n h√†ng\r\n * - M√£ KH (*): B·∫ÆT BU·ªòC ƒëi·ªÅn ·ªü d√≤ng ƒë·∫ßu c·ªßa m·ªói ƒë∆°n h√†ng  \r\n * - C√°c d√≤ng SP sau: ƒë·ªÉ tr·ªëng M√£ ƒë∆°n + M√£ KH ‚Üí t·ª± k·∫ø th·ª´a t·ª´ d√≤ng tr√™n\r\n * - Chi nh√°nh, Nh√¢n vi√™n: T√πy ch·ªçn, ƒë·ªÉ tr·ªëng s·∫Ω d√πng m·∫∑c ƒë·ªãnh\r\n */\r\nexport interface OrderImportRow {\r\n  orderId: string;              // M√£ ƒë∆°n h√†ng (DH001) - c√≥ th·ªÉ ƒë·ªÉ tr·ªëng n·∫øu mu·ªën auto-gen\r\n  customerId: string;           // M√£ kh√°ch h√†ng - ch·ªâ c·∫ßn ƒëi·ªÅn ·ªü d√≤ng ƒë·∫ßu m·ªói ƒë∆°n\r\n  branchName?: string;          // Chi nh√°nh (t√™n ho·∫∑c m√£)\r\n  salespersonName?: string;     // Nh√¢n vi√™n b√°n (t√™n ho·∫∑c m√£)\r\n  productSku: string;           // SKU s·∫£n ph·∫©m\r\n  quantity: number;             // S·ªë l∆∞·ª£ng\r\n  unitPrice?: number;           // ƒê∆°n gi√° (n·∫øu kh√¥ng c√≥ th√¨ l·∫•y t·ª´ SP)\r\n  lineNote?: string;            // Ghi ch√∫ d√≤ng s·∫£n ph·∫©m\r\n  orderNote?: string;           // Ghi ch√∫ ƒë∆°n h√†ng\r\n  orderDate?: string;           // Ng√†y ƒë·∫∑t h√†ng\r\n  source?: string;              // Ngu·ªìn ƒë∆°n\r\n  tags?: string;                // Tags (comma separated)\r\n}\r\n\r\n// ============================================\r\n// FIELD CONFIGURATION\r\n// ============================================\r\n\r\nexport const orderFields: FieldConfig<OrderImportRow>[] = [\r\n  // ===== Th√¥ng tin ƒë∆°n h√†ng =====\r\n  {\r\n    key: 'orderId',\r\n    label: 'M√£ ƒë∆°n h√†ng (*)',\r\n    type: 'string',\r\n    required: true,  // B·∫Øt bu·ªôc ƒëi·ªÅn ·ªü d√≤ng ƒë·∫ßu, c√°c d√≤ng SP sau c√≥ th·ªÉ ƒë·ªÉ tr·ªëng\r\n    example: 'DH001',\r\n    group: 'ƒê∆°n h√†ng',\r\n    defaultSelected: true,\r\n    // preProcessRows s·∫Ω fill-down cho c√°c d√≤ng SP sau\r\n  },\r\n  {\r\n    key: 'customerId',\r\n    label: 'M√£ kh√°ch h√†ng (*)',\r\n    type: 'string',\r\n    required: true,  // B·∫Øt bu·ªôc ƒëi·ªÅn ·ªü d√≤ng ƒë·∫ßu, c√°c d√≤ng SP sau c√≥ th·ªÉ ƒë·ªÉ tr·ªëng\r\n    example: 'KH001',\r\n    group: 'ƒê∆°n h√†ng',\r\n    defaultSelected: true,\r\n    // preProcessRows s·∫Ω fill-down cho c√°c d√≤ng SP sau\r\n  },\r\n  {\r\n    key: 'branchName',\r\n    label: 'Chi nh√°nh',\r\n    type: 'string',\r\n    required: false,\r\n    example: 'Chi nh√°nh H√† N·ªôi',\r\n    group: 'ƒê∆°n h√†ng',\r\n    defaultSelected: true,\r\n    validator: (value) => {\r\n      if (value && String(value).trim() !== '') {\r\n        const branch = findBranch(String(value));\r\n        if (!branch) {\r\n          return `Kh√¥ng t√¨m th·∫•y chi nh√°nh \"${value}\"`;\r\n        }\r\n      }\r\n      return true;\r\n    },\r\n  },\r\n  {\r\n    key: 'salespersonName',\r\n    label: 'Nh√¢n vi√™n b√°n h√†ng',\r\n    type: 'string',\r\n    required: false,\r\n    example: 'Nguy·ªÖn VƒÉn A',\r\n    group: 'ƒê∆°n h√†ng',\r\n    defaultSelected: true,\r\n    validator: (value) => {\r\n      if (value && String(value).trim() !== '') {\r\n        const employee = findEmployee(String(value));\r\n        if (!employee) {\r\n          return `Kh√¥ng t√¨m th·∫•y nh√¢n vi√™n \"${value}\"`;\r\n        }\r\n      }\r\n      return true;\r\n    },\r\n  },\r\n  {\r\n    key: 'orderDate',\r\n    label: 'Ng√†y ƒë·∫∑t h√†ng',\r\n    type: 'date',\r\n    required: false,\r\n    example: '19/12/2024',\r\n    group: 'ƒê∆°n h√†ng',\r\n    defaultSelected: true,\r\n  },\r\n  {\r\n    key: 'source',\r\n    label: 'Ngu·ªìn ƒë∆°n',\r\n    type: 'string',\r\n    required: false,\r\n    example: 'Website',\r\n    group: 'ƒê∆°n h√†ng',\r\n    defaultSelected: false,\r\n  },\r\n  {\r\n    key: 'tags',\r\n    label: 'Tags',\r\n    type: 'string',\r\n    required: false,\r\n    example: 'VIP, G·∫•p',\r\n    group: 'ƒê∆°n h√†ng',\r\n    defaultSelected: false,\r\n  },\r\n  {\r\n    key: 'orderNote',\r\n    label: 'Ghi ch√∫ ƒë∆°n h√†ng',\r\n    type: 'string',\r\n    required: false,\r\n    example: 'Giao bu·ªïi s√°ng',\r\n    group: 'ƒê∆°n h√†ng',\r\n    defaultSelected: true,\r\n  },\r\n\r\n  // ===== Th√¥ng tin s·∫£n ph·∫©m =====\r\n  {\r\n    key: 'productSku',\r\n    label: 'SKU s·∫£n ph·∫©m (*)',\r\n    type: 'string',\r\n    required: true,\r\n    example: 'SP001',\r\n    group: 'S·∫£n ph·∫©m',\r\n    defaultSelected: true,\r\n    validator: (value) => {\r\n      if (!value || String(value).trim() === '') {\r\n        return 'SKU s·∫£n ph·∫©m kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng';\r\n      }\r\n      const product = findProductBySku(String(value));\r\n      if (!product) {\r\n        return `Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m v·ªõi SKU \"${value}\"`;\r\n      }\r\n      return true;\r\n    },\r\n  },\r\n  {\r\n    key: 'quantity',\r\n    label: 'S·ªë l∆∞·ª£ng (*)',\r\n    type: 'number',\r\n    required: true,\r\n    example: '2',\r\n    group: 'S·∫£n ph·∫©m',\r\n    defaultSelected: true,\r\n    validator: (value) => {\r\n      const qty = Number(value);\r\n      if (isNaN(qty) || qty <= 0) {\r\n        return 'S·ªë l∆∞·ª£ng ph·∫£i l√† s·ªë d∆∞∆°ng';\r\n      }\r\n      return true;\r\n    },\r\n    importTransform: (value) => {\r\n      const num = Number(value);\r\n      return isNaN(num) ? 1 : Math.max(1, Math.floor(num));\r\n    },\r\n  },\r\n  {\r\n    key: 'unitPrice',\r\n    label: 'ƒê∆°n gi√°',\r\n    type: 'number',\r\n    required: false,\r\n    example: '150000',\r\n    group: 'S·∫£n ph·∫©m',\r\n    defaultSelected: true,\r\n    importTransform: (value) => {\r\n      if (value === undefined || value === null || value === '') return undefined;\r\n      const num = Number(value);\r\n      return isNaN(num) ? undefined : Math.max(0, num);\r\n    },\r\n  },\r\n  {\r\n    key: 'lineNote',\r\n    label: 'Ghi ch√∫ SP',\r\n    type: 'string',\r\n    required: false,\r\n    example: 'M√†u ƒë·ªè',\r\n    group: 'S·∫£n ph·∫©m',\r\n    defaultSelected: false,\r\n  },\r\n];\r\n\r\n// ============================================\r\n// FIELD GROUPS FOR EXPORT\r\n// ============================================\r\n\r\nexport const orderFieldGroups = [\r\n  {\r\n    id: 'order-info',\r\n    label: 'Th√¥ng tin ƒë∆°n h√†ng',\r\n    columns: [\r\n      { key: 'id', label: 'M√£ ƒë∆°n h√†ng', defaultSelected: true },\r\n      { key: 'orderDate', label: 'Ng√†y ƒë·∫∑t', defaultSelected: true },\r\n      { key: 'status', label: 'Tr·∫°ng th√°i', defaultSelected: true },\r\n      { key: 'source', label: 'Ngu·ªìn ƒë∆°n', defaultSelected: false },\r\n      { key: 'tags', label: 'Tags', defaultSelected: false },\r\n      { key: 'notes', label: 'Ghi ch√∫', defaultSelected: false },\r\n    ],\r\n  },\r\n  {\r\n    id: 'customer-info',\r\n    label: 'Th√¥ng tin kh√°ch h√†ng',\r\n    columns: [\r\n      { key: 'customerId', label: 'M√£ KH', defaultSelected: true },\r\n      { key: 'customerName', label: 'T√™n kh√°ch h√†ng', defaultSelected: true },\r\n      { key: 'customerPhone', label: 'SƒêT kh√°ch', defaultSelected: true },\r\n      { key: 'shippingAddress', label: 'ƒê·ªãa ch·ªâ giao', defaultSelected: true },\r\n    ],\r\n  },\r\n  {\r\n    id: 'product-info',\r\n    label: 'Th√¥ng tin s·∫£n ph·∫©m',\r\n    columns: [\r\n      { key: 'productSku', label: 'SKU', defaultSelected: true },\r\n      { key: 'productName', label: 'T√™n s·∫£n ph·∫©m', defaultSelected: true },\r\n      { key: 'quantity', label: 'S·ªë l∆∞·ª£ng', defaultSelected: true },\r\n      { key: 'unitPrice', label: 'ƒê∆°n gi√°', defaultSelected: true },\r\n      { key: 'lineTotal', label: 'Th√†nh ti·ªÅn', defaultSelected: true },\r\n      { key: 'lineNote', label: 'Ghi ch√∫ SP', defaultSelected: false },\r\n    ],\r\n  },\r\n  {\r\n    id: 'payment-info',\r\n    label: 'Thanh to√°n',\r\n    columns: [\r\n      { key: 'subtotal', label: 'T·∫°m t√≠nh', defaultSelected: true },\r\n      { key: 'shippingFee', label: 'Ph√≠ ship', defaultSelected: false },\r\n      { key: 'orderDiscount', label: 'Chi·∫øt kh·∫•u', defaultSelected: false },\r\n      { key: 'grandTotal', label: 'T·ªïng ti·ªÅn', defaultSelected: true },\r\n      { key: 'paidAmount', label: 'ƒê√£ thanh to√°n', defaultSelected: true },\r\n      { key: 'paymentStatus', label: 'Tr·∫°ng th√°i TT', defaultSelected: true },\r\n    ],\r\n  },\r\n  {\r\n    id: 'delivery-info',\r\n    label: 'V·∫≠n chuy·ªÉn',\r\n    columns: [\r\n      { key: 'deliveryMethod', label: 'Ph∆∞∆°ng th·ª©c giao', defaultSelected: true },\r\n      { key: 'deliveryStatus', label: 'Tr·∫°ng th√°i giao', defaultSelected: true },\r\n      { key: 'trackingCode', label: 'M√£ v·∫≠n ƒë∆°n', defaultSelected: false },\r\n      { key: 'carrier', label: 'ƒêVVC', defaultSelected: false },\r\n    ],\r\n  },\r\n  {\r\n    id: 'branch-staff',\r\n    label: 'Chi nh√°nh & Nh√¢n vi√™n',\r\n    columns: [\r\n      { key: 'branchName', label: 'Chi nh√°nh', defaultSelected: true },\r\n      { key: 'salesperson', label: 'Nh√¢n vi√™n b√°n', defaultSelected: true },\r\n    ],\r\n  },\r\n];\r\n\r\n// ============================================\r\n// MAIN CONFIG\r\n// ============================================\r\n\r\nexport const orderImportExportConfig: ImportExportConfig<Order> = {\r\n  entityType: 'orders',\r\n  entityDisplayName: 'ƒê∆°n h√†ng',\r\n  \r\n  fields: orderFields as unknown as FieldConfig<Order>[],\r\n  \r\n  templateFileName: 'Mau_Nhap_Don_Hang.xlsx',\r\n  sheetName: 'ƒê∆°n h√†ng',\r\n  \r\n  // Import settings\r\n  upsertKey: 'id',\r\n  allowUpdate: false,  // Ch·ªâ cho ph√©p th√™m m·ªõi, kh√¥ng update ƒë∆°n h√†ng qua import\r\n  allowInsert: true,\r\n  \r\n  requirePreview: true,\r\n  maxRows: 1000,\r\n  maxErrorsAllowed: 0,  // Kh√¥ng cho ph√©p l·ªói\r\n  \r\n  // Pre-process: Fill empty orderId/customerId from previous row\r\n  // User must fill orderId + customerId on first row of each order\r\n  // Subsequent product rows can leave them empty ‚Üí will inherit from previous row\r\n  preProcessRows: (rows: unknown[]) => {\r\n    const importRows = rows as OrderImportRow[];\r\n    let currentOrderId = '';\r\n    let currentCustomerId = '';\r\n    \r\n    for (const row of importRows) {\r\n      // If orderId is provided, use it and update current\r\n      if (row.orderId?.trim()) {\r\n        currentOrderId = row.orderId.trim();\r\n        // Also update customerId if provided on the same row\r\n        if (row.customerId?.trim()) {\r\n          currentCustomerId = row.customerId.trim();\r\n        }\r\n      } else if (currentOrderId) {\r\n        // Fill from previous row's orderId (for subsequent product lines)\r\n        row.orderId = currentOrderId;\r\n      }\r\n      // Note: if orderId is empty and no previous orderId ‚Üí validation will catch it\r\n      \r\n      // Fill customerId if empty (inherit from previous row)\r\n      if (!row.customerId?.trim() && currentCustomerId) {\r\n        row.customerId = currentCustomerId;\r\n      } else if (row.customerId?.trim()) {\r\n        currentCustomerId = row.customerId.trim();\r\n      }\r\n    }\r\n    \r\n    return importRows;\r\n  },\r\n  \r\n  // Validate row (after pre-processing)\r\n  validateRow: (row, _index, existingData, mode) => {\r\n    const errors: Array<{ field?: string; message: string }> = [];\r\n    const importRow = row as unknown as OrderImportRow;\r\n    \r\n    // Check required fields - orderId must be filled on first row of each order\r\n    if (!importRow.orderId) {\r\n      errors.push({ field: 'orderId', message: 'M√£ ƒë∆°n h√†ng kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng (b·∫Øt bu·ªôc ƒëi·ªÅn ·ªü d√≤ng ƒë·∫ßu c·ªßa m·ªói ƒë∆°n)' });\r\n    }\r\n    if (!importRow.customerId) {\r\n      errors.push({ field: 'customerId', message: 'M√£ kh√°ch h√†ng kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng (ƒëi·ªÅn ·ªü d√≤ng ƒë·∫ßu c·ªßa m·ªói ƒë∆°n)' });\r\n    }\r\n    if (!importRow.productSku) {\r\n      errors.push({ field: 'productSku', message: 'SKU s·∫£n ph·∫©m kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng' });\r\n    }\r\n    \r\n    // Validate customer\r\n    if (importRow.customerId) {\r\n      const customer = findCustomerById(importRow.customerId);\r\n      if (!customer) {\r\n        errors.push({ field: 'customerId', message: `Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng \"${importRow.customerId}\"` });\r\n      }\r\n    }\r\n    \r\n    // Validate product\r\n    if (importRow.productSku) {\r\n      const product = findProductBySku(importRow.productSku);\r\n      if (!product) {\r\n        errors.push({ field: 'productSku', message: `Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m \"${importRow.productSku}\"` });\r\n      }\r\n    }\r\n    \r\n    // Validate branch if provided\r\n    if (importRow.branchName) {\r\n      const branch = findBranch(importRow.branchName);\r\n      if (!branch) {\r\n        errors.push({ field: 'branchName', message: `Kh√¥ng t√¨m th·∫•y chi nh√°nh \"${importRow.branchName}\"` });\r\n      }\r\n    }\r\n    \r\n    // Validate salesperson if provided\r\n    if (importRow.salespersonName) {\r\n      const employee = findEmployee(importRow.salespersonName);\r\n      if (!employee) {\r\n        errors.push({ field: 'salespersonName', message: `Kh√¥ng t√¨m th·∫•y nh√¢n vi√™n \"${importRow.salespersonName}\"` });\r\n      }\r\n    }\r\n    \r\n    // Validate quantity\r\n    if (importRow.quantity !== undefined) {\r\n      const qty = Number(importRow.quantity);\r\n      if (isNaN(qty) || qty <= 0) {\r\n        errors.push({ field: 'quantity', message: 'S·ªë l∆∞·ª£ng ph·∫£i l√† s·ªë d∆∞∆°ng' });\r\n      }\r\n    }\r\n    \r\n    // Check duplicate order ID in existing data (only in insert-only mode)\r\n    if (mode === 'insert-only' && importRow.orderId) {\r\n      const duplicate = existingData.find(o => \r\n        o.id.toUpperCase() === importRow.orderId.toUpperCase()\r\n      );\r\n      if (duplicate) {\r\n        errors.push({ field: 'orderId', message: `M√£ ƒë∆°n h√†ng \"${importRow.orderId}\" ƒë√£ t·ªìn t·∫°i` });\r\n      }\r\n    }\r\n    \r\n    return errors;\r\n  },\r\n  \r\n  // Transform: Group rows by orderId and build Order objects\r\n  // This is handled in postTransformRow and beforeImport\r\n  beforeImport: async (data: Order[]) => {\r\n    // data here is actually OrderImportRow[] after field transforms\r\n    const importRows = data as unknown as OrderImportRow[];\r\n    \r\n    // Group rows by orderId\r\n    const orderMap = new Map<string, {\r\n      rows: OrderImportRow[];\r\n      customer?: Customer;\r\n      branch?: ReturnType<typeof findBranch>;\r\n      employee?: ReturnType<typeof findEmployee>;\r\n    }>();\r\n    \r\n    for (const row of importRows) {\r\n      const orderId = row.orderId?.trim().toUpperCase();\r\n      if (!orderId) continue;\r\n      \r\n      if (!orderMap.has(orderId)) {\r\n        const customer = findCustomerById(row.customerId);\r\n        const branch = row.branchName ? findBranch(row.branchName) : getDefaultBranch();\r\n        const employee = row.salespersonName ? findEmployee(row.salespersonName) : undefined;\r\n        \r\n        orderMap.set(orderId, {\r\n          rows: [],\r\n          customer,\r\n          branch,\r\n          employee,\r\n        });\r\n      }\r\n      orderMap.get(orderId)!.rows.push(row);\r\n    }\r\n    \r\n    // Build Order objects\r\n    const orders: Order[] = [];\r\n    const now = new Date().toISOString();\r\n    \r\n    for (const [orderId, { rows, customer, branch, employee }] of orderMap.entries()) {\r\n      if (!customer || rows.length === 0) continue;\r\n      \r\n      // Build line items\r\n      const lineItems: LineItem[] = [];\r\n      for (const row of rows) {\r\n        const product = findProductBySku(row.productSku);\r\n        if (!product) continue;\r\n        \r\n        const quantity = Math.max(1, Math.floor(Number(row.quantity) || 1));\r\n        const unitPrice = row.unitPrice ?? product.sellingPrice ?? product.costPrice ?? 0;\r\n        \r\n        lineItems.push({\r\n          productSystemId: product.systemId,\r\n          productId: product.id,\r\n          productName: product.name,\r\n          quantity,\r\n          unitPrice,\r\n          discount: 0,\r\n          discountType: 'fixed',\r\n          note: row.lineNote,\r\n        });\r\n      }\r\n      \r\n      if (lineItems.length === 0) continue;\r\n      \r\n      // Calculate totals\r\n      const subtotal = lineItems.reduce((sum, item) => {\r\n        return sum + (item.unitPrice * item.quantity);\r\n      }, 0);\r\n      \r\n      // Get first row for order-level data\r\n      const firstRow = rows[0];\r\n      \r\n      // Parse order date\r\n      let orderDate = now;\r\n      if (firstRow.orderDate) {\r\n        const parsed = new Date(firstRow.orderDate);\r\n        if (!isNaN(parsed.getTime())) {\r\n          orderDate = parsed.toISOString();\r\n        }\r\n      }\r\n      \r\n      // Build shipping address from customer\r\n      const shippingAddress = getCustomerShippingAddress(customer);\r\n      \r\n      // Parse tags\r\n      const tags = firstRow.tags \r\n        ? firstRow.tags.split(',').map(t => t.trim()).filter(Boolean)\r\n        : undefined;\r\n      \r\n      const order: Order = {\r\n        systemId: asSystemId(''), // Will be assigned by store\r\n        id: asBusinessId(orderId),\r\n        customerSystemId: customer.systemId,\r\n        customerName: customer.name,\r\n        branchSystemId: branch?.systemId || asSystemId(''),\r\n        branchName: branch?.name || '',\r\n        salespersonSystemId: employee?.systemId || asSystemId(''),\r\n        salesperson: employee?.fullName || '',\r\n        orderDate,\r\n        \r\n        // Statuses - all new orders start with \"ƒê·∫∑t h√†ng\"\r\n        status: 'ƒê·∫∑t h√†ng',\r\n        paymentStatus: 'Ch∆∞a thanh to√°n',\r\n        deliveryStatus: 'Ch·ªù ƒë√≥ng g√≥i',\r\n        printStatus: 'Ch∆∞a in',\r\n        stockOutStatus: 'Ch∆∞a xu·∫•t kho',\r\n        returnStatus: 'Ch∆∞a tr·∫£ h√†ng',\r\n        deliveryMethod: 'D·ªãch v·ª• giao h√†ng',\r\n        \r\n        // Address\r\n        shippingAddress,\r\n        \r\n        // Line items\r\n        lineItems,\r\n        \r\n        // Totals (no discount, no shipping fee from import)\r\n        subtotal,\r\n        shippingFee: 0,\r\n        tax: 0,\r\n        grandTotal: subtotal,\r\n        paidAmount: 0,\r\n        codAmount: 0,\r\n        \r\n        // Arrays\r\n        payments: [],\r\n        packagings: [],\r\n        \r\n        // Optional fields\r\n        notes: firstRow.orderNote,\r\n        source: firstRow.source,\r\n        tags,\r\n        \r\n        // Timestamps\r\n        createdAt: now,\r\n        updatedAt: now,\r\n      };\r\n      \r\n      orders.push(order);\r\n    }\r\n    \r\n    return orders;\r\n  },\r\n};\r\n\r\n// ============================================\r\n// EXPORT HELPERS\r\n// ============================================\r\n\r\n/**\r\n * Flatten orders to rows for export (1 row per line item)\r\n */\r\nexport function flattenOrdersForExport(orders: Order[]): Array<Record<string, unknown>> {\r\n  const rows: Array<Record<string, unknown>> = [];\r\n  \r\n  for (const order of orders) {\r\n    // Get customer info\r\n    const customer = useCustomerStore.getState().findById(order.customerSystemId);\r\n    \r\n    // Get latest packaging for tracking info\r\n    const latestPackaging = order.packagings?.[order.packagings.length - 1];\r\n    \r\n    for (const item of order.lineItems) {\r\n      rows.push({\r\n        // Order info\r\n        id: order.id,\r\n        orderDate: order.orderDate,\r\n        status: order.status,\r\n        source: order.source || '',\r\n        tags: order.tags?.join(', ') || '',\r\n        notes: order.notes || '',\r\n        \r\n        // Customer info\r\n        customerId: customer?.id || '',\r\n        customerName: order.customerName,\r\n        customerPhone: customer?.phone || '',\r\n        shippingAddress: typeof order.shippingAddress === 'string' \r\n          ? order.shippingAddress \r\n          : (order.shippingAddress as OrderAddress)?.formattedAddress || '',\r\n        \r\n        // Product info\r\n        productSku: item.productId,\r\n        productName: item.productName,\r\n        quantity: item.quantity,\r\n        unitPrice: item.unitPrice,\r\n        lineTotal: item.unitPrice * item.quantity,\r\n        lineNote: item.note || '',\r\n        \r\n        // Payment info\r\n        subtotal: order.subtotal,\r\n        shippingFee: order.shippingFee,\r\n        orderDiscount: order.orderDiscount || 0,\r\n        grandTotal: order.grandTotal,\r\n        paidAmount: order.paidAmount,\r\n        paymentStatus: order.paymentStatus,\r\n        \r\n        // Delivery info\r\n        deliveryMethod: order.deliveryMethod,\r\n        deliveryStatus: order.deliveryStatus,\r\n        trackingCode: latestPackaging?.trackingCode || '',\r\n        carrier: latestPackaging?.carrier || '',\r\n        \r\n        // Branch & Staff\r\n        branchName: order.branchName,\r\n        salesperson: order.salesperson,\r\n      });\r\n    }\r\n  }\r\n  \r\n  return rows;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7181, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/import-export/configs/index.ts"],"sourcesContent":["/**\r\n * Import/Export Configs - Index\r\n * \r\n * Re-export t·∫•t c·∫£ configs\r\n */\r\n\r\nexport { employeeImportExportConfig, employeeFields } from './employee.config';\r\nexport { attendanceImportExportConfig, attendanceFields } from './attendance.config';\r\nexport { customerImportExportConfig, customerFields } from './customer.config';\r\nexport { productImportExportConfig, productFields } from './product.config';\r\nexport { brandImportExportConfig, brandFields, brandFieldGroups } from './brand.config';\r\nexport { categoryImportExportConfig, categoryFields, categoryFieldGroups } from './category.config';\r\nexport { orderImportExportConfig, orderFields, orderFieldGroups, flattenOrdersForExport } from './order.config';\r\n\r\n// Types re-export for convenience\r\nexport type { ImportExportConfig, FieldConfig } from '../types';\r\n"],"names":[],"mappings":";AAAA;;;;CAIC,GAED;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 7207, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/import-export/index.ts"],"sourcesContent":["/**\r\n * Import/Export System - Main Exports\r\n */\r\n\r\n// Types\r\nexport type {\r\n  ImportLogEntry,\r\n  ExportLogEntry,\r\n  FieldConfig,\r\n  ImportExportConfig,\r\n  ImportResult,\r\n  ExportResult,\r\n  ImportPreviewRow,\r\n  ImportPreviewResult,\r\n  ImportPreviewStatus,\r\n  EmployeeMappingEntry,\r\n  AttendanceImportRow,\r\n  AttendanceSummary,\r\n} from './types';\r\n\r\n// Store\r\nexport {\r\n  useImportExportStore,\r\n  selectImportLogs,\r\n  selectExportLogs,\r\n  selectImportLogsByEntity,\r\n  selectExportLogsByEntity,\r\n} from './import-export-store';\r\n\r\n// Employee Mapping Store\r\nexport {\r\n  useEmployeeMappingStore,\r\n  saveMappingsFromAutoMap,\r\n} from './employee-mapping-store';\r\n\r\n// Utils\r\nexport {\r\n  previewImportData,\r\n  validateField,\r\n  transformImportRow,\r\n  transformExportRow,\r\n  checkUniqueFields,\r\n  generateExportFileName,\r\n  formatFileSize,\r\n} from './utils';\r\n\r\n// Attendance Parser\r\nexport {\r\n  parseAttendanceFile,\r\n  parseWorkDays,\r\n  getAvailableSheets,\r\n  previewSheet,\r\n} from './attendance-parser';\r\nexport type { AttendanceParseResult } from './attendance-parser';\r\n\r\n// Configs\r\nexport {\r\n  employeeImportExportConfig,\r\n  employeeFields,\r\n  attendanceImportExportConfig,\r\n  attendanceFields,\r\n} from './configs';\r\n"],"names":[],"mappings":"AAAA;;CAEC,GAED,QAAQ;;AAgBR,QAAQ;AACR;AAQA,yBAAyB;AACzB;AAKA,QAAQ;AACR;AAUA,oBAAoB;AACpB;AAQA,UAAU;AACV"}},
    {"offset": {"line": 7233, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/api-config.ts"],"sourcesContent":["/**\r\n * API Configuration Utilities\r\n * \r\n * Centralized configuration for API endpoints.\r\n * All API URLs should use these utilities instead of hardcoding.\r\n */\r\n\r\n/**\r\n * Get the API base URL from environment variables\r\n * Falls back to localhost:3001 for development\r\n */\r\nexport function getApiBaseUrl(): string {\r\n  // Use relative path to leverage Vite proxy in development\r\n  // This avoids CORS issues when frontend (5173) talks to backend (3001)\r\n  if ((import.meta as any).env?.DEV) {\r\n    return '/api';\r\n  }\r\n  return (import.meta as any).env?.VITE_API_BASE_URL || 'http://localhost:3001/api';\r\n}\r\n\r\n/**\r\n * Get the base URL without /api suffix\r\n * Falls back to localhost:3001 for development\r\n */\r\nexport function getBaseUrl(): string {\r\n  const apiUrl = getApiBaseUrl();\r\n  return apiUrl.replace('/api', '');\r\n}\r\n\r\n/**\r\n * Build a full file URL from a relative path\r\n * @param relativePath - Relative file path (e.g., \"/uploads/documents/file.pdf\")\r\n * @returns Full URL to the file\r\n */\r\nexport function getFileUrl(relativePath: string): string {\r\n  if (!relativePath) return '';\r\n  \r\n  // If already a full URL, return as is\r\n  if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {\r\n    return relativePath;\r\n  }\r\n  \r\n  // Build full URL\r\n  const baseUrl = getBaseUrl();\r\n  return `${baseUrl}${relativePath}`;\r\n}\r\n\r\n/**\r\n * Build an API endpoint URL\r\n * @param endpoint - API endpoint path (e.g., \"/employees/documents\")\r\n * @returns Full API URL\r\n */\r\nexport function getApiUrl(endpoint: string): string {\r\n  const apiBaseUrl = getApiBaseUrl();\r\n  return `${apiBaseUrl}${endpoint}`;\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;CAKC,GAED;;;CAGC;;;;;;;;;;;;;;;AACM,SAAS;IACd,0DAA0D;IAC1D,uEAAuE;IACvE,IAAI,8BAAqB,GAAG,EAAE,KAAK;QACjC,OAAO;IACT;IACA,OAAO,8BAAqB,GAAG,EAAE,qBAAqB;AACxD;AAMO,SAAS;IACd,MAAM,SAAS;IACf,OAAO,OAAO,OAAO,CAAC,QAAQ;AAChC;AAOO,SAAS,WAAW,YAAoB;IAC7C,IAAI,CAAC,cAAc,OAAO;IAE1B,sCAAsC;IACtC,IAAI,aAAa,UAAU,CAAC,cAAc,aAAa,UAAU,CAAC,aAAa;QAC7E,OAAO;IACT;IAEA,iBAAiB;IACjB,MAAM,UAAU;IAChB,OAAO,GAAG,UAAU,cAAc;AACpC;AAOO,SAAS,UAAU,QAAgB;IACxC,MAAM,aAAa;IACnB,OAAO,GAAG,aAAa,UAAU;AACnC"}},
    {"offset": {"line": 7289, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/file-upload-api.ts"],"sourcesContent":["// API client ƒë·ªÉ giao ti·∫øp v·ªõi server - Staging System\r\nimport { getApiBaseUrl } from './api-config';\r\n\r\nconst API_BASE_URL = getApiBaseUrl();\r\n\r\nexport type StagingFile = {\r\n  id: string;\r\n  sessionId: string;\r\n  name: string; // Display name (smart filename v·ªõi metadata)\r\n  originalName: string; // T√™n file g·ªëc\r\n  slug: string; // URL-safe slug\r\n  filename: string; // T√™n file h·ªá th·ªëng (UUID) - c·∫ßn cho preview URL\r\n  size: number;\r\n  type: string;\r\n  url: string;\r\n  status: 'staging' | 'permanent'; // ‚úÖ Support both staging and permanent files\r\n  uploadedAt: string;\r\n  metadata: string; // Smart filename metadata\r\n};\r\n\r\nexport type ServerFile = {\r\n  id: string;\r\n  employeeId: string;\r\n  documentType: string;\r\n  documentName: string;\r\n  name: string; // Display name\r\n  originalName: string; // T√™n file g·ªëc\r\n  slug: string; // URL-safe slug\r\n  filename: string; // T√™n file h·ªá th·ªëng\r\n  size: number;\r\n  type: string;\r\n  url: string;\r\n  uploadedAt: string;\r\n  confirmedAt?: string;\r\n  metadata: string; // Smart filename metadata\r\n};\r\n\r\nexport type UploadedAsset = {\r\n  id: string;\r\n  name: string;\r\n  size: number;\r\n  type: string;\r\n  url: string;\r\n  uploadedAt: string;\r\n};\r\n\r\nexport type UploadedFile = {\r\n  id: string;\r\n  name: string;\r\n  filename?: string;\r\n  type: string;\r\n  size: number;\r\n  url: string;\r\n  uploadedAt?: string;\r\n  metadata?: Record<string, unknown>;\r\n};\r\n\r\nexport class FileUploadAPI {\r\n  // Upload files v√†o staging (t·∫°m th·ªùi)\r\n  static async uploadToStaging(files: File[], sessionId?: string): Promise<{\r\n    files: StagingFile[];\r\n    sessionId: string;\r\n  }> {\r\n    const formData = new FormData();\r\n    \r\n    files.forEach(file => {\r\n      formData.append('files', file);\r\n    });\r\n\r\n    // CRITICAL FIX: sessionId in FormData doesn't work with multer\r\n    // Send via query params instead\r\n    const url = sessionId \r\n      ? `${API_BASE_URL}/staging/upload?sessionId=${encodeURIComponent(sessionId)}`\r\n      : `${API_BASE_URL}/staging/upload`;\r\n\r\n    console.log('üì§ Uploading to:', url);\r\n    console.log('üì¶ Files:', files.map(f => `${f.name} (${(f.size / 1024).toFixed(1)}KB)`));\r\n\r\n    let response;\r\n    try {\r\n      response = await fetch(url, {\r\n        method: 'POST',\r\n        body: formData,\r\n      });\r\n    } catch (fetchError) {\r\n      console.error('‚ùå Network fetch failed:', fetchError);\r\n      throw new Error(`Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server (${API_BASE_URL}). Vui l√≤ng ki·ªÉm tra server c√≥ ƒëang ch·∫°y.`);\r\n    }\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      console.error('‚ùå Server error:', response.status, errorText);\r\n      throw new Error(`Server error (${response.status}): ${errorText}`);\r\n    }\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Staging upload failed');\r\n    }\r\n\r\n    return {\r\n      files: result.files,\r\n      sessionId: result.sessionId\r\n    };\r\n  }\r\n\r\n  // Confirm staging files ‚Üí permanent v·ªõi smart filename\r\n  // NOTE: entitySystemId MUST be immutable (systemId) to avoid broken references\r\n  static async confirmStagingFiles(\r\n    sessionId: string,\r\n    entitySystemId: string,\r\n    documentType: string,\r\n    documentName: string,\r\n    metadata?: Record<string, any>\r\n  ): Promise<ServerFile[]> {\r\n    const response = await fetch(\r\n      `${API_BASE_URL}/staging/confirm/${sessionId}/${entitySystemId}/${documentType}/${encodeURIComponent(documentName)}`,\r\n      { \r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({ metadata })\r\n      }\r\n    );\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Confirm failed');\r\n    }\r\n\r\n    return result.files;\r\n  }\r\n\r\n  // L·∫•y staging files theo session\r\n  static async getStagingFiles(sessionId: string): Promise<StagingFile[]> {\r\n    const response = await fetch(`${API_BASE_URL}/staging/files/${sessionId}`);\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Failed to fetch staging files');\r\n    }\r\n\r\n    return result.files;\r\n  }\r\n\r\n  // X√≥a staging files (cancel)\r\n  static async deleteStagingFiles(sessionId: string): Promise<void> {\r\n    const response = await fetch(`${API_BASE_URL}/staging/${sessionId}`, {\r\n      method: 'DELETE',\r\n    });\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Delete staging failed');\r\n    }\r\n  }\r\n\r\n  // Upload files l√™n server (legacy - direct permanent)\r\n  // NOTE: employeeId MUST be the systemId (immutable), NOT the business ID\r\n  static async uploadFiles(\r\n    employeeId: string, // ‚ö†Ô∏è MUST use systemId (e.g., \"NV00000001\"), NOT business ID\r\n    documentType: string,\r\n    documentName: string,\r\n    files: File[]\r\n  ): Promise<ServerFile[]> {\r\n    const formData = new FormData();\r\n    \r\n    files.forEach(file => {\r\n      formData.append('files', file);\r\n    });\r\n\r\n    const response = await fetch(\r\n      `${API_BASE_URL}/upload/${employeeId}/${documentType}/${encodeURIComponent(documentName)}`,\r\n      {\r\n        method: 'POST',\r\n        body: formData,\r\n      }\r\n    );\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Upload failed');\r\n    }\r\n\r\n    return result.files;\r\n  }\r\n\r\n  // L·∫•y danh s√°ch file permanent\r\n  // NOTE: employeeId MUST be the systemId (immutable), NOT the business ID\r\n  static async getFiles(\r\n    employeeId: string, // ‚ö†Ô∏è MUST use systemId (e.g., \"NV00000001\"), NOT business ID\r\n    documentType?: string\r\n  ): Promise<ServerFile[]> {\r\n    try {\r\n      const url = documentType \r\n        ? `${API_BASE_URL}/files/${employeeId}/${documentType}`\r\n        : `${API_BASE_URL}/files/${employeeId}`;\r\n\r\n      const response = await fetch(url);\r\n      \r\n      // Check if response is ok\r\n      if (!response.ok) {\r\n        return []; // Return empty array instead of throwing\r\n      }\r\n      \r\n      const result = await response.json();\r\n      \r\n      if (!result.success) {\r\n        return []; // Return empty array instead of throwing\r\n      }\r\n\r\n      return result.files || [];\r\n    } catch (error) {\r\n      return []; // Return empty array on network error\r\n    }\r\n  }\r\n\r\n  // X√≥a file permanent\r\n  static async deleteFile(fileId: string): Promise<void> {\r\n    const response = await fetch(`${API_BASE_URL}/files/${fileId}`, {\r\n      method: 'DELETE',\r\n    });\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Delete failed');\r\n    }\r\n  }\r\n\r\n  // L·∫•y URL file ƒë·ªÉ hi·ªÉn th·ªã (bao g·ªìm staging v√† permanent)\r\n  static getFileUrl(file: StagingFile | ServerFile): string {\r\n    // ‚úÖ Return relative path to use Vite proxy - avoid CORS\r\n    // Server already returns relative path like /api/staging/files/...\r\n    return file.url;\r\n  }\r\n\r\n  // Th·ªëng k√™ storage (ch·ªâ permanent files)\r\n  static async getStorageInfo(): Promise<{\r\n    totalFiles: number;\r\n    totalSize: number;\r\n    totalSizeMB: number;\r\n  }> {\r\n    const response = await fetch(`${API_BASE_URL}/storage/info`);\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error('Failed to get storage info');\r\n    }\r\n\r\n    return result.stats;\r\n  }\r\n\r\n  // Helper: Generate session ID cho staging\r\n  static generateSessionId(): string {\r\n    return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  static async getProductFiles(productId: string): Promise<ServerFile[]> {\r\n    return this.getFiles(productId, 'products');\r\n  }\r\n\r\n  // Get customer files (images)\r\n  static async getCustomerFiles(customerId: string): Promise<ServerFile[]> {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}/files/customers/${customerId}`);\r\n      \r\n      if (!response.ok) {\r\n        return [];\r\n      }\r\n      \r\n      const result = await response.json();\r\n      \r\n      if (!result.success) {\r\n        return [];\r\n      }\r\n\r\n      return result.files || [];\r\n    } catch (error) {\r\n      console.error('Failed to get customer files:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  // Get customer contract files\r\n  static async getCustomerContractFiles(customerId: string): Promise<ServerFile[]> {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}/files/customers/${customerId}/contracts`);\r\n      \r\n      if (!response.ok) {\r\n        return [];\r\n      }\r\n      \r\n      const result = await response.json();\r\n      \r\n      if (!result.success) {\r\n        return [];\r\n      }\r\n\r\n      return result.files || [];\r\n    } catch (error) {\r\n      console.error('Failed to get customer contract files:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  // Confirm customer contract files from staging to permanent\r\n  static async confirmCustomerContractFiles(\r\n    sessionId: string,\r\n    customerId: string,\r\n    customerData?: Record<string, any>\r\n  ): Promise<ServerFile[]> {\r\n    const response = await fetch(\r\n      `${API_BASE_URL}/staging/confirm/${sessionId}/customers/${customerId}/contracts`,\r\n      { \r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({ customerData })\r\n      }\r\n    );\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Confirm customer contract files failed');\r\n    }\r\n\r\n    return result.files;\r\n  }\r\n\r\n  // Confirm customer images from staging to permanent\r\n  static async confirmCustomerImages(\r\n    sessionId: string,\r\n    customerId: string,\r\n    customerData?: {\r\n      name?: string;\r\n      [key: string]: any;\r\n    }\r\n  ): Promise<ServerFile[]> {\r\n    const response = await fetch(\r\n      `${API_BASE_URL}/staging/confirm/${sessionId}/customers/${customerId}`,\r\n      { \r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({ customerData })\r\n      }\r\n    );\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Confirm customer images failed');\r\n    }\r\n\r\n    return result.files;\r\n  }\r\n\r\n  // Confirm warranty images from staging to permanent\r\n  static async confirmWarrantyImages(\r\n    sessionId: string,\r\n    warrantyId: string,\r\n    imageType: 'received' | 'processed',\r\n    warrantyData?: {\r\n      customerName?: string;\r\n      [key: string]: any;\r\n    }\r\n  ): Promise<ServerFile[]> {\r\n    const response = await fetch(\r\n      `${API_BASE_URL}/staging/confirm/${sessionId}/warranty/${warrantyId}/${imageType}`,\r\n      { \r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({ warrantyData })\r\n      }\r\n    );\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Confirm warranty images failed');\r\n    }\r\n\r\n    return result.files;\r\n  }\r\n\r\n  // Delete staging session (cleanup on cancel)\r\n  static async deleteStagingSession(sessionId: string): Promise<void> {\r\n    const response = await fetch(\r\n      `${API_BASE_URL}/staging/${sessionId}`,\r\n      { method: 'DELETE' }\r\n    );\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Delete staging session failed');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Upload ·∫£nh t·ª´ TipTap Editor v√†o STAGING\r\n   * ·∫¢nh s·∫Ω ƒë∆∞·ª£c move sang permanent khi entity ƒë∆∞·ª£c save\r\n   * \r\n   * @param file - File ·∫£nh c·∫ßn upload\r\n   * @param sessionId - Session ID ƒë·ªÉ group c√°c ·∫£nh c√πng editor\r\n   * @returns StagingFile v·ªõi URL t·∫°m th·ªùi\r\n   */\r\n  static async uploadEditorImageToStaging(file: File, sessionId?: string): Promise<{\r\n    file: StagingFile;\r\n    sessionId: string;\r\n  }> {\r\n    const result = await FileUploadAPI.uploadToStaging([file], sessionId);\r\n    return {\r\n      file: result.files[0],\r\n      sessionId: result.sessionId,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Confirm ·∫£nh editor t·ª´ staging sang permanent\r\n   * ƒê·ªìng th·ªùi replace staging URLs trong HTML content b·∫±ng permanent URLs\r\n   * \r\n   * @param sessionId - Editor staging session\r\n   * @param entityId - ID c·ªßa entity (category, product, etc.)\r\n   * @param entityType - Lo·∫°i entity ('categories', 'products', etc.)\r\n   * @param htmlContent - N·ªôi dung HTML c·∫ßn update URLs\r\n   * @returns Updated HTML v·ªõi permanent URLs\r\n   */\r\n  static async confirmEditorImages(\r\n    sessionId: string,\r\n    entityId: string,\r\n    entityType: string,\r\n    htmlContent: string\r\n  ): Promise<{ html: string; files: ServerFile[] }> {\r\n    // Confirm staging files\r\n    const confirmedFiles = await FileUploadAPI.confirmStagingFiles(\r\n      sessionId,\r\n      entityId,\r\n      entityType,\r\n      'editor-images',\r\n      { source: 'tiptap-editor' }\r\n    );\r\n\r\n    // Replace staging URLs with permanent URLs in HTML\r\n    let updatedHtml = htmlContent;\r\n    for (const file of confirmedFiles) {\r\n      // Staging URL pattern: /api/staging/preview/{sessionId}/{filename}\r\n      // Find and replace with permanent URL\r\n      const stagingPattern = new RegExp(\r\n        `/api/staging/preview/[^/]+/${file.filename.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}`,\r\n        'g'\r\n      );\r\n      updatedHtml = updatedHtml.replace(stagingPattern, file.url);\r\n    }\r\n\r\n    return {\r\n      html: updatedHtml,\r\n      files: confirmedFiles,\r\n    };\r\n  }\r\n\r\n  static async uploadCommentImage(file: File): Promise<UploadedAsset> {\r\n    const formData = new FormData();\r\n    formData.append('image', file);\r\n\r\n    const response = await fetch(`${API_BASE_URL}/comments/upload-image`, {\r\n      method: 'POST',\r\n      body: formData,\r\n    });\r\n\r\n    const result = await response.json();\r\n    if (!response.ok || !result.success) {\r\n      throw new Error(result.message || 'Upload ·∫£nh b√¨nh lu·∫≠n th·∫•t b·∫°i');\r\n    }\r\n\r\n    return FileUploadAPI.mapDirectUpload(result.file, file.name);\r\n  }\r\n\r\n  static async uploadPrintTemplateImage(file: File): Promise<UploadedAsset> {\r\n    const formData = new FormData();\r\n    formData.append('image', file);\r\n\r\n    const response = await fetch(`${API_BASE_URL}/print-templates/upload-image`, {\r\n      method: 'POST',\r\n      body: formData,\r\n    });\r\n\r\n    const result = await response.json();\r\n    if (!response.ok || !result.success) {\r\n      throw new Error(result.message || 'Upload ·∫£nh m·∫´u in th·∫•t b·∫°i');\r\n    }\r\n\r\n    return FileUploadAPI.mapDirectUpload(result.file, file.name);\r\n  }\r\n\r\n  static async uploadComplaintCommentImage(complaintId: string, file: File): Promise<UploadedAsset> {\r\n    const formData = new FormData();\r\n    formData.append('image', file);\r\n\r\n    const response = await fetch(`${API_BASE_URL}/complaints/${complaintId}/comments/upload`, {\r\n      method: 'POST',\r\n      body: formData,\r\n    });\r\n\r\n    const result = await response.json();\r\n    if (!response.ok || !result.success) {\r\n      throw new Error(result.message || 'Upload ·∫£nh khi·∫øu n·∫°i th·∫•t b·∫°i');\r\n    }\r\n\r\n    return FileUploadAPI.mapDirectUpload(result.file, file.name);\r\n  }\r\n\r\n  static async uploadTaskEvidence(taskId: string, files: File[]): Promise<UploadedAsset[]> {\r\n    if (files.length === 0) {\r\n      return [];\r\n    }\r\n\r\n    const formData = new FormData();\r\n    files.forEach((file) => formData.append('files', file));\r\n\r\n    const response = await fetch(`${API_BASE_URL}/tasks/${taskId}/evidence`, {\r\n      method: 'POST',\r\n      body: formData,\r\n    });\r\n\r\n    const result = await response.json();\r\n    if (!response.ok || !result.success) {\r\n      throw new Error(result.message || 'Upload b·∫±ng ch·ª©ng c√¥ng vi·ªác th·∫•t b·∫°i');\r\n    }\r\n\r\n    return (result.files || []).map((file: any, index: number) =>\r\n      FileUploadAPI.mapDirectUpload(file, files[index]?.name || `evidence-${index}`)\r\n    );\r\n  }\r\n\r\n  private static mapDirectUpload(file: any, fallbackName: string): UploadedAsset {\r\n    return {\r\n      id: file.id,\r\n      name: file.originalName || file.name || fallbackName,\r\n      size: file.size || file.filesize || 0,\r\n      type: file.mimetype || file.type || 'application/octet-stream',\r\n      url: file.url,\r\n      uploadedAt: file.uploadedAt || new Date().toISOString(),\r\n    };\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7649, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/import-export/configs/cost-adjustment.config.ts"],"sourcesContent":["/**\r\n * Cost Adjustment Import/Export Configuration\r\n * \r\n * Nh·∫≠p/Xu·∫•t phi·∫øu ƒëi·ªÅu ch·ªânh gi√° v·ªën\r\n * \r\n * FORMAT:\r\n * - Multi-line: 1 phi·∫øu ƒëi·ªÅu ch·ªânh c√≥ th·ªÉ c√≥ nhi·ªÅu d√≤ng s·∫£n ph·∫©m\r\n * - C√°c d√≤ng c√πng M√£ phi·∫øu s·∫Ω ƒë∆∞·ª£c nh√≥m th√†nh 1 phi·∫øu\r\n */\r\n\r\nimport type { CostAdjustment, CostAdjustmentItem, CostAdjustmentStatus, CostAdjustmentType } from '@/features/cost-adjustments/types';\r\nimport type { ImportExportConfig, FieldConfig } from '../types';\r\nimport { useProductStore } from '@/features/products/store';\r\nimport { useEmployeeStore } from '@/features/employees/store';\r\nimport { asBusinessId, asSystemId } from '@/lib/id-types';\r\n\r\n// ============================================\r\n// HELPER FUNCTIONS\r\n// ============================================\r\n\r\nconst getProductStore = () => useProductStore.getState();\r\nconst getEmployeeStore = () => useEmployeeStore.getState();\r\n\r\nconst findProduct = (identifier: string) => {\r\n  if (!identifier) return undefined;\r\n  const store = getProductStore();\r\n  const normalized = identifier.trim().toUpperCase();\r\n  \r\n  const byId = store.data.find(p => p.id.toUpperCase() === normalized);\r\n  if (byId) return byId;\r\n  \r\n  const bySku = store.data.find(p => p.sku?.toUpperCase() === normalized);\r\n  return bySku;\r\n};\r\n\r\nconst findEmployee = (name: string) => {\r\n  if (!name) return undefined;\r\n  const store = getEmployeeStore();\r\n  const normalized = name.trim().toLowerCase();\r\n  return store.data.find(e => e.fullName?.toLowerCase().includes(normalized));\r\n};\r\n\r\n// ============================================\r\n// IMPORT ROW TYPE\r\n// ============================================\r\n\r\ninterface CostAdjustmentImportRow {\r\n  adjustmentId: string;\r\n  type?: string;\r\n  status?: string;\r\n  createdDate?: string;\r\n  createdByName?: string;\r\n  reason?: string;\r\n  note?: string;\r\n  referenceCode?: string;\r\n  // Line item\r\n  productIdOrSku: string;\r\n  productName?: string;\r\n  oldCostPrice: number;\r\n  newCostPrice: number;\r\n  itemReason?: string;\r\n}\r\n\r\n// ============================================\r\n// FIELD CONFIGURATION\r\n// ============================================\r\n\r\nexport const costAdjustmentFields: FieldConfig<CostAdjustmentImportRow>[] = [\r\n  // Phi·∫øu ƒëi·ªÅu ch·ªânh\r\n  {\r\n    key: 'adjustmentId',\r\n    label: 'M√£ phi·∫øu (*)',\r\n    type: 'string',\r\n    required: true,\r\n    example: 'DCGV001',\r\n    group: 'Phi·∫øu ƒëi·ªÅu ch·ªânh',\r\n    defaultSelected: true,\r\n  },\r\n  {\r\n    key: 'type',\r\n    label: 'Lo·∫°i',\r\n    type: 'string',\r\n    required: false,\r\n    example: 'manual',\r\n    group: 'Phi·∫øu ƒëi·ªÅu ch·ªânh',\r\n  },\r\n  {\r\n    key: 'status',\r\n    label: 'Tr·∫°ng th√°i',\r\n    type: 'string',\r\n    required: false,\r\n    example: 'draft',\r\n    group: 'Phi·∫øu ƒëi·ªÅu ch·ªânh',\r\n  },\r\n  {\r\n    key: 'createdDate',\r\n    label: 'Ng√†y t·∫°o',\r\n    type: 'string',\r\n    required: false,\r\n    example: '2024-01-15',\r\n    group: 'Phi·∫øu ƒëi·ªÅu ch·ªânh',\r\n    defaultSelected: true,\r\n  },\r\n  {\r\n    key: 'createdByName',\r\n    label: 'Ng∆∞·ªùi t·∫°o',\r\n    type: 'string',\r\n    required: false,\r\n    example: 'Nguy·ªÖn VƒÉn A',\r\n    group: 'Phi·∫øu ƒëi·ªÅu ch·ªânh',\r\n  },\r\n  {\r\n    key: 'reason',\r\n    label: 'L√Ω do chung',\r\n    type: 'string',\r\n    required: false,\r\n    example: 'C·∫≠p nh·∫≠t gi√° v·ªën theo th·ªã tr∆∞·ªùng',\r\n    group: 'Phi·∫øu ƒëi·ªÅu ch·ªânh',\r\n  },\r\n  {\r\n    key: 'note',\r\n    label: 'Ghi ch√∫',\r\n    type: 'string',\r\n    required: false,\r\n    example: 'ƒêi·ªÅu ch·ªânh th√°ng 1/2024',\r\n    group: 'Phi·∫øu ƒëi·ªÅu ch·ªânh',\r\n  },\r\n  {\r\n    key: 'referenceCode',\r\n    label: 'M√£ tham chi·∫øu',\r\n    type: 'string',\r\n    required: false,\r\n    example: 'REF001',\r\n    group: 'Phi·∫øu ƒëi·ªÅu ch·ªânh',\r\n  },\r\n  \r\n  // S·∫£n ph·∫©m\r\n  {\r\n    key: 'productIdOrSku',\r\n    label: 'M√£ SP/SKU (*)',\r\n    type: 'string',\r\n    required: true,\r\n    example: 'SP001',\r\n    group: 'S·∫£n ph·∫©m',\r\n    defaultSelected: true,\r\n  },\r\n  {\r\n    key: 'oldCostPrice',\r\n    label: 'Gi√° v·ªën c≈© (*)',\r\n    type: 'number',\r\n    required: true,\r\n    example: '100000',\r\n    group: 'S·∫£n ph·∫©m',\r\n    defaultSelected: true,\r\n  },\r\n  {\r\n    key: 'newCostPrice',\r\n    label: 'Gi√° v·ªën m·ªõi (*)',\r\n    type: 'number',\r\n    required: true,\r\n    example: '120000',\r\n    group: 'S·∫£n ph·∫©m',\r\n    defaultSelected: true,\r\n  },\r\n  {\r\n    key: 'itemReason',\r\n    label: 'L√Ω do SP',\r\n    type: 'string',\r\n    required: false,\r\n    example: 'TƒÉng gi√° nh·∫≠p',\r\n    group: 'S·∫£n ph·∫©m',\r\n  },\r\n];\r\n\r\n// ============================================\r\n// STATUS & TYPE MAPPING\r\n// ============================================\r\n\r\nconst STATUS_MAP: Record<string, CostAdjustmentStatus> = {\r\n  'draft': 'draft',\r\n  'Nh√°p': 'draft',\r\n  'confirmed': 'confirmed',\r\n  'ƒê√£ x√°c nh·∫≠n': 'confirmed',\r\n  'X√°c nh·∫≠n': 'confirmed',\r\n  'cancelled': 'cancelled',\r\n  'ƒê√£ h·ªßy': 'cancelled',\r\n};\r\n\r\nconst TYPE_MAP: Record<string, CostAdjustmentType> = {\r\n  'manual': 'manual',\r\n  'Th·ªß c√¥ng': 'manual',\r\n  'import': 'import',\r\n  'T·ª´ ƒë∆°n nh·∫≠p': 'import',\r\n  'batch': 'batch',\r\n  'H√†ng lo·∫°t': 'batch',\r\n};\r\n\r\n// ============================================\r\n// MAIN CONFIG\r\n// ============================================\r\n\r\nexport const costAdjustmentImportExportConfig: ImportExportConfig<CostAdjustment> = {\r\n  entityType: 'cost-adjustments',\r\n  entityDisplayName: 'ƒêi·ªÅu ch·ªânh gi√° v·ªën',\r\n  \r\n  fields: costAdjustmentFields as unknown as FieldConfig<CostAdjustment>[],\r\n  \r\n  templateFileName: 'Mau_Dieu_Chinh_Gia_Von.xlsx',\r\n  sheetName: 'DieuChinhGiaVon',\r\n  \r\n  // Import settings\r\n  upsertKey: 'id',\r\n  allowUpdate: false,\r\n  allowInsert: true,\r\n  \r\n  requirePreview: true,\r\n  maxRows: 2000,\r\n  maxErrorsAllowed: 0,\r\n  \r\n  // Fill-down for multi-line\r\n  preProcessRows: (rows) => {\r\n    let lastAdjustmentId = '';\r\n    let lastType = '';\r\n    let lastStatus = '';\r\n    let lastCreatedDate = '';\r\n    let lastCreatedBy = '';\r\n    let lastReason = '';\r\n    let lastNote = '';\r\n    \r\n    return rows.map((row: Record<string, unknown>) => {\r\n      if (row.adjustmentId) {\r\n        lastAdjustmentId = String(row.adjustmentId);\r\n        lastType = String(row.type || '');\r\n        lastStatus = String(row.status || '');\r\n        lastCreatedDate = String(row.createdDate || '');\r\n        lastCreatedBy = String(row.createdByName || '');\r\n        lastReason = String(row.reason || '');\r\n        lastNote = String(row.note || '');\r\n      }\r\n      \r\n      return {\r\n        ...row,\r\n        adjustmentId: row.adjustmentId || lastAdjustmentId,\r\n        type: row.type || lastType,\r\n        status: row.status || lastStatus,\r\n        createdDate: row.createdDate || lastCreatedDate,\r\n        createdByName: row.createdByName || lastCreatedBy,\r\n        reason: row.reason || lastReason,\r\n        note: row.note || lastNote,\r\n      };\r\n    });\r\n  },\r\n  \r\n  // Validate each row\r\n  validateRow: (row, _index, existingData, mode) => {\r\n    const errors: Array<{ field?: string; message: string }> = [];\r\n    const importRow = row as unknown as CostAdjustmentImportRow;\r\n    \r\n    if (!importRow.adjustmentId) {\r\n      errors.push({ field: 'adjustmentId', message: 'M√£ phi·∫øu kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng' });\r\n    }\r\n    \r\n    if (!importRow.productIdOrSku) {\r\n      errors.push({ field: 'productIdOrSku', message: 'M√£ SP kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng' });\r\n    }\r\n    \r\n    if (importRow.oldCostPrice === undefined || importRow.oldCostPrice < 0) {\r\n      errors.push({ field: 'oldCostPrice', message: 'Gi√° v·ªën c≈© kh√¥ng h·ª£p l·ªá' });\r\n    }\r\n    \r\n    if (importRow.newCostPrice === undefined || importRow.newCostPrice < 0) {\r\n      errors.push({ field: 'newCostPrice', message: 'Gi√° v·ªën m·ªõi kh√¥ng h·ª£p l·ªá' });\r\n    }\r\n    \r\n    // Check duplicate\r\n    if (mode === 'insert-only' && importRow.adjustmentId) {\r\n      const duplicate = existingData.find(a => \r\n        a.id.toUpperCase() === importRow.adjustmentId.toUpperCase()\r\n      );\r\n      if (duplicate) {\r\n        // Warning only - same adjustment can have multiple lines\r\n      }\r\n    }\r\n    \r\n    return errors;\r\n  },\r\n  \r\n  // Transform: Group rows by adjustmentId and build CostAdjustment objects\r\n  beforeImport: async (data: CostAdjustment[]) => {\r\n    const importRows = data as unknown as CostAdjustmentImportRow[];\r\n    \r\n    // Group rows by adjustmentId\r\n    const adjustmentMap = new Map<string, CostAdjustmentImportRow[]>();\r\n    \r\n    for (const row of importRows) {\r\n      const adjustmentId = row.adjustmentId?.trim();\r\n      if (!adjustmentId) continue;\r\n      \r\n      if (!adjustmentMap.has(adjustmentId)) {\r\n        adjustmentMap.set(adjustmentId, []);\r\n      }\r\n      adjustmentMap.get(adjustmentId)!.push(row);\r\n    }\r\n    \r\n    // Build CostAdjustment objects\r\n    const adjustments: CostAdjustment[] = [];\r\n    const now = new Date().toISOString();\r\n    \r\n    for (const [adjustmentId, rows] of adjustmentMap.entries()) {\r\n      if (rows.length === 0) continue;\r\n      \r\n      const firstRow = rows[0];\r\n      \r\n      // Lookup creator\r\n      const creator = findEmployee(firstRow.createdByName || '');\r\n      \r\n      // Build items\r\n      const items: CostAdjustmentItem[] = [];\r\n      for (const row of rows) {\r\n        if (!row.productIdOrSku) continue;\r\n        \r\n        const product = findProduct(row.productIdOrSku || '');\r\n        \r\n        const oldCostPrice = Number(row.oldCostPrice) || 0;\r\n        const newCostPrice = Number(row.newCostPrice) || 0;\r\n        const adjustmentAmount = newCostPrice - oldCostPrice;\r\n        const adjustmentPercent = oldCostPrice > 0 ? (adjustmentAmount / oldCostPrice) * 100 : 0;\r\n        \r\n        items.push({\r\n          productSystemId: product?.systemId || asSystemId(''),\r\n          productId: product?.id || row.productIdOrSku || '',\r\n          productName: product?.name || row.productName || '',\r\n          productImage: product?.images?.[0],\r\n          oldCostPrice,\r\n          newCostPrice,\r\n          adjustmentAmount,\r\n          adjustmentPercent: Math.round(adjustmentPercent * 100) / 100,\r\n          reason: row.itemReason,\r\n        });\r\n      }\r\n      \r\n      if (items.length === 0) continue;\r\n      \r\n      // Map status and type\r\n      const status = STATUS_MAP[firstRow.status || ''] || 'draft';\r\n      const type = TYPE_MAP[firstRow.type || ''] || 'manual';\r\n      \r\n      // Build CostAdjustment object\r\n      const adjustment: CostAdjustment = {\r\n        systemId: asSystemId(''), // Will be generated\r\n        id: asBusinessId(adjustmentId),\r\n        \r\n        type,\r\n        status,\r\n        items,\r\n        \r\n        note: firstRow.note,\r\n        reason: firstRow.reason,\r\n        referenceCode: firstRow.referenceCode,\r\n        \r\n        createdDate: firstRow.createdDate || now,\r\n        createdBySystemId: creator?.systemId || asSystemId(''),\r\n        createdByName: creator?.fullName || firstRow.createdByName || '',\r\n        \r\n        createdAt: now,\r\n        updatedAt: now,\r\n      };\r\n      \r\n      adjustments.push(adjustment);\r\n    }\r\n    \r\n    return adjustments;\r\n  },\r\n};\r\n\r\n// Flatten adjustments for export (multi-line per product)\r\nexport function flattenCostAdjustmentsForExport(adjustments: CostAdjustment[]): CostAdjustmentImportRow[] {\r\n  const rows: CostAdjustmentImportRow[] = [];\r\n  \r\n  for (const adjustment of adjustments) {\r\n    for (let i = 0; i < adjustment.items.length; i++) {\r\n      const item = adjustment.items[i];\r\n      rows.push({\r\n        adjustmentId: i === 0 ? adjustment.id : '',\r\n        type: i === 0 ? adjustment.type : '',\r\n        status: i === 0 ? adjustment.status : '',\r\n        createdDate: i === 0 ? adjustment.createdDate : '',\r\n        createdByName: i === 0 ? adjustment.createdByName : '',\r\n        reason: i === 0 ? adjustment.reason : '',\r\n        note: i === 0 ? adjustment.note : '',\r\n        referenceCode: i === 0 ? adjustment.referenceCode : '',\r\n        productIdOrSku: item.productId,\r\n        productName: item.productName,\r\n        oldCostPrice: item.oldCostPrice,\r\n        newCostPrice: item.newCostPrice,\r\n        itemReason: item.reason,\r\n      });\r\n    }\r\n  }\r\n  \r\n  return rows;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7995, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-service.ts"],"sourcesContent":["import { usePrintTemplateStore } from '@/features/settings/printer/store';\r\nimport { TemplateType, PaperSize } from '@/features/settings/printer/types';\r\nimport { formatDateForDisplay, formatTimeForDisplay, formatDateTimeForDisplay } from '@/lib/date-utils';\r\nimport { getGeneralSettingsSync } from '@/lib/settings-cache';\r\n\r\n// ============================================\r\n// HELPER FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * L·∫•y general-settings t·ª´ cache (loaded from database)\r\n */\r\nexport function getGeneralSettings(): {\r\n  companyName?: string;\r\n  companyAddress?: string;\r\n  phoneNumber?: string;\r\n  email?: string;\r\n  website?: string;\r\n  taxCode?: string;\r\n  logoUrl?: string;\r\n  storeName?: string;\r\n  storeAddress?: string;\r\n  storePhone?: string;\r\n} | null {\r\n  try {\r\n    const settings = getGeneralSettingsSync();\r\n    return {\r\n      companyName: settings.storeName,\r\n      companyAddress: settings.storeAddress,\r\n      phoneNumber: settings.storePhone,\r\n      storeName: settings.storeName,\r\n      storeAddress: settings.storeAddress,\r\n      storePhone: settings.storePhone,\r\n      logoUrl: settings.logoUrl,\r\n    };\r\n  } catch (e) { /* ignore */ }\r\n  return null;\r\n}\r\n\r\n/**\r\n * L·∫•y logo t·ª´ general-settings (fallback khi storeInfo kh√¥ng c√≥ logo)\r\n */\r\nexport function getStoreLogo(storeInfoLogo?: string): string | undefined {\r\n  if (storeInfoLogo) return storeInfoLogo;\r\n  try {\r\n    const settings = getGeneralSettingsSync();\r\n    return settings.logoUrl || undefined;\r\n  } catch (e) { /* ignore */ }\r\n  return undefined;\r\n}\r\n\r\n/**\r\n * Format s·ªë ti·ªÅn theo ƒë·ªãnh d·∫°ng VN\r\n */\r\nexport function formatCurrency(amount: number | undefined | null): string {\r\n  if (amount === undefined || amount === null) return '0';\r\n  return new Intl.NumberFormat('vi-VN').format(amount);\r\n}\r\n\r\n/**\r\n * Chuy·ªÉn s·ªë sang ch·ªØ ti·∫øng Vi·ªát\r\n */\r\nexport function numberToWords(amount: number | undefined | null): string {\r\n  if (!amount || amount === 0) return 'Kh√¥ng ƒë·ªìng';\r\n  \r\n  const units = ['', 'm·ªôt', 'hai', 'ba', 'b·ªën', 'nƒÉm', 's√°u', 'b·∫£y', 't√°m', 'ch√≠n'];\r\n  const positions = ['', 'ngh√¨n', 'tri·ªáu', 't·ª∑', 'ngh√¨n t·ª∑', 'tri·ªáu t·ª∑'];\r\n  \r\n  const readThreeDigits = (num: number): string => {\r\n    const hundred = Math.floor(num / 100);\r\n    const ten = Math.floor((num % 100) / 10);\r\n    const unit = num % 10;\r\n    \r\n    let result = '';\r\n    \r\n    if (hundred > 0) {\r\n      result += units[hundred] + ' trƒÉm ';\r\n    }\r\n    \r\n    if (ten > 1) {\r\n      result += units[ten] + ' m∆∞∆°i ';\r\n      if (unit === 1) {\r\n        result += 'm·ªët ';\r\n      } else if (unit === 5) {\r\n        result += 'lƒÉm ';\r\n      } else if (unit > 0) {\r\n        result += units[unit] + ' ';\r\n      }\r\n    } else if (ten === 1) {\r\n      result += 'm∆∞·ªùi ';\r\n      if (unit === 5) {\r\n        result += 'lƒÉm ';\r\n      } else if (unit > 0) {\r\n        result += units[unit] + ' ';\r\n      }\r\n    } else if (ten === 0 && hundred > 0 && unit > 0) {\r\n      result += 'l·∫ª ' + units[unit] + ' ';\r\n    } else if (unit > 0) {\r\n      result += units[unit] + ' ';\r\n    }\r\n    \r\n    return result.trim();\r\n  };\r\n  \r\n  let result = '';\r\n  let num = Math.abs(Math.round(amount));\r\n  let posIndex = 0;\r\n  \r\n  while (num > 0) {\r\n    const threeDigits = num % 1000;\r\n    if (threeDigits > 0) {\r\n      const words = readThreeDigits(threeDigits);\r\n      result = words + ' ' + positions[posIndex] + ' ' + result;\r\n    }\r\n    num = Math.floor(num / 1000);\r\n    posIndex++;\r\n  }\r\n  \r\n  result = result.trim();\r\n  // Capitalize first letter\r\n  result = result.charAt(0).toUpperCase() + result.slice(1) + ' ƒë·ªìng';\r\n  \r\n  if (amount < 0) {\r\n    result = '√Çm ' + result;\r\n  }\r\n  \r\n  return result;\r\n}\r\n\r\n/**\r\n * Format ng√†y theo ƒë·ªãnh d·∫°ng dd/MM/yyyy\r\n * Uses centralized date-utils for consistent formatting\r\n */\r\nexport function formatDate(date: string | Date | undefined | null): string {\r\n  return formatDateForDisplay(date);\r\n}\r\n\r\n/**\r\n * Format gi·ªù theo ƒë·ªãnh d·∫°ng HH:mm\r\n * Uses centralized date-utils for consistent formatting\r\n */\r\nexport function formatTime(date: string | Date | undefined | null): string {\r\n  return formatTimeForDisplay(date);\r\n}\r\n\r\n/**\r\n * Format ng√†y gi·ªù ƒë·∫ßy ƒë·ªß\r\n * Uses centralized date-utils for consistent formatting\r\n */\r\nexport function formatDateTime(date: string | Date | undefined | null): string {\r\n  return formatDateTimeForDisplay(date);\r\n}\r\n\r\n// ============================================\r\n// PRINT SERVICE\r\n// ============================================\r\n\r\n/**\r\n * CSS styles cho in ·∫•n\r\n */\r\nconst PRINT_STYLES = `\r\n  * { box-sizing: border-box; }\r\n  body { \r\n    font-family: 'Times New Roman', Times, serif;\r\n    font-size: 13px;\r\n    line-height: 1.5;\r\n    margin: 0;\r\n    padding: 20px;\r\n    color: #000;\r\n  }\r\n  h1, h2, h3, h4 { margin: 0.5em 0; }\r\n  h2 { font-size: 18px; font-weight: bold; }\r\n  p { margin: 0.3em 0; }\r\n  table { \r\n    width: 100%; \r\n    border-collapse: collapse; \r\n    margin: 10px 0;\r\n  }\r\n  th, td { \r\n    border: 1px solid #333; \r\n    padding: 6px 8px; \r\n    text-align: left;\r\n    vertical-align: top;\r\n  }\r\n  th { \r\n    background: #f0f0f0; \r\n    font-weight: bold;\r\n  }\r\n  strong { font-weight: bold; }\r\n  em { font-style: italic; }\r\n  hr { border: none; border-top: 1px solid #333; margin: 10px 0; }\r\n  ul { margin: 0.5em 0; padding-left: 25px; list-style-type: disc; }\r\n  ol { margin: 0.5em 0; padding-left: 25px; list-style-type: decimal; }\r\n  li { margin: 0.2em 0; display: list-item; }\r\n  img { max-width: 100%; height: auto; }\r\n  @media print { \r\n    body { padding: 0; } \r\n    @page { margin: 15mm; }\r\n  }\r\n`;\r\n\r\n/**\r\n * Interface cho d·ªØ li·ªáu in\r\n */\r\nexport interface PrintData {\r\n  [key: string]: string | number | boolean | undefined | null | PrintLineItem[];\r\n}\r\n\r\nexport interface PrintLineItem {\r\n  [key: string]: string | number | boolean | undefined | null;\r\n}\r\n\r\n/**\r\n * Replace t·∫•t c·∫£ variables trong template v·ªõi data\r\n */\r\nexport function replaceVariables(template: string, data: PrintData): string {\r\n  let result = template;\r\n  \r\n  // Replace c√°c bi·∫øn ƒë∆°n l·∫ª\r\n  Object.entries(data).forEach(([key, value]) => {\r\n    // N·∫øu kh√¥ng ph·∫£i array (line items), replace tr·ª±c ti·∫øp\r\n    if (!Array.isArray(value)) {\r\n      const placeholder = key.startsWith('{') ? key : `{${key}}`;\r\n      const stringValue = value?.toString() || '';\r\n      result = result.split(placeholder).join(stringValue);\r\n    }\r\n  });\r\n  \r\n  return result;\r\n}\r\n\r\n/**\r\n * T·∫°o HTML rows cho line items (s·∫£n ph·∫©m trong ƒë∆°n h√†ng)\r\n * Template row s·∫Ω ƒë∆∞·ª£c nh√¢n b·∫£n cho m·ªói item\r\n */\r\nexport function generateLineItemsHtml(\r\n  templateRow: string, \r\n  items: PrintLineItem[],\r\n  startIndex: number = 1\r\n): string {\r\n  return items.map((item, index) => {\r\n    let row = templateRow;\r\n    \r\n    // Replace {line_stt} v·ªõi s·ªë th·ª© t·ª±\r\n    row = row.replace(/{line_stt}/g, (startIndex + index).toString());\r\n    \r\n    // Replace c√°c bi·∫øn line_* kh√°c\r\n    Object.entries(item).forEach(([key, value]) => {\r\n      const placeholder = key.startsWith('{') ? key : `{${key}}`;\r\n      const stringValue = value?.toString() || '';\r\n      row = row.split(placeholder).join(stringValue);\r\n    });\r\n    \r\n    return row;\r\n  }).join('\\n');\r\n}\r\n\r\n/**\r\n * T·∫°o n·ªôi dung HTML ƒë·ªÉ in t·ª´ template v√† data\r\n */\r\nexport function generatePrintHtml(\r\n  templateType: TemplateType,\r\n  data: PrintData,\r\n  branchId?: string\r\n): string {\r\n  const store = usePrintTemplateStore.getState();\r\n  const defaultSize = store.getDefaultSize(templateType);\r\n  const template = store.getTemplate(templateType, defaultSize, branchId);\r\n  \r\n  let html = template.content;\r\n  \r\n  // Replace variables\r\n  html = replaceVariables(html, data);\r\n  \r\n  return html;\r\n}\r\n\r\n/**\r\n * In document v·ªõi template\r\n */\r\nexport function printDocument(\r\n  templateType: TemplateType,\r\n  data: PrintData,\r\n  options?: {\r\n    branchId?: string;\r\n    paperSize?: PaperSize;\r\n    title?: string;\r\n  }\r\n): void {\r\n  const store = usePrintTemplateStore.getState();\r\n  const paperSize = options?.paperSize || store.getDefaultSize(templateType);\r\n  const template = store.getTemplate(templateType, paperSize, options?.branchId);\r\n  \r\n  // Generate HTML content\r\n  let html = replaceVariables(template.content, data);\r\n  \r\n  // T·∫°o iframe ·∫©n ƒë·ªÉ in\r\n  const printFrame = document.createElement('iframe');\r\n  printFrame.style.position = 'absolute';\r\n  printFrame.style.top = '-10000px';\r\n  printFrame.style.left = '-10000px';\r\n  document.body.appendChild(printFrame);\r\n  \r\n  const printDoc = printFrame.contentDocument || printFrame.contentWindow?.document;\r\n  if (printDoc) {\r\n    const title = options?.title || `In ${templateType}`;\r\n    \r\n    printDoc.write(`\r\n      <!DOCTYPE html>\r\n      <html>\r\n      <head>\r\n        <title>${title}</title>\r\n        <style>${PRINT_STYLES}</style>\r\n      </head>\r\n      <body>${html}</body>\r\n      </html>\r\n    `);\r\n    printDoc.close();\r\n    \r\n    // ƒê·ª£i load xong r·ªìi in\r\n    setTimeout(() => {\r\n      printFrame.contentWindow?.print();\r\n      // X√≥a iframe sau khi in\r\n      setTimeout(() => {\r\n        if (document.body.contains(printFrame)) {\r\n          document.body.removeChild(printFrame);\r\n        }\r\n      }, 1000);\r\n    }, 100);\r\n  }\r\n}\r\n\r\n/**\r\n * Preview document (tr·∫£ v·ªÅ HTML string)\r\n */\r\nexport function getPreviewHtml(\r\n  templateType: TemplateType,\r\n  data: PrintData,\r\n  options?: {\r\n    branchId?: string;\r\n    paperSize?: PaperSize;\r\n  }\r\n): string {\r\n  const store = usePrintTemplateStore.getState();\r\n  const paperSize = options?.paperSize || store.getDefaultSize(templateType);\r\n  const template = store.getTemplate(templateType, paperSize, options?.branchId);\r\n  \r\n  return replaceVariables(template.content, data);\r\n}\r\n\r\n// ============================================\r\n// DATA MAPPERS - Chuy·ªÉn ƒë·ªïi data t·ª´ entity sang print data\r\n// ============================================\r\n\r\n/**\r\n * Base interface cho store settings (c·∫ßn import t·ª´ settings store)\r\n */\r\nexport interface StoreSettings {\r\n  name?: string;\r\n  address?: string;\r\n  phone?: string;\r\n  hotline?: string;\r\n  email?: string;\r\n  logo?: string;\r\n  fax?: string;\r\n  province?: string;\r\n  website?: string;\r\n  taxCode?: string;\r\n}\r\n\r\n/**\r\n * T·∫°o data cho th√¥ng tin c·ª≠a h√†ng\r\n */\r\nexport function getStoreData(settings: StoreSettings): PrintData {\r\n  const now = new Date();\r\n  const logo = getStoreLogo(settings.logo);\r\n  return {\r\n    '{store_logo}': logo \r\n      ? `<img src=\"${logo}\" alt=\"Logo\" style=\"max-height:60px\"/>` \r\n      : '',\r\n    '{store_name}': settings.name || '',\r\n    '{store_address}': settings.address || '',\r\n    '{store_phone_number}': settings.phone || '',\r\n    '{hotline}': settings.hotline || settings.phone || '',\r\n    '{store_hotline}': settings.hotline || settings.phone || '',\r\n    '{store_email}': settings.email || '',\r\n    '{store_fax}': settings.fax || '',\r\n    '{store_website}': settings.website || '',\r\n    '{store_tax_code}': settings.taxCode || '',\r\n    // Print timestamp - always inject current time\r\n    '{print_date}': formatDate(now),\r\n    '{print_time}': formatTime(now),\r\n  };\r\n}\r\n\r\n/**\r\n * Export default cho ti·ªán import\r\n */\r\nexport const PrintService = {\r\n  formatCurrency,\r\n  numberToWords,\r\n  formatDate,\r\n  formatTime,\r\n  formatDateTime,\r\n  replaceVariables,\r\n  generateLineItemsHtml,\r\n  generatePrintHtml,\r\n  printDocument,\r\n  getPreviewHtml,\r\n  getStoreData,\r\n  getStoreLogo,\r\n};\r\n\r\nexport default PrintService;\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAEA;AACA;;;;AASO,SAAS;IAYd,IAAI;QACF,MAAM,WAAW,IAAA,qJAAsB;QACvC,OAAO;YACL,aAAa,SAAS,SAAS;YAC/B,gBAAgB,SAAS,YAAY;YACrC,aAAa,SAAS,UAAU;YAChC,WAAW,SAAS,SAAS;YAC7B,cAAc,SAAS,YAAY;YACnC,YAAY,SAAS,UAAU;YAC/B,SAAS,SAAS,OAAO;QAC3B;IACF,EAAE,OAAO,GAAG,CAAe;IAC3B,OAAO;AACT;AAKO,SAAS,aAAa,aAAsB;IACjD,IAAI,eAAe,OAAO;IAC1B,IAAI;QACF,MAAM,WAAW,IAAA,qJAAsB;QACvC,OAAO,SAAS,OAAO,IAAI;IAC7B,EAAE,OAAO,GAAG,CAAe;IAC3B,OAAO;AACT;AAKO,SAAS,eAAe,MAAiC;IAC9D,IAAI,WAAW,aAAa,WAAW,MAAM,OAAO;IACpD,OAAO,IAAI,KAAK,YAAY,CAAC,SAAS,MAAM,CAAC;AAC/C;AAKO,SAAS,cAAc,MAAiC;IAC7D,IAAI,CAAC,UAAU,WAAW,GAAG,OAAO;IAEpC,MAAM,QAAQ;QAAC;QAAI;QAAO;QAAO;QAAM;QAAO;QAAO;QAAO;QAAO;QAAO;KAAO;IACjF,MAAM,YAAY;QAAC;QAAI;QAAS;QAAS;QAAM;QAAY;KAAW;IAEtE,MAAM,kBAAkB,CAAC;QACvB,MAAM,UAAU,KAAK,KAAK,CAAC,MAAM;QACjC,MAAM,MAAM,KAAK,KAAK,CAAC,AAAC,MAAM,MAAO;QACrC,MAAM,OAAO,MAAM;QAEnB,IAAI,SAAS;QAEb,IAAI,UAAU,GAAG;YACf,UAAU,KAAK,CAAC,QAAQ,GAAG;QAC7B;QAEA,IAAI,MAAM,GAAG;YACX,UAAU,KAAK,CAAC,IAAI,GAAG;YACvB,IAAI,SAAS,GAAG;gBACd,UAAU;YACZ,OAAO,IAAI,SAAS,GAAG;gBACrB,UAAU;YACZ,OAAO,IAAI,OAAO,GAAG;gBACnB,UAAU,KAAK,CAAC,KAAK,GAAG;YAC1B;QACF,OAAO,IAAI,QAAQ,GAAG;YACpB,UAAU;YACV,IAAI,SAAS,GAAG;gBACd,UAAU;YACZ,OAAO,IAAI,OAAO,GAAG;gBACnB,UAAU,KAAK,CAAC,KAAK,GAAG;YAC1B;QACF,OAAO,IAAI,QAAQ,KAAK,UAAU,KAAK,OAAO,GAAG;YAC/C,UAAU,QAAQ,KAAK,CAAC,KAAK,GAAG;QAClC,OAAO,IAAI,OAAO,GAAG;YACnB,UAAU,KAAK,CAAC,KAAK,GAAG;QAC1B;QAEA,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,SAAS;IACb,IAAI,MAAM,KAAK,GAAG,CAAC,KAAK,KAAK,CAAC;IAC9B,IAAI,WAAW;IAEf,MAAO,MAAM,EAAG;QACd,MAAM,cAAc,MAAM;QAC1B,IAAI,cAAc,GAAG;YACnB,MAAM,QAAQ,gBAAgB;YAC9B,SAAS,QAAQ,MAAM,SAAS,CAAC,SAAS,GAAG,MAAM;QACrD;QACA,MAAM,KAAK,KAAK,CAAC,MAAM;QACvB;IACF;IAEA,SAAS,OAAO,IAAI;IACpB,0BAA0B;IAC1B,SAAS,OAAO,MAAM,CAAC,GAAG,WAAW,KAAK,OAAO,KAAK,CAAC,KAAK;IAE5D,IAAI,SAAS,GAAG;QACd,SAAS,QAAQ;IACnB;IAEA,OAAO;AACT;AAMO,SAAS,WAAW,IAAsC;IAC/D,OAAO,IAAA,+IAAoB,EAAC;AAC9B;AAMO,SAAS,WAAW,IAAsC;IAC/D,OAAO,IAAA,+IAAoB,EAAC;AAC9B;AAMO,SAAS,eAAe,IAAsC;IACnE,OAAO,IAAA,mJAAwB,EAAC;AAClC;AAEA,+CAA+C;AAC/C,gBAAgB;AAChB,+CAA+C;AAE/C;;CAEC,GACD,MAAM,eAAe,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuCtB,CAAC;AAgBM,SAAS,iBAAiB,QAAgB,EAAE,IAAe;IAChE,IAAI,SAAS;IAEb,0BAA0B;IAC1B,OAAO,OAAO,CAAC,MAAM,OAAO,CAAC,CAAC,CAAC,KAAK,MAAM;QACxC,uDAAuD;QACvD,IAAI,CAAC,MAAM,OAAO,CAAC,QAAQ;YACzB,MAAM,cAAc,IAAI,UAAU,CAAC,OAAO,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;YAC1D,MAAM,cAAc,OAAO,cAAc;YACzC,SAAS,OAAO,KAAK,CAAC,aAAa,IAAI,CAAC;QAC1C;IACF;IAEA,OAAO;AACT;AAMO,SAAS,sBACd,WAAmB,EACnB,KAAsB,EACtB,aAAqB,CAAC;IAEtB,OAAO,MAAM,GAAG,CAAC,CAAC,MAAM;QACtB,IAAI,MAAM;QAEV,mCAAmC;QACnC,MAAM,IAAI,OAAO,CAAC,eAAe,CAAC,aAAa,KAAK,EAAE,QAAQ;QAE9D,+BAA+B;QAC/B,OAAO,OAAO,CAAC,MAAM,OAAO,CAAC,CAAC,CAAC,KAAK,MAAM;YACxC,MAAM,cAAc,IAAI,UAAU,CAAC,OAAO,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;YAC1D,MAAM,cAAc,OAAO,cAAc;YACzC,MAAM,IAAI,KAAK,CAAC,aAAa,IAAI,CAAC;QACpC;QAEA,OAAO;IACT,GAAG,IAAI,CAAC;AACV;AAKO,SAAS,kBACd,YAA0B,EAC1B,IAAe,EACf,QAAiB;IAEjB,MAAM,QAAQ,oKAAqB,CAAC,QAAQ;IAC5C,MAAM,cAAc,MAAM,cAAc,CAAC;IACzC,MAAM,WAAW,MAAM,WAAW,CAAC,cAAc,aAAa;IAE9D,IAAI,OAAO,SAAS,OAAO;IAE3B,oBAAoB;IACpB,OAAO,iBAAiB,MAAM;IAE9B,OAAO;AACT;AAKO,SAAS,cACd,YAA0B,EAC1B,IAAe,EACf,OAIC;IAED,MAAM,QAAQ,oKAAqB,CAAC,QAAQ;IAC5C,MAAM,YAAY,SAAS,aAAa,MAAM,cAAc,CAAC;IAC7D,MAAM,WAAW,MAAM,WAAW,CAAC,cAAc,WAAW,SAAS;IAErE,wBAAwB;IACxB,IAAI,OAAO,iBAAiB,SAAS,OAAO,EAAE;IAE9C,sBAAsB;IACtB,MAAM,aAAa,SAAS,aAAa,CAAC;IAC1C,WAAW,KAAK,CAAC,QAAQ,GAAG;IAC5B,WAAW,KAAK,CAAC,GAAG,GAAG;IACvB,WAAW,KAAK,CAAC,IAAI,GAAG;IACxB,SAAS,IAAI,CAAC,WAAW,CAAC;IAE1B,MAAM,WAAW,WAAW,eAAe,IAAI,WAAW,aAAa,EAAE;IACzE,IAAI,UAAU;QACZ,MAAM,QAAQ,SAAS,SAAS,CAAC,GAAG,EAAE,cAAc;QAEpD,SAAS,KAAK,CAAC,CAAC;;;;eAIL,EAAE,MAAM;eACR,EAAE,aAAa;;YAElB,EAAE,KAAK;;IAEf,CAAC;QACD,SAAS,KAAK;QAEd,uBAAuB;QACvB,WAAW;YACT,WAAW,aAAa,EAAE;YAC1B,wBAAwB;YACxB,WAAW;gBACT,IAAI,SAAS,IAAI,CAAC,QAAQ,CAAC,aAAa;oBACtC,SAAS,IAAI,CAAC,WAAW,CAAC;gBAC5B;YACF,GAAG;QACL,GAAG;IACL;AACF;AAKO,SAAS,eACd,YAA0B,EAC1B,IAAe,EACf,OAGC;IAED,MAAM,QAAQ,oKAAqB,CAAC,QAAQ;IAC5C,MAAM,YAAY,SAAS,aAAa,MAAM,cAAc,CAAC;IAC7D,MAAM,WAAW,MAAM,WAAW,CAAC,cAAc,WAAW,SAAS;IAErE,OAAO,iBAAiB,SAAS,OAAO,EAAE;AAC5C;AAyBO,SAAS,aAAa,QAAuB;IAClD,MAAM,MAAM,IAAI;IAChB,MAAM,OAAO,aAAa,SAAS,IAAI;IACvC,OAAO;QACL,gBAAgB,OACZ,CAAC,UAAU,EAAE,KAAK,sCAAsC,CAAC,GACzD;QACJ,gBAAgB,SAAS,IAAI,IAAI;QACjC,mBAAmB,SAAS,OAAO,IAAI;QACvC,wBAAwB,SAAS,KAAK,IAAI;QAC1C,aAAa,SAAS,OAAO,IAAI,SAAS,KAAK,IAAI;QACnD,mBAAmB,SAAS,OAAO,IAAI,SAAS,KAAK,IAAI;QACzD,iBAAiB,SAAS,KAAK,IAAI;QACnC,eAAe,SAAS,GAAG,IAAI;QAC/B,mBAAmB,SAAS,OAAO,IAAI;QACvC,oBAAoB,SAAS,OAAO,IAAI;QACxC,+CAA+C;QAC/C,gBAAgB,WAAW;QAC3B,gBAAgB,WAAW;IAC7B;AACF;AAKO,MAAM,eAAe;IAC1B;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;AACF;uCAEe"}},
    {"offset": {"line": 8308, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/use-print.ts"],"sourcesContent":["/**\r\n * Hook ƒë·ªÉ s·ª≠ d·ª•ng Print Service trong c√°c component\r\n */\r\n\r\nimport * as React from 'react';\r\nimport type { TemplateType, PaperSize } from '../features/settings/printer/types';\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  replaceVariables,\r\n} from './print-service';\r\nimport { usePrintTemplateStore } from '../features/settings/printer/store';\r\n\r\ninterface PrintOptions {\r\n  /** D·ªØ li·ªáu ƒë·ªÉ thay th·∫ø bi·∫øn trong template */\r\n  data: PrintData;\r\n  /** Line items (s·∫£n ph·∫©m, h√†ng h√≥a) */\r\n  lineItems?: PrintLineItem[];\r\n  /** Kh·ªï gi·∫•y c·ª• th·ªÉ (n·∫øu mu·ªën override default) */\r\n  paperSize?: PaperSize;\r\n  /** Branch ID c·ª• th·ªÉ (n·∫øu mu·ªën override current branch) */\r\n  branchId?: string;\r\n}\r\n\r\ninterface UsePrintResult {\r\n  /** H√†m in t√†i li·ªáu */\r\n  print: (type: TemplateType, options: PrintOptions) => void;\r\n  /** H√†m in nhi·ªÅu t√†i li·ªáu c√πng l√∫c (g·ªôp th√†nh 1 document) */\r\n  printMultiple: (type: TemplateType, optionsList: PrintOptions[]) => void;\r\n  /** H√†m in nhi·ªÅu lo·∫°i t√†i li·ªáu kh√°c nhau c√πng l√∫c (g·ªôp th√†nh 1 popup) */\r\n  printMixedDocuments: (documents: Array<{ type: TemplateType; options: PrintOptions }>) => void;\r\n  /** H√†m l·∫•y HTML preview */\r\n  getPreview: (type: TemplateType, options: PrintOptions) => string;\r\n  /** Ki·ªÉm tra template c√≥ t·ªìn t·∫°i kh√¥ng */\r\n  hasTemplate: (type: TemplateType, paperSize?: PaperSize) => boolean;\r\n  /** L·∫•y danh s√°ch kh·ªï gi·∫•y c√≥ template */\r\n  getAvailableSizes: (type: TemplateType) => PaperSize[];\r\n  /** L·∫•y kh·ªï gi·∫•y m·∫∑c ƒë·ªãnh cho lo·∫°i template */\r\n  getDefaultSize: (type: TemplateType) => PaperSize;\r\n  /** ƒêang loading template store */\r\n  isLoading: boolean;\r\n}\r\n\r\n/**\r\n * Ki·ªÉm tra gi√° tr·ªã c√≥ \"empty\" kh√¥ng (null, undefined, '', '0', 0)\r\n */\r\nfunction isEmptyValue(value: unknown): boolean {\r\n  if (value === undefined || value === null || value === '') return true;\r\n  // Coi '0' v√† c√°c bi·∫øn th·ªÉ nh∆∞ empty\r\n  const strValue = String(value).trim();\r\n  if (strValue === '0' || strValue === '0ƒë' || strValue === '0 ƒë') return true;\r\n  return false;\r\n}\r\n\r\n/**\r\n * X·ª≠ l√Ω c√°c ƒëi·ªÅu ki·ªán trong template\r\n * H·ªó tr·ª£:\r\n * - {{#if has_tax}}...{{/if}} - ƒêi·ªÅu ki·ªán boolean\r\n * - {{#if_empty {field}}}...{{/if_empty}} - N·∫øu field r·ªóng\r\n * - {{#if_not_empty {field}}}...{{/if_not_empty}} - N·∫øu field kh√¥ng r·ªóng\r\n * - {{#if_gt {field} value}}...{{/if_gt}} - N·∫øu field > value (greater than)\r\n */\r\nfunction processConditionals(html: string, data: PrintData, lineItems?: PrintLineItem[]): string {\r\n  let result = html;\r\n\r\n  // 1. X·ª≠ l√Ω {{#if_not_empty {field}}}...{{/if_not_empty}}\r\n  const ifNotEmptyPattern = /\\{\\{#if_not_empty\\s+\\{([^}]+)\\}\\}\\}([\\s\\S]*?)\\{\\{\\/if_not_empty\\}\\}/gi;\r\n  result = result.replace(ifNotEmptyPattern, (match, field, content) => {\r\n    const key = `{${field}}`;\r\n    const value = data[key];\r\n    if (!isEmptyValue(value)) {\r\n      return content;\r\n    }\r\n    return '';\r\n  });\r\n\r\n  // 2. X·ª≠ l√Ω {{#if_empty {field}}}...{{/if_empty}}\r\n  const ifEmptyPattern = /\\{\\{#if_empty\\s+\\{([^}]+)\\}\\}\\}([\\s\\S]*?)\\{\\{\\/if_empty\\}\\}/gi;\r\n  result = result.replace(ifEmptyPattern, (match, field, content) => {\r\n    const key = `{${field}}`;\r\n    const value = data[key];\r\n    if (isEmptyValue(value)) {\r\n      return content;\r\n    }\r\n    return '';\r\n  });\r\n\r\n  // 3. X·ª≠ l√Ω {{#if_gt {field} value}}...{{/if_gt}} (greater than 0)\r\n  const ifGtPattern = /\\{\\{#if_gt\\s+\\{([^}]+)\\}\\s+(\\d+)\\}\\}([\\s\\S]*?)\\{\\{\\/if_gt\\}\\}/gi;\r\n  result = result.replace(ifGtPattern, (match, field, compareValue, content) => {\r\n    const key = `{${field}}`;\r\n    const value = data[key];\r\n    // Parse s·ªë t·ª´ gi√° tr·ªã (lo·∫°i b·ªè d·∫•u ch·∫•m, ƒë, etc.)\r\n    const numValue = parseFloat((value || '0').toString().replace(/[^\\d.-]/g, ''));\r\n    const numCompare = parseFloat(compareValue);\r\n    if (numValue > numCompare) {\r\n      return content;\r\n    }\r\n    return '';\r\n  });\r\n\r\n  // 4. X·ª≠ l√Ω {{#if has_tax}}...{{/if}} - Boolean conditions\r\n  // has_tax = true n·∫øu total_tax > 0\r\n  const hasTax = !isEmptyValue(data['{total_tax}']);\r\n  const hasDiscount = !isEmptyValue(data['{total_discount}']);\r\n  const hasDeliveryFee = !isEmptyValue(data['{delivery_fee}']);\r\n  const hasNote = !isEmptyValue(data['{order_note}']);\r\n\r\n  const booleanConditions: Record<string, boolean> = {\r\n    'has_tax': hasTax,\r\n    'has_discount': hasDiscount,\r\n    'has_delivery_fee': hasDeliveryFee,\r\n    'has_note': hasNote,\r\n    'has_shipping_address': !isEmptyValue(data['{shipping_address}']),\r\n    'has_customer_email': !isEmptyValue(data['{customer_email}']),\r\n    'has_customer_phone': !isEmptyValue(data['{customer_phone_number}']),\r\n  };\r\n\r\n  // X·ª≠ l√Ω {{#if condition}}...{{/if}}\r\n  const ifPattern = /\\{\\{#if\\s+(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/if\\}\\}/gi;\r\n  result = result.replace(ifPattern, (match, condition, content) => {\r\n    if (booleanConditions[condition]) {\r\n      return content;\r\n    }\r\n    return '';\r\n  });\r\n\r\n  // 5. X·ª≠ l√Ω {{#unless condition}}...{{/unless}} (ng∆∞·ª£c l·∫°i v·ªõi if)\r\n  const unlessPattern = /\\{\\{#unless\\s+(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/unless\\}\\}/gi;\r\n  result = result.replace(unlessPattern, (match, condition, content) => {\r\n    if (!booleanConditions[condition]) {\r\n      return content;\r\n    }\r\n    return '';\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * X·ª≠ l√Ω ƒëi·ªÅu ki·ªán cho line items\r\n * V√≠ d·ª•: {{#line_if_not_empty {line_tax_amount}}}...{{/line_if_not_empty}}\r\n */\r\nfunction processLineItemConditionals(rowHtml: string, item: PrintLineItem): string {\r\n  let result = rowHtml;\r\n\r\n  // X·ª≠ l√Ω {{#line_if_not_empty {field}}}...{{/line_if_not_empty}}\r\n  const lineIfNotEmptyPattern = /\\{\\{#line_if_not_empty\\s+\\{([^}]+)\\}\\}\\}([\\s\\S]*?)\\{\\{\\/line_if_not_empty\\}\\}/gi;\r\n  result = result.replace(lineIfNotEmptyPattern, (match, field, content) => {\r\n    const key = `{${field}}`;\r\n    const value = item[key];\r\n    if (!isEmptyValue(value)) {\r\n      return content;\r\n    }\r\n    return '';\r\n  });\r\n\r\n  // X·ª≠ l√Ω {{#line_if_empty {field}}}...{{/line_if_empty}}\r\n  const lineIfEmptyPattern = /\\{\\{#line_if_empty\\s+\\{([^}]+)\\}\\}\\}([\\s\\S]*?)\\{\\{\\/line_if_empty\\}\\}/gi;\r\n  result = result.replace(lineIfEmptyPattern, (match, field, content) => {\r\n    const key = `{${field}}`;\r\n    const value = item[key];\r\n    if (isEmptyValue(value)) {\r\n      return content;\r\n    }\r\n    return '';\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Hook ƒë·ªÉ s·ª≠ d·ª•ng ch·ª©c nƒÉng in trong c√°c trang\r\n * @param currentBranchId - ID c·ªßa branch hi·ªán t·∫°i (optional)\r\n * @example\r\n * const { print, getPreview } = usePrint(currentBranch?.systemId);\r\n * \r\n * // In ƒë∆°n h√†ng\r\n * print('order', {\r\n *   data: mapOrderToPrintData(order, storeSettings),\r\n *   lineItems: mapOrderLineItems(order.items),\r\n * });\r\n */\r\nexport function usePrint(currentBranchId?: string): UsePrintResult {\r\n  const templateStore = usePrintTemplateStore();\r\n  const [isLoading] = React.useState(false);\r\n\r\n  const getTemplateContent = React.useCallback((\r\n    type: TemplateType, \r\n    paperSize?: PaperSize, \r\n    branchId?: string\r\n  ): string | null => {\r\n    // X√°c ƒë·ªãnh paperSize s·ª≠ d·ª•ng\r\n    const size = paperSize || templateStore.getDefaultSize(type);\r\n    const branch = branchId || currentBranchId;\r\n\r\n    // L·∫•y template\r\n    const template = templateStore.getTemplate(type, size, branch);\r\n    if (template?.content) {\r\n      return template.content;\r\n    }\r\n\r\n    // Fallback: th·ª≠ l·∫•y template kh√¥ng c√≥ branch\r\n    const defaultTemplate = templateStore.getTemplate(type, size);\r\n    return defaultTemplate?.content || null;\r\n  }, [templateStore, currentBranchId]);\r\n\r\n  const processTemplate = React.useCallback((\r\n    templateContent: string,\r\n    data: PrintData,\r\n    lineItems?: PrintLineItem[]\r\n  ): string => {\r\n    // B∆∞·ªõc 1: X·ª≠ l√Ω line items n·∫øu c√≥\r\n    let html = templateContent;\r\n    \r\n    console.log('[processTemplate] Starting, lineItems count:', lineItems?.length);\r\n    \r\n    if (lineItems && lineItems.length > 0) {\r\n      // === X·ª¨ L√ù C√ö PH√ÅP {{#line_items}}...{{/line_items}} ===\r\n      // D√†nh cho template l·∫∑p to√†n b·ªô section (m·ªói employee 1 page)\r\n      const lineItemsBlockPattern = /\\{\\{#line_items\\}\\}([\\s\\S]*?)\\{\\{\\/line_items\\}\\}/gi;\r\n      const lineItemsBlockMatch = html.match(lineItemsBlockPattern);\r\n      \r\n      console.log('[processTemplate] Block match found:', !!lineItemsBlockMatch, lineItemsBlockMatch?.length);\r\n      \r\n      if (lineItemsBlockMatch && lineItemsBlockMatch.length > 0) {\r\n        // C√≥ block {{#line_items}} - l·∫∑p c·∫£ block cho m·ªói item\r\n        html = html.replace(lineItemsBlockPattern, (match, blockContent) => {\r\n          return lineItems.map((item, index) => {\r\n            let itemHtml = blockContent;\r\n            \r\n            // Th√™m {line_index}\r\n            itemHtml = itemHtml.replace(/\\{line_index\\}/g, String(index + 1));\r\n            \r\n            // Replace c√°c bi·∫øn t·ª´ item (line item data)\r\n            Object.entries(item).forEach(([key, value]) => {\r\n              const placeholder = key.startsWith('{') ? key : `{${key}}`;\r\n              const regex = new RegExp(placeholder.replace(/[{}]/g, '\\\\$&'), 'g');\r\n              itemHtml = itemHtml.replace(regex, value?.toString() || '');\r\n            });\r\n            \r\n            // Replace c√°c bi·∫øn global (data) cho m·ªói item page\r\n            Object.entries(data).forEach(([key, value]) => {\r\n              const placeholder = key.startsWith('{') ? key : `{${key}}`;\r\n              const regex = new RegExp(placeholder.replace(/[{}]/g, '\\\\$&'), 'g');\r\n              itemHtml = itemHtml.replace(regex, value?.toString() || '');\r\n            });\r\n            \r\n            return itemHtml;\r\n          }).join('\\n');\r\n        });\r\n        \r\n        // ƒê√£ x·ª≠ l√Ω xong line items theo block mode, skip table mode\r\n      } else {\r\n        // === X·ª¨ L√ù TABLE MODE (c≈©) ===\r\n        // T√¨m t·∫•t c·∫£ c√°c table trong template\r\n        const tablePattern = /<table[^>]*>[\\s\\S]*?<\\/table>/gi;\r\n        const tables = html.match(tablePattern);\r\n      \r\n        if (tables) {\r\n          // T√¨m table ch·ª©a {line_stt} - ƒë√¢y l√† b·∫£ng line items\r\n          const lineItemsTable = tables.find(table => table.includes('{line_stt}'));\r\n        \r\n          if (lineItemsTable) {\r\n            // T√¨m tbody trong table n√†y\r\n            let tbodyMatch = lineItemsTable.match(/<tbody[^>]*>([\\s\\S]*?)<\\/tbody>/i);\r\n          \r\n            // N·∫øu kh√¥ng c√≥ tbody, c√≥ th·ªÉ table ch·ªâ c√≥ tr tr·ª±c ti·∫øp\r\n            // (m·ªôt s·ªë template kh√¥ng d√πng thead/tbody)\r\n            if (!tbodyMatch) {\r\n              // T√¨m t·∫•t c·∫£ tr trong table (tr·ª´ tr trong thead)\r\n              const theadMatch = lineItemsTable.match(/<thead[^>]*>[\\s\\S]*?<\\/thead>/i);\r\n              let tableWithoutThead = lineItemsTable;\r\n              if (theadMatch) {\r\n                tableWithoutThead = lineItemsTable.replace(theadMatch[0], '');\r\n              }\r\n            \r\n              // T√¨m tr ch·ª©a {line_stt}\r\n              const rowPattern = /<tr[^>]*>[\\s\\S]*?\\{line_stt\\}[\\s\\S]*?<\\/tr>/i;\r\n              const rowMatch = tableWithoutThead.match(rowPattern);\r\n            \r\n              if (rowMatch) {\r\n                const templateRow = rowMatch[0];\r\n              \r\n                // T·∫°o c√°c row m·ªõi t·ª´ template\r\n                const rowsHtml = lineItems.map((item) => {\r\n                  let row = templateRow;\r\n                \r\n                  // X·ª≠ l√Ω ƒëi·ªÅu ki·ªán cho line item tr∆∞·ªõc\r\n                  row = processLineItemConditionals(row, item);\r\n                \r\n                  Object.entries(item).forEach(([key, value]) => {\r\n                    const placeholder = key.startsWith('{') ? key : `{${key}}`;\r\n                    const regex = new RegExp(placeholder.replace(/[{}]/g, '\\\\$&'), 'g');\r\n                    row = row.replace(regex, value?.toString() || '');\r\n                  });\r\n                  return row;\r\n                }).join('\\n    ');\r\n              \r\n                // Thay th·∫ø row m·∫´u b·∫±ng c√°c rows m·ªõi\r\n                const newTable = lineItemsTable.replace(templateRow, rowsHtml);\r\n                html = html.replace(lineItemsTable, newTable);\r\n              }\r\n            } else {\r\n              // C√≥ tbody - x·ª≠ l√Ω nh∆∞ c≈©\r\n              const tbodyContent = tbodyMatch[1];\r\n            \r\n              // T√¨m T·∫§T C·∫¢ c√°c row trong tbody\r\n              const allRowsPattern = /<tr[^>]*>[\\s\\S]*?<\\/tr>/gi;\r\n              const allRows = tbodyContent.match(allRowsPattern);\r\n            \r\n              if (allRows && allRows.length > 0) {\r\n                // T√¨m row ch·ª©a {line_stt} - ƒë√¢y l√† row m·∫´u\r\n                const templateRow = allRows.find(row => row.includes('{line_stt}')) || allRows[0];\r\n              \r\n                // T·∫°o c√°c row m·ªõi t·ª´ template\r\n                const rowsHtml = lineItems.map((item) => {\r\n                  let row = templateRow;\r\n                \r\n                  // X·ª≠ l√Ω ƒëi·ªÅu ki·ªán cho line item tr∆∞·ªõc\r\n                  row = processLineItemConditionals(row, item);\r\n                \r\n                  // Replace t·ª´ng bi·∫øn trong item\r\n                  Object.entries(item).forEach(([key, value]) => {\r\n                    const placeholder = key.startsWith('{') ? key : `{${key}}`;\r\n                    const regex = new RegExp(placeholder.replace(/[{}]/g, '\\\\$&'), 'g');\r\n                    row = row.replace(regex, value?.toString() || '');\r\n                  });\r\n                \r\n                  return row;\r\n                }).join('\\n    ');\r\n              \r\n                // T·∫°o tbody m·ªõi\r\n                const newTbody = `<tbody>\\n    ${rowsHtml}\\n  </tbody>`;\r\n              \r\n                // Thay th·∫ø tbody c≈© trong table\r\n                const newTable = lineItemsTable.replace(tbodyMatch[0], newTbody);\r\n              \r\n                // Thay th·∫ø table c≈© b·∫±ng table m·ªõi trong html\r\n                html = html.replace(lineItemsTable, newTable);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } // End of else (TABLE MODE)\r\n    }\r\n\r\n    // B∆∞·ªõc 2: X·ª≠ l√Ω c√°c ƒëi·ªÅu ki·ªán (conditionals)\r\n    html = processConditionals(html, data, lineItems);\r\n\r\n    // B∆∞·ªõc 3: Thay th·∫ø c√°c bi·∫øn c√≤n l·∫°i\r\n    html = replaceVariables(html, data);\r\n\r\n    return html;\r\n  }, []);\r\n\r\n  const print = React.useCallback((type: TemplateType, options: PrintOptions) => {\r\n    const { data, lineItems, paperSize, branchId } = options;\r\n\r\n    console.log('[usePrint] Starting print for type:', type);\r\n    console.log('[usePrint] Data keys:', Object.keys(data));\r\n    console.log('[usePrint] LineItems count:', lineItems?.length || 0);\r\n\r\n    // L·∫•y template content\r\n    const size = paperSize || templateStore.getDefaultSize(type);\r\n    const templateContent = getTemplateContent(type, size, branchId);\r\n    \r\n    if (!templateContent) {\r\n      console.error(`[usePrint] No template found for type: ${type}`);\r\n      return;\r\n    }\r\n\r\n    console.log('[usePrint] Template found, length:', templateContent.length);\r\n\r\n    // X·ª≠ l√Ω template\r\n    let html: string;\r\n    try {\r\n      html = processTemplate(templateContent, data, lineItems);\r\n      console.log('[usePrint] Template processed, html length:', html.length);\r\n    } catch (err) {\r\n      console.error('[usePrint] Error processing template:', err);\r\n      return;\r\n    }\r\n\r\n    // T·∫°o iframe ·∫©n ƒë·ªÉ in\r\n    const printFrame = document.createElement('iframe');\r\n    printFrame.style.position = 'absolute';\r\n    printFrame.style.top = '-10000px';\r\n    printFrame.style.left = '-10000px';\r\n    document.body.appendChild(printFrame);\r\n    \r\n    const printDoc = printFrame.contentDocument || printFrame.contentWindow?.document;\r\n    if (printDoc) {\r\n      // CSS c∆° b·∫£n cho print - gi·ªëng v·ªõi Settings preview\r\n      const printCSS = `\r\n        body { font-family: Arial, sans-serif; font-size: 12px; line-height: 1.5; }\r\n        table { width: 100%; border-collapse: collapse; margin: 8px 0; }\r\n        th, td { border: 1px solid #333; padding: 6px 8px; }\r\n        th { background-color: #f5f5f5; font-weight: bold; }\r\n        .text-center, [style*=\"text-align: center\"] { text-align: center; }\r\n        .text-right, [style*=\"text-align: right\"] { text-align: right; }\r\n        img { max-width: 100%; height: auto; }\r\n        h1, h2, h3 { margin: 8px 0; }\r\n        p { margin: 4px 0; }\r\n      `;\r\n      \r\n      printDoc.write(`\r\n        <!DOCTYPE html>\r\n        <html>\r\n        <head>\r\n          <title>In ${type}</title>\r\n          <style>${printCSS}</style>\r\n        </head>\r\n        <body>${html}</body>\r\n        </html>\r\n      `);\r\n      printDoc.close();\r\n      \r\n      // ƒê·ª£i load xong r·ªìi in\r\n      setTimeout(() => {\r\n        printFrame.contentWindow?.print();\r\n        // X√≥a iframe sau khi in\r\n        setTimeout(() => {\r\n          if (document.body.contains(printFrame)) {\r\n            document.body.removeChild(printFrame);\r\n          }\r\n        }, 1000);\r\n      }, 100);\r\n    }\r\n  }, [getTemplateContent, processTemplate]);\r\n\r\n  /**\r\n   * In nhi·ªÅu t√†i li·ªáu c√πng l√∫c - g·ªôp th√†nh 1 document v·ªõi page break gi·ªØa c√°c t√†i li·ªáu\r\n   */\r\n  const printMultiple = React.useCallback((type: TemplateType, optionsList: PrintOptions[]) => {\r\n    if (optionsList.length === 0) return;\r\n\r\n    // L·∫•y template content (d√πng paperSize c·ªßa item ƒë·∫ßu ti√™n ho·∫∑c default)\r\n    const firstOptions = optionsList[0];\r\n    const size = firstOptions.paperSize || templateStore.getDefaultSize(type);\r\n    const templateContent = getTemplateContent(type, size, firstOptions.branchId);\r\n    \r\n    if (!templateContent) {\r\n      console.error(`[usePrint] No template found for type: ${type}`);\r\n      return;\r\n    }\r\n\r\n    // X·ª≠ l√Ω t·ª´ng document v√† g·ªôp l·∫°i v·ªõi page break\r\n    const allHtmlParts = optionsList.map((options, index) => {\r\n      const html = processTemplate(templateContent, options.data, options.lineItems);\r\n      // Th√™m page break sau m·ªói document (tr·ª´ document cu·ªëi)\r\n      if (index < optionsList.length - 1) {\r\n        return `<div class=\"print-page\" style=\"page-break-after: always; break-after: page;\">${html}</div>`;\r\n      }\r\n      return `<div class=\"print-page-last\">${html}</div>`;\r\n    });\r\n\r\n    const combinedHtml = allHtmlParts.join('\\n');\r\n\r\n    // T·∫°o iframe ·∫©n ƒë·ªÉ in\r\n    const printFrame = document.createElement('iframe');\r\n    printFrame.style.position = 'absolute';\r\n    printFrame.style.top = '-10000px';\r\n    printFrame.style.left = '-10000px';\r\n    document.body.appendChild(printFrame);\r\n    \r\n    const printDoc = printFrame.contentDocument || printFrame.contentWindow?.document;\r\n    if (printDoc) {\r\n      // CSS c∆° b·∫£n cho print v·ªõi page break\r\n      const printCSS = `\r\n        * { box-sizing: border-box; }\r\n        body { font-family: Arial, sans-serif; font-size: 12px; line-height: 1.5; margin: 0; padding: 0; }\r\n        table { width: 100%; border-collapse: collapse; margin: 8px 0; }\r\n        th, td { border: 1px solid #333; padding: 6px 8px; }\r\n        th { background-color: #f5f5f5; font-weight: bold; }\r\n        .text-center, [style*=\"text-align: center\"] { text-align: center; }\r\n        .text-right, [style*=\"text-align: right\"] { text-align: right; }\r\n        img { max-width: 100%; height: auto; }\r\n        h1, h2, h3 { margin: 8px 0; }\r\n        p { margin: 4px 0; }\r\n        .print-page { \r\n          page-break-after: always !important; \r\n          break-after: page !important;\r\n          page-break-inside: avoid;\r\n        }\r\n        .print-page-last { \r\n          page-break-after: auto; \r\n        }\r\n        @media print {\r\n          .print-page { \r\n            page-break-after: always !important; \r\n            break-after: page !important;\r\n          }\r\n          .print-page-last { \r\n            page-break-after: auto; \r\n          }\r\n        }\r\n      `;\r\n      \r\n      printDoc.write(`\r\n        <!DOCTYPE html>\r\n        <html>\r\n        <head>\r\n          <title>In ${optionsList.length} ${type}</title>\r\n          <style>${printCSS}</style>\r\n        </head>\r\n        <body>${combinedHtml}</body>\r\n        </html>\r\n      `);\r\n      printDoc.close();\r\n      \r\n      // ƒê·ª£i load xong r·ªìi in\r\n      setTimeout(() => {\r\n        printFrame.contentWindow?.print();\r\n        // X√≥a iframe sau khi in\r\n        setTimeout(() => {\r\n          if (document.body.contains(printFrame)) {\r\n            document.body.removeChild(printFrame);\r\n          }\r\n        }, 1000);\r\n      }, 100);\r\n    }\r\n  }, [templateStore, getTemplateContent, processTemplate]);\r\n\r\n  /**\r\n   * In nhi·ªÅu lo·∫°i t√†i li·ªáu kh√°c nhau c√πng l√∫c - g·ªôp th√†nh 1 popup duy nh·∫•t\r\n   * V√≠ d·ª•: In ƒë∆°n h√†ng + phi·∫øu giao h√†ng + phi·∫øu ƒë√≥ng g√≥i trong 1 l·∫ßn\r\n   */\r\n  const printMixedDocuments = React.useCallback((documents: Array<{ type: TemplateType; options: PrintOptions }>) => {\r\n    if (documents.length === 0) return;\r\n\r\n    // X·ª≠ l√Ω t·ª´ng document v√† g·ªôp l·∫°i v·ªõi page break\r\n    const allHtmlParts: string[] = [];\r\n    \r\n    documents.forEach((doc, docIndex) => {\r\n      const { type, options } = doc;\r\n      const { data, lineItems, paperSize, branchId } = options;\r\n      \r\n      // L·∫•y template content cho lo·∫°i n√†y\r\n      const size = paperSize || templateStore.getDefaultSize(type);\r\n      const templateContent = getTemplateContent(type, size, branchId);\r\n      \r\n      if (!templateContent) {\r\n        console.warn(`[printMixedDocuments] No template found for type: ${type}, skipping`);\r\n        return;\r\n      }\r\n      \r\n      const html = processTemplate(templateContent, data, lineItems);\r\n      \r\n      // Th√™m page break sau m·ªói document (tr·ª´ document cu·ªëi)\r\n      if (docIndex < documents.length - 1) {\r\n        allHtmlParts.push(`<div class=\"print-page\" style=\"page-break-after: always; break-after: page;\">${html}</div>`);\r\n      } else {\r\n        allHtmlParts.push(`<div class=\"print-page-last\">${html}</div>`);\r\n      }\r\n    });\r\n\r\n    if (allHtmlParts.length === 0) {\r\n      console.error('[printMixedDocuments] No documents to print');\r\n      return;\r\n    }\r\n\r\n    const combinedHtml = allHtmlParts.join('\\n');\r\n\r\n    // T·∫°o iframe ·∫©n ƒë·ªÉ in\r\n    const printFrame = document.createElement('iframe');\r\n    printFrame.style.position = 'absolute';\r\n    printFrame.style.top = '-10000px';\r\n    printFrame.style.left = '-10000px';\r\n    document.body.appendChild(printFrame);\r\n    \r\n    const printDoc = printFrame.contentDocument || printFrame.contentWindow?.document;\r\n    if (printDoc) {\r\n      // CSS c∆° b·∫£n cho print v·ªõi page break\r\n      const printCSS = `\r\n        * { box-sizing: border-box; }\r\n        body { font-family: Arial, sans-serif; font-size: 12px; line-height: 1.5; margin: 0; padding: 0; }\r\n        table { width: 100%; border-collapse: collapse; margin: 8px 0; }\r\n        th, td { border: 1px solid #333; padding: 6px 8px; }\r\n        th { background-color: #f5f5f5; font-weight: bold; }\r\n        .text-center, [style*=\"text-align: center\"] { text-align: center; }\r\n        .text-right, [style*=\"text-align: right\"] { text-align: right; }\r\n        img { max-width: 100%; height: auto; }\r\n        h1, h2, h3 { margin: 8px 0; }\r\n        p { margin: 4px 0; }\r\n        .print-page { \r\n          page-break-after: always !important; \r\n          break-after: page !important;\r\n          page-break-inside: avoid;\r\n        }\r\n        .print-page-last { \r\n          page-break-after: auto; \r\n        }\r\n        @media print {\r\n          .print-page { \r\n            page-break-after: always !important; \r\n            break-after: page !important;\r\n          }\r\n          .print-page-last { \r\n            page-break-after: auto; \r\n          }\r\n        }\r\n      `;\r\n      \r\n      printDoc.write(`\r\n        <!DOCTYPE html>\r\n        <html>\r\n        <head>\r\n          <title>In ${documents.length} t√†i li·ªáu</title>\r\n          <style>${printCSS}</style>\r\n        </head>\r\n        <body>${combinedHtml}</body>\r\n        </html>\r\n      `);\r\n      printDoc.close();\r\n      \r\n      // ƒê·ª£i load xong r·ªìi in\r\n      setTimeout(() => {\r\n        printFrame.contentWindow?.print();\r\n        // X√≥a iframe sau khi in\r\n        setTimeout(() => {\r\n          if (document.body.contains(printFrame)) {\r\n            document.body.removeChild(printFrame);\r\n          }\r\n        }, 1000);\r\n      }, 100);\r\n    }\r\n  }, [templateStore, getTemplateContent, processTemplate]);\r\n\r\n  const getPreview = React.useCallback((type: TemplateType, options: PrintOptions): string => {\r\n    const { data, lineItems, paperSize, branchId } = options;\r\n\r\n    // L·∫•y template content\r\n    const templateContent = getTemplateContent(type, paperSize, branchId);\r\n    if (!templateContent) {\r\n      return '<p style=\"color: red;\">Kh√¥ng t√¨m th·∫•y m·∫´u in</p>';\r\n    }\r\n\r\n    // X·ª≠ l√Ω template\r\n    return processTemplate(templateContent, data, lineItems);\r\n  }, [getTemplateContent, processTemplate]);\r\n\r\n  const hasTemplate = React.useCallback((type: TemplateType, paperSize?: PaperSize): boolean => {\r\n    const size = paperSize || templateStore.getDefaultSize(type);\r\n    const template = templateStore.getTemplate(type, size, currentBranchId);\r\n    return !!template?.content;\r\n  }, [templateStore, currentBranchId]);\r\n\r\n  const getAvailableSizes = React.useCallback((type: TemplateType): PaperSize[] => {\r\n    const sizes: PaperSize[] = ['K57', 'K80', 'A4', 'A5'];\r\n    return sizes.filter(size => {\r\n      const template = templateStore.getTemplate(type, size, currentBranchId);\r\n      return !!template?.content;\r\n    });\r\n  }, [templateStore, currentBranchId]);\r\n\r\n  const getDefaultSize = React.useCallback((type: TemplateType): PaperSize => {\r\n    return templateStore.getDefaultSize(type);\r\n  }, [templateStore]);\r\n\r\n  return {\r\n    print,\r\n    printMultiple,\r\n    printMixedDocuments,\r\n    getPreview,\r\n    hasTemplate,\r\n    getAvailableSizes,\r\n    getDefaultSize,\r\n    isLoading,\r\n  };\r\n}\r\n\r\nexport type { PrintOptions, UsePrintResult };\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8936, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/types.ts"],"sourcesContent":["/**\r\n * Print Mappers - Shared Types\r\n * Types v√† utilities d√πng chung cho t·∫•t c·∫£ mappers\r\n */\r\n\r\nexport { \r\n  formatCurrency, \r\n  numberToWords, \r\n  formatDate, \r\n  formatTime,\r\n  getStoreData,\r\n} from '../print-service';\r\n\r\nexport type { \r\n  PrintData, \r\n  PrintLineItem, \r\n  StoreSettings\r\n} from '../print-service';\r\n\r\n/**\r\n * Helper: ·∫®n 4 s·ªë gi·ªØa c·ªßa SƒêT\r\n * VD: 0912345678 -> 0912***678\r\n */\r\nexport const hidePhoneMiddle = (phone?: string): string => {\r\n  if (!phone || phone.length < 8) return phone || '';\r\n  return phone.slice(0, 4) + '***' + phone.slice(-3);\r\n};\r\n\r\n/**\r\n * Helper: Format ng√†y d·∫°ng ch·ªØ\r\n * VD: 05/12/2025 -> Ng√†y 05 th√°ng 12 nƒÉm 2025\r\n * Note: This is a specific Vietnamese text format, not using date-utils\r\n */\r\nexport const formatDateText = (date?: string | Date): string => {\r\n  if (!date) return '';\r\n  const d = typeof date === 'string' ? new Date(date) : date;\r\n  if (isNaN(d.getTime())) return '';\r\n  const day = d.getDate();\r\n  const month = d.getMonth() + 1;\r\n  const year = d.getFullYear();\r\n  return `Ng√†y ${day} th√°ng ${month} nƒÉm ${year}`;\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;;;CAGC,GAED;;AAkBO,MAAM,kBAAkB,CAAC;IAC9B,IAAI,CAAC,SAAS,MAAM,MAAM,GAAG,GAAG,OAAO,SAAS;IAChD,OAAO,MAAM,KAAK,CAAC,GAAG,KAAK,QAAQ,MAAM,KAAK,CAAC,CAAC;AAClD;AAOO,MAAM,iBAAiB,CAAC;IAC7B,IAAI,CAAC,MAAM,OAAO;IAClB,MAAM,IAAI,OAAO,SAAS,WAAW,IAAI,KAAK,QAAQ;IACtD,IAAI,MAAM,EAAE,OAAO,KAAK,OAAO;IAC/B,MAAM,MAAM,EAAE,OAAO;IACrB,MAAM,QAAQ,EAAE,QAAQ,KAAK;IAC7B,MAAM,OAAO,EAAE,WAAW;IAC1B,OAAO,CAAC,KAAK,EAAE,IAAI,OAAO,EAAE,MAAM,KAAK,EAAE,MAAM;AACjD"}},
    {"offset": {"line": 8967, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/cost-adjustment.mapper.ts"],"sourcesContent":["/**\r\n * Cost Adjustment Mapper - Phi·∫øu ƒëi·ªÅu ch·ªânh gi√° v·ªën\r\n * ƒê·ªìng b·ªô v·ªõi variables/phieu-dieu-chinh-gia-von.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatDate,\r\n  formatTime,\r\n  formatCurrency,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface CostAdjustmentForPrint {\r\n  // Th√¥ng tin c∆° b·∫£n\r\n  code: string;\r\n  createdAt: string | Date;\r\n  modifiedAt?: string | Date;\r\n  confirmedDate?: string | Date;\r\n  cancelledDate?: string | Date;\r\n  createdBy?: string;\r\n  createdByName?: string;\r\n  confirmedBy?: string;\r\n  confirmedByName?: string;\r\n  status?: string;\r\n  reason?: string;\r\n  \r\n  // Th√¥ng tin chi nh√°nh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // Danh s√°ch s·∫£n ph·∫©m\r\n  items: Array<{\r\n    variantCode?: string;\r\n    productName: string;\r\n    variantName?: string;\r\n    barcode?: string;\r\n    unit?: string;\r\n    oldPrice: number;\r\n    newPrice: number;\r\n    difference: number;\r\n    onHand: number;\r\n    totalDifference: number;\r\n    reason?: string;\r\n    brand?: string;\r\n    category?: string;\r\n    variantOptions?: string;\r\n  }>;\r\n  \r\n  // T·ªïng\r\n  totalItems?: number;\r\n  totalDifference?: number;\r\n  totalIncrease?: number;\r\n  totalDecrease?: number;\r\n  \r\n  note?: string;\r\n}\r\n\r\nexport function mapCostAdjustmentToPrintData(adjustment: CostAdjustmentForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === TH√îNG TIN CHI NH√ÅNH ===\r\n    '{location_name}': adjustment.location?.name || storeSettings.name || '',\r\n    '{location_address}': adjustment.location?.address || storeSettings.address || '',\r\n    '{location_province}': adjustment.location?.province || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === TH√îNG TIN PHI·∫æU ƒêI·ªÄU CH·ªàNH ===\r\n    '{code}': adjustment.code,\r\n    '{adjustment_code}': adjustment.code,\r\n    '{created_on}': formatDate(adjustment.createdAt),\r\n    '{created_on_time}': formatTime(adjustment.createdAt),\r\n    '{modified_on}': formatDate(adjustment.modifiedAt),\r\n    '{confirmed_on}': formatDate(adjustment.confirmedDate),\r\n    '{cancelled_on}': formatDate(adjustment.cancelledDate),\r\n    '{account_name}': adjustment.createdByName || adjustment.createdBy || '',\r\n    '{confirmed_by}': adjustment.confirmedByName || adjustment.confirmedBy || '',\r\n    '{status}': adjustment.status || '',\r\n    '{reason}': adjustment.reason || '',\r\n    \r\n    // === T·ªîNG ===\r\n    '{total_items}': adjustment.totalItems?.toString() || '0',\r\n    '{total_difference}': formatCurrency(adjustment.totalDifference),\r\n    '{total_increase}': formatCurrency(adjustment.totalIncrease),\r\n    '{total_decrease}': formatCurrency(adjustment.totalDecrease),\r\n    \r\n    '{note}': adjustment.note || '',\r\n  };\r\n}\r\n\r\nexport function mapCostAdjustmentLineItems(items: CostAdjustmentForPrint['items']): PrintLineItem[] {\r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_variant_code}': item.variantCode || '',\r\n    '{line_product_name}': item.productName,\r\n    '{line_variant_name}': item.variantName || '',\r\n    '{line_variant_barcode}': item.barcode || '',\r\n    '{line_unit}': item.unit || 'C√°i',\r\n    '{line_old_price}': formatCurrency(item.oldPrice),\r\n    '{line_new_price}': formatCurrency(item.newPrice),\r\n    '{line_difference}': formatCurrency(item.difference),\r\n    '{line_on_hand}': item.onHand.toString(),\r\n    '{line_total_difference}': formatCurrency(item.totalDifference),\r\n    '{line_reason}': item.reason || '',\r\n    '{line_brand}': item.brand || '',\r\n    '{line_category}': item.category || '',\r\n    '{line_variant_options}': item.variantOptions || '',\r\n  }));\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;CAGC,GAED;AAAA;;AA0DO,SAAS,6BAA6B,UAAkC,EAAE,aAA4B;IAC3G,OAAO;QACL,GAAG,IAAA,0IAAY,EAAC,cAAc;QAE9B,8BAA8B;QAC9B,mBAAmB,WAAW,QAAQ,EAAE,QAAQ,cAAc,IAAI,IAAI;QACtE,sBAAsB,WAAW,QAAQ,EAAE,WAAW,cAAc,OAAO,IAAI;QAC/E,uBAAuB,WAAW,QAAQ,EAAE,YAAY;QACxD,oBAAoB,cAAc,QAAQ,IAAI;QAE9C,qCAAqC;QACrC,UAAU,WAAW,IAAI;QACzB,qBAAqB,WAAW,IAAI;QACpC,gBAAgB,IAAA,wIAAU,EAAC,WAAW,SAAS;QAC/C,qBAAqB,IAAA,wIAAU,EAAC,WAAW,SAAS;QACpD,iBAAiB,IAAA,wIAAU,EAAC,WAAW,UAAU;QACjD,kBAAkB,IAAA,wIAAU,EAAC,WAAW,aAAa;QACrD,kBAAkB,IAAA,wIAAU,EAAC,WAAW,aAAa;QACrD,kBAAkB,WAAW,aAAa,IAAI,WAAW,SAAS,IAAI;QACtE,kBAAkB,WAAW,eAAe,IAAI,WAAW,WAAW,IAAI;QAC1E,YAAY,WAAW,MAAM,IAAI;QACjC,YAAY,WAAW,MAAM,IAAI;QAEjC,eAAe;QACf,iBAAiB,WAAW,UAAU,EAAE,cAAc;QACtD,sBAAsB,IAAA,4IAAc,EAAC,WAAW,eAAe;QAC/D,oBAAoB,IAAA,4IAAc,EAAC,WAAW,aAAa;QAC3D,oBAAoB,IAAA,4IAAc,EAAC,WAAW,aAAa;QAE3D,UAAU,WAAW,IAAI,IAAI;IAC/B;AACF;AAEO,SAAS,2BAA2B,KAAsC;IAC/E,OAAO,MAAM,GAAG,CAAC,CAAC,MAAM,QAAU,CAAC;YACjC,cAAc,CAAC,QAAQ,CAAC,EAAE,QAAQ;YAClC,uBAAuB,KAAK,WAAW,IAAI;YAC3C,uBAAuB,KAAK,WAAW;YACvC,uBAAuB,KAAK,WAAW,IAAI;YAC3C,0BAA0B,KAAK,OAAO,IAAI;YAC1C,eAAe,KAAK,IAAI,IAAI;YAC5B,oBAAoB,IAAA,4IAAc,EAAC,KAAK,QAAQ;YAChD,oBAAoB,IAAA,4IAAc,EAAC,KAAK,QAAQ;YAChD,qBAAqB,IAAA,4IAAc,EAAC,KAAK,UAAU;YACnD,kBAAkB,KAAK,MAAM,CAAC,QAAQ;YACtC,2BAA2B,IAAA,4IAAc,EAAC,KAAK,eAAe;YAC9D,iBAAiB,KAAK,MAAM,IAAI;YAChC,gBAAgB,KAAK,KAAK,IAAI;YAC9B,mBAAmB,KAAK,QAAQ,IAAI;YACpC,0BAA0B,KAAK,cAAc,IAAI;QACnD,CAAC;AACH"}},
    {"offset": {"line": 9033, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print/cost-adjustment-print-helper.ts"],"sourcesContent":["/**\r\n * Cost Adjustment Print Helper\r\n * Helpers ƒë·ªÉ chu·∫©n b·ªã d·ªØ li·ªáu in cho phi·∫øu ƒëi·ªÅu ch·ªânh gi√° v·ªën\r\n */\r\n\r\nimport type { CostAdjustment, CostAdjustmentItem } from '../../features/cost-adjustments/types';\r\nimport type { Branch } from '../../features/settings/branches/types';\r\nimport type { Employee } from '../../features/employees/types';\r\nimport { \r\n  CostAdjustmentForPrint, \r\n  mapCostAdjustmentToPrintData, \r\n  mapCostAdjustmentLineItems,\r\n} from '../print-mappers/cost-adjustment.mapper';\r\nimport { StoreSettings, getStoreLogo, getGeneralSettings } from '../print-service';\r\n\r\n/**\r\n * Chuy·ªÉn ƒë·ªïi CostAdjustment entity sang CostAdjustmentForPrint\r\n */\r\nexport function convertCostAdjustmentForPrint(\r\n  adjustment: CostAdjustment,\r\n  options: {\r\n    branch?: Branch | null;\r\n    creator?: Employee | null;\r\n    creatorName?: string;\r\n  } = {}\r\n): CostAdjustmentForPrint {\r\n  const { branch, creator, creatorName } = options;\r\n\r\n  // T√≠nh t·ªïng\r\n  const totalItems = adjustment.items.length;\r\n  const totalIncrease = adjustment.items.reduce((sum, item) => \r\n    item.adjustmentAmount > 0 ? sum + item.adjustmentAmount : sum, 0\r\n  );\r\n  const totalDecrease = adjustment.items.reduce((sum, item) => \r\n    item.adjustmentAmount < 0 ? sum + Math.abs(item.adjustmentAmount) : sum, 0\r\n  );\r\n  const totalDifference = adjustment.items.reduce((sum, item) => sum + item.adjustmentAmount, 0);\r\n\r\n  // Map tr·∫°ng th√°i sang ti·∫øng Vi·ªát\r\n  const statusMap: Record<string, string> = {\r\n    'draft': 'Nh√°p',\r\n    'confirmed': 'ƒê√£ x√°c nh·∫≠n',\r\n    'cancelled': 'ƒê√£ h·ªßy',\r\n  };\r\n\r\n  return {\r\n    // Th√¥ng tin c∆° b·∫£n\r\n    code: adjustment.id,\r\n    createdAt: adjustment.createdDate,\r\n    confirmedDate: adjustment.confirmedDate,\r\n    cancelledDate: adjustment.cancelledDate,\r\n    createdBy: adjustment.createdBySystemId,\r\n    createdByName: creator?.fullName || creatorName || adjustment.createdByName,\r\n    confirmedBy: adjustment.confirmedBySystemId,\r\n    confirmedByName: adjustment.confirmedByName,\r\n    status: statusMap[adjustment.status] || adjustment.status,\r\n    reason: adjustment.reason,\r\n    \r\n    // Th√¥ng tin chi nh√°nh\r\n    location: branch ? {\r\n      name: branch.name,\r\n      address: branch.address,\r\n      province: branch.province,\r\n    } : undefined,\r\n    \r\n    // Danh s√°ch s·∫£n ph·∫©m\r\n    items: adjustment.items.map(item => ({\r\n      variantCode: item.productId,\r\n      productName: item.productName,\r\n      unit: 'C√°i',\r\n      oldPrice: item.oldCostPrice,\r\n      newPrice: item.newCostPrice,\r\n      difference: item.adjustmentAmount,\r\n      onHand: 0,\r\n      totalDifference: item.adjustmentAmount,\r\n      reason: item.reason,\r\n    })),\r\n    \r\n    // T·ªïng\r\n    totalItems,\r\n    totalDifference,\r\n    totalIncrease,\r\n    totalDecrease,\r\n    \r\n    note: adjustment.note,\r\n  };\r\n}\r\n\r\n/**\r\n * T·∫°o StoreSettings t·ª´ storeInfo\r\n */\r\nexport function createStoreSettings(storeInfo?: {\r\n  companyName?: string;\r\n  brandName?: string;\r\n  hotline?: string;\r\n  email?: string;\r\n  website?: string;\r\n  taxCode?: string;\r\n  headquartersAddress?: string;\r\n  province?: string;\r\n  logo?: string;\r\n}): StoreSettings {\r\n  // Fallback l·∫•y t·ª´ general-settings n·∫øu storeInfo tr·ªëng\r\n  const generalSettings = getGeneralSettings();\r\n  return {\r\n    name: storeInfo?.companyName || storeInfo?.brandName || generalSettings?.companyName || '',\r\n    address: storeInfo?.headquartersAddress || generalSettings?.companyAddress || '',\r\n    phone: storeInfo?.hotline || generalSettings?.phoneNumber || '',\r\n    email: storeInfo?.email || generalSettings?.email || '',\r\n    website: storeInfo?.website,\r\n    taxCode: storeInfo?.taxCode,\r\n    province: storeInfo?.province,\r\n    logo: getStoreLogo(storeInfo?.logo),\r\n  };\r\n}\r\n\r\n// Re-export mappers\r\nexport {\r\n  mapCostAdjustmentToPrintData,\r\n  mapCostAdjustmentLineItems,\r\n};\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;AAKD;AAKA;;;AAKO,SAAS,8BACd,UAA0B,EAC1B,UAII,CAAC,CAAC;IAEN,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,WAAW,EAAE,GAAG;IAEzC,YAAY;IACZ,MAAM,aAAa,WAAW,KAAK,CAAC,MAAM;IAC1C,MAAM,gBAAgB,WAAW,KAAK,CAAC,MAAM,CAAC,CAAC,KAAK,OAClD,KAAK,gBAAgB,GAAG,IAAI,MAAM,KAAK,gBAAgB,GAAG,KAAK;IAEjE,MAAM,gBAAgB,WAAW,KAAK,CAAC,MAAM,CAAC,CAAC,KAAK,OAClD,KAAK,gBAAgB,GAAG,IAAI,MAAM,KAAK,GAAG,CAAC,KAAK,gBAAgB,IAAI,KAAK;IAE3E,MAAM,kBAAkB,WAAW,KAAK,CAAC,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,KAAK,gBAAgB,EAAE;IAE5F,iCAAiC;IACjC,MAAM,YAAoC;QACxC,SAAS;QACT,aAAa;QACb,aAAa;IACf;IAEA,OAAO;QACL,mBAAmB;QACnB,MAAM,WAAW,EAAE;QACnB,WAAW,WAAW,WAAW;QACjC,eAAe,WAAW,aAAa;QACvC,eAAe,WAAW,aAAa;QACvC,WAAW,WAAW,iBAAiB;QACvC,eAAe,SAAS,YAAY,eAAe,WAAW,aAAa;QAC3E,aAAa,WAAW,mBAAmB;QAC3C,iBAAiB,WAAW,eAAe;QAC3C,QAAQ,SAAS,CAAC,WAAW,MAAM,CAAC,IAAI,WAAW,MAAM;QACzD,QAAQ,WAAW,MAAM;QAEzB,sBAAsB;QACtB,UAAU,SAAS;YACjB,MAAM,OAAO,IAAI;YACjB,SAAS,OAAO,OAAO;YACvB,UAAU,OAAO,QAAQ;QAC3B,IAAI;QAEJ,qBAAqB;QACrB,OAAO,WAAW,KAAK,CAAC,GAAG,CAAC,CAAA,OAAQ,CAAC;gBACnC,aAAa,KAAK,SAAS;gBAC3B,aAAa,KAAK,WAAW;gBAC7B,MAAM;gBACN,UAAU,KAAK,YAAY;gBAC3B,UAAU,KAAK,YAAY;gBAC3B,YAAY,KAAK,gBAAgB;gBACjC,QAAQ;gBACR,iBAAiB,KAAK,gBAAgB;gBACtC,QAAQ,KAAK,MAAM;YACrB,CAAC;QAED,OAAO;QACP;QACA;QACA;QACA;QAEA,MAAM,WAAW,IAAI;IACvB;AACF;AAKO,SAAS,oBAAoB,SAUnC;IACC,uDAAuD;IACvD,MAAM,kBAAkB,IAAA,gJAAkB;IAC1C,OAAO;QACL,MAAM,WAAW,eAAe,WAAW,aAAa,iBAAiB,eAAe;QACxF,SAAS,WAAW,uBAAuB,iBAAiB,kBAAkB;QAC9E,OAAO,WAAW,WAAW,iBAAiB,eAAe;QAC7D,OAAO,WAAW,SAAS,iBAAiB,SAAS;QACrD,SAAS,WAAW;QACpB,SAAS,WAAW;QACpB,UAAU,WAAW;QACrB,MAAM,IAAA,0IAAY,EAAC,WAAW;IAChC;AACF"}}]
}