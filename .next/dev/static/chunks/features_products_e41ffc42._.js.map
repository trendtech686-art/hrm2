{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/api/products-api.ts"],"sourcesContent":["/**\r\n * Products API - Isolated API functions\r\n * \r\n * ⚠️ IMPORTANT: This file should ONLY contain:\r\n * - Fetch functions\r\n * - Type imports from ../types\r\n * - NO store imports\r\n * - NO cross-feature imports\r\n */\r\n\r\nimport type { Product } from '../types';\r\n\r\nconst API_BASE = '/api/products';\r\n\r\nexport interface ProductsParams {\r\n  page?: number;\r\n  limit?: number;\r\n  search?: string;\r\n  categoryId?: string;\r\n  brandId?: string;\r\n  status?: string;\r\n  type?: string;\r\n  inStock?: boolean;\r\n  sortBy?: string;\r\n  sortOrder?: 'asc' | 'desc';\r\n}\r\n\r\nexport interface PaginatedResponse<T> {\r\n  data: T[];\r\n  pagination: {\r\n    page: number;\r\n    limit: number;\r\n    total: number;\r\n    totalPages: number;\r\n  };\r\n}\r\n\r\nexport interface CreateProductInput {\r\n  id?: string;  // Business ID (auto-generated if not provided)\r\n  name: string;\r\n  sku?: string;\r\n  barcode?: string;\r\n  categoryId?: string;\r\n  brandId?: string;\r\n  sellingPrice: number;\r\n  costPrice?: number;\r\n  description?: string;\r\n  images?: string[];\r\n  // Optional fields \r\n  type?: string;\r\n  productTypeSystemId?: string;\r\n  unit?: string;\r\n  prices?: Record<string, number>;\r\n  pkgxId?: number | undefined;\r\n  status?: string;\r\n  inventoryByBranch?: Record<string, number>;\r\n  committedByBranch?: Record<string, number>;\r\n  inTransitByBranch?: Record<string, number>;\r\n  isDeleted?: boolean;\r\n  updatedAt?: string;\r\n}\r\n\r\nexport interface UpdateProductInput extends Partial<CreateProductInput> {\r\n  systemId: string;\r\n  // Legacy field for backward compatibility\r\n  stockQuantity?: number;\r\n}\r\n\r\n/**\r\n * Fetch paginated products list\r\n */\r\nexport async function fetchProducts(params: ProductsParams = {}): Promise<PaginatedResponse<Product>> {\r\n  const { page = 1, limit = 50, ...rest } = params;\r\n  \r\n  const searchParams = new URLSearchParams({\r\n    page: String(page),\r\n    limit: String(limit),\r\n  });\r\n  \r\n  // Add optional params\r\n  Object.entries(rest).forEach(([key, value]) => {\r\n    if (value != null && value !== '') {\r\n      searchParams.set(key, String(value));\r\n    }\r\n  });\r\n  \r\n  const res = await fetch(`${API_BASE}?${searchParams}`, {\r\n    credentials: 'include',\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    throw new Error(`Failed to fetch products: ${res.statusText}`);\r\n  }\r\n  \r\n  return res.json();\r\n}\r\n\r\n/**\r\n * Fetch single product by ID\r\n */\r\nexport async function fetchProduct(id: string): Promise<Product> {\r\n  const res = await fetch(`${API_BASE}/${id}`, {\r\n    credentials: 'include',\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    throw new Error(`Failed to fetch product ${id}: ${res.statusText}`);\r\n  }\r\n  \r\n  return res.json();\r\n}\r\n\r\n/**\r\n * Create new product\r\n */\r\nexport async function createProduct(data: CreateProductInput): Promise<Product> {\r\n  const res = await fetch(API_BASE, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    credentials: 'include',\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    const error = await res.json().catch(() => ({}));\r\n    throw new Error(error.message || `Failed to create product: ${res.statusText}`);\r\n  }\r\n  \r\n  return res.json();\r\n}\r\n\r\n/**\r\n * Update existing product\r\n */\r\nexport async function updateProduct({ systemId, ...data }: UpdateProductInput): Promise<Product> {\r\n  const res = await fetch(`${API_BASE}/${systemId}`, {\r\n    method: 'PATCH',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    credentials: 'include',\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    const error = await res.json().catch(() => ({}));\r\n    throw new Error(error.message || `Failed to update product: ${res.statusText}`);\r\n  }\r\n  \r\n  return res.json();\r\n}\r\n\r\n/**\r\n * Delete product (soft delete)\r\n */\r\nexport async function deleteProduct(id: string): Promise<void> {\r\n  const res = await fetch(`${API_BASE}/${id}`, {\r\n    method: 'DELETE',\r\n    credentials: 'include',\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    const error = await res.json().catch(() => ({}));\r\n    throw new Error(error.message || `Failed to delete product: ${res.statusText}`);\r\n  }\r\n}\r\n\r\n/**\r\n * Search products for autocomplete\r\n */\r\nexport async function searchProducts(query: string, limit = 20): Promise<Product[]> {\r\n  const res = await fetch(`${API_BASE}?search=${encodeURIComponent(query)}&limit=${limit}`, {\r\n    credentials: 'include',\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    throw new Error(`Failed to search products: ${res.statusText}`);\r\n  }\r\n  \r\n  const json = await res.json();\r\n  return json.data || [];\r\n}\r\n\r\n/**\r\n * Fetch product inventory by branch\r\n */\r\nexport async function fetchProductInventory(productId: string): Promise<Record<string, number>> {\r\n  const res = await fetch(`${API_BASE}/${productId}/inventory`, {\r\n    credentials: 'include',\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    throw new Error(`Failed to fetch product inventory: ${res.statusText}`);\r\n  }\r\n  \r\n  return res.json();\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/hooks/use-products.ts"],"sourcesContent":["/**\r\n * useProducts - React Query hooks for products\r\n * \r\n * ⚠️ IMPORTANT: Direct import pattern\r\n * - Import this file directly: import { useProducts } from '@/features/products/hooks/use-products'\r\n * - NEVER import from '@/features/products' or '@/features/products/store'\r\n * \r\n * This hook is ISOLATED - it only depends on:\r\n * - @tanstack/react-query\r\n * - Local API functions\r\n * - Local types\r\n */\r\n\r\nimport { useQuery, useMutation, useQueryClient, keepPreviousData } from '@tanstack/react-query';\r\nimport {\r\n  fetchProducts,\r\n  fetchProduct,\r\n  createProduct,\r\n  updateProduct,\r\n  deleteProduct,\r\n  searchProducts,\r\n  fetchProductInventory,\r\n  type ProductsParams,\r\n  type CreateProductInput,\r\n  type UpdateProductInput,\r\n} from '../api/products-api';\r\n\r\n// Query keys - exported for invalidation\r\nexport const productKeys = {\r\n  all: ['products'] as const,\r\n  lists: () => [...productKeys.all, 'list'] as const,\r\n  list: (params: ProductsParams) => [...productKeys.lists(), params] as const,\r\n  details: () => [...productKeys.all, 'detail'] as const,\r\n  detail: (id: string) => [...productKeys.details(), id] as const,\r\n  search: (query: string) => [...productKeys.all, 'search', query] as const,\r\n  inventory: (id: string) => [...productKeys.all, 'inventory', id] as const,\r\n};\r\n\r\n/**\r\n * Hook for fetching paginated products list\r\n * \r\n * @example\r\n * ```tsx\r\n * function ProductsPage() {\r\n *   const [page, setPage] = useState(1);\r\n *   const { data, isLoading } = useProducts({ page, limit: 50 });\r\n *   \r\n *   return (\r\n *     <DataTable \r\n *       data={data?.data || []} \r\n *       pagination={data?.pagination}\r\n *       onPageChange={setPage}\r\n *     />\r\n *   );\r\n * }\r\n * ```\r\n */\r\nexport function useProducts(params: ProductsParams = {}) {\r\n  return useQuery({\r\n    queryKey: productKeys.list(params),\r\n    queryFn: () => fetchProducts(params),\r\n    staleTime: 60_000, // 1 minute - products don't change frequently\r\n    gcTime: 10 * 60 * 1000, // 10 minutes\r\n    placeholderData: keepPreviousData,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for fetching single product by ID\r\n */\r\nexport function useProduct(id: string | null | undefined) {\r\n  return useQuery({\r\n    queryKey: productKeys.detail(id!),\r\n    queryFn: () => fetchProduct(id!),\r\n    enabled: !!id,\r\n    staleTime: 60_000,\r\n    gcTime: 10 * 60 * 1000,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for searching products (autocomplete)\r\n */\r\nexport function useProductSearch(query: string, limit = 20) {\r\n  return useQuery({\r\n    queryKey: productKeys.search(query),\r\n    queryFn: () => searchProducts(query, limit),\r\n    enabled: query.length >= 2,\r\n    staleTime: 30_000,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for fetching product inventory\r\n */\r\nexport function useProductInventory(productId: string | null | undefined) {\r\n  return useQuery({\r\n    queryKey: productKeys.inventory(productId!),\r\n    queryFn: () => fetchProductInventory(productId!),\r\n    enabled: !!productId,\r\n    staleTime: 30_000, // Inventory can change more frequently\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for product mutations (create/update/delete)\r\n */\r\ninterface UseProductMutationsOptions {\r\n  onCreateSuccess?: (product: unknown) => void;\r\n  onUpdateSuccess?: (product: unknown) => void;\r\n  onDeleteSuccess?: () => void;\r\n  onError?: (error: Error) => void;\r\n}\r\n\r\nexport function useProductMutations(options: UseProductMutationsOptions = {}) {\r\n  const queryClient = useQueryClient();\r\n  \r\n  const create = useMutation({\r\n    mutationFn: createProduct,\r\n    onSuccess: (data) => {\r\n      queryClient.invalidateQueries({ queryKey: productKeys.lists() });\r\n      options.onCreateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const update = useMutation({\r\n    mutationFn: updateProduct,\r\n    onSuccess: (data, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: productKeys.detail(variables.systemId) });\r\n      queryClient.invalidateQueries({ queryKey: productKeys.lists() });\r\n      options.onUpdateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const remove = useMutation({\r\n    mutationFn: deleteProduct,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: productKeys.all });\r\n      options.onDeleteSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  return {\r\n    create,\r\n    update,\r\n    remove,\r\n    isCreating: create.isPending,\r\n    isUpdating: update.isPending,\r\n    isDeleting: remove.isPending,\r\n    isMutating: create.isPending || update.isPending || remove.isPending,\r\n  };\r\n}\r\n\r\n/**\r\n * Hook for getting products by category (for filtering)\r\n */\r\nexport function useProductsByCategory(categoryId: string | null | undefined) {\r\n  return useProducts({ \r\n    categoryId: categoryId || undefined, \r\n    limit: 100 \r\n  });\r\n}\r\n\r\n/**\r\n * Hook for getting products by brand\r\n */\r\nexport function useProductsByBrand(brandId: string | null | undefined) {\r\n  return useProducts({ \r\n    brandId: brandId || undefined, \r\n    limit: 100 \r\n  });\r\n}\r\n\r\n/**\r\n * Hook for getting active products only\r\n */\r\nexport function useActiveProducts(params: Omit<ProductsParams, 'status'> = {}) {\r\n  return useProducts({ ...params, status: 'active' });\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 363, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/hooks/use-all-products.ts"],"sourcesContent":["/**\r\n * useAllProducts - Convenience hook for components needing all products as flat array\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { useProducts } from './use-products';\r\nimport type { Product } from '../types';\r\nimport type { SystemId } from '@/lib/id-types';\r\n\r\nexport function useAllProducts() {\r\n  const query = useProducts({ limit: 50 });\r\n  \r\n  return {\r\n    data: query.data?.data || [] as Product[],\r\n    isLoading: query.isLoading,\r\n    isError: query.isError,\r\n    error: query.error,\r\n  };\r\n}\r\n\r\nexport function useActiveProducts() {\r\n  const { data, isLoading } = useAllProducts();\r\n  const activeProducts = data.filter(p => !p.isDeleted && (p as any).isActive !== false);\r\n  \r\n  return { data: activeProducts, isLoading };\r\n}\r\n\r\n/**\r\n * Helper hook to find a product by ID from cached data\r\n * Replaces legacy findById() method\r\n */\r\nexport function useProductFinder() {\r\n  const { data } = useAllProducts();\r\n  \r\n  const findById = React.useCallback(\r\n    (systemId: SystemId | string | undefined): Product | undefined => {\r\n      if (!systemId) return undefined;\r\n      return data.find(p => p.systemId === systemId);\r\n    },\r\n    [data]\r\n  );\r\n  \r\n  return { findById };\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;CAEC,GAED;AACA;;;;AAIO,SAAS;;IACd,MAAM,QAAQ,IAAA,kKAAW,EAAC;QAAE,OAAO;IAAG;IAEtC,OAAO;QACL,MAAM,MAAM,IAAI,EAAE,QAAQ,EAAE;QAC5B,WAAW,MAAM,SAAS;QAC1B,SAAS,MAAM,OAAO;QACtB,OAAO,MAAM,KAAK;IACpB;AACF;GATgB;;QACA,kKAAW;;;AAUpB,SAAS;;IACd,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG;IAC5B,MAAM,iBAAiB,KAAK,MAAM,CAAC,CAAA,IAAK,CAAC,EAAE,SAAS,IAAI,AAAC,EAAU,QAAQ,KAAK;IAEhF,OAAO;QAAE,MAAM;QAAgB;IAAU;AAC3C;IALgB;;QACc;;;AAUvB,SAAS;;IACd,MAAM,EAAE,IAAI,EAAE,GAAG;IAEjB,MAAM,WAAW,4KAAiB;kDAChC,CAAC;YACC,IAAI,CAAC,UAAU,OAAO;YACtB,OAAO,KAAK,IAAI;0DAAC,CAAA,IAAK,EAAE,QAAQ,KAAK;;QACvC;iDACA;QAAC;KAAK;IAGR,OAAO;QAAE;IAAS;AACpB;IAZgB;;QACG"}},
    {"offset": {"line": 438, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/image-store.ts"],"sourcesContent":["/**\r\n * Product Image Store\r\n * \r\n * Quản lý staging images và permanent images cho products\r\n * Tương tự như document-store.ts của Employee\r\n */\r\n\r\nimport { create } from 'zustand';\r\nimport type { StagingFile } from '@/lib/file-upload-api';\r\n\r\nexport type ProductImageType = 'thumbnail' | 'gallery';\r\n\r\ntype ImageState = {\r\n  // Staging images - chưa confirm, theo sessionId\r\n  stagingImages: Record<string, {\r\n    type: ProductImageType;\r\n    sessionId: string;\r\n    files: StagingFile[];\r\n  }>;\r\n  \r\n  // Permanent images - đã confirm, theo productSystemId\r\n  permanentImages: Record<string, {\r\n    thumbnail: StagingFile[];\r\n    gallery: StagingFile[];\r\n  }>;\r\n  permanentMeta: Record<string, {\r\n    lastFetched: number;\r\n  }>;\r\n  \r\n  // Actions\r\n  updateStagingImage: (\r\n    productSystemId: string,\r\n    type: ProductImageType,\r\n    files: StagingFile[],\r\n    sessionId: string\r\n  ) => void;\r\n  \r\n  clearStagingImages: (productSystemId?: string) => void;\r\n  \r\n  updatePermanentImages: (\r\n    productSystemId: string,\r\n    type: ProductImageType,\r\n    files: StagingFile[],\r\n    fetchedAt?: number\r\n  ) => void;\r\n  \r\n  clearPermanentImages: (productSystemId: string) => void;\r\n  \r\n  getStagingImages: (productSystemId: string, type: ProductImageType) => StagingFile[];\r\n  \r\n  getPermanentImages: (productSystemId: string, type: ProductImageType) => StagingFile[];\r\n  \r\n  getSessionId: (productSystemId: string, type: ProductImageType) => string | undefined;\r\n};\r\n\r\nexport const useImageStore = create<ImageState>((set, get) => ({\r\n  stagingImages: {},\r\n  permanentImages: {},\r\n  permanentMeta: {},\r\n  \r\n  updateStagingImage: (productSystemId, type, files, sessionId) => {\r\n    const key = `${productSystemId}-${type}`;\r\n    set(state => ({\r\n      stagingImages: {\r\n        ...state.stagingImages,\r\n        [key]: { type, sessionId, files }\r\n      }\r\n    }));\r\n  },\r\n  \r\n  clearStagingImages: (productSystemId) => {\r\n    if (productSystemId) {\r\n      set(state => {\r\n        const filtered = Object.entries(state.stagingImages).filter(\r\n          ([key]) => !key.startsWith(productSystemId)\r\n        );\r\n        return { stagingImages: Object.fromEntries(filtered) };\r\n      });\r\n    } else {\r\n      set({ stagingImages: {} });\r\n    }\r\n  },\r\n  \r\n  updatePermanentImages: (productSystemId, type, files, fetchedAt) => {\r\n    set(state => {\r\n      const existing = state.permanentImages[productSystemId] || {\r\n        thumbnail: [],\r\n        gallery: []\r\n      };\r\n\r\n      const timestamp = fetchedAt ?? Date.now();\r\n      return {\r\n        permanentImages: {\r\n          ...state.permanentImages,\r\n          [productSystemId]: {\r\n            ...existing,\r\n            [type]: files\r\n          }\r\n        },\r\n        permanentMeta: {\r\n          ...state.permanentMeta,\r\n          [productSystemId]: {\r\n            lastFetched: timestamp\r\n          }\r\n        }\r\n      };\r\n    });\r\n  },\r\n  \r\n  clearPermanentImages: (productSystemId) => {\r\n    set(state => {\r\n      const { [productSystemId]: _, ...rest } = state.permanentImages;\r\n      const { [productSystemId]: __, ...restMeta } = state.permanentMeta;\r\n      return { permanentImages: rest, permanentMeta: restMeta };\r\n    });\r\n  },\r\n  \r\n  getStagingImages: (productSystemId, type) => {\r\n    const key = `${productSystemId}-${type}`;\r\n    return get().stagingImages[key]?.files || [];\r\n  },\r\n  \r\n  getPermanentImages: (productSystemId, type) => {\r\n    return get().permanentImages[productSystemId]?.[type] || [];\r\n  },\r\n  \r\n  getSessionId: (productSystemId, type) => {\r\n    const key = `${productSystemId}-${type}`;\r\n    return get().stagingImages[key]?.sessionId;\r\n  }\r\n}));\r\n\r\n/**\r\n * Helper: Lấy ảnh sản phẩm với thứ tự ưu tiên đúng\r\n * 1. Ảnh từ server (permanentImages) - upload thực\r\n * 2. Ảnh từ product data (mock/seed data)\r\n */\r\nexport function getProductImageUrl(\r\n  product: { thumbnailImage?: string; galleryImages?: string[]; images?: string[] } | null | undefined,\r\n  serverThumbnail?: string,\r\n  serverGallery?: string\r\n): string | undefined {\r\n  // Ưu tiên 1: Ảnh từ server (upload thực)\r\n  if (serverThumbnail) return serverThumbnail;\r\n  if (serverGallery) return serverGallery;\r\n  \r\n  // Ưu tiên 2: Ảnh từ product data\r\n  if (!product) return undefined;\r\n  return product.thumbnailImage || product.galleryImages?.[0] || product.images?.[0];\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;;;CAKC,GAED;;AAgDO,MAAM,gBAAgB,IAAA,qJAAM,EAAa,CAAC,KAAK,MAAQ,CAAC;QAC7D,eAAe,CAAC;QAChB,iBAAiB,CAAC;QAClB,eAAe,CAAC;QAEhB,oBAAoB,CAAC,iBAAiB,MAAM,OAAO;YACjD,MAAM,MAAM,GAAG,gBAAgB,CAAC,EAAE,MAAM;YACxC,IAAI,CAAA,QAAS,CAAC;oBACZ,eAAe;wBACb,GAAG,MAAM,aAAa;wBACtB,CAAC,IAAI,EAAE;4BAAE;4BAAM;4BAAW;wBAAM;oBAClC;gBACF,CAAC;QACH;QAEA,oBAAoB,CAAC;YACnB,IAAI,iBAAiB;gBACnB,IAAI,CAAA;oBACF,MAAM,WAAW,OAAO,OAAO,CAAC,MAAM,aAAa,EAAE,MAAM,CACzD,CAAC,CAAC,IAAI,GAAK,CAAC,IAAI,UAAU,CAAC;oBAE7B,OAAO;wBAAE,eAAe,OAAO,WAAW,CAAC;oBAAU;gBACvD;YACF,OAAO;gBACL,IAAI;oBAAE,eAAe,CAAC;gBAAE;YAC1B;QACF;QAEA,uBAAuB,CAAC,iBAAiB,MAAM,OAAO;YACpD,IAAI,CAAA;gBACF,MAAM,WAAW,MAAM,eAAe,CAAC,gBAAgB,IAAI;oBACzD,WAAW,EAAE;oBACb,SAAS,EAAE;gBACb;gBAEA,MAAM,YAAY,aAAa,KAAK,GAAG;gBACvC,OAAO;oBACL,iBAAiB;wBACf,GAAG,MAAM,eAAe;wBACxB,CAAC,gBAAgB,EAAE;4BACjB,GAAG,QAAQ;4BACX,CAAC,KAAK,EAAE;wBACV;oBACF;oBACA,eAAe;wBACb,GAAG,MAAM,aAAa;wBACtB,CAAC,gBAAgB,EAAE;4BACjB,aAAa;wBACf;oBACF;gBACF;YACF;QACF;QAEA,sBAAsB,CAAC;YACrB,IAAI,CAAA;gBACF,MAAM,EAAE,CAAC,gBAAgB,EAAE,CAAC,EAAE,GAAG,MAAM,GAAG,MAAM,eAAe;gBAC/D,MAAM,EAAE,CAAC,gBAAgB,EAAE,EAAE,EAAE,GAAG,UAAU,GAAG,MAAM,aAAa;gBAClE,OAAO;oBAAE,iBAAiB;oBAAM,eAAe;gBAAS;YAC1D;QACF;QAEA,kBAAkB,CAAC,iBAAiB;YAClC,MAAM,MAAM,GAAG,gBAAgB,CAAC,EAAE,MAAM;YACxC,OAAO,MAAM,aAAa,CAAC,IAAI,EAAE,SAAS,EAAE;QAC9C;QAEA,oBAAoB,CAAC,iBAAiB;YACpC,OAAO,MAAM,eAAe,CAAC,gBAAgB,EAAE,CAAC,KAAK,IAAI,EAAE;QAC7D;QAEA,cAAc,CAAC,iBAAiB;YAC9B,MAAM,MAAM,GAAG,gBAAgB,CAAC,EAAE,MAAM;YACxC,OAAO,MAAM,aAAa,CAAC,IAAI,EAAE;QACnC;IACF,CAAC;AAOM,SAAS,mBACd,OAAoG,EACpG,eAAwB,EACxB,aAAsB;IAEtB,yCAAyC;IACzC,IAAI,iBAAiB,OAAO;IAC5B,IAAI,eAAe,OAAO;IAE1B,iCAAiC;IACjC,IAAI,CAAC,SAAS,OAAO;IACrB,OAAO,QAAQ,cAAc,IAAI,QAAQ,aAAa,EAAE,CAAC,EAAE,IAAI,QAAQ,MAAM,EAAE,CAAC,EAAE;AACpF"}},
    {"offset": {"line": 543, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/hooks/use-pkgx-sync.ts"],"sourcesContent":["/**\r\n * Hook chứa tất cả các handlers để đồng bộ sản phẩm với PKGX\r\n */\r\nimport React from 'react';\r\nimport { toast } from 'sonner';\r\nimport type { Product } from '../types';\r\nimport { updateProduct, updateMemberPrice, uploadImageFromUrl, processHtmlImagesForPkgx } from '@/lib/pkgx/api-service';\r\nimport { usePkgxSettingsStore } from '@/features/settings/pkgx/store';\r\nimport { useImageStore } from '../image-store';\r\n\r\n// Types\r\ntype PkgxLogEntry = {\r\n  action: \r\n    | 'ping'\r\n    | 'test_connection'\r\n    | 'sync_all'\r\n    | 'sync_price'\r\n    | 'sync_inventory'\r\n    | 'sync_seo'\r\n    | 'sync_description'\r\n    | 'sync_flags'\r\n    | 'sync_basic_info'\r\n    | 'sync_images'\r\n    | 'create_product'\r\n    | 'update_product'\r\n    | 'link_product'\r\n    | 'unlink_product'\r\n    | 'unlink_mapping'\r\n    | 'sync_categories'\r\n    | 'sync_brands'\r\n    | 'get_products'\r\n    | 'upload_image'\r\n    | 'save_config'\r\n    | 'save_mapping';\r\n  status: 'success' | 'error' | 'partial' | 'info';\r\n  message: string;\r\n  details?: Record<string, unknown>;\r\n};\r\n\r\ntype UsePkgxSyncOptions = {\r\n  addPkgxLog: (entry: PkgxLogEntry) => void;\r\n};\r\n\r\n/**\r\n * Hook cung cấp các handlers để đồng bộ sản phẩm với PKGX\r\n */\r\nexport function usePkgxSync({ addPkgxLog }: UsePkgxSyncOptions) {\r\n  const { settings: pkgxSettings } = usePkgxSettingsStore();\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // HELPER: Get price by mapping\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const getPriceByMapping = React.useCallback((product: Product, pkgxPriceField: string): number | undefined => {\r\n    const { priceMapping } = pkgxSettings;\r\n    if (!priceMapping) return undefined;\r\n    \r\n    // priceMapping is PkgxPriceMapping { shopPrice, marketPrice, partnerPrice, acePrice, dealPrice }\r\n    // Each field contains SystemId of HRM pricing policy\r\n    let hrmPriceSystemId: string | null = null;\r\n    \r\n    switch (pkgxPriceField) {\r\n      case 'shopPrice': hrmPriceSystemId = priceMapping.shopPrice; break;\r\n      case 'marketPrice': hrmPriceSystemId = priceMapping.marketPrice; break;\r\n      case 'partnerPrice': hrmPriceSystemId = priceMapping.partnerPrice; break;\r\n      case 'acePrice': hrmPriceSystemId = priceMapping.acePrice; break;\r\n      case 'dealPrice': hrmPriceSystemId = priceMapping.dealPrice; break;\r\n    }\r\n    \r\n    if (!hrmPriceSystemId) return undefined;\r\n    return product.prices?.[hrmPriceSystemId];\r\n  }, [pkgxSettings]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // HELPER: Check if has price mapping\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const hasPriceMapping = React.useMemo(() => {\r\n    const { priceMapping } = pkgxSettings;\r\n    return priceMapping && (\r\n      priceMapping.shopPrice || \r\n      priceMapping.marketPrice || \r\n      priceMapping.partnerPrice || \r\n      priceMapping.acePrice || \r\n      priceMapping.dealPrice\r\n    );\r\n  }, [pkgxSettings]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // HELPER: Get mapped category ID\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const getMappedCategoryId = React.useCallback((product: Product): number | undefined => {\r\n    if (!pkgxSettings?.categoryMappings || !product.categorySystemId) return undefined;\r\n    const mapping = pkgxSettings.categoryMappings.find(m => m.hrmCategorySystemId === product.categorySystemId);\r\n    return mapping?.pkgxCatId;\r\n  }, [pkgxSettings?.categoryMappings]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // HELPER: Get mapped brand ID\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const getMappedBrandId = React.useCallback((product: Product): number | undefined => {\r\n    if (!pkgxSettings?.brandMappings || !product.brandSystemId) return undefined;\r\n    const mapping = pkgxSettings.brandMappings.find(m => m.hrmBrandSystemId === product.brandSystemId);\r\n    return mapping?.pkgxBrandId;\r\n  }, [pkgxSettings?.brandMappings]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // 1. SYNC GIÁ (bao gồm cả giá thành viên ace)\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const handlePkgxUpdatePrice = React.useCallback(async (product: Product) => {\r\n    if (!product.pkgxId) {\r\n      toast.error('Sản phẩm chưa được liên kết với PKGX');\r\n      return;\r\n    }\r\n\r\n    if (!hasPriceMapping) {\r\n      toast.error('Chưa cấu hình mapping giá. Vui lòng vào Cài đặt > PKGX > Mapping Giá để thiết lập.');\r\n      return;\r\n    }\r\n    \r\n    toast.loading(`Đang đồng bộ giá...`, { id: 'pkgx-sync-price' });\r\n    \r\n    try {\r\n      const payload: Record<string, number> = {};\r\n      \r\n      const shopPrice = getPriceByMapping(product, 'shopPrice');\r\n      if (shopPrice !== undefined) payload.shop_price = shopPrice;\r\n      \r\n      const marketPrice = getPriceByMapping(product, 'marketPrice');\r\n      if (marketPrice !== undefined) payload.market_price = marketPrice;\r\n      \r\n      const partnerPrice = getPriceByMapping(product, 'partnerPrice');\r\n      if (partnerPrice !== undefined) payload.partner_price = partnerPrice;\r\n      \r\n      const acePrice = getPriceByMapping(product, 'acePrice');\r\n      if (acePrice !== undefined) payload.ace_price = acePrice;\r\n      \r\n      const dealPrice = getPriceByMapping(product, 'dealPrice');\r\n      if (dealPrice !== undefined) payload.deal_price = dealPrice;\r\n\r\n      if (Object.keys(payload).length === 0) {\r\n        toast.error('Không có giá nào được mapping. Vui lòng kiểm tra cấu hình.', { id: 'pkgx-sync-price' });\r\n        return;\r\n      }\r\n      \r\n      // 1. Sync giá vào bảng goods\r\n      const response = await updateProduct(product.pkgxId, payload);\r\n      \r\n      if (!response.success) {\r\n        throw new Error(response.error);\r\n      }\r\n\r\n      // 2. Sync giá ace vào member_price table (ace = rank_id 8)\r\n      let memberPriceSynced = false;\r\n      if (acePrice !== undefined && acePrice > 0) {\r\n        const memberPriceResponse = await updateMemberPrice(product.pkgxId, [\r\n          { user_rank: 8, user_price: acePrice }\r\n        ]);\r\n        memberPriceSynced = memberPriceResponse.success;\r\n      }\r\n      \r\n      const successMsg = memberPriceSynced \r\n        ? `Đã đồng bộ giá + giá ace thành viên: ${product.name}`\r\n        : `Đã đồng bộ giá: ${product.name}`;\r\n      \r\n      toast.success(successMsg, { id: 'pkgx-sync-price' });\r\n      addPkgxLog({\r\n        action: 'sync_price',\r\n        status: 'success',\r\n        message: successMsg,\r\n        details: { \r\n          productId: product.systemId, \r\n          pkgxId: product.pkgxId, \r\n          prices: payload,\r\n          memberPriceSynced,\r\n          acePrice: acePrice \r\n        },\r\n      });\r\n    } catch (error) {\r\n      toast.error(`Lỗi đồng bộ giá: ${error instanceof Error ? error.message : 'Unknown error'}`, { id: 'pkgx-sync-price' });\r\n      addPkgxLog({\r\n        action: 'sync_price',\r\n        status: 'error',\r\n        message: `Lỗi đồng bộ giá: ${product.name}`,\r\n        details: { productId: product.systemId, error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    }\r\n  }, [hasPriceMapping, getPriceByMapping, addPkgxLog]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // 2. SYNC TỒN KHO\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const handlePkgxSyncInventory = React.useCallback(async (product: Product) => {\r\n    if (!product.pkgxId) {\r\n      toast.error('Sản phẩm chưa được liên kết với PKGX');\r\n      return;\r\n    }\r\n    \r\n    toast.loading(`Đang đồng bộ tồn kho...`, { id: 'pkgx-sync-inventory' });\r\n    \r\n    try {\r\n      const totalInventory = product.inventoryByBranch\r\n        ? Object.values(product.inventoryByBranch).reduce((sum, qty) => sum + (qty || 0), 0)\r\n        : 0;\r\n      \r\n      const response = await updateProduct(product.pkgxId, {\r\n        goods_number: totalInventory,\r\n      });\r\n      \r\n      if (response.success) {\r\n        toast.success(`Đã đồng bộ tồn kho: ${totalInventory} sản phẩm`, { id: 'pkgx-sync-inventory' });\r\n        addPkgxLog({\r\n          action: 'sync_inventory',\r\n          status: 'success',\r\n          message: `Đã đồng bộ tồn kho: ${product.name} (${totalInventory})`,\r\n          details: { productId: product.systemId, pkgxId: product.pkgxId, inventory: totalInventory },\r\n        });\r\n      } else {\r\n        throw new Error(response.error);\r\n      }\r\n    } catch (error) {\r\n      toast.error(`Lỗi đồng bộ tồn kho: ${error instanceof Error ? error.message : 'Unknown error'}`, { id: 'pkgx-sync-inventory' });\r\n      addPkgxLog({\r\n        action: 'sync_inventory',\r\n        status: 'error',\r\n        message: `Lỗi đồng bộ tồn kho: ${product.name}`,\r\n        details: { productId: product.systemId, error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    }\r\n  }, [addPkgxLog]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // 3. SYNC SEO\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const handlePkgxUpdateSeo = React.useCallback(async (product: Product) => {\r\n    if (!product.pkgxId) {\r\n      toast.error('Sản phẩm chưa được liên kết với PKGX');\r\n      return;\r\n    }\r\n    \r\n    toast.loading(`Đang đồng bộ SEO...`, { id: 'pkgx-sync-seo' });\r\n    \r\n    try {\r\n      const pkgxSeo = product.seoPkgx;\r\n      // Fallback chain: SEO PKGX → SEO Chung → tags → name\r\n      const seoPayload = {\r\n        keywords: pkgxSeo?.seoKeywords || product.seoKeywords || product.tags?.join(', ') || product.name,\r\n        meta_title: pkgxSeo?.seoTitle || product.ktitle || product.name,\r\n        meta_desc: pkgxSeo?.metaDescription || product.seoDescription || '',\r\n      };\r\n      \r\n      // DEBUG: Log payload để kiểm tra\r\n      console.log('[PKGX SEO Sync] Product:', product.name);\r\n      console.log('[PKGX SEO Sync] seoPkgx:', product.seoPkgx);\r\n      console.log('[PKGX SEO Sync] SEO Chung - seoKeywords:', product.seoKeywords);\r\n      console.log('[PKGX SEO Sync] Payload being sent:', seoPayload);\r\n      \r\n      const response = await updateProduct(product.pkgxId, seoPayload);\r\n      \r\n      if (response.success) {\r\n        toast.success(`Đã đồng bộ SEO cho sản phẩm: ${product.name}`, { id: 'pkgx-sync-seo' });\r\n        addPkgxLog({\r\n          action: 'sync_seo',\r\n          status: 'success',\r\n          message: `Đã đồng bộ SEO: ${product.name}`,\r\n          details: { productId: product.systemId, pkgxId: product.pkgxId },\r\n        });\r\n      } else {\r\n        throw new Error(response.error);\r\n      }\r\n    } catch (error) {\r\n      toast.error(`Lỗi đồng bộ SEO: ${error instanceof Error ? error.message : 'Unknown error'}`, { id: 'pkgx-sync-seo' });\r\n      addPkgxLog({\r\n        action: 'sync_seo',\r\n        status: 'error',\r\n        message: `Lỗi đồng bộ SEO: ${product.name}`,\r\n        details: { productId: product.systemId, error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    }\r\n  }, [addPkgxLog]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // 4. SYNC MÔ TẢ (với xử lý ảnh trong HTML)\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const handlePkgxSyncDescription = React.useCallback(async (product: Product) => {\r\n    if (!product.pkgxId) {\r\n      toast.error('Sản phẩm chưa được liên kết với PKGX');\r\n      return;\r\n    }\r\n    \r\n    toast.loading(`Đang đồng bộ mô tả...`, { id: 'pkgx-sync-desc' });\r\n    \r\n    try {\r\n      const pkgxSeo = product.seoPkgx;\r\n      \r\n      // Get raw descriptions\r\n      const rawLongDesc = pkgxSeo?.longDescription || product.description || '';\r\n      const rawShortDesc = pkgxSeo?.shortDescription || product.shortDescription || '';\r\n      \r\n      // Process images in long description (upload to PKGX and replace URLs)\r\n      let processedLongDesc = rawLongDesc;\r\n      let imageStats = { uploadedCount: 0, skippedCount: 0, errors: [] as string[] };\r\n      \r\n      if (rawLongDesc.includes('<img')) {\r\n        toast.loading(`Đang xử lý ảnh trong mô tả...`, { id: 'pkgx-sync-desc' });\r\n        \r\n        const filenamePrefix = product.sku || product.id || `product-${product.pkgxId}`;\r\n        const result = await processHtmlImagesForPkgx(rawLongDesc, filenamePrefix);\r\n        \r\n        processedLongDesc = result.processedHtml;\r\n        imageStats = result;\r\n        \r\n        if (result.uploadedCount > 0) {\r\n          toast.loading(`Đã upload ${result.uploadedCount} ảnh, đang cập nhật mô tả...`, { id: 'pkgx-sync-desc' });\r\n        }\r\n      }\r\n      \r\n      // Sync to PKGX\r\n      const response = await updateProduct(product.pkgxId, {\r\n        goods_desc: processedLongDesc,\r\n        goods_brief: rawShortDesc,\r\n      });\r\n      \r\n      if (response.success) {\r\n        const message = imageStats.uploadedCount > 0\r\n          ? `Đã đồng bộ mô tả (${imageStats.uploadedCount} ảnh đã upload)`\r\n          : `Đã đồng bộ mô tả`;\r\n          \r\n        toast.success(message, { id: 'pkgx-sync-desc' });\r\n        addPkgxLog({\r\n          action: 'sync_description',\r\n          status: imageStats.errors.length > 0 ? 'partial' : 'success',\r\n          message: `${message}: ${product.name}`,\r\n          details: { \r\n            productId: product.systemId, \r\n            pkgxId: product.pkgxId,\r\n            imagesUploaded: imageStats.uploadedCount,\r\n            imagesSkipped: imageStats.skippedCount,\r\n            imageErrors: imageStats.errors,\r\n          },\r\n        });\r\n      } else {\r\n        throw new Error(response.error);\r\n      }\r\n    } catch (error) {\r\n      toast.error(`Lỗi đồng bộ mô tả: ${error instanceof Error ? error.message : 'Unknown error'}`, { id: 'pkgx-sync-desc' });\r\n      addPkgxLog({\r\n        action: 'sync_description',\r\n        status: 'error',\r\n        message: `Lỗi đồng bộ mô tả: ${product.name}`,\r\n        details: { productId: product.systemId, error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    }\r\n  }, [addPkgxLog]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // 5. SYNC FLAGS (best, hot, new, ishome, is_on_sale)\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const handlePkgxSyncFlags = React.useCallback(async (product: Product) => {\r\n    if (!product.pkgxId) {\r\n      toast.error('Sản phẩm chưa được liên kết với PKGX');\r\n      return;\r\n    }\r\n    \r\n    toast.loading(`Đang đồng bộ flags...`, { id: 'pkgx-sync-flags' });\r\n    \r\n    try {\r\n      const response = await updateProduct(product.pkgxId, {\r\n        best: product.isFeatured || false,\r\n        hot: product.isBestSeller || false,\r\n        new: product.isNewArrival || false,\r\n        ishome: product.isFeatured || false,\r\n        is_on_sale: product.isPublished ?? (product.status === 'active'),\r\n      });\r\n      \r\n      if (response.success) {\r\n        toast.success(`Đã đồng bộ flags`, { id: 'pkgx-sync-flags' });\r\n        addPkgxLog({\r\n          action: 'sync_flags',\r\n          status: 'success',\r\n          message: `Đã đồng bộ flags: ${product.name}`,\r\n          details: { productId: product.systemId, pkgxId: product.pkgxId },\r\n        });\r\n      } else {\r\n        throw new Error(response.error);\r\n      }\r\n    } catch (error) {\r\n      toast.error(`Lỗi đồng bộ flags: ${error instanceof Error ? error.message : 'Unknown error'}`, { id: 'pkgx-sync-flags' });\r\n      addPkgxLog({\r\n        action: 'sync_flags',\r\n        status: 'error',\r\n        message: `Lỗi đồng bộ flags: ${product.name}`,\r\n        details: { productId: product.systemId, error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    }\r\n  }, [addPkgxLog]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // 6. SYNC THÔNG TIN CƠ BẢN (tên, SKU, category, brand, seller_note)\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const handlePkgxSyncBasicInfo = React.useCallback(async (product: Product) => {\r\n    if (!product.pkgxId) {\r\n      toast.error('Sản phẩm chưa được liên kết với PKGX');\r\n      return;\r\n    }\r\n    \r\n    toast.loading(`Đang đồng bộ thông tin cơ bản...`, { id: 'pkgx-sync-basic' });\r\n    \r\n    try {\r\n      const payload: Record<string, unknown> = {\r\n        goods_name: product.name,\r\n        goods_sn: product.id,\r\n        seller_note: product.sellerNote || '',\r\n      };\r\n\r\n      // Map category nếu có\r\n      const catId = getMappedCategoryId(product);\r\n      if (catId) payload.cat_id = catId;\r\n\r\n      // Map brand nếu có  \r\n      const brandId = getMappedBrandId(product);\r\n      if (brandId) payload.brand_id = brandId;\r\n\r\n      const response = await updateProduct(product.pkgxId, payload);\r\n      \r\n      if (response.success) {\r\n        toast.success(`Đã đồng bộ thông tin cơ bản`, { id: 'pkgx-sync-basic' });\r\n        addPkgxLog({\r\n          action: 'sync_basic_info',\r\n          status: 'success',\r\n          message: `Đã đồng bộ thông tin cơ bản: ${product.name}`,\r\n          details: { productId: product.systemId, pkgxId: product.pkgxId, payload },\r\n        });\r\n      } else {\r\n        throw new Error(response.error);\r\n      }\r\n    } catch (error) {\r\n      toast.error(`Lỗi đồng bộ thông tin cơ bản: ${error instanceof Error ? error.message : 'Unknown error'}`, { id: 'pkgx-sync-basic' });\r\n      addPkgxLog({\r\n        action: 'sync_basic_info',\r\n        status: 'error',\r\n        message: `Lỗi đồng bộ thông tin cơ bản: ${product.name}`,\r\n        details: { productId: product.systemId, error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    }\r\n  }, [getMappedCategoryId, getMappedBrandId, addPkgxLog]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // 7. SYNC HÌNH ẢNH (ảnh đại diện + album gallery)\r\n  // Logic: Fetch ảnh từ HRM server trước, upload lên PKGX, rồi sync đường dẫn\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const handlePkgxSyncImages = React.useCallback(async (product: Product) => {\r\n    if (!product.pkgxId) {\r\n      toast.error('Sản phẩm chưa được liên kết với PKGX');\r\n      return;\r\n    }\r\n\r\n    toast.loading('Đang lấy thông tin hình ảnh...', { id: 'pkgx-sync-images' });\r\n\r\n    // ===== STEP 1: Fetch ảnh từ HRM server =====\r\n    let thumbnailUrls: string[] = [];\r\n    let galleryUrls: string[] = [];\r\n\r\n    // Helper: Kiểm tra URL có thể truy cập từ internet không\r\n    const isPublicUrl = (url: string): boolean => {\r\n      if (!url) return false;\r\n      // Bỏ qua localhost, 127.0.0.1, hoặc internal IP\r\n      if (url.includes('localhost') || url.includes('127.0.0.1') || url.includes('192.168.')) {\r\n        console.log('[PKGX Sync Images] Skipping local URL:', url);\r\n        return false;\r\n      }\r\n      return true;\r\n    };\r\n\r\n    try {\r\n      // Import động để tránh circular dependency\r\n      const { FileUploadAPI } = await import('@/lib/file-upload-api');\r\n      const files = await FileUploadAPI.getProductFiles(product.systemId);\r\n      \r\n      console.log('[PKGX Sync Images] Files from HRM server:', files);\r\n      \r\n      // Phân loại ảnh theo documentName - CHỈ lấy URL public\r\n      for (const file of files) {\r\n        if (file.documentName === 'thumbnail' && file.url && isPublicUrl(file.url)) {\r\n          thumbnailUrls.push(file.url);\r\n        } else if (file.documentName === 'gallery' && file.url && isPublicUrl(file.url)) {\r\n          galleryUrls.push(file.url);\r\n        }\r\n      }\r\n    } catch (fetchError) {\r\n      console.warn('[PKGX Sync Images] Không thể lấy ảnh từ HRM server:', fetchError);\r\n    }\r\n\r\n    // ===== STEP 2: Fallback về product object nếu server không có ảnh =====\r\n    console.log('[PKGX Sync Images] Product:', product.name, 'systemId:', product.systemId);\r\n    console.log('[PKGX Sync Images] Thumbnails from server:', thumbnailUrls);\r\n    console.log('[PKGX Sync Images] Gallery from server:', galleryUrls);\r\n    console.log('[PKGX Sync Images] product.thumbnailImage:', product.thumbnailImage);\r\n    console.log('[PKGX Sync Images] product.galleryImages:', product.galleryImages);\r\n    console.log('[PKGX Sync Images] product.images (legacy):', product.images);\r\n\r\n    // Nếu server không có, dùng từ product object - CHỈ lấy URL public\r\n    if (thumbnailUrls.length === 0 && product.thumbnailImage && isPublicUrl(product.thumbnailImage)) {\r\n      thumbnailUrls.push(product.thumbnailImage);\r\n    }\r\n    if (galleryUrls.length === 0 && product.galleryImages?.length) {\r\n      galleryUrls.push(...product.galleryImages.filter(isPublicUrl));\r\n    }\r\n    // Legacy fallback\r\n    if (thumbnailUrls.length === 0 && galleryUrls.length === 0 && product.images?.length) {\r\n      const publicImages = product.images.filter(isPublicUrl);\r\n      if (publicImages.length > 0) {\r\n        thumbnailUrls.push(publicImages[0]);\r\n        if (publicImages.length > 1) {\r\n          galleryUrls.push(...publicImages.slice(1));\r\n        }\r\n      }\r\n    }\r\n\r\n    // Cũng check image-store (ảnh đã upload vào HRM nhưng chưa fetch từ server)\r\n    const imageStoreState = useImageStore.getState();\r\n    const permanentThumbnails = imageStoreState.getPermanentImages(product.systemId, 'thumbnail');\r\n    const permanentGallery = imageStoreState.getPermanentImages(product.systemId, 'gallery');\r\n\r\n    // Merge với image-store nếu có - CHỈ lấy URL public\r\n    if (permanentThumbnails.length > 0 && thumbnailUrls.length === 0) {\r\n      thumbnailUrls.push(...permanentThumbnails.map(f => f.url).filter(url => url && isPublicUrl(url)));\r\n    }\r\n    if (permanentGallery.length > 0 && galleryUrls.length === 0) {\r\n      galleryUrls.push(...permanentGallery.map(f => f.url).filter(url => url && isPublicUrl(url)));\r\n    }\r\n\r\n    console.log('[PKGX Sync Images] permanentThumbnails from imageStore:', permanentThumbnails);\r\n    console.log('[PKGX Sync Images] permanentGallery from imageStore:', permanentGallery);\r\n\r\n    // Final main image và gallery\r\n    const mainImage = thumbnailUrls[0] || null;\r\n    const galleryImages = galleryUrls;\r\n\r\n    console.log('[PKGX Sync Images] Final mainImage:', mainImage);\r\n    console.log('[PKGX Sync Images] Final galleryImages to sync:', galleryImages);\r\n\r\n    if (!mainImage && galleryImages.length === 0) {\r\n      toast.error('Sản phẩm chưa có hình ảnh', { id: 'pkgx-sync-images' });\r\n      return;\r\n    }\r\n    \r\n    const totalImages = (mainImage ? 1 : 0) + galleryImages.length;\r\n    toast.loading(`Đang đồng bộ ${totalImages} hình ảnh...`, { id: 'pkgx-sync-images' });\r\n    \r\n    try {\r\n      // Tạo slug từ tên sản phẩm cho filename\r\n      const baseSlug = (product.name || 'product')\r\n        .toLowerCase()\r\n        .normalize('NFD')\r\n        .replace(/[\\u0300-\\u036f]/g, '')\r\n        .replace(/đ/g, 'd')\r\n        .replace(/[^a-z0-9]+/g, '-')\r\n        .replace(/^-|-$/g, '')\r\n        .substring(0, 50);\r\n\r\n      let uploadedMainImg: string | null = null;\r\n      const uploadedGalleryPaths: string[] = [];\r\n      let errorCount = 0;\r\n\r\n      // Helper function: Upload ảnh từ URL qua server PKGX (tránh CORS)\r\n      const uploadFromUrl = async (imageUrl: string, slugSuffix: string): Promise<string | null> => {\r\n        try {\r\n          // Kiểm tra nếu là đường dẫn local trên PKGX (đã upload trước đó)\r\n          if (imageUrl.startsWith('images/') || imageUrl.includes('/cdn/images/')) {\r\n            // Đã là path trên PKGX, không cần upload lại\r\n            const cleanPath = imageUrl.replace(/.*\\/cdn\\//, '').replace(/^cdn\\//, '');\r\n            return cleanPath;\r\n          }\r\n\r\n          // Gọi API server-to-server để tránh CORS\r\n          const uploadResult = await uploadImageFromUrl(imageUrl, {\r\n            filenameSlug: `${baseSlug}-${slugSuffix}`,\r\n          });\r\n\r\n          if (!uploadResult.success || !uploadResult.data) {\r\n            throw new Error(uploadResult.error || 'Upload thất bại');\r\n          }\r\n\r\n          // Trả về đường dẫn original_img\r\n          return uploadResult.data.data?.original_img || null;\r\n        } catch (err) {\r\n          console.error(`Lỗi upload ảnh ${imageUrl}:`, err);\r\n          return null;\r\n        }\r\n      };\r\n\r\n      // Upload ảnh đại diện\r\n      if (mainImage) {\r\n        toast.loading(`Đang upload ảnh đại diện...`, { id: 'pkgx-sync-images' });\r\n        uploadedMainImg = await uploadFromUrl(mainImage, 'main');\r\n        if (!uploadedMainImg) {\r\n          errorCount++;\r\n        }\r\n      }\r\n\r\n      // Upload gallery images\r\n      if (galleryImages.length > 0) {\r\n        for (let i = 0; i < galleryImages.length; i++) {\r\n          toast.loading(`Đang upload ảnh ${i + 1}/${galleryImages.length}...`, { id: 'pkgx-sync-images' });\r\n          const galleryPath = await uploadFromUrl(galleryImages[i], `gallery-${i + 1}`);\r\n          if (galleryPath) {\r\n            uploadedGalleryPaths.push(galleryPath);\r\n          } else {\r\n            errorCount++;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Kiểm tra có gì để sync không\r\n      if (!uploadedMainImg && uploadedGalleryPaths.length === 0) {\r\n        throw new Error('Không thể upload bất kỳ ảnh nào');\r\n      }\r\n\r\n      // Build payload để sync vào sản phẩm\r\n      const payload: Record<string, unknown> = {};\r\n      \r\n      if (uploadedMainImg) {\r\n        payload.original_img = uploadedMainImg;\r\n      }\r\n      \r\n      if (uploadedGalleryPaths.length > 0) {\r\n        payload.gallery_images = uploadedGalleryPaths;\r\n      }\r\n\r\n      // Sync đường dẫn vào sản phẩm\r\n      toast.loading(`Đang cập nhật sản phẩm...`, { id: 'pkgx-sync-images' });\r\n      const response = await updateProduct(product.pkgxId, payload);\r\n      \r\n      if (response.success) {\r\n        const syncedCount = (uploadedMainImg ? 1 : 0) + uploadedGalleryPaths.length;\r\n        const message = errorCount > 0 \r\n          ? `Đã đồng bộ ${syncedCount} hình ảnh (${errorCount} lỗi)`\r\n          : `Đã đồng bộ ${syncedCount} hình ảnh`;\r\n        \r\n        toast.success(message, { id: 'pkgx-sync-images' });\r\n        addPkgxLog({\r\n          action: 'sync_images',\r\n          status: errorCount > 0 ? 'partial' : 'success',\r\n          message: `${message}: ${product.name}`,\r\n          details: { \r\n            productId: product.systemId, \r\n            pkgxId: product.pkgxId, \r\n            uploadedMainImg,\r\n            galleryCount: uploadedGalleryPaths.length,\r\n            uploadedGalleryPaths,\r\n            errorCount,\r\n          },\r\n        });\r\n      } else {\r\n        throw new Error(response.error);\r\n      }\r\n    } catch (error) {\r\n      toast.error(`Lỗi đồng bộ hình ảnh: ${error instanceof Error ? error.message : 'Unknown error'}`, { id: 'pkgx-sync-images' });\r\n      addPkgxLog({\r\n        action: 'sync_images',\r\n        status: 'error',\r\n        message: `Lỗi đồng bộ hình ảnh: ${product.name}`,\r\n        details: { productId: product.systemId, error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    }\r\n  }, [addPkgxLog]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // 8. SYNC TẤT CẢ (Full sync, bao gồm xử lý ảnh trong mô tả)\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const handlePkgxSyncAll = React.useCallback(async (product: Product) => {\r\n    if (!product.pkgxId) {\r\n      toast.error('Sản phẩm chưa được liên kết với PKGX');\r\n      return;\r\n    }\r\n    \r\n    toast.loading(`Đang đồng bộ tất cả thông tin...`, { id: 'pkgx-sync-all' });\r\n    \r\n    try {\r\n      const pkgxSeo = product.seoPkgx;\r\n      \r\n      // Get raw descriptions\r\n      const rawLongDesc = pkgxSeo?.longDescription || product.description || '';\r\n      const rawShortDesc = pkgxSeo?.shortDescription || product.shortDescription || '';\r\n      \r\n      // Process images in long description\r\n      let processedLongDesc = rawLongDesc;\r\n      let imageStats = { uploadedCount: 0, skippedCount: 0, errors: [] as string[] };\r\n      \r\n      if (rawLongDesc.includes('<img')) {\r\n        toast.loading(`Đang xử lý ảnh trong mô tả...`, { id: 'pkgx-sync-all' });\r\n        \r\n        const filenamePrefix = product.sku || product.id || `product-${product.pkgxId}`;\r\n        const result = await processHtmlImagesForPkgx(rawLongDesc, filenamePrefix);\r\n        \r\n        processedLongDesc = result.processedHtml;\r\n        imageStats = result;\r\n      }\r\n      \r\n      // Build full payload\r\n      const payload: Record<string, unknown> = {\r\n        // Thông tin cơ bản\r\n        goods_name: product.name,\r\n        goods_sn: product.id,\r\n        \r\n        // Tồn kho\r\n        goods_number: product.inventoryByBranch\r\n          ? Object.values(product.inventoryByBranch).reduce((sum, qty) => sum + (qty || 0), 0)\r\n          : 0,\r\n        \r\n        // SEO\r\n        keywords: pkgxSeo?.seoKeywords || product.tags?.join(', ') || product.name,\r\n        meta_title: pkgxSeo?.seoTitle || product.ktitle || product.name,\r\n        meta_desc: pkgxSeo?.metaDescription || product.seoDescription || '',\r\n        \r\n        // Mô tả (đã xử lý ảnh)\r\n        goods_desc: processedLongDesc,\r\n        goods_brief: rawShortDesc,\r\n        \r\n        // Flags\r\n        best: product.isFeatured || false,\r\n        hot: product.isBestSeller || false,\r\n        new: product.isNewArrival || false,\r\n        ishome: product.isFeatured || false,\r\n        is_on_sale: product.isPublished ?? (product.status === 'active'),\r\n        \r\n        // Image - ảnh đại diện\r\n        ...(product.thumbnailImage && { original_img: product.thumbnailImage }),\r\n      };\r\n\r\n      // Gallery images (album ảnh) - update toàn bộ\r\n      const galleryImages = product.galleryImages || product.images || [];\r\n      if (galleryImages.length > 0) {\r\n        payload.gallery_images = galleryImages;\r\n      }\r\n\r\n      // Map category\r\n      const catId = getMappedCategoryId(product);\r\n      if (catId) payload.cat_id = catId;\r\n\r\n      // Map brand\r\n      const brandId = getMappedBrandId(product);\r\n      if (brandId) payload.brand_id = brandId;\r\n\r\n      // Map prices\r\n      const shopPrice = getPriceByMapping(product, 'shopPrice');\r\n      if (shopPrice !== undefined) payload.shop_price = shopPrice;\r\n      \r\n      const marketPrice = getPriceByMapping(product, 'marketPrice');\r\n      if (marketPrice !== undefined) payload.market_price = marketPrice;\r\n      \r\n      const partnerPrice = getPriceByMapping(product, 'partnerPrice');\r\n      if (partnerPrice !== undefined) payload.partner_price = partnerPrice;\r\n      \r\n      const acePrice = getPriceByMapping(product, 'acePrice');\r\n      if (acePrice !== undefined) payload.ace_price = acePrice;\r\n      \r\n      const dealPrice = getPriceByMapping(product, 'dealPrice');\r\n      if (dealPrice !== undefined) payload.deal_price = dealPrice;\r\n\r\n      const response = await updateProduct(product.pkgxId, payload);\r\n      \r\n      if (response.success) {\r\n        const message = imageStats.uploadedCount > 0\r\n          ? `Đã đồng bộ tất cả (${imageStats.uploadedCount} ảnh trong mô tả đã upload)`\r\n          : `Đã đồng bộ tất cả thông tin`;\r\n          \r\n        toast.success(message, { id: 'pkgx-sync-all' });\r\n        addPkgxLog({\r\n          action: 'sync_all',\r\n          status: imageStats.errors.length > 0 ? 'partial' : 'success',\r\n          message: `${message}: ${product.name}`,\r\n          details: { \r\n            productId: product.systemId, \r\n            pkgxId: product.pkgxId,\r\n            imagesUploaded: imageStats.uploadedCount,\r\n            imagesSkipped: imageStats.skippedCount,\r\n            imageErrors: imageStats.errors,\r\n          },\r\n        });\r\n      } else {\r\n        throw new Error(response.error);\r\n      }\r\n    } catch (error) {\r\n      toast.error(`Lỗi đồng bộ: ${error instanceof Error ? error.message : 'Unknown error'}`, { id: 'pkgx-sync-all' });\r\n      addPkgxLog({\r\n        action: 'sync_all',\r\n        status: 'error',\r\n        message: `Lỗi đồng bộ tất cả: ${product.name}`,\r\n        details: { productId: product.systemId, error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    }\r\n  }, [getMappedCategoryId, getMappedBrandId, getPriceByMapping, addPkgxLog]);\r\n\r\n  return {\r\n    // Sync handlers\r\n    handlePkgxUpdatePrice,\r\n    handlePkgxSyncInventory,\r\n    handlePkgxUpdateSeo,\r\n    handlePkgxSyncDescription,\r\n    handlePkgxSyncFlags,\r\n    handlePkgxSyncBasicInfo,\r\n    handlePkgxSyncImages,\r\n    handlePkgxSyncAll,\r\n    // Helpers\r\n    hasPriceMapping,\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1398, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/pkgx-product-actions-cell.tsx"],"sourcesContent":["/**\r\n * PkgxProductActionsCell - Shared dropdown component for PKGX product sync actions\r\n * \r\n * Uses usePkgxEntitySync hook for consistent sync behavior\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { MoreHorizontal, RefreshCw, FileText, DollarSign, Package, Search, AlignLeft, Tag, Image, ExternalLink, Upload, Link2, Unlink } from 'lucide-react';\r\nimport { Button } from '../../components/ui/button';\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger } from '../../components/ui/dropdown-menu';\r\nimport type { Product } from './types';\r\nimport { usePkgxEntitySync } from '../settings/pkgx/hooks';\r\nimport type { HrmProductData } from '../settings/pkgx/hooks';\r\nimport { PkgxSyncConfirmDialog } from '../settings/pkgx/components/pkgx-sync-confirm-dialog';\r\nimport { usePkgxSettingsStore } from '../settings/pkgx/store';\r\n\r\ninterface PkgxProductActionsCellProps {\r\n  product: Product;\r\n  onPkgxPublish?: (product: Product) => void;\r\n  onPkgxLink?: (product: Product) => void;\r\n  onPkgxUnlink?: (product: Product) => void;\r\n  onPkgxSyncImages?: (product: Product) => void;\r\n}\r\n\r\nexport function PkgxProductActionsCell({\r\n  product,\r\n  onPkgxPublish,\r\n  onPkgxLink,\r\n  onPkgxUnlink,\r\n  onPkgxSyncImages,\r\n}: PkgxProductActionsCellProps) {\r\n  const { addLog } = usePkgxSettingsStore();\r\n  \r\n  // Use shared entity sync hook\r\n  const entitySync = usePkgxEntitySync({\r\n    entityType: 'product',\r\n    onLog: addLog,\r\n  });\r\n  \r\n  // Don't show for deleted items\r\n  if (product.deletedAt) return null;\r\n  \r\n  const hasPkgxId = !!product.pkgxId;\r\n  \r\n  // Build HRM product data for sync\r\n  const buildHrmData = (): HrmProductData => {\r\n    // Calculate total inventory across all branches\r\n    const totalInventory = Object.values(product.inventoryByBranch || {}).reduce((sum, qty) => sum + qty, 0);\r\n    \r\n    return {\r\n      systemId: product.systemId,\r\n      name: product.name,\r\n      sku: product.id,\r\n      sellingPrice: product.sellingPrice,\r\n      costPrice: product.costPrice,\r\n      dealPrice: undefined, // Not in Product type\r\n      quantity: totalInventory,\r\n      seoKeywords: product.seoPkgx?.seoKeywords || product.seoKeywords,\r\n      ktitle: product.seoPkgx?.seoTitle || product.ktitle,\r\n      seoDescription: product.seoPkgx?.metaDescription || product.seoDescription,\r\n      shortDescription: product.seoPkgx?.shortDescription || product.shortDescription,\r\n      description: product.seoPkgx?.longDescription || product.description,\r\n      isBest: product.isFeatured,\r\n      isNew: product.isNewArrival,\r\n      isHot: product.isBestSeller,\r\n      isHome: product.isPublished,\r\n      categorySystemId: product.categorySystemId,\r\n      brandSystemId: product.brandSystemId,\r\n    };\r\n  };\r\n  \r\n  // Helper to trigger sync\r\n  const triggerSync = (actionKey: 'sync_all' | 'sync_basic' | 'sync_seo' | 'sync_description' | 'sync_price' | 'sync_inventory' | 'sync_flags') => {\r\n    if (!product.pkgxId) return;\r\n    const hrmData = buildHrmData();\r\n    entitySync.triggerSyncAction(actionKey, product.pkgxId, hrmData, product.name);\r\n  };\r\n  \r\n  return (\r\n    <>\r\n      <div className=\"flex items-center justify-center\" onClick={(e) => e.stopPropagation()}>\r\n        <DropdownMenu>\r\n          <DropdownMenuTrigger asChild onClick={(e) => e.stopPropagation()}>\r\n            <Button \r\n              variant=\"ghost\" \r\n              className={`h-8 w-8 p-0 ${hasPkgxId ? \"text-primary\" : \"text-muted-foreground\"}`}\r\n              onClick={(e) => e.stopPropagation()}\r\n            >\r\n              <span className=\"sr-only\">PKGX menu</span>\r\n              <MoreHorizontal className=\"h-4 w-4\" />\r\n            </Button>\r\n          </DropdownMenuTrigger>\r\n          <DropdownMenuContent align=\"end\" onClick={(e) => e.stopPropagation()}>\r\n            {hasPkgxId ? (\r\n              <>\r\n                {/* Sync All - Most important action */}\r\n                <DropdownMenuItem \r\n                  onSelect={() => triggerSync('sync_all')}\r\n                  className=\"font-medium\"\r\n                  title=\"Đồng bộ tên, SKU, giá, tồn kho, SEO, mô tả, flags\"\r\n                >\r\n                  <RefreshCw className=\"mr-2 h-4 w-4\" />\r\n                  Đồng bộ tất cả\r\n                </DropdownMenuItem>\r\n                <DropdownMenuSeparator />\r\n                \r\n                {/* Individual sync actions */}\r\n                <DropdownMenuItem \r\n                  onSelect={() => triggerSync('sync_basic')}\r\n                  title=\"Tên sản phẩm, mã SKU, danh mục, thương hiệu\"\r\n                >\r\n                  <FileText className=\"mr-2 h-4 w-4\" />\r\n                  Thông tin cơ bản\r\n                </DropdownMenuItem>\r\n                <DropdownMenuItem \r\n                  onSelect={() => triggerSync('sync_price')}\r\n                  title=\"Giá bán, giá thị trường, giá khuyến mãi\"\r\n                >\r\n                  <DollarSign className=\"mr-2 h-4 w-4\" />\r\n                  Giá\r\n                </DropdownMenuItem>\r\n                <DropdownMenuItem \r\n                  onSelect={() => triggerSync('sync_inventory')}\r\n                  title=\"Tổng số lượng tồn kho từ tất cả chi nhánh\"\r\n                >\r\n                  <Package className=\"mr-2 h-4 w-4\" />\r\n                  Tồn kho\r\n                </DropdownMenuItem>\r\n                <DropdownMenuItem \r\n                  onSelect={() => triggerSync('sync_seo')}\r\n                  title=\"Keywords, Meta Title, Meta Description\"\r\n                >\r\n                  <Search className=\"mr-2 h-4 w-4\" />\r\n                  SEO\r\n                </DropdownMenuItem>\r\n                <DropdownMenuItem \r\n                  onSelect={() => triggerSync('sync_description')}\r\n                  title=\"Mô tả ngắn (goods_brief), mô tả chi tiết (goods_desc)\"\r\n                >\r\n                  <AlignLeft className=\"mr-2 h-4 w-4\" />\r\n                  Mô tả\r\n                </DropdownMenuItem>\r\n                <DropdownMenuItem \r\n                  onSelect={() => triggerSync('sync_flags')}\r\n                  title=\"Nổi bật (best), Hot, Mới (new), Trang chủ, Đang bán\"\r\n                >\r\n                  <Tag className=\"mr-2 h-4 w-4\" />\r\n                  Flags\r\n                </DropdownMenuItem>\r\n                \r\n                {/* Images - special handler */}\r\n                {onPkgxSyncImages && (\r\n                  <DropdownMenuItem \r\n                    onSelect={() => entitySync.handleConfirm(\r\n                      'Đồng bộ hình ảnh',\r\n                      `Đồng bộ hình ảnh đại diện và album ảnh của \"${product.name}\" lên PKGX?`,\r\n                      () => onPkgxSyncImages(product)\r\n                    )}\r\n                    title=\"Hình ảnh đại diện (original_img) + Album ảnh (goods_gallery)\"\r\n                  >\r\n                    <Image className=\"mr-2 h-4 w-4\" />\r\n                    Hình ảnh\r\n                  </DropdownMenuItem>\r\n                )}\r\n                \r\n                <DropdownMenuSeparator />\r\n                <DropdownMenuItem \r\n                  onSelect={() => window.open(`https://phukiengiaxuong.com.vn/admin/goods.php?act=edit&goods_id=${product.pkgxId}`, '_blank')}\r\n                >\r\n                  <ExternalLink className=\"mr-2 h-4 w-4\" />\r\n                  Xem trên PKGX\r\n                </DropdownMenuItem>\r\n                \r\n                {/* Hủy liên kết PKGX */}\r\n                {onPkgxUnlink && (\r\n                  <>\r\n                    <DropdownMenuSeparator />\r\n                    <DropdownMenuItem \r\n                      onSelect={() => entitySync.handleConfirm(\r\n                        'Hủy liên kết PKGX',\r\n                        `Bạn có chắc muốn hủy liên kết sản phẩm \"${product.name}\" với PKGX? (Sản phẩm vẫn tồn tại trên PKGX)`,\r\n                        () => onPkgxUnlink(product)\r\n                      )}\r\n                      className=\"text-destructive\"\r\n                    >\r\n                      <Unlink className=\"mr-2 h-4 w-4\" />\r\n                      Hủy liên kết\r\n                    </DropdownMenuItem>\r\n                  </>\r\n                )}\r\n              </>\r\n            ) : (\r\n              /* Actions for products WITHOUT pkgxId */\r\n              <>\r\n                {/* Publish to PKGX - Tạo mới sản phẩm trên PKGX */}\r\n                {onPkgxPublish && (\r\n                  <DropdownMenuItem \r\n                    onSelect={() => entitySync.handleConfirm(\r\n                      'Đăng lên PKGX',\r\n                      `Bạn có chắc muốn đăng sản phẩm \"${product.name}\" lên PKGX?`,\r\n                      () => onPkgxPublish(product)\r\n                    )}\r\n                  >\r\n                    <Upload className=\"mr-2 h-4 w-4\" />\r\n                    Đăng lên PKGX\r\n                  </DropdownMenuItem>\r\n                )}\r\n                \r\n                {/* Link to existing PKGX product */}\r\n                {onPkgxLink && (\r\n                  <DropdownMenuItem onSelect={() => onPkgxLink(product)}>\r\n                    <Link2 className=\"mr-2 h-4 w-4\" />\r\n                    Liên kết với PKGX\r\n                  </DropdownMenuItem>\r\n                )}\r\n              </>\r\n            )}\r\n          </DropdownMenuContent>\r\n        </DropdownMenu>\r\n      </div>\r\n      \r\n      {/* Confirmation Dialog - using shared component */}\r\n      <PkgxSyncConfirmDialog\r\n        confirmAction={entitySync.confirmAction}\r\n        isSyncing={entitySync.isSyncing}\r\n        onConfirm={entitySync.executeAction}\r\n        onCancel={entitySync.cancelConfirm}\r\n      />\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1805, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/stock-alert-utils.ts"],"sourcesContent":["import type { Product } from './types';\r\nimport type { SystemId } from '@/lib/id-types';\r\nimport { useSlaSettingsStore } from '../settings/inventory/sla-settings-store';\r\n\r\n/**\r\n * Stock Alert Types for Products\r\n */\r\nexport type StockAlertType = \r\n  | 'out_of_stock'      // Hết hàng (available = 0)\r\n  | 'low_stock'         // Sắp hết (available < reorderLevel)\r\n  | 'below_safety'      // Dưới mức an toàn (available < safetyStock)\r\n  | 'over_stock';       // Tồn kho cao (onHand > maxStock)\r\n\r\nexport type StockAlertSeverity = 'critical' | 'warning' | 'info';\r\n\r\nexport type StockAlert = {\r\n  type: StockAlertType;\r\n  severity: StockAlertSeverity;\r\n  label: string;\r\n  description: string;\r\n  branchSystemId?: SystemId;\r\n  branchName?: string;\r\n};\r\n\r\ntype Thresholds = {\r\n  reorderLevel?: number;\r\n  safetyStock?: number;\r\n  maxStock?: number;\r\n};\r\n\r\nconst isDefinedNumber = (value: number | undefined): value is number => typeof value === 'number' && !Number.isNaN(value);\r\n\r\nconst getEffectiveThresholds = (product: Product): Thresholds => {\r\n  const { settings } = useSlaSettingsStore.getState();\r\n  const thresholds: Thresholds = {};\r\n\r\n  const reorderLevel = product.reorderLevel ?? settings.defaultReorderLevel;\r\n  if (isDefinedNumber(reorderLevel)) {\r\n    thresholds.reorderLevel = reorderLevel;\r\n  }\r\n\r\n  const safetyStock = product.safetyStock ?? settings.defaultSafetyStock;\r\n  if (isDefinedNumber(safetyStock)) {\r\n    thresholds.safetyStock = safetyStock;\r\n  }\r\n\r\n  const maxStock = product.maxStock ?? settings.defaultMaxStock;\r\n  if (isDefinedNumber(maxStock)) {\r\n    thresholds.maxStock = maxStock;\r\n  }\r\n\r\n  return thresholds;\r\n};\r\n\r\n/**\r\n * Get stock alert label and color based on type\r\n */\r\nexport const STOCK_ALERT_CONFIG: Record<StockAlertType, {\r\n  label: string;\r\n  severity: StockAlertSeverity;\r\n  badgeVariant: 'destructive' | 'warning' | 'secondary' | 'outline';\r\n  icon: string;\r\n}> = {\r\n  out_of_stock: {\r\n    label: 'Hết hàng',\r\n    severity: 'critical',\r\n    badgeVariant: 'destructive',\r\n    icon: '🔴',\r\n  },\r\n  low_stock: {\r\n    label: 'Sắp hết hàng',\r\n    severity: 'warning',\r\n    badgeVariant: 'warning',\r\n    icon: '🟡',\r\n  },\r\n  below_safety: {\r\n    label: 'Dưới mức an toàn',\r\n    severity: 'warning',\r\n    badgeVariant: 'warning',\r\n    icon: '🟠',\r\n  },\r\n  over_stock: {\r\n    label: 'Tồn kho cao',\r\n    severity: 'info',\r\n    badgeVariant: 'secondary',\r\n    icon: '🔵',\r\n  },\r\n};\r\n\r\n/**\r\n * Calculate total available stock across all branches\r\n */\r\nexport function getTotalAvailableStock(product: Product): number {\r\n  const totalOnHand = Object.values(product.inventoryByBranch || {}).reduce((sum, qty) => sum + qty, 0);\r\n  const totalCommitted = Object.values(product.committedByBranch || {}).reduce((sum, qty) => sum + qty, 0);\r\n  return totalOnHand - totalCommitted;\r\n}\r\n\r\n/**\r\n * Calculate total on-hand stock across all branches\r\n */\r\nexport function getTotalOnHandStock(product: Product): number {\r\n  return Object.values(product.inventoryByBranch || {}).reduce((sum, qty) => sum + qty, 0);\r\n}\r\n\r\n/**\r\n * Get stock alerts for a product (total across all branches)\r\n */\r\nexport function getProductStockAlerts(product: Product): StockAlert[] {\r\n  const alerts: StockAlert[] = [];\r\n  \r\n  // Skip combo products (they have virtual stock)\r\n  if (product.type === 'combo') return alerts;\r\n  \r\n  // Skip non-stock-tracked products (services, digital)\r\n  if (product.isStockTracked === false) return alerts;\r\n  \r\n  const totalOnHand = getTotalOnHandStock(product);\r\n  const totalAvailable = getTotalAvailableStock(product);\r\n  const { reorderLevel, safetyStock, maxStock } = getEffectiveThresholds(product);\r\n  \r\n  // Check out of stock\r\n  if (totalAvailable <= 0) {\r\n    alerts.push({\r\n      type: 'out_of_stock',\r\n      severity: 'critical',\r\n      label: STOCK_ALERT_CONFIG.out_of_stock.label,\r\n      description: 'Sản phẩm đã hết hàng có thể bán',\r\n    });\r\n    return alerts; // If out of stock, don't show other alerts\r\n  }\r\n  \r\n  // Check low stock (below reorder level)\r\n  if (isDefinedNumber(reorderLevel) && totalAvailable < reorderLevel) {\r\n    alerts.push({\r\n      type: 'low_stock',\r\n      severity: 'warning',\r\n      label: STOCK_ALERT_CONFIG.low_stock.label,\r\n      description: `Tồn kho (${totalAvailable}) dưới mức đặt hàng lại (${reorderLevel})`,\r\n    });\r\n  }\r\n  \r\n  // Check below safety stock\r\n  if (\r\n    isDefinedNumber(safetyStock) &&\r\n    totalAvailable < safetyStock &&\r\n    !alerts.some(a => a.type === 'low_stock')\r\n  ) {\r\n    alerts.push({\r\n      type: 'below_safety',\r\n      severity: 'warning',\r\n      label: STOCK_ALERT_CONFIG.below_safety.label,\r\n      description: `Tồn kho (${totalAvailable}) dưới mức an toàn (${safetyStock})`,\r\n    });\r\n  }\r\n  \r\n  // Check over stock\r\n  if (isDefinedNumber(maxStock) && totalOnHand > maxStock) {\r\n    alerts.push({\r\n      type: 'over_stock',\r\n      severity: 'info',\r\n      label: STOCK_ALERT_CONFIG.over_stock.label,\r\n      description: `Tồn kho (${totalOnHand}) vượt mức tối đa (${maxStock})`,\r\n    });\r\n  }\r\n  \r\n  return alerts;\r\n}\r\n\r\n/**\r\n * Get stock alerts for a product at a specific branch\r\n */\r\nexport function getProductStockAlertsByBranch(\r\n  product: Product,\r\n  branchSystemId: SystemId,\r\n  branchName: string\r\n): StockAlert[] {\r\n  const alerts: StockAlert[] = [];\r\n  \r\n  // Skip combo products\r\n  if (product.type === 'combo') return alerts;\r\n  \r\n  // Skip non-stock-tracked products\r\n  if (product.isStockTracked === false) return alerts;\r\n  \r\n  const onHand = product.inventoryByBranch?.[branchSystemId] || 0;\r\n  const committed = product.committedByBranch?.[branchSystemId] || 0;\r\n  const available = onHand - committed;\r\n  const { reorderLevel } = getEffectiveThresholds(product);\r\n  \r\n  // Check out of stock at branch\r\n  if (available <= 0) {\r\n    alerts.push({\r\n      type: 'out_of_stock',\r\n      severity: 'critical',\r\n      label: STOCK_ALERT_CONFIG.out_of_stock.label,\r\n      description: `Hết hàng tại ${branchName}`,\r\n      branchSystemId,\r\n      branchName,\r\n    });\r\n    return alerts;\r\n  }\r\n  \r\n  // Check low stock at branch (using product-level thresholds)\r\n  if (isDefinedNumber(reorderLevel) && available < reorderLevel) {\r\n    alerts.push({\r\n      type: 'low_stock',\r\n      severity: 'warning',\r\n      label: STOCK_ALERT_CONFIG.low_stock.label,\r\n      description: `Tồn (${available}) < mức đặt hàng (${reorderLevel}) tại ${branchName}`,\r\n      branchSystemId,\r\n      branchName,\r\n    });\r\n  }\r\n  \r\n  return alerts;\r\n}\r\n\r\n/**\r\n * Get the most severe alert for display purposes\r\n */\r\nexport function getMostSevereAlert(alerts: StockAlert[]): StockAlert | null {\r\n  if (alerts.length === 0) return null;\r\n  \r\n  // Priority: critical > warning > info\r\n  const critical = alerts.find(a => a.severity === 'critical');\r\n  if (critical) return critical;\r\n  \r\n  const warning = alerts.find(a => a.severity === 'warning');\r\n  if (warning) return warning;\r\n  \r\n  return alerts[0];\r\n}\r\n\r\n/**\r\n * Check if product needs reorder (for reports/dashboards)\r\n */\r\nexport function needsReorder(product: Product): boolean {\r\n  if (product.type === 'combo') return false;\r\n  if (product.isStockTracked === false) return false;\r\n  const { reorderLevel } = getEffectiveThresholds(product);\r\n  if (!isDefinedNumber(reorderLevel)) return false;\r\n  \r\n  const totalAvailable = getTotalAvailableStock(product);\r\n  return totalAvailable < reorderLevel;\r\n}\r\n\r\n/**\r\n * Check if product is out of stock\r\n */\r\nexport function isOutOfStock(product: Product): boolean {\r\n  if (product.type === 'combo') return false;\r\n  if (product.isStockTracked === false) return false;\r\n  \r\n  const totalAvailable = getTotalAvailableStock(product);\r\n  return totalAvailable <= 0;\r\n}\r\n\r\n/**\r\n * Get suggested order quantity to reach safety level\r\n */\r\nexport function getSuggestedOrderQuantity(product: Product): number {\r\n  if (product.type === 'combo') return 0;\r\n  if (product.isStockTracked === false) return 0;\r\n  const { safetyStock, reorderLevel } = getEffectiveThresholds(product);\r\n  const totalOnHand = getTotalOnHandStock(product);\r\n  const targetLevel = safetyStock ?? reorderLevel ?? 0;\r\n  \r\n  if (targetLevel <= totalOnHand) return 0;\r\n  \r\n  return targetLevel - totalOnHand;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2001, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/components/stock-alert-badges.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Badge } from '../../../components/ui/badge';\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '../../../components/ui/tooltip';\r\nimport { AlertTriangle, AlertCircle, PackageX, TrendingUp } from 'lucide-react';\r\nimport type { Product } from '../types';\r\nimport { getProductStockAlerts, STOCK_ALERT_CONFIG, type StockAlert, type StockAlertType } from '../stock-alert-utils';\r\n\r\nconst AlertIcon = ({ type }: { type: StockAlertType }) => {\r\n  switch (type) {\r\n    case 'out_of_stock':\r\n      return <PackageX className=\"h-3.5 w-3.5\" />;\r\n    case 'low_stock':\r\n    case 'below_safety':\r\n      return <AlertTriangle className=\"h-3.5 w-3.5\" />;\r\n    case 'over_stock':\r\n      return <TrendingUp className=\"h-3.5 w-3.5\" />;\r\n    default:\r\n      return <AlertCircle className=\"h-3.5 w-3.5\" />;\r\n  }\r\n};\r\n\r\ntype StockAlertBadgesProps = {\r\n  product: Product;\r\n  showDescription?: boolean;\r\n  className?: string;\r\n};\r\n\r\n/**\r\n * Display stock alert badges for a product\r\n * Shows badges for: out of stock, low stock, below safety, over stock\r\n */\r\nexport function StockAlertBadges({ product, showDescription = false, className }: StockAlertBadgesProps) {\r\n  const alerts = React.useMemo(() => getProductStockAlerts(product), [product]);\r\n  \r\n  if (alerts.length === 0) return null;\r\n  \r\n  return (\r\n    <div className={`flex flex-wrap gap-1.5 ${className || ''}`}>\r\n      <TooltipProvider>\r\n        {alerts.map((alert, index) => {\r\n          const config = STOCK_ALERT_CONFIG[alert.type];\r\n          \r\n          return (\r\n            <Tooltip key={`${alert.type}-${index}`}>\r\n              <TooltipTrigger asChild>\r\n                <Badge \r\n                  variant={config.badgeVariant}\r\n                  className=\"gap-1 cursor-help\"\r\n                >\r\n                  <AlertIcon type={alert.type} />\r\n                  {config.label}\r\n                </Badge>\r\n              </TooltipTrigger>\r\n              <TooltipContent>\r\n                <p>{alert.description}</p>\r\n              </TooltipContent>\r\n            </Tooltip>\r\n          );\r\n        })}\r\n      </TooltipProvider>\r\n      \r\n      {showDescription && alerts.length > 0 && (\r\n        <div className=\"w-full mt-1 text-body-sm text-muted-foreground\">\r\n          {alerts.map((alert, i) => (\r\n            <p key={i}>• {alert.description}</p>\r\n          ))}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Compact version - just show the most critical alert\r\n */\r\nexport function StockAlertBadge({ product, className }: { product: Product; className?: string }) {\r\n  const alerts = React.useMemo(() => getProductStockAlerts(product), [product]);\r\n  \r\n  if (alerts.length === 0) return null;\r\n  \r\n  // Show most critical alert\r\n  const alert = alerts[0]; // Already sorted by severity in getProductStockAlerts\r\n  const config = STOCK_ALERT_CONFIG[alert.type];\r\n  \r\n  return (\r\n    <TooltipProvider>\r\n      <Tooltip>\r\n        <TooltipTrigger asChild>\r\n          <Badge \r\n            variant={config.badgeVariant}\r\n            className={`gap-1 cursor-help ${className || ''}`}\r\n          >\r\n            <AlertIcon type={alert.type} />\r\n            {config.label}\r\n          </Badge>\r\n        </TooltipTrigger>\r\n        <TooltipContent>\r\n          {alerts.length === 1 ? (\r\n            <p>{alert.description}</p>\r\n          ) : (\r\n            <div>\r\n              {alerts.map((a, i) => (\r\n                <p key={i}>• {a.description}</p>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </TooltipContent>\r\n      </Tooltip>\r\n    </TooltipProvider>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;;;;;;;;AAEA,MAAM,YAAY,CAAC,EAAE,IAAI,EAA4B;IACnD,OAAQ;QACN,KAAK;YACH,qBAAO,6LAAC,6NAAQ;gBAAC,WAAU;;;;;;QAC7B,KAAK;QACL,KAAK;YACH,qBAAO,6LAAC,4OAAa;gBAAC,WAAU;;;;;;QAClC,KAAK;YACH,qBAAO,6LAAC,mOAAU;gBAAC,WAAU;;;;;;QAC/B;YACE,qBAAO,6LAAC,sOAAW;gBAAC,WAAU;;;;;;IAClC;AACF;KAZM;AAwBC,SAAS,iBAAiB,EAAE,OAAO,EAAE,kBAAkB,KAAK,EAAE,SAAS,EAAyB;;IACrG,MAAM,SAAS,wKAAa;4CAAC,IAAM,IAAA,2KAAqB,EAAC;2CAAU;QAAC;KAAQ;IAE5E,IAAI,OAAO,MAAM,KAAK,GAAG,OAAO;IAEhC,qBACE,6LAAC;QAAI,WAAW,CAAC,uBAAuB,EAAE,aAAa,IAAI;;0BACzD,6LAAC,kJAAe;0BACb,OAAO,GAAG,CAAC,CAAC,OAAO;oBAClB,MAAM,SAAS,wKAAkB,CAAC,MAAM,IAAI,CAAC;oBAE7C,qBACE,6LAAC,0IAAO;;0CACN,6LAAC,iJAAc;gCAAC,OAAO;0CACrB,cAAA,6LAAC,sIAAK;oCACJ,SAAS,OAAO,YAAY;oCAC5B,WAAU;;sDAEV,6LAAC;4CAAU,MAAM,MAAM,IAAI;;;;;;wCAC1B,OAAO,KAAK;;;;;;;;;;;;0CAGjB,6LAAC,iJAAc;0CACb,cAAA,6LAAC;8CAAG,MAAM,WAAW;;;;;;;;;;;;uBAXX,GAAG,MAAM,IAAI,CAAC,CAAC,EAAE,OAAO;;;;;gBAe1C;;;;;;YAGD,mBAAmB,OAAO,MAAM,GAAG,mBAClC,6LAAC;gBAAI,WAAU;0BACZ,OAAO,GAAG,CAAC,CAAC,OAAO,kBAClB,6LAAC;;4BAAU;4BAAG,MAAM,WAAW;;uBAAvB;;;;;;;;;;;;;;;;AAMpB;GAvCgB;MAAA;AA4CT,SAAS,gBAAgB,EAAE,OAAO,EAAE,SAAS,EAA4C;;IAC9F,MAAM,SAAS,wKAAa;2CAAC,IAAM,IAAA,2KAAqB,EAAC;0CAAU;QAAC;KAAQ;IAE5E,IAAI,OAAO,MAAM,KAAK,GAAG,OAAO;IAEhC,2BAA2B;IAC3B,MAAM,QAAQ,MAAM,CAAC,EAAE,EAAE,sDAAsD;IAC/E,MAAM,SAAS,wKAAkB,CAAC,MAAM,IAAI,CAAC;IAE7C,qBACE,6LAAC,kJAAe;kBACd,cAAA,6LAAC,0IAAO;;8BACN,6LAAC,iJAAc;oBAAC,OAAO;8BACrB,cAAA,6LAAC,sIAAK;wBACJ,SAAS,OAAO,YAAY;wBAC5B,WAAW,CAAC,kBAAkB,EAAE,aAAa,IAAI;;0CAEjD,6LAAC;gCAAU,MAAM,MAAM,IAAI;;;;;;4BAC1B,OAAO,KAAK;;;;;;;;;;;;8BAGjB,6LAAC,iJAAc;8BACZ,OAAO,MAAM,KAAK,kBACjB,6LAAC;kCAAG,MAAM,WAAW;;;;;6CAErB,6LAAC;kCACE,OAAO,GAAG,CAAC,CAAC,GAAG,kBACd,6LAAC;;oCAAU;oCAAG,EAAE,WAAW;;+BAAnB;;;;;;;;;;;;;;;;;;;;;;;;;;AAQxB;IAnCgB;MAAA"}},
    {"offset": {"line": 2245, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/columns.tsx"],"sourcesContent":["'use client'\r\n\r\nimport * as React from \"react\";\r\nimport type { AppRouterInstance } from 'next/dist/shared/lib/app-router-context.shared-runtime';\r\nimport type { Product } from './types'\r\nimport { Checkbox } from \"../../components/ui/checkbox\"\r\nimport { DataTableColumnHeader } from \"../../components/data-table/data-table-column-header\"\r\nimport { Badge } from \"../../components/ui/badge\"\r\nimport { Switch } from \"../../components/ui/switch\"\r\nimport { DatePicker } from \"../../components/ui/date-picker\"\r\nimport type { ColumnDef } from '../../components/data-table/types';\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger } from \"../../components/ui/dropdown-menu\";\r\nimport { Button } from \"../../components/ui/button\";\r\nimport { MoreHorizontal, RotateCcw, Globe, ShoppingCart, Wrench, FileDigit, Layers, CheckCircle, AlertTriangle, XCircle } from \"lucide-react\";\r\nimport { usePricingPolicyStore } from '../settings/pricing/store';\r\nimport { useProductCategoryStore } from '../settings/inventory/product-category-store';\r\nimport { PkgxProductActionsCell } from './pkgx-product-actions-cell';\r\nimport { useProductTypeStore } from '../settings/inventory/product-type-store';\r\nimport { useBrandStore } from '../settings/inventory/brand-store';\r\nimport { useSupplierStore } from '../suppliers/store';\r\nimport { useEmployeeStore } from '../employees/store';\r\nimport { StockAlertBadge } from './components/stock-alert-badges';\r\nimport { formatDateForDisplay } from '@/lib/date-utils';\r\nimport { InlineEditableCell, InlineEditableNumberCell } from '../../components/shared/inline-editable-cell';\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"../../components/ui/alert-dialog\";\r\n\r\nconst formatCurrency = (value?: number) => {\r\n    if (typeof value !== 'number' || isNaN(value)) return '-';\r\n    return new Intl.NumberFormat('vi-VN').format(value);\r\n};\r\n\r\nconst formatDateTime = (dateStr?: string | null) => {\r\n    if (!dateStr) return '-';\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleString('vi-VN', {\r\n      day: '2-digit',\r\n      month: '2-digit', \r\n      year: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n};\r\n\r\nconst getStatusBadgeVariant = (status?: 'active' | 'inactive' | 'discontinued'): \"success\" | \"secondary\" | \"destructive\" => {\r\n  switch (status) {\r\n    case 'active': return 'success';\r\n    case 'inactive': return 'secondary';\r\n    case 'discontinued': return 'destructive';\r\n    default: return 'secondary';\r\n  }\r\n};\r\n\r\nconst getStatusLabel = (status?: 'active' | 'inactive' | 'discontinued'): string => {\r\n  switch (status) {\r\n    case 'active': return 'Đang bán';\r\n    case 'inactive': return 'Ngừng bán';\r\n    case 'discontinued': return 'Ngừng SX';\r\n    default: return 'Không rõ';\r\n  }\r\n};\r\n\r\n// ═══════════════════════════════════════════════════════════════\r\n// SEO SCORE HELPERS - Tính điểm SEO cho từng website\r\n// ═══════════════════════════════════════════════════════════════\r\nimport type { WebsiteSeoData } from './types';\r\n\r\nconst calculateSeoScore = (seo: WebsiteSeoData | undefined): number => {\r\n  if (!seo) return 0;\r\n  \r\n  let score = 0;\r\n  if (seo.seoTitle && seo.seoTitle.length >= 30) score += 25;\r\n  if (seo.metaDescription && seo.metaDescription.length >= 100) score += 25;\r\n  if (seo.seoKeywords) score += 15;\r\n  if (seo.shortDescription) score += 15;\r\n  if (seo.longDescription && seo.longDescription.length >= 200) score += 20;\r\n  \r\n  return score;\r\n};\r\n\r\nconst getSeoStatusBadge = (score: number) => {\r\n  if (score >= 80) return <Badge variant=\"default\" className=\"bg-green-100 text-green-800 hover:bg-green-100\"><CheckCircle className=\"h-3 w-3 mr-1\" /> {score}%</Badge>;\r\n  if (score >= 50) return <Badge variant=\"secondary\" className=\"bg-yellow-100 text-yellow-800 hover:bg-yellow-100\"><AlertTriangle className=\"h-3 w-3 mr-1\" /> {score}%</Badge>;\r\n  if (score > 0) return <Badge variant=\"secondary\" className=\"bg-red-100 text-red-800 hover:bg-red-100\"><XCircle className=\"h-3 w-3 mr-1\" /> {score}%</Badge>;\r\n  return <Badge variant=\"outline\" className=\"text-muted-foreground\">—</Badge>;\r\n};\r\n\r\nexport const getColumns = (\r\n  onDelete: (systemId: string) => void,\r\n  onRestore: (systemId: string) => void,\r\n  router: AppRouterInstance,\r\n  onPrintLabel?: (product: Product) => void,\r\n  // PKGX handlers - used by PkgxProductActionsCell\r\n  onPkgxPublish?: (product: Product) => void,\r\n  onPkgxLink?: (product: Product) => void,\r\n  onPkgxUnlink?: (product: Product) => void,\r\n  onPkgxSyncImages?: (product: Product) => void,\r\n  // Status & Inline edit handlers\r\n  onStatusChange?: (product: Product, newStatus: 'active' | 'inactive') => void,\r\n  onInventoryChange?: (product: Product, newQuantity: number) => void,\r\n  // Field update handler for inline editing\r\n  onFieldUpdate?: (product: Product, field: string, value: string | number | boolean) => void,\r\n): ColumnDef<Product>[] => {\r\n  \r\n  const { data: pricingPolicies } = usePricingPolicyStore.getState();\r\n  const activePricingPolicies = pricingPolicies.filter(p => p.isActive);\r\n  const defaultSellingPolicy = pricingPolicies.find(p => p.type === 'Bán hàng' && p.isDefault);\r\n\r\n  // Pre-fetch lookup data to avoid repeated store access in cell renders\r\n  const categoryStore = useProductCategoryStore.getState();\r\n  const brandStore = useBrandStore.getState();\r\n  const supplierStore = useSupplierStore.getState();\r\n  const employeeStore = useEmployeeStore.getState();\r\n\r\n  return [\r\n    {\r\n      id: \"select\",\r\n      header: ({ isAllPageRowsSelected, isSomePageRowsSelected, onToggleAll }) => (\r\n        <div className=\"flex items-center justify-center\">\r\n          <Checkbox\r\n            checked={isAllPageRowsSelected ? true : isSomePageRowsSelected ? \"indeterminate\" : false}\r\n            onCheckedChange={(value) => onToggleAll?.(!!value)}\r\n            aria-label=\"Select all\"\r\n          />\r\n        </div>\r\n      ),\r\n      cell: ({ isSelected, onToggleSelect }) => (\r\n        <div className=\"flex items-center justify-center\">\r\n          <Checkbox\r\n            checked={isSelected}\r\n            onCheckedChange={onToggleSelect}\r\n            aria-label=\"Select row\"\r\n          />\r\n        </div>\r\n      ),\r\n      size: 48,\r\n      meta: {\r\n        displayName: \"Select\",\r\n        sticky: \"left\",\r\n      },\r\n    },\r\n    {\r\n      id: \"id\",\r\n      accessorKey: \"id\",\r\n      header: \"Mã SP (SKU)\",\r\n      cell: ({ row }) => <div className=\"text-body-sm font-medium\">{row.id}</div>,\r\n      meta: { displayName: \"Mã SP (SKU)\" },\r\n      size: 150,\r\n    },\r\n    {\r\n      id: \"name\",\r\n      accessorKey: \"name\",\r\n      header: \"Tên sản phẩm/dịch vụ\",\r\n      cell: ({ row }) => (\r\n        <div>\r\n          <div className=\"text-body-sm font-medium flex items-center gap-2 flex-wrap\">\r\n            {row.name}\r\n            {row.type === 'combo' && (\r\n              <Badge variant=\"secondary\" className=\"text-body-xs\">Combo</Badge>\r\n            )}\r\n            {row.pkgxId && (\r\n              <Badge variant=\"secondary\" className=\"text-body-xs\">\r\n                <Globe className=\"h-3 w-3\" />\r\n                PKGX\r\n              </Badge>\r\n            )}\r\n            <StockAlertBadge product={row} />\r\n          </div>\r\n        </div>\r\n      ),\r\n      meta: { displayName: \"Tên sản phẩm/dịch vụ\" },\r\n    },\r\n    {\r\n      id: \"category\",\r\n      accessorKey: \"categorySystemId\",\r\n      header: \"Danh mục\",\r\n      cell: ({ row }) => {\r\n        const categoryId = row.categorySystemId;\r\n        if (!categoryId) return row.category || '-';\r\n        const category = categoryStore.findById(categoryId);\r\n        return category ? (category.path || category.name) : (row.category || '-');\r\n      },\r\n      meta: { displayName: \"Danh mục\" },\r\n    },\r\n    {\r\n      id: \"type\",\r\n      accessorKey: \"type\",\r\n      header: \"Loại\",\r\n      cell: ({ row }) => {\r\n        const typeConfig = {\r\n          physical: { label: 'Hàng hóa', icon: ShoppingCart, variant: 'secondary' as const },\r\n          service: { label: 'Dịch vụ', icon: Wrench, variant: 'secondary' as const },\r\n          digital: { label: 'Sản phẩm số', icon: FileDigit, variant: 'secondary' as const },\r\n          combo: { label: 'Combo', icon: Layers, variant: 'secondary' as const }\r\n        };\r\n        const type = (row.type || 'physical') as keyof typeof typeConfig;\r\n        const config = typeConfig[type] || typeConfig.physical;\r\n        const Icon = config.icon;\r\n        return (\r\n          <Badge variant={config.variant} className=\"gap-1\">\r\n            <Icon className=\"h-3 w-3\" />\r\n            {config.label}\r\n          </Badge>\r\n        );\r\n      },\r\n      meta: { displayName: \"Loại\" },\r\n    },\r\n    {\r\n      id: \"barcode\",\r\n      accessorKey: \"barcode\",\r\n      header: \"Mã vạch\",\r\n      cell: ({ row }) => row.barcode || '-',\r\n      meta: { displayName: \"Mã vạch\" },\r\n    },\r\n    {\r\n      id: \"status\",\r\n      accessorKey: \"status\",\r\n      header: \"Trạng thái\",\r\n      cell: ({ row }) => {\r\n        const isActive = row.status === 'active';\r\n        return (\r\n          <div className=\"flex items-center gap-2\" onClick={(e) => e.stopPropagation()}>\r\n            <Switch\r\n              checked={isActive}\r\n              onCheckedChange={(checked) => {\r\n                onStatusChange?.(row, checked ? 'active' : 'inactive');\r\n              }}\r\n            />\r\n            <span className={`text-xs ${isActive ? 'text-foreground' : 'text-muted-foreground'}`}>\r\n              {isActive}\r\n            </span>\r\n          </div>\r\n        );\r\n      },\r\n      meta: { displayName: \"Trạng thái\" },\r\n    },\r\n    {\r\n      id: \"costPrice\",\r\n      accessorKey: \"costPrice\",\r\n      header: \"Giá vốn\",\r\n      cell: ({ row }) => {\r\n        if (onFieldUpdate) {\r\n          return (\r\n            <div onClick={(e) => e.stopPropagation()}>\r\n              <InlineEditableNumberCell\r\n                value={row.costPrice || 0}\r\n                onSave={(newValue) => onFieldUpdate(row, 'costPrice', newValue)}\r\n              />\r\n            </div>\r\n          );\r\n        }\r\n        return formatCurrency(row.costPrice);\r\n      },\r\n      meta: { displayName: \"Giá vốn\" },\r\n    },\r\n    {\r\n      id: \"inventory\",\r\n      // FIX: Correct accessorKey to match the property in the Product type.\r\n      accessorKey: \"inventoryByBranch\",\r\n      header: \"Tồn kho\",\r\n      // FIX: Correctly calculate the total inventory from the inventoryByBranch object.\r\n      cell: ({ row }) => {\r\n        // Combo không có tồn kho thực tế\r\n        if (row.type === 'combo') {\r\n          return <span className=\"text-muted-foreground italic\">Ảo</span>;\r\n        }\r\n        const totalInventory = Object.values(row.inventoryByBranch).reduce((sum, qty) => sum + qty, 0);\r\n        \r\n        if (onInventoryChange) {\r\n          return (\r\n            <div onClick={(e) => e.stopPropagation()}>\r\n              <InlineEditableNumberCell\r\n                value={totalInventory}\r\n                onSave={(newValue) => onInventoryChange(row, newValue)}\r\n              />\r\n            </div>\r\n          );\r\n        }\r\n        \r\n        return totalInventory;\r\n      },\r\n      meta: { displayName: \"Tồn kho\" },\r\n    },\r\n    {\r\n      id: \"unit\",\r\n      accessorKey: \"unit\",\r\n      header: \"Đơn vị tính\",\r\n      cell: ({ row }) => row.unit,\r\n      meta: { displayName: \"Đơn vị tính\" },\r\n    },\r\n    {\r\n      id: \"tags\",\r\n      accessorKey: \"tags\",\r\n      header: \"Tags\",\r\n      cell: ({ row }) => {\r\n        if (!row.tags || row.tags.length === 0) return '-';\r\n        return (\r\n          <div className=\"flex flex-wrap gap-1\">\r\n            {row.tags.slice(0, 2).map(tag => (\r\n              <Badge key={tag} variant=\"outline\" className=\"text-body-xs\">{tag}</Badge>\r\n            ))}\r\n            {row.tags.length > 2 && (\r\n              <span className=\"text-body-xs text-muted-foreground\">+{row.tags.length - 2}</span>\r\n            )}\r\n          </div>\r\n        );\r\n      },\r\n      meta: { displayName: \"Tags\" },\r\n    },\r\n    {\r\n      id: \"committed\",\r\n      header: \"Đang giao dịch\",\r\n      cell: ({ row }) => Object.values(row.committedByBranch || {}).reduce((sum, qty) => sum + qty, 0),\r\n      meta: { displayName: \"Đang giao dịch\" },\r\n    },\r\n    {\r\n      id: \"inTransit\",\r\n      header: \"Đang về\",\r\n      cell: ({ row }) => Object.values(row.inTransitByBranch || {}).reduce((sum, qty) => sum + qty, 0),\r\n      meta: { displayName: \"Đang về\" },\r\n    },\r\n    {\r\n      id: \"totalSold\",\r\n      accessorKey: \"totalSold\",\r\n      header: \"Đã bán\",\r\n      cell: ({ row }) => row.totalSold || 0,\r\n      meta: { displayName: \"Đã bán\" },\r\n    },\r\n    {\r\n      id: \"createdAt\",\r\n      accessorKey: \"createdAt\",\r\n      header: \"Ngày tạo\",\r\n      cell: ({ row }) => {\r\n        if (!row.createdAt) return '-';\r\n        return formatDateForDisplay(row.createdAt);\r\n      },\r\n      meta: { displayName: \"Ngày tạo\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // THÊM CÁC CỘT MỚI - Thương hiệu\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"brand\",\r\n      accessorKey: \"brandSystemId\",\r\n      header: \"Thương hiệu\",\r\n      cell: ({ row }) => {\r\n        const brandId = row.brandSystemId;\r\n        if (!brandId) return '-';\r\n        const brand = brandStore.findById(brandId);\r\n        return brand ? brand.name : '-';\r\n      },\r\n      meta: { displayName: \"Thương hiệu\" },\r\n    },\r\n    {\r\n      id: \"pkgxId\",\r\n      accessorKey: \"pkgxId\",\r\n      header: \"ID PKGX\",\r\n      cell: ({ row }) => {\r\n        if (onFieldUpdate) {\r\n          return (\r\n            <div onClick={(e) => e.stopPropagation()}>\r\n              <InlineEditableNumberCell\r\n                value={row.pkgxId || 0}\r\n                onSave={(newValue) => onFieldUpdate(row, 'pkgxId', newValue)}\r\n              />\r\n            </div>\r\n          );\r\n        }\r\n        return row.pkgxId || '-';\r\n      },\r\n      meta: { displayName: \"ID PKGX\" },\r\n    },\r\n    // SEO PKGX Score\r\n    {\r\n      id: \"seoPkgx\",\r\n      accessorKey: \"seoPkgx\",\r\n      header: \"SEO PKGX\",\r\n      cell: ({ row }) => {\r\n        const score = calculateSeoScore(row.seoPkgx);\r\n        return getSeoStatusBadge(score);\r\n      },\r\n      size: 100,\r\n      meta: { displayName: \"SEO PKGX\", group: \"SEO\" },\r\n    },\r\n    {\r\n      id: \"warrantyPeriodMonths\",\r\n      accessorKey: \"warrantyPeriodMonths\",\r\n      header: \"Bảo hành\",\r\n      cell: ({ row }) => {\r\n        if (!row.warrantyPeriodMonths) return '-';\r\n        return `${row.warrantyPeriodMonths} tháng`;\r\n      },\r\n      meta: { displayName: \"Bảo hành\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // SEO & MÔ TẢ\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"ktitle\",\r\n      accessorKey: \"ktitle\",\r\n      header: \"Tiêu đề SEO\",\r\n      cell: ({ row }) => row.ktitle || '-',\r\n      meta: { displayName: \"Tiêu đề SEO\" },\r\n    },\r\n    {\r\n      id: \"seoDescription\",\r\n      accessorKey: \"seoDescription\",\r\n      header: \"Mô tả SEO\",\r\n      cell: ({ row }) => {\r\n        if (!row.seoDescription) return '-';\r\n        return <span className=\"line-clamp-1\">{row.seoDescription}</span>;\r\n      },\r\n      meta: { displayName: \"Mô tả SEO\" },\r\n    },\r\n    {\r\n      id: \"shortDescription\",\r\n      accessorKey: \"shortDescription\",\r\n      header: \"Mô tả ngắn\",\r\n      cell: ({ row }) => {\r\n        if (!row.shortDescription) return '-';\r\n        // Strip HTML tags for display\r\n        const text = row.shortDescription.replace(/<[^>]*>/g, '');\r\n        return <span className=\"line-clamp-1\">{text}</span>;\r\n      },\r\n      meta: { displayName: \"Mô tả ngắn\" },\r\n    },\r\n    {\r\n      id: \"description\",\r\n      accessorKey: \"description\",\r\n      header: \"Mô tả chi tiết\",\r\n      cell: ({ row }) => {\r\n        if (!row.description) return '-';\r\n        // Strip HTML tags for display\r\n        const text = row.description.replace(/<[^>]*>/g, '');\r\n        return <span className=\"line-clamp-1\">{text}</span>;\r\n      },\r\n      meta: { displayName: \"Mô tả chi tiết\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // GIÁ & NHẬP HÀNG\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"lastPurchasePrice\",\r\n      accessorKey: \"lastPurchasePrice\",\r\n      header: \"Giá nhập gần nhất\",\r\n      cell: ({ row }) => formatCurrency(row.lastPurchasePrice),\r\n      meta: { displayName: \"Giá nhập gần nhất\" },\r\n    },\r\n    {\r\n      id: \"primarySupplier\",\r\n      accessorKey: \"primarySupplierSystemId\",\r\n      header: \"Nhà cung cấp chính\",\r\n      cell: ({ row }) => {\r\n        const supplierId = row.primarySupplierSystemId;\r\n        if (!supplierId) return '-';\r\n        const supplier = supplierStore.findById(supplierId);\r\n        return supplier ? supplier.name : '-';\r\n      },\r\n      meta: { displayName: \"Nhà cung cấp chính\" },\r\n    },\r\n    {\r\n      id: \"lastPurchaseDate\",\r\n      accessorKey: \"lastPurchaseDate\",\r\n      header: \"Ngày nhập gần nhất\",\r\n      cell: ({ row }) => {\r\n        if (!row.lastPurchaseDate) return '-';\r\n        return formatDateForDisplay(row.lastPurchaseDate);\r\n      },\r\n      meta: { displayName: \"Ngày nhập gần nhất\" },\r\n    },\r\n    {\r\n      id: \"minPrice\",\r\n      accessorKey: \"minPrice\",\r\n      header: \"Giá tối thiểu\",\r\n      cell: ({ row }) => formatCurrency(row.minPrice),\r\n      meta: { displayName: \"Giá tối thiểu\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // KHO - Mức đặt hàng, tồn kho an toàn, tối đa\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"reorderLevel\",\r\n      accessorKey: \"reorderLevel\",\r\n      header: \"Mức đặt hàng lại\",\r\n      cell: ({ row }) => {\r\n        if (onFieldUpdate) {\r\n          return (\r\n            <div onClick={(e) => e.stopPropagation()}>\r\n              <InlineEditableNumberCell\r\n                value={row.reorderLevel ?? 0}\r\n                onSave={(newValue) => onFieldUpdate(row, 'reorderLevel', newValue)}\r\n              />\r\n            </div>\r\n          );\r\n        }\r\n        return row.reorderLevel ?? 0;\r\n      },\r\n      meta: { displayName: \"Mức đặt hàng lại\" },\r\n    },\r\n    {\r\n      id: \"safetyStock\",\r\n      accessorKey: \"safetyStock\",\r\n      header: \"Tồn kho an toàn\",\r\n      cell: ({ row }) => {\r\n        if (onFieldUpdate) {\r\n          return (\r\n            <div onClick={(e) => e.stopPropagation()}>\r\n              <InlineEditableNumberCell\r\n                value={row.safetyStock ?? 0}\r\n                onSave={(newValue) => onFieldUpdate(row, 'safetyStock', newValue)}\r\n              />\r\n            </div>\r\n          );\r\n        }\r\n        return row.safetyStock ?? 0;\r\n      },\r\n      meta: { displayName: \"Tồn kho an toàn\" },\r\n    },\r\n    {\r\n      id: \"maxStock\",\r\n      accessorKey: \"maxStock\",\r\n      header: \"Mức tồn tối đa\",\r\n      cell: ({ row }) => {\r\n        if (onFieldUpdate) {\r\n          return (\r\n            <div onClick={(e) => e.stopPropagation()}>\r\n              <InlineEditableNumberCell\r\n                value={row.maxStock ?? 0}\r\n                onSave={(newValue) => onFieldUpdate(row, 'maxStock', newValue)}\r\n              />\r\n            </div>\r\n          );\r\n        }\r\n        return row.maxStock ?? 0;\r\n      },\r\n      meta: { displayName: \"Mức tồn tối đa\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // LOGISTICS - Khối lượng, Kích thước\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"weight\",\r\n      accessorKey: \"weight\",\r\n      header: \"Khối lượng\",\r\n      cell: ({ row }) => {\r\n        if (row.weight === undefined) return '-';\r\n        return `${row.weight} ${row.weightUnit || 'g'}`;\r\n      },\r\n      meta: { displayName: \"Khối lượng\" },\r\n    },\r\n    {\r\n      id: \"dimensions\",\r\n      accessorKey: \"dimensions\",\r\n      header: \"Kích thước (D×R×C)\",\r\n      cell: ({ row }) => {\r\n        if (!row.dimensions) return '-';\r\n        const { length = 0, width = 0, height = 0 } = row.dimensions;\r\n        return `${length}×${width}×${height} cm`;\r\n      },\r\n      meta: { displayName: \"Kích thước (D×R×C)\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // E-COMMERCE - Bán hàng online\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"pkgxStatus\",\r\n      header: \"PKGX\",\r\n      cell: ({ row }) => (\r\n        row.pkgxId ? (\r\n          <Badge variant=\"default\" className=\"bg-green-500 text-xs\">\r\n            <Globe className=\"h-3 w-3 mr-1\" />\r\n            {row.pkgxId}\r\n          </Badge>\r\n        ) : (\r\n          <Badge variant=\"secondary\" className=\"text-xs\">Chưa liên kết</Badge>\r\n        )\r\n      ),\r\n      meta: { displayName: \"Trạng thái PKGX\" },\r\n    },\r\n    {\r\n      id: \"pkgxSlug\",\r\n      accessorKey: \"pkgxSlug\",\r\n      header: \"Slug PKGX\",\r\n      cell: ({ row }) => row.pkgxSlug || '-',\r\n      meta: { displayName: \"Slug PKGX\" },\r\n    },\r\n    {\r\n      id: \"isPublished\",\r\n      accessorKey: \"isPublished\",\r\n      header: \"Đăng web\",\r\n      cell: ({ row }) => (\r\n        <div onClick={(e) => e.stopPropagation()}>\r\n          <Switch\r\n            checked={row.isPublished ?? false}\r\n            onCheckedChange={(checked) => onFieldUpdate?.(row, 'isPublished', checked)}\r\n          />\r\n        </div>\r\n      ),\r\n      meta: { displayName: \"Đăng web\" },\r\n    },\r\n    {\r\n      id: \"isFeatured\",\r\n      accessorKey: \"isFeatured\",\r\n      header: \"Nổi bật\",\r\n      cell: ({ row }) => (\r\n        <div onClick={(e) => e.stopPropagation()}>\r\n          <Switch\r\n            checked={row.isFeatured ?? false}\r\n            onCheckedChange={(checked) => onFieldUpdate?.(row, 'isFeatured', checked)}\r\n          />\r\n        </div>\r\n      ),\r\n      meta: { displayName: \"Nổi bật\" },\r\n    },\r\n    {\r\n      id: \"isNewArrival\",\r\n      accessorKey: \"isNewArrival\",\r\n      header: \"Mới về\",\r\n      cell: ({ row }) => (\r\n        <div onClick={(e) => e.stopPropagation()}>\r\n          <Switch\r\n            checked={row.isNewArrival ?? false}\r\n            onCheckedChange={(checked) => onFieldUpdate?.(row, 'isNewArrival', checked)}\r\n          />\r\n        </div>\r\n      ),\r\n      meta: { displayName: \"Mới về\" },\r\n    },\r\n    {\r\n      id: \"isBestSeller\",\r\n      accessorKey: \"isBestSeller\",\r\n      header: \"Bán chạy\",\r\n      cell: ({ row }) => (\r\n        <div onClick={(e) => e.stopPropagation()}>\r\n          <Switch\r\n            checked={row.isBestSeller ?? false}\r\n            onCheckedChange={(checked) => onFieldUpdate?.(row, 'isBestSeller', checked)}\r\n          />\r\n        </div>\r\n      ),\r\n      meta: { displayName: \"Bán chạy\" },\r\n    },\r\n    {\r\n      id: \"isOnSale\",\r\n      accessorKey: \"isOnSale\",\r\n      header: \"Đang giảm giá\",\r\n      cell: ({ row }) => (\r\n        <div onClick={(e) => e.stopPropagation()}>\r\n          <Switch\r\n            checked={row.isOnSale ?? false}\r\n            onCheckedChange={(checked) => onFieldUpdate?.(row, 'isOnSale', checked)}\r\n          />\r\n        </div>\r\n      ),\r\n      meta: { displayName: \"Đang giảm giá\" },\r\n    },\r\n    {\r\n      id: \"sortOrder\",\r\n      accessorKey: \"sortOrder\",\r\n      header: \"Thứ tự\",\r\n      cell: ({ row }) => {\r\n        if (onFieldUpdate) {\r\n          return (\r\n            <div onClick={(e) => e.stopPropagation()}>\r\n              <InlineEditableNumberCell\r\n                value={row.sortOrder ?? 0}\r\n                onSave={(newValue) => onFieldUpdate(row, 'sortOrder', newValue)}\r\n              />\r\n            </div>\r\n          );\r\n        }\r\n        return row.sortOrder ?? '-';\r\n      },\r\n      meta: { displayName: \"Thứ tự\" },\r\n    },\r\n    {\r\n      id: \"publishedAt\",\r\n      accessorKey: \"publishedAt\",\r\n      header: \"Ngày đăng web\",\r\n      cell: ({ row }) => row.publishedAt ? formatDateForDisplay(row.publishedAt) : '-',\r\n      meta: { displayName: \"Ngày đăng web\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // MEDIA - Hình ảnh & Video\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"thumbnailImage\",\r\n      accessorKey: \"thumbnailImage\",\r\n      header: \"Ảnh đại diện\",\r\n      cell: ({ row }) => {\r\n        if (!row.thumbnailImage) return '-';\r\n        return (\r\n          <img \r\n            src={row.thumbnailImage} \r\n            alt={row.name} \r\n            className=\"w-10 h-10 object-cover rounded\"\r\n          />\r\n        );\r\n      },\r\n      meta: { displayName: \"Ảnh đại diện\" },\r\n      size: 80,\r\n    },\r\n    {\r\n      id: \"galleryImages\",\r\n      accessorKey: \"galleryImages\",\r\n      header: \"Album ảnh\",\r\n      cell: ({ row }) => {\r\n        const images = row.galleryImages;\r\n        if (!images || images.length === 0) return '-';\r\n        return <Badge variant=\"outline\">{images.length} ảnh</Badge>;\r\n      },\r\n      meta: { displayName: \"Album ảnh\" },\r\n    },\r\n    {\r\n      id: \"videoLinks\",\r\n      accessorKey: \"videoLinks\",\r\n      header: \"Video\",\r\n      cell: ({ row }) => {\r\n        const videos = row.videoLinks;\r\n        if (!videos || videos.length === 0) return '-';\r\n        return <Badge variant=\"outline\">{videos.length} video</Badge>;\r\n      },\r\n      meta: { displayName: \"Video\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // THUẾ\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"taxRate\",\r\n      accessorKey: \"taxRate\",\r\n      header: \"Thuế suất\",\r\n      cell: ({ row }) => {\r\n        if (row.taxRate === undefined) return '-';\r\n        return `${row.taxRate}%`;\r\n      },\r\n      meta: { displayName: \"Thuế suất\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // KHO - Theo dõi tồn kho & Vị trí\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"isStockTracked\",\r\n      accessorKey: \"isStockTracked\",\r\n      header: \"Theo dõi kho\",\r\n      cell: ({ row }) => (\r\n        <div onClick={(e) => e.stopPropagation()}>\r\n          <Switch\r\n            checked={row.isStockTracked !== false}\r\n            onCheckedChange={(checked) => onFieldUpdate?.(row, 'isStockTracked', checked)}\r\n          />\r\n        </div>\r\n      ),\r\n      meta: { displayName: \"Theo dõi kho\" },\r\n    },\r\n    {\r\n      id: \"warehouseLocation\",\r\n      accessorKey: \"warehouseLocation\",\r\n      header: \"Vị trí kho\",\r\n      cell: ({ row }) => row.warehouseLocation || '-',\r\n      meta: { displayName: \"Vị trí kho\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // TEM PHỤ - Thông tin in tem\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"nameVat\",\r\n      accessorKey: \"nameVat\",\r\n      header: \"Tên VAT\",\r\n      cell: ({ row }) => row.nameVat || '-',\r\n      meta: { displayName: \"Tên VAT\" },\r\n    },\r\n    {\r\n      id: \"origin\",\r\n      accessorKey: \"origin\",\r\n      header: \"Xuất xứ\",\r\n      cell: ({ row }) => row.origin || '-',\r\n      meta: { displayName: \"Xuất xứ\" },\r\n    },\r\n    {\r\n      id: \"usageGuide\",\r\n      accessorKey: \"usageGuide\",\r\n      header: \"HDSD\",\r\n      cell: ({ row }) => {\r\n        if (!row.usageGuide) return '-';\r\n        return <span className=\"line-clamp-1\">{row.usageGuide}</span>;\r\n      },\r\n      meta: { displayName: \"HDSD\" },\r\n    },\r\n    {\r\n      id: \"sellerNote\",\r\n      accessorKey: \"sellerNote\",\r\n      header: \"Ghi chú\",\r\n      cell: ({ row }) => {\r\n        if (onFieldUpdate) {\r\n          return (\r\n            <div onClick={(e) => e.stopPropagation()}>\r\n              <InlineEditableCell\r\n                value={row.sellerNote || ''}\r\n                onSave={(newValue) => onFieldUpdate(row, 'sellerNote', newValue)}\r\n              />\r\n            </div>\r\n          );\r\n        }\r\n        if (!row.sellerNote) return '-';\r\n        return <span className=\"line-clamp-1\">{row.sellerNote}</span>;\r\n      },\r\n      meta: { displayName: \"Ghi chú\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // SEO - Keywords\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"seoKeywords\",\r\n      accessorKey: \"seoKeywords\",\r\n      header: \"Keywords SEO\",\r\n      cell: ({ row }) => {\r\n        if (!row.seoKeywords) return '-';\r\n        return <span className=\"line-clamp-1\">{row.seoKeywords}</span>;\r\n      },\r\n      meta: { displayName: \"Keywords SEO\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // VARIANTS - Biến thể sản phẩm\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"hasVariants\",\r\n      accessorKey: \"hasVariants\",\r\n      header: \"Có biến thể\",\r\n      cell: ({ row }) => row.hasVariants ? <Badge variant=\"default\">Có</Badge> : '-',\r\n      meta: { displayName: \"Có biến thể\" },\r\n    },\r\n    {\r\n      id: \"variantsCount\",\r\n      header: \"Số biến thể\",\r\n      cell: ({ row }) => {\r\n        if (!row.variants || row.variants.length === 0) return '-';\r\n        return <Badge variant=\"outline\">{row.variants.length} biến thể</Badge>;\r\n      },\r\n      meta: { displayName: \"Số biến thể\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // COMBO - Thông tin combo\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"comboItemsCount\",\r\n      header: \"SP trong combo\",\r\n      cell: ({ row }) => {\r\n        if (row.type !== 'combo' || !row.comboItems || row.comboItems.length === 0) return '-';\r\n        return <Badge variant=\"secondary\">{row.comboItems.length} SP</Badge>;\r\n      },\r\n      meta: { displayName: \"SP trong combo\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // SALES ANALYTICS - Phân tích bán hàng\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"totalRevenue\",\r\n      accessorKey: \"totalRevenue\",\r\n      header: \"Tổng doanh thu\",\r\n      cell: ({ row }) => formatCurrency(row.totalRevenue),\r\n      meta: { displayName: \"Tổng doanh thu\" },\r\n    },\r\n    {\r\n      id: \"lastSoldDate\",\r\n      accessorKey: \"lastSoldDate\",\r\n      header: \"Ngày bán cuối\",\r\n      cell: ({ row }) => {\r\n        if (!row.lastSoldDate) return '-';\r\n        return formatDateForDisplay(row.lastSoldDate);\r\n      },\r\n      meta: { displayName: \"Ngày bán cuối\" },\r\n    },\r\n    {\r\n      id: \"viewCount\",\r\n      accessorKey: \"viewCount\",\r\n      header: \"Lượt xem\",\r\n      cell: ({ row }) => row.viewCount ?? '-',\r\n      meta: { displayName: \"Lượt xem\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // LIFECYCLE - Vòng đời sản phẩm\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"launchedDate\",\r\n      accessorKey: \"launchedDate\",\r\n      header: \"Ngày ra mắt\",\r\n      cell: ({ row }) => {\r\n        if (!row.launchedDate) return '-';\r\n        return formatDateForDisplay(row.launchedDate);\r\n      },\r\n      meta: { displayName: \"Ngày ra mắt\" },\r\n    },\r\n    {\r\n      id: \"discontinuedDate\",\r\n      accessorKey: \"discontinuedDate\",\r\n      header: \"Ngày ngừng KD\",\r\n      cell: ({ row }) => {\r\n        if (!row.discontinuedDate) return '-';\r\n        return formatDateForDisplay(row.discontinuedDate);\r\n      },\r\n      meta: { displayName: \"Ngày ngừng KD\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // TRENDTECH - Website Trendtech\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"trendtechId\",\r\n      accessorKey: \"trendtechId\",\r\n      header: \"ID Trendtech\",\r\n      cell: ({ row }) => {\r\n        if (onFieldUpdate) {\r\n          return (\r\n            <div onClick={(e) => e.stopPropagation()}>\r\n              <InlineEditableNumberCell\r\n                value={row.trendtechId || 0}\r\n                onSave={(newValue) => onFieldUpdate(row, 'trendtechId', newValue)}\r\n              />\r\n            </div>\r\n          );\r\n        }\r\n        return row.trendtechId || '-';\r\n      },\r\n      meta: { displayName: \"ID Trendtech\" },\r\n    },\r\n    // SEO Trendtech Score\r\n    {\r\n      id: \"seoTrendtech\",\r\n      accessorKey: \"seoTrendtech\",\r\n      header: \"SEO Trendtech\",\r\n      cell: ({ row }) => {\r\n        const score = calculateSeoScore(row.seoTrendtech);\r\n        return getSeoStatusBadge(score);\r\n      },\r\n      size: 100,\r\n      meta: { displayName: \"SEO Trendtech\", group: \"SEO\" },\r\n    },\r\n    {\r\n      id: \"trendtechSlug\",\r\n      accessorKey: \"trendtechSlug\",\r\n      header: \"Slug Trendtech\",\r\n      cell: ({ row }) => row.trendtechSlug || '-',\r\n      meta: { displayName: \"Slug Trendtech\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // THÔNG TIN HỆ THỐNG - Người tạo, cập nhật\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"updatedAt\",\r\n      accessorKey: \"updatedAt\",\r\n      header: \"Cập nhật lần cuối\",\r\n      cell: ({ row }) => formatDateTime(row.updatedAt),\r\n      meta: { displayName: \"Cập nhật lần cuối\" },\r\n    },\r\n    {\r\n      id: \"createdBy\",\r\n      accessorKey: \"createdBy\",\r\n      header: \"Người tạo\",\r\n      cell: ({ row }) => {\r\n        const employeeId = row.createdBy;\r\n        if (!employeeId) return '-';\r\n        const employee = employeeStore.findById(employeeId);\r\n        return employee ? employee.fullName : '-';\r\n      },\r\n      meta: { displayName: \"Người tạo\" },\r\n    },\r\n    {\r\n      id: \"updatedBy\",\r\n      accessorKey: \"updatedBy\",\r\n      header: \"Người cập nhật\",\r\n      cell: ({ row }) => {\r\n        const employeeId = row.updatedBy;\r\n        if (!employeeId) return '-';\r\n        const employee = employeeStore.findById(employeeId);\r\n        return employee ? employee.fullName : '-';\r\n      },\r\n      meta: { displayName: \"Người cập nhật\" },\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // CỘT PKGX - Riêng cho đồng bộ PKGX\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"pkgxActions\",\r\n      header: () => <div className=\"text-center\">PKGX</div>,\r\n      cell: ({ row }) => (\r\n        <PkgxProductActionsCell\r\n          product={row}\r\n          onPkgxPublish={onPkgxPublish}\r\n          onPkgxLink={onPkgxLink}\r\n          onPkgxUnlink={onPkgxUnlink}\r\n          onPkgxSyncImages={onPkgxSyncImages}\r\n        />\r\n      ),\r\n      meta: {\r\n        displayName: \"PKGX\",\r\n        sticky: \"right\",\r\n      },\r\n      size: 70,\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // CỘT HÀNH ĐỘNG - Các thao tác chung\r\n    // ═══════════════════════════════════════════════════════════════\r\n    {\r\n      id: \"actions\",\r\n      header: () => <div className=\"text-center\">Hành động</div>,\r\n      cell: ({ row }) => {\r\n        // ✅ Show restore button for deleted items\r\n        if (row.deletedAt) {\r\n          return (\r\n            <div className=\"flex items-center justify-center\" onClick={(e) => e.stopPropagation()}>\r\n              <Button\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                onClick={(e) => { e.stopPropagation(); onRestore(row.systemId); }}\r\n              >\r\n                <RotateCcw className=\"mr-2 h-4 w-4\" />\r\n                Khôi phục\r\n              </Button>\r\n            </div>\r\n          );\r\n        }\r\n        \r\n        // ✅ Show edit/delete for active items\r\n        return (\r\n          <div className=\"flex items-center justify-center\" onClick={(e) => e.stopPropagation()}>\r\n            <DropdownMenu>\r\n                <DropdownMenuTrigger asChild onClick={(e) => e.stopPropagation()}>\r\n                  <Button variant=\"ghost\" className=\"h-8 w-8 p-0\" onClick={(e) => e.stopPropagation()}>\r\n                    <span className=\"sr-only\">Mở menu</span>\r\n                    <MoreHorizontal className=\"h-4 w-4\" />\r\n                  </Button>\r\n                </DropdownMenuTrigger>\r\n                <DropdownMenuContent align=\"end\" onClick={(e) => e.stopPropagation()}>\r\n                  <DropdownMenuItem onSelect={() => router.push(`/products/${row.systemId}/edit`)}>\r\n                    Sửa\r\n                  </DropdownMenuItem>\r\n                  {onPrintLabel && (\r\n                    <DropdownMenuItem onSelect={() => onPrintLabel(row)}>\r\n                      In tem phụ\r\n                    </DropdownMenuItem>\r\n                  )}\r\n                  <DropdownMenuSeparator />\r\n                  <DropdownMenuItem className=\"text-destructive\" onSelect={() => onDelete(row.systemId)}>\r\n                    Chuyển vào thùng rác\r\n                  </DropdownMenuItem>\r\n                </DropdownMenuContent>\r\n              </DropdownMenu>\r\n          </div>\r\n        );\r\n      },\r\n      meta: {\r\n        displayName: \"Hành động\",\r\n        sticky: \"right\",\r\n      },\r\n      size: 90,\r\n    },\r\n    // ═══════════════════════════════════════════════════════════════\r\n    // DYNAMIC PRICE COLUMNS - Tự động tạo cột cho mỗi bảng giá\r\n    // ═══════════════════════════════════════════════════════════════\r\n    ...activePricingPolicies.map((policy) => ({\r\n      id: `price_${policy.systemId}`,\r\n      header: `Giá: ${policy.name}`,\r\n      cell: ({ row }: { row: Product }) => {\r\n        const price = row.prices?.[policy.systemId];\r\n        if (onFieldUpdate) {\r\n          return (\r\n            <div onClick={(e: React.MouseEvent) => e.stopPropagation()}>\r\n              <InlineEditableNumberCell\r\n                value={price || 0}\r\n                onSave={(newValue: number) => onFieldUpdate(row, `prices.${policy.systemId}`, newValue)}\r\n              />\r\n            </div>\r\n          );\r\n        }\r\n        return formatCurrency(price);\r\n      },\r\n      meta: { displayName: `Giá: ${policy.name}` },\r\n    } as ColumnDef<Product>)),\r\n  ];\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3966, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/store.ts"],"sourcesContent":["import { createCrudStore, CrudState } from '../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { Product } from './types';\r\nimport { type SystemId } from '@/lib/id-types';\r\nimport { asSystemId, asBusinessId } from '../../lib/id-types';\r\nimport { getCurrentUserSystemId } from '../../contexts/auth-context';\r\nimport Fuse from 'fuse.js';\r\nimport {\r\n  getCurrentUserInfo,\r\n  createCreatedEntry,\r\n  createUpdatedEntry,\r\n  createStatusChangedEntry,\r\n  appendHistoryEntry,\r\n  type HistoryEntry\r\n} from '../../lib/activity-history-helper';\r\n\r\nconst baseStore = createCrudStore<Product>([], 'products', {\r\n  businessIdField: 'id',\r\n  getCurrentUser: getCurrentUserSystemId, // ✅ Track who creates/updates\r\n  apiEndpoint: '/api/products',\r\n});\r\n\r\n// ✅ API Sync helpers\r\nconst API_ENDPOINT = '/api/products';\r\n\r\nconst syncToApi = {\r\n  create: async (product: Product) => {\r\n    try {\r\n      const response = await fetch(API_ENDPOINT, {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(product),\r\n      });\r\n      if (!response.ok) console.warn('[Product API] Create sync failed');\r\n      else console.log('[Product API] Created:', product.systemId);\r\n    } catch (e) {\r\n      console.warn('[Product API] Create sync error:', e);\r\n    }\r\n  },\r\n  update: async (systemId: SystemId, updates: Partial<Product>) => {\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}`, {\r\n        method: 'PATCH',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(updates),\r\n      });\r\n      if (!response.ok) console.warn('[Product API] Update sync failed');\r\n      else console.log('[Product API] Updated:', systemId);\r\n    } catch (e) {\r\n      console.warn('[Product API] Update sync error:', e);\r\n    }\r\n  },\r\n  delete: async (systemId: SystemId, hard = false) => {\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ hard }),\r\n      });\r\n      if (!response.ok) console.warn('[Product API] Delete sync failed');\r\n      else console.log('[Product API] Deleted:', systemId);\r\n    } catch (e) {\r\n      console.warn('[Product API] Delete sync error:', e);\r\n    }\r\n  },\r\n  restore: async (systemId: SystemId) => {\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}/restore`, {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n      });\r\n      if (!response.ok) console.warn('[Product API] Restore sync failed');\r\n      else console.log('[Product API] Restored:', systemId);\r\n    } catch (e) {\r\n      console.warn('[Product API] Restore sync error:', e);\r\n    }\r\n  },\r\n};\r\n\r\n// ✅ Wrap base store methods with API sync\r\nconst originalAdd = baseStore.getState().add;\r\nconst originalUpdate = baseStore.getState().update;\r\nconst originalRemove = baseStore.getState().remove;\r\nconst originalHardDelete = baseStore.getState().hardDelete;\r\nconst originalRestore = baseStore.getState().restore;\r\n\r\nbaseStore.setState({\r\n  add: (item: Omit<Product, 'systemId'>) => {\r\n    const result = originalAdd(item);\r\n    syncToApi.create(result);\r\n    return result;\r\n  },\r\n  update: (systemId: SystemId, updates: Partial<Product>) => {\r\n    originalUpdate(systemId, updates);\r\n    syncToApi.update(systemId, updates);\r\n  },\r\n  remove: (systemId: SystemId) => {\r\n    originalRemove(systemId);\r\n    syncToApi.delete(systemId, false);\r\n  },\r\n  hardDelete: (systemId: SystemId) => {\r\n    originalHardDelete(systemId);\r\n    syncToApi.delete(systemId, true);\r\n  },\r\n  restore: (systemId: SystemId) => {\r\n    originalRestore(systemId);\r\n    syncToApi.restore(systemId);\r\n  },\r\n});\r\n\r\n// Define extended store interface\r\nexport interface ProductStoreState extends CrudState<Product> {\r\n  updateInventory: (productSystemId: SystemId, branchSystemId: SystemId, quantityChange: number) => void;\r\n  commitStock: (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => void;\r\n  uncommitStock: (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => void;\r\n  dispatchStock: (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => void;\r\n  completeDelivery: (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => void;\r\n  returnStockFromTransit: (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => void;\r\n  updateLastPurchasePrice: (productSystemId: SystemId, price: number, date: string) => void;\r\n  searchProducts: (query: string, page: number, limit?: number) => Promise<{ items: { value: SystemId; label: string }[], hasNextPage: boolean }>;\r\n}\r\n\r\n// Helper to check if product tracks stock\r\nconst canModifyStock = (product: Product | undefined): boolean => {\r\n  if (!product) return false;\r\n  // Services, digital products, and combos don't track stock directly\r\n  if (product.type === 'service' || product.type === 'digital' || product.type === 'combo') return false;\r\n  // Explicitly disabled stock tracking\r\n  if (product.isStockTracked === false) return false;\r\n  return true;\r\n};\r\n\r\n// Define custom methods\r\nconst updateInventory = (productSystemId: SystemId, branchSystemId: SystemId, quantityChange: number) => {\r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!product) return state;\r\n    \r\n    // Skip if product doesn't track stock\r\n    if (!canModifyStock(product)) {\r\n      console.warn(`[updateInventory] Skipped: Product ${productSystemId} does not track stock`);\r\n      return state;\r\n    }\r\n    \r\n    const oldQuantity = product.inventoryByBranch?.[branchSystemId] || 0;\r\n    const newQuantity = oldQuantity + quantityChange;\r\n    \r\n    // ✅ Removed COMPLAINT_ADJUSTMENT stock history creation\r\n    // Stock history will be created by inventory check balance instead\r\n    \r\n    return {\r\n      data: state.data.map(p => {\r\n        if (p.systemId === productSystemId) {\r\n          const newInventoryByBranch = { ...p.inventoryByBranch };\r\n          newInventoryByBranch[branchSystemId] = newQuantity;\r\n          return {\r\n            ...p,\r\n            inventoryByBranch: newInventoryByBranch,\r\n          };\r\n        }\r\n        return p;\r\n      }),\r\n    };\r\n  });\r\n};\r\n\r\nconst commitStock = (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => {\r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!canModifyStock(product)) {\r\n      console.warn(`[commitStock] Skipped: Product ${productSystemId} does not track stock`);\r\n      return state;\r\n    }\r\n    return {\r\n      data: state.data.map(p => {\r\n        if (p.systemId === productSystemId) {\r\n          const newCommitted = { ...p.committedByBranch };\r\n          newCommitted[branchSystemId] = (newCommitted[branchSystemId] || 0) + quantity;\r\n          return { ...p, committedByBranch: newCommitted };\r\n        }\r\n        return p;\r\n      }),\r\n    };\r\n  });\r\n};\r\n\r\nconst uncommitStock = (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => {\r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!canModifyStock(product)) {\r\n      console.warn(`[uncommitStock] Skipped: Product ${productSystemId} does not track stock`);\r\n      return state;\r\n    }\r\n    return {\r\n      data: state.data.map(p => {\r\n        if (p.systemId === productSystemId) {\r\n          const newCommitted = { ...p.committedByBranch };\r\n          newCommitted[branchSystemId] = Math.max(0, (newCommitted[branchSystemId] || 0) - quantity);\r\n          return { ...p, committedByBranch: newCommitted };\r\n        }\r\n        return p;\r\n      }),\r\n    };\r\n  });\r\n};\r\n\r\nconst dispatchStock = (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => {\r\n  console.log('🔴 [dispatchStock] Called with:', { productSystemId, branchSystemId, quantity });\r\n  \r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!product) {\r\n      console.error('❌ [dispatchStock] Product not found:', productSystemId);\r\n      return state;\r\n    }\r\n    \r\n    // Skip if product doesn't track stock\r\n    if (!canModifyStock(product)) {\r\n      console.warn(`[dispatchStock] Skipped: Product ${productSystemId} does not track stock`);\r\n      return state;\r\n    }\r\n    \r\n    console.log('📦 [dispatchStock] Current inventory:', product.inventoryByBranch);\r\n    console.log('📦 [dispatchStock] Current committed:', product.committedByBranch);\r\n    \r\n    return {\r\n      data: state.data.map(product => {\r\n        if (product.systemId === productSystemId) {\r\n          const newInventory = { ...product.inventoryByBranch };\r\n          const oldInventory = newInventory[branchSystemId] || 0;\r\n          newInventory[branchSystemId] = oldInventory - quantity;\r\n          \r\n          const newCommitted = { ...product.committedByBranch };\r\n          newCommitted[branchSystemId] = Math.max(0, (newCommitted[branchSystemId] || 0) - quantity);\r\n\r\n          const newInTransit = { ...product.inTransitByBranch };\r\n          newInTransit[branchSystemId] = (newInTransit[branchSystemId] || 0) + quantity;\r\n          \r\n          console.log('✅ [dispatchStock] Updated inventory:', {\r\n            old: oldInventory,\r\n            new: newInventory[branchSystemId],\r\n            change: -quantity\r\n          });\r\n          \r\n          return { \r\n            ...product, \r\n            inventoryByBranch: newInventory,\r\n            committedByBranch: newCommitted,\r\n            inTransitByBranch: newInTransit,\r\n          };\r\n        }\r\n        return product;\r\n      }),\r\n    };\r\n  });\r\n  \r\n  console.log('✅ [dispatchStock] Completed');\r\n};\r\n\r\nconst completeDelivery = (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => {\r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!canModifyStock(product)) {\r\n      return state;\r\n    }\r\n    return {\r\n      data: state.data.map(p => {\r\n        if (p.systemId === productSystemId) {\r\n          const newInTransit = { ...p.inTransitByBranch };\r\n          newInTransit[branchSystemId] = Math.max(0, (newInTransit[branchSystemId] || 0) - quantity);\r\n          return { ...p, inTransitByBranch: newInTransit };\r\n        }\r\n        return p;\r\n      }),\r\n    };\r\n  });\r\n};\r\n\r\nconst returnStockFromTransit = (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => {\r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!canModifyStock(product)) {\r\n      return state;\r\n    }\r\n    return {\r\n      data: state.data.map(p => {\r\n        if (p.systemId === productSystemId) {\r\n          const newInTransit = { ...p.inTransitByBranch };\r\n          newInTransit[branchSystemId] = Math.max(0, (newInTransit[branchSystemId] || 0) - quantity);\r\n          const newInventory = { ...p.inventoryByBranch };\r\n          newInventory[branchSystemId] = (newInventory[branchSystemId] || 0) + quantity;\r\n          return { ...p, inventoryByBranch: newInventory, inTransitByBranch: newInTransit };\r\n        }\r\n        return p;\r\n      }),\r\n    };\r\n  });\r\n};\r\n\r\nconst updateLastPurchasePrice = (productSystemId: SystemId, price: number, date: string) => {\r\n  baseStore.setState(state => ({\r\n    data: state.data.map(product => {\r\n      if (product.systemId === productSystemId) {\r\n        // Only update if the new date is newer or equal to the existing lastPurchaseDate\r\n        const existingDate = product.lastPurchaseDate ? new Date(product.lastPurchaseDate).getTime() : 0;\r\n        const newDateTs = new Date(date).getTime();\r\n        \r\n        if (newDateTs >= existingDate) {\r\n          return {\r\n            ...product,\r\n            lastPurchasePrice: price,\r\n            lastPurchaseDate: date,\r\n          };\r\n        }\r\n      }\r\n      return product;\r\n    }),\r\n  }));\r\n};\r\n\r\nconst searchProducts = async (query: string, page: number = 1, limit: number = 10): Promise<{ items: { value: SystemId; label: string }[], hasNextPage: boolean }> => {\r\n  const allProducts = baseStore.getState().data;\r\n  \r\n  // ✅ Create fresh Fuse instance with current data (avoid stale data)\r\n  const fuse = new Fuse(allProducts, {\r\n    keys: ['name', 'id', 'sku', 'barcode'],\r\n    threshold: 0.3,\r\n  });\r\n  \r\n  const results = fuse.search(query);\r\n  const startIndex = (page - 1) * limit;\r\n  const endIndex = startIndex + limit;\r\n  const paginatedResults = results.slice(startIndex, endIndex);\r\n\r\n  return {\r\n    items: paginatedResults.map(result => ({\r\n      value: asSystemId(result.item.systemId),\r\n      label: `${result.item.name} (${result.item.id})`,\r\n    })),\r\n    hasNextPage: endIndex < results.length,\r\n  };\r\n};\r\n\r\n// Wrapped add method with activity history logging\r\nconst addProduct = (product: Omit<Product, 'systemId'>) => {\r\n  const userInfo = getCurrentUserInfo();\r\n  const newProduct = baseStore.getState().add(product);\r\n  \r\n  // Add activity history entry\r\n  const historyEntry = createCreatedEntry(\r\n    userInfo,\r\n    `${userInfo.name} đã tạo sản phẩm ${newProduct.name} (${newProduct.id})`\r\n  );\r\n  baseStore.getState().update(newProduct.systemId, {\r\n    ...newProduct,\r\n    activityHistory: [historyEntry]\r\n  });\r\n  \r\n  return newProduct;\r\n};\r\n\r\n// Wrapped update method with activity history logging\r\nconst updateProduct = (systemId: SystemId, updatedProduct: Product) => {\r\n  const userInfo = getCurrentUserInfo();\r\n  const existingProduct = baseStore.getState().data.find(p => p.systemId === systemId);\r\n  const historyEntries: HistoryEntry[] = [];\r\n  \r\n  if (existingProduct) {\r\n    // Track status changes\r\n    if (existingProduct.status !== updatedProduct.status) {\r\n      const statusLabels: Record<string, string> = {\r\n        'active': 'Đang kinh doanh',\r\n        'inactive': 'Ngừng kinh doanh',\r\n        'discontinued': 'Ngừng sản xuất'\r\n      };\r\n      historyEntries.push(createStatusChangedEntry(\r\n        userInfo,\r\n        statusLabels[existingProduct.status || 'active'],\r\n        statusLabels[updatedProduct.status || 'active'],\r\n        `${userInfo.name} đã đổi trạng thái từ \"${statusLabels[existingProduct.status || 'active']}\" sang \"${statusLabels[updatedProduct.status || 'active']}\"`\r\n      ));\r\n    }\r\n    \r\n    // Track field changes\r\n    const fieldsToTrack: Array<{ key: keyof Product; label: string }> = [\r\n      { key: 'name', label: 'Tên sản phẩm' },\r\n      { key: 'id', label: 'Mã SKU' },\r\n      { key: 'description', label: 'Mô tả' },\r\n      { key: 'shortDescription', label: 'Mô tả ngắn' },\r\n      { key: 'type', label: 'Loại sản phẩm' },\r\n      { key: 'categorySystemId', label: 'Danh mục' },\r\n      { key: 'brandSystemId', label: 'Thương hiệu' },\r\n      { key: 'unit', label: 'Đơn vị tính' },\r\n      { key: 'costPrice', label: 'Giá vốn' },\r\n      { key: 'minPrice', label: 'Giá tối thiểu' },\r\n      { key: 'barcode', label: 'Mã vạch' },\r\n      { key: 'primarySupplierSystemId', label: 'Nhà cung cấp chính' },\r\n      { key: 'warrantyPeriodMonths', label: 'Thời hạn bảo hành' },\r\n      { key: 'reorderLevel', label: 'Mức đặt hàng lại' },\r\n      { key: 'safetyStock', label: 'Tồn kho an toàn' },\r\n      { key: 'maxStock', label: 'Tồn kho tối đa' },\r\n    ];\r\n    \r\n    const changes: string[] = [];\r\n    for (const field of fieldsToTrack) {\r\n      const oldVal = existingProduct[field.key];\r\n      const newVal = updatedProduct[field.key];\r\n      if (oldVal !== newVal && !(oldVal === undefined && newVal === undefined)) {\r\n        if (field.key === 'status') continue;\r\n        const oldDisplay = oldVal !== undefined && oldVal !== null && oldVal !== '' ? String(oldVal) : '(trống)';\r\n        const newDisplay = newVal !== undefined && newVal !== null && newVal !== '' ? String(newVal) : '(trống)';\r\n        changes.push(`${field.label}: ${oldDisplay} → ${newDisplay}`);\r\n      }\r\n    }\r\n    \r\n    // Track price changes separately\r\n    if (existingProduct.costPrice !== updatedProduct.costPrice) {\r\n      changes.push(`Giá vốn: ${existingProduct.costPrice?.toLocaleString('vi-VN')} → ${updatedProduct.costPrice?.toLocaleString('vi-VN')}`);\r\n    }\r\n    \r\n    if (changes.length > 0) {\r\n      historyEntries.push(createUpdatedEntry(\r\n        userInfo,\r\n        `${userInfo.name} đã cập nhật: ${changes.join(', ')}`\r\n      ));\r\n    }\r\n  }\r\n  \r\n  const productWithHistory = {\r\n    ...updatedProduct,\r\n    activityHistory: appendHistoryEntry(existingProduct?.activityHistory, ...historyEntries)\r\n  };\r\n  \r\n  baseStore.getState().update(systemId, productWithHistory);\r\n};\r\n\r\n// Export typed hook that includes both base and custom methods\r\nexport const useProductStore = (): ProductStoreState => {\r\n  const state = baseStore();\r\n  return {\r\n    ...state,\r\n    add: addProduct,\r\n    update: updateProduct,\r\n    updateInventory,\r\n    commitStock,\r\n    uncommitStock,\r\n    dispatchStock,\r\n    completeDelivery,\r\n    returnStockFromTransit,\r\n    updateLastPurchasePrice,\r\n    searchProducts,\r\n  };\r\n};\r\n\r\n// Export getState method for non-hook usage\r\nuseProductStore.getState = () => {\r\n  const state = baseStore.getState();\r\n  return {\r\n    ...state,\r\n    add: addProduct,\r\n    update: updateProduct,\r\n    updateInventory,\r\n    commitStock,\r\n    uncommitStock,\r\n    dispatchStock,\r\n    completeDelivery,\r\n    returnStockFromTransit,\r\n    updateLastPurchasePrice,\r\n    searchProducts,\r\n  };\r\n};\r\n\r\n(useProductStore as typeof useProductStore & { subscribe?: typeof baseStore.subscribe }).subscribe = baseStore.subscribe;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4480, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/product-importer.ts"],"sourcesContent":["import type { Product } from './types';\r\nimport type { SystemId } from '@/lib/id-types';\r\n\r\nexport const INVENTORY_FIELD_PREFIXES = ['inventory', 'tonkho', 'stock'] as const;\r\nexport const FALLBACK_INVENTORY_KEYS = ['inventory', 'tonkho', 'stock', 'qty', 'quantity', 'soluong', 'tongton', 'totalsoluong'] as const;\r\n\r\nexport type BranchInventoryIdentifier = {\r\n  systemId: SystemId;\r\n  identifiers: Set<string>;\r\n};\r\n\r\nexport interface ProductImportOptions {\r\n  branchIdentifiers: BranchInventoryIdentifier[];\r\n  defaultBranchSystemId: SystemId | null;\r\n  currentEmployeeSystemId: SystemId;\r\n}\r\n\r\nexport function normalizeFieldKey(value?: string | number | null) {\r\n  if (value === undefined || value === null) return '';\r\n  return value\r\n    .toString()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/gu, '')\r\n    .toLowerCase()\r\n    .replace(/[^a-z0-9]/g, '');\r\n}\r\n\r\nfunction buildNormalizedRowKeyMap(row: Record<string, any>) {\r\n  return Object.keys(row).reduce<Record<string, string>>((acc, key) => {\r\n    const normalizedKey = normalizeFieldKey(key);\r\n    if (normalizedKey && !(normalizedKey in acc)) {\r\n      acc[normalizedKey] = key;\r\n    }\r\n    return acc;\r\n  }, {});\r\n}\r\n\r\nfunction parseNumericValue(value: unknown): number | null {\r\n  if (value === null || value === undefined || value === '') return null;\r\n  if (typeof value === 'number' && !Number.isNaN(value)) return value;\r\n  if (typeof value === 'string') {\r\n    const sanitized = value.replace(/\\s+/g, '').replace(/,/g, '').replace(/[^0-9.-]/g, '');\r\n    if (!sanitized) return null;\r\n    const parsed = Number(sanitized);\r\n    return Number.isNaN(parsed) ? null : parsed;\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction findMatchingKeyForIdentifier(normalizedRowKeyMap: Record<string, string>, identifier: string) {\r\n  if (!identifier) return null;\r\n  if (normalizedRowKeyMap[identifier]) {\r\n    return normalizedRowKeyMap[identifier];\r\n  }\r\n\r\n  for (const prefix of INVENTORY_FIELD_PREFIXES) {\r\n    const prefixed = normalizedRowKeyMap[`${prefix}${identifier}`];\r\n    if (prefixed) return prefixed;\r\n  }\r\n\r\n  const fallback = Object.entries(normalizedRowKeyMap).find(([normalizedKey]) =>\r\n    normalizedKey.endsWith(identifier) || normalizedKey.startsWith(identifier)\r\n  );\r\n  return fallback?.[1] ?? null;\r\n}\r\n\r\nfunction getBranchInventoryValue(\r\n  row: Record<string, any>,\r\n  normalizedRowKeyMap: Record<string, string>,\r\n  identifiers: Set<string>,\r\n) {\r\n  for (const identifier of identifiers) {\r\n    const originalKey = findMatchingKeyForIdentifier(normalizedRowKeyMap, identifier);\r\n    if (originalKey) {\r\n      const parsed = parseNumericValue(row[originalKey]);\r\n      if (parsed !== null) {\r\n        return parsed;\r\n      }\r\n    }\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction getFallbackInventoryValue(\r\n  row: Record<string, any>,\r\n  normalizedRowKeyMap: Record<string, string>,\r\n) {\r\n  for (const key of FALLBACK_INVENTORY_KEYS) {\r\n    const originalKey = normalizedRowKeyMap[key];\r\n    if (!originalKey) continue;\r\n    const parsed = parseNumericValue(row[originalKey]);\r\n    if (parsed !== null) {\r\n      return parsed;\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\nexport function transformImportedRows(rows: any[], options: ProductImportOptions) {\r\n  return rows.map((item: any, index: number) => {\r\n    if (!item.name) {\r\n      throw new Error(`Dòng ${index + 1} thiếu tên sản phẩm`);\r\n    }\r\n\r\n    const normalizedRowKeyMap = buildNormalizedRowKeyMap(item);\r\n    const inventoryByBranch: Record<string, number> = {};\r\n\r\n    options.branchIdentifiers.forEach(({ systemId, identifiers }) => {\r\n      inventoryByBranch[systemId] = getBranchInventoryValue(item, normalizedRowKeyMap, identifiers);\r\n    });\r\n\r\n    const totalBranchInventory = Object.values(inventoryByBranch).reduce((sum, qty) => sum + (Number(qty) || 0), 0);\r\n    const fallbackInventory = getFallbackInventoryValue(item, normalizedRowKeyMap);\r\n\r\n    if (fallbackInventory !== null && totalBranchInventory === 0 && options.defaultBranchSystemId) {\r\n      inventoryByBranch[options.defaultBranchSystemId] = fallbackInventory;\r\n    }\r\n\r\n    return {\r\n      id: item.id || item.sku || '',\r\n      name: item.name,\r\n      sku: item.sku || '',\r\n      type: item.type || 'physical',\r\n      status: item.status || 'active',\r\n      unit: item.unit || '',\r\n      defaultPrice: Number(item.defaultPrice) || 0,\r\n      costPrice: Number(item.costPrice) || 0,\r\n      inventory: Number(item.inventory) || 0,\r\n      inventoryByBranch,\r\n      committedByBranch: {},\r\n      inTransitByBranch: {},\r\n      inventoryWarning: Number(item.inventoryWarning) || 0,\r\n      categorySystemId: item.categorySystemId || '',\r\n      description: item.description || '',\r\n      prices: {},\r\n      isDeleted: false,\r\n      createdAt: new Date().toISOString(),\r\n      createdBy: options.currentEmployeeSystemId,\r\n      updatedAt: new Date().toISOString(),\r\n      updatedBy: options.currentEmployeeSystemId,\r\n    } as Omit<Product, 'systemId'>;\r\n  });\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4611, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/components/pkgx-link-dialog.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Link2 } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { Button } from '@/components/ui/button';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog';\r\nimport { VirtualizedCombobox, type ComboboxOption } from '@/components/ui/virtualized-combobox';\r\nimport { usePkgxSettingsStore } from '@/features/settings/pkgx/store';\r\nimport { useAllProducts } from '../hooks/use-all-products';\r\nimport { useProductMutations } from '../hooks/use-products';\r\nimport type { Product } from '../types';\r\nimport type { PkgxProduct } from '@/features/settings/pkgx/types';\r\nimport { getProducts as fetchPkgxProducts } from '@/lib/pkgx/api-service';\r\n\r\ninterface PkgxLinkDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  product: Product | null;\r\n  onSuccess?: (pkgxId: number) => void;\r\n}\r\n\r\nexport function PkgxLinkDialog({\r\n  open,\r\n  onOpenChange,\r\n  product,\r\n  onSuccess,\r\n}: PkgxLinkDialogProps) {\r\n  const { update: updateProductMutation } = useProductMutations();\r\n  const pkgxSettingsStore = usePkgxSettingsStore();\r\n  const cachedPkgxProducts = pkgxSettingsStore.settings.pkgxProducts;\r\n  const setPkgxProducts = pkgxSettingsStore.setPkgxProducts;\r\n  \r\n  const [selectedPkgxProduct, setSelectedPkgxProduct] = React.useState<ComboboxOption | null>(null);\r\n  const [pkgxProducts, setPkgxProductsLocal] = React.useState<PkgxProduct[]>([]);\r\n  const [isLoading, setIsLoading] = React.useState(false);\r\n  const [isSyncing, setIsSyncing] = React.useState(false);\r\n  const [hasFetched, setHasFetched] = React.useState(false);\r\n\r\n  // Load PKGX products khi mở dialog - chỉ chạy 1 lần\r\n  React.useEffect(() => {\r\n    if (open && !hasFetched) {\r\n      if (cachedPkgxProducts && cachedPkgxProducts.length > 0) {\r\n        setPkgxProductsLocal(cachedPkgxProducts);\r\n        setHasFetched(true);\r\n      } else {\r\n        loadPkgxProducts();\r\n      }\r\n    }\r\n  }, [open, hasFetched, cachedPkgxProducts]);\r\n\r\n  // Reset state khi đóng dialog\r\n  React.useEffect(() => {\r\n    if (!open) {\r\n      setSelectedPkgxProduct(null);\r\n    }\r\n  }, [open]);\r\n\r\n  const loadPkgxProducts = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      const response = await fetchPkgxProducts(1, 1000);\r\n      if (response.success && response.data && response.data.data) {\r\n        // API trả về { data: PkgxProduct[], pagination: {...} }\r\n        const productsArray = Array.isArray(response.data.data) ? response.data.data : [];\r\n        setPkgxProductsLocal(productsArray);\r\n        setPkgxProducts(productsArray); // Lưu vào store để dùng chung\r\n        setHasFetched(true);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load PKGX products:', error);\r\n      toast.error('Không thể tải danh sách sản phẩm PKGX');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Filter out products that are already linked\r\n  const { data: hrmProducts } = useAllProducts();\r\n  const linkedPkgxIds = React.useMemo(() => {\r\n    return new Set(hrmProducts.filter(p => p.pkgxId).map(p => p.pkgxId));\r\n  }, [hrmProducts]);\r\n\r\n  // Convert PKGX products to combobox options\r\n  const pkgxOptions: ComboboxOption[] = React.useMemo(() => {\r\n    return pkgxProducts\r\n      .filter(p => !linkedPkgxIds.has(p.goods_id)) // Exclude already linked\r\n      .map(p => ({\r\n        value: String(p.goods_id),\r\n        label: p.goods_name,\r\n        subtitle: `ID: ${p.goods_id} | Mã: ${p.goods_sn || '-'}`,\r\n        metadata: p,\r\n      }));\r\n  }, [pkgxProducts, linkedPkgxIds]);\r\n\r\n  const handleConfirmLink = async () => {\r\n    if (!product || !selectedPkgxProduct) {\r\n      toast.error('Vui lòng chọn sản phẩm PKGX để liên kết');\r\n      return;\r\n    }\r\n\r\n    setIsSyncing(true);\r\n    try {\r\n      const pkgxId = Number(selectedPkgxProduct.value);\r\n      \r\n      // Update HRM product with pkgxId\r\n      updateProductMutation.mutate(\r\n        { systemId: product.systemId, pkgxId },\r\n        {\r\n          onSuccess: () => {\r\n            // Log to console\r\n            console.log('[PKGX Link]', {\r\n              action: 'link_product',\r\n              status: 'success',\r\n              productId: product.systemId,\r\n              pkgxId,\r\n              pkgxProductName: selectedPkgxProduct.label,\r\n            });\r\n\r\n            toast.success(`Đã liên kết với sản phẩm PKGX: ${selectedPkgxProduct.label}`);\r\n            onSuccess?.(pkgxId);\r\n            onOpenChange(false);\r\n          },\r\n          onError: (error) => {\r\n            console.error('[PKGX Link Error]', error);\r\n            toast.error('Lỗi khi liên kết sản phẩm');\r\n          },\r\n          onSettled: () => {\r\n            setIsSyncing(false);\r\n          }\r\n        }\r\n      );\r\n    } catch (error) {\r\n      console.error('[PKGX Link Error]', error);\r\n      toast.error('Lỗi khi liên kết sản phẩm');\r\n      setIsSyncing(false);\r\n    }\r\n  };\r\n\r\n  if (!product) return null;\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-[500px]\">\r\n        <DialogHeader>\r\n          <DialogTitle>Liên kết với sản phẩm PKGX</DialogTitle>\r\n          <DialogDescription>\r\n            Chọn sản phẩm PKGX để liên kết với sản phẩm HRM này\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-4 py-4\">\r\n          {/* HRM Product Info */}\r\n          <div className=\"rounded-lg bg-muted p-3\">\r\n            <p className=\"text-sm font-medium\">Sản phẩm HRM:</p>\r\n            <p className=\"text-sm\">{product.name}</p>\r\n            <p className=\"text-xs text-muted-foreground\">\r\n              Mã: {product.id} | SystemID: {product.systemId}\r\n            </p>\r\n          </div>\r\n\r\n          {/* PKGX Product Selector */}\r\n          <div className=\"space-y-2\">\r\n            <label className=\"text-sm font-medium\">Chọn sản phẩm PKGX</label>\r\n            <VirtualizedCombobox\r\n              value={selectedPkgxProduct}\r\n              onChange={setSelectedPkgxProduct}\r\n              options={pkgxOptions}\r\n              placeholder=\"Tìm và chọn sản phẩm PKGX...\"\r\n              searchPlaceholder=\"Tìm theo tên hoặc mã...\"\r\n              emptyPlaceholder={isLoading ? 'Đang tải...' : 'Không tìm thấy sản phẩm PKGX'}\r\n              isLoading={isLoading}\r\n              disabled={isLoading}\r\n            />\r\n            {pkgxOptions.length === 0 && !isLoading && (\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                Tất cả sản phẩm PKGX đã được liên kết. Hãy đồng bộ danh sách mới từ PKGX.\r\n              </p>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <DialogFooter>\r\n          <Button\r\n            variant=\"outline\"\r\n            onClick={() => onOpenChange(false)}\r\n            disabled={isSyncing}\r\n          >\r\n            Hủy\r\n          </Button>\r\n          <Button\r\n            onClick={handleConfirmLink}\r\n            disabled={!selectedPkgxProduct || isSyncing}\r\n          >\r\n            <Link2 className=\"h-4 w-4 mr-2\" />\r\n            {isSyncing ? 'Đang liên kết...' : 'Liên kết'}\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4946, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/product-service.ts"],"sourcesContent":["import Fuse from 'fuse.js';\r\nimport type { IFuseOptions } from 'fuse.js';\r\nimport { isDateAfter, isDateBefore } from '../../lib/date-utils';\r\nimport type { Product, ProductStatus, ProductType } from './types';\r\nimport { useProductStore } from './store';\r\n\r\nexport type ProductSortKey = 'name' | 'id' | 'createdAt' | 'status' | 'type';\r\n\r\nexport const DEFAULT_PRODUCT_SORT: { id: ProductSortKey; desc: boolean } = {\r\n  id: 'createdAt',\r\n  desc: true,\r\n};\r\n\r\nexport interface ProductQueryParams {\r\n  search: string;\r\n  statusFilter: ProductStatus | 'all';\r\n  typeFilter: ProductType | 'all';\r\n  categoryFilter: string;\r\n  comboFilter: 'all' | 'combo' | 'non-combo';\r\n  stockLevelFilter: 'all' | 'out-of-stock' | 'low-stock' | 'below-safety' | 'high-stock';\r\n  pkgxFilter: 'all' | 'linked' | 'not-linked';\r\n  dateRange?: [string | undefined, string | undefined] | undefined;\r\n  pagination: { pageIndex: number; pageSize: number };\r\n  sorting: { id: ProductSortKey; desc: boolean };\r\n}\r\n\r\nexport interface ProductQueryResult {\r\n  items: Product[];\r\n  total: number;\r\n  pageCount: number;\r\n  pageIndex: number;\r\n}\r\n\r\ninterface PipelineResult {\r\n  filtered: Product[];\r\n}\r\n\r\nconst fuseOptions: IFuseOptions<Product> = {\r\n  keys: ['name', 'id', 'barcode', 'tags'],\r\n  threshold: 0.3,\r\n};\r\n\r\n// ========================================\r\n// Cached Fuse index for better performance\r\n// ========================================\r\nlet cachedFuseIndex: Fuse<Product> | null = null;\r\nlet cachedProductsLength = 0;\r\nlet cachedProductsHash = '';\r\n\r\nfunction getProductsHash(products: Product[]): string {\r\n  // Simple hash based on first/last product IDs and length\r\n  if (products.length === 0) return 'empty';\r\n  return `${products.length}-${products[0]?.systemId}-${products[products.length - 1]?.systemId}`;\r\n}\r\n\r\nfunction getFuseIndex(products: Product[]): Fuse<Product> {\r\n  const hash = getProductsHash(products);\r\n  if (cachedFuseIndex && cachedProductsHash === hash) {\r\n    return cachedFuseIndex;\r\n  }\r\n  // Rebuild index only when products change\r\n  cachedFuseIndex = new Fuse(products, fuseOptions);\r\n  cachedProductsHash = hash;\r\n  cachedProductsLength = products.length;\r\n  return cachedFuseIndex;\r\n}\r\n\r\n// Export for manual cache invalidation (e.g., after adding/deleting products)\r\nexport function invalidateFuseCache() {\r\n  cachedFuseIndex = null;\r\n  cachedProductsHash = '';\r\n  cachedProductsLength = 0;\r\n}\r\n\r\nfunction applyFilters(products: Product[], params: ProductQueryParams): PipelineResult {\r\n  const { search, statusFilter, typeFilter, categoryFilter, comboFilter, stockLevelFilter, pkgxFilter, dateRange, sorting } = params;\r\n\r\n  let dataset = products.filter((product) => !product.isDeleted);\r\n\r\n  if (statusFilter !== 'all') {\r\n    dataset = dataset.filter((product) => product.status === statusFilter);\r\n  }\r\n\r\n  if (typeFilter !== 'all') {\r\n    dataset = dataset.filter((product) => product.type === typeFilter);\r\n  }\r\n\r\n  if (categoryFilter !== 'all') {\r\n    dataset = dataset.filter((product) => product.categorySystemId === categoryFilter);\r\n  }\r\n\r\n  // Combo filter\r\n  if (comboFilter === 'combo') {\r\n    dataset = dataset.filter((product) => product.type === 'combo');\r\n  } else if (comboFilter === 'non-combo') {\r\n    dataset = dataset.filter((product) => product.type !== 'combo');\r\n  }\r\n\r\n  // Stock level filter\r\n  if (stockLevelFilter !== 'all') {\r\n    dataset = dataset.filter((product) => {\r\n      // Calculate total inventory across all branches\r\n      const totalInventory = Object.values(product.inventoryByBranch || {}).reduce((sum, qty) => sum + qty, 0);\r\n      \r\n      switch (stockLevelFilter) {\r\n        case 'out-of-stock':\r\n          return totalInventory <= 0;\r\n        case 'low-stock':\r\n          // Low stock: above 0 but at or below reorder level\r\n          return totalInventory > 0 && product.reorderLevel !== undefined && totalInventory <= product.reorderLevel;\r\n        case 'below-safety':\r\n          // Below safety stock\r\n          return product.safetyStock !== undefined && totalInventory < product.safetyStock;\r\n        case 'high-stock':\r\n          // High stock: above max stock level\r\n          return product.maxStock !== undefined && totalInventory > product.maxStock;\r\n        default:\r\n          return true;\r\n      }\r\n    });\r\n  }\r\n\r\n  // PKGX link filter\r\n  if (pkgxFilter === 'linked') {\r\n    dataset = dataset.filter((product) => !!product.pkgxId);\r\n  } else if (pkgxFilter === 'not-linked') {\r\n    dataset = dataset.filter((product) => !product.pkgxId);\r\n  }\r\n\r\n  if (dateRange && (dateRange[0] || dateRange[1])) {\r\n    dataset = dataset.filter((product) => {\r\n      if (!product.createdAt) return false;\r\n      const createdDate = new Date(product.createdAt);\r\n      const fromDate = dateRange[0] ? new Date(dateRange[0]) : null;\r\n      const toDate = dateRange[1] ? new Date(dateRange[1]) : null;\r\n      if (fromDate && isDateBefore(createdDate, fromDate)) return false;\r\n      if (toDate && isDateAfter(createdDate, toDate)) return false;\r\n      return true;\r\n    });\r\n  }\r\n\r\n  if (search.trim()) {\r\n    // Use cached Fuse index for better performance\r\n    const fuse = getFuseIndex(dataset);\r\n    dataset = fuse.search(search.trim()).map((result) => result.item);\r\n  }\r\n\r\n  const sorted = [...dataset].sort((a, b) => {\r\n    const valueA = getSortValue(a, sorting.id);\r\n    const valueB = getSortValue(b, sorting.id);\r\n    if (valueA < valueB) return sorting.desc ? 1 : -1;\r\n    if (valueA > valueB) return sorting.desc ? -1 : 1;\r\n    return 0;\r\n  });\r\n\r\n  return { filtered: sorted };\r\n}\r\n\r\nfunction getSortValue(product: Product, sorter: ProductSortKey): string | number {\r\n  switch (sorter) {\r\n    case 'createdAt':\r\n      return product.createdAt ? new Date(product.createdAt).getTime() : 0;\r\n    case 'status':\r\n      return product.status ?? '';\r\n    case 'type':\r\n      return product.type ?? '';\r\n    case 'id':\r\n      return product.id ?? '';\r\n    case 'name':\r\n    default:\r\n      return product.name ?? '';\r\n  }\r\n}\r\n\r\nexport async function fetchProductsPage(params: ProductQueryParams): Promise<ProductQueryResult> {\r\n  const { data } = useProductStore.getState();\r\n  const { filtered } = applyFilters(data, params);\r\n\r\n  const { pageIndex, pageSize } = params.pagination;\r\n  const start = pageIndex * pageSize;\r\n  const end = start + pageSize;\r\n  const pagedItems = filtered.slice(start, end);\r\n\r\n  // Small delay to simulate async behavior and prevent UI blocking\r\n  await new Promise((resolve) => setTimeout(resolve, 10));\r\n\r\n  return {\r\n    items: pagedItems,\r\n    total: filtered.length,\r\n    pageCount: Math.max(1, Math.ceil(filtered.length / pageSize)),\r\n    pageIndex,\r\n  };\r\n}\r\n\r\n/**\r\n * Synchronous version for React Query initialData\r\n * Returns data immediately from store without any delay\r\n */\r\nexport function getInitialProductsPage(params: ProductQueryParams): ProductQueryResult {\r\n  const { data } = useProductStore.getState();\r\n  const { filtered } = applyFilters(data, params);\r\n\r\n  const { pageIndex, pageSize } = params.pagination;\r\n  const start = pageIndex * pageSize;\r\n  const end = start + pageSize;\r\n  const pagedItems = filtered.slice(start, end);\r\n\r\n  return {\r\n    items: pagedItems,\r\n    total: filtered.length,\r\n    pageCount: Math.max(1, Math.ceil(filtered.length / pageSize)),\r\n    pageIndex,\r\n  };\r\n}\r\n\r\nexport function getFilteredProductsSnapshot(params: ProductQueryParams): Product[] {\r\n  const { data } = useProductStore.getState();\r\n  const { filtered } = applyFilters(data, params);\r\n  return filtered;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5136, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/hooks/use-products-query.ts"],"sourcesContent":["import { useQuery, keepPreviousData, type UseQueryResult } from '@tanstack/react-query';\r\nimport { fetchProductsPage, getInitialProductsPage, type ProductQueryParams, type ProductQueryResult } from '../product-service';\r\n\r\nexport function useProductsQuery(params: ProductQueryParams): UseQueryResult<ProductQueryResult, Error> {\r\n  return useQuery<ProductQueryResult, Error>({\r\n    queryKey: ['products', params],\r\n    queryFn: () => fetchProductsPage(params),\r\n    staleTime: 30_000,\r\n    placeholderData: keepPreviousData, // Keep previous data while fetching new data (no skeleton)\r\n    initialData: () => getInitialProductsPage(params), // Sync data from store on first render (no loading)\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;;AAEO,SAAS,iBAAiB,MAA0B;;IACzD,OAAO,IAAA,0LAAQ,EAA4B;QACzC,UAAU;YAAC;YAAY;SAAO;QAC9B,OAAO;yCAAE,IAAM,IAAA,kKAAiB,EAAC;;QACjC,WAAW;QACX,iBAAiB,8LAAgB;QACjC,WAAW;yCAAE,IAAM,IAAA,uKAAsB,EAAC;;IAC5C;AACF;GARgB;;QACP,0LAAQ"}},
    {"offset": {"line": 5175, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport * as React from \"react\"\r\nimport { useRouter } from 'next/navigation';\r\nimport { useColumnVisibility } from '@/hooks/use-column-visibility';\r\nimport { useQueryClient } from '@tanstack/react-query';\r\nimport { useAllProducts } from \"./hooks/use-all-products\"\r\nimport { useProductMutations } from \"./hooks/use-products\"\r\nimport { useAllProductCategories } from \"../settings/inventory/hooks/use-all-inventory-settings\"\r\nimport { useAllBranches } from \"../settings/branches/hooks/use-all-branches\"\r\nimport { useAllBrands } from \"../settings/inventory/hooks/use-all-inventory-settings\"\r\nimport { useAllPricingPolicies } from \"../settings/pricing/hooks/use-all-pricing-policies\"\r\nimport { usePkgxSettingsStore } from \"../settings/pkgx/store\"\r\nimport { usePkgxBulkSync } from \"../settings/pkgx/hooks/use-pkgx-bulk-sync\"\r\nimport { PkgxBulkSyncConfirmDialog } from \"../settings/pkgx/components/pkgx-bulk-sync-confirm-dialog\"\r\nimport { createProduct, updateProduct } from \"../../lib/pkgx/api-service\"\r\nimport type { PkgxProductPayload } from \"../settings/pkgx/types\"\r\nimport { usePkgxSync } from \"./hooks/use-pkgx-sync\"\r\nimport { useAuth } from \"../../contexts/auth-context\"\r\nimport { asSystemId, asBusinessId } from '../../lib/id-types';\r\nimport { getColumns } from \"./columns\"\r\nimport { usePrint } from '@/lib/use-print';\r\nimport { \r\n  convertProductForLabel,\r\n  convertProductsForLabels,\r\n  mapProductToLabelPrintData,\r\n  createStoreSettings,\r\n} from '@/lib/print/product-print-helper';\r\nimport { useStoreInfoStore } from '../settings/store-info/store-info-store';\r\nimport { ResponsiveDataTable } from \"../../components/data-table/responsive-data-table\"\r\nimport { GenericImportDialogV2 } from \"../../components/shared/generic-import-dialog-v2\";\r\nimport { GenericExportDialogV2 } from \"../../components/shared/generic-export-dialog-v2\";\r\nimport { productImportExportConfig } from \"../../lib/import-export/configs/product.config\";\r\nimport { DataTableDateFilter } from \"../../components/data-table/data-table-date-filter\";\r\nimport { PageFilters } from \"../../components/layout/page-filters\";\r\nimport { PageToolbar } from \"../../components/layout/page-toolbar\";\r\nimport { transformImportedRows, normalizeFieldKey, type BranchInventoryIdentifier } from \"./product-importer\";\r\nimport { \r\n  Card, \r\n  CardContent, \r\n} from \"../../components/ui/card\"\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from \"../../components/ui/alert-dialog\"\r\nimport type { Product } from \"./types\"\r\nimport { Button } from \"../../components/ui/button\"\r\nimport { PlusCircle } from \"lucide-react\"\r\nimport { PkgxLinkDialog } from \"./components/pkgx-link-dialog\"\r\nimport { useProductsQuery } from \"./hooks/use-products-query\";\r\nimport { DEFAULT_PRODUCT_SORT, getFilteredProductsSnapshot, type ProductQueryParams, type ProductQueryResult } from \"./product-service\";\r\nimport { useState } from \"react\";\r\nimport { usePageHeader } from \"../../contexts/page-header-context\";\r\nimport { DataTableColumnCustomizer } from \"../../components/data-table/data-table-column-toggle\";\r\nimport { Badge } from \"../../components/ui/badge\";\r\nimport { Avatar, AvatarFallback } from \"../../components/ui/avatar\";\r\nimport { useMediaQuery } from \"../../lib/use-media-query\";\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuTrigger,\r\n} from \"../../components/ui/dropdown-menu\";\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from \"../../components/ui/select\";\r\nimport { Sheet, SheetContent, SheetDescription, SheetHeader, SheetTitle } from \"../../components/ui/sheet\";\r\nimport { MoreVertical, Package, Settings2, SlidersHorizontal, Columns3, Layers, RefreshCw, FileText, DollarSign, PackageSearch, Search, Flag, Image, ExternalLink, Unlink, Printer, Trash2, Play, StopCircle, FileUp, Download } from \"lucide-react\";\r\nimport { toast } from \"sonner\";\r\nimport { formatDate, formatDateTime, formatDateTimeSeconds, formatDateCustom, getCurrentDate, isDateSame, isDateBetween, isDateAfter, isDateBefore, isValidDate } from '@/lib/date-utils';\r\n\r\n\r\nconst TABLE_STATE_STORAGE_KEY = 'products-table-state';\r\nconst MOBILE_ROW_HEIGHT = 190;\r\nconst MOBILE_LIST_HEIGHT = 520;\r\n\r\nconst defaultTableState: ProductQueryParams = {\r\n  search: '',\r\n  statusFilter: 'all',\r\n  typeFilter: 'all',\r\n  categoryFilter: 'all',\r\n  comboFilter: 'all',\r\n  stockLevelFilter: 'all',\r\n  pkgxFilter: 'all',\r\n  dateRange: undefined,\r\n  pagination: { pageIndex: 0, pageSize: 20 },\r\n  sorting: DEFAULT_PRODUCT_SORT,\r\n};\r\n\r\nfunction resolveStateAction<T>(current: T, action: React.SetStateAction<T>): T {\r\n  return typeof action === 'function' ? (action as (prev: T) => T)(current) : action;\r\n}\r\nexport function ProductsPage() {\r\n  const isMobile = useMediaQuery(\"(max-width: 768px)\");\r\n  const queryClient = useQueryClient();\r\n  const { data: productsRaw } = useAllProducts();\r\n  const { remove, update, create } = useProductMutations();\r\n  const { data: categories } = useAllProductCategories();\r\n  const { data: brands } = useAllBrands();\r\n  const activeCategories = React.useMemo(\r\n    () => categories.filter(category => !category.isDeleted && category.isActive !== false),\r\n    [categories]\r\n  );\r\n  const { data: branches } = useAllBranches();\r\n  const { employee: authEmployee } = useAuth();\r\n  const router = useRouter();\r\n  \r\n  // Helpers for finding category/brand by ID\r\n  const findCategoryById = React.useCallback((systemId: string | undefined) => {\r\n    if (!systemId) return undefined;\r\n    return categories.find(c => c.systemId === systemId);\r\n  }, [categories]);\r\n  \r\n  const findBrandById = React.useCallback((systemId: string | undefined) => {\r\n    if (!systemId) return undefined;\r\n    return brands.find(b => b.systemId === systemId);\r\n  }, [brands]);\r\n\r\n  const defaultBranchSystemId = React.useMemo(() => {\r\n    return branches.find(branch => branch.isDefault)?.systemId ?? branches[0]?.systemId ?? null;\r\n  }, [branches]);\r\n\r\n  const branchInventoryIdentifiers = React.useMemo<BranchInventoryIdentifier[]>(() => {\r\n    return branches.map(branch => ({\r\n      systemId: asSystemId(branch.systemId),\r\n      identifiers: new Set(\r\n        [branch.systemId, branch.id, branch.name]\r\n          .map(value => normalizeFieldKey(value))\r\n          .filter(Boolean),\r\n      ),\r\n    }));\r\n  }, [branches]);\r\n  \r\n  // ✅ Memoize products để tránh unstable reference\r\n  const products = React.useMemo(() => productsRaw, [productsRaw]);\r\n  \r\n  // ✅ Get deleted count - filter deleted products\r\n  const deletedCount = React.useMemo(() => {\r\n    return products.filter(p => p.isDeleted).length;\r\n  }, [products]);\r\n  \r\n  const [rowSelection, setRowSelection] = React.useState<Record<string, boolean>>({})\r\n  const [isAlertOpen, setIsAlertOpen] = React.useState(false)\r\n  const [idToDelete, setIdToDelete] = React.useState<string | null>(null)\r\n  const [isFilterSheetOpen, setFilterSheetOpen] = React.useState(false);\r\n  const [isActionsSheetOpen, setActionsSheetOpen] = React.useState(false);\r\n\r\n  // ✅ Memoize headerActions để tránh infinite loop\r\n  const headerActions = React.useMemo(() => {\r\n    const actions = [\r\n      <Button \r\n        key=\"trash\"\r\n        variant=\"outline\"\r\n        size=\"sm\"\r\n        className=\"h-9\"\r\n        onClick={() => router.push('/products/trash')}\r\n      >\r\n        <Package className=\"mr-2 h-4 w-4\" />\r\n        Thùng rác ({deletedCount})\r\n      </Button>\r\n    ];\r\n\r\n    // Chỉ hiện nút Tùy chọn bảng trên Mobile (vì Desktop đã có toolbar)\r\n    if (isMobile) {\r\n      actions.push(\r\n        <Button\r\n          key=\"import\"\r\n          variant=\"ghost\"\r\n          size=\"sm\"\r\n          className=\"h-9\"\r\n          onClick={() => setActionsSheetOpen(true)}\r\n        >\r\n          <Columns3 className=\"mr-2 h-4 w-4\" />\r\n          Tùy chọn bảng\r\n        </Button>\r\n      );\r\n    }\r\n\r\n    actions.push(\r\n      <DropdownMenu key=\"add-menu\">\r\n        <DropdownMenuTrigger asChild>\r\n          <Button size=\"sm\" className=\"h-9\">\r\n            <PlusCircle className=\"mr-2 h-4 w-4\" />\r\n            Thêm sản phẩm\r\n          </Button>\r\n        </DropdownMenuTrigger>\r\n        <DropdownMenuContent align=\"end\">\r\n          <DropdownMenuItem onClick={() => router.push('/products/new')}>\r\n            <Package className=\"mr-2 h-4 w-4\" />\r\n            Thêm sản phẩm đơn\r\n          </DropdownMenuItem>\r\n          <DropdownMenuItem onClick={() => router.push('/products/new?type=combo')}>\r\n            <Layers className=\"mr-2 h-4 w-4\" />\r\n            Thêm Combo\r\n          </DropdownMenuItem>\r\n        </DropdownMenuContent>\r\n      </DropdownMenu>\r\n    );\r\n\r\n    return actions;\r\n  }, [deletedCount, router, setActionsSheetOpen, isMobile]);\r\n  \r\n  usePageHeader({\r\n    title: 'Danh sách sản phẩm',\r\n    breadcrumb: [\r\n      { label: 'Trang chủ', href: '/', isCurrent: false },\r\n      { label: 'Sản phẩm', href: '/products', isCurrent: true },\r\n    ],\r\n    actions: headerActions,\r\n    showBackButton: false,\r\n  });\r\n  \r\n  // Table state\r\n  const [columnVisibility, setColumnVisibility] = useColumnVisibility('products', {});\r\n\r\n  const [columnOrder, setColumnOrder] = React.useState<string[]>([]);\r\n  const [pinnedColumns, setPinnedColumns] = React.useState<string[]>([]);\r\n  const [tableState, setTableState] = useState<ProductQueryParams>(defaultTableState);\r\n\r\n  const handleDelete = React.useCallback((systemId: string) => {\r\n    setIdToDelete(systemId)\r\n    setIsAlertOpen(true)\r\n  }, [])\r\n  \r\n  // ✅ Handle restore cho soft delete\r\n  const handleRestore = React.useCallback((systemId: string) => {\r\n    const product = products.find(p => p.systemId === systemId);\r\n    if (product) {\r\n      update.mutate(\r\n        { systemId: asSystemId(systemId), ...product, isDeleted: false },\r\n        { onSuccess: () => toast.success('Đã khôi phục sản phẩm') }\r\n      );\r\n    }\r\n  }, [products, update]);\r\n\r\n  // Print hook and store info for single product print action in row dropdown\r\n  const { print: printSingleLabel, printMultiple } = usePrint();\r\n  const storeInfo = useStoreInfoStore(state => state.info);\r\n  const { data: pricingPolicies } = useAllPricingPolicies();\r\n  const defaultSellingPolicy = React.useMemo(\r\n    () => pricingPolicies.find(p => p.type === 'Bán hàng' && p.isDefault),\r\n    [pricingPolicies]\r\n  );\r\n  const storeSettings = React.useMemo(() => createStoreSettings(storeInfo), [storeInfo]);\r\n\r\n  const handlePrintLabel = React.useCallback((product: Product) => {\r\n    const categoryName = product.categorySystemId\r\n      ? findCategoryById(product.categorySystemId)?.name || product.category\r\n      : product.category;\r\n    const brandName = product.brandSystemId\r\n      ? findBrandById(product.brandSystemId)?.name || ''\r\n      : '';\r\n    const defaultPrice = defaultSellingPolicy\r\n      ? product.prices?.[defaultSellingPolicy.systemId]\r\n      : undefined;\r\n    const printData = mapProductToLabelPrintData(product, storeSettings, {\r\n      category: categoryName,\r\n      brand: brandName,\r\n      price: defaultPrice ?? product.sellingPrice,\r\n    });\r\n    printSingleLabel('product-label', { data: printData });\r\n  }, [printSingleLabel, storeSettings, defaultSellingPolicy]);\r\n\r\n  // ===== PKGX Handlers =====\r\n  const { settings: pkgxSettings, addLog: addPkgxLog } = usePkgxSettingsStore();\r\n  \r\n  // Use PKGX sync hook for all sync handlers\r\n  const {\r\n    handlePkgxUpdatePrice,\r\n    handlePkgxSyncInventory,\r\n    handlePkgxUpdateSeo,\r\n    handlePkgxSyncDescription,\r\n    handlePkgxSyncFlags,\r\n    handlePkgxSyncBasicInfo,\r\n    handlePkgxSyncImages,\r\n    handlePkgxSyncAll,\r\n  } = usePkgxSync({ addPkgxLog });\r\n  \r\n  // Bulk sync hook for PKGX operations\r\n  const {\r\n    confirmAction: bulkConfirmAction,\r\n    progress: bulkProgress,\r\n    triggerBulkSync,\r\n    executeAction: executeBulkAction,\r\n    cancelConfirm: cancelBulkConfirm,\r\n  } = usePkgxBulkSync({ entityType: 'product', onLog: addPkgxLog });\r\n  \r\n  // Helper: Build PKGX product payload from HRM product (for Publish)\r\n  const buildPkgxPayload = React.useCallback((product: Product): PkgxProductPayload => {\r\n    // Find mapped category\r\n    const categoryMapping = pkgxSettings.categoryMappings.find(\r\n      m => m.hrmCategorySystemId === product.categorySystemId\r\n    );\r\n    \r\n    // Find mapped brand\r\n    const brand = findBrandById(product.brandSystemId);\r\n    const brandMapping = brand ? pkgxSettings.brandMappings.find(\r\n      m => m.hrmBrandSystemId === brand.systemId\r\n    ) : undefined;\r\n    \r\n    // Get price from mapping or default\r\n    const { priceMapping } = pkgxSettings;\r\n    \r\n    // Shop price (giá bán)\r\n    let shopPrice = product.costPrice || 0;\r\n    if (priceMapping.shopPrice && product.prices[priceMapping.shopPrice]) {\r\n      shopPrice = product.prices[priceMapping.shopPrice];\r\n    } else if (defaultSellingPolicy) {\r\n      shopPrice = product.prices[defaultSellingPolicy.systemId] || shopPrice;\r\n    }\r\n    \r\n    // Market price (giá thị trường)\r\n    let marketPrice = shopPrice * 1.2; // Default markup\r\n    if (priceMapping.marketPrice && product.prices[priceMapping.marketPrice]) {\r\n      marketPrice = product.prices[priceMapping.marketPrice];\r\n    }\r\n    \r\n    // Partner price (giá đối tác)\r\n    let partnerPrice: number | undefined;\r\n    if (priceMapping.partnerPrice && product.prices[priceMapping.partnerPrice]) {\r\n      partnerPrice = product.prices[priceMapping.partnerPrice];\r\n    }\r\n    \r\n    // ACE price (giá ACE)\r\n    let acePrice: number | undefined;\r\n    if (priceMapping.acePrice && product.prices[priceMapping.acePrice]) {\r\n      acePrice = product.prices[priceMapping.acePrice];\r\n    }\r\n    \r\n    // Deal price (giá khuyến mãi)\r\n    let dealPrice: number | undefined;\r\n    if (priceMapping.dealPrice && product.prices[priceMapping.dealPrice]) {\r\n      dealPrice = product.prices[priceMapping.dealPrice];\r\n    }\r\n    \r\n    // Calculate total inventory\r\n    const totalInventory = product.inventoryByBranch\r\n      ? Object.values(product.inventoryByBranch).reduce((sum, qty) => sum + (qty || 0), 0)\r\n      : 0;\r\n    \r\n    // Get PKGX-specific SEO data (ưu tiên seoPkgx, fallback về field gốc)\r\n    const pkgxSeo = product.seoPkgx;\r\n    \r\n    const payload: PkgxProductPayload = {\r\n      // Thông tin cơ bản (giống handlePkgxSyncBasicInfo)\r\n      goods_name: product.name,\r\n      goods_sn: product.id,\r\n      cat_id: categoryMapping?.pkgxCatId || 0,\r\n      brand_id: brandMapping?.pkgxBrandId || 0,\r\n      seller_note: product.sellerNote || '',\r\n      \r\n      // Giá\r\n      shop_price: shopPrice,\r\n      market_price: marketPrice,\r\n      goods_number: totalInventory,\r\n      \r\n      // Mô tả (giống handlePkgxSyncDescription)\r\n      goods_desc: pkgxSeo?.longDescription || product.description || '',\r\n      goods_brief: pkgxSeo?.shortDescription || product.shortDescription || '',\r\n      \r\n      // SEO (giống handlePkgxUpdateSeo)\r\n      keywords: pkgxSeo?.seoKeywords || product.tags?.join(', ') || product.name,\r\n      meta_title: pkgxSeo?.seoTitle || product.ktitle || product.name,\r\n      meta_desc: pkgxSeo?.metaDescription || product.seoDescription || '',\r\n      \r\n      // Hình ảnh\r\n      original_img: product.thumbnailImage || product.images?.[0] || '',\r\n      gallery_images: product.galleryImages || product.images || [],\r\n      \r\n      // Flags - mapping đúng theo HRM fields\r\n      // HRM isPublished (Đăng web) -> PKGX is_on_sale\r\n      // HRM isFeatured (Nổi bật) -> PKGX is_best, ishome\r\n      // HRM isBestSeller (Bán chạy) -> PKGX is_hot\r\n      // HRM isNewArrival (Mới về) -> PKGX is_new\r\n      best: product.isFeatured || false,\r\n      hot: product.isBestSeller || false,\r\n      new: product.isNewArrival || false,\r\n      ishome: product.isFeatured || false,\r\n      is_on_sale: product.isPublished ?? (product.status === 'active'),\r\n    };\r\n    \r\n    // Add optional prices if mapped\r\n    if (partnerPrice !== undefined) payload.partner_price = partnerPrice;\r\n    if (acePrice !== undefined) payload.ace_price = acePrice;\r\n    if (dealPrice !== undefined) payload.deal_price = dealPrice;\r\n    \r\n    return payload;\r\n  }, [pkgxSettings, defaultSellingPolicy]);\r\n\r\n  const handlePkgxPublish = React.useCallback(async (product: Product) => {\r\n    if (product.pkgxId) {\r\n      toast.warning('Sản phẩm đã được đăng lên PKGX');\r\n      return;\r\n    }\r\n    \r\n    if (!pkgxSettings.enabled) {\r\n      toast.error('Tích hợp PKGX chưa được bật. Vui lòng bật trong Cài đặt > Tích hợp PKGX');\r\n      return;\r\n    }\r\n    \r\n    toast.loading(`Đang đăng sản phẩm lên PKGX...`, { id: 'pkgx-publish' });\r\n    \r\n    try {\r\n      const payload = buildPkgxPayload(product);\r\n      const response = await createProduct(payload);\r\n      \r\n      if (response.success && response.data) {\r\n        const goodsId = response.data.goods_id;\r\n        \r\n        // Save pkgxId to product store - trigger re-render\r\n        update.mutate({ systemId: product.systemId, pkgxId: goodsId });\r\n        \r\n        // Update React Query cache trực tiếp (không cần refetch - realtime!)\r\n        // Tìm tất cả queries có prefix 'products' và update item trong cache\r\n        queryClient.setQueriesData<ProductQueryResult>(\r\n          { queryKey: ['products'] },\r\n          (oldData) => {\r\n            if (!oldData) return oldData;\r\n            return {\r\n              ...oldData,\r\n              items: oldData.items.map(item => \r\n                item.systemId === product.systemId \r\n                  ? { ...item, pkgxId: goodsId }\r\n                  : item\r\n              ),\r\n            };\r\n          }\r\n        );\r\n        \r\n        toast.success(`Đã đăng sản phẩm lên PKGX! ID: ${goodsId}`, { id: 'pkgx-publish' });\r\n        \r\n        // Add log\r\n        addPkgxLog({\r\n          action: 'create_product',\r\n          status: 'success',\r\n          message: `Đã đăng sản phẩm: ${product.name}`,\r\n          details: { productId: product.systemId, pkgxId: goodsId, productName: product.name },\r\n        });\r\n      } else {\r\n        throw new Error(response.error);\r\n      }\r\n    } catch (error) {\r\n      toast.error(`Lỗi đăng sản phẩm: ${error instanceof Error ? error.message : 'Unknown error'}`, { id: 'pkgx-publish' });\r\n      addPkgxLog({\r\n        action: 'create_product',\r\n        status: 'error',\r\n        message: `Lỗi đăng sản phẩm: ${product.name}`,\r\n        details: { productId: product.systemId, error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    }\r\n  }, [pkgxSettings, buildPkgxPayload, update, addPkgxLog, queryClient]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // PKGX Link Dialog State\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const [pkgxLinkDialogOpen, setPkgxLinkDialogOpen] = React.useState(false);\r\n  const [productToLink, setProductToLink] = React.useState<Product | null>(null);\r\n\r\n  const handlePkgxLink = React.useCallback((product: Product) => {\r\n    setProductToLink(product);\r\n    setPkgxLinkDialogOpen(true);\r\n  }, []);\r\n\r\n  const handlePkgxLinkSuccess = React.useCallback((pkgxId: number) => {\r\n    // Update React Query cache trực tiếp (realtime)\r\n    if (productToLink) {\r\n      queryClient.setQueriesData<ProductQueryResult>(\r\n        { queryKey: ['products'] },\r\n        (oldData) => {\r\n          if (!oldData) return oldData;\r\n          return {\r\n            ...oldData,\r\n            items: oldData.items.map(item => \r\n              item.systemId === productToLink.systemId \r\n                ? { ...item, pkgxId }\r\n                : item\r\n            ),\r\n          };\r\n        }\r\n      );\r\n    }\r\n  }, [productToLink, queryClient]);\r\n\r\n  // Handler hủy liên kết PKGX\r\n  const handlePkgxUnlink = React.useCallback((product: Product) => {\r\n    // Update store - xóa pkgxId\r\n    update.mutate({ systemId: product.systemId, pkgxId: undefined });\r\n    \r\n    // Update React Query cache trực tiếp (realtime)\r\n    queryClient.setQueriesData<ProductQueryResult>(\r\n      { queryKey: ['products'] },\r\n      (oldData) => {\r\n        if (!oldData) return oldData;\r\n        return {\r\n          ...oldData,\r\n          items: oldData.items.map(item => \r\n            item.systemId === product.systemId \r\n              ? { ...item, pkgxId: undefined }\r\n              : item\r\n          ),\r\n        };\r\n      }\r\n    );\r\n    \r\n    toast.success(`Đã hủy liên kết PKGX cho sản phẩm: ${product.name}`);\r\n  }, [update, queryClient]);\r\n\r\n  // Handler thay đổi trạng thái sản phẩm (Switch)\r\n  const handleStatusChange = React.useCallback((product: Product, newStatus: 'active' | 'inactive') => {\r\n    update.mutate({ systemId: asSystemId(product.systemId), status: newStatus });\r\n    \r\n    // Update React Query cache\r\n    queryClient.setQueriesData<ProductQueryResult>(\r\n      { queryKey: ['products'] },\r\n      (oldData) => {\r\n        if (!oldData) return oldData;\r\n        return {\r\n          ...oldData,\r\n          items: oldData.items.map(item => \r\n            item.systemId === product.systemId \r\n              ? { ...item, status: newStatus }\r\n              : item\r\n          ),\r\n        };\r\n      }\r\n    );\r\n    \r\n    toast.success(`${product.name}: ${newStatus === 'active' ? 'Đang bán' : 'Ngừng bán'}`);\r\n  }, [update, queryClient]);\r\n\r\n  // Handler thay đổi tồn kho (Inline edit)\r\n  const handleInventoryChange = React.useCallback((product: Product, newQuantity: number) => {\r\n    // Lấy branch mặc định (branch đầu tiên có trong inventoryByBranch)\r\n    const branches = Object.keys(product.inventoryByBranch);\r\n    if (branches.length === 0) {\r\n      toast.error('Không tìm thấy chi nhánh để cập nhật tồn kho');\r\n      return;\r\n    }\r\n    \r\n    const defaultBranch = branches[0];\r\n    const newInventory = { ...product.inventoryByBranch, [defaultBranch]: newQuantity };\r\n    \r\n    update.mutate({ systemId: asSystemId(product.systemId), inventoryByBranch: newInventory });\r\n    \r\n    // Update React Query cache\r\n    queryClient.setQueriesData<ProductQueryResult>(\r\n      { queryKey: ['products'] },\r\n      (oldData) => {\r\n        if (!oldData) return oldData;\r\n        return {\r\n          ...oldData,\r\n          items: oldData.items.map(item => \r\n            item.systemId === product.systemId \r\n              ? { ...item, inventoryByBranch: newInventory }\r\n              : item\r\n          ),\r\n        };\r\n      }\r\n    );\r\n    \r\n    toast.success(`Đã cập nhật tồn kho ${product.name}: ${newQuantity}`);\r\n  }, [update, queryClient]);\r\n\r\n  // Handler cập nhật trường bất kỳ (Inline edit cho text/number/boolean fields)\r\n  const handleFieldUpdate = React.useCallback((product: Product, field: string, value: string | number | boolean) => {\r\n    // Xử lý nested field như prices.systemId\r\n    let updateData: Partial<Product>;\r\n    \r\n    if (field.startsWith('prices.')) {\r\n      const policySystemId = field.replace('prices.', '');\r\n      updateData = { prices: { ...product.prices, [policySystemId]: value as number } };\r\n    } else {\r\n      updateData = { [field]: value } as Partial<Product>;\r\n    }\r\n    \r\n    update.mutate({ systemId: asSystemId(product.systemId), ...updateData });\r\n    \r\n    // Update React Query cache\r\n    queryClient.setQueriesData<ProductQueryResult>(\r\n      { queryKey: ['products'] },\r\n      (oldData) => {\r\n        if (!oldData) return oldData;\r\n        return {\r\n          ...oldData,\r\n          items: oldData.items.map(item => \r\n            item.systemId === product.systemId \r\n              ? { ...item, ...updateData }\r\n              : item\r\n          ),\r\n        };\r\n      }\r\n    );\r\n    \r\n    // Show success toast\r\n    const fieldLabels: Record<string, string> = {\r\n      pkgxId: 'ID PKGX',\r\n      trendtechId: 'ID Trendtech',\r\n      reorderLevel: 'Mức đặt hàng lại',\r\n      safetyStock: 'Tồn kho an toàn',\r\n      maxStock: 'Mức tồn tối đa',\r\n      sellerNote: 'Ghi chú',\r\n      isPublished: 'Đăng web',\r\n      isFeatured: 'Nổi bật',\r\n      isNewArrival: 'Mới về',\r\n      isBestSeller: 'Bán chạy',\r\n      isOnSale: 'Đang giảm giá',\r\n      isStockTracked: 'Theo dõi kho',\r\n      costPrice: 'Giá vốn',\r\n      sortOrder: 'Thứ tự',\r\n    };\r\n    \r\n    const label = field.startsWith('prices.') ? 'Giá' : (fieldLabels[field] || field);\r\n    const displayValue = typeof value === 'boolean' \r\n      ? (value ? 'Bật' : 'Tắt') \r\n      : (typeof value === 'string' && value.includes('T') ? formatDate(new Date(value)) : value);\r\n    toast.success(`Đã cập nhật ${label}: ${displayValue}`);\r\n  }, [update, queryClient]);\r\n\r\n  const columns = React.useMemo(\r\n    () => getColumns(\r\n      handleDelete, \r\n      handleRestore, \r\n      router, \r\n      handlePrintLabel,\r\n      handlePkgxPublish,\r\n      handlePkgxLink,\r\n      handlePkgxUnlink,\r\n      handlePkgxSyncImages,\r\n      handleStatusChange,\r\n      handleInventoryChange,\r\n      handleFieldUpdate\r\n    ),\r\n    [handleDelete, handleRestore, router, handlePrintLabel, handlePkgxPublish, handlePkgxLink, handlePkgxUnlink, handlePkgxSyncImages, handleStatusChange, handleInventoryChange, handleFieldUpdate]\r\n  );\r\n  \r\n  // ✅ Run once on mount only\r\n  React.useEffect(() => {\r\n    // Show ALL columns by default for testing\r\n    const initialVisibility: Record<string, boolean> = {};\r\n    columns.forEach(c => {\r\n      initialVisibility[c.id!] = true; // Show all columns\r\n    });\r\n    setColumnVisibility(initialVisibility);\r\n    setColumnOrder(columns.map(c => c.id).filter(Boolean) as string[]);\r\n  }, []);\r\n\r\n  const updateTableState = React.useCallback(\r\n    (updater: (prev: ProductQueryParams) => ProductQueryParams) => {\r\n      setTableState((prev) => updater(prev));\r\n    },\r\n    [setTableState]\r\n  );\r\n\r\n  const handleSearchChange = React.useCallback(\r\n    (value: string) => {\r\n      updateTableState((prev) => ({\r\n        ...prev,\r\n        search: value,\r\n        pagination: { ...prev.pagination, pageIndex: 0 },\r\n      }));\r\n    },\r\n    [updateTableState]\r\n  );\r\n\r\n  const handleStatusFilterChange = React.useCallback(\r\n    (value: string) => {\r\n      updateTableState((prev) => ({\r\n        ...prev,\r\n        statusFilter: value as ProductQueryParams['statusFilter'],\r\n        pagination: { ...prev.pagination, pageIndex: 0 },\r\n      }));\r\n    },\r\n    [updateTableState]\r\n  );\r\n\r\n  const handleTypeFilterChange = React.useCallback(\r\n    (value: string) => {\r\n      updateTableState((prev) => ({\r\n        ...prev,\r\n        typeFilter: value as ProductQueryParams['typeFilter'],\r\n        pagination: { ...prev.pagination, pageIndex: 0 },\r\n      }));\r\n    },\r\n    [updateTableState]\r\n  );\r\n\r\n  const handleCategoryFilterChange = React.useCallback(\r\n    (value: string) => {\r\n      updateTableState((prev) => ({\r\n        ...prev,\r\n        categoryFilter: value,\r\n        pagination: { ...prev.pagination, pageIndex: 0 },\r\n      }));\r\n    },\r\n    [updateTableState]\r\n  );\r\n\r\n  const handleComboFilterChange = React.useCallback(\r\n    (value: string) => {\r\n      updateTableState((prev) => ({\r\n        ...prev,\r\n        comboFilter: value as ProductQueryParams['comboFilter'],\r\n        pagination: { ...prev.pagination, pageIndex: 0 },\r\n      }));\r\n    },\r\n    [updateTableState]\r\n  );\r\n\r\n  const handleStockLevelFilterChange = React.useCallback(\r\n    (value: string) => {\r\n      updateTableState((prev) => ({\r\n        ...prev,\r\n        stockLevelFilter: value as ProductQueryParams['stockLevelFilter'],\r\n        pagination: { ...prev.pagination, pageIndex: 0 },\r\n      }));\r\n    },\r\n    [updateTableState]\r\n  );\r\n\r\n  const handlePkgxFilterChange = React.useCallback(\r\n    (value: string) => {\r\n      updateTableState((prev) => ({\r\n        ...prev,\r\n        pkgxFilter: value as ProductQueryParams['pkgxFilter'],\r\n        pagination: { ...prev.pagination, pageIndex: 0 },\r\n      }));\r\n    },\r\n    [updateTableState]\r\n  );\r\n\r\n  const handleDateRangeChange = React.useCallback(\r\n    (value: [string | undefined, string | undefined] | undefined) => {\r\n      updateTableState((prev) => ({\r\n        ...prev,\r\n        dateRange: value,\r\n        pagination: { ...prev.pagination, pageIndex: 0 },\r\n      }));\r\n    },\r\n    [updateTableState]\r\n  );\r\n\r\n  const handlePaginationChange = React.useCallback(\r\n    (action: React.SetStateAction<{ pageIndex: number; pageSize: number }>) => {\r\n      updateTableState((prev) => ({\r\n        ...prev,\r\n        pagination: resolveStateAction(prev.pagination, action),\r\n      }));\r\n    },\r\n    [updateTableState]\r\n  );\r\n\r\n  const handleSortingChange = React.useCallback(\r\n    (action: React.SetStateAction<{ id: string; desc: boolean }>) => {\r\n      updateTableState((prev) => {\r\n        const nextSortingSource = resolveStateAction(prev.sorting, action);\r\n        return {\r\n          ...prev,\r\n          sorting: {\r\n            id: (nextSortingSource.id as ProductQueryParams['sorting']['id']) ?? prev.sorting.id,\r\n            desc: nextSortingSource.desc,\r\n          },\r\n        };\r\n      });\r\n    },\r\n    [updateTableState]\r\n  );\r\n\r\n  const queryParams = tableState;\r\n  const { data: queryResult, isLoading: queryLoading, isFetching } = useProductsQuery(queryParams);\r\n  const pageData = queryResult?.items ?? [];\r\n  const totalRows = queryResult?.total ?? 0;\r\n  const pageCount = queryResult?.pageCount ?? 1;\r\n  const isTableLoading = queryLoading || isFetching;\r\n\r\n  const filteredSnapshot = React.useMemo(() => getFilteredProductsSnapshot(queryParams), [products, queryParams]);\r\n\r\n  const selectedProducts = React.useMemo(\r\n    () => products.filter((product) => rowSelection[product.systemId]),\r\n    [products, rowSelection]\r\n  );\r\n\r\n  // Import/Export dialog states\r\n  const [isImportOpen, setIsImportOpen] = React.useState(false);\r\n  const [isExportOpen, setIsExportOpen] = React.useState(false);\r\n\r\n  const confirmDelete = () => {\r\n    if (idToDelete) {\r\n      remove.mutate(asSystemId(idToDelete), {\r\n        onSuccess: () => toast.success('Đã chuyển sản phẩm vào thùng rác')\r\n      });\r\n    }\r\n    setIsAlertOpen(false)\r\n    setIdToDelete(null)\r\n  }\r\n  \r\n  const allSelectedRows = selectedProducts;\r\n\r\n  // Import handler - tích hợp với product importer logic\r\n  const handleImport = React.useCallback(async (data: Partial<Product>[], mode: 'insert-only' | 'update-only' | 'upsert', branchId?: string) => {\r\n    const currentEmployeeSystemId = authEmployee?.systemId ?? asSystemId('SYSTEM');\r\n    \r\n    const results = {\r\n      success: 0,\r\n      failed: 0,\r\n      inserted: 0,\r\n      updated: 0,\r\n      skipped: 0,\r\n      errors: [] as Array<{ row: number; message: string }>,\r\n    };\r\n    \r\n    try {\r\n      for (let i = 0; i < data.length; i++) {\r\n        const item = data[i];\r\n        try {\r\n          // Check if product exists (by id or barcode)\r\n          // NOTE: Product uses 'id' (BusinessId) not 'code'\r\n          const existingProduct = products.find(p => \r\n            (item.id && p.id === item.id) || \r\n            (item.barcode && p.barcode === item.barcode)\r\n          );\r\n          \r\n          if (existingProduct) {\r\n            // Product exists\r\n            if (mode === 'insert-only') {\r\n              // Skip in insert-only mode\r\n              results.skipped++;\r\n              continue;\r\n            }\r\n            \r\n            // Update existing product\r\n            const updatedFields: Partial<Product> = {\r\n              ...item,\r\n              updatedAt: new Date().toISOString(),\r\n              updatedBy: currentEmployeeSystemId,\r\n            };\r\n            // Remove fields that shouldn't be overwritten\r\n            delete (updatedFields as any).systemId;\r\n            delete (updatedFields as any).createdAt;\r\n            delete (updatedFields as any).createdBy;\r\n            \r\n            update.mutate({ systemId: existingProduct.systemId, ...updatedFields });\r\n            results.updated++;\r\n            results.success++;\r\n          } else {\r\n            // Product does not exist\r\n            if (mode === 'update-only') {\r\n              // Skip in update-only mode\r\n              results.skipped++;\r\n              continue;\r\n            }\r\n            \r\n            // Insert new product\r\n            const newProduct = {\r\n              name: item.name,\r\n              sellingPrice: item.sellingPrice ?? 0,\r\n              costPrice: item.costPrice,\r\n              sku: item.sku,\r\n              barcode: item.barcode,\r\n              categoryId: item.categorySystemId as string | undefined,\r\n              brandId: item.brandSystemId as string | undefined,\r\n              description: item.description,\r\n              images: item.images,\r\n              inventoryByBranch: item.inventoryByBranch || {},\r\n              committedByBranch: item.committedByBranch || {},\r\n              inTransitByBranch: item.inTransitByBranch || {},\r\n              prices: item.prices || {},\r\n              status: item.status || 'active',\r\n            };\r\n            \r\n            create.mutate(newProduct);\r\n            results.inserted++;\r\n            results.success++;\r\n          }\r\n        } catch (rowError) {\r\n          results.failed++;\r\n          results.errors.push({\r\n            row: i + 2, // Excel row (1-indexed + header)\r\n            message: rowError instanceof Error ? rowError.message : 'Lỗi không xác định',\r\n          });\r\n        }\r\n      }\r\n      \r\n      // Invalidate query cache để refresh danh sách sản phẩm\r\n      if (results.success > 0) {\r\n        queryClient.invalidateQueries({ queryKey: ['products'] });\r\n      }\r\n      \r\n      return results;\r\n    } catch (error) {\r\n      console.error('[Products Importer] Lỗi nhập sản phẩm', error);\r\n      throw error;\r\n    }\r\n  }, [products, create, update, authEmployee?.systemId, queryClient]);\r\n\r\n  const toolbarLeftActions = (\r\n    <>\r\n      <Button variant=\"outline\" size=\"sm\" onClick={() => setIsImportOpen(true)}>\r\n        <FileUp className=\"mr-2 h-4 w-4\" />\r\n        Nhập file\r\n      </Button>\r\n      <Button variant=\"outline\" size=\"sm\" onClick={() => setIsExportOpen(true)}>\r\n        <Download className=\"mr-2 h-4 w-4\" />\r\n        Xuất Excel\r\n      </Button>\r\n    </>\r\n  );\r\n\r\n  const toolbarRightActions = (\r\n    <DataTableColumnCustomizer\r\n      columns={columns}\r\n      columnVisibility={columnVisibility}\r\n      setColumnVisibility={setColumnVisibility}\r\n      columnOrder={columnOrder}\r\n      setColumnOrder={setColumnOrder}\r\n      pinnedColumns={pinnedColumns}\r\n      setPinnedColumns={setPinnedColumns}\r\n    />\r\n  );\r\n\r\n  const handleRowClick = (row: Product) => {\r\n    router.push(`/products/${row.systemId}`);\r\n  };\r\n\r\n  // Get unique categories for filter - từ settings\r\n  const categoryOptions = React.useMemo(() => {\r\n    return activeCategories\r\n      .map(c => ({\r\n        label: c.path || c.name,\r\n        value: c.systemId\r\n      }))\r\n      .sort((a, b) => a.label.localeCompare(b.label));\r\n  }, [activeCategories]);\r\n\r\n  // Calculate stock level counts\r\n  const stockLevelCounts = React.useMemo(() => {\r\n    const activeProducts = products.filter(p => !p.isDeleted);\r\n    \r\n    const counts = {\r\n      outOfStock: 0,\r\n      lowStock: 0,\r\n      belowSafety: 0,\r\n      highStock: 0,\r\n    };\r\n\r\n    activeProducts.forEach(product => {\r\n      const totalInventory = Object.values(product.inventoryByBranch || {}).reduce((sum, qty) => sum + qty, 0);\r\n      \r\n      if (totalInventory <= 0) {\r\n        counts.outOfStock++;\r\n      }\r\n      if (totalInventory > 0 && product.reorderLevel !== undefined && totalInventory <= product.reorderLevel) {\r\n        counts.lowStock++;\r\n      }\r\n      if (product.safetyStock !== undefined && totalInventory < product.safetyStock) {\r\n        counts.belowSafety++;\r\n      }\r\n      if (product.maxStock !== undefined && totalInventory > product.maxStock) {\r\n        counts.highStock++;\r\n      }\r\n    });\r\n\r\n    return counts;\r\n  }, [products]);\r\n\r\n  const renderFilterControls = () => (\r\n    <>\r\n      <DataTableDateFilter\r\n        value={tableState.dateRange}\r\n        onChange={handleDateRangeChange}\r\n        title=\"Ngày tạo\"\r\n      />\r\n\r\n      <Select value={tableState.statusFilter} onValueChange={handleStatusFilterChange}>\r\n        <SelectTrigger className=\"w-full sm:w-[180px] h-9\">\r\n          <SelectValue placeholder=\"Tất cả trạng thái\" />\r\n        </SelectTrigger>\r\n        <SelectContent>\r\n          <SelectItem value=\"all\">Tất cả trạng thái</SelectItem>\r\n          <SelectItem value=\"active\">Hoạt động</SelectItem>\r\n          <SelectItem value=\"inactive\">Tạm ngừng</SelectItem>\r\n          <SelectItem value=\"discontinued\">Ngừng kinh doanh</SelectItem>\r\n        </SelectContent>\r\n      </Select>\r\n\r\n      <Select value={tableState.typeFilter} onValueChange={handleTypeFilterChange}>\r\n        <SelectTrigger className=\"w-full sm:w-[180px] h-9\">\r\n          <SelectValue placeholder=\"Loại sản phẩm\" />\r\n        </SelectTrigger>\r\n        <SelectContent>\r\n          <SelectItem value=\"all\">Tất cả loại</SelectItem>\r\n          <SelectItem value=\"physical\">Hàng hóa</SelectItem>\r\n          <SelectItem value=\"service\">Dịch vụ</SelectItem>\r\n          <SelectItem value=\"digital\">Sản phẩm số</SelectItem>\r\n        </SelectContent>\r\n      </Select>\r\n\r\n      <Select value={tableState.categoryFilter} onValueChange={handleCategoryFilterChange}>\r\n        <SelectTrigger className=\"w-full sm:w-[180px] h-9\">\r\n          <SelectValue placeholder=\"Danh mục\" />\r\n        </SelectTrigger>\r\n        <SelectContent>\r\n          <SelectItem value=\"all\">Tất cả danh mục</SelectItem>\r\n          {categoryOptions.map(cat => (\r\n            <SelectItem key={cat.value} value={cat.value}>{cat.label}</SelectItem>\r\n          ))}\r\n        </SelectContent>\r\n      </Select>\r\n\r\n      <Select value={tableState.comboFilter} onValueChange={handleComboFilterChange}>\r\n        <SelectTrigger className=\"w-full sm:w-[180px] h-9\">\r\n          <SelectValue placeholder=\"Sản phẩm combo\" />\r\n        </SelectTrigger>\r\n        <SelectContent>\r\n          <SelectItem value=\"all\">Tất cả sản phẩm</SelectItem>\r\n          <SelectItem value=\"combo\">Chỉ Combo</SelectItem>\r\n          <SelectItem value=\"non-combo\">Không phải Combo</SelectItem>\r\n        </SelectContent>\r\n      </Select>\r\n\r\n      <Select value={tableState.stockLevelFilter} onValueChange={handleStockLevelFilterChange}>\r\n        <SelectTrigger className=\"w-full sm:w-[180px] h-9\">\r\n          <SelectValue placeholder=\"Mức tồn kho\" />\r\n        </SelectTrigger>\r\n        <SelectContent>\r\n          <SelectItem value=\"all\">Tất cả mức tồn</SelectItem>\r\n          <SelectItem value=\"out-of-stock\">Hết hàng ({stockLevelCounts.outOfStock})</SelectItem>\r\n          <SelectItem value=\"low-stock\">Sắp hết ({stockLevelCounts.lowStock})</SelectItem>\r\n          <SelectItem value=\"below-safety\">Dưới an toàn ({stockLevelCounts.belowSafety})</SelectItem>\r\n          <SelectItem value=\"high-stock\">Tồn cao ({stockLevelCounts.highStock})</SelectItem>\r\n        </SelectContent>\r\n      </Select>\r\n\r\n      <Select value={tableState.pkgxFilter} onValueChange={handlePkgxFilterChange}>\r\n        <SelectTrigger className=\"w-full sm:w-[180px] h-9\">\r\n          <SelectValue placeholder=\"Trạng thái PKGX\" />\r\n        </SelectTrigger>\r\n        <SelectContent>\r\n          <SelectItem value=\"all\">Tất cả PKGX</SelectItem>\r\n          <SelectItem value=\"linked\">Đã liên kết PKGX</SelectItem>\r\n          <SelectItem value=\"not-linked\">Chưa liên kết PKGX</SelectItem>\r\n        </SelectContent>\r\n      </Select>\r\n    </>  \r\n  );\r\n\r\n  const handlePrintLabels = React.useCallback((products: Product[]) => {\r\n    if (products.length === 0) return;\r\n    const printOptionsList = products.map(product => {\r\n      const categoryName = product.categorySystemId\r\n        ? findCategoryById(product.categorySystemId)?.name || product.category\r\n        : product.category;\r\n      const brandName = product.brandSystemId\r\n        ? findBrandById(product.brandSystemId)?.name || ''\r\n        : '';\r\n      const defaultPrice = defaultSellingPolicy\r\n        ? product.prices?.[defaultSellingPolicy.systemId]\r\n        : undefined;\r\n      return {\r\n        data: mapProductToLabelPrintData(product, storeSettings, {\r\n          category: categoryName,\r\n          brand: brandName,\r\n          price: defaultPrice ?? product.sellingPrice,\r\n        }),\r\n      };\r\n    });\r\n    printMultiple('product-label', printOptionsList);\r\n  }, [printMultiple, storeSettings, defaultSellingPolicy]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════════════════\r\n  // PKGX Bulk Action Helper Functions\r\n  // ═══════════════════════════════════════════════════════════════════════════\r\n  \r\n  // Get total inventory across all branches\r\n  const getTotalInventory = (product: Product): number => {\r\n    if (!product.inventoryByBranch) return 0;\r\n    return Object.values(product.inventoryByBranch).reduce((sum, qty) => sum + (qty || 0), 0);\r\n  };\r\n\r\n  // Create price update payload for PKGX\r\n  const createPriceUpdatePayload = (product: Product): Partial<PkgxProductPayload> => {\r\n    const pkgxSettingsState = usePkgxSettingsStore.getState();\r\n    const { priceMapping } = pkgxSettingsState.settings;\r\n    \r\n    const payload: Partial<PkgxProductPayload> = {};\r\n    \r\n    // Shop price (giá bán)\r\n    if (priceMapping?.shopPrice && product.prices?.[priceMapping.shopPrice]) {\r\n      payload.shop_price = product.prices[priceMapping.shopPrice];\r\n    } else if (defaultSellingPolicy && product.prices?.[defaultSellingPolicy.systemId]) {\r\n      payload.shop_price = product.prices[defaultSellingPolicy.systemId];\r\n    } else if (product.costPrice) {\r\n      payload.shop_price = product.costPrice;\r\n    }\r\n    \r\n    // Market price (giá thị trường)\r\n    if (priceMapping?.marketPrice && product.prices?.[priceMapping.marketPrice]) {\r\n      payload.market_price = product.prices[priceMapping.marketPrice];\r\n    }\r\n    \r\n    // Partner price\r\n    if (priceMapping?.partnerPrice && product.prices?.[priceMapping.partnerPrice]) {\r\n      payload.partner_price = product.prices[priceMapping.partnerPrice];\r\n    }\r\n    \r\n    // Ace price\r\n    if (priceMapping?.acePrice && product.prices?.[priceMapping.acePrice]) {\r\n      payload.ace_price = product.prices[priceMapping.acePrice];\r\n    }\r\n    \r\n    // Deal price\r\n    if (priceMapping?.dealPrice && product.prices?.[priceMapping.dealPrice]) {\r\n      payload.deal_price = product.prices[priceMapping.dealPrice];\r\n    }\r\n    \r\n    return payload;\r\n  };\r\n\r\n  // Create SEO update payload for PKGX (đồng nhất với handlePkgxUpdateSeo)\r\n  const createSeoUpdatePayload = (product: Product): Partial<PkgxProductPayload> => {\r\n    const pkgxSeo = product.seoPkgx;\r\n    return {\r\n      keywords: pkgxSeo?.seoKeywords || product.tags?.join(', ') || product.name,\r\n      meta_title: pkgxSeo?.seoTitle || product.ktitle || product.name,\r\n      meta_desc: pkgxSeo?.metaDescription || product.seoDescription || '',\r\n      goods_brief: pkgxSeo?.shortDescription || product.shortDescription || '',\r\n    };\r\n  };\r\n\r\n  // Create flags update payload for PKGX\r\n  // Mapping: HRM isPublished->is_on_sale, isFeatured->best/ishome, isBestSeller->hot, isNewArrival->new\r\n  const createFlagsUpdatePayload = (product: Product): Partial<PkgxProductPayload> => {\r\n    return {\r\n      best: product.isFeatured || false,\r\n      hot: product.isBestSeller || false,\r\n      new: product.isNewArrival || false,\r\n      ishome: product.isFeatured || false,\r\n      is_on_sale: product.isPublished ?? (product.status === 'active'),\r\n    };\r\n  };\r\n\r\n  const bulkActions = [\r\n    {\r\n      label: \"In tem phụ sản phẩm\",\r\n      icon: Printer,\r\n      onSelect: (selectedRows: Product[]) => {\r\n        handlePrintLabels(selectedRows);\r\n        toast.success(`Đang in tem cho ${selectedRows.length} sản phẩm`);\r\n      }\r\n    },\r\n    {\r\n      label: \"Chuyển vào thùng rác\",\r\n      icon: Trash2,\r\n      onSelect: (selectedRows: Product[]) => {\r\n        const systemIds = selectedRows.map(p => p.systemId);\r\n        systemIds.forEach(id => remove.mutate(asSystemId(id)));\r\n        setRowSelection({});\r\n        toast.success(`Đã chuyển ${selectedRows.length} sản phẩm vào thùng rác`);\r\n      }\r\n    },\r\n    {\r\n      label: \"Đang hoạt động\",\r\n      icon: Play,\r\n      onSelect: (selectedRows: Product[]) => {\r\n        selectedRows.forEach(product => {\r\n          update.mutate({ systemId: asSystemId(product.systemId), ...product, status: 'active' });\r\n        });\r\n        setRowSelection({});\r\n        toast.success(`Đã cập nhật ${selectedRows.length} sản phẩm sang trạng thái \"Đang hoạt động\"`);\r\n      }\r\n    },\r\n    {\r\n      label: \"Ngừng kinh doanh\",\r\n      icon: StopCircle,\r\n      onSelect: (selectedRows: Product[]) => {\r\n        selectedRows.forEach(product => {\r\n          update.mutate({ systemId: asSystemId(product.systemId), ...product, status: 'discontinued' });\r\n        });\r\n        setRowSelection({});\r\n        toast.success(`Đã cập nhật ${selectedRows.length} sản phẩm sang trạng thái \"Ngừng kinh doanh\"`);\r\n      }\r\n    }\r\n  ];\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // PKGX Bulk Actions - Using shared usePkgxBulkSync hook\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const pkgxBulkActions = React.useMemo(() => [\r\n    {\r\n      label: \"Đồng bộ tất cả\",\r\n      icon: RefreshCw,\r\n      onSelect: (selectedRows: Product[]) => {\r\n        triggerBulkSync(selectedRows, 'sync_all');\r\n      }\r\n    },\r\n    {\r\n      label: \"Thông tin cơ bản\",\r\n      icon: FileText,\r\n      onSelect: (selectedRows: Product[]) => {\r\n        triggerBulkSync(selectedRows, 'sync_basic');\r\n      }\r\n    },\r\n    {\r\n      label: \"Giá\",\r\n      icon: DollarSign,\r\n      onSelect: (selectedRows: Product[]) => {\r\n        triggerBulkSync(selectedRows, 'sync_price');\r\n      }\r\n    },\r\n    {\r\n      label: \"Tồn kho\",\r\n      icon: PackageSearch,\r\n      onSelect: (selectedRows: Product[]) => {\r\n        triggerBulkSync(selectedRows, 'sync_inventory');\r\n      }\r\n    },\r\n    {\r\n      label: \"SEO\",\r\n      icon: Search,\r\n      onSelect: (selectedRows: Product[]) => {\r\n        triggerBulkSync(selectedRows, 'sync_seo');\r\n      }\r\n    },\r\n    {\r\n      label: \"Mô tả\",\r\n      icon: FileText,\r\n      onSelect: (selectedRows: Product[]) => {\r\n        triggerBulkSync(selectedRows, 'sync_description');\r\n      }\r\n    },\r\n    {\r\n      label: \"Flags\",\r\n      icon: Flag,\r\n      onSelect: (selectedRows: Product[]) => {\r\n        triggerBulkSync(selectedRows, 'sync_flags');\r\n      }\r\n    },\r\n    {\r\n      label: \"Hình ảnh\",\r\n      icon: Image,\r\n      onSelect: (selectedRows: Product[]) => {\r\n        triggerBulkSync(selectedRows, 'sync_images');\r\n      }\r\n    },\r\n    {\r\n      label: \"Xem trên PKGX\",\r\n      icon: ExternalLink,\r\n      onSelect: (selectedRows: Product[]) => {\r\n        const linkedProducts = selectedRows.filter(p => p.pkgxId);\r\n        if (linkedProducts.length === 0) {\r\n          toast.error('Không có sản phẩm nào đã liên kết PKGX');\r\n          return;\r\n        }\r\n        \r\n        if (linkedProducts.length === 1) {\r\n          window.open(`https://phukiengiaxuong.com.vn/admin/goods.php?act=edit_goods&goods_id=${linkedProducts[0].pkgxId}`, '_blank');\r\n        } else {\r\n          toast.info(`Đã chọn ${linkedProducts.length} sản phẩm. Vui lòng chọn 1 sản phẩm để xem.`);\r\n        }\r\n      }\r\n    },\r\n    {\r\n      label: \"Hủy liên kết\",\r\n      icon: Unlink,\r\n      variant: 'destructive' as const,\r\n      onSelect: async (selectedRows: Product[]) => {\r\n        const linkedProducts = selectedRows.filter(p => p.pkgxId);\r\n        if (linkedProducts.length === 0) {\r\n          toast.error('Không có sản phẩm nào đã liên kết PKGX');\r\n          return;\r\n        }\r\n        \r\n        if (!confirm(`Bạn có chắc muốn hủy liên kết ${linkedProducts.length} sản phẩm với PKGX?`)) {\r\n          return;\r\n        }\r\n        \r\n        let successCount = 0;\r\n        \r\n        for (const product of linkedProducts) {\r\n          try {\r\n            update.mutate({ systemId: asSystemId(product.systemId), pkgxId: undefined });\r\n            successCount++;\r\n          } catch {\r\n            // ignore\r\n          }\r\n        }\r\n        \r\n        setRowSelection({});\r\n        toast.success(`Đã hủy liên kết ${successCount} sản phẩm với PKGX`);\r\n      }\r\n    },\r\n  ], [triggerBulkSync, update, setRowSelection]);\r\n\r\n  const getStatusVariant = (status?: string) => {\r\n    if (!status) return 'secondary';\r\n    switch (status) {\r\n      case 'active': return 'default';\r\n      case 'inactive': return 'secondary';\r\n      case 'discontinued': return 'destructive';\r\n      default: return 'secondary';\r\n    }\r\n  };\r\n\r\n  const getStatusLabel = (status?: string) => {\r\n    if (!status) return 'Không xác định';\r\n    switch (status) {\r\n      case 'active': return 'Hoạt động';\r\n      case 'inactive': return 'Tạm ngừng';\r\n      case 'discontinued': return 'Ngừng kinh doanh';\r\n      default: return status;\r\n    }\r\n  };\r\n\r\n  const getTypeLabel = (type?: string) => {\r\n    if (!type) return '';\r\n    switch (type) {\r\n      case 'physical': return 'Hàng hóa';\r\n      case 'service': return 'Dịch vụ';\r\n      case 'digital': return 'Sản phẩm số';\r\n      default: return type;\r\n    }\r\n  };\r\n\r\n  const MobileProductCard = ({ product }: { product: Product }) => {\r\n    return (\r\n      <Card className=\"cursor-pointer hover:shadow-md transition-shadow\" onClick={() => handleRowClick(product)}>\r\n        <CardContent className=\"p-4\">\r\n          <div className=\"flex items-start gap-3\">\r\n            {/* Icon/Avatar */}\r\n            <Avatar className=\"h-12 w-12 flex-shrink-0\">\r\n              <AvatarFallback className=\"bg-primary/10 text-primary font-semibold\">\r\n                <Package className=\"h-6 w-6\" />\r\n              </AvatarFallback>\r\n            </Avatar>\r\n\r\n            {/* Info */}\r\n            <div className=\"flex-1 min-w-0\">\r\n              <div className=\"flex items-start justify-between mb-1\">\r\n                <div className=\"flex-1\">\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <h3 className=\"text-body-sm font-medium truncate\">{product.name}</h3>\r\n                    {product.pkgxId && (\r\n                      <Badge variant=\"outline\" className=\"text-body-xs border-blue-500 text-blue-600 flex-shrink-0\">\r\n                        PKGX\r\n                      </Badge>\r\n                    )}\r\n                  </div>\r\n                  <p className=\"text-body-xs text-muted-foreground\">{product.id}</p>\r\n                  {product.shortDescription && (\r\n                    <p className=\"text-body-xs text-muted-foreground mt-0.5 line-clamp-1\">\r\n                      {product.shortDescription}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n                <DropdownMenu>\r\n                  <DropdownMenuTrigger asChild>\r\n                    <Button\r\n                      variant=\"ghost\"\r\n                      size=\"sm\"\r\n                      className=\"h-9 w-9 p-0\"\r\n                      onClick={(e) => e.stopPropagation()}\r\n                    >\r\n                      <MoreVertical className=\"h-4 w-4\" />\r\n                    </Button>\r\n                  </DropdownMenuTrigger>\r\n                  <DropdownMenuContent align=\"end\">\r\n                    <DropdownMenuItem onClick={(e) => { e.stopPropagation(); router.push(`/products/${product.systemId}/edit`); }}>\r\n                      Chỉnh sửa\r\n                    </DropdownMenuItem>\r\n                    <DropdownMenuItem onClick={(e) => { e.stopPropagation(); handleDelete(product.systemId); }}>\r\n                      Chuyển vào thùng rác\r\n                    </DropdownMenuItem>\r\n                  </DropdownMenuContent>\r\n                </DropdownMenu>\r\n              </div>\r\n\r\n              {/* Details */}\r\n              <div className=\"space-y-1.5 mt-2\">\r\n                {product.categorySystemId && (\r\n                  <div className=\"flex items-center text-body-xs text-muted-foreground\">\r\n                    <Package className=\"h-3 w-3 mr-1.5\" />\r\n                    <span className=\"truncate\">\r\n                      {categories.find(c => c.systemId === product.categorySystemId)?.name || product.categorySystemId}\r\n                    </span>\r\n                  </div>\r\n                )}\r\n                {product.type && (\r\n                  <div className=\"flex items-center text-body-xs text-muted-foreground\">\r\n                    <span className=\"truncate\">{getTypeLabel(product.type)}</span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Footer */}\r\n              <div className=\"flex items-center justify-between mt-3 pt-2 border-t\">\r\n                <Badge variant={getStatusVariant(product.status) as any} className=\"text-body-xs\">\r\n                  {getStatusLabel(product.status)}\r\n                </Badge>\r\n                {product.unit && (\r\n                  <span className=\"text-body-xs text-muted-foreground\">\r\n                    ĐVT: {product.unit}\r\n                  </span>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col w-full h-full\">\r\n      {/* ===== HÀNG 2: TOOLBAR - Common Actions ===== */}\r\n      {!isMobile ? (\r\n        <PageToolbar\r\n          className=\"flex-wrap gap-2\"\r\n          leftActions={toolbarLeftActions}\r\n          rightActions={toolbarRightActions}\r\n        />\r\n      ) : (\r\n        <>\r\n          <div className=\"py-3\">\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              className=\"w-full justify-center gap-2\"\r\n              onClick={() => setActionsSheetOpen(true)}\r\n            >\r\n              <Settings2 className=\"h-4 w-4\" />\r\n              Tùy chọn bảng\r\n            </Button>\r\n          </div>\r\n          <Sheet open={isActionsSheetOpen} onOpenChange={setActionsSheetOpen}>\r\n            <SheetContent side=\"bottom\" className=\"space-y-4\">\r\n              <SheetHeader>\r\n                <SheetTitle>Hành động nhanh</SheetTitle>\r\n                <SheetDescription>Nhập, xuất dữ liệu và tùy chỉnh cột hiển thị.</SheetDescription>\r\n              </SheetHeader>\r\n              <div className=\"space-y-3\">\r\n                <Button \r\n                  className=\"w-full justify-center\" \r\n                  variant=\"outline\"\r\n                  onClick={() => {\r\n                    setActionsSheetOpen(false);\r\n                    setIsImportOpen(true);\r\n                  }}\r\n                >\r\n                  Nhập sản phẩm\r\n                </Button>\r\n                <Button \r\n                  className=\"w-full justify-center\" \r\n                  variant=\"outline\"\r\n                  onClick={() => {\r\n                    setActionsSheetOpen(false);\r\n                    setIsExportOpen(true);\r\n                  }}\r\n                >\r\n                  Xuất danh sách\r\n                </Button>\r\n                <DataTableColumnCustomizer\r\n                  columns={columns}\r\n                  columnVisibility={columnVisibility}\r\n                  setColumnVisibility={setColumnVisibility}\r\n                  columnOrder={columnOrder}\r\n                  setColumnOrder={setColumnOrder}\r\n                  pinnedColumns={pinnedColumns}\r\n                  setPinnedColumns={setPinnedColumns}\r\n                >\r\n                  <Button className=\"w-full justify-center gap-2\" variant=\"outline\">\r\n                    <Columns3 className=\"h-4 w-4\" />\r\n                    Tuỳ chỉnh cột\r\n                  </Button>\r\n                </DataTableColumnCustomizer>\r\n              </div>\r\n            </SheetContent>\r\n          </Sheet>\r\n        </>\r\n      )}\r\n\r\n      {/* ===== HÀNG 3: FILTERS - Search & Custom Filters (1 hàng) ===== */}\r\n      {!isMobile ? (\r\n        <PageFilters\r\n          searchValue={tableState.search}\r\n          onSearchChange={handleSearchChange}\r\n          searchPlaceholder=\"Tìm kiếm sản phẩm...\"\r\n        >\r\n          {renderFilterControls()}\r\n        </PageFilters>\r\n      ) : (\r\n        <>\r\n          <PageFilters\r\n            searchValue={tableState.search}\r\n            onSearchChange={handleSearchChange}\r\n            searchPlaceholder=\"Tìm kiếm sản phẩm...\"\r\n          >\r\n            <Button\r\n              type=\"button\"\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              className=\"w-full sm:w-auto justify-center gap-2\"\r\n              onClick={() => setFilterSheetOpen(true)}\r\n            >\r\n              <SlidersHorizontal className=\"h-4 w-4\" />\r\n              Bộ lọc nâng cao\r\n            </Button>\r\n          </PageFilters>\r\n          <Sheet open={isFilterSheetOpen} onOpenChange={setFilterSheetOpen}>\r\n            <SheetContent side=\"bottom\" className=\"space-y-4\">\r\n              <SheetHeader>\r\n                <SheetTitle>Bộ lọc sản phẩm</SheetTitle>\r\n                <SheetDescription>Tùy chọn nhanh cho trạng thái, loại, danh mục, combo và tồn kho.</SheetDescription>\r\n              </SheetHeader>\r\n              <div className=\"space-y-3\">\r\n                {renderFilterControls()}\r\n              </div>\r\n            </SheetContent>\r\n          </Sheet>\r\n        </>\r\n      )}\r\n      \r\n      {/* ===== DATA TABLE ===== */}\r\n      <div className=\"pb-4\">\r\n        <ResponsiveDataTable\r\n          columns={columns}\r\n          data={pageData}\r\n          renderMobileCard={(product) => <MobileProductCard product={product} />}\r\n          pageCount={pageCount}\r\n          pagination={tableState.pagination}\r\n          setPagination={handlePaginationChange}\r\n          rowCount={totalRows}\r\n          rowSelection={rowSelection}\r\n          setRowSelection={setRowSelection}\r\n          allSelectedRows={allSelectedRows}\r\n          onBulkDelete={undefined}\r\n          bulkActions={bulkActions}\r\n          pkgxBulkActions={pkgxBulkActions}\r\n          sorting={tableState.sorting}\r\n          setSorting={handleSortingChange}\r\n          columnVisibility={columnVisibility}\r\n          setColumnVisibility={setColumnVisibility}\r\n          columnOrder={columnOrder}\r\n          setColumnOrder={setColumnOrder}\r\n          pinnedColumns={pinnedColumns}\r\n          setPinnedColumns={setPinnedColumns}\r\n          onRowClick={handleRowClick}\r\n          emptyTitle=\"Không có sản phẩm\"\r\n          emptyDescription=\"Thêm sản phẩm đầu tiên để bắt đầu\"\r\n          isLoading={isTableLoading}\r\n          mobileVirtualized\r\n          mobileRowHeight={MOBILE_ROW_HEIGHT}\r\n          mobileListHeight={MOBILE_LIST_HEIGHT}\r\n        />\r\n      </div>\r\n      \r\n    \r\n      <AlertDialog open={isAlertOpen} onOpenChange={setIsAlertOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Bạn có chắc chắn muốn xóa?</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              Sản phẩm sẽ được chuyển vào thùng rác. Bạn có thể khôi phục lại sau.\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel className=\"h-9\">Hủy</AlertDialogCancel>\r\n            <AlertDialogAction className=\"h-9\" onClick={confirmDelete}>Xóa</AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Import Dialog V2 */}\r\n      <GenericImportDialogV2<Product>\r\n        open={isImportOpen}\r\n        onOpenChange={setIsImportOpen}\r\n        config={productImportExportConfig}\r\n        existingData={products}\r\n        onImport={handleImport}\r\n        currentUser={authEmployee ? {\r\n          systemId: authEmployee.systemId,\r\n          name: authEmployee.fullName || authEmployee.id,\r\n        } : undefined}\r\n      />\r\n\r\n      {/* Export Dialog V2 */}\r\n      <GenericExportDialogV2<Product>\r\n        open={isExportOpen}\r\n        onOpenChange={setIsExportOpen}\r\n        config={productImportExportConfig}\r\n        allData={products}\r\n        filteredData={filteredSnapshot}\r\n        currentPageData={pageData}\r\n        selectedData={selectedProducts}\r\n        currentUser={authEmployee ? {\r\n          systemId: authEmployee.systemId,\r\n          name: authEmployee.fullName || authEmployee.id,\r\n        } : { systemId: asSystemId('SYSTEM'), name: 'System' }}\r\n      />\r\n\r\n      {/* PKGX Link Dialog */}\r\n      <PkgxLinkDialog\r\n        open={pkgxLinkDialogOpen}\r\n        onOpenChange={setPkgxLinkDialogOpen}\r\n        product={productToLink}\r\n        onSuccess={handlePkgxLinkSuccess}\r\n      />\r\n\r\n      {/* PKGX Bulk Sync Confirm Dialog */}\r\n      <PkgxBulkSyncConfirmDialog\r\n        confirmAction={bulkConfirmAction}\r\n        progress={bulkProgress}\r\n        onConfirm={executeBulkAction}\r\n        onCancel={cancelBulkConfirm}\r\n      />\r\n    </div>\r\n  )\r\n}\r\n"],"names":[],"mappings":"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"}}]
}