{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/use-settings-page-header.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { usePathname } from 'next/navigation';\r\nimport { Settings2 } from 'lucide-react';\r\nimport { usePageHeader, type PageHeaderState, type PageHeaderDocLink } from '../../contexts/page-header-context';\r\nimport type { BreadcrumbItem } from '../../lib/breadcrumb-system';\r\n\r\nexport type SettingsPageHeaderOptions = Omit<PageHeaderState, 'title' | 'docLink'> & {\r\n  title: string;\r\n  icon?: React.ReactNode;\r\n  docLink?: string | PageHeaderDocLink;\r\n};\r\n\r\nconst defaultDocLabel = 'Xem hướng dẫn';\r\nconst baseBreadcrumb: BreadcrumbItem[] = [\r\n  { label: 'Trang chủ', href: '/', isCurrent: false },\r\n  { label: 'Cài đặt', href: '/settings', isCurrent: false },\r\n];\r\n\r\nconst normalizeLabel = (label?: string) => label?.trim().toLocaleLowerCase('vi');\r\nconst isHomeCrumb = (item: BreadcrumbItem) => item.href === '/' || normalizeLabel(item.label) === 'trang chủ';\r\nconst isSettingsCrumb = (item: BreadcrumbItem) => item.href === '/settings' || normalizeLabel(item.label) === 'cài đặt';\r\n\r\nexport function useSettingsPageHeader(options: SettingsPageHeaderOptions) {\r\n  const pathname = usePathname();\r\n  const { title, icon, docLink, breadcrumb, ...rest } = options;\r\n\r\n  const normalizedDocLink = React.useMemo<PageHeaderDocLink | undefined>(() => {\r\n    if (!docLink) return undefined;\r\n    if (typeof docLink === 'string') {\r\n      return { href: docLink, label: defaultDocLabel };\r\n    }\r\n    return {\r\n      href: docLink.href,\r\n      label: docLink.label ?? defaultDocLabel,\r\n    };\r\n  }, [docLink]);\r\n\r\n  const decoratedTitle = React.useMemo(() => (\r\n    <span className=\"inline-flex items-center gap-2\">\r\n      {(icon ?? <Settings2 className=\"h-5 w-5 text-muted-foreground\" aria-hidden=\"true\" />)}\r\n      <span>{title}</span>\r\n    </span>\r\n  ), [icon, title]);\r\n\r\n  const normalizedBreadcrumb = React.useMemo(() => {\r\n    const custom = (breadcrumb ?? []).map((item) => ({\r\n      ...item,\r\n      href: item.href || pathname,\r\n    }));\r\n\r\n    let merged: BreadcrumbItem[] = custom.length\r\n      ? [...custom]\r\n      : [{ label: title, href: pathname, isCurrent: true }];\r\n\r\n    if (!merged.some(isHomeCrumb)) {\r\n      merged = [{ ...baseBreadcrumb[0] }, ...merged];\r\n    }\r\n\r\n    if (!merged.some(isSettingsCrumb)) {\r\n      const homeIndex = merged.findIndex(isHomeCrumb);\r\n      const insertionIndex = homeIndex >= 0 ? homeIndex + 1 : 0;\r\n      merged = [\r\n        ...merged.slice(0, insertionIndex),\r\n        { ...baseBreadcrumb[1] },\r\n        ...merged.slice(insertionIndex),\r\n      ];\r\n    }\r\n\r\n    return merged.map((item, index) => ({\r\n      ...item,\r\n      isCurrent: index === merged.length - 1,\r\n    }));\r\n  }, [breadcrumb, pathname, title]);\r\n\r\n  return usePageHeader({\r\n    ...rest,\r\n    breadcrumb: normalizedBreadcrumb,\r\n    title: decoratedTitle,\r\n    docLink: normalizedDocLink,\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;;;;;;;AASA,MAAM,kBAAkB;AACxB,MAAM,iBAAmC;IACvC;QAAE,OAAO;QAAa,MAAM;QAAK,WAAW;IAAM;IAClD;QAAE,OAAO;QAAW,MAAM;QAAa,WAAW;IAAM;CACzD;AAED,MAAM,iBAAiB,CAAC,QAAmB,OAAO,OAAO,kBAAkB;AAC3E,MAAM,cAAc,CAAC,OAAyB,KAAK,IAAI,KAAK,OAAO,eAAe,KAAK,KAAK,MAAM;AAClG,MAAM,kBAAkB,CAAC,OAAyB,KAAK,IAAI,KAAK,eAAe,eAAe,KAAK,KAAK,MAAM;AAEvG,SAAS,sBAAsB,OAAkC;;IACtE,MAAM,WAAW,IAAA,oJAAW;IAC5B,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,EAAE,UAAU,EAAE,GAAG,MAAM,GAAG;IAEtD,MAAM,oBAAoB,wKAAa;4DAAgC;YACrE,IAAI,CAAC,SAAS,OAAO;YACrB,IAAI,OAAO,YAAY,UAAU;gBAC/B,OAAO;oBAAE,MAAM;oBAAS,OAAO;gBAAgB;YACjD;YACA,OAAO;gBACL,MAAM,QAAQ,IAAI;gBAClB,OAAO,QAAQ,KAAK,IAAI;YAC1B;QACF;2DAAG;QAAC;KAAQ;IAEZ,MAAM,iBAAiB,wKAAa;yDAAC,kBACnC,6LAAC;gBAAK,WAAU;;oBACZ,sBAAQ,6LAAC,gOAAS;wBAAC,WAAU;wBAAgC,eAAY;;;;;;kCAC3E,6LAAC;kCAAM;;;;;;;;;;;;wDAER;QAAC;QAAM;KAAM;IAEhB,MAAM,uBAAuB,wKAAa;+DAAC;YACzC,MAAM,SAAS,CAAC,cAAc,EAAE,EAAE,GAAG;8EAAC,CAAC,OAAS,CAAC;wBAC/C,GAAG,IAAI;wBACP,MAAM,KAAK,IAAI,IAAI;oBACrB,CAAC;;YAED,IAAI,SAA2B,OAAO,MAAM,GACxC;mBAAI;aAAO,GACX;gBAAC;oBAAE,OAAO;oBAAO,MAAM;oBAAU,WAAW;gBAAK;aAAE;YAEvD,IAAI,CAAC,OAAO,IAAI,CAAC,cAAc;gBAC7B,SAAS;oBAAC;wBAAE,GAAG,cAAc,CAAC,EAAE;oBAAC;uBAAM;iBAAO;YAChD;YAEA,IAAI,CAAC,OAAO,IAAI,CAAC,kBAAkB;gBACjC,MAAM,YAAY,OAAO,SAAS,CAAC;gBACnC,MAAM,iBAAiB,aAAa,IAAI,YAAY,IAAI;gBACxD,SAAS;uBACJ,OAAO,KAAK,CAAC,GAAG;oBACnB;wBAAE,GAAG,cAAc,CAAC,EAAE;oBAAC;uBACpB,OAAO,KAAK,CAAC;iBACjB;YACH;YAEA,OAAO,OAAO,GAAG;uEAAC,CAAC,MAAM,QAAU,CAAC;wBAClC,GAAG,IAAI;wBACP,WAAW,UAAU,OAAO,MAAM,GAAG;oBACvC,CAAC;;QACH;8DAAG;QAAC;QAAY;QAAU;KAAM;IAEhC,OAAO,IAAA,0JAAa,EAAC;QACnB,GAAG,IAAI;QACP,YAAY;QACZ,OAAO;QACP,SAAS;IACX;AACF;GA1DgB;;QACG,oJAAW;QAmDrB,0JAAa"}},
    {"offset": {"line": 153, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/workflow-templates-page.tsx"],"sourcesContent":["/**\r\n * Workflow Templates Settings Page - UPGRADED\r\n * \r\n * Quản lý templates quy trình xử lý cho các chức năng\r\n * - Full CRUD: Create, Read, Update, Delete templates\r\n * - Mỗi chức năng có thể có NHIỀU quy trình\r\n * - Có switch \"Mặc định\" để chọn quy trình mặc định cho mỗi chức năng\r\n * - UI: VirtualizedDataTable với select all + Dialog editor\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { useSettingsPageHeader } from '../use-settings-page-header';\r\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '../../../components/ui/card';\r\nimport { Button } from '../../../components/ui/button';\r\nimport { SubtaskList, type Subtask } from '../../../components/shared/subtask-list';\r\nimport { toast } from 'sonner';\r\nimport { nanoid } from 'nanoid';\r\nimport { \r\n  Plus, \r\n  Save, \r\n  X, \r\n  MoreHorizontal,\r\n} from 'lucide-react';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '../../../components/ui/dialog';\r\nimport {\r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuSeparator,\r\n  DropdownMenuTrigger,\r\n} from '../../../components/ui/dropdown-menu';\r\nimport {\r\n  Select,\r\n  SelectContent,\r\n  SelectItem,\r\n  SelectTrigger,\r\n  SelectValue,\r\n} from '../../../components/ui/select';\r\nimport { Input } from '../../../components/ui/input';\r\nimport { Label } from '../../../components/ui/label';\r\nimport { Textarea } from '../../../components/ui/textarea';\r\nimport { Badge } from '../../../components/ui/badge';\r\nimport { Switch } from '../../../components/ui/switch';\r\nimport { Checkbox } from '../../../components/ui/checkbox';\r\nimport { VirtualizedDataTable } from '../../../components/data-table/virtualized-data-table';\r\nimport type { ColumnDef } from '../../../components/data-table/types';\r\nimport { ConfirmDialog } from '../../../components/ui/confirm-dialog';\r\nimport { Separator } from '../../../components/ui/separator';\r\nimport { \r\n  useWorkflowTemplates, \r\n  getWorkflowTemplateSync as getWorkflowTemplate,\r\n  getWorkflowTemplatesSync as getWorkflowTemplates,\r\n  type WorkflowTemplate \r\n} from '../../../hooks/use-workflow-templates';\r\n\r\n// ============================================================================\r\n// Types & Constants\r\n// ============================================================================\r\n\r\n// Re-export WorkflowTemplate from hook for backward compatibility\r\nexport type { WorkflowTemplate } from '../../../hooks/use-workflow-templates';\r\n\r\n// Available workflow types - Các chức năng có thể cần quy trình xử lý\r\nconst WORKFLOW_TYPES = [\r\n  { value: 'complaints', label: 'Khiếu nại' },\r\n  { value: 'warranty', label: 'Bảo hành' },\r\n  { value: 'orders', label: 'Đơn hàng' },\r\n  { value: 'sales-returns', label: 'Đổi trả hàng' },\r\n  { value: 'purchase-returns', label: 'Trả hàng NCC' },\r\n  { value: 'stock-transfers', label: 'Chuyển kho' },\r\n  { value: 'inventory-checks', label: 'Kiểm kho' },\r\n] as const;\r\n\r\n// ============================================================================\r\n// Table Columns\r\n// ============================================================================\r\n\r\nfunction createColumns(\r\n  onEdit: (template: WorkflowTemplate) => void,\r\n  onDelete: (templateId: string) => void,\r\n  onToggleDefault: (template: WorkflowTemplate, checked: boolean) => void,\r\n): ColumnDef<WorkflowTemplate>[] {\r\n  return [\r\n    {\r\n      id: 'select',\r\n      size: 40,\r\n      meta: { displayName: 'Chọn', sticky: 'left' },\r\n      header: ({ isAllPageRowsSelected, isSomePageRowsSelected, onToggleAll }) => (\r\n        <Checkbox\r\n          checked={isSomePageRowsSelected ? 'indeterminate' : isAllPageRowsSelected}\r\n          onCheckedChange={(checked) => onToggleAll?.(checked === true)}\r\n          aria-label=\"Chọn tất cả\"\r\n        />\r\n      ),\r\n      cell: ({ isSelected, onToggleSelect }) => (\r\n        <Checkbox\r\n          checked={isSelected}\r\n          onCheckedChange={(checked) => onToggleSelect?.(checked === true)}\r\n          aria-label=\"Chọn dòng\"\r\n        />\r\n      ),\r\n    },\r\n    {\r\n      id: 'label',\r\n      header: 'Tên quy trình',\r\n      size: 250,\r\n      cell: ({ row }) => (\r\n        <div className=\"flex items-center gap-2\">\r\n          <span className=\"font-medium\">{row.label}</span>\r\n          {row.isDefault && (\r\n            <Badge variant=\"outline\" className=\"text-xs\">\r\n              Mặc định\r\n            </Badge>\r\n          )}\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      id: 'name',\r\n      header: 'Chức năng',\r\n      size: 120,\r\n      cell: ({ row }) => {\r\n        const wt = WORKFLOW_TYPES.find(w => w.value === row.name);\r\n        return (\r\n          <Badge variant=\"secondary\">\r\n            {wt?.label || row.name}\r\n          </Badge>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      id: 'description',\r\n      header: 'Mô tả',\r\n      size: 250,\r\n      cell: ({ row }) => (\r\n        <span className=\"text-sm text-muted-foreground truncate block max-w-[230px]\">\r\n          {row.description || '-'}\r\n        </span>\r\n      ),\r\n    },\r\n    {\r\n      id: 'subtasks',\r\n      header: 'Số bước',\r\n      size: 80,\r\n      cell: ({ row }) => (\r\n        <span className=\"text-center block\">{row.subtasks.length}</span>\r\n      ),\r\n    },\r\n    {\r\n      id: 'isDefault',\r\n      header: 'Mặc định',\r\n      size: 100,\r\n      cell: ({ row }) => (\r\n        <div className=\"flex justify-center\">\r\n          <Switch\r\n            checked={row.isDefault}\r\n            onCheckedChange={(checked) => onToggleDefault(row, checked)}\r\n            aria-label=\"Đặt làm mặc định\"\r\n          />\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      id: 'actions',\r\n      header: 'Thao tác',\r\n      size: 80,\r\n      meta: { displayName: 'Thao tác', sticky: 'right' },\r\n      cell: ({ row }) => (\r\n        <DropdownMenu>\r\n          <DropdownMenuTrigger asChild>\r\n            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\r\n              <MoreHorizontal className=\"h-4 w-4\" />\r\n            </Button>\r\n          </DropdownMenuTrigger>\r\n          <DropdownMenuContent align=\"end\">\r\n            <DropdownMenuItem onClick={() => onEdit(row)}>\r\n              Sửa\r\n            </DropdownMenuItem>\r\n            <DropdownMenuSeparator />\r\n            <DropdownMenuItem \r\n              onClick={() => onDelete(row.systemId)}\r\n              className=\"text-destructive focus:text-destructive\"\r\n            >\r\n              Xóa\r\n            </DropdownMenuItem>\r\n          </DropdownMenuContent>\r\n        </DropdownMenu>\r\n      ),\r\n    },\r\n  ];\r\n}\r\n\r\n// ============================================================================\r\n// Main Component\r\n// ============================================================================\r\n\r\nexport function WorkflowTemplatesPage() {\r\n  const { templates, setTemplates, isLoading } = useWorkflowTemplates();\r\n  \r\n  // Table states\r\n  const [rowSelection, setRowSelection] = React.useState<Record<string, boolean>>({});\r\n  const [expanded, setExpanded] = React.useState<Record<string, boolean>>({});\r\n  const [sorting, setSorting] = React.useState<{ id: string; desc: boolean }>({ id: 'createdAt', desc: true });\r\n  const [columnVisibility, setColumnVisibility] = React.useState<Record<string, boolean>>({});\r\n  const [columnOrder, setColumnOrder] = React.useState<string[]>([]);\r\n  const [pinnedColumns, setPinnedColumns] = React.useState<string[]>(['select', 'actions']);\r\n  \r\n  // Dialog states\r\n  const [isDialogOpen, setIsDialogOpen] = React.useState(false);\r\n  const [editingTemplate, setEditingTemplate] = React.useState<WorkflowTemplate | null>(null);\r\n  const [deleteTargetId, setDeleteTargetId] = React.useState<string | null>(null);\r\n  const [showBulkDeleteDialog, setShowBulkDeleteDialog] = React.useState(false);\r\n  \r\n  // Form states\r\n  const [formName, setFormName] = React.useState('');\r\n  const [formLabel, setFormLabel] = React.useState('');\r\n  const [formDescription, setFormDescription] = React.useState('');\r\n  const [formSubtasks, setFormSubtasks] = React.useState<Subtask[]>([]);\r\n\r\n  const selectedRows = React.useMemo(() => {\r\n    return templates.filter(t => rowSelection[t.systemId]);\r\n  }, [templates, rowSelection]);\r\n\r\n  const handleCreate = () => {\r\n    setEditingTemplate(null);\r\n    setFormName('');\r\n    setFormLabel('');\r\n    setFormDescription('');\r\n    setFormSubtasks([]);\r\n    setIsDialogOpen(true);\r\n  };\r\n\r\n  // Tính số quy trình theo chức năng\r\n  const workflowCounts = React.useMemo(() => {\r\n    const counts: Record<string, number> = {};\r\n    WORKFLOW_TYPES.forEach(wt => {\r\n      counts[wt.value] = templates.filter(t => t.name === wt.value).length;\r\n    });\r\n    return counts;\r\n  }, [templates]);\r\n\r\n  // Lấy các chức năng đã có quy trình\r\n  const activeWorkflows = React.useMemo(() => {\r\n    return WORKFLOW_TYPES.filter(wt => workflowCounts[wt.value] > 0);\r\n  }, [workflowCounts]);\r\n\r\n  useSettingsPageHeader({\r\n    title: 'Quy trình',\r\n    actions: [\r\n      // Hiển thị badges cho các chức năng đã có quy trình\r\n      ...activeWorkflows.map(wt => (\r\n        <Badge key={wt.value} variant=\"secondary\" className=\"text-xs\">\r\n          {wt.label}: {workflowCounts[wt.value]}\r\n        </Badge>\r\n      )),\r\n      <Button key=\"add\" onClick={handleCreate}>\r\n        <Plus className=\"h-4 w-4\" />\r\n        Tạo quy trình\r\n      </Button>\r\n    ],\r\n  });\r\n\r\n  const handleEdit = React.useCallback((template: WorkflowTemplate) => {\r\n    setEditingTemplate(template);\r\n    setFormName(template.name);\r\n    setFormLabel(template.label);\r\n    setFormDescription(template.description);\r\n    setFormSubtasks([...template.subtasks]);\r\n    setIsDialogOpen(true);\r\n  }, []);\r\n\r\n  const handleSave = () => {\r\n    // Validation\r\n    if (!formName || !formLabel || formSubtasks.length === 0) {\r\n      toast.error('Vui lòng điền đầy đủ thông tin');\r\n      return;\r\n    }\r\n\r\n    const now = new Date();\r\n\r\n    if (editingTemplate) {\r\n      // Update existing\r\n      const updatedTemplates = templates.map(t =>\r\n        t.systemId === editingTemplate.systemId\r\n          ? {\r\n              ...t,\r\n              name: formName,\r\n              label: formLabel,\r\n              description: formDescription,\r\n              subtasks: formSubtasks,\r\n              updatedAt: now,\r\n            }\r\n          : t\r\n      );\r\n      setTemplates(updatedTemplates);\r\n      toast.success('Đã cập nhật quy trình');\r\n    } else {\r\n      // Create new - check if this is the first template for this function\r\n      const existingForFunction = templates.filter(t => t.name === formName);\r\n      const isFirstForFunction = existingForFunction.length === 0;\r\n      \r\n      const newTemplate: WorkflowTemplate = {\r\n        systemId: nanoid(),\r\n        id: nanoid(),\r\n        name: formName,\r\n        label: formLabel,\r\n        description: formDescription,\r\n        subtasks: formSubtasks,\r\n        isDefault: isFirstForFunction, // Auto set as default if first\r\n        createdAt: now,\r\n        updatedAt: now,\r\n      };\r\n      setTemplates([...templates, newTemplate]);\r\n      toast.success('Đã tạo quy trình mới');\r\n    }\r\n\r\n    setIsDialogOpen(false);\r\n  };\r\n\r\n  const handleDeleteClick = React.useCallback((templateId: string) => {\r\n    setDeleteTargetId(templateId);\r\n  }, []);\r\n\r\n  const handleDeleteConfirm = () => {\r\n    if (!deleteTargetId) return;\r\n\r\n    const templateToDelete = templates.find(t => t.systemId === deleteTargetId);\r\n    \r\n    let newTemplates = templates.filter(t => t.systemId !== deleteTargetId);\r\n    \r\n    // If deleted template was default, set another one as default\r\n    if (templateToDelete?.isDefault) {\r\n      const sameFunction = newTemplates.filter(t => t.name === templateToDelete.name);\r\n      if (sameFunction.length > 0 && !sameFunction.some(t => t.isDefault)) {\r\n        newTemplates = newTemplates.map(t => \r\n          t.systemId === sameFunction[0].systemId ? { ...t, isDefault: true } : t\r\n        );\r\n      }\r\n    }\r\n    \r\n    setTemplates(newTemplates);\r\n    \r\n    toast.success('Đã xóa quy trình');\r\n    setDeleteTargetId(null);\r\n  };\r\n\r\n  const handleBulkDelete = () => {\r\n    setShowBulkDeleteDialog(true);\r\n  };\r\n\r\n  const handleBulkDeleteConfirm = () => {\r\n    const idsToDelete = Object.keys(rowSelection);\r\n    \r\n    let newTemplates = templates.filter(t => !idsToDelete.includes(t.systemId));\r\n    \r\n    // Ensure each function has a default\r\n    WORKFLOW_TYPES.forEach(wt => {\r\n      const forFunction = newTemplates.filter(t => t.name === wt.value);\r\n      if (forFunction.length > 0 && !forFunction.some(t => t.isDefault)) {\r\n        newTemplates = newTemplates.map(t => \r\n          t.systemId === forFunction[0].systemId ? { ...t, isDefault: true } : t\r\n        );\r\n      }\r\n    });\r\n    \r\n    setTemplates(newTemplates);\r\n    \r\n    setRowSelection({});\r\n    setShowBulkDeleteDialog(false);\r\n    toast.success(`Đã xóa ${idsToDelete.length} quy trình`);\r\n  };\r\n\r\n  const handleToggleDefault = React.useCallback((template: WorkflowTemplate, checked: boolean) => {\r\n    if (checked) {\r\n      // Bật mặc định cho template này\r\n      const updatedTemplates = templates.map(t => {\r\n        if (t.name === template.name) {\r\n          return {\r\n            ...t,\r\n            isDefault: t.systemId === template.systemId,\r\n            updatedAt: new Date(),\r\n          };\r\n        }\r\n        return t;\r\n      });\r\n      setTemplates(updatedTemplates);\r\n    } else {\r\n      // Tắt mặc định - tìm template khác cùng function để set mặc định\r\n      const otherTemplates = templates.filter(t => t.name === template.name && t.systemId !== template.systemId);\r\n      if (otherTemplates.length > 0) {\r\n        const newDefault = otherTemplates[0];\r\n        const updatedTemplates = templates.map(t => {\r\n          if (t.name === template.name) {\r\n            return {\r\n              ...t,\r\n              isDefault: t.systemId === newDefault.systemId,\r\n              updatedAt: new Date(),\r\n            };\r\n          }\r\n          return t;\r\n        });\r\n        setTemplates(updatedTemplates);\r\n      } else {\r\n        // Không có template khác, giữ nguyên\r\n        toast.error('Phải có ít nhất một quy trình mặc định cho chức năng này');\r\n      }\r\n    }\r\n  }, [templates, setTemplates]);\r\n\r\n  const columns = React.useMemo(\r\n    () => createColumns(handleEdit, handleDeleteClick, handleToggleDefault),\r\n    [handleEdit, handleDeleteClick, handleToggleDefault]\r\n  );\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Templates Table */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle>Danh sách quy trình</CardTitle>\r\n          <CardDescription>\r\n            Quản lý các quy trình xử lý cho từng chức năng. Mỗi chức năng có thể có nhiều quy trình, chọn 1 làm mặc định.\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          {templates.length === 0 ? (\r\n            <div className=\"text-center py-8 text-muted-foreground\">\r\n              Chưa có quy trình nào. Nhấn \"Tạo quy trình\" để bắt đầu.\r\n            </div>\r\n          ) : (\r\n            <VirtualizedDataTable\r\n              columns={columns}\r\n              data={templates}\r\n              rowSelection={rowSelection}\r\n              setRowSelection={setRowSelection}\r\n              onBulkDelete={handleBulkDelete}\r\n              showBulkDeleteButton={true}\r\n              allSelectedRows={selectedRows}\r\n              expanded={expanded}\r\n              setExpanded={setExpanded}\r\n              sorting={sorting}\r\n              setSorting={setSorting}\r\n              columnVisibility={columnVisibility}\r\n              setColumnVisibility={setColumnVisibility}\r\n              columnOrder={columnOrder}\r\n              setColumnOrder={setColumnOrder}\r\n              pinnedColumns={pinnedColumns}\r\n              setPinnedColumns={setPinnedColumns}\r\n            />\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Info Card */}\r\n      <Card className=\"bg-muted/50\">\r\n        <CardContent className=\"pt-6\">\r\n          <div className=\"space-y-3 text-sm\">\r\n            <p className=\"font-medium\">Hướng dẫn sử dụng:</p>\r\n            <ul className=\"list-disc list-inside space-y-1 text-muted-foreground\">\r\n              <li>Mỗi chức năng (Khiếu nại, Bảo hành, ...) có thể có nhiều quy trình</li>\r\n              <li>Bật switch \"Mặc định\" để chọn quy trình áp dụng khi tạo phiếu mới</li>\r\n              <li>Mỗi chức năng chỉ có 1 quy trình mặc định</li>\r\n              <li>Khi hoàn thành 100% checklist → Tự động chuyển trạng thái cuối</li>\r\n            </ul>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Create/Edit Dialog */}\r\n      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\r\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\r\n          <DialogHeader>\r\n            <DialogTitle>\r\n              {editingTemplate ? 'Chỉnh sửa quy trình' : 'Tạo quy trình mới'}\r\n            </DialogTitle>\r\n            <DialogDescription>\r\n              {editingTemplate \r\n                ? 'Cập nhật thông tin và các bước trong quy trình'\r\n                : 'Chọn chức năng và tạo danh sách các bước xử lý'\r\n              }\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n\r\n          <div className=\"space-y-6 py-4\">\r\n            {/* Basic Info */}\r\n            <div className=\"space-y-4\">\r\n              {/* Workflow Type Select */}\r\n              <div className=\"space-y-2\">\r\n                <Label>Chức năng *</Label>\r\n                <Select value={formName} onValueChange={setFormName}>\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Chọn chức năng\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {WORKFLOW_TYPES.map(wt => {\r\n                      const count = templates.filter(t => t.name === wt.value).length;\r\n                      return (\r\n                        <SelectItem key={wt.value} value={wt.value}>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <span>{wt.label}</span>\r\n                            {count > 0 && (\r\n                              <Badge variant=\"secondary\" className=\"ml-2 text-xs\">\r\n                                {count} quy trình\r\n                              </Badge>\r\n                            )}\r\n                          </div>\r\n                        </SelectItem>\r\n                      );\r\n                    })}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n\r\n              {/* Label */}\r\n              <div className=\"space-y-2\">\r\n                <Label>Tên quy trình *</Label>\r\n                <Input\r\n                  value={formLabel}\r\n                  onChange={(e) => setFormLabel(e.target.value)}\r\n                  placeholder=\"VD: Quy trình xử lý khiếu nại VIP\"\r\n                />\r\n              </div>\r\n\r\n              {/* Description */}\r\n              <div className=\"space-y-2\">\r\n                <Label>Mô tả</Label>\r\n                <Textarea\r\n                  value={formDescription}\r\n                  onChange={(e) => setFormDescription(e.target.value)}\r\n                  placeholder=\"Mô tả ngắn gọn về quy trình này\"\r\n                  rows={2}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <Separator />\r\n\r\n            {/* Subtasks Editor */}\r\n            <div className=\"space-y-3\">\r\n              <div className=\"flex items-center justify-between\">\r\n                <Label className=\"text-base\">Các bước xử lý *</Label>\r\n                <Badge variant=\"secondary\">\r\n                  {formSubtasks.length} bước\r\n                </Badge>\r\n              </div>\r\n\r\n              <SubtaskList\r\n                subtasks={formSubtasks}\r\n                onAdd={(title, parentId) => {\r\n                  const newSubtask: Subtask = {\r\n                    id: nanoid(),\r\n                    title,\r\n                    completed: false,\r\n                    order: formSubtasks.length,\r\n                    createdAt: new Date(),\r\n                    parentId,\r\n                  };\r\n                  setFormSubtasks(prev => [...prev, newSubtask]);\r\n                }}\r\n                onUpdate={(id, updates) => {\r\n                  setFormSubtasks(prev =>\r\n                    prev.map(s => (s.id === id ? { ...s, ...updates } : s))\r\n                  );\r\n                }}\r\n                onDelete={(id) => {\r\n                  setFormSubtasks(prev =>\r\n                    prev.filter(s => s.id !== id && s.parentId !== id)\r\n                  );\r\n                }}\r\n                onReorder={(reordered) => {\r\n                  setFormSubtasks(reordered);\r\n                }}\r\n                onToggleComplete={(id, completed) => {\r\n                  // Keep completed false in template mode\r\n                  setFormSubtasks(prev =>\r\n                    prev.map(s => (s.id === id ? { ...s, completed: false } : s))\r\n                  );\r\n                }}\r\n                allowNested={true}\r\n                showProgress={false}\r\n                readonly={false}\r\n                emptyMessage=\"Chưa có bước nào. Click 'Thêm subtask' để tạo.\"\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <DialogFooter>\r\n            <Button variant=\"outline\" onClick={() => setIsDialogOpen(false)}>\r\n              <X className=\"h-4 w-4\" />\r\n              Hủy\r\n            </Button>\r\n            <Button onClick={handleSave}>\r\n              <Save className=\"h-4 w-4\" />\r\n              {editingTemplate ? 'Cập nhật' : 'Tạo mới'}\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Delete Confirmation Dialog */}\r\n      <ConfirmDialog\r\n        open={!!deleteTargetId}\r\n        onOpenChange={(open) => !open && setDeleteTargetId(null)}\r\n        title=\"Xác nhận xóa\"\r\n        description={`Bạn có chắc muốn xóa quy trình \"${templates.find(t => t.systemId === deleteTargetId)?.label || ''}\"? Hành động này không thể hoàn tác.`}\r\n        confirmText=\"Xóa\"\r\n        cancelText=\"Hủy\"\r\n        variant=\"destructive\"\r\n        onConfirm={handleDeleteConfirm}\r\n      />\r\n\r\n      {/* Bulk Delete Confirmation Dialog */}\r\n      <ConfirmDialog\r\n        open={showBulkDeleteDialog}\r\n        onOpenChange={setShowBulkDeleteDialog}\r\n        title=\"Xác nhận xóa nhiều\"\r\n        description={`Bạn có chắc muốn xóa ${selectedRows.length} quy trình đã chọn? Hành động này không thể hoàn tác.`}\r\n        confirmText=\"Xóa tất cả\"\r\n        cancelText=\"Hủy\"\r\n        variant=\"destructive\"\r\n        onConfirm={handleBulkDeleteConfirm}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\n// ============================================================================\r\n// Re-export functions from hook for backward compatibility\r\n// ============================================================================\r\n\r\nexport { getWorkflowTemplate, getWorkflowTemplates };\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1211, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/receipt-types/store.ts"],"sourcesContent":["import { createCrudStore } from '../../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { ReceiptType } from './types';\r\nimport { toISODate, getCurrentDate } from '../../../lib/date-utils';\r\n\r\nconst baseStore = createCrudStore<ReceiptType>([], 'receipt-types', {\r\n  businessIdField: 'id',\r\n  apiEndpoint: '/api/settings/data?type=receipt-type',\r\n});\r\n\r\nconst originalAdd = baseStore.getState().add;\r\n\r\nbaseStore.setState((state) => ({\r\n  ...state,\r\n  add: (item) => {\r\n    const newItem = {\r\n      ...item,\r\n      createdAt: item.createdAt ?? toISODate(getCurrentDate()),\r\n    } satisfies Omit<ReceiptType, 'systemId'>;\r\n    return originalAdd(newItem);\r\n  },\r\n}));\r\n\r\nexport const useReceiptTypeStore = baseStore;\r\n"],"names":[],"mappings":";;;;AAAA;AAGA;;;AAEA,MAAM,YAAY,IAAA,6IAAe,EAAc,EAAE,EAAE,iBAAiB;IAClE,iBAAiB;IACjB,aAAa;AACf;AAEA,MAAM,cAAc,UAAU,QAAQ,GAAG,GAAG;AAE5C,UAAU,QAAQ,CAAC,CAAC,QAAU,CAAC;QAC7B,GAAG,KAAK;QACR,KAAK,CAAC;YACJ,MAAM,UAAU;gBACd,GAAG,IAAI;gBACP,WAAW,KAAK,SAAS,IAAI,IAAA,oIAAS,EAAC,IAAA,yIAAc;YACvD;YACA,OAAO,YAAY;QACrB;IACF,CAAC;AAEM,MAAM,sBAAsB"}},
    {"offset": {"line": 1242, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/target-groups/store.ts"],"sourcesContent":["import { createCrudStore } from '../../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { TargetGroup } from './types';\r\n\r\nexport const useTargetGroupStore = createCrudStore<TargetGroup>([], 'target-groups', {\r\n  apiEndpoint: '/api/settings/data?type=target-group',\r\n});\r\n"],"names":[],"mappings":";;;;AAAA;;AAIO,MAAM,sBAAsB,IAAA,6IAAe,EAAc,EAAE,EAAE,iBAAiB;IACnF,aAAa;AACf"}},
    {"offset": {"line": 1258, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/payments/methods/store.ts"],"sourcesContent":["import { create } from 'zustand';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { PaymentMethod } from './types';\r\nimport { asSystemId, type SystemId } from '@/lib/id-types';\r\n\r\n// API sync helper\r\nasync function syncToAPI(\r\n  action: 'create' | 'update' | 'delete',\r\n  data: Partial<PaymentMethod>\r\n): Promise<boolean> {\r\n  try {\r\n    const endpoint = action === 'create'\r\n      ? '/api/settings/payment-methods'\r\n      : `/api/settings/payment-methods/${data.systemId}`;\r\n    const method = action === 'create' ? 'POST' : action === 'update' ? 'PATCH' : 'DELETE';\r\n    \r\n    const response = await fetch(endpoint, {\r\n      method,\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: action !== 'delete' ? JSON.stringify(data) : undefined,\r\n    });\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error(`[Payment Methods API] ${action} error:`, error);\r\n    return false;\r\n  }\r\n}\r\n\r\ninterface PaymentMethodState {\r\n  data: PaymentMethod[];\r\n  initialized: boolean;\r\n  add: (item: Omit<PaymentMethod, 'systemId' | 'isDefault'>) => void;\r\n  update: (systemId: SystemId, updatedPolicy: Omit<PaymentMethod, 'isDefault' | 'systemId'>) => void;\r\n  remove: (systemId: SystemId) => void;\r\n  setDefault: (systemId: SystemId) => void;\r\n  loadFromAPI: () => Promise<void>;\r\n}\r\n\r\nexport const usePaymentMethodStore = create<PaymentMethodState>()(\r\n  (set, get) => ({\r\n      data: [],\r\n      initialized: false,\r\n      add: (item) => {\r\n        const newItem: PaymentMethod = { \r\n          ...item, \r\n          systemId: asSystemId(`PM_${Date.now()}`),\r\n          isDefault: get().data.length === 0,\r\n        };\r\n        set((state) => ({ data: [...state.data, newItem] }));\r\n        \r\n        // Sync to API\r\n        syncToAPI('create', newItem).catch(console.error);\r\n      },\r\n      update: (systemId, updatedFields) => {\r\n        set((state) => ({\r\n          data: state.data.map(p => p.systemId === systemId ? { ...p, ...updatedFields } : p),\r\n        }));\r\n        \r\n        // Sync to API\r\n        const updated = get().data.find(p => p.systemId === systemId);\r\n        if (updated) {\r\n          syncToAPI('update', updated).catch(console.error);\r\n        }\r\n      },\r\n      remove: (systemId) => {\r\n        syncToAPI('delete', { systemId }).catch(console.error);\r\n        set((state) => ({\r\n          data: state.data.filter((p) => p.systemId !== systemId),\r\n        }));\r\n      },\r\n      setDefault: (systemId) => {\r\n        set((state) => ({\r\n          data: state.data.map(p => ({ ...p, isDefault: p.systemId === systemId })),\r\n        }));\r\n        \r\n        // Sync all to API (update default status)\r\n        const data = get().data;\r\n        for (const item of data) {\r\n          syncToAPI('update', item).catch(console.error);\r\n        }\r\n      },\r\n      \r\n      loadFromAPI: async () => {\r\n        if (get().initialized) return;\r\n        \r\n        try {\r\n          // NOTE: Settings data is typically small, but using limit for consistency\r\n          const response = await fetch('/api/settings/payment-methods?limit=30');\r\n          if (response.ok) {\r\n            const json = await response.json();\r\n            const data = json.data || json.methods || [];\r\n            if (data.length > 0) {\r\n              set({ data, initialized: true });\r\n            } else {\r\n              set({ initialized: true });\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('[Payment Methods Store] loadFromAPI error:', error);\r\n        }\r\n      },\r\n    })\r\n);\r\n"],"names":[],"mappings":";;;;AAAA;AAGA;;;AAEA,kBAAkB;AAClB,eAAe,UACb,MAAsC,EACtC,IAA4B;IAE5B,IAAI;QACF,MAAM,WAAW,WAAW,WACxB,kCACA,CAAC,8BAA8B,EAAE,KAAK,QAAQ,EAAE;QACpD,MAAM,SAAS,WAAW,WAAW,SAAS,WAAW,WAAW,UAAU;QAE9E,MAAM,WAAW,MAAM,MAAM,UAAU;YACrC;YACA,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,WAAW,WAAW,KAAK,SAAS,CAAC,QAAQ;QACrD;QACA,OAAO,SAAS,EAAE;IACpB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,sBAAsB,EAAE,OAAO,OAAO,CAAC,EAAE;QACxD,OAAO;IACT;AACF;AAYO,MAAM,wBAAwB,IAAA,qJAAM,IACzC,CAAC,KAAK,MAAQ,CAAC;QACX,MAAM,EAAE;QACR,aAAa;QACb,KAAK,CAAC;YACJ,MAAM,UAAyB;gBAC7B,GAAG,IAAI;gBACP,UAAU,IAAA,mIAAU,EAAC,CAAC,GAAG,EAAE,KAAK,GAAG,IAAI;gBACvC,WAAW,MAAM,IAAI,CAAC,MAAM,KAAK;YACnC;YACA,IAAI,CAAC,QAAU,CAAC;oBAAE,MAAM;2BAAI,MAAM,IAAI;wBAAE;qBAAQ;gBAAC,CAAC;YAElD,cAAc;YACd,UAAU,UAAU,SAAS,KAAK,CAAC,QAAQ,KAAK;QAClD;QACA,QAAQ,CAAC,UAAU;YACjB,IAAI,CAAC,QAAU,CAAC;oBACd,MAAM,MAAM,IAAI,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK,WAAW;4BAAE,GAAG,CAAC;4BAAE,GAAG,aAAa;wBAAC,IAAI;gBACnF,CAAC;YAED,cAAc;YACd,MAAM,UAAU,MAAM,IAAI,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK;YACpD,IAAI,SAAS;gBACX,UAAU,UAAU,SAAS,KAAK,CAAC,QAAQ,KAAK;YAClD;QACF;QACA,QAAQ,CAAC;YACP,UAAU,UAAU;gBAAE;YAAS,GAAG,KAAK,CAAC,QAAQ,KAAK;YACrD,IAAI,CAAC,QAAU,CAAC;oBACd,MAAM,MAAM,IAAI,CAAC,MAAM,CAAC,CAAC,IAAM,EAAE,QAAQ,KAAK;gBAChD,CAAC;QACH;QACA,YAAY,CAAC;YACX,IAAI,CAAC,QAAU,CAAC;oBACd,MAAM,MAAM,IAAI,CAAC,GAAG,CAAC,CAAA,IAAK,CAAC;4BAAE,GAAG,CAAC;4BAAE,WAAW,EAAE,QAAQ,KAAK;wBAAS,CAAC;gBACzE,CAAC;YAED,0CAA0C;YAC1C,MAAM,OAAO,MAAM,IAAI;YACvB,KAAK,MAAM,QAAQ,KAAM;gBACvB,UAAU,UAAU,MAAM,KAAK,CAAC,QAAQ,KAAK;YAC/C;QACF;QAEA,aAAa;YACX,IAAI,MAAM,WAAW,EAAE;YAEvB,IAAI;gBACF,0EAA0E;gBAC1E,MAAM,WAAW,MAAM,MAAM;gBAC7B,IAAI,SAAS,EAAE,EAAE;oBACf,MAAM,OAAO,MAAM,SAAS,IAAI;oBAChC,MAAM,OAAO,KAAK,IAAI,IAAI,KAAK,OAAO,IAAI,EAAE;oBAC5C,IAAI,KAAK,MAAM,GAAG,GAAG;wBACnB,IAAI;4BAAE;4BAAM,aAAa;wBAAK;oBAChC,OAAO;wBACL,IAAI;4BAAE,aAAa;wBAAK;oBAC1B;gBACF;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,8CAA8C;YAC9D;QACF;IACF,CAAC"}},
    {"offset": {"line": 1367, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/payments/types/store.ts"],"sourcesContent":["import { createCrudStore } from '../../../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { PaymentType } from './types';\r\nimport { toISODate, getCurrentDate } from '../../../../lib/date-utils';\r\n\r\nconst baseStore = createCrudStore<PaymentType>([], 'payment-types', {\r\n  businessIdField: 'id',\r\n  apiEndpoint: '/api/settings/data?type=payment-type',\r\n});\r\n\r\nconst originalAdd = baseStore.getState().add;\r\n\r\nbaseStore.setState((state) => ({\r\n  ...state,\r\n  add: (item) => {\r\n    const newItem = {\r\n      ...item,\r\n      createdAt: item.createdAt ?? toISODate(getCurrentDate()),\r\n    } satisfies Omit<PaymentType, 'systemId'>;\r\n    return originalAdd(newItem);\r\n  },\r\n}));\r\n\r\nexport const usePaymentTypeStore = baseStore;\r\n"],"names":[],"mappings":";;;;AAAA;AAGA;;;AAEA,MAAM,YAAY,IAAA,6IAAe,EAAc,EAAE,EAAE,iBAAiB;IAClE,iBAAiB;IACjB,aAAa;AACf;AAEA,MAAM,cAAc,UAAU,QAAQ,GAAG,GAAG;AAE5C,UAAU,QAAQ,CAAC,CAAC,QAAU,CAAC;QAC7B,GAAG,KAAK;QACR,KAAK,CAAC;YACJ,MAAM,UAAU;gBACd,GAAG,IAAI;gBACP,WAAW,KAAK,SAAS,IAAI,IAAA,oIAAS,EAAC,IAAA,yIAAc;YACvD;YACA,OAAO,YAAY;QACrB;IACF,CAAC;AAEM,MAAM,sBAAsB"}},
    {"offset": {"line": 1398, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/shipping/store.ts"],"sourcesContent":["import { createCrudStore } from '../../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { ShippingPartner } from './types';\r\nimport Fuse from 'fuse.js';\r\nimport type { SystemId } from '@/lib/id-types';\r\n\r\n// FIX: Replaced import from a non-existent module and replaced it with a mock function.\r\nconst connectPartner = async (partnerId: string, credentials: any): Promise<{ success: boolean; message: string }> => {\r\n    console.log(`Connecting to ${partnerId} with`, credentials);\r\n    // Simulate success for known partners if they have credentials.\r\n    if (credentials && Object.values(credentials).every(v => v)) {\r\n        return { success: true, message: 'Kết nối thành công.' };\r\n    }\r\n    return { success: false, message: 'Thông tin kết nối không hợp lệ.' };\r\n};\r\n\r\ntype ShippingPartnerStoreExtension = {\r\n    searchShippingPartners: (query: string, page: number, limit?: number | undefined) => Promise<{ items: { value: string; label: string }[], hasNextPage: boolean }>;\r\n    connect: (systemId: SystemId, credentials: Record<string, any>) => Promise<{ success: boolean; message: string }>;\r\n    disconnect: (systemId: SystemId) => void;\r\n};\r\n\r\nconst baseStore = createCrudStore<ShippingPartner>([], 'shipping-partners', {\r\n  // ⚠️ DEPRECATED: Store này không còn dùng để lưu credentials nữa\r\n  // Credentials giờ được lưu trong database\r\n  apiEndpoint: '/api/settings/data?type=shipping-partner',\r\n});\r\n\r\nconst fuse = new Fuse(baseStore.getState().data, {\r\n    keys: ['name', 'id', 'phone'],\r\n    threshold: 0.3,\r\n});\r\n\r\nconst storeExtension: ShippingPartnerStoreExtension = {\r\n    searchShippingPartners: async (query: string, page: number, limit: number = 20) => {\r\n        return new Promise(resolve => {\r\n            setTimeout(() => {\r\n                const allPartners = baseStore.getState().data;\r\n                const results = query ? fuse.search(query).map(r => r.item) : allPartners;\r\n                \r\n                const start = (page - 1) * limit;\r\n                const end = start + limit;\r\n                const paginatedItems = results.slice(start, end);\r\n\r\n                resolve({\r\n                    items: paginatedItems.map(p => ({ value: p.systemId, label: p.name })),\r\n                    hasNextPage: end < results.length,\r\n                });\r\n            }, 300);\r\n        });\r\n    },\r\n    connect: async (systemId: SystemId, credentials: Record<string, any>) => {\r\n        // ⚠️ DEPRECATED: Không nên dùng hàm này nữa\r\n        // Vui lòng cấu hình trong Settings → Đối tác vận chuyển\r\n        // Credentials sẽ được lưu vào shipping_partners_config\r\n        console.warn('[ShippingPartnerStore] connect() is deprecated. Use shipping_partners_config instead.');\r\n        \r\n        const partner = baseStore.getState().findById(systemId);\r\n        if (!partner) return { success: false, message: 'Không tìm thấy đối tác vận chuyển.' };\r\n        \r\n        console.log('[ShippingPartnerStore] Connecting partner:', { systemId, credentials });\r\n        \r\n        const result = { success: true, message: 'Kết nối thành công.' };\r\n        \r\n        if (result.success) {\r\n            baseStore.setState(state => {\r\n                const newData = state.data.map(p => \r\n                    p.systemId === systemId \r\n                    ? { ...p, isConnected: true, status: 'Đang hợp tác' as const, credentials } \r\n                    : p\r\n                );\r\n                \r\n                console.log('[ShippingPartnerStore] Updated partner:', newData.find(p => p.systemId === systemId));\r\n                \r\n                return { data: newData };\r\n            });\r\n        }\r\n        return result;\r\n    },\r\n    disconnect: (systemId: SystemId) => {\r\n        // ⚠️ DEPRECATED: Không nên dùng hàm này nữa\r\n        console.warn('[ShippingPartnerStore] disconnect() is deprecated. Use shipping_partners_config instead.');\r\n        \r\n        baseStore.setState(state => ({\r\n            data: state.data.map(p => \r\n                p.systemId === systemId \r\n                ? { ...p, isConnected: false, status: 'Ngừng hợp tác', credentials: {}, configuration: {} } \r\n                : p\r\n            )\r\n        }));\r\n    },\r\n};\r\n\r\nbaseStore.setState(storeExtension as any);\r\n\r\ntype ShippingPartnerStoreState = ReturnType<typeof baseStore.getState> & ShippingPartnerStoreExtension;\r\n\r\n// Export with proper Zustand hook typing\r\nexport const useShippingPartnerStore: {\r\n  (): ShippingPartnerStoreState;\r\n  <U>(selector: (state: ShippingPartnerStoreState) => U): U;\r\n  getState: () => ShippingPartnerStoreState;\r\n  setState: typeof baseStore.setState;\r\n  subscribe: typeof baseStore.subscribe;\r\n} = baseStore as any;\r\n"],"names":[],"mappings":";;;;AAAA;AAGA;;;AAGA,wFAAwF;AACxF,MAAM,iBAAiB,OAAO,WAAmB;IAC7C,QAAQ,GAAG,CAAC,CAAC,cAAc,EAAE,UAAU,KAAK,CAAC,EAAE;IAC/C,gEAAgE;IAChE,IAAI,eAAe,OAAO,MAAM,CAAC,aAAa,KAAK,CAAC,CAAA,IAAK,IAAI;QACzD,OAAO;YAAE,SAAS;YAAM,SAAS;QAAsB;IAC3D;IACA,OAAO;QAAE,SAAS;QAAO,SAAS;IAAkC;AACxE;AAQA,MAAM,YAAY,IAAA,6IAAe,EAAkB,EAAE,EAAE,qBAAqB;IAC1E,iEAAiE;IACjE,0CAA0C;IAC1C,aAAa;AACf;AAEA,MAAM,OAAO,IAAI,yJAAI,CAAC,UAAU,QAAQ,GAAG,IAAI,EAAE;IAC7C,MAAM;QAAC;QAAQ;QAAM;KAAQ;IAC7B,WAAW;AACf;AAEA,MAAM,iBAAgD;IAClD,wBAAwB,OAAO,OAAe,MAAc,QAAgB,EAAE;QAC1E,OAAO,IAAI,QAAQ,CAAA;YACf,WAAW;gBACP,MAAM,cAAc,UAAU,QAAQ,GAAG,IAAI;gBAC7C,MAAM,UAAU,QAAQ,KAAK,MAAM,CAAC,OAAO,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI,IAAI;gBAE9D,MAAM,QAAQ,CAAC,OAAO,CAAC,IAAI;gBAC3B,MAAM,MAAM,QAAQ;gBACpB,MAAM,iBAAiB,QAAQ,KAAK,CAAC,OAAO;gBAE5C,QAAQ;oBACJ,OAAO,eAAe,GAAG,CAAC,CAAA,IAAK,CAAC;4BAAE,OAAO,EAAE,QAAQ;4BAAE,OAAO,EAAE,IAAI;wBAAC,CAAC;oBACpE,aAAa,MAAM,QAAQ,MAAM;gBACrC;YACJ,GAAG;QACP;IACJ;IACA,SAAS,OAAO,UAAoB;QAChC,4CAA4C;QAC5C,wDAAwD;QACxD,uDAAuD;QACvD,QAAQ,IAAI,CAAC;QAEb,MAAM,UAAU,UAAU,QAAQ,GAAG,QAAQ,CAAC;QAC9C,IAAI,CAAC,SAAS,OAAO;YAAE,SAAS;YAAO,SAAS;QAAqC;QAErF,QAAQ,GAAG,CAAC,8CAA8C;YAAE;YAAU;QAAY;QAElF,MAAM,SAAS;YAAE,SAAS;YAAM,SAAS;QAAsB;QAE/D,IAAI,OAAO,OAAO,EAAE;YAChB,UAAU,QAAQ,CAAC,CAAA;gBACf,MAAM,UAAU,MAAM,IAAI,CAAC,GAAG,CAAC,CAAA,IAC3B,EAAE,QAAQ,KAAK,WACb;wBAAE,GAAG,CAAC;wBAAE,aAAa;wBAAM,QAAQ;wBAAyB;oBAAY,IACxE;gBAGN,QAAQ,GAAG,CAAC,2CAA2C,QAAQ,IAAI,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK;gBAExF,OAAO;oBAAE,MAAM;gBAAQ;YAC3B;QACJ;QACA,OAAO;IACX;IACA,YAAY,CAAC;QACT,4CAA4C;QAC5C,QAAQ,IAAI,CAAC;QAEb,UAAU,QAAQ,CAAC,CAAA,QAAS,CAAC;gBACzB,MAAM,MAAM,IAAI,CAAC,GAAG,CAAC,CAAA,IACjB,EAAE,QAAQ,KAAK,WACb;wBAAE,GAAG,CAAC;wBAAE,aAAa;wBAAO,QAAQ;wBAAiB,aAAa,CAAC;wBAAG,eAAe,CAAC;oBAAE,IACxF;YAEV,CAAC;IACL;AACJ;AAEA,UAAU,QAAQ,CAAC;AAKZ,MAAM,0BAMT"}},
    {"offset": {"line": 1510, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/sales/sales-management-store.ts"],"sourcesContent":["import { create } from 'zustand';\r\n\r\nexport type PrintCopiesOption = '1' | '2' | '3';\r\n\r\nexport type SalesManagementSettingsValues = {\r\n  allowCancelAfterExport: boolean;\r\n  allowNegativeOrder: boolean;\r\n  allowNegativeApproval: boolean;\r\n  allowNegativePacking: boolean;\r\n  allowNegativeStockOut: boolean;\r\n  printCopies: PrintCopiesOption;\r\n};\r\n\r\ninterface SalesManagementSettingsState extends SalesManagementSettingsValues {\r\n  initialized: boolean;\r\n  updateSetting: <K extends keyof SalesManagementSettingsValues>(key: K, value: SalesManagementSettingsValues[K]) => void;\r\n  reset: () => void;\r\n  loadFromAPI: () => Promise<void>;\r\n}\r\n\r\nconst defaultSettings: SalesManagementSettingsValues = {\r\n  allowCancelAfterExport: true,\r\n  allowNegativeOrder: true,\r\n  allowNegativeApproval: true,\r\n  allowNegativePacking: true,\r\n  allowNegativeStockOut: true,\r\n  printCopies: '1',\r\n};\r\n\r\n// API sync helper\r\nasync function syncToAPI(settings: Partial<SalesManagementSettingsValues>): Promise<boolean> {\r\n  try {\r\n    const response = await fetch('/api/settings/sales', {\r\n      method: 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify(settings),\r\n    });\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error('[Sales Management Settings API] sync error:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const useSalesManagementSettingsStore = create<SalesManagementSettingsState>()(\r\n  (set, get) => ({\r\n    ...defaultSettings,\r\n    initialized: false,\r\n    updateSetting: (key, value) => {\r\n      set((state) => ({ ...state, [key]: value }));\r\n      syncToAPI({ [key]: value }).catch(console.error);\r\n    },\r\n    reset: () => {\r\n      set(() => ({ ...defaultSettings }));\r\n      syncToAPI(defaultSettings).catch(console.error);\r\n    },\r\n    loadFromAPI: async () => {\r\n      if (get().initialized) return;\r\n      try {\r\n        const response = await fetch('/api/settings/sales');\r\n        if (response.ok) {\r\n          const json = await response.json();\r\n          const data = json.data || json;\r\n          if (data) {\r\n            set({ ...defaultSettings, ...data, initialized: true });\r\n          } else {\r\n            set({ initialized: true });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('[Sales Management Settings Store] loadFromAPI error:', error);\r\n      }\r\n    },\r\n  })\r\n);\r\n\r\nexport const salesManagementDefaultSettings = defaultSettings;\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAoBA,MAAM,kBAAiD;IACrD,wBAAwB;IACxB,oBAAoB;IACpB,uBAAuB;IACvB,sBAAsB;IACtB,uBAAuB;IACvB,aAAa;AACf;AAEA,kBAAkB;AAClB,eAAe,UAAU,QAAgD;IACvE,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,uBAAuB;YAClD,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;QACvB;QACA,OAAO,SAAS,EAAE;IACpB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+CAA+C;QAC7D,OAAO;IACT;AACF;AAEO,MAAM,kCAAkC,IAAA,qJAAM,IACnD,CAAC,KAAK,MAAQ,CAAC;QACb,GAAG,eAAe;QAClB,aAAa;QACb,eAAe,CAAC,KAAK;YACnB,IAAI,CAAC,QAAU,CAAC;oBAAE,GAAG,KAAK;oBAAE,CAAC,IAAI,EAAE;gBAAM,CAAC;YAC1C,UAAU;gBAAE,CAAC,IAAI,EAAE;YAAM,GAAG,KAAK,CAAC,QAAQ,KAAK;QACjD;QACA,OAAO;YACL,IAAI,IAAM,CAAC;oBAAE,GAAG,eAAe;gBAAC,CAAC;YACjC,UAAU,iBAAiB,KAAK,CAAC,QAAQ,KAAK;QAChD;QACA,aAAa;YACX,IAAI,MAAM,WAAW,EAAE;YACvB,IAAI;gBACF,MAAM,WAAW,MAAM,MAAM;gBAC7B,IAAI,SAAS,EAAE,EAAE;oBACf,MAAM,OAAO,MAAM,SAAS,IAAI;oBAChC,MAAM,OAAO,KAAK,IAAI,IAAI;oBAC1B,IAAI,MAAM;wBACR,IAAI;4BAAE,GAAG,eAAe;4BAAE,GAAG,IAAI;4BAAE,aAAa;wBAAK;oBACvD,OAAO;wBACL,IAAI;4BAAE,aAAa;wBAAK;oBAC1B;gBACF;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,wDAAwD;YACxE;QACF;IACF,CAAC;AAGI,MAAM,iCAAiC"}},
    {"offset": {"line": 1592, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/branches/store.ts"],"sourcesContent":["import { createCrudStore, CrudState } from '../../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { Branch } from './types';\r\nimport { SystemId } from '../../../lib/id-types';\r\n\r\nexport interface BranchStoreState extends CrudState<Branch> {\r\n  setDefault: (systemId: SystemId) => void;\r\n}\r\n\r\nconst baseStore = createCrudStore<Branch>([], 'branches', {\r\n  apiEndpoint: '/api/branches',\r\n});\r\n\r\nconst setDefault = (systemId: SystemId) => {\r\n  baseStore.setState(state => ({\r\n    data: state.data.map(branch => ({\r\n      ...branch,\r\n      isDefault: branch.systemId === systemId,\r\n    })),\r\n  }));\r\n};\r\n\r\nconst originalAdd = baseStore.getState().add;\r\nconst originalUpdate = baseStore.getState().update;\r\n\r\nbaseStore.setState({\r\n  add: (item: Omit<Branch, 'systemId'>) => {\r\n    const result = originalAdd(item);\r\n    if ((item as Branch).isDefault) {\r\n      setDefault(result.systemId);\r\n    }\r\n    return result;\r\n  },\r\n  update: (systemId: SystemId, updatedItem: Branch) => {\r\n    originalUpdate(systemId, updatedItem);\r\n    if (updatedItem.isDefault) {\r\n      setDefault(systemId);\r\n    }\r\n  },\r\n} as Partial<BranchStoreState>);\r\n\r\nconst enhanceState = (state: CrudState<Branch>): BranchStoreState => ({\r\n  ...state,\r\n  setDefault,\r\n});\r\n\r\ntype BranchStoreHook = (() => BranchStoreState) & {\r\n  getState: () => BranchStoreState;\r\n};\r\n\r\nconst useBranchStoreBase = (() => enhanceState(baseStore())) as BranchStoreHook;\r\n\r\nuseBranchStoreBase.getState = () => enhanceState(baseStore.getState());\r\n\r\nexport const useBranchStore = useBranchStoreBase;\r\n"],"names":[],"mappings":";;;;AAAA;;AASA,MAAM,YAAY,IAAA,6IAAe,EAAS,EAAE,EAAE,YAAY;IACxD,aAAa;AACf;AAEA,MAAM,aAAa,CAAC;IAClB,UAAU,QAAQ,CAAC,CAAA,QAAS,CAAC;YAC3B,MAAM,MAAM,IAAI,CAAC,GAAG,CAAC,CAAA,SAAU,CAAC;oBAC9B,GAAG,MAAM;oBACT,WAAW,OAAO,QAAQ,KAAK;gBACjC,CAAC;QACH,CAAC;AACH;AAEA,MAAM,cAAc,UAAU,QAAQ,GAAG,GAAG;AAC5C,MAAM,iBAAiB,UAAU,QAAQ,GAAG,MAAM;AAElD,UAAU,QAAQ,CAAC;IACjB,KAAK,CAAC;QACJ,MAAM,SAAS,YAAY;QAC3B,IAAI,AAAC,KAAgB,SAAS,EAAE;YAC9B,WAAW,OAAO,QAAQ;QAC5B;QACA,OAAO;IACT;IACA,QAAQ,CAAC,UAAoB;QAC3B,eAAe,UAAU;QACzB,IAAI,YAAY,SAAS,EAAE;YACzB,WAAW;QACb;IACF;AACF;AAEA,MAAM,eAAe,CAAC,QAA+C,CAAC;QACpE,GAAG,KAAK;QACR;IACF,CAAC;AAMD,MAAM,qBAAsB,IAAM,aAAa;AAE/C,mBAAmB,QAAQ,GAAG,IAAM,aAAa,UAAU,QAAQ;AAE5D,MAAM,iBAAiB"}},
    {"offset": {"line": 1640, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/departments/store.ts"],"sourcesContent":["import { createCrudStore } from '../../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { Department } from './types';\r\n\r\nexport const useDepartmentStore = createCrudStore<Department>([], 'departments', {\r\n  apiEndpoint: '/api/departments',\r\n});\r\n"],"names":[],"mappings":";;;;AAAA;;AAIO,MAAM,qBAAqB,IAAA,6IAAe,EAAa,EAAE,EAAE,eAAe;IAC/E,aAAa;AACf"}},
    {"offset": {"line": 1656, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/job-titles/store.ts"],"sourcesContent":["import { createCrudStore } from '../../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { JobTitle } from './types';\r\n\r\nexport const useJobTitleStore = createCrudStore<JobTitle>([], 'job-titles', {\r\n  apiEndpoint: '/api/job-titles',\r\n});\r\n"],"names":[],"mappings":";;;;AAAA;;AAIO,MAAM,mBAAmB,IAAA,6IAAe,EAAW,EAAE,EAAE,cAAc;IAC1E,aAAa;AACf"}},
    {"offset": {"line": 1672, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/penalties/store.ts"],"sourcesContent":["import { createCrudStore } from '../../../lib/store-factory';\r\n// REMOVED: import { data as initialData, penaltyTypesData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { Penalty, PenaltyType } from './types';\r\n\r\nexport const usePenaltyStore = createCrudStore<Penalty>([], 'penalties', {\r\n  businessIdField: 'id',\r\n  apiEndpoint: '/api/settings/data?type=penalty',\r\n});\r\n\r\nexport const usePenaltyTypeStore = createCrudStore<PenaltyType>([], 'penalties', {\r\n  businessIdField: 'id',\r\n  apiEndpoint: '/api/settings/data?type=penalty-type',\r\n});\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAIO,MAAM,kBAAkB,IAAA,6IAAe,EAAU,EAAE,EAAE,aAAa;IACvE,iBAAiB;IACjB,aAAa;AACf;AAEO,MAAM,sBAAsB,IAAA,6IAAe,EAAc,EAAE,EAAE,aAAa;IAC/E,iBAAiB;IACjB,aAAa;AACf"}},
    {"offset": {"line": 1695, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/employees/employee-settings-store.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport type { EmployeeSettings, LeaveType, SalaryComponent, WorkShift } from './types';\r\nimport { getCurrentUserSystemId } from '../../../contexts/auth-context';\r\nimport { generateSystemId, getMaxBusinessIdCounter, getMaxSystemIdCounter, findNextAvailableBusinessId } from '../../../lib/id-utils';\r\nimport { getPrefix, type EntityType } from '../../../lib/smart-prefix';\r\nimport { getEntityConfig } from '../../../lib/id-config';\r\nimport { asBusinessId, asSystemId, type BusinessId, type SystemId } from '@/lib/id-types';\r\n\r\nconst SETTINGS_ENTITY_MAP = {\r\n  workShifts: 'work-shifts',\r\n  leaveTypes: 'leave-types',\r\n  salaryComponents: 'salary-components',\r\n} as const;\r\n\r\ntype SettingsEntityKey = keyof typeof SETTINGS_ENTITY_MAP;\r\ntype SettingsEntityType = (typeof SETTINGS_ENTITY_MAP)[SettingsEntityKey];\r\n\r\ntype CounterState = {\r\n  systemId: number;\r\n  businessId: number;\r\n};\r\n\r\ntype SettingsCounters = Record<SettingsEntityType, CounterState>;\r\n\r\nconst defaultSettings: EmployeeSettings = {\r\n  workStartTime: '08:30',\r\n  workEndTime: '18:00',\r\n  lunchBreakDuration: 90, // 1.5 giờ = 90 phút\r\n  lunchBreakStart: '12:00',\r\n  lunchBreakEnd: '13:30',\r\n  workingDays: [1, 2, 3, 4, 5, 6], // Thứ 2 - Thứ 7 (Mon-Sat)\r\n  workShifts: [\r\n    {\r\n      systemId: asSystemId('WSHIFT000001'),\r\n      id: asBusinessId('CA000001'),\r\n      name: 'Ca hành chính',\r\n      startTime: '08:30',\r\n      endTime: '18:00',\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('WSHIFT000002'),\r\n      id: asBusinessId('CA000002'),\r\n      name: 'Ca tối',\r\n      startTime: '14:00',\r\n      endTime: '22:00',\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n  ],\r\n  otHourlyRate: 25000,  // 25k/giờ làm thêm ngày thường\r\n  otRateWeekend: 1.5,   // Hệ số x1.5 cuối tuần\r\n  otRateHoliday: 3,     // Hệ số x3 ngày lễ\r\n  allowedLateMinutes: 5, // Sau 5 phút mới tính là đi trễ\r\n  latePenaltyTiers: [\r\n    { fromMinutes: 5, toMinutes: 10, amount: 10000 },   // 5-10 phút: 10k\r\n    { fromMinutes: 10, toMinutes: 30, amount: 20000 },  // 10-30 phút: 20k\r\n    { fromMinutes: 30, toMinutes: 60, amount: 50000 },  // 30-60 phút: 50k\r\n    { fromMinutes: 60, toMinutes: null, amount: 100000 }, // >60 phút: 100k\r\n  ],\r\n  earlyLeavePenaltyTiers: [\r\n    { fromMinutes: 5, toMinutes: 10, amount: 10000 },\r\n    { fromMinutes: 10, toMinutes: 30, amount: 20000 },\r\n    { fromMinutes: 30, toMinutes: 60, amount: 50000 },\r\n    { fromMinutes: 60, toMinutes: null, amount: 100000 },\r\n  ],\r\n  leaveTypes: [\r\n    {\r\n      systemId: asSystemId('LEAVETYPE000001'),\r\n      id: asBusinessId('LP000001'),\r\n      name: 'Nghỉ phép năm',\r\n      numberOfDays: 12,\r\n      isPaid: true,\r\n      requiresAttachment: false,\r\n      applicableGender: 'All',\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('LEAVETYPE000002'),\r\n      id: asBusinessId('LP000002'),\r\n      name: 'Nghỉ bệnh',\r\n      numberOfDays: 7,\r\n      isPaid: true,\r\n      requiresAttachment: true,\r\n      applicableGender: 'All',\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n  ],\r\n  baseAnnualLeaveDays: 12,\r\n  annualLeaveSeniorityBonus: {\r\n    years: 5,\r\n    additionalDays: 1,\r\n  },\r\n  allowRollover: false,\r\n  rolloverExpirationDate: '03-31',\r\n  salaryComponents: [\r\n    // =============================================\r\n    // NHÓM THU NHẬP (EARNINGS)\r\n    // =============================================\r\n    {\r\n      systemId: asSystemId('SALCOMP000001'),\r\n      id: asBusinessId('SC000001'),\r\n      name: 'Lương cơ bản',\r\n      description: 'Lương theo ngày công thực tế = Lương HĐ × (Ngày công / Ngày chuẩn)',\r\n      category: 'earning',\r\n      type: 'formula',\r\n      formula: 'baseSalary * (workDays / standardWorkDays)',\r\n      taxable: true,\r\n      partOfSocialInsurance: true,\r\n      isActive: true,\r\n      sortOrder: 1,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000002'),\r\n      id: asBusinessId('SC000002'),\r\n      name: 'Phụ cấp ăn trưa',\r\n      description: 'Phụ cấp theo ngày công thực tế = Ngày công × Mức tiền/ngày (không tính thuế)',\r\n      category: 'earning',\r\n      type: 'formula',\r\n      formula: 'workDays * mealAllowancePerDay',\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 2,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000003'),\r\n      id: asBusinessId('SC000003'),\r\n      name: 'Phụ cấp xăng xe',\r\n      description: 'Phụ cấp đi lại, xăng xe hàng tháng',\r\n      category: 'earning',\r\n      type: 'fixed',\r\n      amount: 500000,\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 3,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000004'),\r\n      id: asBusinessId('SC000004'),\r\n      name: 'Phụ cấp điện thoại',\r\n      description: 'Phụ cấp liên lạc, điện thoại công việc',\r\n      category: 'earning',\r\n      type: 'fixed',\r\n      amount: 300000,\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 4,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000005'),\r\n      id: asBusinessId('SC000005'),\r\n      name: 'Phụ cấp chức vụ',\r\n      description: 'Phụ cấp trách nhiệm theo chức vụ quản lý',\r\n      category: 'earning',\r\n      type: 'fixed',\r\n      amount: 2000000,\r\n      taxable: true,\r\n      partOfSocialInsurance: true,\r\n      isActive: true,\r\n      sortOrder: 5,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000006'),\r\n      id: asBusinessId('SC000006'),\r\n      name: 'Phụ cấp thâm niên',\r\n      description: 'Phụ cấp theo số năm làm việc tại công ty',\r\n      category: 'earning',\r\n      type: 'fixed',\r\n      amount: 500000,\r\n      taxable: true,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 6,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000007'),\r\n      id: asBusinessId('SC000007'),\r\n      name: 'Phụ cấp độc hại',\r\n      description: 'Phụ cấp cho công việc trong môi trường độc hại, nguy hiểm',\r\n      category: 'earning',\r\n      type: 'fixed',\r\n      amount: 1000000,\r\n      taxable: true,\r\n      partOfSocialInsurance: true,\r\n      isActive: false,\r\n      sortOrder: 7,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000008'),\r\n      id: asBusinessId('SC000008'),\r\n      name: 'Thưởng chuyên cần',\r\n      description: 'Thưởng đi làm đầy đủ, không nghỉ phép trong tháng',\r\n      category: 'earning',\r\n      type: 'fixed',\r\n      amount: 500000,\r\n      taxable: true,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 8,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000009'),\r\n      id: asBusinessId('SC000009'),\r\n      name: 'Thưởng KPI',\r\n      description: 'Thưởng hoàn thành chỉ tiêu KPI tháng',\r\n      category: 'earning',\r\n      type: 'formula',\r\n      formula: '[LUONG_CO_BAN] * 0.1',\r\n      taxable: true,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 9,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    // =============================================\r\n    // NHÓM LÀM THÊM GIỜ (OT) - Chi tiết theo loại ngày\r\n    // =============================================\r\n    {\r\n      systemId: asSystemId('SALCOMP000010'),\r\n      id: asBusinessId('SC000010'),\r\n      name: 'Làm thêm ngày thường',\r\n      description: 'Tiền làm thêm sau giờ tan làm (18:00) các ngày trong tuần. Công thức: Giờ OT x Tiền/giờ',\r\n      category: 'earning',\r\n      type: 'formula',\r\n      formula: 'otPayWeekday',\r\n      taxable: true,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 10,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000020'),\r\n      id: asBusinessId('SC000020'),\r\n      name: 'Làm thêm cuối tuần',\r\n      description: 'Tiền làm thêm thứ 7 & Chủ nhật. Công thức: Giờ OT x Tiền/giờ x Hệ số cuối tuần (1.5)',\r\n      category: 'earning',\r\n      type: 'formula',\r\n      formula: 'otPayWeekend',\r\n      taxable: true,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 11,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000021'),\r\n      id: asBusinessId('SC000021'),\r\n      name: 'Làm thêm ngày lễ',\r\n      description: 'Tiền làm thêm các ngày lễ. Công thức: Giờ OT x Tiền/giờ x Hệ số ngày lễ (3)',\r\n      category: 'earning',\r\n      type: 'formula',\r\n      formula: 'otPayHoliday',\r\n      taxable: true,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 12,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000011'),\r\n      id: asBusinessId('SC000011'),\r\n      name: 'Hoa hồng bán hàng',\r\n      description: 'Hoa hồng theo doanh số bán hàng (áp dụng cho bộ phận Kinh doanh)',\r\n      category: 'earning',\r\n      type: 'fixed',\r\n      amount: 0,\r\n      taxable: true,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 13,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    // =============================================\r\n    // NHÓM KHẤU TRỪ (DEDUCTIONS)\r\n    // =============================================\r\n    {\r\n      systemId: asSystemId('SALCOMP000012'),\r\n      id: asBusinessId('SC000012'),\r\n      name: 'Khấu trừ đi trễ',\r\n      description: 'Trừ lương theo số lần/phút đi trễ trong tháng',\r\n      category: 'deduction',\r\n      type: 'fixed',\r\n      amount: 0,\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 20,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000013'),\r\n      id: asBusinessId('SC000013'),\r\n      name: 'Khấu trừ nghỉ không phép',\r\n      description: 'Trừ lương theo số ngày nghỉ không phép',\r\n      category: 'deduction',\r\n      type: 'formula',\r\n      formula: '[NGAY_NGHI_KHONG_PHEP] * ([LUONG_CO_BAN] / [NGAY_CONG_CHUAN])',\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 21,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000014'),\r\n      id: asBusinessId('SC000014'),\r\n      name: 'Tạm ứng lương',\r\n      description: 'Khấu trừ khoản tạm ứng lương đã nhận trước',\r\n      category: 'deduction',\r\n      type: 'fixed',\r\n      amount: 0,\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 22,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000015'),\r\n      id: asBusinessId('SC000015'),\r\n      name: 'Khấu trừ công nợ',\r\n      description: 'Khấu trừ các khoản nợ công ty (vay, mượn...)',\r\n      category: 'deduction',\r\n      type: 'fixed',\r\n      amount: 0,\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: false,\r\n      sortOrder: 23,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    // =============================================\r\n    // NHÓM ĐÓNG GÓP (CONTRIBUTIONS) - Tự động tính\r\n    // =============================================\r\n    {\r\n      systemId: asSystemId('SALCOMP000016'),\r\n      id: asBusinessId('SC000016'),\r\n      name: 'BHXH (NV đóng)',\r\n      description: 'Bảo hiểm xã hội phần người lao động đóng (8%)',\r\n      category: 'contribution',\r\n      type: 'formula',\r\n      formula: '[LUONG_DONG_BHXH] * 0.08',\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 30,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000017'),\r\n      id: asBusinessId('SC000017'),\r\n      name: 'BHYT (NV đóng)',\r\n      description: 'Bảo hiểm y tế phần người lao động đóng (1.5%)',\r\n      category: 'contribution',\r\n      type: 'formula',\r\n      formula: '[LUONG_DONG_BHXH] * 0.015',\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 31,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000018'),\r\n      id: asBusinessId('SC000018'),\r\n      name: 'BHTN (NV đóng)',\r\n      description: 'Bảo hiểm thất nghiệp phần người lao động đóng (1%)',\r\n      category: 'contribution',\r\n      type: 'formula',\r\n      formula: '[LUONG_DONG_BHXH] * 0.01',\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 32,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000019'),\r\n      id: asBusinessId('SC000019'),\r\n      name: 'Công đoàn phí',\r\n      description: 'Phí công đoàn hàng tháng (1% lương cơ bản)',\r\n      category: 'contribution',\r\n      type: 'formula',\r\n      formula: '[LUONG_CO_BAN] * 0.01',\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: false,\r\n      sortOrder: 33,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n  ],\r\n  payrollCycle: 'monthly',\r\n  payday: 5,\r\n  payrollLockDate: 5,\r\n  \r\n  // =============================================\r\n  // CÀI ĐẶT BẢO HIỂM (Luật BHXH 2024)\r\n  // =============================================\r\n  insuranceRates: {\r\n    socialInsurance: {\r\n      employeeRate: 8,      // BHXH NV đóng 8%\r\n      employerRate: 17.5,   // BHXH DN đóng 17.5%\r\n    },\r\n    healthInsurance: {\r\n      employeeRate: 1.5,    // BHYT NV đóng 1.5%\r\n      employerRate: 3,      // BHYT DN đóng 3%\r\n    },\r\n    unemploymentInsurance: {\r\n      employeeRate: 1,      // BHTN NV đóng 1%\r\n      employerRate: 1,      // BHTN DN đóng 1%\r\n    },\r\n    // Trần đóng BHXH = 20 x lương cơ sở (từ 1/7/2024)\r\n    insuranceSalaryCap: 46800000,   // 20 x 2,340,000\r\n    baseSalaryReference: 2340000,    // Lương cơ sở từ 1/7/2024\r\n  },\r\n  \r\n  // =============================================\r\n  // CÀI ĐẶT THUẾ TNCN (Luật thuế TNCN hiện hành)\r\n  // =============================================\r\n  taxSettings: {\r\n    personalDeduction: 11000000,    // Giảm trừ bản thân 11 triệu/tháng\r\n    dependentDeduction: 4400000,    // Giảm trừ mỗi người phụ thuộc 4.4 triệu/tháng\r\n    // Biểu thuế lũy tiến từng phần (theo thu nhập tính thuế/tháng)\r\n    taxBrackets: [\r\n      { fromAmount: 0, toAmount: 5000000, rate: 5 },\r\n      { fromAmount: 5000000, toAmount: 10000000, rate: 10 },\r\n      { fromAmount: 10000000, toAmount: 18000000, rate: 15 },\r\n      { fromAmount: 18000000, toAmount: 32000000, rate: 20 },\r\n      { fromAmount: 32000000, toAmount: 52000000, rate: 25 },\r\n      { fromAmount: 52000000, toAmount: 80000000, rate: 30 },\r\n      { fromAmount: 80000000, toAmount: null, rate: 35 },\r\n    ],\r\n  },\r\n  \r\n  // =============================================\r\n  // LƯƠNG TỐI THIỂU VÙNG (NĐ 74/2024/NĐ-CP từ 1/7/2024)\r\n  // =============================================\r\n  minimumWage: {\r\n    region1: 4960000,   // Vùng I\r\n    region2: 4410000,   // Vùng II\r\n    region3: 3860000,   // Vùng III\r\n    region4: 3450000,   // Vùng IV\r\n  },\r\n  \r\n  // Số ngày công chuẩn trong tháng\r\n  standardWorkDays: 26,\r\n  \r\n  // Phụ cấp ăn trưa theo ngày công\r\n  mealAllowancePerDay: 30000, // 30k/ngày\r\n};\r\n\r\ntype EmployeeSettingsState = {\r\n  settings: EmployeeSettings;\r\n  counters: SettingsCounters;\r\n  initialized: boolean;\r\n  setSettings: (settings: EmployeeSettings) => void;\r\n  getShiftBySystemId: (systemId: SystemId) => WorkShift | undefined;\r\n  getLeaveTypes: () => LeaveType[];\r\n  getSalaryComponents: () => SalaryComponent[];\r\n  getDefaultPayrollWindow: () => {\r\n    cycle: EmployeeSettings['payrollCycle'];\r\n    payday: number;\r\n    lockDate: number;\r\n  };\r\n  loadFromAPI: () => Promise<void>;\r\n};\r\n\r\nconst cloneSettings = (payload?: EmployeeSettings): EmployeeSettings => ({\r\n  ...defaultSettings,\r\n  ...payload,\r\n  annualLeaveSeniorityBonus: {\r\n    ...defaultSettings.annualLeaveSeniorityBonus,\r\n    ...(payload?.annualLeaveSeniorityBonus ?? {}),\r\n  },\r\n  workShifts: (payload?.workShifts ?? defaultSettings.workShifts).map((shift) => ({ ...shift })),\r\n  leaveTypes: (payload?.leaveTypes ?? defaultSettings.leaveTypes).map((type) => ({ ...type })),\r\n  salaryComponents: (payload?.salaryComponents ?? defaultSettings.salaryComponents).map((component) => ({ ...component })),\r\n});\r\n\r\nconst computeCounter = <T extends { systemId?: SystemId; id?: BusinessId }>(\r\n  items: T[],\r\n  entityType: EntityType\r\n): CounterState => {\r\n  const config = getEntityConfig(entityType);\r\n  const systemItems = items\r\n    .filter((item): item is T & { systemId: SystemId } => Boolean(item.systemId))\r\n    .map(({ systemId }) => ({ systemId }));\r\n  const businessItems = items\r\n    .filter((item): item is T & { id: BusinessId } => Boolean(item.id))\r\n    .map(({ id }) => ({ id }));\r\n  return {\r\n    systemId: getMaxSystemIdCounter(systemItems, config.systemIdPrefix),\r\n    businessId: getMaxBusinessIdCounter(businessItems, getPrefix(entityType)),\r\n  };\r\n};\r\n\r\nconst buildCounters = (settings: EmployeeSettings): SettingsCounters => ({\r\n  'work-shifts': computeCounter(settings.workShifts, 'work-shifts'),\r\n  'leave-types': computeCounter(settings.leaveTypes, 'leave-types'),\r\n  'salary-components': computeCounter(settings.salaryComponents, 'salary-components'),\r\n});\r\n\r\ntype BaseSettingsEntity = {\r\n  systemId?: SystemId;\r\n  id?: BusinessId;\r\n  createdAt?: string;\r\n  createdBy?: SystemId;\r\n  updatedAt?: string;\r\n  updatedBy?: SystemId;\r\n  applicableDepartmentSystemIds?: SystemId[];\r\n};\r\n\r\nconst normalizeCollection = <T extends BaseSettingsEntity>(\r\n  items: T[],\r\n  entityType: SettingsEntityType,\r\n  counters: SettingsCounters,\r\n  currentUser?: SystemId\r\n): { records: T[]; counters: SettingsCounters } => {\r\n  let systemCounter = counters[entityType]?.systemId ?? 0;\r\n  let businessCounter = counters[entityType]?.businessId ?? 0;\r\n  const prefix = getPrefix(entityType);\r\n  const config = getEntityConfig(entityType);\r\n  const allKnownIds = new Set<string>(\r\n    items\r\n      .map((item) => item.id?.toUpperCase())\r\n      .filter((id): id is string => Boolean(id))\r\n  );\r\n  const usedIds = new Set<string>();\r\n  const now = new Date().toISOString();\r\n\r\n  const records = items.map((item) => {\r\n    let systemId = item.systemId;\r\n    const hasValidSystemId = Boolean(systemId && systemId.startsWith(config.systemIdPrefix));\r\n    const isNew = !hasValidSystemId;\r\n    if (!hasValidSystemId) {\r\n      systemCounter += 1;\r\n      systemId = asSystemId(generateSystemId(entityType, systemCounter));\r\n    }\r\n\r\n    let businessIdString = item.id ? String(item.id).toUpperCase() : undefined;\r\n    const hasValidBusinessId = Boolean(businessIdString && businessIdString.startsWith(prefix));\r\n    if (!hasValidBusinessId || (businessIdString && usedIds.has(businessIdString))) {\r\n      const { nextId, updatedCounter } = findNextAvailableBusinessId(prefix, Array.from(allKnownIds), businessCounter);\r\n      businessIdString = nextId;\r\n      businessCounter = updatedCounter;\r\n    }\r\n    if (!businessIdString) {\r\n      businessCounter += 1;\r\n      businessIdString = `${prefix}${String(businessCounter).padStart(config.digitCount, '0')}`;\r\n    }\r\n\r\n    allKnownIds.add(businessIdString);\r\n    usedIds.add(businessIdString);\r\n\r\n    const resolvedSystemId = systemId ?? asSystemId(generateSystemId(entityType, systemCounter));\r\n    const resolvedBusinessId = asBusinessId(businessIdString);\r\n\r\n    const createdAt = item.createdAt ?? now;\r\n    const createdBy = item.createdBy ?? (isNew && currentUser ? currentUser : item.createdBy);\r\n\r\n    return {\r\n      ...item,\r\n      systemId: resolvedSystemId,\r\n      id: resolvedBusinessId,\r\n      applicableDepartmentSystemIds: item.applicableDepartmentSystemIds ?? [],\r\n      createdAt,\r\n      createdBy,\r\n      updatedAt: now,\r\n      updatedBy: currentUser ?? item.updatedBy,\r\n    } as T;\r\n  });\r\n\r\n  return {\r\n    records,\r\n    counters: {\r\n      ...counters,\r\n      [entityType]: {\r\n        systemId: systemCounter,\r\n        businessId: businessCounter,\r\n      },\r\n    },\r\n  };\r\n};\r\n\r\nconst normalizeSettings = (\r\n  incoming: EmployeeSettings,\r\n  counters: SettingsCounters,\r\n  currentUser?: SystemId\r\n): { settings: EmployeeSettings; counters: SettingsCounters } => {\r\n  let nextCounters = { ...counters };\r\n  const normalizedShifts = normalizeCollection(incoming.workShifts, 'work-shifts', nextCounters, currentUser);\r\n  nextCounters = normalizedShifts.counters;\r\n  const normalizedLeaves = normalizeCollection(incoming.leaveTypes, 'leave-types', nextCounters, currentUser);\r\n  nextCounters = normalizedLeaves.counters;\r\n  const normalizedComponents = normalizeCollection(incoming.salaryComponents, 'salary-components', nextCounters, currentUser);\r\n\r\n  return {\r\n    settings: {\r\n      ...incoming,\r\n      workShifts: normalizedShifts.records,\r\n      leaveTypes: normalizedLeaves.records,\r\n      salaryComponents: normalizedComponents.records,\r\n    },\r\n    counters: normalizedComponents.counters,\r\n  };\r\n};\r\n\r\nconst buildInitialState = () => {\r\n  const cloned = cloneSettings(defaultSettings);\r\n  const counters = buildCounters(cloned);\r\n  return normalizeSettings(cloned, counters);\r\n};\r\n\r\nconst initialState = buildInitialState();\r\n\r\n// API sync helper\r\nasync function syncSettingsToAPI(settings: EmployeeSettings): Promise<boolean> {\r\n  try {\r\n    const response = await fetch('/api/settings/employees', {\r\n      method: 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify(settings),\r\n    });\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error('[Employee Settings API] sync error:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const useEmployeeSettingsStore = create<EmployeeSettingsState>()(\r\n  (set, get) => ({\r\n      settings: initialState.settings,\r\n      counters: initialState.counters,\r\n      initialized: false,\r\n      setSettings: (payload) => {\r\n        const cloned = cloneSettings(payload);\r\n        const currentUser = getCurrentUserSystemId();\r\n        const normalized = normalizeSettings(\r\n          cloned,\r\n          get().counters,\r\n          currentUser ? asSystemId(currentUser) : undefined\r\n        );\r\n        set(normalized);\r\n        \r\n        // Sync to API\r\n        syncSettingsToAPI(normalized.settings).catch(console.error);\r\n      },\r\n      getShiftBySystemId: (systemId) => get().settings.workShifts.find((shift) => shift.systemId === systemId),\r\n      getLeaveTypes: () => get().settings.leaveTypes,\r\n      getSalaryComponents: () => get().settings.salaryComponents,\r\n      getDefaultPayrollWindow: () => {\r\n        const current = get().settings;\r\n        return {\r\n          cycle: current.payrollCycle,\r\n          payday: current.payday,\r\n          lockDate: current.payrollLockDate,\r\n        };\r\n      },\r\n      \r\n      loadFromAPI: async () => {\r\n        if (get().initialized) return;\r\n        \r\n        try {\r\n          const response = await fetch('/api/settings/employees');\r\n          if (response.ok) {\r\n            const json = await response.json();\r\n            const settings = json.data || json.settings;\r\n            if (settings) {\r\n              const cloned = cloneSettings(settings);\r\n              const counters = buildCounters(cloned);\r\n              const normalized = normalizeSettings(cloned, counters);\r\n              set({ ...normalized, initialized: true });\r\n            } else {\r\n              set({ initialized: true });\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('[Employee Settings Store] loadFromAPI error:', error);\r\n        }\r\n      },\r\n    })\r\n);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2402, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/units/store.ts"],"sourcesContent":["import { createCrudStore } from '../../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { Unit } from './types';\r\n\r\nexport const useUnitStore = createCrudStore<Unit>([], 'units', {\r\n  apiEndpoint: '/api/settings/data?type=unit',\r\n});\r\n"],"names":[],"mappings":";;;;AAAA;;AAIO,MAAM,eAAe,IAAA,6IAAe,EAAO,EAAE,EAAE,SAAS;IAC7D,aAAa;AACf"}},
    {"offset": {"line": 2418, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/system/id-counter-settings-page.tsx"],"sourcesContent":["/**\r\n * ID Counter Settings Page\r\n * \r\n * Centralized management for:\r\n * - Entity prefixes & formats\r\n * - Counter values & next IDs\r\n * - ID validation & testing\r\n * - Statistics & monitoring\r\n * \r\n * Ensures:\r\n * ✅ Correct prefix for all entities\r\n * ✅ No duplicate IDs\r\n * ✅ Proper counter increments\r\n * ✅ Integration with breadcrumb & router\r\n */\r\n\r\n'use client'\r\n\r\nimport * as React from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../../../components/ui/card';\r\nimport { Badge } from '../../../components/ui/badge';\r\nimport { Button } from '../../../components/ui/button';\r\nimport { Input } from '../../../components/ui/input';\r\nimport { Label } from '../../../components/ui/label';\r\nimport { \r\n  Table, \r\n  TableBody, \r\n  TableCell, \r\n  TableHead, \r\n  TableHeader, \r\n  TableRow \r\n} from '../../../components/ui/table';\r\nimport { \r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '../../../components/ui/dialog';\r\nimport {\r\n  Tabs,\r\n  TabsContent,\r\n  TabsList,\r\n  TabsTrigger,\r\n} from '../../../components/ui/tabs';\r\nimport { \r\n  Settings, \r\n  RefreshCw, \r\n  AlertTriangle, \r\n  CheckCircle2, \r\n  Info,\r\n  Search,\r\n  TrendingUp,\r\n  Hash,\r\n  ArrowLeft,\r\n  Copy,\r\n  Eye,\r\n  Download,\r\n  Upload,\r\n  AlertCircle,\r\n} from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { useSettingsPageHeader } from '../use-settings-page-header';\r\nimport { \r\n  ID_CONFIG, \r\n  getEntityCategories, \r\n  type EntityType,\r\n  type EntityIDConfig,\r\n} from '../../../lib/id-config';\r\nimport { findNextAvailableBusinessId } from '../../../lib/id-utils';\r\n\r\n// ✅ Import reusable components\r\nimport { StatsCard } from '../../../components/settings/stats-card';\r\nimport { CounterTable, type CounterTableRow } from '../../../components/settings/counter-table';\r\nimport { IDTester } from '../../../components/settings/id-tester';\r\n\r\n// Import stores (only those that exist and have store-factory)\r\nimport { useEmployeeStore } from '../../employees/store';\r\nimport { useCustomerStore } from '../../customers/store';\r\nimport { useComplaintStore } from '../../complaints/store';\r\nimport { useWarrantyStore } from '../../warranty/store';\r\nimport { useOrderStore } from '../../orders/store';\r\nimport { useProductStore } from '../../products/store';\r\nimport { useBranchStore } from '../branches/store';\r\nimport { useDepartmentStore } from '../departments/store';\r\nimport { useJobTitleStore } from '../job-titles/store';\r\nimport { usePenaltyStore } from '../penalties/store';\r\nimport { useLeaveStore } from '../../leaves/store';\r\nimport { useSupplierStore } from '../../suppliers/store';\r\nimport { usePurchaseOrderStore } from '../../purchase-orders/store';\r\nimport { usePurchaseReturnStore } from '../../purchase-returns/store';\r\nimport { useInventoryReceiptStore } from '../../inventory-receipts/store';\r\nimport { useReceiptTypeStore } from \"../receipt-types/store\";\r\nimport { usePaymentTypeStore } from \"../payments/types/store\";\r\nimport { usePaymentMethodStore } from \"../payments/methods/store\";\r\nimport { useProvinceStore } from '../provinces/store';\r\nimport { useUnitStore } from '../units/store';\r\n\r\n// ✅ Update interface to match component\r\ninterface CounterInfo extends CounterTableRow {\r\n  // Additional fields if needed\r\n}\r\n\r\nexport function IDCounterSettingsPage() {\r\n  const router = useRouter();\r\n  const [searchQuery, setSearchQuery] = React.useState('');\r\n  const [selectedCategory, setSelectedCategory] = React.useState<string>('all');\r\n  const [selectedEntity, setSelectedEntity] = React.useState<CounterInfo | null>(null);\r\n\r\n  // Page header\r\n  useSettingsPageHeader({\r\n    title: 'Quản lý ID & Prefix',\r\n    breadcrumb: [\r\n      { label: 'Trang chủ', href: '/' },\r\n      { label: 'Cài đặt', href: '/settings' },\r\n      { label: 'Quản lý ID & Prefix', href: '/settings/id-counters', isCurrent: true },\r\n    ],\r\n  });\r\n\r\n  // Gather counter data from all stores\r\n  const counterData = React.useMemo((): CounterInfo[] => {\r\n    const data: CounterInfo[] = [];\r\n    \r\n    // Helper to add counter info\r\n    const addCounter = (\r\n      entityType: EntityType,\r\n      counter: number,\r\n      items: any[],\r\n      lastItem?: any\r\n    ) => {\r\n      const config = ID_CONFIG[entityType];\r\n      if (!config) return;\r\n      \r\n      const nextId = `${config.prefix}${String(counter + 1).padStart(config.digitCount, '0')}`;\r\n      \r\n      // Health check\r\n      let health: 'good' | 'warning' | 'error' = 'good';\r\n      if (items.length > 0 && counter === 0) health = 'warning';\r\n      if (items.length > counter + 10) health = 'warning'; // Counter too low\r\n      \r\n      data.push({\r\n        entityType,\r\n        config,\r\n        currentCounter: counter,\r\n        totalItems: items.length,\r\n        nextId,\r\n        lastCreated: lastItem?.id,\r\n        health,\r\n      });\r\n    };\r\n\r\n    // Employees\r\n    const empStore = useEmployeeStore.getState();\r\n    addCounter('employees', (empStore as any).businessIdCounter || 0, empStore.data, empStore.data[empStore.data.length - 1]);\r\n\r\n    // Customers\r\n    const custStore = useCustomerStore.getState();\r\n    addCounter('customers', (custStore as any).businessIdCounter || 0, custStore.data, custStore.data[custStore.data.length - 1]);\r\n\r\n    // Vouchers - Skip (handled by receipts/payments separately)\r\n    // const voucherStore = useVoucherStore.getState();\r\n    // Vouchers use 'receipts' and 'payments' entity types, not 'vouchers'\r\n\r\n    // Complaints - Use complaints array from store\r\n    const complaintState = useComplaintStore.getState();\r\n    const complaintData = complaintState.complaints || [];\r\n    addCounter('complaints', 0, complaintData, complaintData[complaintData.length - 1]);\r\n\r\n    // Warranty - Use data array from store\r\n    const warrantyState = useWarrantyStore.getState();\r\n    const warrantyData = warrantyState.data || [];\r\n    addCounter('warranty', 0, warrantyData, warrantyData[warrantyData.length - 1]);\r\n\r\n    // Orders\r\n    const orderState = useOrderStore.getState();\r\n    const orderData = orderState.data || [];\r\n    addCounter('orders', 0, orderData, orderData[orderData.length - 1]);\r\n\r\n    // Products\r\n    const productState = useProductStore.getState();\r\n    const productData = productState.data || [];\r\n    addCounter('products', 0, productData, productData[productData.length - 1]);\r\n\r\n    // Branches\r\n    const branchState = useBranchStore.getState();\r\n    const branchData = branchState.data || [];\r\n    addCounter('branches', 0, branchData, branchData[branchData.length - 1]);\r\n\r\n    // Departments\r\n    const deptState = useDepartmentStore.getState();\r\n    const deptData = deptState.data || [];\r\n    addCounter('departments', 0, deptData, deptData[deptData.length - 1]);\r\n\r\n    // Job Titles\r\n    const jobState = useJobTitleStore.getState();\r\n    const jobData = jobState.data || [];\r\n    addCounter('job-titles', 0, jobData, jobData[jobData.length - 1]);\r\n\r\n    // Penalties\r\n    const penaltyState = usePenaltyStore.getState();\r\n    const penaltyData = penaltyState.data || [];\r\n    addCounter('penalties', 0, penaltyData, penaltyData[penaltyData.length - 1]);\r\n\r\n    // Leaves\r\n    const leaveState = useLeaveStore.getState();\r\n    const leaveData = leaveState.data || [];\r\n    addCounter('leaves', 0, leaveData, leaveData[leaveData.length - 1]);\r\n\r\n    // Suppliers\r\n    const supplierState = useSupplierStore.getState();\r\n    const supplierData = supplierState.data || [];\r\n    addCounter('suppliers', 0, supplierData, supplierData[supplierData.length - 1]);\r\n\r\n    // Purchase Orders\r\n    const poState = usePurchaseOrderStore.getState();\r\n    const poData = poState.data || [];\r\n    addCounter('purchase-orders', 0, poData, poData[poData.length - 1]);\r\n\r\n    // Purchase Returns\r\n    const prState = usePurchaseReturnStore.getState();\r\n    const prData = prState.data || [];\r\n    addCounter('purchase-returns', 0, prData, prData[prData.length - 1]);\r\n\r\n    // Inventory Receipts\r\n    const invState = useInventoryReceiptStore.getState();\r\n    const invData = invState.data || [];\r\n    addCounter('inventory-receipts', 0, invData, invData[invData.length - 1]);\r\n\r\n    // Receipt Types\r\n    const receiptState = useReceiptTypeStore.getState();\r\n    const receiptData = receiptState.data || [];\r\n    addCounter('receipt-types', 0, receiptData, receiptData[receiptData.length - 1]);\r\n\r\n    // Payment Types\r\n    const paymentState = usePaymentTypeStore.getState();\r\n    const paymentData = paymentState.data || [];\r\n    addCounter('payment-types', 0, paymentData, paymentData[paymentData.length - 1]);\r\n\r\n    // Payment Methods\r\n    const methodState = usePaymentMethodStore.getState();\r\n    const methodData = methodState.data || [];\r\n    addCounter('payment-methods', 0, methodData, methodData[methodData.length - 1]);\r\n\r\n    // Provinces\r\n    const provState = useProvinceStore.getState();\r\n    const provData = provState.data || [];\r\n    addCounter('provinces', 0, provData, provData[provData.length - 1]);\r\n\r\n    // Units\r\n    const unitState = useUnitStore.getState();\r\n    const unitData = unitState.data || [];\r\n    addCounter('units', 0, unitData, unitData[unitData.length - 1]);\r\n\r\n    return data;\r\n  }, []);\r\n\r\n  // Filter data\r\n  const filteredData = React.useMemo(() => {\r\n    let filtered = counterData;\r\n    \r\n    if (searchQuery) {\r\n      filtered = filtered.filter(item => \r\n        item.config.displayName.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        item.config.prefix.toLowerCase().includes(searchQuery.toLowerCase()) ||\r\n        item.entityType.toLowerCase().includes(searchQuery.toLowerCase())\r\n      );\r\n    }\r\n    \r\n    if (selectedCategory !== 'all') {\r\n      const categories = getEntityCategories();\r\n      const categoryEntities = categories[selectedCategory] || [];\r\n      filtered = filtered.filter(item => categoryEntities.includes(item.entityType as any));\r\n    }\r\n    \r\n    return filtered;\r\n  }, [counterData, searchQuery, selectedCategory]);\r\n\r\n  // Statistics\r\n  const stats = React.useMemo(() => {\r\n    const total = counterData.reduce((sum, item) => sum + item.totalItems, 0);\r\n    const maxCounter = Math.max(...counterData.map(item => item.currentCounter));\r\n    const withWarnings = counterData.filter(item => item.health === 'warning').length;\r\n    const withErrors = counterData.filter(item => item.health === 'error').length;\r\n    \r\n    return {\r\n      totalEntities: counterData.length,\r\n      totalItems: total,\r\n      maxCounter,\r\n      withWarnings,\r\n      withErrors,\r\n    };\r\n  }, [counterData]);\r\n\r\n  const categories = getEntityCategories();\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Statistics Cards - Using StatsCard component */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n        <StatsCard\r\n          title=\"Entity Types\"\r\n          value={stats.totalEntities}\r\n          description=\"Đang theo dõi\"\r\n          icon={Hash}\r\n        />\r\n        <StatsCard\r\n          title=\"Tổng Records\"\r\n          value={stats.totalItems.toLocaleString()}\r\n          description=\"Trên tất cả entities\"\r\n          icon={TrendingUp}\r\n        />\r\n        <StatsCard\r\n          title=\"Counter cao nhất\"\r\n          value={stats.maxCounter}\r\n          description=\"Số thứ tự\"\r\n          icon={RefreshCw}\r\n        />\r\n        <Card>\r\n          <CardHeader className=\"pb-3\">\r\n            <CardTitle className=\"text-sm font-medium flex items-center gap-2\">\r\n              <CheckCircle2 className=\"h-4 w-4\" />\r\n              Health Status\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {stats.withErrors > 0 ? (\r\n              <Badge variant=\"destructive\">Lỗi: {stats.withErrors}</Badge>\r\n            ) : stats.withWarnings > 0 ? (\r\n              <Badge variant=\"secondary\">Cảnh báo: {stats.withWarnings}</Badge>\r\n            ) : (\r\n              <Badge variant=\"default\">Hoạt động tốt</Badge>\r\n            )}\r\n            <p className=\"text-xs text-muted-foreground mt-2\">\r\n              {stats.withErrors === 0 && stats.withWarnings === 0 ? 'Không có vấn đề' : 'Cần kiểm tra'}\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      <Tabs defaultValue=\"counters\" className=\"space-y-4\">\r\n        <TabsList>\r\n          <TabsTrigger value=\"counters\">Counters</TabsTrigger>\r\n          <TabsTrigger value=\"tester\">ID Tester</TabsTrigger>\r\n          <TabsTrigger value=\"config\">Configuration</TabsTrigger>\r\n        </TabsList>\r\n\r\n        {/* Counters Tab */}\r\n        <TabsContent value=\"counters\" className=\"space-y-4\">\r\n          {/* Filters */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle className=\"text-base\">Bộ lọc</CardTitle>\r\n            </CardHeader>\r\n            <CardContent className=\"space-y-4\">\r\n              <div className=\"flex gap-4\">\r\n                <div className=\"flex-1\">\r\n                  <Label>Tìm kiếm</Label>\r\n                  <div className=\"relative\">\r\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                    <Input\r\n                      placeholder=\"Tìm theo tên, prefix, entity type...\"\r\n                      value={searchQuery}\r\n                      onChange={(e) => setSearchQuery(e.target.value)}\r\n                      className=\"pl-9\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"w-64\">\r\n                  <Label>Danh mục</Label>\r\n                  <select\r\n                    className=\"w-full h-9 rounded-md border border-input bg-background px-3 text-sm\"\r\n                    value={selectedCategory}\r\n                    onChange={(e) => setSelectedCategory(e.target.value)}\r\n                  >\r\n                    <option value=\"all\">Tất cả</option>\r\n                    {Object.keys(categories).map(cat => (\r\n                      <option key={cat} value={cat}>{cat}</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          {/* Counter Table - Using CounterTable component */}\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Chi tiết Counters</CardTitle>\r\n              <CardDescription>\r\n                {filteredData.length} entity types\r\n              </CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <CounterTable \r\n                data={filteredData} \r\n                onViewDetails={setSelectedEntity}\r\n              />\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n\r\n        {/* ID Tester Tab - Using IDTester component */}\r\n        <TabsContent value=\"tester\" className=\"space-y-4\">\r\n          <IDTester \r\n            defaultEntityType=\"employees\"\r\n            onTestResult={(result) => {\r\n              if (result.valid) {\r\n                toast.success('✅ ID hợp lệ!');\r\n              } else {\r\n                toast.error(`❌ ${result.error}`);\r\n              }\r\n            }}\r\n          />\r\n        </TabsContent>\r\n\r\n        {/* Configuration Tab */}\r\n        <TabsContent value=\"config\" className=\"space-y-4\">\r\n          <Card>\r\n            <CardHeader>\r\n              <CardTitle>Cấu hình ID</CardTitle>\r\n              <CardDescription>Danh sách tất cả cấu hình prefix và format</CardDescription>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"space-y-4\">\r\n                {Object.entries(getEntityCategories()).map(([category, entities]) => (\r\n                  <div key={category}>\r\n                    <h3 className=\"font-semibold text-sm mb-2\">{category}</h3>\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2\">\r\n                      {entities.map(entityType => {\r\n                        const config = ID_CONFIG[entityType];\r\n                        if (!config) return null;\r\n                        return (\r\n                          <div key={entityType} className=\"p-3 border rounded-md space-y-2\">\r\n                            <div className=\"flex items-center justify-between\">\r\n                              <span className=\"text-sm font-medium\">{config.displayName}</span>\r\n                            </div>\r\n                            \r\n                            <div className=\"space-y-1\">\r\n                              <div className=\"flex items-center gap-2\">\r\n                                <span className=\"text-xs text-muted-foreground\">SystemId:</span>\r\n                                <Badge variant=\"outline\" className=\"text-xs font-mono\">{config.systemIdPrefix}</Badge>\r\n                                <code className=\"text-xs text-blue-600\">{config.systemIdPrefix}{'0'.repeat(config.digitCount - 1)}1</code>\r\n                              </div>\r\n                              \r\n                              <div className=\"flex items-center gap-2\">\r\n                                <span className=\"text-xs text-muted-foreground\">Business ID:</span>\r\n                                <Badge variant=\"secondary\" className=\"text-xs font-mono\">{config.prefix}</Badge>\r\n                                <code className=\"text-xs text-green-600\">{config.prefix}{'0'.repeat(config.digitCount - 1)}1</code>\r\n                              </div>\r\n                            </div>\r\n                            \r\n                            <div className=\"text-xs text-muted-foreground\">\r\n                              Digits: {config.digitCount}\r\n                            </div>\r\n                            {config.validation?.allowCustomId && (\r\n                              <Badge variant=\"secondary\" className=\"text-[10px]\">Custom ID OK</Badge>\r\n                            )}\r\n                          </div>\r\n                        );\r\n                      })}\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        </TabsContent>\r\n      </Tabs>\r\n\r\n      {/* Entity Detail Dialog */}\r\n      <Dialog open={!!selectedEntity} onOpenChange={() => setSelectedEntity(null)}>\r\n        <DialogContent className=\"max-w-2xl\">\r\n          <DialogHeader>\r\n            <DialogTitle>{selectedEntity?.config.displayName}</DialogTitle>\r\n            <DialogDescription>\r\n              Chi tiết cấu hình và counter\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          \r\n          {selectedEntity && (\r\n            <div className=\"space-y-4\">\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div>\r\n                  <Label className=\"text-xs text-muted-foreground\">Entity Type</Label>\r\n                  <p className=\"font-mono text-sm\">{selectedEntity.entityType}</p>\r\n                </div>\r\n                <div>\r\n                  <Label className=\"text-xs text-muted-foreground\">Prefix</Label>\r\n                  <p className=\"font-mono text-sm\">{selectedEntity.config.prefix}</p>\r\n                </div>\r\n                <div>\r\n                  <Label className=\"text-xs text-muted-foreground\">Current Counter</Label>\r\n                  <p className=\"font-mono text-sm\">{selectedEntity.currentCounter}</p>\r\n                </div>\r\n                <div>\r\n                  <Label className=\"text-xs text-muted-foreground\">Total Items</Label>\r\n                  <p className=\"font-mono text-sm\">{selectedEntity.totalItems}</p>\r\n                </div>\r\n                <div>\r\n                  <Label className=\"text-xs text-muted-foreground\">Next ID</Label>\r\n                  <p className=\"font-mono text-sm\">{selectedEntity.nextId}</p>\r\n                </div>\r\n                <div>\r\n                  <Label className=\"text-xs text-muted-foreground\">Digit Count</Label>\r\n                  <p className=\"font-mono text-sm\">{selectedEntity.config.digitCount}</p>\r\n                </div>\r\n                <div>\r\n                  <Label className=\"text-xs text-muted-foreground\">System ID Prefix</Label>\r\n                  <p className=\"font-mono text-sm\">{selectedEntity.config.systemIdPrefix}</p>\r\n                </div>\r\n                <div>\r\n                  <Label className=\"text-xs text-muted-foreground\">Custom ID Allowed</Label>\r\n                  <p className=\"font-mono text-sm\">\r\n                    {selectedEntity.config.validation?.allowCustomId ? 'Yes' : 'No'}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              \r\n              {selectedEntity.lastCreated && (\r\n                <div>\r\n                  <Label className=\"text-xs text-muted-foreground\">Last Created ID</Label>\r\n                  <code className=\"text-sm bg-muted px-2 py-1 rounded block mt-1\">\r\n                    {selectedEntity.lastCreated}\r\n                  </code>\r\n                </div>\r\n              )}\r\n              \r\n              <div className=\"p-3 border rounded-md bg-muted/50\">\r\n                <p className=\"text-sm font-medium mb-1\">Sample IDs:</p>\r\n                <div className=\"space-y-1 text-xs font-mono\">\r\n                  <div>{selectedEntity.config.prefix}{String(1).padStart(selectedEntity.config.digitCount, '0')}</div>\r\n                  <div>{selectedEntity.config.prefix}{String(100).padStart(selectedEntity.config.digitCount, '0')}</div>\r\n                  <div>{selectedEntity.config.prefix}{String(999999).padStart(selectedEntity.config.digitCount, '0')}</div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAkBA;AACA;AACA;AACA;AAEA;AACA;AASA;AAQA;AAMA;AAAA;AAAA;AAAA;AAAA;AAgBA;AACA;AACA;AAQA,+BAA+B;AAC/B;AACA;AACA;AAEA,+DAA+D;AAC/D;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAlGA;;;;;;;;;;;;;;CAcC,GAED;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyFO,SAAS;;IACd,MAAM,SAAS,IAAA,kJAAS;IACxB,MAAM,CAAC,aAAa,eAAe,GAAG,yKAAc,CAAC;IACrD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,yKAAc,CAAS;IACvE,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,yKAAc,CAAqB;IAE/E,cAAc;IACd,IAAA,sLAAqB,EAAC;QACpB,OAAO;QACP,YAAY;YACV;gBAAE,OAAO;gBAAa,MAAM;YAAI;YAChC;gBAAE,OAAO;gBAAW,MAAM;YAAY;YACtC;gBAAE,OAAO;gBAAuB,MAAM;gBAAyB,WAAW;YAAK;SAChF;IACH;IAEA,sCAAsC;IACtC,MAAM,cAAc,wKAAa;sDAAC;YAChC,MAAM,OAAsB,EAAE;YAE9B,6BAA6B;YAC7B,MAAM;yEAAa,CACjB,YACA,SACA,OACA;oBAEA,MAAM,SAAS,mIAAS,CAAC,WAAW;oBACpC,IAAI,CAAC,QAAQ;oBAEb,MAAM,SAAS,GAAG,OAAO,MAAM,GAAG,OAAO,UAAU,GAAG,QAAQ,CAAC,OAAO,UAAU,EAAE,MAAM;oBAExF,eAAe;oBACf,IAAI,SAAuC;oBAC3C,IAAI,MAAM,MAAM,GAAG,KAAK,YAAY,GAAG,SAAS;oBAChD,IAAI,MAAM,MAAM,GAAG,UAAU,IAAI,SAAS,WAAW,kBAAkB;oBAEvE,KAAK,IAAI,CAAC;wBACR;wBACA;wBACA,gBAAgB;wBAChB,YAAY,MAAM,MAAM;wBACxB;wBACA,aAAa,UAAU;wBACvB;oBACF;gBACF;;YAEA,YAAY;YACZ,MAAM,WAAW,qJAAgB,CAAC,QAAQ;YAC1C,WAAW,aAAa,AAAC,SAAiB,iBAAiB,IAAI,GAAG,SAAS,IAAI,EAAE,SAAS,IAAI,CAAC,SAAS,IAAI,CAAC,MAAM,GAAG,EAAE;YAExH,YAAY;YACZ,MAAM,YAAY,qJAAgB,CAAC,QAAQ;YAC3C,WAAW,aAAa,AAAC,UAAkB,iBAAiB,IAAI,GAAG,UAAU,IAAI,EAAE,UAAU,IAAI,CAAC,UAAU,IAAI,CAAC,MAAM,GAAG,EAAE;YAE5H,4DAA4D;YAC5D,mDAAmD;YACnD,sEAAsE;YAEtE,+CAA+C;YAC/C,MAAM,iBAAiB,uJAAiB,CAAC,QAAQ;YACjD,MAAM,gBAAgB,eAAe,UAAU,IAAI,EAAE;YACrD,WAAW,cAAc,GAAG,eAAe,aAAa,CAAC,cAAc,MAAM,GAAG,EAAE;YAElF,uCAAuC;YACvC,MAAM,gBAAgB,6JAAgB,CAAC,QAAQ;YAC/C,MAAM,eAAe,cAAc,IAAI,IAAI,EAAE;YAC7C,WAAW,YAAY,GAAG,cAAc,YAAY,CAAC,aAAa,MAAM,GAAG,EAAE;YAE7E,SAAS;YACT,MAAM,aAAa,+IAAa,CAAC,QAAQ;YACzC,MAAM,YAAY,WAAW,IAAI,IAAI,EAAE;YACvC,WAAW,UAAU,GAAG,WAAW,SAAS,CAAC,UAAU,MAAM,GAAG,EAAE;YAElE,WAAW;YACX,MAAM,eAAe,mJAAe,CAAC,QAAQ;YAC7C,MAAM,cAAc,aAAa,IAAI,IAAI,EAAE;YAC3C,WAAW,YAAY,GAAG,aAAa,WAAW,CAAC,YAAY,MAAM,GAAG,EAAE;YAE1E,WAAW;YACX,MAAM,cAAc,8JAAc,CAAC,QAAQ;YAC3C,MAAM,aAAa,YAAY,IAAI,IAAI,EAAE;YACzC,WAAW,YAAY,GAAG,YAAY,UAAU,CAAC,WAAW,MAAM,GAAG,EAAE;YAEvE,cAAc;YACd,MAAM,YAAY,qKAAkB,CAAC,QAAQ;YAC7C,MAAM,WAAW,UAAU,IAAI,IAAI,EAAE;YACrC,WAAW,eAAe,GAAG,UAAU,QAAQ,CAAC,SAAS,MAAM,GAAG,EAAE;YAEpE,aAAa;YACb,MAAM,WAAW,qKAAgB,CAAC,QAAQ;YAC1C,MAAM,UAAU,SAAS,IAAI,IAAI,EAAE;YACnC,WAAW,cAAc,GAAG,SAAS,OAAO,CAAC,QAAQ,MAAM,GAAG,EAAE;YAEhE,YAAY;YACZ,MAAM,eAAe,gKAAe,CAAC,QAAQ;YAC7C,MAAM,cAAc,aAAa,IAAI,IAAI,EAAE;YAC3C,WAAW,aAAa,GAAG,aAAa,WAAW,CAAC,YAAY,MAAM,GAAG,EAAE;YAE3E,SAAS;YACT,MAAM,aAAa,+IAAa,CAAC,QAAQ;YACzC,MAAM,YAAY,WAAW,IAAI,IAAI,EAAE;YACvC,WAAW,UAAU,GAAG,WAAW,SAAS,CAAC,UAAU,MAAM,GAAG,EAAE;YAElE,YAAY;YACZ,MAAM,gBAAgB,qJAAgB,CAAC,QAAQ;YAC/C,MAAM,eAAe,cAAc,IAAI,IAAI,EAAE;YAC7C,WAAW,aAAa,GAAG,cAAc,YAAY,CAAC,aAAa,MAAM,GAAG,EAAE;YAE9E,kBAAkB;YAClB,MAAM,UAAU,mKAAqB,CAAC,QAAQ;YAC9C,MAAM,SAAS,QAAQ,IAAI,IAAI,EAAE;YACjC,WAAW,mBAAmB,GAAG,QAAQ,MAAM,CAAC,OAAO,MAAM,GAAG,EAAE;YAElE,mBAAmB;YACnB,MAAM,UAAU,qKAAsB,CAAC,QAAQ;YAC/C,MAAM,SAAS,QAAQ,IAAI,IAAI,EAAE;YACjC,WAAW,oBAAoB,GAAG,QAAQ,MAAM,CAAC,OAAO,MAAM,GAAG,EAAE;YAEnE,qBAAqB;YACrB,MAAM,WAAW,yKAAwB,CAAC,QAAQ;YAClD,MAAM,UAAU,SAAS,IAAI,IAAI,EAAE;YACnC,WAAW,sBAAsB,GAAG,SAAS,OAAO,CAAC,QAAQ,MAAM,GAAG,EAAE;YAExE,gBAAgB;YAChB,MAAM,eAAe,2KAAmB,CAAC,QAAQ;YACjD,MAAM,cAAc,aAAa,IAAI,IAAI,EAAE;YAC3C,WAAW,iBAAiB,GAAG,aAAa,WAAW,CAAC,YAAY,MAAM,GAAG,EAAE;YAE/E,gBAAgB;YAChB,MAAM,eAAe,4KAAmB,CAAC,QAAQ;YACjD,MAAM,cAAc,aAAa,IAAI,IAAI,EAAE;YAC3C,WAAW,iBAAiB,GAAG,aAAa,WAAW,CAAC,YAAY,MAAM,GAAG,EAAE;YAE/E,kBAAkB;YAClB,MAAM,cAAc,gLAAqB,CAAC,QAAQ;YAClD,MAAM,aAAa,YAAY,IAAI,IAAI,EAAE;YACzC,WAAW,mBAAmB,GAAG,YAAY,UAAU,CAAC,WAAW,MAAM,GAAG,EAAE;YAE9E,YAAY;YACZ,MAAM,YAAY,iKAAgB,CAAC,QAAQ;YAC3C,MAAM,WAAW,UAAU,IAAI,IAAI,EAAE;YACrC,WAAW,aAAa,GAAG,UAAU,QAAQ,CAAC,SAAS,MAAM,GAAG,EAAE;YAElE,QAAQ;YACR,MAAM,YAAY,yJAAY,CAAC,QAAQ;YACvC,MAAM,WAAW,UAAU,IAAI,IAAI,EAAE;YACrC,WAAW,SAAS,GAAG,UAAU,QAAQ,CAAC,SAAS,MAAM,GAAG,EAAE;YAE9D,OAAO;QACT;qDAAG,EAAE;IAEL,cAAc;IACd,MAAM,eAAe,wKAAa;uDAAC;YACjC,IAAI,WAAW;YAEf,IAAI,aAAa;gBACf,WAAW,SAAS,MAAM;mEAAC,CAAA,OACzB,KAAK,MAAM,CAAC,WAAW,CAAC,WAAW,GAAG,QAAQ,CAAC,YAAY,WAAW,OACtE,KAAK,MAAM,CAAC,MAAM,CAAC,WAAW,GAAG,QAAQ,CAAC,YAAY,WAAW,OACjE,KAAK,UAAU,CAAC,WAAW,GAAG,QAAQ,CAAC,YAAY,WAAW;;YAElE;YAEA,IAAI,qBAAqB,OAAO;gBAC9B,MAAM,aAAa,IAAA,6IAAmB;gBACtC,MAAM,mBAAmB,UAAU,CAAC,iBAAiB,IAAI,EAAE;gBAC3D,WAAW,SAAS,MAAM;mEAAC,CAAA,OAAQ,iBAAiB,QAAQ,CAAC,KAAK,UAAU;;YAC9E;YAEA,OAAO;QACT;sDAAG;QAAC;QAAa;QAAa;KAAiB;IAE/C,aAAa;IACb,MAAM,QAAQ,wKAAa;gDAAC;YAC1B,MAAM,QAAQ,YAAY,MAAM;8DAAC,CAAC,KAAK,OAAS,MAAM,KAAK,UAAU;6DAAE;YACvE,MAAM,aAAa,KAAK,GAAG,IAAI,YAAY,GAAG;mEAAC,CAAA,OAAQ,KAAK,cAAc;;YAC1E,MAAM,eAAe,YAAY,MAAM;wDAAC,CAAA,OAAQ,KAAK,MAAM,KAAK;uDAAW,MAAM;YACjF,MAAM,aAAa,YAAY,MAAM;wDAAC,CAAA,OAAQ,KAAK,MAAM,KAAK;uDAAS,MAAM;YAE7E,OAAO;gBACL,eAAe,YAAY,MAAM;gBACjC,YAAY;gBACZ;gBACA;gBACA;YACF;QACF;+CAAG;QAAC;KAAY;IAEhB,MAAM,aAAa,IAAA,6IAAmB;IAEtC,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC,wJAAS;wBACR,OAAM;wBACN,OAAO,MAAM,aAAa;wBAC1B,aAAY;wBACZ,MAAM,6MAAI;;;;;;kCAEZ,6LAAC,wJAAS;wBACR,OAAM;wBACN,OAAO,MAAM,UAAU,CAAC,cAAc;wBACtC,aAAY;wBACZ,MAAM,mOAAU;;;;;;kCAElB,6LAAC,wJAAS;wBACR,OAAM;wBACN,OAAO,MAAM,UAAU;wBACvB,aAAY;wBACZ,MAAM,gOAAS;;;;;;kCAEjB,6LAAC,oIAAI;;0CACH,6LAAC,0IAAU;gCAAC,WAAU;0CACpB,cAAA,6LAAC,yIAAS;oCAAC,WAAU;;sDACnB,6LAAC,wOAAY;4CAAC,WAAU;;;;;;wCAAY;;;;;;;;;;;;0CAIxC,6LAAC,2IAAW;;oCACT,MAAM,UAAU,GAAG,kBAClB,6LAAC,sIAAK;wCAAC,SAAQ;;4CAAc;4CAAM,MAAM,UAAU;;;;;;+CACjD,MAAM,YAAY,GAAG,kBACvB,6LAAC,sIAAK;wCAAC,SAAQ;;4CAAY;4CAAW,MAAM,YAAY;;;;;;6DAExD,6LAAC,sIAAK;wCAAC,SAAQ;kDAAU;;;;;;kDAE3B,6LAAC;wCAAE,WAAU;kDACV,MAAM,UAAU,KAAK,KAAK,MAAM,YAAY,KAAK,IAAI,oBAAoB;;;;;;;;;;;;;;;;;;;;;;;;0BAMlF,6LAAC,oIAAI;gBAAC,cAAa;gBAAW,WAAU;;kCACtC,6LAAC,wIAAQ;;0CACP,6LAAC,2IAAW;gCAAC,OAAM;0CAAW;;;;;;0CAC9B,6LAAC,2IAAW;gCAAC,OAAM;0CAAS;;;;;;0CAC5B,6LAAC,2IAAW;gCAAC,OAAM;0CAAS;;;;;;;;;;;;kCAI9B,6LAAC,2IAAW;wBAAC,OAAM;wBAAW,WAAU;;0CAEtC,6LAAC,oIAAI;;kDACH,6LAAC,0IAAU;kDACT,cAAA,6LAAC,yIAAS;4CAAC,WAAU;sDAAY;;;;;;;;;;;kDAEnC,6LAAC,2IAAW;wCAAC,WAAU;kDACrB,cAAA,6LAAC;4CAAI,WAAU;;8DACb,6LAAC;oDAAI,WAAU;;sEACb,6LAAC,sIAAK;sEAAC;;;;;;sEACP,6LAAC;4DAAI,WAAU;;8EACb,6LAAC,mNAAM;oEAAC,WAAU;;;;;;8EAClB,6LAAC,sIAAK;oEACJ,aAAY;oEACZ,OAAO;oEACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;oEAC9C,WAAU;;;;;;;;;;;;;;;;;;8DAKhB,6LAAC;oDAAI,WAAU;;sEACb,6LAAC,sIAAK;sEAAC;;;;;;sEACP,6LAAC;4DACC,WAAU;4DACV,OAAO;4DACP,UAAU,CAAC,IAAM,oBAAoB,EAAE,MAAM,CAAC,KAAK;;8EAEnD,6LAAC;oEAAO,OAAM;8EAAM;;;;;;gEACnB,OAAO,IAAI,CAAC,YAAY,GAAG,CAAC,CAAA,oBAC3B,6LAAC;wEAAiB,OAAO;kFAAM;uEAAlB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0CASzB,6LAAC,oIAAI;;kDACH,6LAAC,0IAAU;;0DACT,6LAAC,yIAAS;0DAAC;;;;;;0DACX,6LAAC,+IAAe;;oDACb,aAAa,MAAM;oDAAC;;;;;;;;;;;;;kDAGzB,6LAAC,2IAAW;kDACV,cAAA,6LAAC,8JAAY;4CACX,MAAM;4CACN,eAAe;;;;;;;;;;;;;;;;;;;;;;;kCAOvB,6LAAC,2IAAW;wBAAC,OAAM;wBAAS,WAAU;kCACpC,cAAA,6LAAC,sJAAQ;4BACP,mBAAkB;4BAClB,cAAc,CAAC;gCACb,IAAI,OAAO,KAAK,EAAE;oCAChB,oJAAK,CAAC,OAAO,CAAC;gCAChB,OAAO;oCACL,oJAAK,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,OAAO,KAAK,EAAE;gCACjC;4BACF;;;;;;;;;;;kCAKJ,6LAAC,2IAAW;wBAAC,OAAM;wBAAS,WAAU;kCACpC,cAAA,6LAAC,oIAAI;;8CACH,6LAAC,0IAAU;;sDACT,6LAAC,yIAAS;sDAAC;;;;;;sDACX,6LAAC,+IAAe;sDAAC;;;;;;;;;;;;8CAEnB,6LAAC,2IAAW;8CACV,cAAA,6LAAC;wCAAI,WAAU;kDACZ,OAAO,OAAO,CAAC,IAAA,6IAAmB,KAAI,GAAG,CAAC,CAAC,CAAC,UAAU,SAAS,iBAC9D,6LAAC;;kEACC,6LAAC;wDAAG,WAAU;kEAA8B;;;;;;kEAC5C,6LAAC;wDAAI,WAAU;kEACZ,SAAS,GAAG,CAAC,CAAA;4DACZ,MAAM,SAAS,mIAAS,CAAC,WAAW;4DACpC,IAAI,CAAC,QAAQ,OAAO;4DACpB,qBACE,6LAAC;gEAAqB,WAAU;;kFAC9B,6LAAC;wEAAI,WAAU;kFACb,cAAA,6LAAC;4EAAK,WAAU;sFAAuB,OAAO,WAAW;;;;;;;;;;;kFAG3D,6LAAC;wEAAI,WAAU;;0FACb,6LAAC;gFAAI,WAAU;;kGACb,6LAAC;wFAAK,WAAU;kGAAgC;;;;;;kGAChD,6LAAC,sIAAK;wFAAC,SAAQ;wFAAU,WAAU;kGAAqB,OAAO,cAAc;;;;;;kGAC7E,6LAAC;wFAAK,WAAU;;4FAAyB,OAAO,cAAc;4FAAE,IAAI,MAAM,CAAC,OAAO,UAAU,GAAG;4FAAG;;;;;;;;;;;;;0FAGpG,6LAAC;gFAAI,WAAU;;kGACb,6LAAC;wFAAK,WAAU;kGAAgC;;;;;;kGAChD,6LAAC,sIAAK;wFAAC,SAAQ;wFAAY,WAAU;kGAAqB,OAAO,MAAM;;;;;;kGACvE,6LAAC;wFAAK,WAAU;;4FAA0B,OAAO,MAAM;4FAAE,IAAI,MAAM,CAAC,OAAO,UAAU,GAAG;4FAAG;;;;;;;;;;;;;;;;;;;kFAI/F,6LAAC;wEAAI,WAAU;;4EAAgC;4EACpC,OAAO,UAAU;;;;;;;oEAE3B,OAAO,UAAU,EAAE,+BAClB,6LAAC,sIAAK;wEAAC,SAAQ;wEAAY,WAAU;kFAAc;;;;;;;+DAvB7C;;;;;wDA2Bd;;;;;;;+CAlCM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;0BA6CtB,6LAAC,wIAAM;gBAAC,MAAM,CAAC,CAAC;gBAAgB,cAAc,IAAM,kBAAkB;0BACpE,cAAA,6LAAC,+IAAa;oBAAC,WAAU;;sCACvB,6LAAC,8IAAY;;8CACX,6LAAC,6IAAW;8CAAE,gBAAgB,OAAO;;;;;;8CACrC,6LAAC,mJAAiB;8CAAC;;;;;;;;;;;;wBAKpB,gCACC,6LAAC;4BAAI,WAAU;;8CACb,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;;8DACC,6LAAC,sIAAK;oDAAC,WAAU;8DAAgC;;;;;;8DACjD,6LAAC;oDAAE,WAAU;8DAAqB,eAAe,UAAU;;;;;;;;;;;;sDAE7D,6LAAC;;8DACC,6LAAC,sIAAK;oDAAC,WAAU;8DAAgC;;;;;;8DACjD,6LAAC;oDAAE,WAAU;8DAAqB,eAAe,MAAM,CAAC,MAAM;;;;;;;;;;;;sDAEhE,6LAAC;;8DACC,6LAAC,sIAAK;oDAAC,WAAU;8DAAgC;;;;;;8DACjD,6LAAC;oDAAE,WAAU;8DAAqB,eAAe,cAAc;;;;;;;;;;;;sDAEjE,6LAAC;;8DACC,6LAAC,sIAAK;oDAAC,WAAU;8DAAgC;;;;;;8DACjD,6LAAC;oDAAE,WAAU;8DAAqB,eAAe,UAAU;;;;;;;;;;;;sDAE7D,6LAAC;;8DACC,6LAAC,sIAAK;oDAAC,WAAU;8DAAgC;;;;;;8DACjD,6LAAC;oDAAE,WAAU;8DAAqB,eAAe,MAAM;;;;;;;;;;;;sDAEzD,6LAAC;;8DACC,6LAAC,sIAAK;oDAAC,WAAU;8DAAgC;;;;;;8DACjD,6LAAC;oDAAE,WAAU;8DAAqB,eAAe,MAAM,CAAC,UAAU;;;;;;;;;;;;sDAEpE,6LAAC;;8DACC,6LAAC,sIAAK;oDAAC,WAAU;8DAAgC;;;;;;8DACjD,6LAAC;oDAAE,WAAU;8DAAqB,eAAe,MAAM,CAAC,cAAc;;;;;;;;;;;;sDAExE,6LAAC;;8DACC,6LAAC,sIAAK;oDAAC,WAAU;8DAAgC;;;;;;8DACjD,6LAAC;oDAAE,WAAU;8DACV,eAAe,MAAM,CAAC,UAAU,EAAE,gBAAgB,QAAQ;;;;;;;;;;;;;;;;;;gCAKhE,eAAe,WAAW,kBACzB,6LAAC;;sDACC,6LAAC,sIAAK;4CAAC,WAAU;sDAAgC;;;;;;sDACjD,6LAAC;4CAAK,WAAU;sDACb,eAAe,WAAW;;;;;;;;;;;;8CAKjC,6LAAC;oCAAI,WAAU;;sDACb,6LAAC;4CAAE,WAAU;sDAA2B;;;;;;sDACxC,6LAAC;4CAAI,WAAU;;8DACb,6LAAC;;wDAAK,eAAe,MAAM,CAAC,MAAM;wDAAE,OAAO,GAAG,QAAQ,CAAC,eAAe,MAAM,CAAC,UAAU,EAAE;;;;;;;8DACzF,6LAAC;;wDAAK,eAAe,MAAM,CAAC,MAAM;wDAAE,OAAO,KAAK,QAAQ,CAAC,eAAe,MAAM,CAAC,UAAU,EAAE;;;;;;;8DAC3F,6LAAC;;wDAAK,eAAe,MAAM,CAAC,MAAM;wDAAE,OAAO,QAAQ,QAAQ,CAAC,eAAe,MAAM,CAAC,UAAU,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAShH;GAvbgB;;QACC,kJAAS;QAMxB,sLAAqB;;;KAPP"}}]
}