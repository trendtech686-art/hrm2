{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/use-settings-page-header.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { usePathname } from 'next/navigation';\r\nimport { Settings2 } from 'lucide-react';\r\nimport { usePageHeader, type PageHeaderState, type PageHeaderDocLink } from '../../contexts/page-header-context';\r\nimport type { BreadcrumbItem } from '../../lib/breadcrumb-system';\r\n\r\nexport type SettingsPageHeaderOptions = Omit<PageHeaderState, 'title' | 'docLink'> & {\r\n  title: string;\r\n  icon?: React.ReactNode;\r\n  docLink?: string | PageHeaderDocLink;\r\n};\r\n\r\nconst defaultDocLabel = 'Xem hướng dẫn';\r\nconst baseBreadcrumb: BreadcrumbItem[] = [\r\n  { label: 'Trang chủ', href: '/', isCurrent: false },\r\n  { label: 'Cài đặt', href: '/settings', isCurrent: false },\r\n];\r\n\r\nconst normalizeLabel = (label?: string) => label?.trim().toLocaleLowerCase('vi');\r\nconst isHomeCrumb = (item: BreadcrumbItem) => item.href === '/' || normalizeLabel(item.label) === 'trang chủ';\r\nconst isSettingsCrumb = (item: BreadcrumbItem) => item.href === '/settings' || normalizeLabel(item.label) === 'cài đặt';\r\n\r\nexport function useSettingsPageHeader(options: SettingsPageHeaderOptions) {\r\n  const pathname = usePathname();\r\n  const { title, icon, docLink, breadcrumb, ...rest } = options;\r\n\r\n  const normalizedDocLink = React.useMemo<PageHeaderDocLink | undefined>(() => {\r\n    if (!docLink) return undefined;\r\n    if (typeof docLink === 'string') {\r\n      return { href: docLink, label: defaultDocLabel };\r\n    }\r\n    return {\r\n      href: docLink.href,\r\n      label: docLink.label ?? defaultDocLabel,\r\n    };\r\n  }, [docLink]);\r\n\r\n  const decoratedTitle = React.useMemo(() => (\r\n    <span className=\"inline-flex items-center gap-2\">\r\n      {(icon ?? <Settings2 className=\"h-5 w-5 text-muted-foreground\" aria-hidden=\"true\" />)}\r\n      <span>{title}</span>\r\n    </span>\r\n  ), [icon, title]);\r\n\r\n  const normalizedBreadcrumb = React.useMemo(() => {\r\n    const custom = (breadcrumb ?? []).map((item) => ({\r\n      ...item,\r\n      href: item.href || pathname,\r\n    }));\r\n\r\n    let merged: BreadcrumbItem[] = custom.length\r\n      ? [...custom]\r\n      : [{ label: title, href: pathname, isCurrent: true }];\r\n\r\n    if (!merged.some(isHomeCrumb)) {\r\n      merged = [{ ...baseBreadcrumb[0] }, ...merged];\r\n    }\r\n\r\n    if (!merged.some(isSettingsCrumb)) {\r\n      const homeIndex = merged.findIndex(isHomeCrumb);\r\n      const insertionIndex = homeIndex >= 0 ? homeIndex + 1 : 0;\r\n      merged = [\r\n        ...merged.slice(0, insertionIndex),\r\n        { ...baseBreadcrumb[1] },\r\n        ...merged.slice(insertionIndex),\r\n      ];\r\n    }\r\n\r\n    return merged.map((item, index) => ({\r\n      ...item,\r\n      isCurrent: index === merged.length - 1,\r\n    }));\r\n  }, [breadcrumb, pathname, title]);\r\n\r\n  return usePageHeader({\r\n    ...rest,\r\n    breadcrumb: normalizedBreadcrumb,\r\n    title: decoratedTitle,\r\n    docLink: normalizedDocLink,\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;;;;;;;AASA,MAAM,kBAAkB;AACxB,MAAM,iBAAmC;IACvC;QAAE,OAAO;QAAa,MAAM;QAAK,WAAW;IAAM;IAClD;QAAE,OAAO;QAAW,MAAM;QAAa,WAAW;IAAM;CACzD;AAED,MAAM,iBAAiB,CAAC,QAAmB,OAAO,OAAO,kBAAkB;AAC3E,MAAM,cAAc,CAAC,OAAyB,KAAK,IAAI,KAAK,OAAO,eAAe,KAAK,KAAK,MAAM;AAClG,MAAM,kBAAkB,CAAC,OAAyB,KAAK,IAAI,KAAK,eAAe,eAAe,KAAK,KAAK,MAAM;AAEvG,SAAS,sBAAsB,OAAkC;;IACtE,MAAM,WAAW,IAAA,oJAAW;IAC5B,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,EAAE,UAAU,EAAE,GAAG,MAAM,GAAG;IAEtD,MAAM,oBAAoB,wKAAa;4DAAgC;YACrE,IAAI,CAAC,SAAS,OAAO;YACrB,IAAI,OAAO,YAAY,UAAU;gBAC/B,OAAO;oBAAE,MAAM;oBAAS,OAAO;gBAAgB;YACjD;YACA,OAAO;gBACL,MAAM,QAAQ,IAAI;gBAClB,OAAO,QAAQ,KAAK,IAAI;YAC1B;QACF;2DAAG;QAAC;KAAQ;IAEZ,MAAM,iBAAiB,wKAAa;yDAAC,kBACnC,6LAAC;gBAAK,WAAU;;oBACZ,sBAAQ,6LAAC,gOAAS;wBAAC,WAAU;wBAAgC,eAAY;;;;;;kCAC3E,6LAAC;kCAAM;;;;;;;;;;;;wDAER;QAAC;QAAM;KAAM;IAEhB,MAAM,uBAAuB,wKAAa;+DAAC;YACzC,MAAM,SAAS,CAAC,cAAc,EAAE,EAAE,GAAG;8EAAC,CAAC,OAAS,CAAC;wBAC/C,GAAG,IAAI;wBACP,MAAM,KAAK,IAAI,IAAI;oBACrB,CAAC;;YAED,IAAI,SAA2B,OAAO,MAAM,GACxC;mBAAI;aAAO,GACX;gBAAC;oBAAE,OAAO;oBAAO,MAAM;oBAAU,WAAW;gBAAK;aAAE;YAEvD,IAAI,CAAC,OAAO,IAAI,CAAC,cAAc;gBAC7B,SAAS;oBAAC;wBAAE,GAAG,cAAc,CAAC,EAAE;oBAAC;uBAAM;iBAAO;YAChD;YAEA,IAAI,CAAC,OAAO,IAAI,CAAC,kBAAkB;gBACjC,MAAM,YAAY,OAAO,SAAS,CAAC;gBACnC,MAAM,iBAAiB,aAAa,IAAI,YAAY,IAAI;gBACxD,SAAS;uBACJ,OAAO,KAAK,CAAC,GAAG;oBACnB;wBAAE,GAAG,cAAc,CAAC,EAAE;oBAAC;uBACpB,OAAO,KAAK,CAAC;iBACjB;YACH;YAEA,OAAO,OAAO,GAAG;uEAAC,CAAC,MAAM,QAAU,CAAC;wBAClC,GAAG,IAAI;wBACP,WAAW,UAAU,OAAO,MAAM,GAAG;oBACvC,CAAC;;QACH;8DAAG;QAAC;QAAY;QAAU;KAAM;IAEhC,OAAO,IAAA,0JAAa,EAAC;QACnB,GAAG,IAAI;QACP,YAAY;QACZ,OAAO;QACP,SAAS;IACX;AACF;GA1DgB;;QACG,oJAAW;QAmDrB,0JAAa"}},
    {"offset": {"line": 153, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/inventory/product-category-store.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { asSystemId, asBusinessId, type SystemId, type BusinessId } from '@/lib/id-types';\r\nimport type { ProductCategory } from './types';\r\n\r\nconst generateSystemId = (counter: number): SystemId => {\r\n  return asSystemId(`CATEGORY${String(counter + 1).padStart(6, '0')}`);\r\n};\r\n\r\nconst generateBusinessId = (counter: number): BusinessId => {\r\n  return asBusinessId(`DM${String(counter + 1).padStart(6, '0')}`);\r\n};\r\n\r\n// Helper to calculate path and level\r\nconst calculatePathAndLevel = (category: ProductCategory, allCategories: ProductCategory[]): { path: string; level: number } => {\r\n  if (!category.parentId) {\r\n    return { path: category.name, level: 0 };\r\n  }\r\n  \r\n  const parent = allCategories.find(c => c.systemId === category.parentId);\r\n  if (!parent) {\r\n    return { path: category.name, level: 0 };\r\n  }\r\n  \r\n  const parentInfo = calculatePathAndLevel(parent, allCategories);\r\n  return {\r\n    path: `${parentInfo.path} > ${category.name}`,\r\n    level: parentInfo.level + 1\r\n  };\r\n};\r\n\r\ninterface ProductCategoryState {\r\n  data: ProductCategory[];\r\n  counter: number;\r\n  initialized: boolean;\r\n  add: (category: Omit<ProductCategory, 'systemId' | 'id' | 'path' | 'level'> & { id?: string }) => ProductCategory;\r\n  update: (systemId: SystemId, updates: Partial<ProductCategory>) => void;\r\n  remove: (systemId: SystemId) => void;\r\n  findById: (systemId: SystemId) => ProductCategory | undefined;\r\n  findByBusinessId: (id: BusinessId) => ProductCategory | undefined;\r\n  getActive: () => ProductCategory[];\r\n  getByParent: (parentId?: SystemId) => ProductCategory[];\r\n  updateSortOrder: (systemId: SystemId, newSortOrder: number) => void;\r\n  moveCategory: (systemId: SystemId, newParentId: SystemId | undefined, newSortOrder: number) => void;\r\n  recalculatePaths: () => void;\r\n  getNextId: () => BusinessId;\r\n  isBusinessIdExists: (id: string) => boolean;\r\n  loadFromAPI: () => Promise<void>;\r\n}\r\n\r\n// API sync helper\r\nasync function syncCategoryToAPI(category: ProductCategory, action: 'create' | 'update' | 'delete'): Promise<boolean> {\r\n  try {\r\n    const endpoint = action === 'create' ? '/api/categories' : `/api/categories/${category.systemId}`;\r\n    const response = await fetch(endpoint, {\r\n      method: action === 'create' ? 'POST' : action === 'delete' ? 'DELETE' : 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify(category),\r\n    });\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error('syncCategoryToAPI error:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const useProductCategoryStore = create<ProductCategoryState>()(\r\n  (set, get) => ({\r\n    data: [],\r\n    counter: 0,\r\n    initialized: false,\r\n      \r\n    add: (category) => {\r\n        const currentCounter = get().counter;\r\n        const allData = get().data;\r\n        const { id, ...rest } = category;\r\n        \r\n        const businessId = id && id.trim() \r\n          ? asBusinessId(id.trim())\r\n          : generateBusinessId(currentCounter);\r\n        \r\n        const { path, level } = calculatePathAndLevel(\r\n          { ...rest, systemId: 'temp' as SystemId, id: businessId, path: '', level: 0 } as ProductCategory,\r\n          allData\r\n        );\r\n        \r\n        const newCategory: ProductCategory = {\r\n          ...rest,\r\n          systemId: generateSystemId(currentCounter),\r\n          id: businessId,\r\n          path,\r\n          level,\r\n          createdAt: new Date().toISOString(),\r\n          isDeleted: false,\r\n          isActive: category.isActive !== undefined ? category.isActive : true,\r\n        };\r\n        set((state) => ({ \r\n          data: [...state.data, newCategory],\r\n          counter: state.counter + 1,\r\n        }));\r\n        get().recalculatePaths();\r\n        return newCategory;\r\n      },\r\n      \r\n      update: (systemId, updates) => {\r\n        set((state) => ({\r\n          data: state.data.map((item) =>\r\n            item.systemId === systemId\r\n              ? { ...item, ...updates, updatedAt: new Date().toISOString() }\r\n              : item\r\n          ),\r\n        }));\r\n        get().recalculatePaths();\r\n      },\r\n      \r\n      remove: (systemId) => {\r\n        set((state) => ({\r\n          data: state.data.map((item) =>\r\n            item.systemId === systemId\r\n              ? { ...item, isDeleted: true, updatedAt: new Date().toISOString() }\r\n              : item\r\n          ),\r\n        }));\r\n      },\r\n      \r\n      findById: (systemId) => {\r\n        return get().data.find((item) => item.systemId === systemId && !item.isDeleted);\r\n      },\r\n      \r\n      findByBusinessId: (id) => {\r\n        return get().data.find((item) => item.id === id && !item.isDeleted);\r\n      },\r\n      \r\n      getActive: () => {\r\n        return get().data.filter((item) => !item.isDeleted && item.isActive);\r\n      },\r\n      \r\n      getByParent: (parentId) => {\r\n        return get().data.filter(\r\n          (item) => !item.isDeleted && item.isActive && item.parentId === parentId\r\n        ).sort((a, b) => (a.sortOrder ?? 0) - (b.sortOrder ?? 0));\r\n      },\r\n\r\n      updateSortOrder: (systemId, newSortOrder) => {\r\n        set((state) => ({\r\n          data: state.data.map((item) =>\r\n            item.systemId === systemId\r\n              ? { ...item, sortOrder: newSortOrder, updatedAt: new Date().toISOString() }\r\n              : item\r\n          ),\r\n        }));\r\n      },\r\n\r\n      moveCategory: (systemId, newParentId, newSortOrder) => {\r\n        set((state) => ({\r\n          data: state.data.map((item) =>\r\n            item.systemId === systemId\r\n              ? { \r\n                  ...item, \r\n                  parentId: newParentId, \r\n                  sortOrder: newSortOrder,\r\n                  updatedAt: new Date().toISOString() \r\n                }\r\n              : item\r\n          ),\r\n        }));\r\n        get().recalculatePaths();\r\n      },\r\n\r\n      recalculatePaths: () => {\r\n        set((state) => {\r\n          const allData = [...state.data];\r\n          const updated = allData.map(cat => {\r\n            if (cat.isDeleted) return cat;\r\n            const { path, level } = calculatePathAndLevel(cat, allData);\r\n            return { ...cat, path, level };\r\n          });\r\n          return { data: updated };\r\n        });\r\n      },\r\n      \r\n      getNextId: () => generateBusinessId(get().counter),\r\n      \r\n      isBusinessIdExists: (id: string) => get().data.some((item) => String(item.id) === id),\r\n\r\n      loadFromAPI: async () => {\r\n        if (get().initialized) return;\r\n        try {\r\n          const response = await fetch('/api/categories?all=true');\r\n          if (response.ok) {\r\n            const json = await response.json();\r\n            if (json.data && Array.isArray(json.data)) {\r\n              const categories: ProductCategory[] = json.data.map((item: Record<string, unknown>) => ({\r\n                ...item,\r\n                systemId: asSystemId(item.systemId as string),\r\n                id: asBusinessId(item.id as string),\r\n                parentId: item.parentId ? asSystemId(item.parentId as string) : undefined,\r\n                // Add default values for fields not in database\r\n                isActive: item.isDeleted !== true,\r\n                color: item.color as string || '#6366f1',\r\n                path: '',\r\n                level: 0,\r\n              }));\r\n              set({ \r\n                data: categories, \r\n                counter: categories.length,\r\n                initialized: true,\r\n              });\r\n              get().recalculatePaths();\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('loadFromAPI error:', error);\r\n        }\r\n        set({ initialized: true });\r\n      },\r\n    })\r\n);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 354, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/inventory/brand-store.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { asSystemId, asBusinessId, type SystemId, type BusinessId } from '@/lib/id-types';\r\nimport type { Brand } from './types';\r\n\r\ninterface BrandState {\r\n  data: Brand[];\r\n  counter: number;\r\n  initialized: boolean;\r\n  add: (brand: Omit<Brand, 'systemId' | 'createdAt' | 'updatedAt'> & { id?: string }) => void;\r\n  update: (systemId: SystemId, brand: Partial<Brand>) => void;\r\n  remove: (systemId: SystemId) => void;\r\n  getActive: () => Brand[];\r\n  findById: (systemId: SystemId) => Brand | undefined;\r\n  findByBusinessId: (id: BusinessId) => Brand | undefined;\r\n  getNextId: () => BusinessId;\r\n  isBusinessIdExists: (id: string) => boolean;\r\n  loadFromAPI: () => Promise<void>;\r\n}\r\n\r\nconst generateSystemId = (currentCounter: number): SystemId => {\r\n  return asSystemId(`BRAND${String(currentCounter + 1).padStart(6, '0')}`);\r\n};\r\n\r\nconst generateBusinessId = (currentCounter: number): BusinessId => {\r\n  return asBusinessId(`TH${String(currentCounter + 1).padStart(6, '0')}`);\r\n};\r\n\r\n// API sync helper\r\nasync function syncBrandToAPI(brand: Brand, action: 'create' | 'update' | 'delete'): Promise<boolean> {\r\n  try {\r\n    const endpoint = action === 'create' ? '/api/brands' : `/api/brands/${brand.systemId}`;\r\n    const response = await fetch(endpoint, {\r\n      method: action === 'create' ? 'POST' : action === 'delete' ? 'DELETE' : 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify(brand),\r\n    });\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error('syncBrandToAPI error:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const useBrandStore = create<BrandState>()(\r\n  (set, get) => ({\r\n    data: [],\r\n    counter: 0,\r\n    initialized: false,\r\n      \r\n    add: (brand) => {\r\n        const currentCounter = get().counter;\r\n        const { id, ...rest } = brand;\r\n        const businessId = id && id.trim() \r\n          ? asBusinessId(id.trim())\r\n          : generateBusinessId(currentCounter);\r\n          \r\n        set((state) => ({\r\n          data: [\r\n            ...state.data,\r\n            {\r\n              ...rest,\r\n              systemId: generateSystemId(currentCounter),\r\n              id: businessId,\r\n              createdAt: new Date().toISOString(),\r\n              updatedAt: new Date().toISOString(),\r\n              isActive: brand.isActive ?? true,\r\n              isDeleted: false,\r\n            },\r\n          ],\r\n          counter: state.counter + 1,\r\n        }));\r\n      },\r\n      \r\n      update: (systemId, brand) => set((state) => ({\r\n        data: state.data.map((item) =>\r\n          item.systemId === systemId\r\n            ? { ...item, ...brand, updatedAt: new Date().toISOString() }\r\n            : item\r\n        ),\r\n      })),\r\n      \r\n      remove: (systemId) => set((state) => ({\r\n        data: state.data.map((item) =>\r\n          item.systemId === systemId\r\n            ? { ...item, isDeleted: true, updatedAt: new Date().toISOString() }\r\n            : item\r\n        ),\r\n      })),\r\n      \r\n      getActive: () => get().data.filter((item) => !item.isDeleted && item.isActive),\r\n      \r\n      findById: (systemId) => get().data.find((item) => item.systemId === systemId),\r\n      \r\n      findByBusinessId: (id) => get().data.find((item) => item.id === id),\r\n      \r\n      getNextId: () => generateBusinessId(get().counter),\r\n      \r\n      isBusinessIdExists: (id: string) => get().data.some((item) => String(item.id) === id),\r\n\r\n      loadFromAPI: async () => {\r\n        if (get().initialized) return;\r\n        try {\r\n          const response = await fetch('/api/brands?all=true');\r\n          if (response.ok) {\r\n            const json = await response.json();\r\n            if (json.data && Array.isArray(json.data)) {\r\n              const brands: Brand[] = json.data.map((item: Record<string, unknown>) => ({\r\n                ...item,\r\n                systemId: asSystemId(item.systemId as string),\r\n                id: asBusinessId(item.id as string),\r\n                // Add default values for fields not in database\r\n                isActive: item.isDeleted !== true,\r\n              }));\r\n              set({ \r\n                data: brands, \r\n                counter: brands.length,\r\n                initialized: true,\r\n              });\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('loadFromAPI error:', error);\r\n        }\r\n        set({ initialized: true });\r\n      },\r\n    })\r\n);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 464, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pricing/store.ts"],"sourcesContent":["import type { SystemId } from '@/lib/id-types';\r\nimport type { UseBoundStore, StoreApi } from 'zustand';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { PricingPolicy } from './types';\r\nimport { createCrudStore, type CrudState } from '../../../lib/store-factory';\r\nimport { getCurrentUserSystemId } from '../../../contexts/auth-context';\r\n\r\ntype PricingPolicyStore = CrudState<PricingPolicy> & {\r\n  setDefault: (systemId: SystemId) => void;\r\n  getActive: () => PricingPolicy[];\r\n  getInactive: () => PricingPolicy[];\r\n};\r\n\r\nconst baseStore = createCrudStore<PricingPolicy>([], 'pricing-settings', {\r\n  businessIdField: 'id',\r\n  getCurrentUser: getCurrentUserSystemId,\r\n  apiEndpoint: '/api/settings/data?type=pricing-policy',\r\n}) as UseBoundStore<StoreApi<PricingPolicyStore>>;\r\n\r\nconst originalAdd = baseStore.getState().add;\r\n\r\nconst setDefaultAction = (systemId: SystemId) => {\r\n  baseStore.setState((current) => {\r\n    const target = current.data.find((policy) => policy.systemId === systemId);\r\n    if (!target) return current;\r\n\r\n    const updatedData = current.data.map((policy) => (\r\n      policy.type === target.type\r\n        ? { ...policy, isDefault: policy.systemId === systemId }\r\n        : policy\r\n    ));\r\n\r\n    return { ...current, data: updatedData };\r\n  });\r\n};\r\n\r\nconst enhancedAdd: typeof originalAdd = (item) => {\r\n  const newItem = originalAdd(item);\r\n  const storeData = baseStore.getState().data;\r\n  const hasDefaultForType = storeData\r\n    .filter((policy) => policy.type === newItem.type)\r\n    .some((policy) => policy.isDefault);\r\n\r\n  if (item.isDefault) {\r\n    setDefaultAction(newItem.systemId);\r\n  } else if (!hasDefaultForType) {\r\n    setDefaultAction(newItem.systemId);\r\n  }\r\n\r\n  return newItem;\r\n};\r\n\r\nbaseStore.setState((state) => ({\r\n  ...state,\r\n  add: enhancedAdd,\r\n  setDefault: setDefaultAction,\r\n  getActive: () => baseStore.getState().data.filter((policy) => policy.isActive),\r\n  getInactive: () => baseStore.getState().data.filter((policy) => !policy.isActive),\r\n}));\r\n\r\nexport const usePricingPolicyStore = baseStore;\r\n"],"names":[],"mappings":";;;;AAIA;AACA;;;AAQA,MAAM,YAAY,IAAA,6IAAe,EAAgB,EAAE,EAAE,oBAAoB;IACvE,iBAAiB;IACjB,gBAAgB,yJAAsB;IACtC,aAAa;AACf;AAEA,MAAM,cAAc,UAAU,QAAQ,GAAG,GAAG;AAE5C,MAAM,mBAAmB,CAAC;IACxB,UAAU,QAAQ,CAAC,CAAC;QAClB,MAAM,SAAS,QAAQ,IAAI,CAAC,IAAI,CAAC,CAAC,SAAW,OAAO,QAAQ,KAAK;QACjE,IAAI,CAAC,QAAQ,OAAO;QAEpB,MAAM,cAAc,QAAQ,IAAI,CAAC,GAAG,CAAC,CAAC,SACpC,OAAO,IAAI,KAAK,OAAO,IAAI,GACvB;gBAAE,GAAG,MAAM;gBAAE,WAAW,OAAO,QAAQ,KAAK;YAAS,IACrD;QAGN,OAAO;YAAE,GAAG,OAAO;YAAE,MAAM;QAAY;IACzC;AACF;AAEA,MAAM,cAAkC,CAAC;IACvC,MAAM,UAAU,YAAY;IAC5B,MAAM,YAAY,UAAU,QAAQ,GAAG,IAAI;IAC3C,MAAM,oBAAoB,UACvB,MAAM,CAAC,CAAC,SAAW,OAAO,IAAI,KAAK,QAAQ,IAAI,EAC/C,IAAI,CAAC,CAAC,SAAW,OAAO,SAAS;IAEpC,IAAI,KAAK,SAAS,EAAE;QAClB,iBAAiB,QAAQ,QAAQ;IACnC,OAAO,IAAI,CAAC,mBAAmB;QAC7B,iBAAiB,QAAQ,QAAQ;IACnC;IAEA,OAAO;AACT;AAEA,UAAU,QAAQ,CAAC,CAAC,QAAU,CAAC;QAC7B,GAAG,KAAK;QACR,KAAK;QACL,YAAY;QACZ,WAAW,IAAM,UAAU,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,SAAW,OAAO,QAAQ;QAC7E,aAAa,IAAM,UAAU,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,SAAW,CAAC,OAAO,QAAQ;IAClF,CAAC;AAEM,MAAM,wBAAwB"}}]
}