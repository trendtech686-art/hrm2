{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/employees/store.ts"],"sourcesContent":["import { createCrudStore, CrudState } from '../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { Employee } from './types';\r\nimport type { HistoryEntry } from '../../components/ActivityHistory';\r\nimport Fuse from 'fuse.js';\r\nimport { getCurrentUserSystemId } from '../../contexts/auth-context';\r\nimport { registerBreadcrumbStore } from '../../lib/breadcrumb-generator'; // ‚úÖ NEW\r\nimport { type SystemId } from '../../lib/id-types';\r\nimport { createInMemoryRepository } from '../../repositories/in-memory-repository';\r\nimport { \r\n  createHistoryEntry, \r\n  getCurrentUserInfo,\r\n  appendHistoryEntry \r\n} from '../../lib/activity-history-helper';\r\n\r\ntype EmployeePersistenceAdapter = {\r\n  create: (payload: Omit<Employee, 'systemId'>) => Promise<Employee>;\r\n  update: (systemId: SystemId, payload: Partial<Employee>) => Promise<Employee>;\r\n  softDelete: (systemId: SystemId) => Promise<void>;\r\n  restore: (systemId: SystemId) => Promise<Employee | undefined>;\r\n  hardDelete: (systemId: SystemId) => Promise<void>;\r\n};\r\n\r\nconst baseStore = createCrudStore<Employee>([], 'employees', {\r\n  businessIdField: 'id',\r\n  getCurrentUser: getCurrentUserSystemId, // ‚úÖ Track who creates/updates\r\n  apiEndpoint: '/api/employees',\r\n});\r\n\r\n// ‚úÖ Wrap add method to include activity history\r\nconst originalAdd = baseStore.getState().add;\r\nconst wrappedAdd = (item: Omit<Employee, 'systemId'>): Employee => {\r\n  const userInfo = getCurrentUserInfo();\r\n  const historyEntry = createHistoryEntry(\r\n    'created',\r\n    `${userInfo.name} ƒë√£ t·∫°o h·ªì s∆° nh√¢n vi√™n ${item.fullName} (${item.id})`,\r\n    userInfo\r\n  );\r\n  \r\n  const newEmployee = originalAdd({\r\n    ...item,\r\n    activityHistory: [historyEntry],\r\n  });\r\n  \r\n  return newEmployee;\r\n};\r\n\r\n// ‚úÖ Wrap update method to include activity history\r\nconst originalUpdate = baseStore.getState().update;\r\nconst wrappedUpdate = (systemId: SystemId, updates: Partial<Employee>): void => {\r\n  const currentEmployee = baseStore.getState().data.find(e => e.systemId === systemId);\r\n  if (!currentEmployee) return;\r\n  \r\n  const userInfo = getCurrentUserInfo();\r\n  const historyEntries: HistoryEntry[] = [];\r\n  \r\n  // Track important field changes\r\n  const trackedFields: { key: keyof Employee; label: string }[] = [\r\n    { key: 'fullName', label: 'h·ªç t√™n' },\r\n    { key: 'jobTitle', label: 'ch·ª©c danh' },\r\n    { key: 'department', label: 'ph√≤ng ban' },\r\n    { key: 'employmentStatus', label: 'tr·∫°ng th√°i l√†m vi·ªác' },\r\n    { key: 'employeeType', label: 'lo·∫°i nh√¢n vi√™n' },\r\n    { key: 'baseSalary', label: 'l∆∞∆°ng c∆° b·∫£n' },\r\n    { key: 'phone', label: 's·ªë ƒëi·ªán tho·∫°i' },\r\n    { key: 'workEmail', label: 'email c√¥ng vi·ªác' },\r\n    { key: 'role', label: 'vai tr√≤' },\r\n  ];\r\n  \r\n  trackedFields.forEach(({ key, label }) => {\r\n    if (updates[key] !== undefined && updates[key] !== currentEmployee[key]) {\r\n      const oldValue = currentEmployee[key];\r\n      const newValue = updates[key];\r\n      \r\n      // Format values for display\r\n      let oldDisplay = oldValue;\r\n      let newDisplay = newValue;\r\n      \r\n      if (key === 'baseSalary') {\r\n        oldDisplay = new Intl.NumberFormat('vi-VN').format(oldValue as number) + 'ƒë';\r\n        newDisplay = new Intl.NumberFormat('vi-VN').format(newValue as number) + 'ƒë';\r\n      }\r\n      \r\n      historyEntries.push(createHistoryEntry(\r\n        'updated',\r\n        `${userInfo.name} ƒë√£ c·∫≠p nh·∫≠t ${label}: \"${oldDisplay || '(tr·ªëng)'}\" ‚Üí \"${newDisplay}\"`,\r\n        userInfo,\r\n        { field: key, oldValue, newValue }\r\n      ));\r\n    }\r\n  });\r\n  \r\n  // If status changed specifically\r\n  if (updates.employmentStatus && updates.employmentStatus !== currentEmployee.employmentStatus) {\r\n    historyEntries.push(createHistoryEntry(\r\n      'status_changed',\r\n      `${userInfo.name} ƒë√£ thay ƒë·ªïi tr·∫°ng th√°i l√†m vi·ªác t·ª´ \"${currentEmployee.employmentStatus}\" th√†nh \"${updates.employmentStatus}\"`,\r\n      userInfo,\r\n      { field: 'employmentStatus', oldValue: currentEmployee.employmentStatus, newValue: updates.employmentStatus }\r\n    ));\r\n  }\r\n  \r\n  // If no specific changes tracked, add generic update entry\r\n  if (historyEntries.length === 0) {\r\n    historyEntries.push(createHistoryEntry(\r\n      'updated',\r\n      `${userInfo.name} ƒë√£ c·∫≠p nh·∫≠t th√¥ng tin nh√¢n vi√™n`,\r\n      userInfo\r\n    ));\r\n  }\r\n  \r\n  const updatedHistory = appendHistoryEntry(currentEmployee.activityHistory, ...historyEntries);\r\n  \r\n  originalUpdate(systemId, {\r\n    ...updates,\r\n    activityHistory: updatedHistory,\r\n  });\r\n};\r\n\r\n// ‚úÖ Override base store methods\r\nbaseStore.setState({\r\n  add: wrappedAdd,\r\n  update: wrappedUpdate,\r\n});\r\n\r\nexport const employeeRepository = createInMemoryRepository<Employee>(() => baseStore.getState());\r\n\r\n// ‚úÖ API-backed persistence adapter - syncs to PostgreSQL\r\nconst API_ENDPOINT = '/api/employees';\r\n\r\nconst persistence: EmployeePersistenceAdapter = {\r\n  create: async (payload) => {\r\n    // First create locally for immediate UI update\r\n    const localResult = await employeeRepository.create(payload);\r\n    \r\n    // Then sync to API (background)\r\n    try {\r\n      const response = await fetch(API_ENDPOINT, {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ ...payload, systemId: localResult.systemId }),\r\n      });\r\n      if (!response.ok) {\r\n        console.warn('[Employee API] Create sync failed, data saved locally');\r\n      } else {\r\n        console.log('[Employee API] Created:', localResult.systemId);\r\n      }\r\n    } catch (e) {\r\n      console.warn('[Employee API] Create sync error:', e);\r\n    }\r\n    \r\n    return localResult;\r\n  },\r\n  update: async (systemId, payload) => {\r\n    // First update locally\r\n    const localResult = await employeeRepository.update(systemId, payload);\r\n    \r\n    // Then sync to API\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}`, {\r\n        method: 'PATCH',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(payload),\r\n      });\r\n      if (!response.ok) {\r\n        console.warn('[Employee API] Update sync failed');\r\n      } else {\r\n        console.log('[Employee API] Updated:', systemId);\r\n      }\r\n    } catch (e) {\r\n      console.warn('[Employee API] Update sync error:', e);\r\n    }\r\n    \r\n    return localResult;\r\n  },\r\n  softDelete: async (systemId) => {\r\n    // First delete locally\r\n    await employeeRepository.softDelete(systemId);\r\n    \r\n    // Then sync to API\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ hard: false }),\r\n      });\r\n      if (!response.ok) {\r\n        console.warn('[Employee API] Soft delete sync failed');\r\n      } else {\r\n        console.log('[Employee API] Soft deleted:', systemId);\r\n      }\r\n    } catch (e) {\r\n      console.warn('[Employee API] Soft delete sync error:', e);\r\n    }\r\n  },\r\n  restore: async (systemId) => {\r\n    // First restore locally\r\n    const localResult = await employeeRepository.restore(systemId);\r\n    \r\n    // Then sync to API\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}/restore`, {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n      });\r\n      if (!response.ok) {\r\n        console.warn('[Employee API] Restore sync failed');\r\n      } else {\r\n        console.log('[Employee API] Restored:', systemId);\r\n      }\r\n    } catch (e) {\r\n      console.warn('[Employee API] Restore sync error:', e);\r\n    }\r\n    \r\n    return localResult;\r\n  },\r\n  hardDelete: async (systemId) => {\r\n    // First delete locally\r\n    await employeeRepository.hardDelete(systemId);\r\n    \r\n    // Then sync to API\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ hard: true }),\r\n      });\r\n      if (!response.ok) {\r\n        console.warn('[Employee API] Hard delete sync failed');\r\n      } else {\r\n        console.log('[Employee API] Hard deleted:', systemId);\r\n      }\r\n    } catch (e) {\r\n      console.warn('[Employee API] Hard delete sync error:', e);\r\n    }\r\n  },\r\n};\r\n\r\n// ‚úÖ Register for breadcrumb auto-generation\r\nregisterBreadcrumbStore('employees', () => baseStore.getState());\r\n\r\n// Define enhanced interface\r\ninterface EmployeeStoreState extends CrudState<Employee> {\r\n  searchEmployees: (query: string, page: number, limit?: number) => Promise<{ items: { value: string; label: string }[], hasNextPage: boolean }>;\r\n  permanentDelete: (systemId: SystemId) => Promise<void>;\r\n  persistence: EmployeePersistenceAdapter;\r\n}\r\n\r\ntype EmployeeStoreHook = (() => EmployeeStoreState) & {\r\n  getState: () => EmployeeStoreState;\r\n  persistence: EmployeePersistenceAdapter;\r\n};\r\n\r\n// Augmented methods\r\nconst augmentedMethods = {\r\n    // FIX: Changed `page: number = 1` to `page: number` to make it a required parameter, matching Combobox prop type.\r\n    // ‚úÖ CRITICAL FIX: Create fresh Fuse instance on each search to avoid stale data\r\n    searchEmployees: async (query: string, page: number, limit: number = 20) => {\r\n        return new Promise<{ items: { value: string; label: string }[], hasNextPage: boolean }>(resolve => {\r\n            setTimeout(() => {\r\n                const allEmployees = baseStore.getState().data;\r\n                \r\n                // ‚úÖ Create fresh Fuse instance with current data\r\n                const fuse = new Fuse(allEmployees, {\r\n                    keys: ['fullName', 'id', 'phone', 'personalEmail', 'workEmail'],\r\n                    threshold: 0.3,\r\n                });\r\n                \r\n                const results = query ? fuse.search(query).map(r => r.item) : allEmployees;\r\n                \r\n                const start = (page - 1) * limit;\r\n                const end = start + limit;\r\n                const paginatedItems = results.slice(start, end);\r\n\r\n                resolve({\r\n                    items: paginatedItems.map(e => ({ value: e.systemId, label: e.fullName })),\r\n                    hasNextPage: end < results.length,\r\n                });\r\n            }, 300);\r\n        });\r\n    },\r\n    permanentDelete: async (systemId: SystemId) => {\r\n        await persistence.hardDelete(systemId);\r\n    }\r\n};\r\n\r\nconst useEmployeeStoreHook = (): EmployeeStoreState => {\r\n  const state = baseStore();\r\n  return {\r\n    ...state,\r\n    ...augmentedMethods, // This includes permanentDelete\r\n    persistence,\r\n  };\r\n};\r\n\r\nexport const useEmployeeStore = useEmployeeStoreHook as EmployeeStoreHook;\r\n\r\n// Export getState for non-hook usage\r\nuseEmployeeStore.getState = (): EmployeeStoreState => {\r\n  const state = baseStore.getState();\r\n  return {\r\n    ...state,\r\n    ...augmentedMethods,\r\n    persistence,\r\n  };\r\n};\r\n\r\nuseEmployeeStore.persistence = persistence;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 316, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/employees/api/employees-api.ts"],"sourcesContent":["/**\r\n * Employees API - Isolated API functions\r\n * \r\n * ‚ö†Ô∏è IMPORTANT: This file should ONLY contain:\r\n * - Fetch functions\r\n * - Type imports from ../types\r\n * - NO store imports\r\n * - NO cross-feature imports\r\n */\r\n\r\nimport type { Employee } from '../types';\r\n\r\nconst API_BASE = '/api/employees';\r\n\r\nexport interface EmployeesParams {\r\n  page?: number;\r\n  limit?: number;\r\n  search?: string;\r\n  departmentId?: string;\r\n  branchId?: string;\r\n  jobTitleId?: string;\r\n  status?: string;\r\n  sortBy?: string;\r\n  sortOrder?: 'asc' | 'desc';\r\n}\r\n\r\nexport interface PaginatedResponse<T> {\r\n  data: T[];\r\n  pagination: {\r\n    page: number;\r\n    limit: number;\r\n    total: number;\r\n    totalPages: number;\r\n  };\r\n}\r\n\r\nexport interface CreateEmployeeInput {\r\n  fullName: string;\r\n  email?: string;\r\n  phone?: string;\r\n  departmentId?: string;\r\n  branchId?: string;\r\n  jobTitleId?: string;\r\n  hireDate?: string;\r\n  // Optional fields for updates\r\n  isDeleted?: boolean;\r\n  employmentStatus?: string;\r\n}\r\n\r\nexport interface UpdateEmployeeInput extends Partial<CreateEmployeeInput> {\r\n  systemId: string;\r\n}\r\n\r\n/**\r\n * Fetch paginated employees list\r\n */\r\nexport async function fetchEmployees(params: EmployeesParams = {}): Promise<PaginatedResponse<Employee>> {\r\n  const { page = 1, limit = 50, ...rest } = params;\r\n  \r\n  const searchParams = new URLSearchParams({\r\n    page: String(page),\r\n    limit: String(limit),\r\n  });\r\n  \r\n  // Add optional params\r\n  Object.entries(rest).forEach(([key, value]) => {\r\n    if (value != null && value !== '') {\r\n      searchParams.set(key, String(value));\r\n    }\r\n  });\r\n  \r\n  const res = await fetch(`${API_BASE}?${searchParams}`, {\r\n    credentials: 'include',\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    throw new Error(`Failed to fetch employees: ${res.statusText}`);\r\n  }\r\n  \r\n  return res.json();\r\n}\r\n\r\n/**\r\n * Fetch single employee by ID\r\n */\r\nexport async function fetchEmployee(id: string): Promise<Employee> {\r\n  const res = await fetch(`${API_BASE}/${id}`, {\r\n    credentials: 'include',\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    throw new Error(`Failed to fetch employee ${id}: ${res.statusText}`);\r\n  }\r\n  \r\n  return res.json();\r\n}\r\n\r\n/**\r\n * Create new employee\r\n */\r\nexport async function createEmployee(data: CreateEmployeeInput): Promise<Employee> {\r\n  const res = await fetch(API_BASE, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    credentials: 'include',\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    const error = await res.json().catch(() => ({}));\r\n    throw new Error(error.message || `Failed to create employee: ${res.statusText}`);\r\n  }\r\n  \r\n  return res.json();\r\n}\r\n\r\n/**\r\n * Update existing employee\r\n */\r\nexport async function updateEmployee({ systemId, ...data }: UpdateEmployeeInput): Promise<Employee> {\r\n  const res = await fetch(`${API_BASE}/${systemId}`, {\r\n    method: 'PATCH',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    credentials: 'include',\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    const error = await res.json().catch(() => ({}));\r\n    throw new Error(error.message || `Failed to update employee: ${res.statusText}`);\r\n  }\r\n  \r\n  return res.json();\r\n}\r\n\r\n/**\r\n * Delete employee (soft delete)\r\n */\r\nexport async function deleteEmployee(id: string): Promise<void> {\r\n  const res = await fetch(`${API_BASE}/${id}`, {\r\n    method: 'DELETE',\r\n    credentials: 'include',\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    const error = await res.json().catch(() => ({}));\r\n    throw new Error(error.message || `Failed to delete employee: ${res.statusText}`);\r\n  }\r\n}\r\n\r\n/**\r\n * Search employees for autocomplete\r\n */\r\nexport async function searchEmployees(query: string, limit = 20): Promise<Employee[]> {\r\n  const res = await fetch(`${API_BASE}?search=${encodeURIComponent(query)}&limit=${limit}`, {\r\n    credentials: 'include',\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    throw new Error(`Failed to search employees: ${res.statusText}`);\r\n  }\r\n  \r\n  const json = await res.json();\r\n  return json.data || [];\r\n}\r\n\r\n/**\r\n * Fetch employees by department\r\n */\r\nexport async function fetchEmployeesByDepartment(departmentId: string): Promise<Employee[]> {\r\n  const res = await fetch(`${API_BASE}?departmentId=${departmentId}&limit=100`, {\r\n    credentials: 'include',\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    throw new Error(`Failed to fetch employees by department: ${res.statusText}`);\r\n  }\r\n  \r\n  const json = await res.json();\r\n  return json.data || [];\r\n}\r\n\r\n/**\r\n * Fetch employees by branch\r\n */\r\nexport async function fetchEmployeesByBranch(branchId: string): Promise<Employee[]> {\r\n  const res = await fetch(`${API_BASE}?branchId=${branchId}&limit=100`, {\r\n    credentials: 'include',\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    throw new Error(`Failed to fetch employees by branch: ${res.statusText}`);\r\n  }\r\n  \r\n  const json = await res.json();\r\n  return json.data || [];\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 449, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/employees/hooks/use-employees.ts"],"sourcesContent":["/**\r\n * useEmployees - React Query hooks for employees\r\n * \r\n * ‚ö†Ô∏è IMPORTANT: Direct import pattern\r\n * - Import this file directly: import { useEmployees } from '@/features/employees/hooks/use-employees'\r\n * - NEVER import from '@/features/employees' or '@/features/employees/store'\r\n * \r\n * This hook is ISOLATED - it only depends on:\r\n * - @tanstack/react-query\r\n * - Local API functions\r\n * - Local types\r\n */\r\n\r\nimport { useQuery, useMutation, useQueryClient, keepPreviousData } from '@tanstack/react-query';\r\nimport {\r\n  fetchEmployees,\r\n  fetchEmployee,\r\n  createEmployee,\r\n  updateEmployee,\r\n  deleteEmployee,\r\n  searchEmployees,\r\n  fetchEmployeesByDepartment,\r\n  fetchEmployeesByBranch,\r\n  type EmployeesParams,\r\n  type CreateEmployeeInput,\r\n  type UpdateEmployeeInput,\r\n} from '../api/employees-api';\r\n\r\n// Query keys - exported for invalidation\r\nexport const employeeKeys = {\r\n  all: ['employees'] as const,\r\n  lists: () => [...employeeKeys.all, 'list'] as const,\r\n  list: (params: EmployeesParams) => [...employeeKeys.lists(), params] as const,\r\n  details: () => [...employeeKeys.all, 'detail'] as const,\r\n  detail: (id: string) => [...employeeKeys.details(), id] as const,\r\n  search: (query: string) => [...employeeKeys.all, 'search', query] as const,\r\n  byDepartment: (id: string) => [...employeeKeys.all, 'department', id] as const,\r\n  byBranch: (id: string) => [...employeeKeys.all, 'branch', id] as const,\r\n};\r\n\r\n/**\r\n * Hook for fetching paginated employees list\r\n * \r\n * @example\r\n * ```tsx\r\n * function EmployeesPage() {\r\n *   const [page, setPage] = useState(1);\r\n *   const { data, isLoading } = useEmployees({ page, limit: 50 });\r\n *   \r\n *   return (\r\n *     <DataTable \r\n *       data={data?.data || []} \r\n *       pagination={data?.pagination}\r\n *       onPageChange={setPage}\r\n *     />\r\n *   );\r\n * }\r\n * ```\r\n */\r\nexport function useEmployees(params: EmployeesParams = {}) {\r\n  return useQuery({\r\n    queryKey: employeeKeys.list(params),\r\n    queryFn: () => fetchEmployees(params),\r\n    staleTime: 60_000, // 1 minute - employees don't change frequently\r\n    gcTime: 10 * 60 * 1000, // 10 minutes\r\n    placeholderData: keepPreviousData,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for fetching single employee by ID\r\n */\r\nexport function useEmployee(id: string | null | undefined) {\r\n  return useQuery({\r\n    queryKey: employeeKeys.detail(id!),\r\n    queryFn: () => fetchEmployee(id!),\r\n    enabled: !!id,\r\n    staleTime: 60_000,\r\n    gcTime: 10 * 60 * 1000,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for searching employees (autocomplete)\r\n */\r\nexport function useEmployeeSearch(query: string, limit = 20) {\r\n  return useQuery({\r\n    queryKey: employeeKeys.search(query),\r\n    queryFn: () => searchEmployees(query, limit),\r\n    enabled: query.length >= 2,\r\n    staleTime: 30_000,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for fetching employees by department\r\n */\r\nexport function useEmployeesByDepartment(departmentId: string | null | undefined) {\r\n  return useQuery({\r\n    queryKey: employeeKeys.byDepartment(departmentId!),\r\n    queryFn: () => fetchEmployeesByDepartment(departmentId!),\r\n    enabled: !!departmentId,\r\n    staleTime: 60_000,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for fetching employees by branch\r\n */\r\nexport function useEmployeesByBranch(branchId: string | null | undefined) {\r\n  return useQuery({\r\n    queryKey: employeeKeys.byBranch(branchId!),\r\n    queryFn: () => fetchEmployeesByBranch(branchId!),\r\n    enabled: !!branchId,\r\n    staleTime: 60_000,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for employee mutations (create/update/delete)\r\n */\r\ninterface UseEmployeeMutationsOptions {\r\n  onCreateSuccess?: (employee: unknown) => void;\r\n  onUpdateSuccess?: (employee: unknown) => void;\r\n  onDeleteSuccess?: () => void;\r\n  onError?: (error: Error) => void;\r\n}\r\n\r\nexport function useEmployeeMutations(options: UseEmployeeMutationsOptions = {}) {\r\n  const queryClient = useQueryClient();\r\n  \r\n  const create = useMutation({\r\n    mutationFn: createEmployee,\r\n    onSuccess: (data) => {\r\n      queryClient.invalidateQueries({ queryKey: employeeKeys.lists() });\r\n      options.onCreateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const update = useMutation({\r\n    mutationFn: updateEmployee,\r\n    onSuccess: (data, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: employeeKeys.detail(variables.systemId) });\r\n      queryClient.invalidateQueries({ queryKey: employeeKeys.lists() });\r\n      options.onUpdateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const remove = useMutation({\r\n    mutationFn: deleteEmployee,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: employeeKeys.all });\r\n      options.onDeleteSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  return {\r\n    create,\r\n    update,\r\n    remove,\r\n    isCreating: create.isPending,\r\n    isUpdating: update.isPending,\r\n    isDeleting: remove.isPending,\r\n    isMutating: create.isPending || update.isPending || remove.isPending,\r\n  };\r\n}\r\n\r\n/**\r\n * Hook for getting active employees\r\n */\r\nexport function useActiveEmployees(params: Omit<EmployeesParams, 'status'> = {}) {\r\n  return useEmployees({ ...params, status: 'active' });\r\n}\r\n\r\n/**\r\n * Prefetch employee for faster navigation\r\n */\r\nexport function usePrefetchEmployee() {\r\n  const queryClient = useQueryClient();\r\n  \r\n  return (id: string) => {\r\n    queryClient.prefetchQuery({\r\n      queryKey: employeeKeys.detail(id),\r\n      queryFn: () => fetchEmployee(id),\r\n      staleTime: 60_000,\r\n    });\r\n  };\r\n}\r\n\r\n// Re-export from use-all-employees for backward compatibility\r\nexport { useAllEmployees, useEmployeeOptions, useEmployeeFinder, useEmployeeSearcher } from './use-all-employees';\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 704, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/employees/hooks/use-all-employees.ts"],"sourcesContent":["/**\r\n * useAllEmployees - Convenience hook for components needing all employees as flat array\r\n * \r\n * Use case: Dropdowns, selects, comboboxes that need all employees for selection\r\n * \r\n * ‚ö†Ô∏è For paginated views, use useEmployees() instead\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { useEmployees } from './use-employees';\r\nimport type { SystemId } from '@/lib/id-types';\r\n\r\n/**\r\n * Returns all employees as a flat array\r\n * Compatible with legacy store pattern: { data: employees }\r\n */\r\nexport function useAllEmployees() {\r\n  const query = useEmployees({ limit: 30 });\r\n  \r\n  return {\r\n    data: query.data?.data || [],\r\n    isLoading: query.isLoading,\r\n    isError: query.isError,\r\n    error: query.error,\r\n  };\r\n}\r\n\r\n/**\r\n * Returns employees formatted as options for Select/Combobox\r\n */\r\nexport function useEmployeeOptions() {\r\n  const { data, isLoading } = useAllEmployees();\r\n  \r\n  const options = data.map(e => ({\r\n    value: e.systemId,\r\n    label: e.fullName,\r\n  }));\r\n  \r\n  return { options, isLoading };\r\n}\r\n\r\n/**\r\n * Helper hook to find an employee by ID from cached data\r\n * Replaces legacy findById() method\r\n */\r\nexport function useEmployeeFinder() {\r\n  const { data } = useAllEmployees();\r\n  \r\n  const findById = React.useCallback(\r\n    (systemId: SystemId | string | undefined) => {\r\n      if (!systemId) return undefined;\r\n      return data.find(e => e.systemId === systemId);\r\n    },\r\n    [data]\r\n  );\r\n  \r\n  return { findById };\r\n}\r\n\r\n/**\r\n * Helper hook for searching employees (for Combobox async search)\r\n * Returns a search function that filters cached employees\r\n */\r\nexport function useEmployeeSearcher() {\r\n  const { data } = useAllEmployees();\r\n  \r\n  const searchEmployees = React.useCallback(\r\n    async (query: string, _page = 0, limit = 100) => {\r\n      const lowerQuery = query.toLowerCase();\r\n      const filtered = data.filter(e => \r\n        e.fullName?.toLowerCase().includes(lowerQuery) ||\r\n        e.id?.toLowerCase().includes(lowerQuery) ||\r\n        e.phone?.includes(query)\r\n      );\r\n      \r\n      return {\r\n        items: filtered.slice(0, limit).map(e => ({\r\n          value: e.systemId,\r\n          label: e.fullName || e.id || 'N/A',\r\n        })),\r\n        total: filtered.length,\r\n      };\r\n    },\r\n    [data]\r\n  );\r\n  \r\n  return { searchEmployees };\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;CAMC,GAED;AACA;;;;AAOO,SAAS;;IACd,MAAM,QAAQ,IAAA,qLAAY,EAAC;QAAE,OAAO;IAAG;IAEvC,OAAO;QACL,MAAM,MAAM,IAAI,EAAE,QAAQ,EAAE;QAC5B,WAAW,MAAM,SAAS;QAC1B,SAAS,MAAM,OAAO;QACtB,OAAO,MAAM,KAAK;IACpB;AACF;GATgB;;QACA,qLAAY;;;AAarB,SAAS;;IACd,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG;IAE5B,MAAM,UAAU,KAAK,GAAG,CAAC,CAAA,IAAK,CAAC;YAC7B,OAAO,EAAE,QAAQ;YACjB,OAAO,EAAE,QAAQ;QACnB,CAAC;IAED,OAAO;QAAE;QAAS;IAAU;AAC9B;IATgB;;QACc;;;AAcvB,SAAS;;IACd,MAAM,EAAE,IAAI,EAAE,GAAG;IAEjB,MAAM,WAAW,4KAAiB;mDAChC,CAAC;YACC,IAAI,CAAC,UAAU,OAAO;YACtB,OAAO,KAAK,IAAI;2DAAC,CAAA,IAAK,EAAE,QAAQ,KAAK;;QACvC;kDACA;QAAC;KAAK;IAGR,OAAO;QAAE;IAAS;AACpB;IAZgB;;QACG;;;AAiBZ,SAAS;;IACd,MAAM,EAAE,IAAI,EAAE,GAAG;IAEjB,MAAM,kBAAkB,4KAAiB;4DACvC,OAAO,OAAe,QAAQ,CAAC,EAAE,QAAQ,GAAG;YAC1C,MAAM,aAAa,MAAM,WAAW;YACpC,MAAM,WAAW,KAAK,MAAM;6EAAC,CAAA,IAC3B,EAAE,QAAQ,EAAE,cAAc,SAAS,eACnC,EAAE,EAAE,EAAE,cAAc,SAAS,eAC7B,EAAE,KAAK,EAAE,SAAS;;YAGpB,OAAO;gBACL,OAAO,SAAS,KAAK,CAAC,GAAG,OAAO,GAAG;wEAAC,CAAA,IAAK,CAAC;4BACxC,OAAO,EAAE,QAAQ;4BACjB,OAAO,EAAE,QAAQ,IAAI,EAAE,EAAE,IAAI;wBAC/B,CAAC;;gBACD,OAAO,SAAS,MAAM;YACxB;QACF;2DACA;QAAC;KAAK;IAGR,OAAO;QAAE;IAAgB;AAC3B;IAxBgB;;QACG"}},
    {"offset": {"line": 819, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/store.ts"],"sourcesContent":["import { createCrudStore, CrudState } from '../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { Product } from './types';\r\nimport { type SystemId } from '@/lib/id-types';\r\nimport { asSystemId, asBusinessId } from '../../lib/id-types';\r\nimport { getCurrentUserSystemId } from '../../contexts/auth-context';\r\nimport Fuse from 'fuse.js';\r\nimport {\r\n  getCurrentUserInfo,\r\n  createCreatedEntry,\r\n  createUpdatedEntry,\r\n  createStatusChangedEntry,\r\n  appendHistoryEntry,\r\n  type HistoryEntry\r\n} from '../../lib/activity-history-helper';\r\n\r\nconst baseStore = createCrudStore<Product>([], 'products', {\r\n  businessIdField: 'id',\r\n  getCurrentUser: getCurrentUserSystemId, // ‚úÖ Track who creates/updates\r\n  apiEndpoint: '/api/products',\r\n});\r\n\r\n// ‚úÖ API Sync helpers\r\nconst API_ENDPOINT = '/api/products';\r\n\r\nconst syncToApi = {\r\n  create: async (product: Product) => {\r\n    try {\r\n      const response = await fetch(API_ENDPOINT, {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(product),\r\n      });\r\n      if (!response.ok) console.warn('[Product API] Create sync failed');\r\n      else console.log('[Product API] Created:', product.systemId);\r\n    } catch (e) {\r\n      console.warn('[Product API] Create sync error:', e);\r\n    }\r\n  },\r\n  update: async (systemId: SystemId, updates: Partial<Product>) => {\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}`, {\r\n        method: 'PATCH',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(updates),\r\n      });\r\n      if (!response.ok) console.warn('[Product API] Update sync failed');\r\n      else console.log('[Product API] Updated:', systemId);\r\n    } catch (e) {\r\n      console.warn('[Product API] Update sync error:', e);\r\n    }\r\n  },\r\n  delete: async (systemId: SystemId, hard = false) => {\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ hard }),\r\n      });\r\n      if (!response.ok) console.warn('[Product API] Delete sync failed');\r\n      else console.log('[Product API] Deleted:', systemId);\r\n    } catch (e) {\r\n      console.warn('[Product API] Delete sync error:', e);\r\n    }\r\n  },\r\n  restore: async (systemId: SystemId) => {\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}/restore`, {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n      });\r\n      if (!response.ok) console.warn('[Product API] Restore sync failed');\r\n      else console.log('[Product API] Restored:', systemId);\r\n    } catch (e) {\r\n      console.warn('[Product API] Restore sync error:', e);\r\n    }\r\n  },\r\n};\r\n\r\n// ‚úÖ Wrap base store methods with API sync\r\nconst originalAdd = baseStore.getState().add;\r\nconst originalUpdate = baseStore.getState().update;\r\nconst originalRemove = baseStore.getState().remove;\r\nconst originalHardDelete = baseStore.getState().hardDelete;\r\nconst originalRestore = baseStore.getState().restore;\r\n\r\nbaseStore.setState({\r\n  add: (item: Omit<Product, 'systemId'>) => {\r\n    const result = originalAdd(item);\r\n    syncToApi.create(result);\r\n    return result;\r\n  },\r\n  update: (systemId: SystemId, updates: Partial<Product>) => {\r\n    originalUpdate(systemId, updates);\r\n    syncToApi.update(systemId, updates);\r\n  },\r\n  remove: (systemId: SystemId) => {\r\n    originalRemove(systemId);\r\n    syncToApi.delete(systemId, false);\r\n  },\r\n  hardDelete: (systemId: SystemId) => {\r\n    originalHardDelete(systemId);\r\n    syncToApi.delete(systemId, true);\r\n  },\r\n  restore: (systemId: SystemId) => {\r\n    originalRestore(systemId);\r\n    syncToApi.restore(systemId);\r\n  },\r\n});\r\n\r\n// Define extended store interface\r\nexport interface ProductStoreState extends CrudState<Product> {\r\n  updateInventory: (productSystemId: SystemId, branchSystemId: SystemId, quantityChange: number) => void;\r\n  commitStock: (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => void;\r\n  uncommitStock: (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => void;\r\n  dispatchStock: (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => void;\r\n  completeDelivery: (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => void;\r\n  returnStockFromTransit: (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => void;\r\n  updateLastPurchasePrice: (productSystemId: SystemId, price: number, date: string) => void;\r\n  searchProducts: (query: string, page: number, limit?: number) => Promise<{ items: { value: SystemId; label: string }[], hasNextPage: boolean }>;\r\n}\r\n\r\n// Helper to check if product tracks stock\r\nconst canModifyStock = (product: Product | undefined): boolean => {\r\n  if (!product) return false;\r\n  // Services, digital products, and combos don't track stock directly\r\n  if (product.type === 'service' || product.type === 'digital' || product.type === 'combo') return false;\r\n  // Explicitly disabled stock tracking\r\n  if (product.isStockTracked === false) return false;\r\n  return true;\r\n};\r\n\r\n// Define custom methods\r\nconst updateInventory = (productSystemId: SystemId, branchSystemId: SystemId, quantityChange: number) => {\r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!product) return state;\r\n    \r\n    // Skip if product doesn't track stock\r\n    if (!canModifyStock(product)) {\r\n      console.warn(`[updateInventory] Skipped: Product ${productSystemId} does not track stock`);\r\n      return state;\r\n    }\r\n    \r\n    const oldQuantity = product.inventoryByBranch?.[branchSystemId] || 0;\r\n    const newQuantity = oldQuantity + quantityChange;\r\n    \r\n    // ‚úÖ Removed COMPLAINT_ADJUSTMENT stock history creation\r\n    // Stock history will be created by inventory check balance instead\r\n    \r\n    return {\r\n      data: state.data.map(p => {\r\n        if (p.systemId === productSystemId) {\r\n          const newInventoryByBranch = { ...p.inventoryByBranch };\r\n          newInventoryByBranch[branchSystemId] = newQuantity;\r\n          return {\r\n            ...p,\r\n            inventoryByBranch: newInventoryByBranch,\r\n          };\r\n        }\r\n        return p;\r\n      }),\r\n    };\r\n  });\r\n};\r\n\r\nconst commitStock = (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => {\r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!canModifyStock(product)) {\r\n      console.warn(`[commitStock] Skipped: Product ${productSystemId} does not track stock`);\r\n      return state;\r\n    }\r\n    return {\r\n      data: state.data.map(p => {\r\n        if (p.systemId === productSystemId) {\r\n          const newCommitted = { ...p.committedByBranch };\r\n          newCommitted[branchSystemId] = (newCommitted[branchSystemId] || 0) + quantity;\r\n          return { ...p, committedByBranch: newCommitted };\r\n        }\r\n        return p;\r\n      }),\r\n    };\r\n  });\r\n};\r\n\r\nconst uncommitStock = (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => {\r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!canModifyStock(product)) {\r\n      console.warn(`[uncommitStock] Skipped: Product ${productSystemId} does not track stock`);\r\n      return state;\r\n    }\r\n    return {\r\n      data: state.data.map(p => {\r\n        if (p.systemId === productSystemId) {\r\n          const newCommitted = { ...p.committedByBranch };\r\n          newCommitted[branchSystemId] = Math.max(0, (newCommitted[branchSystemId] || 0) - quantity);\r\n          return { ...p, committedByBranch: newCommitted };\r\n        }\r\n        return p;\r\n      }),\r\n    };\r\n  });\r\n};\r\n\r\nconst dispatchStock = (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => {\r\n  console.log('üî¥ [dispatchStock] Called with:', { productSystemId, branchSystemId, quantity });\r\n  \r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!product) {\r\n      console.error('‚ùå [dispatchStock] Product not found:', productSystemId);\r\n      return state;\r\n    }\r\n    \r\n    // Skip if product doesn't track stock\r\n    if (!canModifyStock(product)) {\r\n      console.warn(`[dispatchStock] Skipped: Product ${productSystemId} does not track stock`);\r\n      return state;\r\n    }\r\n    \r\n    console.log('üì¶ [dispatchStock] Current inventory:', product.inventoryByBranch);\r\n    console.log('üì¶ [dispatchStock] Current committed:', product.committedByBranch);\r\n    \r\n    return {\r\n      data: state.data.map(product => {\r\n        if (product.systemId === productSystemId) {\r\n          const newInventory = { ...product.inventoryByBranch };\r\n          const oldInventory = newInventory[branchSystemId] || 0;\r\n          newInventory[branchSystemId] = oldInventory - quantity;\r\n          \r\n          const newCommitted = { ...product.committedByBranch };\r\n          newCommitted[branchSystemId] = Math.max(0, (newCommitted[branchSystemId] || 0) - quantity);\r\n\r\n          const newInTransit = { ...product.inTransitByBranch };\r\n          newInTransit[branchSystemId] = (newInTransit[branchSystemId] || 0) + quantity;\r\n          \r\n          console.log('‚úÖ [dispatchStock] Updated inventory:', {\r\n            old: oldInventory,\r\n            new: newInventory[branchSystemId],\r\n            change: -quantity\r\n          });\r\n          \r\n          return { \r\n            ...product, \r\n            inventoryByBranch: newInventory,\r\n            committedByBranch: newCommitted,\r\n            inTransitByBranch: newInTransit,\r\n          };\r\n        }\r\n        return product;\r\n      }),\r\n    };\r\n  });\r\n  \r\n  console.log('‚úÖ [dispatchStock] Completed');\r\n};\r\n\r\nconst completeDelivery = (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => {\r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!canModifyStock(product)) {\r\n      return state;\r\n    }\r\n    return {\r\n      data: state.data.map(p => {\r\n        if (p.systemId === productSystemId) {\r\n          const newInTransit = { ...p.inTransitByBranch };\r\n          newInTransit[branchSystemId] = Math.max(0, (newInTransit[branchSystemId] || 0) - quantity);\r\n          return { ...p, inTransitByBranch: newInTransit };\r\n        }\r\n        return p;\r\n      }),\r\n    };\r\n  });\r\n};\r\n\r\nconst returnStockFromTransit = (productSystemId: SystemId, branchSystemId: SystemId, quantity: number) => {\r\n  baseStore.setState(state => {\r\n    const product = state.data.find(p => p.systemId === productSystemId);\r\n    if (!canModifyStock(product)) {\r\n      return state;\r\n    }\r\n    return {\r\n      data: state.data.map(p => {\r\n        if (p.systemId === productSystemId) {\r\n          const newInTransit = { ...p.inTransitByBranch };\r\n          newInTransit[branchSystemId] = Math.max(0, (newInTransit[branchSystemId] || 0) - quantity);\r\n          const newInventory = { ...p.inventoryByBranch };\r\n          newInventory[branchSystemId] = (newInventory[branchSystemId] || 0) + quantity;\r\n          return { ...p, inventoryByBranch: newInventory, inTransitByBranch: newInTransit };\r\n        }\r\n        return p;\r\n      }),\r\n    };\r\n  });\r\n};\r\n\r\nconst updateLastPurchasePrice = (productSystemId: SystemId, price: number, date: string) => {\r\n  baseStore.setState(state => ({\r\n    data: state.data.map(product => {\r\n      if (product.systemId === productSystemId) {\r\n        // Only update if the new date is newer or equal to the existing lastPurchaseDate\r\n        const existingDate = product.lastPurchaseDate ? new Date(product.lastPurchaseDate).getTime() : 0;\r\n        const newDateTs = new Date(date).getTime();\r\n        \r\n        if (newDateTs >= existingDate) {\r\n          return {\r\n            ...product,\r\n            lastPurchasePrice: price,\r\n            lastPurchaseDate: date,\r\n          };\r\n        }\r\n      }\r\n      return product;\r\n    }),\r\n  }));\r\n};\r\n\r\nconst searchProducts = async (query: string, page: number = 1, limit: number = 10): Promise<{ items: { value: SystemId; label: string }[], hasNextPage: boolean }> => {\r\n  const allProducts = baseStore.getState().data;\r\n  \r\n  // ‚úÖ Create fresh Fuse instance with current data (avoid stale data)\r\n  const fuse = new Fuse(allProducts, {\r\n    keys: ['name', 'id', 'sku', 'barcode'],\r\n    threshold: 0.3,\r\n  });\r\n  \r\n  const results = fuse.search(query);\r\n  const startIndex = (page - 1) * limit;\r\n  const endIndex = startIndex + limit;\r\n  const paginatedResults = results.slice(startIndex, endIndex);\r\n\r\n  return {\r\n    items: paginatedResults.map(result => ({\r\n      value: asSystemId(result.item.systemId),\r\n      label: `${result.item.name} (${result.item.id})`,\r\n    })),\r\n    hasNextPage: endIndex < results.length,\r\n  };\r\n};\r\n\r\n// Wrapped add method with activity history logging\r\nconst addProduct = (product: Omit<Product, 'systemId'>) => {\r\n  const userInfo = getCurrentUserInfo();\r\n  const newProduct = baseStore.getState().add(product);\r\n  \r\n  // Add activity history entry\r\n  const historyEntry = createCreatedEntry(\r\n    userInfo,\r\n    `${userInfo.name} ƒë√£ t·∫°o s·∫£n ph·∫©m ${newProduct.name} (${newProduct.id})`\r\n  );\r\n  baseStore.getState().update(newProduct.systemId, {\r\n    ...newProduct,\r\n    activityHistory: [historyEntry]\r\n  });\r\n  \r\n  return newProduct;\r\n};\r\n\r\n// Wrapped update method with activity history logging\r\nconst updateProduct = (systemId: SystemId, updatedProduct: Product) => {\r\n  const userInfo = getCurrentUserInfo();\r\n  const existingProduct = baseStore.getState().data.find(p => p.systemId === systemId);\r\n  const historyEntries: HistoryEntry[] = [];\r\n  \r\n  if (existingProduct) {\r\n    // Track status changes\r\n    if (existingProduct.status !== updatedProduct.status) {\r\n      const statusLabels: Record<string, string> = {\r\n        'active': 'ƒêang kinh doanh',\r\n        'inactive': 'Ng·ª´ng kinh doanh',\r\n        'discontinued': 'Ng·ª´ng s·∫£n xu·∫•t'\r\n      };\r\n      historyEntries.push(createStatusChangedEntry(\r\n        userInfo,\r\n        statusLabels[existingProduct.status || 'active'],\r\n        statusLabels[updatedProduct.status || 'active'],\r\n        `${userInfo.name} ƒë√£ ƒë·ªïi tr·∫°ng th√°i t·ª´ \"${statusLabels[existingProduct.status || 'active']}\" sang \"${statusLabels[updatedProduct.status || 'active']}\"`\r\n      ));\r\n    }\r\n    \r\n    // Track field changes\r\n    const fieldsToTrack: Array<{ key: keyof Product; label: string }> = [\r\n      { key: 'name', label: 'T√™n s·∫£n ph·∫©m' },\r\n      { key: 'id', label: 'M√£ SKU' },\r\n      { key: 'description', label: 'M√¥ t·∫£' },\r\n      { key: 'shortDescription', label: 'M√¥ t·∫£ ng·∫Øn' },\r\n      { key: 'type', label: 'Lo·∫°i s·∫£n ph·∫©m' },\r\n      { key: 'categorySystemId', label: 'Danh m·ª•c' },\r\n      { key: 'brandSystemId', label: 'Th∆∞∆°ng hi·ªáu' },\r\n      { key: 'unit', label: 'ƒê∆°n v·ªã t√≠nh' },\r\n      { key: 'costPrice', label: 'Gi√° v·ªën' },\r\n      { key: 'minPrice', label: 'Gi√° t·ªëi thi·ªÉu' },\r\n      { key: 'barcode', label: 'M√£ v·∫°ch' },\r\n      { key: 'primarySupplierSystemId', label: 'Nh√† cung c·∫•p ch√≠nh' },\r\n      { key: 'warrantyPeriodMonths', label: 'Th·ªùi h·∫°n b·∫£o h√†nh' },\r\n      { key: 'reorderLevel', label: 'M·ª©c ƒë·∫∑t h√†ng l·∫°i' },\r\n      { key: 'safetyStock', label: 'T·ªìn kho an to√†n' },\r\n      { key: 'maxStock', label: 'T·ªìn kho t·ªëi ƒëa' },\r\n    ];\r\n    \r\n    const changes: string[] = [];\r\n    for (const field of fieldsToTrack) {\r\n      const oldVal = existingProduct[field.key];\r\n      const newVal = updatedProduct[field.key];\r\n      if (oldVal !== newVal && !(oldVal === undefined && newVal === undefined)) {\r\n        if (field.key === 'status') continue;\r\n        const oldDisplay = oldVal !== undefined && oldVal !== null && oldVal !== '' ? String(oldVal) : '(tr·ªëng)';\r\n        const newDisplay = newVal !== undefined && newVal !== null && newVal !== '' ? String(newVal) : '(tr·ªëng)';\r\n        changes.push(`${field.label}: ${oldDisplay} ‚Üí ${newDisplay}`);\r\n      }\r\n    }\r\n    \r\n    // Track price changes separately\r\n    if (existingProduct.costPrice !== updatedProduct.costPrice) {\r\n      changes.push(`Gi√° v·ªën: ${existingProduct.costPrice?.toLocaleString('vi-VN')} ‚Üí ${updatedProduct.costPrice?.toLocaleString('vi-VN')}`);\r\n    }\r\n    \r\n    if (changes.length > 0) {\r\n      historyEntries.push(createUpdatedEntry(\r\n        userInfo,\r\n        `${userInfo.name} ƒë√£ c·∫≠p nh·∫≠t: ${changes.join(', ')}`\r\n      ));\r\n    }\r\n  }\r\n  \r\n  const productWithHistory = {\r\n    ...updatedProduct,\r\n    activityHistory: appendHistoryEntry(existingProduct?.activityHistory, ...historyEntries)\r\n  };\r\n  \r\n  baseStore.getState().update(systemId, productWithHistory);\r\n};\r\n\r\n// Export typed hook that includes both base and custom methods\r\nexport const useProductStore = (): ProductStoreState => {\r\n  const state = baseStore();\r\n  return {\r\n    ...state,\r\n    add: addProduct,\r\n    update: updateProduct,\r\n    updateInventory,\r\n    commitStock,\r\n    uncommitStock,\r\n    dispatchStock,\r\n    completeDelivery,\r\n    returnStockFromTransit,\r\n    updateLastPurchasePrice,\r\n    searchProducts,\r\n  };\r\n};\r\n\r\n// Export getState method for non-hook usage\r\nuseProductStore.getState = () => {\r\n  const state = baseStore.getState();\r\n  return {\r\n    ...state,\r\n    add: addProduct,\r\n    update: updateProduct,\r\n    updateInventory,\r\n    commitStock,\r\n    uncommitStock,\r\n    dispatchStock,\r\n    completeDelivery,\r\n    returnStockFromTransit,\r\n    updateLastPurchasePrice,\r\n    searchProducts,\r\n  };\r\n};\r\n\r\n(useProductStore as typeof useProductStore & { subscribe?: typeof baseStore.subscribe }).subscribe = baseStore.subscribe;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1333, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/combo-utils.ts"],"sourcesContent":["/**\r\n * Combo Product Utilities\r\n * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n * Tham kh·∫£o: Sapo Combo\r\n * - Combo kh√¥ng c√≥ t·ªìn kho ri√™ng\r\n * - T·ªìn kho combo = MIN(t·ªìn kho SP con / s·ªë l∆∞·ª£ng trong combo)\r\n * - T·ªëi ƒëa 20 s·∫£n ph·∫©m con\r\n * - Kh√¥ng cho ph√©p combo l·ªìng combo\r\n * ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\r\n */\r\n\r\nimport type { Product, ComboItem, ComboPricingType } from './types';\r\nimport type { SystemId } from '@/lib/id-types';\r\n\r\n// Constants\r\nexport const MAX_COMBO_ITEMS = 20;\r\nexport const MIN_COMBO_ITEMS = 2;\r\n\r\n/**\r\n * Check if product is a combo\r\n */\r\nexport function isComboProduct(product: Product): boolean {\r\n  return product.type === 'combo';\r\n}\r\n\r\n/**\r\n * Check if a product can be added to combo\r\n * - Kh√¥ng cho ph√©p th√™m combo v√†o combo (no nested combo)\r\n * - S·∫£n ph·∫©m ph·∫£i active\r\n */\r\nexport function canAddToCombo(product: Product): boolean {\r\n  if (product.type === 'combo') return false;\r\n  if (product.status === 'discontinued') return false;\r\n  if (product.isDeleted) return false;\r\n  return true;\r\n}\r\n\r\n/**\r\n * Validate combo items\r\n * Returns error message or null if valid\r\n */\r\nexport function validateComboItems(\r\n  comboItems: ComboItem[],\r\n  allProducts: Product[]\r\n): string | null {\r\n  // Check minimum items\r\n  if (comboItems.length < MIN_COMBO_ITEMS) {\r\n    return `Combo ph·∫£i c√≥ √≠t nh·∫•t ${MIN_COMBO_ITEMS} s·∫£n ph·∫©m`;\r\n  }\r\n  \r\n  // Check maximum items\r\n  if (comboItems.length > MAX_COMBO_ITEMS) {\r\n    return `Combo ch·ªâ ƒë∆∞·ª£c t·ªëi ƒëa ${MAX_COMBO_ITEMS} s·∫£n ph·∫©m`;\r\n  }\r\n  \r\n  // Check for duplicate products\r\n  const productIds = comboItems.map(item => item.productSystemId);\r\n  const uniqueIds = new Set(productIds);\r\n  if (uniqueIds.size !== productIds.length) {\r\n    return 'Combo kh√¥ng ƒë∆∞·ª£c ch·ª©a s·∫£n ph·∫©m tr√πng l·∫∑p';\r\n  }\r\n  \r\n  // Check each item\r\n  for (const item of comboItems) {\r\n    // Check quantity\r\n    if (item.quantity < 1) {\r\n      return 'S·ªë l∆∞·ª£ng s·∫£n ph·∫©m trong combo ph·∫£i >= 1';\r\n    }\r\n    \r\n    if (!Number.isInteger(item.quantity)) {\r\n      return 'S·ªë l∆∞·ª£ng s·∫£n ph·∫©m trong combo ph·∫£i l√† s·ªë nguy√™n';\r\n    }\r\n    \r\n    // Check product exists and is valid\r\n    const product = allProducts.find(p => p.systemId === item.productSystemId);\r\n    if (!product) {\r\n      return 'S·∫£n ph·∫©m trong combo kh√¥ng t·ªìn t·∫°i';\r\n    }\r\n    \r\n    if (!canAddToCombo(product)) {\r\n      return `S·∫£n ph·∫©m \"${product.name}\" kh√¥ng th·ªÉ th√™m v√†o combo`;\r\n    }\r\n  }\r\n  \r\n  return null;\r\n}\r\n\r\n/**\r\n * Calculate combo available stock for a specific branch\r\n * Formula: MIN(child_product_available / quantity_in_combo)\r\n * \r\n * @param comboItems - List of combo items\r\n * @param allProducts - All products to lookup\r\n * @param branchSystemId - Branch to calculate stock for\r\n * @returns Available combo quantity (floored to integer)\r\n */\r\nexport function calculateComboStock(\r\n  comboItems: ComboItem[],\r\n  allProducts: Product[],\r\n  branchSystemId: SystemId\r\n): number {\r\n  if (!comboItems || comboItems.length === 0) return 0;\r\n  \r\n  let minComboQuantity = Infinity;\r\n  \r\n  for (const item of comboItems) {\r\n    const product = allProducts.find(p => p.systemId === item.productSystemId);\r\n    if (!product) return 0; // If any product not found, combo unavailable\r\n    \r\n    // Available = On-hand - Committed\r\n    const onHand = product.inventoryByBranch?.[branchSystemId] || 0;\r\n    const committed = product.committedByBranch?.[branchSystemId] || 0;\r\n    const available = onHand - committed;\r\n    \r\n    // How many combos can we make from this product?\r\n    const comboQuantityFromThisProduct = Math.floor(available / item.quantity);\r\n    \r\n    minComboQuantity = Math.min(minComboQuantity, comboQuantityFromThisProduct);\r\n  }\r\n  \r\n  return minComboQuantity === Infinity ? 0 : Math.max(0, minComboQuantity);\r\n}\r\n\r\n/**\r\n * Calculate combo stock across all branches\r\n * Returns a map of branchSystemId -> available combo quantity\r\n */\r\nexport function calculateComboStockAllBranches(\r\n  comboItems: ComboItem[],\r\n  allProducts: Product[]\r\n): Record<SystemId, number> {\r\n  if (!comboItems || comboItems.length === 0) return {};\r\n  \r\n  // Collect all branch IDs from child products\r\n  const allBranchIds = new Set<SystemId>();\r\n  for (const item of comboItems) {\r\n    const product = allProducts.find(p => p.systemId === item.productSystemId);\r\n    if (product?.inventoryByBranch) {\r\n      Object.keys(product.inventoryByBranch).forEach(branchId => {\r\n        allBranchIds.add(branchId as SystemId);\r\n      });\r\n    }\r\n  }\r\n  \r\n  // Calculate stock for each branch\r\n  const result: Record<SystemId, number> = {};\r\n  for (const branchId of allBranchIds) {\r\n    result[branchId] = calculateComboStock(comboItems, allProducts, branchId);\r\n  }\r\n  \r\n  return result;\r\n}\r\n\r\n/**\r\n * Calculate combo price based on pricing type\r\n * \r\n * @param comboItems - List of combo items\r\n * @param allProducts - All products to lookup prices\r\n * @param pricingPolicySystemId - Which pricing policy to use\r\n * @param comboPricingType - How to calculate price\r\n * @param comboDiscount - Discount value (% or fixed amount)\r\n * @returns Calculated combo price\r\n */\r\nexport function calculateComboPrice(\r\n  comboItems: ComboItem[],\r\n  allProducts: Product[],\r\n  pricingPolicySystemId: SystemId,\r\n  comboPricingType: ComboPricingType,\r\n  comboDiscount: number = 0\r\n): number {\r\n  if (comboPricingType === 'fixed') {\r\n    // Fixed price is stored directly, not calculated\r\n    return comboDiscount; // In fixed mode, comboDiscount IS the price\r\n  }\r\n  \r\n  // Calculate sum of child products' prices\r\n  let sumPrice = 0;\r\n  for (const item of comboItems) {\r\n    const product = allProducts.find(p => p.systemId === item.productSystemId);\r\n    if (!product) continue;\r\n    \r\n    const unitPrice = product.prices?.[pricingPolicySystemId] || 0;\r\n    sumPrice += unitPrice * item.quantity;\r\n  }\r\n  \r\n  // Apply discount\r\n  if (comboPricingType === 'sum_discount_percent') {\r\n    const discountAmount = sumPrice * (comboDiscount / 100);\r\n    return Math.round(sumPrice - discountAmount);\r\n  }\r\n  \r\n  if (comboPricingType === 'sum_discount_amount') {\r\n    return Math.max(0, sumPrice - comboDiscount);\r\n  }\r\n  \r\n  return sumPrice;\r\n}\r\n\r\n/**\r\n * Calculate combo cost price (sum of child products' cost prices)\r\n */\r\ntype ComboCostOptions = {\r\n  /**\r\n   * Optional pricing policy to use when we have to fall back to selling price data.\r\n   * Ensures cost previews stay in sync with the price policy that users actually see.\r\n   */\r\n  fallbackPricingPolicyId?: SystemId;\r\n  /**\r\n   * Allow falling back to selling price data if cost/last purchase/min price are missing.\r\n   * Defaults to true to avoid showing zero cost when data is incomplete.\r\n   */\r\n  allowPriceFallback?: boolean;\r\n};\r\n\r\nconst isNumber = (value: unknown): value is number => typeof value === 'number' && Number.isFinite(value);\r\n\r\nexport function calculateComboCostPrice(\r\n  comboItems: ComboItem[],\r\n  allProducts: Product[],\r\n  options: ComboCostOptions = {}\r\n): number {\r\n  const { fallbackPricingPolicyId, allowPriceFallback = true } = options;\r\n  let totalCost = 0;\r\n  \r\n  for (const item of comboItems) {\r\n    const product = allProducts.find(p => p.systemId === item.productSystemId);\r\n    if (!product) continue;\r\n\r\n    let unitCost = product.costPrice;\r\n\r\n    if (!isNumber(unitCost) && isNumber(product.lastPurchasePrice)) {\r\n      unitCost = product.lastPurchasePrice;\r\n    }\r\n\r\n    if (!isNumber(unitCost) && allowPriceFallback) {\r\n      if (fallbackPricingPolicyId && isNumber(product.prices?.[fallbackPricingPolicyId])) {\r\n        unitCost = product.prices![fallbackPricingPolicyId];\r\n      }\r\n\r\n      if (!isNumber(unitCost)) {\r\n        const firstPrice = Object.values(product.prices || {}).find((price): price is number => isNumber(price));\r\n        if (isNumber(firstPrice)) {\r\n          unitCost = firstPrice;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!isNumber(unitCost) && isNumber(product.minPrice)) {\r\n      unitCost = product.minPrice;\r\n    }\r\n    \r\n    totalCost += (unitCost || 0) * item.quantity;\r\n  }\r\n  \r\n  return totalCost;\r\n}\r\n\r\n/**\r\n * Calculate combo last purchase price (sum of child products' last purchase prices)\r\n */\r\nexport function calculateComboLastPurchasePrice(\r\n  comboItems: ComboItem[],\r\n  allProducts: Product[]\r\n): number {\r\n  let total = 0;\r\n  \r\n  for (const item of comboItems) {\r\n    const product = allProducts.find(p => p.systemId === item.productSystemId);\r\n    if (!product) continue;\r\n    \r\n    total += (product.lastPurchasePrice || 0) * item.quantity;\r\n  }\r\n  \r\n  return total;\r\n}\r\n\r\n/**\r\n * Calculate combo min price (sum of child products' min prices)\r\n */\r\nexport function calculateComboMinPrice(\r\n  comboItems: ComboItem[],\r\n  allProducts: Product[]\r\n): number {\r\n  let total = 0;\r\n  \r\n  for (const item of comboItems) {\r\n    const product = allProducts.find(p => p.systemId === item.productSystemId);\r\n    if (!product) continue;\r\n    \r\n    total += (product.minPrice || 0) * item.quantity;\r\n  }\r\n  \r\n  return total;\r\n}\r\n\r\n/**\r\n * Calculate combo prices by policy (sum of child products' prices per policy)\r\n * This returns the RAW sum without any discount applied\r\n */\r\nexport function calculateComboPricesByPolicy(\r\n  comboItems: ComboItem[],\r\n  allProducts: Product[]\r\n): Record<string, number> {\r\n  const pricesByPolicy: Record<string, number> = {};\r\n  \r\n  for (const item of comboItems) {\r\n    const product = allProducts.find(p => p.systemId === item.productSystemId);\r\n    if (!product || !product.prices) continue;\r\n    \r\n    for (const [policyId, price] of Object.entries(product.prices)) {\r\n      if (!pricesByPolicy[policyId]) {\r\n        pricesByPolicy[policyId] = 0;\r\n      }\r\n      pricesByPolicy[policyId] += (price || 0) * item.quantity;\r\n    }\r\n  }\r\n  \r\n  return pricesByPolicy;\r\n}\r\n\r\n/**\r\n * Calculate final combo prices by policy with discount applied\r\n * This returns the actual selling prices for the combo\r\n * \r\n * @param comboItems - List of combo items\r\n * @param allProducts - All products to lookup prices\r\n * @param comboPricingType - How to calculate price\r\n * @param comboDiscount - Discount value (% or fixed amount or fixed price)\r\n * @param defaultPolicyId - Default selling policy ID (used for fixed pricing)\r\n * @returns Final combo prices by policy\r\n */\r\nexport function calculateFinalComboPricesByPolicy(\r\n  comboItems: ComboItem[],\r\n  allProducts: Product[],\r\n  comboPricingType: ComboPricingType,\r\n  comboDiscount: number = 0,\r\n  defaultPolicyId?: string\r\n): Record<string, number> {\r\n  // Get raw sum prices first\r\n  const rawPricesByPolicy = calculateComboPricesByPolicy(comboItems, allProducts);\r\n  const finalPricesByPolicy: Record<string, number> = {};\r\n  \r\n  if (comboPricingType === 'fixed') {\r\n    // For fixed pricing, only policies that exist on child products should be auto-filled.\r\n    for (const policyId of Object.keys(rawPricesByPolicy)) {\r\n      finalPricesByPolicy[policyId] = comboDiscount; // comboDiscount IS the price in fixed mode\r\n    }\r\n    return finalPricesByPolicy;\r\n  }\r\n  \r\n  // For discount-based pricing, apply discount to each policy's sum\r\n  for (const [policyId, sumPrice] of Object.entries(rawPricesByPolicy)) {\r\n    if (comboPricingType === 'sum_discount_percent') {\r\n      const discountAmount = sumPrice * (comboDiscount / 100);\r\n      finalPricesByPolicy[policyId] = Math.round(sumPrice - discountAmount);\r\n    } else if (comboPricingType === 'sum_discount_amount') {\r\n      finalPricesByPolicy[policyId] = Math.max(0, sumPrice - comboDiscount);\r\n    } else {\r\n      // No discount, use raw sum\r\n      finalPricesByPolicy[policyId] = sumPrice;\r\n    }\r\n  }\r\n  \r\n  return finalPricesByPolicy;\r\n}\r\n\r\n/**\r\n * Get summary text for combo (e.g., \"3 s·∫£n ph·∫©m, t·ªìn kho: 15\")\r\n */\r\nexport function getComboSummary(\r\n  comboItems: ComboItem[],\r\n  allProducts: Product[],\r\n  branchSystemId?: SystemId\r\n): string {\r\n  const itemCount = comboItems?.length || 0;\r\n  \r\n  if (!branchSystemId) {\r\n    return `${itemCount} s·∫£n ph·∫©m`;\r\n  }\r\n  \r\n  const stock = calculateComboStock(comboItems, allProducts, branchSystemId);\r\n  return `${itemCount} s·∫£n ph·∫©m, t·ªìn kho: ${stock}`;\r\n}\r\n\r\n/**\r\n * Check if combo has sufficient stock for a quantity\r\n */\r\nexport function hasComboStock(\r\n  comboItems: ComboItem[],\r\n  allProducts: Product[],\r\n  branchSystemId: SystemId,\r\n  requiredQuantity: number\r\n): boolean {\r\n  const available = calculateComboStock(comboItems, allProducts, branchSystemId);\r\n  return available >= requiredQuantity;\r\n}\r\n\r\n/**\r\n * Get the limiting product(s) for combo stock\r\n * Returns the product(s) that have the lowest available combo quantity\r\n */\r\nexport function getComboBottleneckProducts(\r\n  comboItems: ComboItem[],\r\n  allProducts: Product[],\r\n  branchSystemId: SystemId\r\n): Array<{ product: Product; availableForCombo: number; itemQuantity: number }> {\r\n  if (!comboItems || comboItems.length === 0) return [];\r\n  \r\n  const comboStock = calculateComboStock(comboItems, allProducts, branchSystemId);\r\n  const bottlenecks: Array<{ product: Product; availableForCombo: number; itemQuantity: number }> = [];\r\n  \r\n  for (const item of comboItems) {\r\n    const product = allProducts.find(p => p.systemId === item.productSystemId);\r\n    if (!product) continue;\r\n    \r\n    const onHand = product.inventoryByBranch?.[branchSystemId] || 0;\r\n    const committed = product.committedByBranch?.[branchSystemId] || 0;\r\n    const available = onHand - committed;\r\n    const comboQuantityFromThisProduct = Math.floor(available / item.quantity);\r\n    \r\n    // This product is a bottleneck if it limits the combo quantity\r\n    if (comboQuantityFromThisProduct === comboStock) {\r\n      bottlenecks.push({\r\n        product,\r\n        availableForCombo: comboQuantityFromThisProduct,\r\n        itemQuantity: item.quantity,\r\n      });\r\n    }\r\n  }\r\n  \r\n  return bottlenecks;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1607, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/api/products-api.ts"],"sourcesContent":["/**\r\n * Products API - Isolated API functions\r\n * \r\n * ‚ö†Ô∏è IMPORTANT: This file should ONLY contain:\r\n * - Fetch functions\r\n * - Type imports from ../types\r\n * - NO store imports\r\n * - NO cross-feature imports\r\n */\r\n\r\nimport type { Product } from '../types';\r\n\r\nconst API_BASE = '/api/products';\r\n\r\nexport interface ProductsParams {\r\n  page?: number;\r\n  limit?: number;\r\n  search?: string;\r\n  categoryId?: string;\r\n  brandId?: string;\r\n  status?: string;\r\n  type?: string;\r\n  inStock?: boolean;\r\n  sortBy?: string;\r\n  sortOrder?: 'asc' | 'desc';\r\n}\r\n\r\nexport interface PaginatedResponse<T> {\r\n  data: T[];\r\n  pagination: {\r\n    page: number;\r\n    limit: number;\r\n    total: number;\r\n    totalPages: number;\r\n  };\r\n}\r\n\r\nexport interface CreateProductInput {\r\n  id?: string;  // Business ID (auto-generated if not provided)\r\n  name: string;\r\n  sku?: string;\r\n  barcode?: string;\r\n  categoryId?: string;\r\n  brandId?: string;\r\n  sellingPrice: number;\r\n  costPrice?: number;\r\n  description?: string;\r\n  images?: string[];\r\n  // Optional fields \r\n  type?: string;\r\n  productTypeSystemId?: string;\r\n  unit?: string;\r\n  prices?: Record<string, number>;\r\n  pkgxId?: number | undefined;\r\n  status?: string;\r\n  inventoryByBranch?: Record<string, number>;\r\n  committedByBranch?: Record<string, number>;\r\n  inTransitByBranch?: Record<string, number>;\r\n  isDeleted?: boolean;\r\n  updatedAt?: string;\r\n}\r\n\r\nexport interface UpdateProductInput extends Partial<CreateProductInput> {\r\n  systemId: string;\r\n  // Legacy field for backward compatibility\r\n  stockQuantity?: number;\r\n}\r\n\r\n/**\r\n * Fetch paginated products list\r\n */\r\nexport async function fetchProducts(params: ProductsParams = {}): Promise<PaginatedResponse<Product>> {\r\n  const { page = 1, limit = 50, ...rest } = params;\r\n  \r\n  const searchParams = new URLSearchParams({\r\n    page: String(page),\r\n    limit: String(limit),\r\n  });\r\n  \r\n  // Add optional params\r\n  Object.entries(rest).forEach(([key, value]) => {\r\n    if (value != null && value !== '') {\r\n      searchParams.set(key, String(value));\r\n    }\r\n  });\r\n  \r\n  const res = await fetch(`${API_BASE}?${searchParams}`, {\r\n    credentials: 'include',\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    throw new Error(`Failed to fetch products: ${res.statusText}`);\r\n  }\r\n  \r\n  return res.json();\r\n}\r\n\r\n/**\r\n * Fetch single product by ID\r\n */\r\nexport async function fetchProduct(id: string): Promise<Product> {\r\n  const res = await fetch(`${API_BASE}/${id}`, {\r\n    credentials: 'include',\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    throw new Error(`Failed to fetch product ${id}: ${res.statusText}`);\r\n  }\r\n  \r\n  return res.json();\r\n}\r\n\r\n/**\r\n * Create new product\r\n */\r\nexport async function createProduct(data: CreateProductInput): Promise<Product> {\r\n  const res = await fetch(API_BASE, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    credentials: 'include',\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    const error = await res.json().catch(() => ({}));\r\n    throw new Error(error.message || `Failed to create product: ${res.statusText}`);\r\n  }\r\n  \r\n  return res.json();\r\n}\r\n\r\n/**\r\n * Update existing product\r\n */\r\nexport async function updateProduct({ systemId, ...data }: UpdateProductInput): Promise<Product> {\r\n  const res = await fetch(`${API_BASE}/${systemId}`, {\r\n    method: 'PATCH',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    credentials: 'include',\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    const error = await res.json().catch(() => ({}));\r\n    throw new Error(error.message || `Failed to update product: ${res.statusText}`);\r\n  }\r\n  \r\n  return res.json();\r\n}\r\n\r\n/**\r\n * Delete product (soft delete)\r\n */\r\nexport async function deleteProduct(id: string): Promise<void> {\r\n  const res = await fetch(`${API_BASE}/${id}`, {\r\n    method: 'DELETE',\r\n    credentials: 'include',\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    const error = await res.json().catch(() => ({}));\r\n    throw new Error(error.message || `Failed to delete product: ${res.statusText}`);\r\n  }\r\n}\r\n\r\n/**\r\n * Search products for autocomplete\r\n */\r\nexport async function searchProducts(query: string, limit = 20): Promise<Product[]> {\r\n  const res = await fetch(`${API_BASE}?search=${encodeURIComponent(query)}&limit=${limit}`, {\r\n    credentials: 'include',\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    throw new Error(`Failed to search products: ${res.statusText}`);\r\n  }\r\n  \r\n  const json = await res.json();\r\n  return json.data || [];\r\n}\r\n\r\n/**\r\n * Fetch product inventory by branch\r\n */\r\nexport async function fetchProductInventory(productId: string): Promise<Record<string, number>> {\r\n  const res = await fetch(`${API_BASE}/${productId}/inventory`, {\r\n    credentials: 'include',\r\n  });\r\n  \r\n  if (!res.ok) {\r\n    throw new Error(`Failed to fetch product inventory: ${res.statusText}`);\r\n  }\r\n  \r\n  return res.json();\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1727, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/hooks/use-products.ts"],"sourcesContent":["/**\r\n * useProducts - React Query hooks for products\r\n * \r\n * ‚ö†Ô∏è IMPORTANT: Direct import pattern\r\n * - Import this file directly: import { useProducts } from '@/features/products/hooks/use-products'\r\n * - NEVER import from '@/features/products' or '@/features/products/store'\r\n * \r\n * This hook is ISOLATED - it only depends on:\r\n * - @tanstack/react-query\r\n * - Local API functions\r\n * - Local types\r\n */\r\n\r\nimport { useQuery, useMutation, useQueryClient, keepPreviousData } from '@tanstack/react-query';\r\nimport {\r\n  fetchProducts,\r\n  fetchProduct,\r\n  createProduct,\r\n  updateProduct,\r\n  deleteProduct,\r\n  searchProducts,\r\n  fetchProductInventory,\r\n  type ProductsParams,\r\n  type CreateProductInput,\r\n  type UpdateProductInput,\r\n} from '../api/products-api';\r\n\r\n// Query keys - exported for invalidation\r\nexport const productKeys = {\r\n  all: ['products'] as const,\r\n  lists: () => [...productKeys.all, 'list'] as const,\r\n  list: (params: ProductsParams) => [...productKeys.lists(), params] as const,\r\n  details: () => [...productKeys.all, 'detail'] as const,\r\n  detail: (id: string) => [...productKeys.details(), id] as const,\r\n  search: (query: string) => [...productKeys.all, 'search', query] as const,\r\n  inventory: (id: string) => [...productKeys.all, 'inventory', id] as const,\r\n};\r\n\r\n/**\r\n * Hook for fetching paginated products list\r\n * \r\n * @example\r\n * ```tsx\r\n * function ProductsPage() {\r\n *   const [page, setPage] = useState(1);\r\n *   const { data, isLoading } = useProducts({ page, limit: 50 });\r\n *   \r\n *   return (\r\n *     <DataTable \r\n *       data={data?.data || []} \r\n *       pagination={data?.pagination}\r\n *       onPageChange={setPage}\r\n *     />\r\n *   );\r\n * }\r\n * ```\r\n */\r\nexport function useProducts(params: ProductsParams = {}) {\r\n  return useQuery({\r\n    queryKey: productKeys.list(params),\r\n    queryFn: () => fetchProducts(params),\r\n    staleTime: 60_000, // 1 minute - products don't change frequently\r\n    gcTime: 10 * 60 * 1000, // 10 minutes\r\n    placeholderData: keepPreviousData,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for fetching single product by ID\r\n */\r\nexport function useProduct(id: string | null | undefined) {\r\n  return useQuery({\r\n    queryKey: productKeys.detail(id!),\r\n    queryFn: () => fetchProduct(id!),\r\n    enabled: !!id,\r\n    staleTime: 60_000,\r\n    gcTime: 10 * 60 * 1000,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for searching products (autocomplete)\r\n */\r\nexport function useProductSearch(query: string, limit = 20) {\r\n  return useQuery({\r\n    queryKey: productKeys.search(query),\r\n    queryFn: () => searchProducts(query, limit),\r\n    enabled: query.length >= 2,\r\n    staleTime: 30_000,\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for fetching product inventory\r\n */\r\nexport function useProductInventory(productId: string | null | undefined) {\r\n  return useQuery({\r\n    queryKey: productKeys.inventory(productId!),\r\n    queryFn: () => fetchProductInventory(productId!),\r\n    enabled: !!productId,\r\n    staleTime: 30_000, // Inventory can change more frequently\r\n  });\r\n}\r\n\r\n/**\r\n * Hook for product mutations (create/update/delete)\r\n */\r\ninterface UseProductMutationsOptions {\r\n  onCreateSuccess?: (product: unknown) => void;\r\n  onUpdateSuccess?: (product: unknown) => void;\r\n  onDeleteSuccess?: () => void;\r\n  onError?: (error: Error) => void;\r\n}\r\n\r\nexport function useProductMutations(options: UseProductMutationsOptions = {}) {\r\n  const queryClient = useQueryClient();\r\n  \r\n  const create = useMutation({\r\n    mutationFn: createProduct,\r\n    onSuccess: (data) => {\r\n      queryClient.invalidateQueries({ queryKey: productKeys.lists() });\r\n      options.onCreateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const update = useMutation({\r\n    mutationFn: updateProduct,\r\n    onSuccess: (data, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: productKeys.detail(variables.systemId) });\r\n      queryClient.invalidateQueries({ queryKey: productKeys.lists() });\r\n      options.onUpdateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const remove = useMutation({\r\n    mutationFn: deleteProduct,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: productKeys.all });\r\n      options.onDeleteSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  return {\r\n    create,\r\n    update,\r\n    remove,\r\n    isCreating: create.isPending,\r\n    isUpdating: update.isPending,\r\n    isDeleting: remove.isPending,\r\n    isMutating: create.isPending || update.isPending || remove.isPending,\r\n  };\r\n}\r\n\r\n/**\r\n * Hook for getting products by category (for filtering)\r\n */\r\nexport function useProductsByCategory(categoryId: string | null | undefined) {\r\n  return useProducts({ \r\n    categoryId: categoryId || undefined, \r\n    limit: 100 \r\n  });\r\n}\r\n\r\n/**\r\n * Hook for getting products by brand\r\n */\r\nexport function useProductsByBrand(brandId: string | null | undefined) {\r\n  return useProducts({ \r\n    brandId: brandId || undefined, \r\n    limit: 100 \r\n  });\r\n}\r\n\r\n/**\r\n * Hook for getting active products only\r\n */\r\nexport function useActiveProducts(params: Omit<ProductsParams, 'status'> = {}) {\r\n  return useProducts({ ...params, status: 'active' });\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1966, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/hooks/use-all-products.ts"],"sourcesContent":["/**\r\n * useAllProducts - Convenience hook for components needing all products as flat array\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { useProducts } from './use-products';\r\nimport type { Product } from '../types';\r\nimport type { SystemId } from '@/lib/id-types';\r\n\r\nexport function useAllProducts() {\r\n  const query = useProducts({ limit: 50 });\r\n  \r\n  return {\r\n    data: query.data?.data || [] as Product[],\r\n    isLoading: query.isLoading,\r\n    isError: query.isError,\r\n    error: query.error,\r\n  };\r\n}\r\n\r\nexport function useActiveProducts() {\r\n  const { data, isLoading } = useAllProducts();\r\n  const activeProducts = data.filter(p => !p.isDeleted && (p as any).isActive !== false);\r\n  \r\n  return { data: activeProducts, isLoading };\r\n}\r\n\r\n/**\r\n * Helper hook to find a product by ID from cached data\r\n * Replaces legacy findById() method\r\n */\r\nexport function useProductFinder() {\r\n  const { data } = useAllProducts();\r\n  \r\n  const findById = React.useCallback(\r\n    (systemId: SystemId | string | undefined): Product | undefined => {\r\n      if (!systemId) return undefined;\r\n      return data.find(p => p.systemId === systemId);\r\n    },\r\n    [data]\r\n  );\r\n  \r\n  return { findById };\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;CAEC,GAED;AACA;;;;AAIO,SAAS;;IACd,MAAM,QAAQ,IAAA,kKAAW,EAAC;QAAE,OAAO;IAAG;IAEtC,OAAO;QACL,MAAM,MAAM,IAAI,EAAE,QAAQ,EAAE;QAC5B,WAAW,MAAM,SAAS;QAC1B,SAAS,MAAM,OAAO;QACtB,OAAO,MAAM,KAAK;IACpB;AACF;GATgB;;QACA,kKAAW;;;AAUpB,SAAS;;IACd,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG;IAC5B,MAAM,iBAAiB,KAAK,MAAM,CAAC,CAAA,IAAK,CAAC,EAAE,SAAS,IAAI,AAAC,EAAU,QAAQ,KAAK;IAEhF,OAAO;QAAE,MAAM;QAAgB;IAAU;AAC3C;IALgB;;QACc;;;AAUvB,SAAS;;IACd,MAAM,EAAE,IAAI,EAAE,GAAG;IAEjB,MAAM,WAAW,4KAAiB;kDAChC,CAAC;YACC,IAAI,CAAC,UAAU,OAAO;YACtB,OAAO,KAAK,IAAI;0DAAC,CAAA,IAAK,EAAE,QAAQ,KAAK;;QACvC;iDACA;QAAC;KAAK;IAGR,OAAO;QAAE;IAAS;AACpB;IAZgB;;QACG"}},
    {"offset": {"line": 2041, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/image-store.ts"],"sourcesContent":["/**\r\n * Product Image Store\r\n * \r\n * Qu·∫£n l√Ω staging images v√† permanent images cho products\r\n * T∆∞∆°ng t·ª± nh∆∞ document-store.ts c·ªßa Employee\r\n */\r\n\r\nimport { create } from 'zustand';\r\nimport type { StagingFile } from '@/lib/file-upload-api';\r\n\r\nexport type ProductImageType = 'thumbnail' | 'gallery';\r\n\r\ntype ImageState = {\r\n  // Staging images - ch∆∞a confirm, theo sessionId\r\n  stagingImages: Record<string, {\r\n    type: ProductImageType;\r\n    sessionId: string;\r\n    files: StagingFile[];\r\n  }>;\r\n  \r\n  // Permanent images - ƒë√£ confirm, theo productSystemId\r\n  permanentImages: Record<string, {\r\n    thumbnail: StagingFile[];\r\n    gallery: StagingFile[];\r\n  }>;\r\n  permanentMeta: Record<string, {\r\n    lastFetched: number;\r\n  }>;\r\n  \r\n  // Actions\r\n  updateStagingImage: (\r\n    productSystemId: string,\r\n    type: ProductImageType,\r\n    files: StagingFile[],\r\n    sessionId: string\r\n  ) => void;\r\n  \r\n  clearStagingImages: (productSystemId?: string) => void;\r\n  \r\n  updatePermanentImages: (\r\n    productSystemId: string,\r\n    type: ProductImageType,\r\n    files: StagingFile[],\r\n    fetchedAt?: number\r\n  ) => void;\r\n  \r\n  clearPermanentImages: (productSystemId: string) => void;\r\n  \r\n  getStagingImages: (productSystemId: string, type: ProductImageType) => StagingFile[];\r\n  \r\n  getPermanentImages: (productSystemId: string, type: ProductImageType) => StagingFile[];\r\n  \r\n  getSessionId: (productSystemId: string, type: ProductImageType) => string | undefined;\r\n};\r\n\r\nexport const useImageStore = create<ImageState>((set, get) => ({\r\n  stagingImages: {},\r\n  permanentImages: {},\r\n  permanentMeta: {},\r\n  \r\n  updateStagingImage: (productSystemId, type, files, sessionId) => {\r\n    const key = `${productSystemId}-${type}`;\r\n    set(state => ({\r\n      stagingImages: {\r\n        ...state.stagingImages,\r\n        [key]: { type, sessionId, files }\r\n      }\r\n    }));\r\n  },\r\n  \r\n  clearStagingImages: (productSystemId) => {\r\n    if (productSystemId) {\r\n      set(state => {\r\n        const filtered = Object.entries(state.stagingImages).filter(\r\n          ([key]) => !key.startsWith(productSystemId)\r\n        );\r\n        return { stagingImages: Object.fromEntries(filtered) };\r\n      });\r\n    } else {\r\n      set({ stagingImages: {} });\r\n    }\r\n  },\r\n  \r\n  updatePermanentImages: (productSystemId, type, files, fetchedAt) => {\r\n    set(state => {\r\n      const existing = state.permanentImages[productSystemId] || {\r\n        thumbnail: [],\r\n        gallery: []\r\n      };\r\n\r\n      const timestamp = fetchedAt ?? Date.now();\r\n      return {\r\n        permanentImages: {\r\n          ...state.permanentImages,\r\n          [productSystemId]: {\r\n            ...existing,\r\n            [type]: files\r\n          }\r\n        },\r\n        permanentMeta: {\r\n          ...state.permanentMeta,\r\n          [productSystemId]: {\r\n            lastFetched: timestamp\r\n          }\r\n        }\r\n      };\r\n    });\r\n  },\r\n  \r\n  clearPermanentImages: (productSystemId) => {\r\n    set(state => {\r\n      const { [productSystemId]: _, ...rest } = state.permanentImages;\r\n      const { [productSystemId]: __, ...restMeta } = state.permanentMeta;\r\n      return { permanentImages: rest, permanentMeta: restMeta };\r\n    });\r\n  },\r\n  \r\n  getStagingImages: (productSystemId, type) => {\r\n    const key = `${productSystemId}-${type}`;\r\n    return get().stagingImages[key]?.files || [];\r\n  },\r\n  \r\n  getPermanentImages: (productSystemId, type) => {\r\n    return get().permanentImages[productSystemId]?.[type] || [];\r\n  },\r\n  \r\n  getSessionId: (productSystemId, type) => {\r\n    const key = `${productSystemId}-${type}`;\r\n    return get().stagingImages[key]?.sessionId;\r\n  }\r\n}));\r\n\r\n/**\r\n * Helper: L·∫•y ·∫£nh s·∫£n ph·∫©m v·ªõi th·ª© t·ª± ∆∞u ti√™n ƒë√∫ng\r\n * 1. ·∫¢nh t·ª´ server (permanentImages) - upload th·ª±c\r\n * 2. ·∫¢nh t·ª´ product data (mock/seed data)\r\n */\r\nexport function getProductImageUrl(\r\n  product: { thumbnailImage?: string; galleryImages?: string[]; images?: string[] } | null | undefined,\r\n  serverThumbnail?: string,\r\n  serverGallery?: string\r\n): string | undefined {\r\n  // ∆Øu ti√™n 1: ·∫¢nh t·ª´ server (upload th·ª±c)\r\n  if (serverThumbnail) return serverThumbnail;\r\n  if (serverGallery) return serverGallery;\r\n  \r\n  // ∆Øu ti√™n 2: ·∫¢nh t·ª´ product data\r\n  if (!product) return undefined;\r\n  return product.thumbnailImage || product.galleryImages?.[0] || product.images?.[0];\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;;;CAKC,GAED;;AAgDO,MAAM,gBAAgB,IAAA,qJAAM,EAAa,CAAC,KAAK,MAAQ,CAAC;QAC7D,eAAe,CAAC;QAChB,iBAAiB,CAAC;QAClB,eAAe,CAAC;QAEhB,oBAAoB,CAAC,iBAAiB,MAAM,OAAO;YACjD,MAAM,MAAM,GAAG,gBAAgB,CAAC,EAAE,MAAM;YACxC,IAAI,CAAA,QAAS,CAAC;oBACZ,eAAe;wBACb,GAAG,MAAM,aAAa;wBACtB,CAAC,IAAI,EAAE;4BAAE;4BAAM;4BAAW;wBAAM;oBAClC;gBACF,CAAC;QACH;QAEA,oBAAoB,CAAC;YACnB,IAAI,iBAAiB;gBACnB,IAAI,CAAA;oBACF,MAAM,WAAW,OAAO,OAAO,CAAC,MAAM,aAAa,EAAE,MAAM,CACzD,CAAC,CAAC,IAAI,GAAK,CAAC,IAAI,UAAU,CAAC;oBAE7B,OAAO;wBAAE,eAAe,OAAO,WAAW,CAAC;oBAAU;gBACvD;YACF,OAAO;gBACL,IAAI;oBAAE,eAAe,CAAC;gBAAE;YAC1B;QACF;QAEA,uBAAuB,CAAC,iBAAiB,MAAM,OAAO;YACpD,IAAI,CAAA;gBACF,MAAM,WAAW,MAAM,eAAe,CAAC,gBAAgB,IAAI;oBACzD,WAAW,EAAE;oBACb,SAAS,EAAE;gBACb;gBAEA,MAAM,YAAY,aAAa,KAAK,GAAG;gBACvC,OAAO;oBACL,iBAAiB;wBACf,GAAG,MAAM,eAAe;wBACxB,CAAC,gBAAgB,EAAE;4BACjB,GAAG,QAAQ;4BACX,CAAC,KAAK,EAAE;wBACV;oBACF;oBACA,eAAe;wBACb,GAAG,MAAM,aAAa;wBACtB,CAAC,gBAAgB,EAAE;4BACjB,aAAa;wBACf;oBACF;gBACF;YACF;QACF;QAEA,sBAAsB,CAAC;YACrB,IAAI,CAAA;gBACF,MAAM,EAAE,CAAC,gBAAgB,EAAE,CAAC,EAAE,GAAG,MAAM,GAAG,MAAM,eAAe;gBAC/D,MAAM,EAAE,CAAC,gBAAgB,EAAE,EAAE,EAAE,GAAG,UAAU,GAAG,MAAM,aAAa;gBAClE,OAAO;oBAAE,iBAAiB;oBAAM,eAAe;gBAAS;YAC1D;QACF;QAEA,kBAAkB,CAAC,iBAAiB;YAClC,MAAM,MAAM,GAAG,gBAAgB,CAAC,EAAE,MAAM;YACxC,OAAO,MAAM,aAAa,CAAC,IAAI,EAAE,SAAS,EAAE;QAC9C;QAEA,oBAAoB,CAAC,iBAAiB;YACpC,OAAO,MAAM,eAAe,CAAC,gBAAgB,EAAE,CAAC,KAAK,IAAI,EAAE;QAC7D;QAEA,cAAc,CAAC,iBAAiB;YAC9B,MAAM,MAAM,GAAG,gBAAgB,CAAC,EAAE,MAAM;YACxC,OAAO,MAAM,aAAa,CAAC,IAAI,EAAE;QACnC;IACF,CAAC;AAOM,SAAS,mBACd,OAAoG,EACpG,eAAwB,EACxB,aAAsB;IAEtB,yCAAyC;IACzC,IAAI,iBAAiB,OAAO;IAC5B,IAAI,eAAe,OAAO;IAE1B,iCAAiC;IACjC,IAAI,CAAC,SAAS,OAAO;IACrB,OAAO,QAAQ,cAAc,IAAI,QAAQ,aAAa,EAAE,CAAC,EAAE,IAAI,QAAQ,MAAM,EAAE,CAAC,EAAE;AACpF"}},
    {"offset": {"line": 2146, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/products/components/product-image.tsx"],"sourcesContent":["/**\r\n * ProductImage Component\r\n * \r\n * Component hi·ªÉn th·ªã ·∫£nh s·∫£n ph·∫©m v·ªõi logic ∆∞u ti√™n:\r\n * 1. ·∫¢nh t·ª´ server (upload th·ª±c) - ∆∞u ti√™n cao nh·∫•t\r\n * 2. ·∫¢nh t·ª´ product data (mock/seed)\r\n * 3. Icon placeholder n·∫øu kh√¥ng c√≥ ·∫£nh\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { Package } from 'lucide-react';\r\nimport { useImageStore } from '../image-store';\r\nimport { FileUploadAPI } from '@/lib/file-upload-api';\r\nimport { LazyImage } from '@/components/ui/lazy-image';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface ProductImageProps {\r\n  productSystemId: string;\r\n  productData?: {\r\n    thumbnailImage?: string;\r\n    galleryImages?: string[];\r\n    images?: string[];\r\n    name?: string;\r\n  } | null;\r\n  alt?: string;\r\n  size?: 'xs' | 'sm' | 'md' | 'lg';\r\n  className?: string;\r\n}\r\n\r\nconst sizeClasses = {\r\n  xs: 'w-8 h-8',\r\n  sm: 'w-10 h-10',\r\n  md: 'w-12 h-12',\r\n  lg: 'w-16 h-16',\r\n};\r\n\r\nconst iconSizes = {\r\n  xs: 'h-4 w-4',\r\n  sm: 'h-5 w-5',\r\n  md: 'h-6 w-6',\r\n  lg: 'h-8 w-8',\r\n};\r\n\r\nexport function ProductImage({ \r\n  productSystemId, \r\n  productData, \r\n  alt,\r\n  size = 'md',\r\n  className \r\n}: ProductImageProps) {\r\n  // Get image from store (server images)\r\n  const permanentImages = useImageStore(state => state.permanentImages[productSystemId]);\r\n  const lastFetched = useImageStore(state => state.permanentMeta[productSystemId]?.lastFetched);\r\n  const updatePermanentImages = useImageStore(state => state.updatePermanentImages);\r\n\r\n  const storeThumbnail = permanentImages?.thumbnail?.[0]?.url;\r\n  const storeGallery = permanentImages?.gallery?.[0]?.url;\r\n\r\n  // ‚úÖ ∆Øu ti√™n ·∫£nh t·ª´ server tr∆∞·ªõc, sau ƒë√≥ m·ªõi ƒë·∫øn product data\r\n  const displayImage = React.useMemo(() => {\r\n    // 1. ·∫¢nh t·ª´ server (∆∞u ti√™n cao nh·∫•t)\r\n    if (storeThumbnail) return storeThumbnail;\r\n    if (storeGallery) return storeGallery;\r\n    // 2. ·∫¢nh t·ª´ product data (mock/seed)\r\n    if (!productData) return undefined;\r\n    return productData.thumbnailImage || productData.galleryImages?.[0] || productData.images?.[0];\r\n  }, [storeThumbnail, storeGallery, productData]);\r\n\r\n  // Fetch image from server if not yet fetched\r\n  React.useEffect(() => {\r\n    if (!lastFetched && productSystemId) {\r\n      FileUploadAPI.getProductFiles(productSystemId)\r\n        .then(files => {\r\n          if (!files || !Array.isArray(files)) return;\r\n          \r\n          const mapToServerFile = (f: any) => ({\r\n            id: f.id,\r\n            sessionId: '',\r\n            name: f.name,\r\n            originalName: f.originalName,\r\n            slug: f.slug,\r\n            filename: f.filename,\r\n            size: f.size,\r\n            type: f.type,\r\n            url: f.url,\r\n            status: 'permanent' as const,\r\n            uploadedAt: f.uploadedAt,\r\n            metadata: f.metadata\r\n          });\r\n\r\n          const thumbnailFiles = files.filter(f => f.documentName === 'thumbnail').map(mapToServerFile);\r\n          const galleryFiles = files.filter(f => f.documentName === 'gallery').map(mapToServerFile);\r\n          \r\n          updatePermanentImages(productSystemId, 'thumbnail', thumbnailFiles);\r\n          updatePermanentImages(productSystemId, 'gallery', galleryFiles);\r\n        })\r\n        .catch(err => console.error(\"Failed to load product image\", err));\r\n    }\r\n  }, [productSystemId, lastFetched, updatePermanentImages]);\r\n\r\n  const sizeClass = sizeClasses[size];\r\n  const iconSize = iconSizes[size];\r\n  const displayAlt = alt || productData?.name || 'Product';\r\n\r\n  if (displayImage) {\r\n    return (\r\n      <div className={cn(sizeClass, \"flex-shrink-0 rounded overflow-hidden bg-muted\", className)}>\r\n        <LazyImage\r\n          src={displayImage}\r\n          alt={displayAlt}\r\n          className=\"w-full h-full object-cover\"\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={cn(sizeClass, \"flex-shrink-0 bg-muted rounded flex items-center justify-center\", className)}>\r\n      <Package className={cn(iconSize, \"text-muted-foreground\")} />\r\n    </div>\r\n  );\r\n}\r\n\r\n/**\r\n * Hook ƒë·ªÉ l·∫•y URL ·∫£nh s·∫£n ph·∫©m v·ªõi logic ∆∞u ti√™n server\r\n */\r\nexport function useProductImage(\r\n  productSystemId: string,\r\n  productData?: {\r\n    thumbnailImage?: string;\r\n    galleryImages?: string[];\r\n    images?: string[];\r\n  } | null\r\n) {\r\n  const permanentImages = useImageStore(state => state.permanentImages[productSystemId]);\r\n  const lastFetched = useImageStore(state => state.permanentMeta[productSystemId]?.lastFetched);\r\n  const updatePermanentImages = useImageStore(state => state.updatePermanentImages);\r\n\r\n  const storeThumbnail = permanentImages?.thumbnail?.[0]?.url;\r\n  const storeGallery = permanentImages?.gallery?.[0]?.url;\r\n\r\n  // Fetch if needed\r\n  React.useEffect(() => {\r\n    if (!lastFetched && productSystemId) {\r\n      FileUploadAPI.getProductFiles(productSystemId)\r\n        .then(files => {\r\n          if (!files || !Array.isArray(files)) return;\r\n          \r\n          const mapToServerFile = (f: any) => ({\r\n            id: f.id,\r\n            sessionId: '',\r\n            name: f.name,\r\n            originalName: f.originalName,\r\n            slug: f.slug,\r\n            filename: f.filename,\r\n            size: f.size,\r\n            type: f.type,\r\n            url: f.url,\r\n            status: 'permanent' as const,\r\n            uploadedAt: f.uploadedAt,\r\n            metadata: f.metadata\r\n          });\r\n\r\n          const thumbnailFiles = files.filter(f => f.documentName === 'thumbnail').map(mapToServerFile);\r\n          const galleryFiles = files.filter(f => f.documentName === 'gallery').map(mapToServerFile);\r\n          \r\n          updatePermanentImages(productSystemId, 'thumbnail', thumbnailFiles);\r\n          updatePermanentImages(productSystemId, 'gallery', galleryFiles);\r\n        })\r\n        .catch(() => {});\r\n    }\r\n  }, [productSystemId, lastFetched, updatePermanentImages]);\r\n\r\n  return React.useMemo(() => {\r\n    // 1. ·∫¢nh t·ª´ server (∆∞u ti√™n cao nh·∫•t)\r\n    if (storeThumbnail) return storeThumbnail;\r\n    if (storeGallery) return storeGallery;\r\n    // 2. ·∫¢nh t·ª´ product data\r\n    if (!productData) return undefined;\r\n    return productData.thumbnailImage || productData.galleryImages?.[0] || productData.images?.[0];\r\n  }, [storeThumbnail, storeGallery, productData]);\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAAA;;;;;;;CAOC,GAED;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAeA,MAAM,cAAc;IAClB,IAAI;IACJ,IAAI;IACJ,IAAI;IACJ,IAAI;AACN;AAEA,MAAM,YAAY;IAChB,IAAI;IACJ,IAAI;IACJ,IAAI;IACJ,IAAI;AACN;AAEO,SAAS,aAAa,EAC3B,eAAe,EACf,WAAW,EACX,GAAG,EACH,OAAO,IAAI,EACX,SAAS,EACS;;IAClB,uCAAuC;IACvC,MAAM,kBAAkB,IAAA,0JAAa;uDAAC,CAAA,QAAS,MAAM,eAAe,CAAC,gBAAgB;;IACrF,MAAM,cAAc,IAAA,0JAAa;mDAAC,CAAA,QAAS,MAAM,aAAa,CAAC,gBAAgB,EAAE;;IACjF,MAAM,wBAAwB,IAAA,0JAAa;6DAAC,CAAA,QAAS,MAAM,qBAAqB;;IAEhF,MAAM,iBAAiB,iBAAiB,WAAW,CAAC,EAAE,EAAE;IACxD,MAAM,eAAe,iBAAiB,SAAS,CAAC,EAAE,EAAE;IAEpD,6DAA6D;IAC7D,MAAM,eAAe,wKAAa;8CAAC;YACjC,sCAAsC;YACtC,IAAI,gBAAgB,OAAO;YAC3B,IAAI,cAAc,OAAO;YACzB,qCAAqC;YACrC,IAAI,CAAC,aAAa,OAAO;YACzB,OAAO,YAAY,cAAc,IAAI,YAAY,aAAa,EAAE,CAAC,EAAE,IAAI,YAAY,MAAM,EAAE,CAAC,EAAE;QAChG;6CAAG;QAAC;QAAgB;QAAc;KAAY;IAE9C,6CAA6C;IAC7C,0KAAe;kCAAC;YACd,IAAI,CAAC,eAAe,iBAAiB;gBACnC,gJAAa,CAAC,eAAe,CAAC,iBAC3B,IAAI;8CAAC,CAAA;wBACJ,IAAI,CAAC,SAAS,CAAC,MAAM,OAAO,CAAC,QAAQ;wBAErC,MAAM;sEAAkB,CAAC,IAAW,CAAC;oCACnC,IAAI,EAAE,EAAE;oCACR,WAAW;oCACX,MAAM,EAAE,IAAI;oCACZ,cAAc,EAAE,YAAY;oCAC5B,MAAM,EAAE,IAAI;oCACZ,UAAU,EAAE,QAAQ;oCACpB,MAAM,EAAE,IAAI;oCACZ,MAAM,EAAE,IAAI;oCACZ,KAAK,EAAE,GAAG;oCACV,QAAQ;oCACR,YAAY,EAAE,UAAU;oCACxB,UAAU,EAAE,QAAQ;gCACtB,CAAC;;wBAED,MAAM,iBAAiB,MAAM,MAAM;qEAAC,CAAA,IAAK,EAAE,YAAY,KAAK;oEAAa,GAAG,CAAC;wBAC7E,MAAM,eAAe,MAAM,MAAM;mEAAC,CAAA,IAAK,EAAE,YAAY,KAAK;kEAAW,GAAG,CAAC;wBAEzE,sBAAsB,iBAAiB,aAAa;wBACpD,sBAAsB,iBAAiB,WAAW;oBACpD;6CACC,KAAK;8CAAC,CAAA,MAAO,QAAQ,KAAK,CAAC,gCAAgC;;YAChE;QACF;iCAAG;QAAC;QAAiB;QAAa;KAAsB;IAExD,MAAM,YAAY,WAAW,CAAC,KAAK;IACnC,MAAM,WAAW,SAAS,CAAC,KAAK;IAChC,MAAM,aAAa,OAAO,aAAa,QAAQ;IAE/C,IAAI,cAAc;QAChB,qBACE,6LAAC;YAAI,WAAW,IAAA,qHAAE,EAAC,WAAW,kDAAkD;sBAC9E,cAAA,6LAAC,kJAAS;gBACR,KAAK;gBACL,KAAK;gBACL,WAAU;;;;;;;;;;;IAIlB;IAEA,qBACE,6LAAC;QAAI,WAAW,IAAA,qHAAE,EAAC,WAAW,mEAAmE;kBAC/F,cAAA,6LAAC,sNAAO;YAAC,WAAW,IAAA,qHAAE,EAAC,UAAU;;;;;;;;;;;AAGvC;GA9EgB;;QAQU,0JAAa;QACjB,0JAAa;QACH,0JAAa;;;KAV7B;AAmFT,SAAS,gBACd,eAAuB,EACvB,WAIQ;;IAER,MAAM,kBAAkB,IAAA,0JAAa;0DAAC,CAAA,QAAS,MAAM,eAAe,CAAC,gBAAgB;;IACrF,MAAM,cAAc,IAAA,0JAAa;sDAAC,CAAA,QAAS,MAAM,aAAa,CAAC,gBAAgB,EAAE;;IACjF,MAAM,wBAAwB,IAAA,0JAAa;gEAAC,CAAA,QAAS,MAAM,qBAAqB;;IAEhF,MAAM,iBAAiB,iBAAiB,WAAW,CAAC,EAAE,EAAE;IACxD,MAAM,eAAe,iBAAiB,SAAS,CAAC,EAAE,EAAE;IAEpD,kBAAkB;IAClB,0KAAe;qCAAC;YACd,IAAI,CAAC,eAAe,iBAAiB;gBACnC,gJAAa,CAAC,eAAe,CAAC,iBAC3B,IAAI;iDAAC,CAAA;wBACJ,IAAI,CAAC,SAAS,CAAC,MAAM,OAAO,CAAC,QAAQ;wBAErC,MAAM;yEAAkB,CAAC,IAAW,CAAC;oCACnC,IAAI,EAAE,EAAE;oCACR,WAAW;oCACX,MAAM,EAAE,IAAI;oCACZ,cAAc,EAAE,YAAY;oCAC5B,MAAM,EAAE,IAAI;oCACZ,UAAU,EAAE,QAAQ;oCACpB,MAAM,EAAE,IAAI;oCACZ,MAAM,EAAE,IAAI;oCACZ,KAAK,EAAE,GAAG;oCACV,QAAQ;oCACR,YAAY,EAAE,UAAU;oCACxB,UAAU,EAAE,QAAQ;gCACtB,CAAC;;wBAED,MAAM,iBAAiB,MAAM,MAAM;wEAAC,CAAA,IAAK,EAAE,YAAY,KAAK;uEAAa,GAAG,CAAC;wBAC7E,MAAM,eAAe,MAAM,MAAM;sEAAC,CAAA,IAAK,EAAE,YAAY,KAAK;qEAAW,GAAG,CAAC;wBAEzE,sBAAsB,iBAAiB,aAAa;wBACpD,sBAAsB,iBAAiB,WAAW;oBACpD;gDACC,KAAK;iDAAC,KAAO;;YAClB;QACF;oCAAG;QAAC;QAAiB;QAAa;KAAsB;IAExD,OAAO,wKAAa;mCAAC;YACnB,sCAAsC;YACtC,IAAI,gBAAgB,OAAO;YAC3B,IAAI,cAAc,OAAO;YACzB,yBAAyB;YACzB,IAAI,CAAC,aAAa,OAAO;YACzB,OAAO,YAAY,cAAc,IAAI,YAAY,aAAa,EAAE,CAAC,EAAE,IAAI,YAAY,MAAM,EAAE,CAAC,EAAE;QAChG;kCAAG;QAAC;QAAgB;QAAc;KAAY;AAChD;IAvDgB;;QAQU,0JAAa;QACjB,0JAAa;QACH,0JAAa"}},
    {"offset": {"line": 2387, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/stock-history/store.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { formatDate, formatDateTime, formatDateTimeSeconds, formatDateCustom, parseDate, getCurrentDate } from '@/lib/date-utils';\r\nimport type { StockHistoryEntry } from './types';\r\nimport { asSystemId } from '../../lib/id-types';\r\nimport type { SystemId } from '../../lib/id-types';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\n\r\n// API sync helpers\r\nasync function syncToAPI(action: 'create', data: any): Promise<boolean> {\r\n  try {\r\n    const response = await fetch('/api/inventory/stock-history', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify(data),\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      console.error(`[StockHistory API] ${action} failed:`, await response.text());\r\n      return false;\r\n    }\r\n    return true;\r\n  } catch (error) {\r\n    console.error(`[StockHistory API] ${action} error:`, error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// ‚ú® Migration helper: Convert SKU to systemId for old data\r\nfunction migrateHistoryData(entries: StockHistoryEntry[]): StockHistoryEntry[] {\r\n  // Map SKU ‚Üí systemId from products\r\n  const skuToSystemId: Record<string, string> = {\r\n    'DV-WEB-01': 'SP00000001',\r\n    'DV-WEB-02': 'SP00000002',\r\n    'DV-WEB-03': 'SP00000003',\r\n    'DV-MKT-01': 'SP00000004',\r\n    'DV-MKT-02': 'SP00000005',\r\n    'DV-MKT-03': 'SP00000006',\r\n    'DV-SEO-01': 'SP00000007',\r\n    'DV-SEO-02': 'SP00000008',\r\n    'DV-IT-01': 'SP00000009',\r\n    'DV-DSN-01': 'SP00000010',\r\n    'SW-CRM-01': 'SP00000011',\r\n    'SW-ERP-01': 'SP00000012',\r\n    'SW-WIN-01': 'SP00000013',\r\n    'SW-OFF-01': 'SP00000014',\r\n    'SW-ADOBE-01': 'SP00000015',\r\n    'HW-SRV-01': 'SP00000016',\r\n    'HW-SRV-02': 'SP00000017',\r\n    'HW-PC-01': 'SP00000018',\r\n    'HW-PC-02': 'SP00000019',\r\n    'HW-LT-01': 'SP00000020',\r\n    'HW-NET-01': 'SP00000021',\r\n    'HW-NET-02': 'SP00000022',\r\n    'HW-CAM-01': 'SP00000023',\r\n    'MISC-HOST-01': 'SP00000024',\r\n    'MISC-HOST-02': 'SP00000025',\r\n    'MISC-SSL-01': 'SP00000026',\r\n    'MISC-DOMAIN-COM': 'SP00000027',\r\n    'MISC-DOMAIN-VN': 'SP00000028',\r\n    'MISC-PRINT-01': 'SP00000029',\r\n    'MISC-PRINT-02': 'SP00000030',\r\n  };\r\n  \r\n  return entries.map(entry => ({\r\n    ...entry,\r\n    productId: asSystemId(skuToSystemId[entry.productId as any] || entry.productId) // Convert or keep if already systemId\r\n  }));\r\n}\r\n\r\ninterface StockHistoryState {\r\n  entries: StockHistoryEntry[];\r\n  initialized: boolean;\r\n  addEntry: (entry: Omit<StockHistoryEntry, 'systemId'>) => void;\r\n  getHistoryForProduct: (productId: SystemId, branchSystemId?: 'all' | SystemId) => StockHistoryEntry[];\r\n  loadFromAPI: () => Promise<void>;\r\n}\r\n\r\nlet entryCounter = 0;\r\n\r\nexport const useStockHistoryStore = create<StockHistoryState>()(\r\n  (set, get) => ({\r\n      entries: [], // Database is source of truth\r\n      initialized: false,\r\n      \r\n      addEntry: (entry) => {\r\n        entryCounter++;\r\n        const newEntry: StockHistoryEntry = {\r\n            ...entry,\r\n            systemId: asSystemId(`HISTORY${String(Date.now()).slice(-6)}_${entryCounter}`),\r\n        };\r\n        set((state) => ({ entries: [...state.entries, newEntry] }));\r\n        // Sync to API\r\n        syncToAPI('create', newEntry).catch(console.error);\r\n      },\r\n      \r\n      getHistoryForProduct: (productId, branchSystemId = 'all') => {\r\n          const productHistory = get().entries.filter(e => e.productId === productId);\r\n          const sortedHistory = productHistory.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n\r\n          if (branchSystemId === 'all') {\r\n            return sortedHistory;\r\n          }\r\n          return sortedHistory.filter(e => e.branchSystemId === branchSystemId);\r\n        },\r\n      \r\n      loadFromAPI: async () => {\r\n        try {\r\n          // NOTE: Use React Query hooks for paginated data. This only loads initial batch.\r\n          const response = await fetch('/api/inventory/stock-history?limit=30');\r\n          if (!response.ok) return;\r\n          const json = await response.json();\r\n          const apiData = json.data || [];\r\n          if (apiData.length > 0) {\r\n            set({ entries: migrateHistoryData(apiData), initialized: true });\r\n          } else {\r\n            set({ initialized: true });\r\n          }\r\n        } catch (error) {\r\n          console.error('[StockHistory API] loadFromAPI error:', error);\r\n        }\r\n      },\r\n    })\r\n);\r\n"],"names":[],"mappings":";;;;AAAA;AAGA;;;AAEA,mHAAmH;AAEnH,mBAAmB;AACnB,eAAe,UAAU,MAAgB,EAAE,IAAS;IAClD,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,gCAAgC;YAC3D,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;QACvB;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,QAAQ,KAAK,CAAC,CAAC,mBAAmB,EAAE,OAAO,QAAQ,CAAC,EAAE,MAAM,SAAS,IAAI;YACzE,OAAO;QACT;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,mBAAmB,EAAE,OAAO,OAAO,CAAC,EAAE;QACrD,OAAO;IACT;AACF;AAEA,2DAA2D;AAC3D,SAAS,mBAAmB,OAA4B;IACtD,mCAAmC;IACnC,MAAM,gBAAwC;QAC5C,aAAa;QACb,aAAa;QACb,aAAa;QACb,aAAa;QACb,aAAa;QACb,aAAa;QACb,aAAa;QACb,aAAa;QACb,YAAY;QACZ,aAAa;QACb,aAAa;QACb,aAAa;QACb,aAAa;QACb,aAAa;QACb,eAAe;QACf,aAAa;QACb,aAAa;QACb,YAAY;QACZ,YAAY;QACZ,YAAY;QACZ,aAAa;QACb,aAAa;QACb,aAAa;QACb,gBAAgB;QAChB,gBAAgB;QAChB,eAAe;QACf,mBAAmB;QACnB,kBAAkB;QAClB,iBAAiB;QACjB,iBAAiB;IACnB;IAEA,OAAO,QAAQ,GAAG,CAAC,CAAA,QAAS,CAAC;YAC3B,GAAG,KAAK;YACR,WAAW,IAAA,mIAAU,EAAC,aAAa,CAAC,MAAM,SAAS,CAAQ,IAAI,MAAM,SAAS,EAAE,sCAAsC;QACxH,CAAC;AACH;AAUA,IAAI,eAAe;AAEZ,MAAM,uBAAuB,IAAA,qJAAM,IACxC,CAAC,KAAK,MAAQ,CAAC;QACX,SAAS,EAAE;QACX,aAAa;QAEb,UAAU,CAAC;YACT;YACA,MAAM,WAA8B;gBAChC,GAAG,KAAK;gBACR,UAAU,IAAA,mIAAU,EAAC,CAAC,OAAO,EAAE,OAAO,KAAK,GAAG,IAAI,KAAK,CAAC,CAAC,GAAG,CAAC,EAAE,cAAc;YACjF;YACA,IAAI,CAAC,QAAU,CAAC;oBAAE,SAAS;2BAAI,MAAM,OAAO;wBAAE;qBAAS;gBAAC,CAAC;YACzD,cAAc;YACd,UAAU,UAAU,UAAU,KAAK,CAAC,QAAQ,KAAK;QACnD;QAEA,sBAAsB,CAAC,WAAW,iBAAiB,KAAK;YACpD,MAAM,iBAAiB,MAAM,OAAO,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,SAAS,KAAK;YACjE,MAAM,gBAAgB,eAAe,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI,KAAK,EAAE,IAAI,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,IAAI,EAAE,OAAO;YAEzG,IAAI,mBAAmB,OAAO;gBAC5B,OAAO;YACT;YACA,OAAO,cAAc,MAAM,CAAC,CAAA,IAAK,EAAE,cAAc,KAAK;QACxD;QAEF,aAAa;YACX,IAAI;gBACF,iFAAiF;gBACjF,MAAM,WAAW,MAAM,MAAM;gBAC7B,IAAI,CAAC,SAAS,EAAE,EAAE;gBAClB,MAAM,OAAO,MAAM,SAAS,IAAI;gBAChC,MAAM,UAAU,KAAK,IAAI,IAAI,EAAE;gBAC/B,IAAI,QAAQ,MAAM,GAAG,GAAG;oBACtB,IAAI;wBAAE,SAAS,mBAAmB;wBAAU,aAAa;oBAAK;gBAChE,OAAO;oBACL,IAAI;wBAAE,aAAa;oBAAK;gBAC1B;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,yCAAyC;YACzD;QACF;IACF,CAAC"}},
    {"offset": {"line": 2512, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/cashbook/store.ts"],"sourcesContent":["import { create } from 'zustand';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { CashAccount } from './types';\r\nimport { findNextAvailableBusinessId, generateSystemId, getMaxBusinessIdCounter, getMaxSystemIdCounter, type EntityType } from '../../lib/id-utils';\r\nimport { asBusinessId, asSystemId, type BusinessId, type SystemId } from '../../lib/id-types';\r\n\r\nconst CASH_ACCOUNT_ENTITY: EntityType = 'cash-accounts';\r\nconst SYSTEM_ID_PREFIX = 'ACCOUNT';\r\nconst BUSINESS_ID_PREFIX = 'TK';\r\nconst BUSINESS_ID_DIGITS = 6;\r\n\r\n// API sync helpers\r\nasync function syncToAPI(action: 'create' | 'update' | 'delete', data: any): Promise<boolean> {\r\n  try {\r\n    const endpoint = action === 'create' ? '/api/cash-accounts' : `/api/cash-accounts/${data.systemId}`;\r\n    const method = action === 'create' ? 'POST' : action === 'update' ? 'PATCH' : 'DELETE';\r\n    \r\n    const response = await fetch(endpoint, {\r\n      method,\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: action !== 'delete' ? JSON.stringify(data) : undefined,\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      console.error(`[Cashbook API] ${action} failed:`, await response.text());\r\n      return false;\r\n    }\r\n    return true;\r\n  } catch (error) {\r\n    console.error(`[Cashbook API] ${action} error:`, error);\r\n    return false;\r\n  }\r\n}\r\n\r\nasync function fetchFromAPI(): Promise<CashAccount[]> {\r\n  try {\r\n    const response = await fetch('/api/cash-accounts?limit=50');\r\n    if (!response.ok) return [];\r\n    const json = await response.json();\r\n    return json.data || [];\r\n  } catch (error) {\r\n    console.error('[Cashbook API] fetch error:', error);\r\n    return [];\r\n  }\r\n}\r\n\r\ninterface CashbookState {\r\n  accounts: CashAccount[];\r\n  initialized: boolean;\r\n  getAccountById: (id: BusinessId) => CashAccount | undefined;\r\n  add: (item: Omit<CashAccount, 'systemId'>) => void;\r\n  update: (systemId: SystemId, item: CashAccount) => void;\r\n  remove: (systemId: SystemId) => void;\r\n  setDefault: (systemId: SystemId) => void;\r\n  loadFromAPI: () => Promise<void>;\r\n}\r\n\r\nconst getNextSystemId = (accounts: CashAccount[]): SystemId => {\r\n  const currentCounter = getMaxSystemIdCounter(accounts, SYSTEM_ID_PREFIX);\r\n  return asSystemId(generateSystemId(CASH_ACCOUNT_ENTITY, currentCounter + 1));\r\n};\r\n\r\nconst ensureBusinessId = (accounts: CashAccount[], provided?: BusinessId): BusinessId => {\r\n  if (provided && provided.trim()) {\r\n    return provided;\r\n  }\r\n\r\n  const existingIds = accounts.map(acc => acc.id as string);\r\n  const startCounter = getMaxBusinessIdCounter(accounts, BUSINESS_ID_PREFIX);\r\n  const { nextId } = findNextAvailableBusinessId(BUSINESS_ID_PREFIX, existingIds, startCounter, BUSINESS_ID_DIGITS);\r\n  return asBusinessId(nextId);\r\n};\r\n\r\nexport const useCashbookStore = create<CashbookState>()(\r\n  (set, get) => ({\r\n      accounts: [],\r\n      initialized: false,\r\n      getAccountById: (id) => get().accounts.find(a => a.id === id),\r\n      \r\n      add: (item) => {\r\n        const newAccount: CashAccount = {\r\n          ...item,\r\n          systemId: getNextSystemId(get().accounts),\r\n          id: ensureBusinessId(get().accounts, item.id),\r\n        };\r\n        set((state) => ({ accounts: [...state.accounts, newAccount] }));\r\n        // Sync to API\r\n        syncToAPI('create', newAccount).catch(console.error);\r\n      },\r\n      \r\n      update: (systemId, updatedItem) => {\r\n        set((state) => ({\r\n          accounts: state.accounts.map((acc) => (acc.systemId === systemId ? updatedItem : acc))\r\n        }));\r\n        // Sync to API\r\n        syncToAPI('update', updatedItem).catch(console.error);\r\n      },\r\n      \r\n      remove: (systemId) => {\r\n        set((state) => ({\r\n          accounts: state.accounts.filter(acc => acc.systemId !== systemId)\r\n        }));\r\n        // Sync to API\r\n        syncToAPI('delete', { systemId }).catch(console.error);\r\n      },\r\n      \r\n      setDefault: (systemId) => {\r\n        set((state) => {\r\n          const targetAccount = state.accounts.find(acc => acc.systemId === systemId);\r\n          if (!targetAccount) return state;\r\n\r\n          const updated = state.accounts.map(acc => ({\r\n            ...acc,\r\n            isDefault: (acc.type === targetAccount.type ? acc.systemId === systemId : acc.isDefault) ?? false\r\n          }));\r\n          \r\n          // Sync updated accounts to API\r\n          updated.forEach(acc => {\r\n            if (acc.type === targetAccount.type) {\r\n              syncToAPI('update', acc).catch(console.error);\r\n            }\r\n          });\r\n          \r\n          return { accounts: updated };\r\n        });\r\n      },\r\n      \r\n      loadFromAPI: async () => {\r\n        const apiData = await fetchFromAPI();\r\n        if (apiData.length > 0) {\r\n          set({ accounts: apiData, initialized: true });\r\n        } else {\r\n          set({ initialized: true });\r\n        }\r\n      },\r\n    })\r\n);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2647, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/finance/document-lookups.ts"],"sourcesContent":["import { useTargetGroupStore } from '@/features/settings/target-groups/store';\r\nimport { usePaymentMethodStore } from '@/features/settings/payments/methods/store';\r\nimport { useCashbookStore } from '@/features/cashbook/store';\r\nimport { useReceiptTypeStore } from '@/features/settings/receipt-types/store';\r\nimport { usePaymentTypeStore } from '@/features/settings/payments/types/store';\r\nimport type { TargetGroup } from '@/features/settings/target-groups/types';\r\nimport type { PaymentMethod } from '@/features/settings/payments/methods/types';\r\nimport type { CashAccount } from '@/features/cashbook/types';\r\nimport type { ReceiptType } from '@/features/settings/receipt-types/types';\r\nimport type { PaymentType } from '@/features/settings/payments/types/types';\r\nimport type { SystemId } from '@/lib/id-types';\r\n\r\nconst normalizeName = (value?: string | null) => (value ?? '').trim().toLowerCase();\r\n\r\nexport const DEFAULT_CUSTOMER_GROUP = 'kh√°ch h√†ng';\r\n\r\nexport const pickTargetGroup = (options?: {\r\n  systemId?: SystemId | undefined;\r\n  name?: string | undefined;\r\n  fallbackName?: string | undefined;\r\n}): TargetGroup | null => {\r\n  const groups = useTargetGroupStore.getState().data ?? [];\r\n  if (groups.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  if (options?.systemId) {\r\n    const match = groups.find(group => group.systemId === options.systemId);\r\n    if (match) {\r\n      return match;\r\n    }\r\n  }\r\n\r\n  const lookupNames = [options?.name, options?.fallbackName, DEFAULT_CUSTOMER_GROUP].filter(Boolean) as string[];\r\n  for (const candidate of lookupNames) {\r\n    const normalized = normalizeName(candidate);\r\n    const match = groups.find(group => normalizeName(group.name) === normalized);\r\n    if (match) {\r\n      return match;\r\n    }\r\n  }\r\n\r\n  return groups[0] ?? null;\r\n};\r\n\r\nexport const pickPaymentMethod = (options?: {\r\n  systemId?: SystemId | undefined;\r\n  name?: string | undefined;\r\n}): PaymentMethod | null => {\r\n  const methods = usePaymentMethodStore.getState().data ?? [];\r\n  if (methods.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  if (options?.systemId) {\r\n    const match = methods.find(method => method.systemId === options.systemId);\r\n    if (match) {\r\n      return match;\r\n    }\r\n  }\r\n\r\n  if (options?.name) {\r\n    const normalized = normalizeName(options.name);\r\n    const match = methods.find(method => normalizeName(method.name) === normalized);\r\n    if (match) {\r\n      return match;\r\n    }\r\n  }\r\n\r\n  return methods.find(method => method.isDefault) ?? methods[0] ?? null;\r\n};\r\n\r\nexport const pickAccount = (options: {\r\n  accountSystemId?: SystemId | undefined;\r\n  preferredType?: 'cash' | 'bank' | undefined;\r\n  branchSystemId?: SystemId | undefined;\r\n  paymentMethodName?: string | undefined;\r\n}): CashAccount | null => {\r\n  const { accounts } = useCashbookStore.getState();\r\n  if (!accounts || accounts.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  if (options.accountSystemId) {\r\n    const match = accounts.find(account => account.systemId === options.accountSystemId);\r\n    if (match) {\r\n      return match;\r\n    }\r\n  }\r\n\r\n  let preferredType = options.preferredType;\r\n  if (!preferredType && options.paymentMethodName) {\r\n    const normalizedMethod = normalizeName(options.paymentMethodName);\r\n    preferredType = normalizedMethod === 'ti·ªÅn m·∫∑t' ? 'cash' : normalizedMethod === 'chuy·ªÉn kho·∫£n' ? 'bank' : undefined;\r\n  }\r\n\r\n  const candidates = preferredType ? accounts.filter(account => account.type === preferredType) : accounts;\r\n\r\n  if (candidates.length === 0) {\r\n    return accounts[0];\r\n  }\r\n\r\n  return (\r\n    candidates.find(account => account.branchSystemId && options.branchSystemId && account.branchSystemId === options.branchSystemId) ??\r\n    candidates.find(account => account.isDefault) ??\r\n    candidates[0]\r\n  );\r\n};\r\n\r\nexport const pickReceiptType = (options?: {\r\n  systemId?: SystemId | undefined;\r\n  name?: string | undefined;\r\n}): ReceiptType | null => {\r\n  const types = useReceiptTypeStore.getState().data ?? [];\r\n  if (types.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  if (options?.systemId) {\r\n    const match = types.find(type => type.systemId === options.systemId);\r\n    if (match) {\r\n      return match;\r\n    }\r\n  }\r\n\r\n  if (options?.name) {\r\n    const normalized = normalizeName(options.name);\r\n    const match = types.find(type => normalizeName(type.name) === normalized);\r\n    if (match) {\r\n      return match;\r\n    }\r\n  }\r\n\r\n  return types[0] ?? null;\r\n};\r\n\r\nexport const pickPaymentType = (options?: {\r\n  systemId?: SystemId | undefined;\r\n  name?: string | undefined;\r\n}): PaymentType | null => {\r\n  const types = usePaymentTypeStore.getState().data ?? [];\r\n  if (types.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  if (options?.systemId) {\r\n    const match = types.find(type => type.systemId === options.systemId);\r\n    if (match) {\r\n      return match;\r\n    }\r\n  }\r\n\r\n  if (options?.name) {\r\n    const normalized = normalizeName(options.name);\r\n    const match = types.find(type => normalizeName(type.name) === normalized);\r\n    if (match) {\r\n      return match;\r\n    }\r\n  }\r\n\r\n  return types[0] ?? null;\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2787, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/finance/document-helpers.ts"],"sourcesContent":["import { toISODateTime } from '@/lib/date-utils';\r\nimport { asBusinessId, type BusinessId, type SystemId } from '@/lib/id-types';\r\nimport { useReceiptStore, type ReceiptInput } from '@/features/receipts/store';\r\nimport type { Receipt } from '@/features/receipts/types';\r\nimport { usePaymentStore, type PaymentInput } from '@/features/payments/store';\r\nimport type { Payment } from '@/features/payments/types';\r\nimport { pickAccount, pickPaymentMethod, pickPaymentType, pickReceiptType, pickTargetGroup } from '@/features/finance/document-lookups';\r\n\r\nconst asBusinessIdOrUndefined = (value?: string | BusinessId | null) => {\r\n  if (!value) {\r\n    return undefined;\r\n  }\r\n  return typeof value === 'string' ? asBusinessId(value) : value;\r\n};\r\n\r\ninterface ReceiptDocumentOptions {\r\n  amount: number;\r\n  description: string;\r\n  customerName: string;\r\n  branchSystemId: SystemId;\r\n  branchName: string;\r\n  createdBy: SystemId;\r\n  customerSystemId?: SystemId;\r\n  paymentMethodSystemId?: SystemId;\r\n  paymentMethodName?: string;\r\n  accountSystemId?: SystemId;\r\n  accountPreference?: 'cash' | 'bank';\r\n  receiptTypeSystemId?: SystemId;\r\n  receiptTypeName?: string;\r\n  payerTargetGroupSystemId?: SystemId;\r\n  payerTargetGroupName?: string;\r\n  originalDocumentId?: string | BusinessId;\r\n  linkedOrderSystemId?: SystemId;\r\n  linkedSalesReturnSystemId?: SystemId;\r\n  linkedWarrantySystemId?: SystemId;\r\n  linkedComplaintSystemId?: SystemId;\r\n  category?: Receipt['category'];\r\n  affectsDebt?: boolean;\r\n  status?: Receipt['status'];\r\n  date?: string;\r\n}\r\n\r\ninterface PaymentDocumentOptions {\r\n  amount: number;\r\n  description: string;\r\n  recipientName: string;\r\n  branchSystemId: SystemId;\r\n  branchName: string;\r\n  createdBy: SystemId;\r\n  recipientSystemId?: SystemId;\r\n  customerSystemId?: SystemId;\r\n  customerName?: string;\r\n  paymentMethodSystemId?: SystemId;\r\n  paymentMethodName?: string;\r\n  accountSystemId?: SystemId;\r\n  accountPreference?: 'cash' | 'bank';\r\n  paymentTypeSystemId?: SystemId;\r\n  paymentTypeName?: string;\r\n  recipientTargetGroupSystemId?: SystemId;\r\n  recipientTargetGroupName?: string;\r\n  originalDocumentId?: string | BusinessId;\r\n  linkedOrderSystemId?: SystemId;\r\n  linkedSalesReturnSystemId?: SystemId;\r\n  linkedWarrantySystemId?: SystemId;\r\n  linkedComplaintSystemId?: SystemId;\r\n  category?: Payment['category'];\r\n  affectsDebt?: boolean;\r\n  status?: Payment['status'];\r\n  date?: string;\r\n}\r\n\r\nexport interface DocumentCreationResult<T> {\r\n  document: T | null;\r\n  error?: string;\r\n}\r\n\r\nexport const createReceiptDocument = (options: ReceiptDocumentOptions): DocumentCreationResult<Receipt> => {\r\n  if (!options.branchSystemId) {\r\n    return { document: null, error: 'Thi·∫øu m√£ chi nh√°nh khi t·∫°o phi·∫øu thu.' };\r\n  }\r\n\r\n  const targetGroup = pickTargetGroup({\r\n    systemId: options.payerTargetGroupSystemId,\r\n    name: options.payerTargetGroupName,\r\n  });\r\n  if (!targetGroup) {\r\n    return { document: null, error: 'Ch∆∞a c·∫•u h√¨nh nh√≥m ƒë·ªëi t∆∞·ª£ng (Target Group) cho phi·∫øu thu.' };\r\n  }\r\n\r\n  const paymentMethod = pickPaymentMethod({\r\n    systemId: options.paymentMethodSystemId,\r\n    name: options.paymentMethodName,\r\n  });\r\n  if (!paymentMethod) {\r\n    return { document: null, error: 'Ch∆∞a c·∫•u h√¨nh ph∆∞∆°ng th·ª©c thu ti·ªÅn.' };\r\n  }\r\n\r\n  const account = pickAccount({\r\n    accountSystemId: options.accountSystemId,\r\n    preferredType: options.accountPreference,\r\n    branchSystemId: options.branchSystemId,\r\n    paymentMethodName: paymentMethod.name,\r\n  });\r\n  if (!account) {\r\n    return { document: null, error: 'Ch∆∞a c·∫•u h√¨nh t√†i kho·∫£n qu·ªπ ph√π h·ª£p ƒë·ªÉ t·∫°o phi·∫øu thu.' };\r\n  }\r\n\r\n  const receiptType = pickReceiptType({\r\n    systemId: options.receiptTypeSystemId,\r\n    name: options.receiptTypeName,\r\n  });\r\n  if (!receiptType) {\r\n    return { document: null, error: 'Ch∆∞a c·∫•u h√¨nh lo·∫°i phi·∫øu thu.' };\r\n  }\r\n\r\n  const timestamp = options.date ?? toISODateTime(new Date());\r\n  const payload: ReceiptInput = {\r\n    date: timestamp,\r\n    amount: options.amount,\r\n    payerTypeSystemId: targetGroup.systemId,\r\n    payerTypeName: targetGroup.name,\r\n    payerName: options.customerName,\r\n    payerSystemId: options.customerSystemId,\r\n    description: options.description,\r\n    paymentMethodSystemId: paymentMethod.systemId,\r\n    paymentMethodName: paymentMethod.name,\r\n    accountSystemId: account.systemId,\r\n    paymentReceiptTypeSystemId: receiptType.systemId,\r\n    paymentReceiptTypeName: receiptType.name,\r\n    branchSystemId: options.branchSystemId,\r\n    branchName: options.branchName,\r\n    createdBy: options.createdBy,\r\n    createdAt: timestamp,\r\n    status: options.status ?? 'completed',\r\n    category: options.category,\r\n    originalDocumentId: asBusinessIdOrUndefined(options.originalDocumentId),\r\n    linkedOrderSystemId: options.linkedOrderSystemId,\r\n    linkedSalesReturnSystemId: options.linkedSalesReturnSystemId,\r\n    linkedWarrantySystemId: options.linkedWarrantySystemId,\r\n    linkedComplaintSystemId: options.linkedComplaintSystemId,\r\n    customerSystemId: options.customerSystemId,\r\n    customerName: options.customerName,\r\n    affectsDebt: options.affectsDebt ?? true,\r\n  };\r\n\r\n  const receipt = useReceiptStore.getState().add(payload);\r\n  return { document: receipt };\r\n};\r\n\r\nexport const createPaymentDocument = (options: PaymentDocumentOptions): DocumentCreationResult<Payment> => {\r\n  if (!options.branchSystemId) {\r\n    return { document: null, error: 'Thi·∫øu m√£ chi nh√°nh khi t·∫°o phi·∫øu chi.' };\r\n  }\r\n\r\n  const targetGroup = pickTargetGroup({\r\n    systemId: options.recipientTargetGroupSystemId,\r\n    name: options.recipientTargetGroupName,\r\n  });\r\n  if (!targetGroup) {\r\n    return { document: null, error: 'Ch∆∞a c·∫•u h√¨nh nh√≥m ƒë·ªëi t∆∞·ª£ng (Target Group) cho phi·∫øu chi.' };\r\n  }\r\n\r\n  const paymentMethod = pickPaymentMethod({\r\n    systemId: options.paymentMethodSystemId,\r\n    name: options.paymentMethodName,\r\n  });\r\n  if (!paymentMethod) {\r\n    return { document: null, error: 'Ch∆∞a c·∫•u h√¨nh ph∆∞∆°ng th·ª©c chi ti·ªÅn.' };\r\n  }\r\n\r\n  const account = pickAccount({\r\n    accountSystemId: options.accountSystemId,\r\n    preferredType: options.accountPreference,\r\n    branchSystemId: options.branchSystemId,\r\n    paymentMethodName: paymentMethod.name,\r\n  });\r\n  if (!account) {\r\n    return { document: null, error: 'Ch∆∞a c·∫•u h√¨nh t√†i kho·∫£n qu·ªπ ph√π h·ª£p ƒë·ªÉ t·∫°o phi·∫øu chi.' };\r\n  }\r\n\r\n  const paymentType = pickPaymentType({\r\n    systemId: options.paymentTypeSystemId,\r\n    name: options.paymentTypeName,\r\n  });\r\n  if (!paymentType) {\r\n    return { document: null, error: 'Ch∆∞a c·∫•u h√¨nh lo·∫°i phi·∫øu chi.' };\r\n  }\r\n\r\n  const timestamp = options.date ?? toISODateTime(new Date());\r\n  const payload: PaymentInput = {\r\n    date: timestamp,\r\n    amount: options.amount,\r\n    recipientTypeSystemId: targetGroup.systemId,\r\n    recipientTypeName: targetGroup.name,\r\n    recipientName: options.recipientName,\r\n    recipientSystemId: options.recipientSystemId,\r\n    description: options.description,\r\n    paymentMethodSystemId: paymentMethod.systemId,\r\n    paymentMethodName: paymentMethod.name,\r\n    accountSystemId: account.systemId,\r\n    paymentReceiptTypeSystemId: paymentType.systemId,\r\n    paymentReceiptTypeName: paymentType.name,\r\n    branchSystemId: options.branchSystemId,\r\n    branchName: options.branchName,\r\n    createdBy: options.createdBy,\r\n    createdAt: timestamp,\r\n    status: options.status ?? 'completed',\r\n    category: options.category,\r\n    originalDocumentId: asBusinessIdOrUndefined(options.originalDocumentId),\r\n    linkedOrderSystemId: options.linkedOrderSystemId,\r\n    linkedSalesReturnSystemId: options.linkedSalesReturnSystemId,\r\n    linkedWarrantySystemId: options.linkedWarrantySystemId,\r\n    linkedComplaintSystemId: options.linkedComplaintSystemId,\r\n    customerSystemId: options.customerSystemId,\r\n    customerName: options.customerName ?? options.recipientName,\r\n    affectsDebt: options.affectsDebt ?? true,\r\n  };\r\n\r\n  const payment = usePaymentStore.getState().add(payload);\r\n  return { document: payment };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2982, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/receipts/store.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { subscribeWithSelector } from 'zustand/middleware';\r\nimport type { Receipt } from './types';\r\nimport type { HistoryEntry } from '../../components/ActivityHistory';\r\nimport { \r\n  findNextAvailableBusinessId, \r\n  generateSystemId, \r\n  getMaxBusinessIdCounter, \r\n  getMaxSystemIdCounter,\r\n  extractCounterFromBusinessId,\r\n  type EntityType \r\n} from '@/lib/id-utils';\r\nimport { asSystemId, asBusinessId, type BusinessId, type SystemId } from '@/lib/id-types';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport { pickAccount, pickPaymentMethod, pickReceiptType, pickTargetGroup } from '@/features/finance/document-lookups';\r\nimport { useEmployeeStore } from '../employees/store';\r\nimport { getCurrentUserSystemId } from '../../contexts/auth-context';\r\n\r\n// API sync helpers\r\nasync function syncToAPI(action: 'create' | 'update' | 'delete', data: any): Promise<boolean> {\r\n  try {\r\n    const endpoint = action === 'create' ? '/api/receipts' : `/api/receipts/${data.systemId}`;\r\n    const method = action === 'create' ? 'POST' : action === 'update' ? 'PATCH' : 'DELETE';\r\n    \r\n    const response = await fetch(endpoint, {\r\n      method,\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: action !== 'delete' ? JSON.stringify(data) : undefined,\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      console.error(`[Receipts API] ${action} failed:`, await response.text());\r\n      return false;\r\n    }\r\n    return true;\r\n  } catch (error) {\r\n    console.error(`[Receipts API] ${action} error:`, error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Helper to get current user info\r\nconst getCurrentUserInfo = () => {\r\n  const currentUserSystemId = getCurrentUserSystemId?.() || 'SYSTEM';\r\n  const employee = useEmployeeStore.getState().data.find(e => e.systemId === currentUserSystemId);\r\n  return {\r\n    systemId: currentUserSystemId,\r\n    name: employee?.fullName || 'H·ªá th·ªëng',\r\n    avatar: employee?.avatarUrl,\r\n  };\r\n};\r\n\r\n// Helper to create history entry\r\nconst createHistoryEntry = (\r\n  action: HistoryEntry['action'],\r\n  description: string,\r\n  metadata?: HistoryEntry['metadata']\r\n): HistoryEntry => ({\r\n  id: crypto.randomUUID(),\r\n  action,\r\n  timestamp: new Date(),\r\n  user: getCurrentUserInfo(),\r\n  description,\r\n  metadata,\r\n});\r\n\r\nconst SYSTEM_AUTHOR = asSystemId('SYSTEM');\r\nconst getCurrentReceiptAuthor = (): SystemId => {\r\n  const userId = getCurrentUserSystemId?.();\r\n  return userId ? asSystemId(userId) : SYSTEM_AUTHOR;\r\n};\r\n\r\nexport type ReceiptInput = Omit<Receipt, 'systemId' | 'id'> & { id?: BusinessId };\r\n\r\ninterface ReceiptStore {\r\n  data: Receipt[];\r\n  businessIdCounter: number;\r\n  systemIdCounter: number;\r\n  initialized: boolean;\r\n  add: (item: ReceiptInput) => Receipt;\r\n  addMultiple: (items: ReceiptInput[]) => void;\r\n  update: (systemId: SystemId, item: Receipt) => void;\r\n  remove: (systemId: SystemId) => void;\r\n  findById: (systemId: SystemId) => Receipt | undefined;\r\n  getActive: () => Receipt[];\r\n  cancel: (systemId: SystemId, reason?: string) => void;\r\n  loadFromAPI: () => Promise<void>;\r\n}\r\n\r\nconst RECEIPT_ENTITY: EntityType = 'receipts';\r\nconst SYSTEM_ID_PREFIX = 'RECEIPT';\r\nconst BUSINESS_ID_PREFIX = 'PT';\r\nconst BUSINESS_ID_DIGITS = 6;\r\n\r\nconst normalizeReceiptStatus = (status?: Receipt['status']): Receipt['status'] =>\r\n  status === 'cancelled' ? 'cancelled' : 'completed';\r\n\r\nconst ensureReceiptMetadata = (receipt: Receipt): Receipt => {\r\n  let mutated = false;\r\n  const updates: Partial<Receipt> = {};\r\n\r\n  const targetGroup = pickTargetGroup({\r\n    systemId: receipt.payerTypeSystemId,\r\n    name: receipt.payerTypeName,\r\n  });\r\n  if (targetGroup) {\r\n    if (receipt.payerTypeSystemId !== targetGroup.systemId) {\r\n      updates.payerTypeSystemId = targetGroup.systemId;\r\n      mutated = true;\r\n    }\r\n    if (receipt.payerTypeName !== targetGroup.name) {\r\n      updates.payerTypeName = targetGroup.name;\r\n      mutated = true;\r\n    }\r\n  }\r\n\r\n  const paymentMethod = pickPaymentMethod({\r\n    systemId: receipt.paymentMethodSystemId,\r\n    name: receipt.paymentMethodName,\r\n  });\r\n  if (paymentMethod) {\r\n    if (receipt.paymentMethodSystemId !== paymentMethod.systemId) {\r\n      updates.paymentMethodSystemId = paymentMethod.systemId;\r\n      mutated = true;\r\n    }\r\n    if (receipt.paymentMethodName !== paymentMethod.name) {\r\n      updates.paymentMethodName = paymentMethod.name;\r\n      mutated = true;\r\n    }\r\n  }\r\n\r\n  const account = pickAccount({\r\n    accountSystemId: receipt.accountSystemId,\r\n    branchSystemId: receipt.branchSystemId,\r\n    paymentMethodName: paymentMethod?.name ?? receipt.paymentMethodName,\r\n  });\r\n  if (account && receipt.accountSystemId !== account.systemId) {\r\n    updates.accountSystemId = account.systemId;\r\n    mutated = true;\r\n  }\r\n\r\n  const receiptType = pickReceiptType({\r\n    systemId: receipt.paymentReceiptTypeSystemId,\r\n    name: receipt.paymentReceiptTypeName,\r\n  });\r\n  if (receiptType) {\r\n    if (receipt.paymentReceiptTypeSystemId !== receiptType.systemId) {\r\n      updates.paymentReceiptTypeSystemId = receiptType.systemId;\r\n      mutated = true;\r\n    }\r\n    if (receipt.paymentReceiptTypeName !== receiptType.name) {\r\n      updates.paymentReceiptTypeName = receiptType.name;\r\n      mutated = true;\r\n    }\r\n  }\r\n\r\n  if (!receipt.customerName && receipt.payerName) {\r\n    updates.customerName = receipt.payerName;\r\n    mutated = true;\r\n  }\r\n\r\n  if (!receipt.customerSystemId && receipt.payerSystemId) {\r\n    updates.customerSystemId = receipt.payerSystemId;\r\n    mutated = true;\r\n  }\r\n\r\n  return mutated ? { ...receipt, ...updates } : receipt;\r\n};\r\n\r\nconst backfillReceiptMetadata = (receipts: Receipt[]): Receipt[] => {\r\n  let mutated = false;\r\n  const updated = receipts.map(receipt => {\r\n    const normalized = ensureReceiptMetadata(receipt);\r\n    if (normalized !== receipt) {\r\n      mutated = true;\r\n    }\r\n    return normalized;\r\n  });\r\n  return mutated ? updated : receipts;\r\n};\r\n\r\nconst initialReceipts: Receipt[] = []; // Database is source of truth\r\n\r\nlet systemIdCounter = getMaxSystemIdCounter(initialReceipts, SYSTEM_ID_PREFIX);\r\nlet businessIdCounter = getMaxBusinessIdCounter(initialReceipts, BUSINESS_ID_PREFIX);\r\n\r\nconst getNextSystemId = (): SystemId => {\r\n  systemIdCounter += 1;\r\n  return asSystemId(generateSystemId(RECEIPT_ENTITY, systemIdCounter));\r\n};\r\n\r\nconst ensureReceiptBusinessId = (receipts: Receipt[], provided?: BusinessId | string): BusinessId => {\r\n  if (provided && `${provided}`.trim().length > 0) {\r\n    const normalized = `${provided}`.trim().toUpperCase();\r\n    const parsedCounter = extractCounterFromBusinessId(normalized, BUSINESS_ID_PREFIX);\r\n    if (parsedCounter > businessIdCounter) {\r\n      businessIdCounter = parsedCounter;\r\n    }\r\n    return asBusinessId(normalized);\r\n  }\r\n\r\n  const existingIds = receipts.map(receipt => receipt.id as string).filter(Boolean);\r\n  const { nextId, updatedCounter } = findNextAvailableBusinessId(\r\n    BUSINESS_ID_PREFIX,\r\n    existingIds,\r\n    businessIdCounter,\r\n    BUSINESS_ID_DIGITS\r\n  );\r\n  businessIdCounter = updatedCounter;\r\n  return asBusinessId(nextId);\r\n};\r\n\r\nexport const useReceiptStore = create<ReceiptStore>()(\r\n  subscribeWithSelector(\r\n    (set, get) => ({\r\n      data: initialReceipts,\r\n      businessIdCounter,\r\n      systemIdCounter,\r\n      initialized: false,\r\n      \r\n      add: (item: ReceiptInput): Receipt => {\r\n        let createdReceipt: Receipt | null = null;\r\n        set(state => {\r\n          const systemId = getNextSystemId();\r\n          const id = ensureReceiptBusinessId(state.data, item.id);\r\n          const createdBy = item.createdBy ?? getCurrentReceiptAuthor();\r\n          \r\n          const newReceipt: Receipt = { \r\n            ...item, \r\n            systemId, \r\n            id,\r\n            createdBy,\r\n            createdAt: item.createdAt || new Date().toISOString(),\r\n            status: normalizeReceiptStatus(item.status),\r\n            orderAllocations: item.orderAllocations ?? [],\r\n          };\r\n\r\n          const normalizedReceipt = ensureReceiptMetadata(newReceipt);\r\n          createdReceipt = normalizedReceipt;\r\n\r\n          return { \r\n            data: [...state.data, normalizedReceipt],\r\n            businessIdCounter,\r\n            systemIdCounter\r\n          };\r\n        });\r\n        // Sync to API\r\n        if (createdReceipt) {\r\n          syncToAPI('create', createdReceipt).catch(console.error);\r\n        }\r\n        return createdReceipt!;\r\n      },\r\n      \r\n      addMultiple: (items: ReceiptInput[]) => {\r\n        const created: Receipt[] = [];\r\n        set(state => {\r\n          items.forEach(item => {\r\n            const context = [...state.data, ...created];\r\n            const systemId = getNextSystemId();\r\n            const id = ensureReceiptBusinessId(context, item.id);\r\n            const createdBy = item.createdBy ?? getCurrentReceiptAuthor();\r\n            \r\n            const newReceipt: Receipt = { \r\n              ...item, \r\n              systemId, \r\n              id,\r\n              createdBy,\r\n              createdAt: item.createdAt || new Date().toISOString(),\r\n              status: normalizeReceiptStatus(item.status),\r\n              orderAllocations: item.orderAllocations ?? [],\r\n            };\r\n            created.push(ensureReceiptMetadata(newReceipt));\r\n          });\r\n          \r\n          return { \r\n            data: [...state.data, ...created],\r\n            businessIdCounter,\r\n            systemIdCounter\r\n          };\r\n        });\r\n        // Sync all to API\r\n        created.forEach(receipt => {\r\n          syncToAPI('create', receipt).catch(console.error);\r\n        });\r\n      },\r\n      \r\n      update: (systemId: SystemId, item: Receipt) => {\r\n        const updated = { ...item, status: normalizeReceiptStatus(item.status), updatedAt: new Date().toISOString() };\r\n        set(state => ({\r\n          data: state.data.map(r => r.systemId === systemId ? updated : r),\r\n          businessIdCounter,\r\n          systemIdCounter\r\n        }));\r\n        // Sync to API\r\n        syncToAPI('update', updated).catch(console.error);\r\n      },\r\n      \r\n      remove: (systemId: SystemId) => {\r\n        set(state => ({\r\n          data: state.data.filter(r => r.systemId !== systemId),\r\n          businessIdCounter,\r\n          systemIdCounter\r\n        }));\r\n        // Sync to API\r\n        syncToAPI('delete', { systemId }).catch(console.error);\r\n      },\r\n      \r\n      findById: (systemId: SystemId) => {\r\n        return get().data.find(r => r.systemId === systemId);\r\n      },\r\n      \r\n      getActive: () => {\r\n        return get().data.filter(r => r.status !== 'cancelled');\r\n      },\r\n      \r\n      cancel: (systemId: SystemId, reason?: string) => {\r\n        const receipt = get().findById(systemId);\r\n        if (receipt && receipt.status !== 'cancelled') {\r\n          const historyEntry = createHistoryEntry(\r\n            'cancelled',\r\n            `ƒê√£ h·ªßy phi·∫øu thu${reason ? `: ${reason}` : ''}`,\r\n            { oldValue: 'Ho√†n th√†nh', newValue: 'ƒê√£ h·ªßy', note: reason }\r\n          );\r\n          \r\n          get().update(systemId, {\r\n            ...receipt,\r\n            status: 'cancelled',\r\n            cancelledAt: new Date().toISOString(),\r\n            activityHistory: [...(receipt.activityHistory || []), historyEntry],\r\n          });\r\n        }\r\n      },\r\n      \r\n      loadFromAPI: async () => {\r\n        try {\r\n          // NOTE: Use React Query hooks for paginated data. This only loads initial batch.\r\n          const response = await fetch('/api/receipts?limit=30');\r\n          if (!response.ok) return;\r\n          const json = await response.json();\r\n          const apiData = json.data || [];\r\n          if (apiData.length > 0) {\r\n            const normalized = backfillReceiptMetadata(apiData.map((receipt: Receipt) => ({\r\n              ...receipt,\r\n              status: normalizeReceiptStatus(receipt.status),\r\n            })));\r\n            const nextSystemCounter = getMaxSystemIdCounter(normalized, SYSTEM_ID_PREFIX);\r\n            const nextBusinessCounter = getMaxBusinessIdCounter(normalized, BUSINESS_ID_PREFIX);\r\n            systemIdCounter = nextSystemCounter;\r\n            businessIdCounter = nextBusinessCounter;\r\n            set({ \r\n              data: normalized, \r\n              systemIdCounter, \r\n              businessIdCounter,\r\n              initialized: true \r\n            });\r\n          } else {\r\n            set({ initialized: true });\r\n          }\r\n        } catch (error) {\r\n          console.error('[Receipts API] loadFromAPI error:', error);\r\n        }\r\n      },\r\n    })\r\n  )\r\n);\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AAGA;AAQA;AACA,mHAAmH;AACnH;AACA;AACA;;;;;;;;AAEA,mBAAmB;AACnB,eAAe,UAAU,MAAsC,EAAE,IAAS;IACxE,IAAI;QACF,MAAM,WAAW,WAAW,WAAW,kBAAkB,CAAC,cAAc,EAAE,KAAK,QAAQ,EAAE;QACzF,MAAM,SAAS,WAAW,WAAW,SAAS,WAAW,WAAW,UAAU;QAE9E,MAAM,WAAW,MAAM,MAAM,UAAU;YACrC;YACA,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,WAAW,WAAW,KAAK,SAAS,CAAC,QAAQ;QACrD;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,QAAQ,KAAK,CAAC,CAAC,eAAe,EAAE,OAAO,QAAQ,CAAC,EAAE,MAAM,SAAS,IAAI;YACrE,OAAO;QACT;QACA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,eAAe,EAAE,OAAO,OAAO,CAAC,EAAE;QACjD,OAAO;IACT;AACF;AAEA,kCAAkC;AAClC,MAAM,qBAAqB;IACzB,MAAM,sBAAsB,yJAAsB,QAAQ;IAC1D,MAAM,WAAW,qJAAgB,CAAC,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK;IAC3E,OAAO;QACL,UAAU;QACV,MAAM,UAAU,YAAY;QAC5B,QAAQ,UAAU;IACpB;AACF;AAEA,iCAAiC;AACjC,MAAM,qBAAqB,CACzB,QACA,aACA,WACiB,CAAC;QAClB,IAAI,OAAO,UAAU;QACrB;QACA,WAAW,IAAI;QACf,MAAM;QACN;QACA;IACF,CAAC;AAED,MAAM,gBAAgB,IAAA,mIAAU,EAAC;AACjC,MAAM,0BAA0B;IAC9B,MAAM,SAAS,yJAAsB;IACrC,OAAO,SAAS,IAAA,mIAAU,EAAC,UAAU;AACvC;AAmBA,MAAM,iBAA6B;AACnC,MAAM,mBAAmB;AACzB,MAAM,qBAAqB;AAC3B,MAAM,qBAAqB;AAE3B,MAAM,yBAAyB,CAAC,SAC9B,WAAW,cAAc,cAAc;AAEzC,MAAM,wBAAwB,CAAC;IAC7B,IAAI,UAAU;IACd,MAAM,UAA4B,CAAC;IAEnC,MAAM,cAAc,IAAA,gKAAe,EAAC;QAClC,UAAU,QAAQ,iBAAiB;QACnC,MAAM,QAAQ,aAAa;IAC7B;IACA,IAAI,aAAa;QACf,IAAI,QAAQ,iBAAiB,KAAK,YAAY,QAAQ,EAAE;YACtD,QAAQ,iBAAiB,GAAG,YAAY,QAAQ;YAChD,UAAU;QACZ;QACA,IAAI,QAAQ,aAAa,KAAK,YAAY,IAAI,EAAE;YAC9C,QAAQ,aAAa,GAAG,YAAY,IAAI;YACxC,UAAU;QACZ;IACF;IAEA,MAAM,gBAAgB,IAAA,kKAAiB,EAAC;QACtC,UAAU,QAAQ,qBAAqB;QACvC,MAAM,QAAQ,iBAAiB;IACjC;IACA,IAAI,eAAe;QACjB,IAAI,QAAQ,qBAAqB,KAAK,cAAc,QAAQ,EAAE;YAC5D,QAAQ,qBAAqB,GAAG,cAAc,QAAQ;YACtD,UAAU;QACZ;QACA,IAAI,QAAQ,iBAAiB,KAAK,cAAc,IAAI,EAAE;YACpD,QAAQ,iBAAiB,GAAG,cAAc,IAAI;YAC9C,UAAU;QACZ;IACF;IAEA,MAAM,UAAU,IAAA,4JAAW,EAAC;QAC1B,iBAAiB,QAAQ,eAAe;QACxC,gBAAgB,QAAQ,cAAc;QACtC,mBAAmB,eAAe,QAAQ,QAAQ,iBAAiB;IACrE;IACA,IAAI,WAAW,QAAQ,eAAe,KAAK,QAAQ,QAAQ,EAAE;QAC3D,QAAQ,eAAe,GAAG,QAAQ,QAAQ;QAC1C,UAAU;IACZ;IAEA,MAAM,cAAc,IAAA,gKAAe,EAAC;QAClC,UAAU,QAAQ,0BAA0B;QAC5C,MAAM,QAAQ,sBAAsB;IACtC;IACA,IAAI,aAAa;QACf,IAAI,QAAQ,0BAA0B,KAAK,YAAY,QAAQ,EAAE;YAC/D,QAAQ,0BAA0B,GAAG,YAAY,QAAQ;YACzD,UAAU;QACZ;QACA,IAAI,QAAQ,sBAAsB,KAAK,YAAY,IAAI,EAAE;YACvD,QAAQ,sBAAsB,GAAG,YAAY,IAAI;YACjD,UAAU;QACZ;IACF;IAEA,IAAI,CAAC,QAAQ,YAAY,IAAI,QAAQ,SAAS,EAAE;QAC9C,QAAQ,YAAY,GAAG,QAAQ,SAAS;QACxC,UAAU;IACZ;IAEA,IAAI,CAAC,QAAQ,gBAAgB,IAAI,QAAQ,aAAa,EAAE;QACtD,QAAQ,gBAAgB,GAAG,QAAQ,aAAa;QAChD,UAAU;IACZ;IAEA,OAAO,UAAU;QAAE,GAAG,OAAO;QAAE,GAAG,OAAO;IAAC,IAAI;AAChD;AAEA,MAAM,0BAA0B,CAAC;IAC/B,IAAI,UAAU;IACd,MAAM,UAAU,SAAS,GAAG,CAAC,CAAA;QAC3B,MAAM,aAAa,sBAAsB;QACzC,IAAI,eAAe,SAAS;YAC1B,UAAU;QACZ;QACA,OAAO;IACT;IACA,OAAO,UAAU,UAAU;AAC7B;AAEA,MAAM,kBAA6B,EAAE,EAAE,8BAA8B;AAErE,IAAI,kBAAkB,IAAA,8IAAqB,EAAC,iBAAiB;AAC7D,IAAI,oBAAoB,IAAA,gJAAuB,EAAC,iBAAiB;AAEjE,MAAM,kBAAkB;IACtB,mBAAmB;IACnB,OAAO,IAAA,mIAAU,EAAC,IAAA,yIAAgB,EAAC,gBAAgB;AACrD;AAEA,MAAM,0BAA0B,CAAC,UAAqB;IACpD,IAAI,YAAY,GAAG,UAAU,CAAC,IAAI,GAAG,MAAM,GAAG,GAAG;QAC/C,MAAM,aAAa,GAAG,UAAU,CAAC,IAAI,GAAG,WAAW;QACnD,MAAM,gBAAgB,IAAA,qJAA4B,EAAC,YAAY;QAC/D,IAAI,gBAAgB,mBAAmB;YACrC,oBAAoB;QACtB;QACA,OAAO,IAAA,qIAAY,EAAC;IACtB;IAEA,MAAM,cAAc,SAAS,GAAG,CAAC,CAAA,UAAW,QAAQ,EAAE,EAAY,MAAM,CAAC;IACzE,MAAM,EAAE,MAAM,EAAE,cAAc,EAAE,GAAG,IAAA,oJAA2B,EAC5D,oBACA,aACA,mBACA;IAEF,oBAAoB;IACpB,OAAO,IAAA,qIAAY,EAAC;AACtB;AAEO,MAAM,kBAAkB,IAAA,qJAAM,IACnC,IAAA,yKAAqB,EACnB,CAAC,KAAK,MAAQ,CAAC;QACb,MAAM;QACN;QACA;QACA,aAAa;QAEb,KAAK,CAAC;YACJ,IAAI,iBAAiC;YACrC,IAAI,CAAA;gBACF,MAAM,WAAW;gBACjB,MAAM,KAAK,wBAAwB,MAAM,IAAI,EAAE,KAAK,EAAE;gBACtD,MAAM,YAAY,KAAK,SAAS,IAAI;gBAEpC,MAAM,aAAsB;oBAC1B,GAAG,IAAI;oBACP;oBACA;oBACA;oBACA,WAAW,KAAK,SAAS,IAAI,IAAI,OAAO,WAAW;oBACnD,QAAQ,uBAAuB,KAAK,MAAM;oBAC1C,kBAAkB,KAAK,gBAAgB,IAAI,EAAE;gBAC/C;gBAEA,MAAM,oBAAoB,sBAAsB;gBAChD,iBAAiB;gBAEjB,OAAO;oBACL,MAAM;2BAAI,MAAM,IAAI;wBAAE;qBAAkB;oBACxC;oBACA;gBACF;YACF;YACA,cAAc;YACd,IAAI,gBAAgB;gBAClB,UAAU,UAAU,gBAAgB,KAAK,CAAC,QAAQ,KAAK;YACzD;YACA,OAAO;QACT;QAEA,aAAa,CAAC;YACZ,MAAM,UAAqB,EAAE;YAC7B,IAAI,CAAA;gBACF,MAAM,OAAO,CAAC,CAAA;oBACZ,MAAM,UAAU;2BAAI,MAAM,IAAI;2BAAK;qBAAQ;oBAC3C,MAAM,WAAW;oBACjB,MAAM,KAAK,wBAAwB,SAAS,KAAK,EAAE;oBACnD,MAAM,YAAY,KAAK,SAAS,IAAI;oBAEpC,MAAM,aAAsB;wBAC1B,GAAG,IAAI;wBACP;wBACA;wBACA;wBACA,WAAW,KAAK,SAAS,IAAI,IAAI,OAAO,WAAW;wBACnD,QAAQ,uBAAuB,KAAK,MAAM;wBAC1C,kBAAkB,KAAK,gBAAgB,IAAI,EAAE;oBAC/C;oBACA,QAAQ,IAAI,CAAC,sBAAsB;gBACrC;gBAEA,OAAO;oBACL,MAAM;2BAAI,MAAM,IAAI;2BAAK;qBAAQ;oBACjC;oBACA;gBACF;YACF;YACA,kBAAkB;YAClB,QAAQ,OAAO,CAAC,CAAA;gBACd,UAAU,UAAU,SAAS,KAAK,CAAC,QAAQ,KAAK;YAClD;QACF;QAEA,QAAQ,CAAC,UAAoB;YAC3B,MAAM,UAAU;gBAAE,GAAG,IAAI;gBAAE,QAAQ,uBAAuB,KAAK,MAAM;gBAAG,WAAW,IAAI,OAAO,WAAW;YAAG;YAC5G,IAAI,CAAA,QAAS,CAAC;oBACZ,MAAM,MAAM,IAAI,CAAC,GAAG,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK,WAAW,UAAU;oBAC9D;oBACA;gBACF,CAAC;YACD,cAAc;YACd,UAAU,UAAU,SAAS,KAAK,CAAC,QAAQ,KAAK;QAClD;QAEA,QAAQ,CAAC;YACP,IAAI,CAAA,QAAS,CAAC;oBACZ,MAAM,MAAM,IAAI,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK;oBAC5C;oBACA;gBACF,CAAC;YACD,cAAc;YACd,UAAU,UAAU;gBAAE;YAAS,GAAG,KAAK,CAAC,QAAQ,KAAK;QACvD;QAEA,UAAU,CAAC;YACT,OAAO,MAAM,IAAI,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK;QAC7C;QAEA,WAAW;YACT,OAAO,MAAM,IAAI,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK;QAC7C;QAEA,QAAQ,CAAC,UAAoB;YAC3B,MAAM,UAAU,MAAM,QAAQ,CAAC;YAC/B,IAAI,WAAW,QAAQ,MAAM,KAAK,aAAa;gBAC7C,MAAM,eAAe,mBACnB,aACA,CAAC,gBAAgB,EAAE,SAAS,CAAC,EAAE,EAAE,QAAQ,GAAG,IAAI,EAChD;oBAAE,UAAU;oBAAc,UAAU;oBAAU,MAAM;gBAAO;gBAG7D,MAAM,MAAM,CAAC,UAAU;oBACrB,GAAG,OAAO;oBACV,QAAQ;oBACR,aAAa,IAAI,OAAO,WAAW;oBACnC,iBAAiB;2BAAK,QAAQ,eAAe,IAAI,EAAE;wBAAG;qBAAa;gBACrE;YACF;QACF;QAEA,aAAa;YACX,IAAI;gBACF,iFAAiF;gBACjF,MAAM,WAAW,MAAM,MAAM;gBAC7B,IAAI,CAAC,SAAS,EAAE,EAAE;gBAClB,MAAM,OAAO,MAAM,SAAS,IAAI;gBAChC,MAAM,UAAU,KAAK,IAAI,IAAI,EAAE;gBAC/B,IAAI,QAAQ,MAAM,GAAG,GAAG;oBACtB,MAAM,aAAa,wBAAwB,QAAQ,GAAG,CAAC,CAAC,UAAqB,CAAC;4BAC5E,GAAG,OAAO;4BACV,QAAQ,uBAAuB,QAAQ,MAAM;wBAC/C,CAAC;oBACD,MAAM,oBAAoB,IAAA,8IAAqB,EAAC,YAAY;oBAC5D,MAAM,sBAAsB,IAAA,gJAAuB,EAAC,YAAY;oBAChE,kBAAkB;oBAClB,oBAAoB;oBACpB,IAAI;wBACF,MAAM;wBACN;wBACA;wBACA,aAAa;oBACf;gBACF,OAAO;oBACL,IAAI;wBAAE,aAAa;oBAAK;gBAC1B;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,qCAAqC;YACrD;QACF;IACF,CAAC"}},
    {"offset": {"line": 3313, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/receipts/api/receipts-api.ts"],"sourcesContent":["/**\r\n * Receipts (Phi·∫øu Thu) API functions\r\n * \r\n * ‚ö†Ô∏è Direct import: import { fetchReceipts } from '@/features/receipts/api/receipts-api'\r\n */\r\n\r\nimport type { SystemId } from '@/lib/id-types';\r\nimport type { Receipt, ReceiptStatus, ReceiptCategory } from '../types';\r\n\r\nconst BASE_URL = '/api/receipts';\r\n\r\nexport interface ReceiptsParams {\r\n  page?: number;\r\n  limit?: number;\r\n  search?: string;\r\n  status?: ReceiptStatus;\r\n  category?: ReceiptCategory;\r\n  payerTypeSystemId?: string;\r\n  payerSystemId?: string;\r\n  branchId?: string;\r\n  accountId?: string;\r\n  startDate?: string;\r\n  endDate?: string;\r\n  sortBy?: string;\r\n  sortOrder?: 'asc' | 'desc';\r\n}\r\n\r\nexport interface ReceiptsResponse {\r\n  data: Receipt[];\r\n  total: number;\r\n  page: number;\r\n  pageSize: number;\r\n}\r\n\r\nexport async function fetchReceipts(params: ReceiptsParams = {}): Promise<ReceiptsResponse> {\r\n  const searchParams = new URLSearchParams();\r\n  \r\n  if (params.page) searchParams.set('page', String(params.page));\r\n  if (params.limit) searchParams.set('limit', String(params.limit));\r\n  if (params.search) searchParams.set('search', params.search);\r\n  if (params.status) searchParams.set('status', params.status);\r\n  if (params.category) searchParams.set('category', params.category);\r\n  if (params.payerTypeSystemId) searchParams.set('payerTypeSystemId', params.payerTypeSystemId);\r\n  if (params.payerSystemId) searchParams.set('payerSystemId', params.payerSystemId);\r\n  if (params.branchId) searchParams.set('branchId', params.branchId);\r\n  if (params.accountId) searchParams.set('accountId', params.accountId);\r\n  if (params.startDate) searchParams.set('startDate', params.startDate);\r\n  if (params.endDate) searchParams.set('endDate', params.endDate);\r\n  if (params.sortBy) searchParams.set('sortBy', params.sortBy);\r\n  if (params.sortOrder) searchParams.set('sortOrder', params.sortOrder);\r\n  \r\n  const url = searchParams.toString() ? `${BASE_URL}?${searchParams}` : BASE_URL;\r\n  const response = await fetch(url);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch receipts: ${response.statusText}`);\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function fetchReceipt(systemId: SystemId): Promise<Receipt> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch receipt: ${response.statusText}`);\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function createReceipt(data: Omit<Receipt, 'systemId' | 'id' | 'createdAt' | 'updatedAt'>): Promise<Receipt> {\r\n  const response = await fetch(BASE_URL, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to create receipt');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function updateReceipt(systemId: SystemId, data: Partial<Receipt>): Promise<Receipt> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`, {\r\n    method: 'PUT',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to update receipt');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function deleteReceipt(systemId: SystemId): Promise<void> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`, {\r\n    method: 'DELETE',\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to delete receipt: ${response.statusText}`);\r\n  }\r\n}\r\n\r\nexport async function cancelReceipt(systemId: SystemId, reason?: string): Promise<Receipt> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}/cancel`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ reason }),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to cancel receipt');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function fetchReceiptStats(): Promise<{\r\n  total: number;\r\n  completed: number;\r\n  cancelled: number;\r\n  totalAmount: number;\r\n}> {\r\n  const response = await fetch(`${BASE_URL}/stats`);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch receipt stats: ${response.statusText}`);\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;;;;;;;;;;;;;AAKD,MAAM,WAAW;AAyBV,eAAe,cAAc,SAAyB,CAAC,CAAC;IAC7D,MAAM,eAAe,IAAI;IAEzB,IAAI,OAAO,IAAI,EAAE,aAAa,GAAG,CAAC,QAAQ,OAAO,OAAO,IAAI;IAC5D,IAAI,OAAO,KAAK,EAAE,aAAa,GAAG,CAAC,SAAS,OAAO,OAAO,KAAK;IAC/D,IAAI,OAAO,MAAM,EAAE,aAAa,GAAG,CAAC,UAAU,OAAO,MAAM;IAC3D,IAAI,OAAO,MAAM,EAAE,aAAa,GAAG,CAAC,UAAU,OAAO,MAAM;IAC3D,IAAI,OAAO,QAAQ,EAAE,aAAa,GAAG,CAAC,YAAY,OAAO,QAAQ;IACjE,IAAI,OAAO,iBAAiB,EAAE,aAAa,GAAG,CAAC,qBAAqB,OAAO,iBAAiB;IAC5F,IAAI,OAAO,aAAa,EAAE,aAAa,GAAG,CAAC,iBAAiB,OAAO,aAAa;IAChF,IAAI,OAAO,QAAQ,EAAE,aAAa,GAAG,CAAC,YAAY,OAAO,QAAQ;IACjE,IAAI,OAAO,SAAS,EAAE,aAAa,GAAG,CAAC,aAAa,OAAO,SAAS;IACpE,IAAI,OAAO,SAAS,EAAE,aAAa,GAAG,CAAC,aAAa,OAAO,SAAS;IACpE,IAAI,OAAO,OAAO,EAAE,aAAa,GAAG,CAAC,WAAW,OAAO,OAAO;IAC9D,IAAI,OAAO,MAAM,EAAE,aAAa,GAAG,CAAC,UAAU,OAAO,MAAM;IAC3D,IAAI,OAAO,SAAS,EAAE,aAAa,GAAG,CAAC,aAAa,OAAO,SAAS;IAEpE,MAAM,MAAM,aAAa,QAAQ,KAAK,GAAG,SAAS,CAAC,EAAE,cAAc,GAAG;IACtE,MAAM,WAAW,MAAM,MAAM;IAE7B,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM,CAAC,0BAA0B,EAAE,SAAS,UAAU,EAAE;IACpE;IAEA,OAAO,SAAS,IAAI;AACtB;AAEO,eAAe,aAAa,QAAkB;IACnD,MAAM,WAAW,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,UAAU;IAEtD,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM,CAAC,yBAAyB,EAAE,SAAS,UAAU,EAAE;IACnE;IAEA,OAAO,SAAS,IAAI;AACtB;AAEO,eAAe,cAAc,IAAkE;IACpG,MAAM,WAAW,MAAM,MAAM,UAAU;QACrC,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,QAAQ,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QACnD,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI;IACnC;IAEA,OAAO,SAAS,IAAI;AACtB;AAEO,eAAe,cAAc,QAAkB,EAAE,IAAsB;IAC5E,MAAM,WAAW,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,UAAU,EAAE;QACtD,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,QAAQ,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QACnD,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI;IACnC;IAEA,OAAO,SAAS,IAAI;AACtB;AAEO,eAAe,cAAc,QAAkB;IACpD,MAAM,WAAW,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,UAAU,EAAE;QACtD,QAAQ;IACV;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM,CAAC,0BAA0B,EAAE,SAAS,UAAU,EAAE;IACpE;AACF;AAEO,eAAe,cAAc,QAAkB,EAAE,MAAe;IACrE,MAAM,WAAW,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,SAAS,OAAO,CAAC,EAAE;QAC7D,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;YAAE;QAAO;IAChC;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,QAAQ,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QACnD,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI;IACnC;IAEA,OAAO,SAAS,IAAI;AACtB;AAEO,eAAe;IAMpB,MAAM,WAAW,MAAM,MAAM,GAAG,SAAS,MAAM,CAAC;IAEhD,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM,CAAC,+BAA+B,EAAE,SAAS,UAAU,EAAE;IACzE;IAEA,OAAO,SAAS,IAAI;AACtB"}},
    {"offset": {"line": 3429, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/receipts/hooks/use-receipts.ts"],"sourcesContent":["/**\r\n * useReceipts - React Query hooks (Phi·∫øu Thu)\r\n * \r\n * ‚ö†Ô∏è Direct import: import { useReceipts } from '@/features/receipts/hooks/use-receipts'\r\n */\r\n\r\nimport { useQuery, useMutation, useQueryClient, keepPreviousData } from '@tanstack/react-query';\r\nimport { asSystemId } from '@/lib/id-types';\r\nimport {\r\n  fetchReceipts,\r\n  fetchReceipt,\r\n  createReceipt,\r\n  updateReceipt,\r\n  deleteReceipt,\r\n  cancelReceipt,\r\n  fetchReceiptStats,\r\n  type ReceiptsParams,\r\n} from '../api/receipts-api';\r\nimport type { Receipt } from '../types';\r\n\r\nexport const receiptKeys = {\r\n  all: ['receipts'] as const,\r\n  lists: () => [...receiptKeys.all, 'list'] as const,\r\n  list: (params: ReceiptsParams) => [...receiptKeys.lists(), params] as const,\r\n  details: () => [...receiptKeys.all, 'detail'] as const,\r\n  detail: (id: string) => [...receiptKeys.details(), id] as const,\r\n  stats: () => [...receiptKeys.all, 'stats'] as const,\r\n};\r\n\r\nexport function useReceipts(params: ReceiptsParams = {}) {\r\n  return useQuery({\r\n    queryKey: receiptKeys.list(params),\r\n    queryFn: () => fetchReceipts(params),\r\n    staleTime: 30_000,\r\n    gcTime: 5 * 60 * 1000,\r\n    placeholderData: keepPreviousData,\r\n  });\r\n}\r\n\r\nexport function useReceipt(id: string | null | undefined) {\r\n  return useQuery({\r\n    queryKey: receiptKeys.detail(id!),\r\n    queryFn: () => fetchReceipt(asSystemId(id!)),\r\n    enabled: !!id,\r\n    staleTime: 60_000,\r\n  });\r\n}\r\n\r\nexport function useReceiptStats() {\r\n  return useQuery({\r\n    queryKey: receiptKeys.stats(),\r\n    queryFn: fetchReceiptStats,\r\n    staleTime: 60_000,\r\n  });\r\n}\r\n\r\ninterface UseReceiptMutationsOptions {\r\n  onCreateSuccess?: (receipt: Receipt) => void;\r\n  onUpdateSuccess?: (receipt: Receipt) => void;\r\n  onDeleteSuccess?: () => void;\r\n  onCancelSuccess?: (receipt: Receipt) => void;\r\n  onError?: (error: Error) => void;\r\n}\r\n\r\nexport function useReceiptMutations(options: UseReceiptMutationsOptions = {}) {\r\n  const queryClient = useQueryClient();\r\n  \r\n  const create = useMutation({\r\n    mutationFn: createReceipt,\r\n    onSuccess: (data) => {\r\n      queryClient.invalidateQueries({ queryKey: receiptKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: receiptKeys.stats() });\r\n      options.onCreateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const update = useMutation({\r\n    mutationFn: ({ systemId, data }: { systemId: string; data: Partial<Receipt> }) => \r\n      updateReceipt(asSystemId(systemId), data),\r\n    onSuccess: (data, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: receiptKeys.detail(variables.systemId) });\r\n      queryClient.invalidateQueries({ queryKey: receiptKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: receiptKeys.stats() });\r\n      options.onUpdateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const remove = useMutation({\r\n    mutationFn: (systemId: string) => deleteReceipt(asSystemId(systemId)),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: receiptKeys.all });\r\n      options.onDeleteSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const cancel = useMutation({\r\n    mutationFn: ({ systemId, reason }: { systemId: string; reason?: string }) => \r\n      cancelReceipt(asSystemId(systemId), reason),\r\n    onSuccess: (data, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: receiptKeys.detail(variables.systemId) });\r\n      queryClient.invalidateQueries({ queryKey: receiptKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: receiptKeys.stats() });\r\n      options.onCancelSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  return { create, update, remove, cancel };\r\n}\r\n\r\nexport function useReceiptsByPayer(payerSystemId: string | null | undefined) {\r\n  return useReceipts({\r\n    payerSystemId: payerSystemId || undefined,\r\n    limit: 50,\r\n  });\r\n}\r\n\r\nexport function useReceiptsByBranch(branchId: string | null | undefined) {\r\n  return useReceipts({\r\n    branchId: branchId || undefined,\r\n    limit: 100,\r\n  });\r\n}\r\n\r\nexport function useReceiptsByDateRange(startDate: string, endDate: string) {\r\n  return useReceipts({ startDate, endDate });\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3663, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/receipts/hooks/use-all-receipts.ts"],"sourcesContent":["/**\r\n * useAllReceipts - Convenience hook for components needing all receipts as flat array\r\n */\r\n\r\nimport { useReceipts } from './use-receipts';\r\n\r\nexport function useAllReceipts() {\r\n  const query = useReceipts({});\r\n  \r\n  return {\r\n    data: query.data?.data || [],\r\n    isLoading: query.isLoading,\r\n    isError: query.isError,\r\n    error: query.error,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;CAEC,GAED;;;AAEO,SAAS;;IACd,MAAM,QAAQ,IAAA,kKAAW,EAAC,CAAC;IAE3B,OAAO;QACL,MAAM,MAAM,IAAI,EAAE,QAAQ,EAAE;QAC5B,WAAW,MAAM,SAAS;QAC1B,SAAS,MAAM,OAAO;QACtB,OAAO,MAAM,KAAK;IACpB;AACF;GATgB;;QACA,kKAAW"}},
    {"offset": {"line": 3694, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/payments/store.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport type { Payment } from './types';\r\nimport type { HistoryEntry } from '../../components/ActivityHistory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport {\r\n  extractCounterFromBusinessId,\r\n  findNextAvailableBusinessId,\r\n  generateSystemId,\r\n  getMaxBusinessIdCounter,\r\n  getMaxSystemIdCounter,\r\n  type EntityType,\r\n} from '../../lib/id-utils';\r\nimport { asBusinessId, asSystemId, type BusinessId, type SystemId } from '../../lib/id-types';\r\nimport { pickAccount, pickPaymentMethod, pickPaymentType, pickTargetGroup } from '@/features/finance/document-lookups';\r\nimport { useEmployeeStore } from '../employees/store';\r\nimport { getCurrentUserSystemId } from '../../contexts/auth-context';\r\n\r\n// API sync helpers\r\nasync function syncToAPI(action: 'create' | 'update' | 'delete', data: any): Promise<boolean> {\r\n  try {\r\n    const endpoint = action === 'create' ? '/api/payments' : `/api/payments/${data.systemId}`;\r\n    const method = action === 'create' ? 'POST' : action === 'update' ? 'PATCH' : 'DELETE';\r\n    \r\n    const response = await fetch(endpoint, {\r\n      method,\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: action !== 'delete' ? JSON.stringify(data) : undefined,\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      console.error(`[Payments API] ${action} failed:`, await response.text());\r\n      return false;\r\n    }\r\n    return true;\r\n  } catch (error) {\r\n    console.error(`[Payments API] ${action} error:`, error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Helper to get current user info\r\nconst getCurrentUserInfo = () => {\r\n  const currentUserSystemId = getCurrentUserSystemId?.() || 'SYSTEM';\r\n  const employee = useEmployeeStore.getState().data.find(e => e.systemId === currentUserSystemId);\r\n  return {\r\n    systemId: currentUserSystemId,\r\n    name: employee?.fullName || 'H·ªá th·ªëng',\r\n    avatar: employee?.avatarUrl,\r\n  };\r\n};\r\n\r\n// Helper to create history entry\r\nconst createHistoryEntry = (\r\n  action: HistoryEntry['action'],\r\n  description: string,\r\n  metadata?: HistoryEntry['metadata']\r\n): HistoryEntry => ({\r\n  id: crypto.randomUUID(),\r\n  action,\r\n  timestamp: new Date(),\r\n  user: getCurrentUserInfo(),\r\n  description,\r\n  metadata,\r\n});\r\n\r\nexport type PaymentInput = Omit<Payment, 'systemId' | 'id'> & { id?: BusinessId | string };\r\n\r\ninterface PaymentStore {\r\n  data: Payment[];\r\n  businessIdCounter: number;\r\n  systemIdCounter: number;\r\n  initialized: boolean;\r\n  add: (item: PaymentInput) => Payment;\r\n  addMultiple: (items: PaymentInput[]) => void;\r\n  update: (systemId: SystemId, item: Payment) => void;\r\n  remove: (systemId: SystemId) => void;\r\n  findById: (systemId: SystemId) => Payment | undefined;\r\n  getActive: () => Payment[];\r\n  cancel: (systemId: SystemId, reason?: string) => void;\r\n  loadFromAPI: () => Promise<void>;\r\n}\r\n\r\nconst PAYMENT_ENTITY: EntityType = 'payments';\r\nconst SYSTEM_ID_PREFIX = 'PAYMENT';\r\nconst BUSINESS_ID_PREFIX = 'PC';\r\nconst BUSINESS_ID_DIGITS = 6;\r\nconst PURCHASE_ORDER_SYSTEM_PREFIX = 'PURCHASE';\r\nconst PURCHASE_ORDER_BUSINESS_PREFIX = 'PO';\r\n\r\nconst normalizePaymentStatus = (status?: Payment['status']): Payment['status'] =>\r\n  status === 'cancelled' ? 'cancelled' : 'completed';\r\n\r\nconst normalizePayment = (payment: Payment): Payment => ({\r\n  ...payment,\r\n  status: normalizePaymentStatus(payment.status),\r\n});\r\n\r\nconst ensurePaymentMetadata = (payment: Payment): Payment => {\r\n  let mutated = false;\r\n  const updates: Partial<Payment> = {};\r\n\r\n  const targetGroup = pickTargetGroup({\r\n    systemId: payment.recipientTypeSystemId,\r\n    name: payment.recipientTypeName,\r\n  });\r\n  if (targetGroup) {\r\n    if (payment.recipientTypeSystemId !== targetGroup.systemId) {\r\n      updates.recipientTypeSystemId = targetGroup.systemId;\r\n      mutated = true;\r\n    }\r\n    if (payment.recipientTypeName !== targetGroup.name) {\r\n      updates.recipientTypeName = targetGroup.name;\r\n      mutated = true;\r\n    }\r\n  }\r\n\r\n  const paymentMethod = pickPaymentMethod({\r\n    systemId: payment.paymentMethodSystemId,\r\n    name: payment.paymentMethodName,\r\n  });\r\n  if (paymentMethod) {\r\n    if (payment.paymentMethodSystemId !== paymentMethod.systemId) {\r\n      updates.paymentMethodSystemId = paymentMethod.systemId;\r\n      mutated = true;\r\n    }\r\n    if (payment.paymentMethodName !== paymentMethod.name) {\r\n      updates.paymentMethodName = paymentMethod.name;\r\n      mutated = true;\r\n    }\r\n  }\r\n\r\n  const account = pickAccount({\r\n    accountSystemId: payment.accountSystemId,\r\n    branchSystemId: payment.branchSystemId,\r\n    paymentMethodName: paymentMethod?.name ?? payment.paymentMethodName,\r\n  });\r\n  if (account && payment.accountSystemId !== account.systemId) {\r\n    updates.accountSystemId = account.systemId;\r\n    mutated = true;\r\n  }\r\n\r\n  const paymentType = pickPaymentType({\r\n    systemId: payment.paymentReceiptTypeSystemId,\r\n    name: payment.paymentReceiptTypeName,\r\n  });\r\n  if (paymentType) {\r\n    if (payment.paymentReceiptTypeSystemId !== paymentType.systemId) {\r\n      updates.paymentReceiptTypeSystemId = paymentType.systemId;\r\n      mutated = true;\r\n    }\r\n    if (payment.paymentReceiptTypeName !== paymentType.name) {\r\n      updates.paymentReceiptTypeName = paymentType.name;\r\n      mutated = true;\r\n    }\r\n  }\r\n\r\n  const normalizedGroupName = targetGroup?.name?.trim().toLowerCase();\r\n  if (normalizedGroupName === 'kh√°ch h√†ng') {\r\n    if (!payment.customerName && payment.recipientName) {\r\n      updates.customerName = payment.recipientName;\r\n      mutated = true;\r\n    }\r\n    if (!payment.customerSystemId && payment.recipientSystemId) {\r\n      updates.customerSystemId = payment.recipientSystemId;\r\n      mutated = true;\r\n    }\r\n  }\r\n\r\n  return mutated ? { ...payment, ...updates } : payment;\r\n};\r\n\r\nconst backfillPaymentMetadata = (payments: Payment[]): Payment[] => {\r\n  let mutated = false;\r\n  const updated = payments.map(payment => {\r\n    const normalized = ensurePaymentMetadata(payment);\r\n    if (normalized !== payment) {\r\n      mutated = true;\r\n    }\r\n    return normalized;\r\n  });\r\n  return mutated ? updated : payments;\r\n};\r\n\r\nconst initialPayments: Payment[] = []; // Database is source of truth\r\n\r\nlet systemIdCounter = getMaxSystemIdCounter(initialPayments, SYSTEM_ID_PREFIX);\r\nlet businessIdCounter = getMaxBusinessIdCounter(initialPayments, BUSINESS_ID_PREFIX);\r\n\r\nconst getNextSystemId = (): SystemId => {\r\n  systemIdCounter += 1;\r\n  return asSystemId(generateSystemId(PAYMENT_ENTITY, systemIdCounter));\r\n};\r\n\r\nconst ensurePaymentBusinessId = (payments: Payment[], provided?: BusinessId | string): BusinessId => {\r\n  if (provided && `${provided}`.trim().length > 0) {\r\n    const normalized = `${provided}`.trim().toUpperCase();\r\n    const parsedCounter = extractCounterFromBusinessId(normalized, BUSINESS_ID_PREFIX);\r\n    if (parsedCounter > businessIdCounter) {\r\n      businessIdCounter = parsedCounter;\r\n    }\r\n    return asBusinessId(normalized);\r\n  }\r\n\r\n  const existingIds = payments.map(payment => payment.id as string).filter(Boolean);\r\n  const { nextId, updatedCounter } = findNextAvailableBusinessId(\r\n    BUSINESS_ID_PREFIX,\r\n    existingIds,\r\n    businessIdCounter,\r\n    BUSINESS_ID_DIGITS\r\n  );\r\n  businessIdCounter = updatedCounter;\r\n  return asBusinessId(nextId);\r\n};\r\n\r\nconst reconcileLinkedDocuments = (payment: Payment): Payment => {\r\n  if (!payment.originalDocumentId) {\r\n    return payment;\r\n  }\r\n\r\n  const normalizedDocId = payment.originalDocumentId.toUpperCase();\r\n  const nextPayment = { ...payment };\r\n\r\n  if (!nextPayment.purchaseOrderSystemId && normalizedDocId.startsWith(PURCHASE_ORDER_SYSTEM_PREFIX)) {\r\n    nextPayment.purchaseOrderSystemId = asSystemId(payment.originalDocumentId);\r\n  }\r\n\r\n  if (!nextPayment.purchaseOrderId && normalizedDocId.startsWith(PURCHASE_ORDER_BUSINESS_PREFIX)) {\r\n    nextPayment.purchaseOrderId = asBusinessId(payment.originalDocumentId);\r\n  }\r\n\r\n  return nextPayment;\r\n};\r\n\r\nconst buildPayment = (input: PaymentInput, existingPayments: Payment[]): Payment => {\r\n  const systemId = getNextSystemId();\r\n  const id = ensurePaymentBusinessId(existingPayments, input.id);\r\n  const basePayment: Payment = {\r\n    ...input,\r\n    systemId,\r\n    id,\r\n    createdAt: input.createdAt || new Date().toISOString(),\r\n    status: normalizePaymentStatus(input.status),\r\n  };\r\n\r\n  return reconcileLinkedDocuments(basePayment);\r\n};\r\n\r\nexport const usePaymentStore = create<PaymentStore>()(\r\n  (set, get) => ({\r\n      data: initialPayments,\r\n      businessIdCounter,\r\n      systemIdCounter,\r\n      initialized: false,\r\n      \r\n      add: (item) => {\r\n        let createdPayment: Payment | null = null;\r\n        set(state => {\r\n          const newPayment = buildPayment(item, state.data);\r\n          createdPayment = newPayment;\r\n          return {\r\n            data: [...state.data, newPayment],\r\n            businessIdCounter,\r\n            systemIdCounter,\r\n          };\r\n        });\r\n        // Sync to API\r\n        if (createdPayment) {\r\n          syncToAPI('create', createdPayment).catch(console.error);\r\n        }\r\n        return createdPayment!;\r\n      },\r\n      \r\n      addMultiple: (items) => {\r\n        const created: Payment[] = [];\r\n        set(state => {\r\n          items.forEach(item => {\r\n            const context = [...state.data, ...created];\r\n            const payment = buildPayment(item, context);\r\n            created.push(payment);\r\n          });\r\n\r\n          return {\r\n            data: [...state.data, ...created],\r\n            businessIdCounter,\r\n            systemIdCounter,\r\n          };\r\n        });\r\n        // Sync all to API\r\n        created.forEach(payment => {\r\n          syncToAPI('create', payment).catch(console.error);\r\n        });\r\n      },\r\n      \r\n      update: (systemId, item) => {\r\n        const updated = reconcileLinkedDocuments({\r\n          ...item,\r\n          systemId,\r\n          status: normalizePaymentStatus(item.status),\r\n          updatedAt: new Date().toISOString(),\r\n        });\r\n        set(state => ({\r\n          data: state.data.map(payment =>\r\n            payment.systemId === systemId ? updated : payment\r\n          ),\r\n          businessIdCounter,\r\n          systemIdCounter,\r\n        }));\r\n        // Sync to API\r\n        syncToAPI('update', updated).catch(console.error);\r\n      },\r\n      \r\n      remove: (systemId) => {\r\n        set(state => ({\r\n          data: state.data.filter(payment => payment.systemId !== systemId),\r\n          businessIdCounter,\r\n          systemIdCounter,\r\n        }));\r\n        // Sync to API\r\n        syncToAPI('delete', { systemId }).catch(console.error);\r\n      },\r\n      \r\n      findById: (systemId) => {\r\n        return get().data.find(payment => payment.systemId === systemId);\r\n      },\r\n      \r\n      getActive: () => {\r\n        return get().data.filter(payment => payment.status !== 'cancelled');\r\n      },\r\n      \r\n      cancel: (systemId: SystemId, reason?: string) => {\r\n        const payment = get().findById(systemId);\r\n        if (payment && payment.status !== 'cancelled') {\r\n          const historyEntry = createHistoryEntry(\r\n            'cancelled',\r\n            `ƒê√£ h·ªßy phi·∫øu chi${reason ? `: ${reason}` : ''}`,\r\n            { oldValue: 'Ho√†n th√†nh', newValue: 'ƒê√£ h·ªßy', note: reason }\r\n          );\r\n          \r\n          get().update(systemId, {\r\n            ...payment,\r\n            status: 'cancelled',\r\n            cancelledAt: new Date().toISOString(),\r\n            activityHistory: [...(payment.activityHistory || []), historyEntry],\r\n          });\r\n        }\r\n      },\r\n      \r\n      loadFromAPI: async () => {\r\n        try {\r\n          // NOTE: Use React Query hooks for paginated data. This only loads initial batch.\r\n          const response = await fetch('/api/payments?limit=30');\r\n          if (!response.ok) return;\r\n          const json = await response.json();\r\n          const apiData = json.data || [];\r\n          if (apiData.length > 0) {\r\n            const normalized = backfillPaymentMetadata(apiData.map(normalizePayment));\r\n            const nextSystemCounter = getMaxSystemIdCounter(normalized, SYSTEM_ID_PREFIX);\r\n            const nextBusinessCounter = getMaxBusinessIdCounter(normalized, BUSINESS_ID_PREFIX);\r\n            systemIdCounter = nextSystemCounter;\r\n            businessIdCounter = nextBusinessCounter;\r\n            set({ \r\n              data: normalized, \r\n              systemIdCounter, \r\n              businessIdCounter,\r\n              initialized: true \r\n            });\r\n          } else {\r\n            set({ initialized: true });\r\n          }\r\n        } catch (error) {\r\n          console.error('[Payments API] loadFromAPI error:', error);\r\n        }\r\n      },\r\n    })\r\n);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4030, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/payments/api/payments-api.ts"],"sourcesContent":["/**\r\n * Payments (Phi·∫øu Chi) API functions\r\n * \r\n * ‚ö†Ô∏è Direct import: import { fetchPayments } from '@/features/payments/api/payments-api'\r\n */\r\n\r\nimport type { SystemId } from '@/lib/id-types';\r\nimport type { Payment, PaymentStatus, PaymentCategory } from '../types';\r\n\r\nconst BASE_URL = '/api/payments';\r\n\r\nexport interface PaymentsParams {\r\n  page?: number;\r\n  limit?: number;\r\n  search?: string;\r\n  status?: PaymentStatus;\r\n  category?: PaymentCategory;\r\n  recipientTypeSystemId?: string;\r\n  recipientSystemId?: string;\r\n  branchId?: string;\r\n  accountId?: string;\r\n  startDate?: string;\r\n  endDate?: string;\r\n  sortBy?: string;\r\n  sortOrder?: 'asc' | 'desc';\r\n}\r\n\r\nexport interface PaymentsResponse {\r\n  data: Payment[];\r\n  total: number;\r\n  page: number;\r\n  pageSize: number;\r\n}\r\n\r\nexport async function fetchPayments(params: PaymentsParams = {}): Promise<PaymentsResponse> {\r\n  const searchParams = new URLSearchParams();\r\n  \r\n  if (params.page) searchParams.set('page', String(params.page));\r\n  if (params.limit) searchParams.set('limit', String(params.limit));\r\n  if (params.search) searchParams.set('search', params.search);\r\n  if (params.status) searchParams.set('status', params.status);\r\n  if (params.category) searchParams.set('category', params.category);\r\n  if (params.recipientTypeSystemId) searchParams.set('recipientTypeSystemId', params.recipientTypeSystemId);\r\n  if (params.recipientSystemId) searchParams.set('recipientSystemId', params.recipientSystemId);\r\n  if (params.branchId) searchParams.set('branchId', params.branchId);\r\n  if (params.accountId) searchParams.set('accountId', params.accountId);\r\n  if (params.startDate) searchParams.set('startDate', params.startDate);\r\n  if (params.endDate) searchParams.set('endDate', params.endDate);\r\n  if (params.sortBy) searchParams.set('sortBy', params.sortBy);\r\n  if (params.sortOrder) searchParams.set('sortOrder', params.sortOrder);\r\n  \r\n  const url = searchParams.toString() ? `${BASE_URL}?${searchParams}` : BASE_URL;\r\n  const response = await fetch(url);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch payments: ${response.statusText}`);\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function fetchPayment(systemId: SystemId): Promise<Payment> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch payment: ${response.statusText}`);\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function createPayment(data: Omit<Payment, 'systemId' | 'id' | 'createdAt' | 'updatedAt'>): Promise<Payment> {\r\n  const response = await fetch(BASE_URL, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to create payment');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function updatePayment(systemId: SystemId, data: Partial<Payment>): Promise<Payment> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`, {\r\n    method: 'PUT',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to update payment');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function deletePayment(systemId: SystemId): Promise<void> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`, {\r\n    method: 'DELETE',\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to delete payment: ${response.statusText}`);\r\n  }\r\n}\r\n\r\nexport async function cancelPayment(systemId: SystemId, reason?: string): Promise<Payment> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}/cancel`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ reason }),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to cancel payment');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function fetchPaymentStats(): Promise<{\r\n  total: number;\r\n  completed: number;\r\n  cancelled: number;\r\n  totalAmount: number;\r\n}> {\r\n  const response = await fetch(`${BASE_URL}/stats`);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch payment stats: ${response.statusText}`);\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4146, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/payments/hooks/use-payments.ts"],"sourcesContent":["/**\r\n * usePayments - React Query hooks (Phi·∫øu Chi)\r\n * \r\n * ‚ö†Ô∏è Direct import: import { usePayments } from '@/features/payments/hooks/use-payments'\r\n */\r\n\r\nimport { useQuery, useMutation, useQueryClient, keepPreviousData } from '@tanstack/react-query';\r\nimport {\r\n  fetchPayments,\r\n  fetchPayment,\r\n  createPayment,\r\n  updatePayment,\r\n  deletePayment,\r\n  cancelPayment,\r\n  fetchPaymentStats,\r\n  type PaymentsParams,\r\n} from '../api/payments-api';\r\nimport type { Payment } from '../types';\r\nimport { asSystemId } from '@/lib/id-types';\r\n\r\nexport const paymentKeys = {\r\n  all: ['payments'] as const,\r\n  lists: () => [...paymentKeys.all, 'list'] as const,\r\n  list: (params: PaymentsParams) => [...paymentKeys.lists(), params] as const,\r\n  details: () => [...paymentKeys.all, 'detail'] as const,\r\n  detail: (id: string) => [...paymentKeys.details(), id] as const,\r\n  stats: () => [...paymentKeys.all, 'stats'] as const,\r\n};\r\n\r\nexport function usePayments(params: PaymentsParams = {}) {\r\n  return useQuery({\r\n    queryKey: paymentKeys.list(params),\r\n    queryFn: () => fetchPayments(params),\r\n    staleTime: 30_000,\r\n    gcTime: 5 * 60 * 1000,\r\n    placeholderData: keepPreviousData,\r\n  });\r\n}\r\n\r\nexport function usePayment(id: string | null | undefined) {\r\n  return useQuery({\r\n    queryKey: paymentKeys.detail(id!),\r\n    queryFn: () => fetchPayment(asSystemId(id!)),\r\n    enabled: !!id,\r\n    staleTime: 60_000,\r\n  });\r\n}\r\n\r\nexport function usePaymentStats() {\r\n  return useQuery({\r\n    queryKey: paymentKeys.stats(),\r\n    queryFn: fetchPaymentStats,\r\n    staleTime: 60_000,\r\n  });\r\n}\r\n\r\ninterface UsePaymentMutationsOptions {\r\n  onCreateSuccess?: (payment: Payment) => void;\r\n  onUpdateSuccess?: (payment: Payment) => void;\r\n  onDeleteSuccess?: () => void;\r\n  onCancelSuccess?: (payment: Payment) => void;\r\n  onError?: (error: Error) => void;\r\n}\r\n\r\nexport function usePaymentMutations(options: UsePaymentMutationsOptions = {}) {\r\n  const queryClient = useQueryClient();\r\n  \r\n  const create = useMutation({\r\n    mutationFn: createPayment,\r\n    onSuccess: (data) => {\r\n      queryClient.invalidateQueries({ queryKey: paymentKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: paymentKeys.stats() });\r\n      options.onCreateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const update = useMutation({\r\n    mutationFn: ({ systemId, data }: { systemId: string; data: Partial<Payment> }) => \r\n      updatePayment(asSystemId(systemId), data),\r\n    onSuccess: (data, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: paymentKeys.detail(variables.systemId) });\r\n      queryClient.invalidateQueries({ queryKey: paymentKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: paymentKeys.stats() });\r\n      options.onUpdateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const remove = useMutation({\r\n    mutationFn: (systemId: string) => deletePayment(asSystemId(systemId)),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: paymentKeys.all });\r\n      options.onDeleteSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const cancel = useMutation({\r\n    mutationFn: ({ systemId, reason }: { systemId: string; reason?: string }) => \r\n      cancelPayment(asSystemId(systemId), reason),\r\n    onSuccess: (data, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: paymentKeys.detail(variables.systemId) });\r\n      queryClient.invalidateQueries({ queryKey: paymentKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: paymentKeys.stats() });\r\n      options.onCancelSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  return { create, update, remove, cancel };\r\n}\r\n\r\nexport function usePaymentsByRecipient(recipientSystemId: string | null | undefined) {\r\n  return usePayments({\r\n    recipientSystemId: recipientSystemId || undefined,\r\n    limit: 50,\r\n  });\r\n}\r\n\r\nexport function usePaymentsByBranch(branchId: string | null | undefined) {\r\n  return usePayments({\r\n    branchId: branchId || undefined,\r\n    limit: 100,\r\n  });\r\n}\r\n\r\nexport function usePaymentsByDateRange(startDate: string, endDate: string) {\r\n  return usePayments({ startDate, endDate });\r\n}\r\n\r\nexport function usePaymentsByCategory(category: Payment['category']) {\r\n  return usePayments({ category: category as any });\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;;;;CAIC,GAED;AAAA;AAAA;AAAA;AACA;AAWA;;;;;AAEO,MAAM,cAAc;IACzB,KAAK;QAAC;KAAW;IACjB,OAAO,IAAM;eAAI,YAAY,GAAG;YAAE;SAAO;IACzC,MAAM,CAAC,SAA2B;eAAI,YAAY,KAAK;YAAI;SAAO;IAClE,SAAS,IAAM;eAAI,YAAY,GAAG;YAAE;SAAS;IAC7C,QAAQ,CAAC,KAAe;eAAI,YAAY,OAAO;YAAI;SAAG;IACtD,OAAO,IAAM;eAAI,YAAY,GAAG;YAAE;SAAQ;AAC5C;AAEO,SAAS,YAAY,SAAyB,CAAC,CAAC;;IACrD,OAAO,IAAA,0LAAQ,EAAC;QACd,UAAU,YAAY,IAAI,CAAC;QAC3B,OAAO;oCAAE,IAAM,IAAA,kKAAa,EAAC;;QAC7B,WAAW;QACX,QAAQ,IAAI,KAAK;QACjB,iBAAiB,8LAAgB;IACnC;AACF;GARgB;;QACP,0LAAQ;;;AASV,SAAS,WAAW,EAA6B;;IACtD,OAAO,IAAA,0LAAQ,EAAC;QACd,UAAU,YAAY,MAAM,CAAC;QAC7B,OAAO;mCAAE,IAAM,IAAA,iKAAY,EAAC,IAAA,mIAAU,EAAC;;QACvC,SAAS,CAAC,CAAC;QACX,WAAW;IACb;AACF;IAPgB;;QACP,0LAAQ;;;AAQV,SAAS;;IACd,OAAO,IAAA,0LAAQ,EAAC;QACd,UAAU,YAAY,KAAK;QAC3B,SAAS,sKAAiB;QAC1B,WAAW;IACb;AACF;IANgB;;QACP,0LAAQ;;;AAeV,SAAS,oBAAoB,UAAsC,CAAC,CAAC;;IAC1E,MAAM,cAAc,IAAA,2MAAc;IAElC,MAAM,SAAS,IAAA,gMAAW,EAAC;QACzB,YAAY,kKAAa;QACzB,SAAS;uDAAE,CAAC;gBACV,YAAY,iBAAiB,CAAC;oBAAE,UAAU,YAAY,KAAK;gBAAG;gBAC9D,YAAY,iBAAiB,CAAC;oBAAE,UAAU,YAAY,KAAK;gBAAG;gBAC9D,QAAQ,eAAe,GAAG;YAC5B;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,SAAS,IAAA,gMAAW,EAAC;QACzB,UAAU;uDAAE,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAgD,GAC3E,IAAA,kKAAa,EAAC,IAAA,mIAAU,EAAC,WAAW;;QACtC,SAAS;uDAAE,CAAC,MAAM;gBAChB,YAAY,iBAAiB,CAAC;oBAAE,UAAU,YAAY,MAAM,CAAC,UAAU,QAAQ;gBAAE;gBACjF,YAAY,iBAAiB,CAAC;oBAAE,UAAU,YAAY,KAAK;gBAAG;gBAC9D,YAAY,iBAAiB,CAAC;oBAAE,UAAU,YAAY,KAAK;gBAAG;gBAC9D,QAAQ,eAAe,GAAG;YAC5B;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,SAAS,IAAA,gMAAW,EAAC;QACzB,UAAU;uDAAE,CAAC,WAAqB,IAAA,kKAAa,EAAC,IAAA,mIAAU,EAAC;;QAC3D,SAAS;uDAAE;gBACT,YAAY,iBAAiB,CAAC;oBAAE,UAAU,YAAY,GAAG;gBAAC;gBAC1D,QAAQ,eAAe;YACzB;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,SAAS,IAAA,gMAAW,EAAC;QACzB,UAAU;uDAAE,CAAC,EAAE,QAAQ,EAAE,MAAM,EAAyC,GACtE,IAAA,kKAAa,EAAC,IAAA,mIAAU,EAAC,WAAW;;QACtC,SAAS;uDAAE,CAAC,MAAM;gBAChB,YAAY,iBAAiB,CAAC;oBAAE,UAAU,YAAY,MAAM,CAAC,UAAU,QAAQ;gBAAE;gBACjF,YAAY,iBAAiB,CAAC;oBAAE,UAAU,YAAY,KAAK;gBAAG;gBAC9D,YAAY,iBAAiB,CAAC;oBAAE,UAAU,YAAY,KAAK;gBAAG;gBAC9D,QAAQ,eAAe,GAAG;YAC5B;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,OAAO;QAAE;QAAQ;QAAQ;QAAQ;IAAO;AAC1C;IA/CgB;;QACM,2MAAc;QAEnB,gMAAW;QAUX,gMAAW;QAYX,gMAAW;QASX,gMAAW;;;AAerB,SAAS,uBAAuB,iBAA4C;;IACjF,OAAO,YAAY;QACjB,mBAAmB,qBAAqB;QACxC,OAAO;IACT;AACF;IALgB;;QACP;;;AAMF,SAAS,oBAAoB,QAAmC;;IACrE,OAAO,YAAY;QACjB,UAAU,YAAY;QACtB,OAAO;IACT;AACF;IALgB;;QACP;;;AAMF,SAAS,uBAAuB,SAAiB,EAAE,OAAe;;IACvE,OAAO,YAAY;QAAE;QAAW;IAAQ;AAC1C;IAFgB;;QACP;;;AAGF,SAAS,sBAAsB,QAA6B;;IACjE,OAAO,YAAY;QAAE,UAAU;IAAgB;AACjD;IAFgB;;QACP"}},
    {"offset": {"line": 4393, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/payments/hooks/use-all-payments.ts"],"sourcesContent":["/**\r\n * useAllPayments - Convenience hook for components needing all payments as flat array\r\n */\r\n\r\nimport { usePayments } from './use-payments';\r\n\r\nexport function useAllPayments() {\r\n  const query = usePayments({});\r\n  \r\n  return {\r\n    data: query.data?.data || [],\r\n    isLoading: query.isLoading,\r\n    isError: query.isError,\r\n    error: query.error,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;CAEC,GAED;;;AAEO,SAAS;;IACd,MAAM,QAAQ,IAAA,kKAAW,EAAC,CAAC;IAE3B,OAAO;QACL,MAAM,MAAM,IAAI,EAAE,QAAQ,EAAE;QAC5B,WAAW,MAAM,SAAS;QAC1B,SAAS,MAAM,OAAO;QACtB,OAAO,MAAM,KAAK;IACpB;AACF;GATgB;;QACA,kKAAW"}},
    {"offset": {"line": 4424, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/sales-returns/store.ts"],"sourcesContent":["import { formatDate, formatDateTime, formatDateTimeSeconds, formatDateCustom, parseDate, getCurrentDate } from '@/lib/date-utils';\r\nimport { createCrudStore } from '../../lib/store-factory';\r\nimport type { SalesReturn, ReturnLineItem } from './types';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport { GHTKService, type GHTKCreateOrderParams } from '../settings/shipping/integrations/ghtk-service';\r\nimport { loadShippingConfig } from '../../lib/utils/shipping-config-migration';\r\nimport { toast } from 'sonner';\r\n\r\n// Other stores\r\nimport { useOrderStore } from '../orders/store';\r\nimport { useProductStore } from '../products/store';\r\nimport { useStockHistoryStore } from '../stock-history/store';\r\nimport { useCustomerStore } from '../customers/store';\r\nimport { createPaymentDocument, createReceiptDocument } from '../finance/document-helpers';\r\nimport { useShippingPartnerStore } from '../settings/shipping/store';\r\nimport { asBusinessId, asSystemId, type SystemId } from '../../lib/id-types';\r\nimport { isComboProduct } from '../products/combo-utils';\r\nimport { generateSystemId, getMaxSystemIdCounter } from '../../lib/id-utils';\r\n\r\n/**\r\n * ‚úÖ Helper: Expand combo return items to child products\r\n * When a combo is returned, we need to add stock back to child products\r\n */\r\nconst getReturnStockItems = (returnItems: ReturnLineItem[]) => {\r\n    const { findById } = useProductStore.getState();\r\n    const expandedItems: { productSystemId: SystemId; productName: string; quantity: number }[] = [];\r\n    \r\n    returnItems.forEach(item => {\r\n        const product = findById(item.productSystemId);\r\n        if (product && isComboProduct(product) && product.comboItems) {\r\n            // Combo ‚Üí expand to child products\r\n            product.comboItems.forEach(comboItem => {\r\n                const childProduct = findById(comboItem.productSystemId);\r\n                expandedItems.push({\r\n                    productSystemId: comboItem.productSystemId,\r\n                    productName: childProduct?.name || 'SP kh√¥ng x√°c ƒë·ªãnh',\r\n                    quantity: comboItem.quantity * item.returnQuantity\r\n                });\r\n            });\r\n        } else {\r\n            // Regular product\r\n            expandedItems.push({\r\n                productSystemId: asSystemId(item.productSystemId),\r\n                productName: item.productName,\r\n                quantity: item.returnQuantity\r\n            });\r\n        }\r\n    });\r\n    return expandedItems;\r\n};\r\n\r\nconst baseStore = createCrudStore<SalesReturn>([], 'sales-returns', {\r\n  apiEndpoint: '/api/sales-returns',\r\n});\r\n\r\nconst originalAdd = baseStore.getState().add;\r\n\r\nconst augmentedMethods = {\r\n  addWithSideEffects: (item: Omit<SalesReturn, 'systemId' | 'id'> & { creatorId: string }) => {\r\n    const orderSystemId = asSystemId(item.orderSystemId);\r\n    const orderBusinessId = asBusinessId(item.orderId);\r\n    const customerSystemId = asSystemId(item.customerSystemId);\r\n    const branchSystemId = asSystemId(item.branchSystemId);\r\n    const creatorSystemId = asSystemId(item.creatorSystemId ?? item.creatorId ?? 'SYSTEM');\r\n    const exchangeOrderSystemId = item.exchangeOrderSystemId ? asSystemId(item.exchangeOrderSystemId) : undefined;\r\n    const accountSystemId = item.accountSystemId ? asSystemId(item.accountSystemId) : undefined;\r\n    const paymentVoucherSystemId = item.paymentVoucherSystemId ? asSystemId(item.paymentVoucherSystemId) : undefined;\r\n    const paymentVoucherSystemIds = item.paymentVoucherSystemIds?.map(asSystemId);\r\n    const receiptVoucherSystemIds = item.receiptVoucherSystemIds?.map(asSystemId);\r\n\r\n    const formattedItems = item.items.map(lineItem => ({\r\n      ...lineItem,\r\n      productSystemId: asSystemId(lineItem.productSystemId),\r\n      productId: asBusinessId(lineItem.productId),\r\n    }));\r\n\r\n    const formattedPayments = item.payments?.map(payment => ({\r\n      ...payment,\r\n      accountSystemId: asSystemId(payment.accountSystemId),\r\n    }));\r\n\r\n    const formattedRefunds = item.refunds?.map(refund => ({\r\n      ...refund,\r\n      accountSystemId: asSystemId(refund.accountSystemId),\r\n    }));\r\n\r\n    const newItemData: Omit<SalesReturn, 'systemId'> = {\r\n      id: asBusinessId(''),\r\n      orderSystemId,\r\n      orderId: orderBusinessId,\r\n      customerSystemId,\r\n      customerName: item.customerName,\r\n      branchSystemId,\r\n      branchName: item.branchName,\r\n      returnDate: item.returnDate,\r\n      reason: item.reason,\r\n      note: item.note,\r\n      notes: item.notes,\r\n      reference: item.reference,\r\n      items: formattedItems,\r\n      totalReturnValue: item.totalReturnValue,\r\n      isReceived: item.isReceived,\r\n      exchangeItems: item.exchangeItems ?? [],\r\n      exchangeOrderSystemId,\r\n      subtotalNew: item.subtotalNew,\r\n      shippingFeeNew: item.shippingFeeNew,\r\n      discountNew: item.discountNew,\r\n      discountNewType: item.discountNewType,\r\n      grandTotalNew: item.grandTotalNew,\r\n      deliveryMethod: item.deliveryMethod,\r\n      shippingPartnerId: item.shippingPartnerId,\r\n      shippingServiceId: item.shippingServiceId,\r\n      shippingAddress: item.shippingAddress,\r\n      packageInfo: item.packageInfo,\r\n      configuration: item.configuration,\r\n      finalAmount: item.finalAmount,\r\n      refundMethod: item.refundMethod,\r\n      refundAmount: item.refundAmount,\r\n      accountSystemId,\r\n      refunds: formattedRefunds,\r\n      payments: formattedPayments,\r\n      paymentVoucherSystemId,\r\n      paymentVoucherSystemIds,\r\n      receiptVoucherSystemIds,\r\n      creatorSystemId,\r\n      creatorName: item.creatorName,\r\n    };\r\n\r\n    // --- Side Effects ---\r\n    const { update: updateOrder, findById: findOrderById, add: addOrder } = useOrderStore.getState();\r\n    const { updateInventory } = useProductStore.getState();\r\n    const { addEntry: addStockHistory } = useStockHistoryStore.getState();\r\n    const { updateDebt, incrementReturnStats } = useCustomerStore.getState();\r\n    const order = findOrderById(newItemData.orderSystemId);\r\n    if (!order) return { newReturn: null, newOrderSystemId: null };\r\n\r\n    // ‚úÖ IMPORTANT: Create the return FIRST to get IDs for exchange order\r\n    const newReturn = originalAdd(newItemData);\r\n    if (!newReturn) return { newReturn: null, newOrderSystemId: null };\r\n\r\n    // ‚úÖ Update customer return stats\r\n    const totalReturnQty = newItemData.items.reduce((sum, item) => sum + item.returnQuantity, 0);\r\n    if (totalReturnQty > 0) {\r\n        incrementReturnStats(newItemData.customerSystemId, totalReturnQty);\r\n    }\r\n\r\n    let newOrderSystemId: SystemId | undefined;\r\n\r\n    // Create a new sales order for the exchange items\r\n    if (newItemData.exchangeItems && newItemData.exchangeItems.length > 0) {\r\n        console.log('üîÑ [Sales Return] Creating exchange order...', {\r\n        exchangeItems: newItemData.exchangeItems,\r\n        finalAmount: newItemData.finalAmount,\r\n        payments: newItemData.payments,\r\n        });\r\n        \r\n      // ‚úÖ Calculate payments for exchange order based on sales return logic\r\n      const exchangeOrderPayments =\r\n        newItemData.finalAmount > 0 && newItemData.payments\r\n        ? newItemData.payments.map(p => ({\r\n          method: p.method,\r\n          accountSystemId: p.accountSystemId,\r\n          amount: p.amount,\r\n          }))\r\n        : [];\r\n        // If company refunded customer (finalAmount < 0)\r\n        // The exchange order will have COD = grandTotal (shipper collects on delivery)\r\n        // No payments array needed - will be handled by COD in shipping\r\n        \r\n        // ‚úÖ Determine status and packagings based on delivery method\r\n        let finalMainStatus: 'ƒê·∫∑t h√†ng' | 'ƒêang giao d·ªãch' = 'ƒê·∫∑t h√†ng';\r\n        let finalDeliveryStatus: string = 'Ch·ªù ƒë√≥ng g√≥i';\r\n        const packagings: any[] = [];\r\n        const now = formatDateCustom(getCurrentDate(), 'yyyy-MM-dd HH:mm');\r\n        \r\n        // ‚úÖ Helper to get next packaging systemId\r\n        const PACKAGING_SYSTEM_ID_PREFIX = 'PACKAGE';\r\n        const allOrders = useOrderStore.getState().data;\r\n        const allPackagings = allOrders.flatMap(o => o.packagings || []);\r\n        const maxPackagingCounter = getMaxSystemIdCounter(allPackagings, PACKAGING_SYSTEM_ID_PREFIX);\r\n        let packagingCounter = maxPackagingCounter;\r\n        const getNextPackagingSystemId = () => {\r\n            packagingCounter++;\r\n            return asSystemId(generateSystemId('packaging', packagingCounter));\r\n        };\r\n        \r\n        // Check if using shipping partner or pickup\r\n      const isPickup = newItemData.deliveryMethod === 'pickup';\r\n      const isShippingPartner = newItemData.shippingPartnerId && newItemData.shippingServiceId;\r\n        \r\n        if (isPickup) {\r\n            // Nh·∫≠n t·∫°i c·ª≠a h√†ng - T·∫°o packaging request ngay\r\n            finalMainStatus = 'ƒêang giao d·ªãch';\r\n            finalDeliveryStatus = 'Ch·ªù ƒë√≥ng g√≥i';\r\n            packagings.push({\r\n                systemId: getNextPackagingSystemId(), // ‚úÖ Use proper format PACKAGE000001\r\n                id: '',\r\n                requestDate: now,\r\n          requestingEmployeeId: creatorSystemId,\r\n          requestingEmployeeName: newItemData.creatorName,\r\n                status: 'Ch·ªù ƒë√≥ng g√≥i',\r\n                printStatus: 'Ch∆∞a in',\r\n                deliveryStatus: 'Ch·ªù ƒë√≥ng g√≥i',\r\n            });\r\n        } else if (isShippingPartner) {\r\n            // ƒê·∫©y qua h√£ng v·∫≠n chuy·ªÉn - T·∫°o packaging ƒë√£ ƒë√≥ng g√≥i v·ªõi tracking\r\n            finalMainStatus = 'ƒêang giao d·ªãch';\r\n            finalDeliveryStatus = 'Ch·ªù l·∫•y h√†ng';\r\n            \r\n            // Get partner info\r\n            const { data: partners } = useShippingPartnerStore.getState();\r\n            const partner = partners.find(p => p.systemId === newItemData.shippingPartnerId);\r\n            const service = partner?.services.find(s => s.id === newItemData.shippingServiceId);\r\n            \r\n            packagings.push({\r\n                systemId: getNextPackagingSystemId(), // ‚úÖ Use proper format PACKAGE000001\r\n                id: '',\r\n                requestDate: now,\r\n                confirmDate: now,\r\n              requestingEmployeeId: creatorSystemId,\r\n              requestingEmployeeName: newItemData.creatorName,\r\n              confirmingEmployeeId: creatorSystemId,\r\n              confirmingEmployeeName: newItemData.creatorName,\r\n                status: 'ƒê√£ ƒë√≥ng g√≥i',\r\n                deliveryStatus: 'Ch·ªù l·∫•y h√†ng',\r\n                printStatus: 'Ch∆∞a in',\r\n                deliveryMethod: 'D·ªãch v·ª• giao h√†ng',\r\n                carrier: partner?.name,\r\n                service: service?.name,\r\n              trackingCode: newItemData.packageInfo?.trackingCode || `VC${Date.now()}`,\r\n              shippingFeeToPartner: newItemData.shippingFeeNew,\r\n                codAmount: 0, // Will be calculated based on payments\r\n                payer: 'Ng∆∞·ªùi nh·∫≠n',\r\n              weight: newItemData.packageInfo?.weight,\r\n              dimensions: newItemData.packageInfo?.dimensions,\r\n            });\r\n        }\r\n        // else: deliver-later ‚Üí keep default 'ƒê·∫∑t h√†ng', 'Ch·ªù ƒë√≥ng g√≥i', no packagings\r\n        \r\n        const newOrderPayload = {\r\n            id: '', // ‚úÖ Empty string triggers auto-generation of business ID (DH...)\r\n            customerSystemId: order.customerSystemId,\r\n            customerName: order.customerName,\r\n            branchSystemId: order.branchSystemId, // ‚úÖ Use systemId only\r\n            branchName: order.branchName,\r\n            salespersonId: creatorSystemId,\r\n            salesperson: newItemData.creatorName,\r\n            orderDate: formatDateCustom(getCurrentDate(), 'yyyy-MM-dd HH:mm'),\r\n            lineItems: newItemData.exchangeItems,\r\n            subtotal: newItemData.subtotalNew,\r\n            shippingFee: newItemData.shippingFeeNew,\r\n            tax: 0,\r\n            // ‚úÖ IMPORTANT: grandTotal should be NET amount (after subtracting return value)\r\n            // grandTotal = subtotalNew + shippingFee - totalReturnValue\r\n            grandTotal: newItemData.finalAmount > 0 ? newItemData.finalAmount : newItemData.grandTotalNew,\r\n            // ‚úÖ Store return value info for display\r\n            linkedSalesReturnId: newReturn.id, // ‚úÖ Fixed: Use newReturn.id (business ID)\r\n            linkedSalesReturnSystemId: newReturn.systemId, // ‚úÖ Add systemId for linking\r\n            linkedSalesReturnValue: newItemData.totalReturnValue, // Value of returned items\r\n            payments: exchangeOrderPayments, // ‚úÖ Set payments based on sales return scenario\r\n            notes: `ƒê∆°n h√†ng ƒë·ªïi t·ª´ phi·∫øu tr·∫£ ${newReturn.id} c·ªßa ƒë∆°n h√†ng ${order.id}`, // ‚úÖ Fixed: Use newReturn.id\r\n            sourceSalesReturnId: newReturn.id, // ‚úÖ Fixed: Use newReturn.id\r\n            // ‚úÖ Pass shipping info from form\r\n            deliveryMethod: newItemData.deliveryMethod === 'pickup' ? 'Nh·∫≠n t·∫°i c·ª≠a h√†ng' : 'D·ªãch v·ª• giao h√†ng',\r\n            shippingPartnerId: newItemData.shippingPartnerId,\r\n            shippingServiceId: newItemData.shippingServiceId,\r\n            shippingAddress: newItemData.shippingAddress,\r\n            packageInfo: newItemData.packageInfo,\r\n            configuration: newItemData.configuration,\r\n            // ‚úÖ Add required status fields based on delivery method\r\n            status: finalMainStatus,\r\n            paymentStatus: exchangeOrderPayments.length > 0 ? \r\n              (exchangeOrderPayments.reduce((sum, p) => sum + p.amount, 0) >= newItemData.grandTotalNew ? 'Thanh to√°n to√†n b·ªô' : 'Thanh to√°n 1 ph·∫ßn') \r\n                : 'Ch∆∞a thanh to√°n' as const,\r\n            deliveryStatus: finalDeliveryStatus,\r\n            printStatus: 'Ch∆∞a in' as const,\r\n            stockOutStatus: 'Ch∆∞a xu·∫•t kho' as const,\r\n            returnStatus: 'Ch∆∞a tr·∫£ h√†ng' as const,\r\n            codAmount: 0, // Will be calculated by ShippingIntegration based on payments\r\n            packagings: packagings,\r\n        };\r\n        \r\n        console.log('üì¶ [Sales Return] New order payload:', newOrderPayload);\r\n        \r\n        const newOrder = addOrder(newOrderPayload as any);\r\n        \r\n        console.log('‚úÖ [Sales Return] New order created:', newOrder);\r\n        \r\n        if (newOrder) {\r\n          newOrderSystemId = asSystemId(newOrder.systemId);\r\n          // ‚úÖ Save exchange order systemId to sales return\r\n          (newItemData as SalesReturn).exchangeOrderSystemId = newOrderSystemId;\r\n            \r\n            console.log('üéâ [Sales Return] Exchange order systemId:', newOrderSystemId);\r\n        } else {\r\n            console.error('‚ùå [Sales Return] Failed to create exchange order!');\r\n        }\r\n    }\r\n\r\n    // Adjust customer debt if needed\r\n    const creditAmount = newItemData.totalReturnValue - newItemData.grandTotalNew - (newItemData.refundAmount || 0);\r\n    if (creditAmount > 0) {\r\n      updateDebt(newItemData.customerSystemId, -creditAmount);\r\n    }\r\n    \r\n    // ‚úÖ newReturn already created above, use it directly\r\n    // ‚úÖ NOW create vouchers with correct originalDocumentId\r\n    // Handle Financials AFTER creating the return\r\n    const finalAmount = newItemData.finalAmount;\r\n\r\n    if (finalAmount < 0 && newItemData.refunds && newItemData.refunds.length > 0) {\r\n      const createdVoucherIds: SystemId[] = [];\r\n\r\n      newItemData.refunds.forEach(refund => {\r\n        if (!refund.amount || refund.amount <= 0) {\r\n          return;\r\n        }\r\n\r\n        const { document, error } = createPaymentDocument({\r\n          amount: refund.amount,\r\n          description: `Ho√†n ti·ªÅn ƒë·ªïi/tr·∫£ h√†ng t·ª´ ƒë∆°n ${order.id} (Phi·∫øu: ${newReturn.id}) qua ${refund.method}`,\r\n          recipientName: newItemData.customerName,\r\n          recipientSystemId: newItemData.customerSystemId,\r\n          customerSystemId: newItemData.customerSystemId,\r\n          customerName: newItemData.customerName,\r\n          paymentMethodName: refund.method,\r\n          accountSystemId: refund.accountSystemId,\r\n          paymentTypeName: 'Ho√†n ti·ªÅn kh√°ch h√†ng',\r\n          branchSystemId: newReturn.branchSystemId,\r\n          branchName: newReturn.branchName,\r\n          createdBy: creatorSystemId,\r\n          originalDocumentId: newReturn.id,\r\n          linkedSalesReturnSystemId: newReturn.systemId,\r\n          linkedOrderSystemId: newReturn.orderSystemId,\r\n          category: 'complaint_refund',\r\n          affectsDebt: true, // ‚úÖ Ho√†n ti·ªÅn kh√°ch h√†ng ·∫£nh h∆∞·ªüng c√¥ng n·ª£ (gi·∫£m c√¥ng n·ª£)\r\n        });\r\n\r\n        if (error) {\r\n          console.error('[Sales Return] Failed to create payment voucher:', error);\r\n          toast.error(`Kh√¥ng th·ªÉ t·∫°o phi·∫øu chi ho√†n ti·ªÅn: ${error}`);\r\n          return;\r\n        }\r\n\r\n        if (document) {\r\n          createdVoucherIds.push(asSystemId(document.systemId));\r\n        }\r\n      });\r\n\r\n      if (createdVoucherIds.length > 0) {\r\n        baseStore.getState().update(newReturn.systemId, {\r\n          ...newReturn,\r\n          paymentVoucherSystemIds: createdVoucherIds,\r\n        });\r\n      }\r\n    } else if (finalAmount > 0 && newItemData.payments && newItemData.payments.length > 0) {\r\n      const createdVoucherIds: SystemId[] = [];\r\n\r\n      newItemData.payments.forEach(payment => {\r\n        if (!payment.amount || payment.amount <= 0) {\r\n          return;\r\n        }\r\n\r\n        const { document, error } = createReceiptDocument({\r\n          amount: payment.amount,\r\n          description: `Thu ti·ªÅn ch√™nh l·ªách ƒë·ªïi h√†ng t·ª´ ƒë∆°n ${order.id} (Phi·∫øu: ${newReturn.id})`,\r\n          customerName: newReturn.customerName,\r\n          customerSystemId: newItemData.customerSystemId,\r\n          paymentMethodName: payment.method,\r\n          accountSystemId: payment.accountSystemId,\r\n          receiptTypeName: 'Thanh to√°n cho ƒë∆°n h√†ng',\r\n          branchSystemId: newReturn.branchSystemId,\r\n          branchName: newReturn.branchName,\r\n          createdBy: creatorSystemId,\r\n          originalDocumentId: newReturn.id,\r\n          linkedSalesReturnSystemId: newReturn.systemId,\r\n          linkedOrderSystemId: newReturn.orderSystemId,\r\n          category: 'sale',\r\n          affectsDebt: false,\r\n        });\r\n\r\n        if (error) {\r\n          console.error('[Sales Return] Failed to create receipt voucher:', error);\r\n          toast.error(`Kh√¥ng th·ªÉ t·∫°o phi·∫øu thu ƒë·ªïi h√†ng: ${error}`);\r\n          return;\r\n        }\r\n\r\n        if (document) {\r\n          createdVoucherIds.push(asSystemId(document.systemId));\r\n        }\r\n      });\r\n\r\n      if (createdVoucherIds.length > 0) {\r\n        baseStore.getState().update(newReturn.systemId, {\r\n          ...newReturn,\r\n          receiptVoucherSystemIds: createdVoucherIds,\r\n        });\r\n      }\r\n    }\r\n\r\n    // ‚úÖ Update inventory for returned items ONLY if isReceived = true\r\n    // ‚úÖ For combo products, add stock to child products instead\r\n    if (newReturn.isReceived) {\r\n        console.log('‚úÖ [Sales Return] Updating inventory - items received');\r\n        \r\n        // Expand combo items to child products\r\n        const stockItems = getReturnStockItems(newReturn.items);\r\n        \r\n        stockItems.forEach(item => {\r\n          if (item.quantity > 0) {\r\n            const product = useProductStore.getState().findById(item.productSystemId);\r\n            const oldStock = product?.inventoryByBranch[newReturn.branchSystemId] || 0;\r\n            updateInventory(item.productSystemId, newReturn.branchSystemId, item.quantity); // Add stock back\r\n            addStockHistory({\r\n              productId: item.productSystemId,\r\n              date: getCurrentDate().toISOString(),\r\n              employeeName: newReturn.creatorName,\r\n              action: 'Nh·∫≠p h√†ng t·ª´ kh√°ch tr·∫£',\r\n              quantityChange: item.quantity,\r\n              newStockLevel: oldStock + item.quantity,\r\n              documentId: newReturn.id, // ‚úÖ Use business ID for document reference\r\n              branchSystemId: newReturn.branchSystemId,\r\n              branch: newReturn.branchName,\r\n            });\r\n          }\r\n        });\r\n    } else {\r\n        console.log('‚è∏Ô∏è [Sales Return] Inventory NOT updated - waiting for receipt confirmation');\r\n    }\r\n\r\n    // Update original order's return status\r\n    const previousReturnsForOrder = baseStore.getState().data.filter(r => r.orderSystemId === order.systemId);\r\n    const totalReturnedQty = previousReturnsForOrder.flatMap(r => r.items).reduce((sum, item) => sum + item.returnQuantity, 0);\r\n    const totalOrderedQty = order.lineItems.reduce((sum, item) => sum + item.quantity, 0);\r\n    const newReturnStatus = totalReturnedQty >= totalOrderedQty ? 'Tr·∫£ h√†ng to√†n b·ªô' : 'Tr·∫£ h√†ng m·ªôt ph·∫ßn';\r\n    updateOrder(order.systemId, { ...order, returnStatus: newReturnStatus });\r\n    \r\n    return { newReturn, newOrderSystemId };\r\n  },\r\n  \r\n  /**\r\n   * ‚úÖ Confirm receipt of returned items and update inventory\r\n   * Use this when isReceived was false initially and items are now received\r\n   * ‚úÖ For combo products, add stock to child products instead\r\n   */\r\n  confirmReceipt: (returnSystemId: SystemId) => {\r\n    const salesReturn = baseStore.getState().findById(returnSystemId);\r\n    if (!salesReturn) {\r\n      console.error('‚ùå [Sales Return] Return not found:', returnSystemId);\r\n      return { success: false, message: 'Kh√¥ng t√¨m th·∫•y phi·∫øu tr·∫£ h√†ng' };\r\n    }\r\n    \r\n    if (salesReturn.isReceived) {\r\n      console.warn('‚ö†Ô∏è [Sales Return] Already received:', returnSystemId);\r\n      return { success: false, message: 'H√†ng ƒë√£ ƒë∆∞·ª£c nh·∫≠n tr∆∞·ªõc ƒë√≥' };\r\n    }\r\n    \r\n    const { updateInventory } = useProductStore.getState();\r\n    const { addEntry: addStockHistory } = useStockHistoryStore.getState();\r\n    \r\n    // ‚úÖ Expand combo items to child products\r\n    const stockItems = getReturnStockItems(salesReturn.items);\r\n    \r\n    // Update inventory for all returned items (including expanded combo children)\r\n    stockItems.forEach(item => {\r\n      if (item.quantity > 0) {\r\n        const product = useProductStore.getState().findById(item.productSystemId);\r\n        const oldStock = product?.inventoryByBranch[salesReturn.branchSystemId] || 0;\r\n        updateInventory(item.productSystemId, salesReturn.branchSystemId, item.quantity);\r\n        addStockHistory({\r\n          productId: item.productSystemId,\r\n          date: getCurrentDate().toISOString(),\r\n          employeeName: salesReturn.creatorName,\r\n          action: 'Nh·∫≠p h√†ng t·ª´ kh√°ch tr·∫£ (x√°c nh·∫≠n)',\r\n          quantityChange: item.quantity,\r\n          newStockLevel: oldStock + item.quantity,\r\n          documentId: salesReturn.id,\r\n          branchSystemId: salesReturn.branchSystemId,\r\n          branch: salesReturn.branchName,\r\n        });\r\n      }\r\n    });\r\n    \r\n    // Update the return record\r\n    baseStore.getState().update(returnSystemId, {\r\n      ...salesReturn,\r\n      isReceived: true,\r\n    });\r\n    \r\n    console.log('‚úÖ [Sales Return] Receipt confirmed and inventory updated:', returnSystemId);\r\n    return { success: true, message: 'ƒê√£ x√°c nh·∫≠n nh·∫≠n h√†ng v√† c·∫≠p nh·∫≠t t·ªìn kho' };\r\n  },\r\n};\r\n\r\n// Export typed hook\r\nexport const useSalesReturnStore = (): any => {\r\n  const state = baseStore();\r\n  return {\r\n    ...state,\r\n    ...augmentedMethods,\r\n  };\r\n};\r\n\r\n// Export getState for non-hook usage\r\nuseSalesReturnStore.getState = (): any => {\r\n  const state = baseStore.getState();\r\n  return {\r\n    ...state,\r\n    ...augmentedMethods,\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4912, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/sales-returns/api/sales-returns-api.ts"],"sourcesContent":["/**\r\n * Sales Returns API functions\r\n * \r\n * ‚ö†Ô∏è Direct import: import { fetchSalesReturns } from '@/features/sales-returns/api/sales-returns-api'\r\n */\r\n\r\nimport type { SystemId, BusinessId } from '@/lib/id-types';\r\nimport type { SalesReturn } from '../types';\r\n\r\nconst BASE_URL = '/api/sales-returns';\r\n\r\nexport interface SalesReturnsParams {\r\n  page?: number;\r\n  limit?: number;\r\n  search?: string;\r\n  customerId?: string;\r\n  orderId?: string;\r\n  branchId?: string;\r\n  isReceived?: boolean;\r\n  startDate?: string;\r\n  endDate?: string;\r\n  sortBy?: string;\r\n  sortOrder?: 'asc' | 'desc';\r\n}\r\n\r\nexport interface SalesReturnsResponse {\r\n  data: SalesReturn[];\r\n  total: number;\r\n  page: number;\r\n  pageSize: number;\r\n}\r\n\r\nexport async function fetchSalesReturns(params: SalesReturnsParams = {}): Promise<SalesReturnsResponse> {\r\n  const searchParams = new URLSearchParams();\r\n  \r\n  if (params.page) searchParams.set('page', String(params.page));\r\n  if (params.limit) searchParams.set('limit', String(params.limit));\r\n  if (params.search) searchParams.set('search', params.search);\r\n  if (params.customerId) searchParams.set('customerId', params.customerId);\r\n  if (params.orderId) searchParams.set('orderId', params.orderId);\r\n  if (params.branchId) searchParams.set('branchId', params.branchId);\r\n  if (params.isReceived !== undefined) searchParams.set('isReceived', String(params.isReceived));\r\n  if (params.startDate) searchParams.set('startDate', params.startDate);\r\n  if (params.endDate) searchParams.set('endDate', params.endDate);\r\n  if (params.sortBy) searchParams.set('sortBy', params.sortBy);\r\n  if (params.sortOrder) searchParams.set('sortOrder', params.sortOrder);\r\n  \r\n  const url = searchParams.toString() ? `${BASE_URL}?${searchParams}` : BASE_URL;\r\n  const response = await fetch(url);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch sales returns: ${response.statusText}`);\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function fetchSalesReturn(systemId: SystemId): Promise<SalesReturn> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch sales return: ${response.statusText}`);\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function createSalesReturn(data: Omit<SalesReturn, 'systemId' | 'id' | 'createdAt' | 'updatedAt'>): Promise<SalesReturn> {\r\n  const response = await fetch(BASE_URL, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to create sales return');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function updateSalesReturn(systemId: SystemId, data: Partial<SalesReturn>): Promise<SalesReturn> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`, {\r\n    method: 'PUT',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to update sales return');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function deleteSalesReturn(systemId: SystemId): Promise<void> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`, {\r\n    method: 'DELETE',\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to delete sales return: ${response.statusText}`);\r\n  }\r\n}\r\n\r\nexport async function markAsReceived(systemId: SystemId): Promise<SalesReturn> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}/receive`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to mark sales return as received');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function fetchSalesReturnStats(): Promise<{\r\n  total: number;\r\n  pending: number;\r\n  received: number;\r\n  totalValue: number;\r\n}> {\r\n  const response = await fetch(`${BASE_URL}/stats`);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch sales return stats: ${response.statusText}`);\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5023, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/sales-returns/hooks/use-sales-returns.ts"],"sourcesContent":["/**\r\n * useSalesReturns - React Query hooks\r\n * \r\n * ‚ö†Ô∏è Direct import: import { useSalesReturns } from '@/features/sales-returns/hooks/use-sales-returns'\r\n */\r\n\r\nimport { useQuery, useMutation, useQueryClient, keepPreviousData } from '@tanstack/react-query';\r\nimport { asSystemId } from '@/lib/id-types';\r\nimport {\r\n  fetchSalesReturns,\r\n  fetchSalesReturn,\r\n  createSalesReturn,\r\n  updateSalesReturn,\r\n  deleteSalesReturn,\r\n  markAsReceived,\r\n  fetchSalesReturnStats,\r\n  type SalesReturnsParams,\r\n} from '../api/sales-returns-api';\r\nimport type { SalesReturn } from '../types';\r\n\r\nexport const salesReturnKeys = {\r\n  all: ['sales-returns'] as const,\r\n  lists: () => [...salesReturnKeys.all, 'list'] as const,\r\n  list: (params: SalesReturnsParams) => [...salesReturnKeys.lists(), params] as const,\r\n  details: () => [...salesReturnKeys.all, 'detail'] as const,\r\n  detail: (id: string) => [...salesReturnKeys.details(), id] as const,\r\n  stats: () => [...salesReturnKeys.all, 'stats'] as const,\r\n};\r\n\r\nexport function useSalesReturns(params: SalesReturnsParams = {}) {\r\n  return useQuery({\r\n    queryKey: salesReturnKeys.list(params),\r\n    queryFn: () => fetchSalesReturns(params),\r\n    staleTime: 30_000,\r\n    gcTime: 5 * 60 * 1000,\r\n    placeholderData: keepPreviousData,\r\n  });\r\n}\r\n\r\nexport function useSalesReturn(id: string | null | undefined) {\r\n  return useQuery({\r\n    queryKey: salesReturnKeys.detail(id!),\r\n    queryFn: () => fetchSalesReturn(asSystemId(id!)),\r\n    enabled: !!id,\r\n    staleTime: 60_000,\r\n  });\r\n}\r\n\r\nexport function useSalesReturnStats() {\r\n  return useQuery({\r\n    queryKey: salesReturnKeys.stats(),\r\n    queryFn: fetchSalesReturnStats,\r\n    staleTime: 60_000,\r\n  });\r\n}\r\n\r\ninterface UseSalesReturnMutationsOptions {\r\n  onCreateSuccess?: (salesReturn: SalesReturn) => void;\r\n  onUpdateSuccess?: (salesReturn: SalesReturn) => void;\r\n  onDeleteSuccess?: () => void;\r\n  onReceiveSuccess?: (salesReturn: SalesReturn) => void;\r\n  onError?: (error: Error) => void;\r\n}\r\n\r\nexport function useSalesReturnMutations(options: UseSalesReturnMutationsOptions = {}) {\r\n  const queryClient = useQueryClient();\r\n  \r\n  const create = useMutation({\r\n    mutationFn: createSalesReturn,\r\n    onSuccess: (data) => {\r\n      queryClient.invalidateQueries({ queryKey: salesReturnKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: salesReturnKeys.stats() });\r\n      options.onCreateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const update = useMutation({\r\n    mutationFn: ({ systemId, data }: { systemId: string; data: Partial<SalesReturn> }) => \r\n      updateSalesReturn(asSystemId(systemId), data),\r\n    onSuccess: (data, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: salesReturnKeys.detail(variables.systemId) });\r\n      queryClient.invalidateQueries({ queryKey: salesReturnKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: salesReturnKeys.stats() });\r\n      options.onUpdateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const remove = useMutation({\r\n    mutationFn: (systemId: string) => deleteSalesReturn(asSystemId(systemId)),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: salesReturnKeys.all });\r\n      options.onDeleteSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const receive = useMutation({\r\n    mutationFn: (systemId: string) => markAsReceived(asSystemId(systemId)),\r\n    onSuccess: (data, systemId) => {\r\n      queryClient.invalidateQueries({ queryKey: salesReturnKeys.detail(systemId) });\r\n      queryClient.invalidateQueries({ queryKey: salesReturnKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: salesReturnKeys.stats() });\r\n      options.onReceiveSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  return { create, update, remove, receive };\r\n}\r\n\r\nexport function useSalesReturnsByCustomer(customerId: string | null | undefined) {\r\n  return useSalesReturns({\r\n    customerId: customerId || undefined,\r\n    limit: 50,\r\n  });\r\n}\r\n\r\nexport function useSalesReturnsByOrder(orderId: string | null | undefined) {\r\n  return useSalesReturns({\r\n    orderId: orderId || undefined,\r\n    limit: 20,\r\n  });\r\n}\r\n\r\nexport function usePendingSalesReturns() {\r\n  return useSalesReturns({ isReceived: false });\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5256, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/sales-returns/hooks/use-all-sales-returns.ts"],"sourcesContent":["/**\r\n * useAllSalesReturns - Convenience hook for components needing all sales returns as flat array\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { useSalesReturns } from './use-sales-returns';\r\nimport type { SalesReturn } from '../types';\r\n\r\nexport function useAllSalesReturns() {\r\n  const query = useSalesReturns({ limit: 500 });\r\n  \r\n  return {\r\n    data: query.data?.data || [],\r\n    isLoading: query.isLoading,\r\n    isError: query.isError,\r\n    error: query.error,\r\n  };\r\n}\r\n\r\n/**\r\n * Returns only pending (not received) sales returns\r\n */\r\nexport function usePendingSalesReturnsData() {\r\n  const { data, ...rest } = useAllSalesReturns();\r\n  \r\n  const pendingReturns = React.useMemo(\r\n    () => data.filter(r => !r.isReceived),\r\n    [data]\r\n  );\r\n  \r\n  return { data: pendingReturns, ...rest };\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;CAEC,GAED;AACA;;;;AAGO,SAAS;;IACd,MAAM,QAAQ,IAAA,sLAAe,EAAC;QAAE,OAAO;IAAI;IAE3C,OAAO;QACL,MAAM,MAAM,IAAI,EAAE,QAAQ,EAAE;QAC5B,WAAW,MAAM,SAAS;QAC1B,SAAS,MAAM,OAAO;QACtB,OAAO,MAAM,KAAK;IACpB;AACF;GATgB;;QACA,sLAAe;;;AAaxB,SAAS;;IACd,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,GAAG;IAE1B,MAAM,iBAAiB,wKAAa;8DAClC,IAAM,KAAK,MAAM;sEAAC,CAAA,IAAK,CAAC,EAAE,UAAU;;6DACpC;QAAC;KAAK;IAGR,OAAO;QAAE,MAAM;QAAgB,GAAG,IAAI;IAAC;AACzC;IATgB;;QACY"}},
    {"offset": {"line": 5313, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/shipments/store.ts"],"sourcesContent":["/**\r\n * Shipment Store - Entity ri√™ng cho v·∫≠n ƒë∆°n\r\n * \r\n * ‚ö†Ô∏è ID Format theo ID-GOVERNANCE.md:\r\n * - SystemId: SHIPMENT000001\r\n * - BusinessId: VC000001\r\n * \r\n * Relationship: Shipment 1:1 Packaging (via packagingSystemId)\r\n */\r\n\r\nimport { create } from 'zustand';\r\nimport type { SystemId, BusinessId } from '../../lib/id-types';\r\nimport { asSystemId, asBusinessId } from '../../lib/id-types';\r\nimport { generateSystemId, generateBusinessId, getMaxSystemIdCounter, getMaxBusinessIdCounter } from '../../lib/id-utils';\r\nimport type { Shipment } from './types';\r\n\r\n// ========================================\r\n// CONSTANTS\r\n// ========================================\r\n\r\nconst SHIPMENT_SYSTEM_ID_PREFIX = 'SHIPMENT';\r\nconst SHIPMENT_BUSINESS_ID_PREFIX = 'VC';\r\n\r\n// ========================================\r\n// INITIAL SEED DATA\r\n// ========================================\r\n\r\nconst initialData: Shipment[] = [\r\n    {\r\n        systemId: asSystemId('SHIPMENT000001'),\r\n        id: asBusinessId('VC000001'),\r\n        packagingSystemId: asSystemId('PACKAGE000001'),\r\n        orderSystemId: asSystemId('ORDER000001'),\r\n        orderId: asBusinessId('DH000001'),\r\n        trackingCode: 'GHN000001',\r\n        carrier: 'GHN',\r\n        service: 'Chu·∫©n',\r\n        deliveryStatus: 'ƒê√£ giao h√†ng',\r\n        printStatus: 'ƒê√£ in',\r\n        reconciliationStatus: 'ƒê√£ ƒë·ªëi so√°t',\r\n        shippingFeeToPartner: 25000,\r\n        codAmount: 0,\r\n        payer: 'Ng∆∞·ªùi g·ª≠i',\r\n        createdAt: '2025-11-01 08:30',\r\n        dispatchedAt: '2025-11-02 08:00',\r\n        deliveredAt: '2025-11-05 15:30',\r\n    },\r\n    {\r\n        systemId: asSystemId('SHIPMENT000002'),\r\n        id: asBusinessId('VC000002'),\r\n        packagingSystemId: asSystemId('PACKAGE000002'),\r\n        orderSystemId: asSystemId('ORDER000002'),\r\n        orderId: asBusinessId('DH000002'),\r\n        trackingCode: 'JT000245',\r\n        carrier: 'J&T Express',\r\n        service: 'G√≥i chu·∫©n',\r\n        deliveryStatus: 'ƒêang giao h√†ng',\r\n        printStatus: 'ƒê√£ in',\r\n        reconciliationStatus: 'Ch∆∞a ƒë·ªëi so√°t',\r\n        shippingFeeToPartner: 30000,\r\n        codAmount: 5000000,\r\n        payer: 'Ng∆∞·ªùi nh·∫≠n',\r\n        createdAt: '2025-11-03 16:00',\r\n        dispatchedAt: '2025-11-04 09:00',\r\n    },\r\n    // Th√™m d·ªØ li·ªáu m·∫´u m·ªõi\r\n    {\r\n        systemId: asSystemId('SHIPMENT000003'),\r\n        id: asBusinessId('VC000003'),\r\n        packagingSystemId: asSystemId('PACKAGE000005'),\r\n        orderSystemId: asSystemId('ORDER000005'),\r\n        orderId: asBusinessId('DH000005'),\r\n        trackingCode: 'GHTK123456',\r\n        carrier: 'GHTK',\r\n        service: 'Nhanh',\r\n        deliveryStatus: 'ƒê√£ giao h√†ng',\r\n        printStatus: 'ƒê√£ in',\r\n        reconciliationStatus: 'Ch∆∞a ƒë·ªëi so√°t',\r\n        shippingFeeToPartner: 35000,\r\n        codAmount: 12500000,\r\n        payer: 'Ng∆∞·ªùi nh·∫≠n',\r\n        createdAt: '2025-11-08 10:00',\r\n        dispatchedAt: '2025-11-08 14:00',\r\n        deliveredAt: '2025-11-10 11:30',\r\n    },\r\n    {\r\n        systemId: asSystemId('SHIPMENT000004'),\r\n        id: asBusinessId('VC000004'),\r\n        packagingSystemId: asSystemId('PACKAGE000006'),\r\n        orderSystemId: asSystemId('ORDER000006'),\r\n        orderId: asBusinessId('DH000006'),\r\n        trackingCode: 'VTP789012',\r\n        carrier: 'Viettel Post',\r\n        service: 'Ti√™u chu·∫©n',\r\n        deliveryStatus: 'ƒêang giao h√†ng',\r\n        printStatus: 'ƒê√£ in',\r\n        reconciliationStatus: 'Ch∆∞a ƒë·ªëi so√°t',\r\n        shippingFeeToPartner: 28000,\r\n        codAmount: 8900000,\r\n        payer: 'Ng∆∞·ªùi nh·∫≠n',\r\n        createdAt: '2025-11-09 09:15',\r\n        dispatchedAt: '2025-11-09 15:30',\r\n    },\r\n    {\r\n        systemId: asSystemId('SHIPMENT000005'),\r\n        id: asBusinessId('VC000005'),\r\n        packagingSystemId: asSystemId('PACKAGE000007'),\r\n        orderSystemId: asSystemId('ORDER000007'),\r\n        orderId: asBusinessId('DH000007'),\r\n        trackingCode: 'GHN345678',\r\n        carrier: 'GHN',\r\n        service: 'Express',\r\n        deliveryStatus: 'ƒê√£ giao h√†ng',\r\n        printStatus: 'ƒê√£ in',\r\n        reconciliationStatus: 'Ch∆∞a ƒë·ªëi so√°t',\r\n        shippingFeeToPartner: 45000,\r\n        codAmount: 23800000,\r\n        payer: 'Ng∆∞·ªùi nh·∫≠n',\r\n        createdAt: '2025-11-07 08:00',\r\n        dispatchedAt: '2025-11-07 10:00',\r\n        deliveredAt: '2025-11-08 09:30',\r\n    },\r\n    {\r\n        systemId: asSystemId('SHIPMENT000006'),\r\n        id: asBusinessId('VC000006'),\r\n        packagingSystemId: asSystemId('PACKAGE000008'),\r\n        orderSystemId: asSystemId('ORDER000008'),\r\n        orderId: asBusinessId('DH000008'),\r\n        trackingCode: 'BEST567890',\r\n        carrier: 'Best Express',\r\n        service: 'Ti·∫øt ki·ªám',\r\n        deliveryStatus: 'Ch·ªù l·∫•y h√†ng',\r\n        printStatus: 'ƒê√£ in',\r\n        reconciliationStatus: 'Ch∆∞a ƒë·ªëi so√°t',\r\n        shippingFeeToPartner: 22000,\r\n        codAmount: 4500000,\r\n        payer: 'Ng∆∞·ªùi nh·∫≠n',\r\n        createdAt: '2025-11-10 07:30',\r\n    },\r\n    {\r\n        systemId: asSystemId('SHIPMENT000007'),\r\n        id: asBusinessId('VC000007'),\r\n        packagingSystemId: asSystemId('PACKAGE000009'),\r\n        orderSystemId: asSystemId('ORDER000009'),\r\n        orderId: asBusinessId('DH000009'),\r\n        trackingCode: 'NJV901234',\r\n        carrier: 'Ninja Van',\r\n        service: 'Standard',\r\n        deliveryStatus: 'ƒê√£ giao h√†ng',\r\n        printStatus: 'ƒê√£ in',\r\n        reconciliationStatus: 'ƒê√£ ƒë·ªëi so√°t',\r\n        shippingFeeToPartner: 32000,\r\n        codAmount: 15600000,\r\n        payer: 'Ng∆∞·ªùi g·ª≠i',\r\n        createdAt: '2025-11-05 11:00',\r\n        dispatchedAt: '2025-11-05 16:00',\r\n        deliveredAt: '2025-11-07 14:30',\r\n    },\r\n    {\r\n        systemId: asSystemId('SHIPMENT000008'),\r\n        id: asBusinessId('VC000008'),\r\n        packagingSystemId: asSystemId('PACKAGE000010'),\r\n        orderSystemId: asSystemId('ORDER000010'),\r\n        orderId: asBusinessId('DH000010'),\r\n        trackingCode: 'JT567891',\r\n        carrier: 'J&T Express',\r\n        service: 'Si√™u t·ªëc',\r\n        deliveryStatus: 'ƒêang giao h√†ng',\r\n        printStatus: 'ƒê√£ in',\r\n        reconciliationStatus: 'Ch∆∞a ƒë·ªëi so√°t',\r\n        shippingFeeToPartner: 55000,\r\n        codAmount: 31200000,\r\n        payer: 'Ng∆∞·ªùi nh·∫≠n',\r\n        createdAt: '2025-11-10 14:00',\r\n        dispatchedAt: '2025-11-10 16:30',\r\n    },\r\n];\r\n\r\n// ========================================\r\n// STORE INTERFACE\r\n// ========================================\r\n\r\nexport interface ShipmentStoreState {\r\n    data: Shipment[];\r\n    \r\n    // CRUD\r\n    findById: (systemId: string) => Shipment | undefined;\r\n    findByPackagingSystemId: (packagingSystemId: string) => Shipment | undefined;\r\n    findByTrackingCode: (trackingCode: string) => Shipment | undefined;\r\n    \r\n    // Actions\r\n    createShipment: (data: Omit<Shipment, 'systemId' | 'id'>) => Shipment;\r\n    updateShipment: (systemId: SystemId, updates: Partial<Shipment>) => void;\r\n    deleteShipment: (systemId: SystemId) => void;\r\n    \r\n    // Counters\r\n    getNextSystemId: () => SystemId;\r\n    getNextBusinessId: () => BusinessId;\r\n}\r\n\r\n// ========================================\r\n// HELPER FUNCTIONS\r\n// ========================================\r\n\r\nlet shipmentSystemIdCounter = 0;\r\nlet shipmentBusinessIdCounter = 0;\r\n\r\nfunction initCounters(shipments: Shipment[]) {\r\n    shipmentSystemIdCounter = getMaxSystemIdCounter(shipments, SHIPMENT_SYSTEM_ID_PREFIX);\r\n    shipmentBusinessIdCounter = getMaxBusinessIdCounter(shipments, SHIPMENT_BUSINESS_ID_PREFIX);\r\n}\r\n\r\nfunction getNextShipmentSystemId(): SystemId {\r\n    shipmentSystemIdCounter++;\r\n    return generateSystemId('shipments', shipmentSystemIdCounter) as SystemId;\r\n}\r\n\r\nfunction getNextShipmentBusinessId(): BusinessId {\r\n    shipmentBusinessIdCounter++;\r\n    return generateBusinessId('shipments', shipmentBusinessIdCounter) as BusinessId;\r\n}\r\n\r\n// Initialize counters\r\ninitCounters(initialData);\r\n\r\n// ========================================\r\n// STORE CREATION\r\n// ========================================\r\n\r\nexport const useShipmentStore = create<ShipmentStoreState>()(\r\n    (set, get) => ({\r\n            data: initialData,\r\n            \r\n            findById: (systemId: string) => {\r\n                return get().data.find(s => s.systemId === systemId);\r\n            },\r\n            \r\n            findByPackagingSystemId: (packagingSystemId: string) => {\r\n                return get().data.find(s => s.packagingSystemId === packagingSystemId);\r\n            },\r\n            \r\n            findByTrackingCode: (trackingCode: string) => {\r\n                return get().data.find(s => s.trackingCode === trackingCode);\r\n            },\r\n            \r\n            createShipment: (data: Omit<Shipment, 'systemId' | 'id'>) => {\r\n                const newShipment: Shipment = {\r\n                    systemId: getNextShipmentSystemId(),\r\n                    id: getNextShipmentBusinessId(),\r\n                    ...data,\r\n                };\r\n                \r\n                set(state => ({\r\n                    data: [...state.data, newShipment]\r\n                }));\r\n                \r\n                return newShipment;\r\n            },\r\n            \r\n            updateShipment: (systemId: SystemId, updates: Partial<Shipment>) => {\r\n                set(state => ({\r\n                    data: state.data.map(s => \r\n                        s.systemId === systemId \r\n                            ? { ...s, ...updates }\r\n                            : s\r\n                    )\r\n                }));\r\n            },\r\n            \r\n            deleteShipment: (systemId: SystemId) => {\r\n                set(state => ({\r\n                    data: state.data.filter(s => s.systemId !== systemId)\r\n                }));\r\n            },\r\n            \r\n            getNextSystemId: () => getNextShipmentSystemId(),\r\n            getNextBusinessId: () => getNextShipmentBusinessId(),\r\n        })\r\n);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5556, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/shipments/api/shipments-api.ts"],"sourcesContent":["/**\r\n * Shipments API Layer\r\n * Handles all shipment-related API calls\r\n */\r\n\r\nimport type { Shipment } from '../types';\r\n\r\nexport interface ShipmentFilters {\r\n  page?: number;\r\n  limit?: number;\r\n  search?: string;\r\n  status?: string;\r\n  orderId?: string;\r\n  carrier?: string;\r\n  reconciliationStatus?: string;\r\n  fromDate?: string;\r\n  toDate?: string;\r\n}\r\n\r\nexport interface ShipmentResponse {\r\n  data: Shipment[];\r\n  pagination: {\r\n    page: number;\r\n    limit: number;\r\n    total: number;\r\n    totalPages: number;\r\n  };\r\n}\r\n\r\nexport interface ShipmentCreateInput {\r\n  systemId?: string;\r\n  id?: string;\r\n  packagingSystemId: string;\r\n  orderSystemId: string;\r\n  orderId: string;\r\n  trackingCode?: string;\r\n  carrier?: string;\r\n  service?: string;\r\n  deliveryStatus?: string;\r\n  printStatus?: string;\r\n  shippingFeeToPartner?: number;\r\n  codAmount?: number;\r\n  payer?: string;\r\n}\r\n\r\nexport interface ShipmentUpdateInput extends Partial<ShipmentCreateInput> {\r\n  reconciliationStatus?: string;\r\n  partnerStatus?: string;\r\n  dispatchedAt?: string;\r\n  deliveredAt?: string;\r\n}\r\n\r\nconst BASE_URL = '/api/shipments';\r\n\r\n/**\r\n * Fetch shipments with filters\r\n */\r\nexport async function fetchShipments(\r\n  filters: ShipmentFilters = {}\r\n): Promise<ShipmentResponse> {\r\n  const params = new URLSearchParams();\r\n  \r\n  if (filters.page) params.set('page', String(filters.page));\r\n  if (filters.limit) params.set('limit', String(filters.limit));\r\n  if (filters.search) params.set('search', filters.search);\r\n  if (filters.status) params.set('status', filters.status);\r\n  if (filters.orderId) params.set('orderId', filters.orderId);\r\n  if (filters.carrier) params.set('carrier', filters.carrier);\r\n  if (filters.reconciliationStatus) params.set('reconciliationStatus', filters.reconciliationStatus);\r\n  if (filters.fromDate) params.set('fromDate', filters.fromDate);\r\n  if (filters.toDate) params.set('toDate', filters.toDate);\r\n\r\n  const url = params.toString() ? `${BASE_URL}?${params}` : BASE_URL;\r\n  const response = await fetch(url);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error('Failed to fetch shipments');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\n/**\r\n * Fetch single shipment by ID\r\n */\r\nexport async function fetchShipmentById(\r\n  systemId: string\r\n): Promise<Shipment> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error('Failed to fetch shipment');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\n/**\r\n * Create new shipment\r\n */\r\nexport async function createShipment(\r\n  data: ShipmentCreateInput\r\n): Promise<Shipment> {\r\n  const response = await fetch(BASE_URL, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.error || 'Failed to create shipment');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\n/**\r\n * Update shipment\r\n */\r\nexport async function updateShipment(\r\n  systemId: string,\r\n  data: ShipmentUpdateInput\r\n): Promise<Shipment> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`, {\r\n    method: 'PATCH',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.error || 'Failed to update shipment');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\n/**\r\n * Delete shipment\r\n */\r\nexport async function deleteShipment(systemId: string): Promise<void> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`, {\r\n    method: 'DELETE',\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    throw new Error('Failed to delete shipment');\r\n  }\r\n}\r\n\r\n/**\r\n * Update delivery status\r\n */\r\nexport async function updateDeliveryStatus(\r\n  systemId: string,\r\n  status: string,\r\n  timestamp?: string\r\n): Promise<Shipment> {\r\n  return updateShipment(systemId, {\r\n    deliveryStatus: status,\r\n    ...(status === 'ƒê√£ giao h√†ng' && { deliveredAt: timestamp || new Date().toISOString() }),\r\n    ...(status === 'ƒêang giao h√†ng' && { dispatchedAt: timestamp || new Date().toISOString() }),\r\n  });\r\n}\r\n\r\n/**\r\n * Mark shipment as reconciled\r\n */\r\nexport async function reconcileShipment(\r\n  systemId: string\r\n): Promise<Shipment> {\r\n  return updateShipment(systemId, {\r\n    reconciliationStatus: 'ƒê√£ ƒë·ªëi so√°t',\r\n  });\r\n}\r\n\r\n/**\r\n * Bulk reconcile shipments\r\n */\r\nexport async function bulkReconcileShipments(\r\n  systemIds: string[]\r\n): Promise<{ success: number; failed: number }> {\r\n  const response = await fetch(`${BASE_URL}/bulk-reconcile`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ systemIds }),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    throw new Error('Failed to bulk reconcile shipments');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\n/**\r\n * Update tracking info from carrier\r\n */\r\nexport async function syncTrackingInfo(\r\n  systemId: string\r\n): Promise<Shipment> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}/sync-tracking`, {\r\n    method: 'POST',\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    throw new Error('Failed to sync tracking info');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\n/**\r\n * Print shipping label\r\n */\r\nexport async function printShippingLabel(\r\n  systemIds: string[]\r\n): Promise<{ url: string }> {\r\n  const response = await fetch(`${BASE_URL}/print-labels`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ systemIds }),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    throw new Error('Failed to generate shipping labels');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;;;;;;;;;;;;;;;AAiDD,MAAM,WAAW;AAKV,eAAe,eACpB,UAA2B,CAAC,CAAC;IAE7B,MAAM,SAAS,IAAI;IAEnB,IAAI,QAAQ,IAAI,EAAE,OAAO,GAAG,CAAC,QAAQ,OAAO,QAAQ,IAAI;IACxD,IAAI,QAAQ,KAAK,EAAE,OAAO,GAAG,CAAC,SAAS,OAAO,QAAQ,KAAK;IAC3D,IAAI,QAAQ,MAAM,EAAE,OAAO,GAAG,CAAC,UAAU,QAAQ,MAAM;IACvD,IAAI,QAAQ,MAAM,EAAE,OAAO,GAAG,CAAC,UAAU,QAAQ,MAAM;IACvD,IAAI,QAAQ,OAAO,EAAE,OAAO,GAAG,CAAC,WAAW,QAAQ,OAAO;IAC1D,IAAI,QAAQ,OAAO,EAAE,OAAO,GAAG,CAAC,WAAW,QAAQ,OAAO;IAC1D,IAAI,QAAQ,oBAAoB,EAAE,OAAO,GAAG,CAAC,wBAAwB,QAAQ,oBAAoB;IACjG,IAAI,QAAQ,QAAQ,EAAE,OAAO,GAAG,CAAC,YAAY,QAAQ,QAAQ;IAC7D,IAAI,QAAQ,MAAM,EAAE,OAAO,GAAG,CAAC,UAAU,QAAQ,MAAM;IAEvD,MAAM,MAAM,OAAO,QAAQ,KAAK,GAAG,SAAS,CAAC,EAAE,QAAQ,GAAG;IAC1D,MAAM,WAAW,MAAM,MAAM;IAE7B,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,SAAS,IAAI;AACtB;AAKO,eAAe,kBACpB,QAAgB;IAEhB,MAAM,WAAW,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,UAAU;IAEtD,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,SAAS,IAAI;AACtB;AAKO,eAAe,eACpB,IAAyB;IAEzB,MAAM,WAAW,MAAM,MAAM,UAAU;QACrC,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,QAAQ,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QACnD,MAAM,IAAI,MAAM,MAAM,KAAK,IAAI;IACjC;IAEA,OAAO,SAAS,IAAI;AACtB;AAKO,eAAe,eACpB,QAAgB,EAChB,IAAyB;IAEzB,MAAM,WAAW,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,UAAU,EAAE;QACtD,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,QAAQ,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QACnD,MAAM,IAAI,MAAM,MAAM,KAAK,IAAI;IACjC;IAEA,OAAO,SAAS,IAAI;AACtB;AAKO,eAAe,eAAe,QAAgB;IACnD,MAAM,WAAW,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,UAAU,EAAE;QACtD,QAAQ;IACV;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM;IAClB;AACF;AAKO,eAAe,qBACpB,QAAgB,EAChB,MAAc,EACd,SAAkB;IAElB,OAAO,eAAe,UAAU;QAC9B,gBAAgB;QAChB,GAAI,WAAW,kBAAkB;YAAE,aAAa,aAAa,IAAI,OAAO,WAAW;QAAG,CAAC;QACvF,GAAI,WAAW,oBAAoB;YAAE,cAAc,aAAa,IAAI,OAAO,WAAW;QAAG,CAAC;IAC5F;AACF;AAKO,eAAe,kBACpB,QAAgB;IAEhB,OAAO,eAAe,UAAU;QAC9B,sBAAsB;IACxB;AACF;AAKO,eAAe,uBACpB,SAAmB;IAEnB,MAAM,WAAW,MAAM,MAAM,GAAG,SAAS,eAAe,CAAC,EAAE;QACzD,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;YAAE;QAAU;IACnC;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,SAAS,IAAI;AACtB;AAKO,eAAe,iBACpB,QAAgB;IAEhB,MAAM,WAAW,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,SAAS,cAAc,CAAC,EAAE;QACpE,QAAQ;IACV;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,SAAS,IAAI;AACtB;AAKO,eAAe,mBACpB,SAAmB;IAEnB,MAAM,WAAW,MAAM,MAAM,GAAG,SAAS,aAAa,CAAC,EAAE;QACvD,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;YAAE;QAAU;IACnC;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO,SAAS,IAAI;AACtB"}},
    {"offset": {"line": 5705, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/shipments/hooks/use-shipments.ts"],"sourcesContent":["/**\r\n * Shipments React Query Hooks\r\n * Provides data fetching and mutations for shipment management\r\n */\r\n\r\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\r\nimport {\r\n  fetchShipments,\r\n  fetchShipmentById,\r\n  createShipment,\r\n  updateShipment,\r\n  deleteShipment,\r\n  updateDeliveryStatus,\r\n  reconcileShipment,\r\n  bulkReconcileShipments,\r\n  syncTrackingInfo,\r\n  printShippingLabel,\r\n  type ShipmentFilters,\r\n  type ShipmentCreateInput,\r\n  type ShipmentUpdateInput,\r\n} from '../api/shipments-api';\r\n\r\n// Query keys factory\r\nexport const shipmentKeys = {\r\n  all: ['shipments'] as const,\r\n  lists: () => [...shipmentKeys.all, 'list'] as const,\r\n  list: (filters: ShipmentFilters) => [...shipmentKeys.lists(), filters] as const,\r\n  details: () => [...shipmentKeys.all, 'detail'] as const,\r\n  detail: (id: string) => [...shipmentKeys.details(), id] as const,\r\n  byOrder: (orderId: string) => [...shipmentKeys.all, 'order', orderId] as const,\r\n};\r\n\r\n/**\r\n * Hook to fetch shipments with filters\r\n */\r\nexport function useShipments(filters: ShipmentFilters = {}) {\r\n  return useQuery({\r\n    queryKey: shipmentKeys.list(filters),\r\n    queryFn: () => fetchShipments(filters),\r\n    staleTime: 1000 * 60, // 1 minute - shipments change frequently\r\n  });\r\n}\r\n\r\n/**\r\n * Hook to fetch single shipment\r\n */\r\nexport function useShipmentById(systemId: string | undefined) {\r\n  return useQuery({\r\n    queryKey: shipmentKeys.detail(systemId!),\r\n    queryFn: () => fetchShipmentById(systemId!),\r\n    enabled: !!systemId,\r\n    staleTime: 1000 * 30, // 30 seconds\r\n  });\r\n}\r\n\r\n/**\r\n * Hook to fetch shipments for a specific order\r\n */\r\nexport function useShipmentsByOrder(orderId: string | undefined) {\r\n  return useQuery({\r\n    queryKey: shipmentKeys.byOrder(orderId!),\r\n    queryFn: () => fetchShipments({ orderId: orderId!, limit: 50 }),\r\n    enabled: !!orderId,\r\n    staleTime: 1000 * 60,\r\n  });\r\n}\r\n\r\ninterface MutationCallbacks {\r\n  onSuccess?: () => void;\r\n  onError?: (error: Error) => void;\r\n}\r\n\r\n/**\r\n * Hook providing shipment mutations\r\n */\r\nexport function useShipmentMutations(options: MutationCallbacks = {}) {\r\n  const queryClient = useQueryClient();\r\n\r\n  const invalidateShipments = () => {\r\n    queryClient.invalidateQueries({ queryKey: shipmentKeys.all });\r\n  };\r\n\r\n  const create = useMutation({\r\n    mutationFn: (data: ShipmentCreateInput) => createShipment(data),\r\n    onSuccess: () => {\r\n      invalidateShipments();\r\n      options.onSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n\r\n  const update = useMutation({\r\n    mutationFn: ({ systemId, data }: { systemId: string; data: ShipmentUpdateInput }) =>\r\n      updateShipment(systemId, data),\r\n    onSuccess: () => {\r\n      invalidateShipments();\r\n      options.onSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n\r\n  const remove = useMutation({\r\n    mutationFn: (systemId: string) => deleteShipment(systemId),\r\n    onSuccess: () => {\r\n      invalidateShipments();\r\n      options.onSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n\r\n  const updateStatus = useMutation({\r\n    mutationFn: ({ systemId, status, timestamp }: { \r\n      systemId: string; \r\n      status: string; \r\n      timestamp?: string;\r\n    }) => updateDeliveryStatus(systemId, status, timestamp),\r\n    onSuccess: () => {\r\n      invalidateShipments();\r\n      options.onSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n\r\n  const reconcile = useMutation({\r\n    mutationFn: (systemId: string) => reconcileShipment(systemId),\r\n    onSuccess: () => {\r\n      invalidateShipments();\r\n      options.onSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n\r\n  const bulkReconcile = useMutation({\r\n    mutationFn: (systemIds: string[]) => bulkReconcileShipments(systemIds),\r\n    onSuccess: () => {\r\n      invalidateShipments();\r\n      options.onSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n\r\n  const syncTracking = useMutation({\r\n    mutationFn: (systemId: string) => syncTrackingInfo(systemId),\r\n    onSuccess: () => {\r\n      invalidateShipments();\r\n      options.onSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n\r\n  const printLabels = useMutation({\r\n    mutationFn: (systemIds: string[]) => printShippingLabel(systemIds),\r\n    onError: options.onError,\r\n  });\r\n\r\n  return {\r\n    create,\r\n    update,\r\n    remove,\r\n    updateStatus,\r\n    reconcile,\r\n    bulkReconcile,\r\n    syncTracking,\r\n    printLabels,\r\n    isLoading:\r\n      create.isPending ||\r\n      update.isPending ||\r\n      remove.isPending ||\r\n      updateStatus.isPending ||\r\n      reconcile.isPending ||\r\n      bulkReconcile.isPending ||\r\n      syncTracking.isPending,\r\n  };\r\n}\r\n\r\n/**\r\n * Hook to fetch pending shipments (not reconciled)\r\n */\r\nexport function usePendingShipments() {\r\n  return useShipments({ reconciliationStatus: 'Ch∆∞a ƒë·ªëi so√°t' });\r\n}\r\n\r\n/**\r\n * Hook to fetch shipments in transit\r\n */\r\nexport function useShipmentsInTransit() {\r\n  return useShipments({ status: 'ƒêang giao h√†ng' });\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5959, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/shipments/hooks/use-all-shipments.ts"],"sourcesContent":["/**\r\n * useAllShipments - Convenience hook for components needing all shipments as flat array\r\n */\r\n\r\nimport { useShipments } from './use-shipments';\r\n\r\nexport function useAllShipments() {\r\n  const query = useShipments({});\r\n  \r\n  return {\r\n    data: query.data?.data || [],\r\n    isLoading: query.isLoading,\r\n    isError: query.isError,\r\n    error: query.error,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;CAEC,GAED;;;AAEO,SAAS;;IACd,MAAM,QAAQ,IAAA,qKAAY,EAAC,CAAC;IAE5B,OAAO;QACL,MAAM,MAAM,IAAI,EAAE,QAAQ,EAAE;QAC5B,WAAW,MAAM,SAAS;QAC1B,SAAS,MAAM,OAAO;QACtB,OAAO,MAAM,KAAK;IACpB;AACF;GATgB;;QACA,qKAAY"}},
    {"offset": {"line": 5990, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/warranty/api/warranties-api.ts"],"sourcesContent":["/**\r\n * Warranty API - Isolated API functions\r\n */\r\n\r\nimport type { WarrantyTicket } from '../types';\r\n\r\nconst API_BASE = '/api/warranties';\r\n\r\nexport interface WarrantiesParams {\r\n  page?: number;\r\n  limit?: number;\r\n  search?: string;\r\n  status?: string;\r\n  customerId?: string;\r\n  branchId?: string;\r\n  startDate?: string;\r\n  endDate?: string;\r\n  sortBy?: string;\r\n  sortOrder?: 'asc' | 'desc';\r\n}\r\n\r\nexport interface PaginatedResponse<T> {\r\n  data: T[];\r\n  pagination: {\r\n    page: number;\r\n    limit: number;\r\n    total: number;\r\n    totalPages: number;\r\n  };\r\n}\r\n\r\nexport async function fetchWarranties(params: WarrantiesParams = {}): Promise<PaginatedResponse<WarrantyTicket>> {\r\n  const { page = 1, limit = 50, ...rest } = params;\r\n  \r\n  const searchParams = new URLSearchParams({\r\n    page: String(page),\r\n    limit: String(limit),\r\n  });\r\n  \r\n  Object.entries(rest).forEach(([key, value]) => {\r\n    if (value != null && value !== '') {\r\n      searchParams.set(key, String(value));\r\n    }\r\n  });\r\n  \r\n  const res = await fetch(`${API_BASE}?${searchParams}`, { credentials: 'include' });\r\n  if (!res.ok) throw new Error(`Failed to fetch warranties: ${res.statusText}`);\r\n  return res.json();\r\n}\r\n\r\nexport async function fetchWarranty(id: string): Promise<WarrantyTicket> {\r\n  const res = await fetch(`${API_BASE}/${id}`, { credentials: 'include' });\r\n  if (!res.ok) throw new Error(`Failed to fetch warranty: ${res.statusText}`);\r\n  return res.json();\r\n}\r\n\r\nexport async function createWarranty(data: Partial<WarrantyTicket>): Promise<WarrantyTicket> {\r\n  const res = await fetch(API_BASE, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    credentials: 'include',\r\n    body: JSON.stringify(data),\r\n  });\r\n  if (!res.ok) {\r\n    const error = await res.json().catch(() => ({}));\r\n    throw new Error(error.message || `Failed to create warranty`);\r\n  }\r\n  return res.json();\r\n}\r\n\r\nexport async function updateWarranty(systemId: string, data: Partial<WarrantyTicket>): Promise<WarrantyTicket> {\r\n  const res = await fetch(`${API_BASE}/${systemId}`, {\r\n    method: 'PATCH',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    credentials: 'include',\r\n    body: JSON.stringify(data),\r\n  });\r\n  if (!res.ok) {\r\n    const error = await res.json().catch(() => ({}));\r\n    throw new Error(error.message || `Failed to update warranty`);\r\n  }\r\n  return res.json();\r\n}\r\n\r\nexport async function deleteWarranty(id: string): Promise<void> {\r\n  const res = await fetch(`${API_BASE}/${id}`, { method: 'DELETE', credentials: 'include' });\r\n  if (!res.ok) throw new Error(`Failed to delete warranty`);\r\n}\r\n\r\nexport async function fetchWarrantyStats(): Promise<{\r\n  total: number;\r\n  pending: number;\r\n  processed: number;\r\n  completed: number;\r\n}> {\r\n  const res = await fetch(`${API_BASE}/stats`, { credentials: 'include' });\r\n  if (!res.ok) throw new Error(`Failed to fetch warranty stats`);\r\n  return res.json();\r\n}\r\n"],"names":[],"mappings":"AAAA;;CAEC;;;;;;;;;;;;;;AAID,MAAM,WAAW;AAyBV,eAAe,gBAAgB,SAA2B,CAAC,CAAC;IACjE,MAAM,EAAE,OAAO,CAAC,EAAE,QAAQ,EAAE,EAAE,GAAG,MAAM,GAAG;IAE1C,MAAM,eAAe,IAAI,gBAAgB;QACvC,MAAM,OAAO;QACb,OAAO,OAAO;IAChB;IAEA,OAAO,OAAO,CAAC,MAAM,OAAO,CAAC,CAAC,CAAC,KAAK,MAAM;QACxC,IAAI,SAAS,QAAQ,UAAU,IAAI;YACjC,aAAa,GAAG,CAAC,KAAK,OAAO;QAC/B;IACF;IAEA,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,cAAc,EAAE;QAAE,aAAa;IAAU;IAChF,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,4BAA4B,EAAE,IAAI,UAAU,EAAE;IAC5E,OAAO,IAAI,IAAI;AACjB;AAEO,eAAe,cAAc,EAAU;IAC5C,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,IAAI,EAAE;QAAE,aAAa;IAAU;IACtE,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,0BAA0B,EAAE,IAAI,UAAU,EAAE;IAC1E,OAAO,IAAI,IAAI;AACjB;AAEO,eAAe,eAAe,IAA6B;IAChE,MAAM,MAAM,MAAM,MAAM,UAAU;QAChC,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,aAAa;QACb,MAAM,KAAK,SAAS,CAAC;IACvB;IACA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,QAAQ,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAC9C,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI,CAAC,yBAAyB,CAAC;IAC9D;IACA,OAAO,IAAI,IAAI;AACjB;AAEO,eAAe,eAAe,QAAgB,EAAE,IAA6B;IAClF,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,UAAU,EAAE;QACjD,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,aAAa;QACb,MAAM,KAAK,SAAS,CAAC;IACvB;IACA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,QAAQ,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAC9C,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI,CAAC,yBAAyB,CAAC;IAC9D;IACA,OAAO,IAAI,IAAI;AACjB;AAEO,eAAe,eAAe,EAAU;IAC7C,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,IAAI,EAAE;QAAE,QAAQ;QAAU,aAAa;IAAU;IACxF,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,yBAAyB,CAAC;AAC1D;AAEO,eAAe;IAMpB,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,MAAM,CAAC,EAAE;QAAE,aAAa;IAAU;IACtE,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,8BAA8B,CAAC;IAC7D,OAAO,IAAI,IAAI;AACjB"}},
    {"offset": {"line": 6082, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/warranty/hooks/use-warranties.ts"],"sourcesContent":["/**\r\n * useWarranties - React Query hooks\r\n * \r\n * ‚ö†Ô∏è Direct import: import { useWarranties } from '@/features/warranty/hooks/use-warranties'\r\n */\r\n\r\nimport { useQuery, useMutation, useQueryClient, keepPreviousData } from '@tanstack/react-query';\r\nimport {\r\n  fetchWarranties,\r\n  fetchWarranty,\r\n  createWarranty,\r\n  updateWarranty,\r\n  deleteWarranty,\r\n  fetchWarrantyStats,\r\n  type WarrantiesParams,\r\n} from '../api/warranties-api';\r\nimport type { WarrantyTicket } from '../types';\r\n\r\nexport const warrantyKeys = {\r\n  all: ['warranties'] as const,\r\n  lists: () => [...warrantyKeys.all, 'list'] as const,\r\n  list: (params: WarrantiesParams) => [...warrantyKeys.lists(), params] as const,\r\n  details: () => [...warrantyKeys.all, 'detail'] as const,\r\n  detail: (id: string) => [...warrantyKeys.details(), id] as const,\r\n  stats: () => [...warrantyKeys.all, 'stats'] as const,\r\n};\r\n\r\nexport function useWarranties(params: WarrantiesParams = {}) {\r\n  return useQuery({\r\n    queryKey: warrantyKeys.list(params),\r\n    queryFn: () => fetchWarranties(params),\r\n    staleTime: 30_000,\r\n    gcTime: 5 * 60 * 1000,\r\n    placeholderData: keepPreviousData,\r\n  });\r\n}\r\n\r\nexport function useWarranty(id: string | null | undefined) {\r\n  return useQuery({\r\n    queryKey: warrantyKeys.detail(id!),\r\n    queryFn: () => fetchWarranty(id!),\r\n    enabled: !!id,\r\n    staleTime: 60_000,\r\n  });\r\n}\r\n\r\nexport function useWarrantyStats() {\r\n  return useQuery({\r\n    queryKey: warrantyKeys.stats(),\r\n    queryFn: fetchWarrantyStats,\r\n    staleTime: 60_000,\r\n  });\r\n}\r\n\r\ninterface UseWarrantyMutationsOptions {\r\n  onCreateSuccess?: (warranty: WarrantyTicket) => void;\r\n  onUpdateSuccess?: (warranty: WarrantyTicket) => void;\r\n  onDeleteSuccess?: () => void;\r\n  onError?: (error: Error) => void;\r\n}\r\n\r\nexport function useWarrantyMutations(options: UseWarrantyMutationsOptions = {}) {\r\n  const queryClient = useQueryClient();\r\n  \r\n  const create = useMutation({\r\n    mutationFn: createWarranty,\r\n    onSuccess: (data) => {\r\n      queryClient.invalidateQueries({ queryKey: warrantyKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: warrantyKeys.stats() });\r\n      options.onCreateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const update = useMutation({\r\n    mutationFn: ({ systemId, data }: { systemId: string; data: Partial<WarrantyTicket> }) => \r\n      updateWarranty(systemId, data),\r\n    onSuccess: (data, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: warrantyKeys.detail(variables.systemId) });\r\n      queryClient.invalidateQueries({ queryKey: warrantyKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: warrantyKeys.stats() });\r\n      options.onUpdateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const remove = useMutation({\r\n    mutationFn: deleteWarranty,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: warrantyKeys.all });\r\n      options.onDeleteSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  return { create, update, remove };\r\n}\r\n\r\nexport function usePendingWarranties() {\r\n  return useWarranties({ status: 'pending' });\r\n}\r\n\r\nexport function useWarrantiesByCustomer(customerId: string | null | undefined) {\r\n  return useWarranties({ customerId: customerId || undefined, limit: 50 });\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;;;CAIC,GAED;AAAA;AAAA;AAAA;AACA;;;;AAWO,MAAM,eAAe;IAC1B,KAAK;QAAC;KAAa;IACnB,OAAO,IAAM;eAAI,aAAa,GAAG;YAAE;SAAO;IAC1C,MAAM,CAAC,SAA6B;eAAI,aAAa,KAAK;YAAI;SAAO;IACrE,SAAS,IAAM;eAAI,aAAa,GAAG;YAAE;SAAS;IAC9C,QAAQ,CAAC,KAAe;eAAI,aAAa,OAAO;YAAI;SAAG;IACvD,OAAO,IAAM;eAAI,aAAa,GAAG;YAAE;SAAQ;AAC7C;AAEO,SAAS,cAAc,SAA2B,CAAC,CAAC;;IACzD,OAAO,IAAA,0LAAQ,EAAC;QACd,UAAU,aAAa,IAAI,CAAC;QAC5B,OAAO;sCAAE,IAAM,IAAA,sKAAe,EAAC;;QAC/B,WAAW;QACX,QAAQ,IAAI,KAAK;QACjB,iBAAiB,8LAAgB;IACnC;AACF;GARgB;;QACP,0LAAQ;;;AASV,SAAS,YAAY,EAA6B;;IACvD,OAAO,IAAA,0LAAQ,EAAC;QACd,UAAU,aAAa,MAAM,CAAC;QAC9B,OAAO;oCAAE,IAAM,IAAA,oKAAa,EAAC;;QAC7B,SAAS,CAAC,CAAC;QACX,WAAW;IACb;AACF;IAPgB;;QACP,0LAAQ;;;AAQV,SAAS;;IACd,OAAO,IAAA,0LAAQ,EAAC;QACd,UAAU,aAAa,KAAK;QAC5B,SAAS,yKAAkB;QAC3B,WAAW;IACb;AACF;IANgB;;QACP,0LAAQ;;;AAcV,SAAS,qBAAqB,UAAuC,CAAC,CAAC;;IAC5E,MAAM,cAAc,IAAA,2MAAc;IAElC,MAAM,SAAS,IAAA,gMAAW,EAAC;QACzB,YAAY,qKAAc;QAC1B,SAAS;wDAAE,CAAC;gBACV,YAAY,iBAAiB,CAAC;oBAAE,UAAU,aAAa,KAAK;gBAAG;gBAC/D,YAAY,iBAAiB,CAAC;oBAAE,UAAU,aAAa,KAAK;gBAAG;gBAC/D,QAAQ,eAAe,GAAG;YAC5B;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,SAAS,IAAA,gMAAW,EAAC;QACzB,UAAU;wDAAE,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAuD,GAClF,IAAA,qKAAc,EAAC,UAAU;;QAC3B,SAAS;wDAAE,CAAC,MAAM;gBAChB,YAAY,iBAAiB,CAAC;oBAAE,UAAU,aAAa,MAAM,CAAC,UAAU,QAAQ;gBAAE;gBAClF,YAAY,iBAAiB,CAAC;oBAAE,UAAU,aAAa,KAAK;gBAAG;gBAC/D,YAAY,iBAAiB,CAAC;oBAAE,UAAU,aAAa,KAAK;gBAAG;gBAC/D,QAAQ,eAAe,GAAG;YAC5B;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,SAAS,IAAA,gMAAW,EAAC;QACzB,YAAY,qKAAc;QAC1B,SAAS;wDAAE;gBACT,YAAY,iBAAiB,CAAC;oBAAE,UAAU,aAAa,GAAG;gBAAC;gBAC3D,QAAQ,eAAe;YACzB;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,OAAO;QAAE;QAAQ;QAAQ;IAAO;AAClC;IAnCgB;;QACM,2MAAc;QAEnB,gMAAW;QAUX,gMAAW;QAYX,gMAAW;;;AAYrB,SAAS;;IACd,OAAO,cAAc;QAAE,QAAQ;IAAU;AAC3C;IAFgB;;QACP;;;AAGF,SAAS,wBAAwB,UAAqC;;IAC3E,OAAO,cAAc;QAAE,YAAY,cAAc;QAAW,OAAO;IAAG;AACxE;IAFgB;;QACP"}},
    {"offset": {"line": 6275, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/warranty/hooks/use-all-warranties.ts"],"sourcesContent":["/**\r\n * useAllWarranties - Convenience hook for components needing all warranties as flat array\r\n */\r\n\r\nimport { useWarranties } from './use-warranties';\r\n\r\nexport function useAllWarranties() {\r\n  const query = useWarranties({});\r\n  \r\n  return {\r\n    data: query.data?.data || [],\r\n    isLoading: query.isLoading,\r\n    isError: query.isError,\r\n    error: query.error,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;CAEC,GAED;;;AAEO,SAAS;;IACd,MAAM,QAAQ,IAAA,sKAAa,EAAC,CAAC;IAE7B,OAAO;QACL,MAAM,MAAM,IAAI,EAAE,QAAQ,EAAE;QAC5B,WAAW,MAAM,SAAS;QAC1B,SAAS,MAAM,OAAO;QACtB,OAAO,MAAM,KAAK;IACpB;AACF;GATgB;;QACA,sKAAa"}},
    {"offset": {"line": 6306, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/complaints/api/complaints-api.ts"],"sourcesContent":["/**\r\n * Complaints API - Isolated API functions\r\n */\r\n\r\nimport type { Complaint } from '../types';\r\n\r\nconst API_BASE = '/api/complaints';\r\n\r\nexport interface ComplaintsParams {\r\n  page?: number;\r\n  limit?: number;\r\n  search?: string;\r\n  status?: string;\r\n  customerId?: string;\r\n  orderId?: string;\r\n  startDate?: string;\r\n  endDate?: string;\r\n  sortBy?: string;\r\n  sortOrder?: 'asc' | 'desc';\r\n}\r\n\r\nexport interface PaginatedResponse<T> {\r\n  data: T[];\r\n  pagination: {\r\n    page: number;\r\n    limit: number;\r\n    total: number;\r\n    totalPages: number;\r\n  };\r\n}\r\n\r\nexport async function fetchComplaints(params: ComplaintsParams = {}): Promise<PaginatedResponse<Complaint>> {\r\n  const { page = 1, limit = 50, ...rest } = params;\r\n  \r\n  const searchParams = new URLSearchParams({\r\n    page: String(page),\r\n    limit: String(limit),\r\n  });\r\n  \r\n  Object.entries(rest).forEach(([key, value]) => {\r\n    if (value != null && value !== '') {\r\n      searchParams.set(key, String(value));\r\n    }\r\n  });\r\n  \r\n  const res = await fetch(`${API_BASE}?${searchParams}`, { credentials: 'include' });\r\n  if (!res.ok) throw new Error(`Failed to fetch complaints: ${res.statusText}`);\r\n  return res.json();\r\n}\r\n\r\nexport async function fetchComplaint(id: string): Promise<Complaint> {\r\n  const res = await fetch(`${API_BASE}/${id}`, { credentials: 'include' });\r\n  if (!res.ok) throw new Error(`Failed to fetch complaint: ${res.statusText}`);\r\n  return res.json();\r\n}\r\n\r\nexport async function createComplaint(data: Partial<Complaint>): Promise<Complaint> {\r\n  const res = await fetch(API_BASE, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    credentials: 'include',\r\n    body: JSON.stringify(data),\r\n  });\r\n  if (!res.ok) {\r\n    const error = await res.json().catch(() => ({}));\r\n    throw new Error(error.message || `Failed to create complaint`);\r\n  }\r\n  return res.json();\r\n}\r\n\r\nexport async function updateComplaint(systemId: string, data: Partial<Complaint>): Promise<Complaint> {\r\n  const res = await fetch(`${API_BASE}/${systemId}`, {\r\n    method: 'PATCH',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    credentials: 'include',\r\n    body: JSON.stringify(data),\r\n  });\r\n  if (!res.ok) {\r\n    const error = await res.json().catch(() => ({}));\r\n    throw new Error(error.message || `Failed to update complaint`);\r\n  }\r\n  return res.json();\r\n}\r\n\r\nexport async function deleteComplaint(id: string): Promise<void> {\r\n  const res = await fetch(`${API_BASE}/${id}`, { method: 'DELETE', credentials: 'include' });\r\n  if (!res.ok) throw new Error(`Failed to delete complaint`);\r\n}\r\n\r\nexport async function fetchComplaintStats(): Promise<{\r\n  total: number;\r\n  pending: number;\r\n  inProgress: number;\r\n  resolved: number;\r\n}> {\r\n  const res = await fetch(`${API_BASE}/stats`, { credentials: 'include' });\r\n  if (!res.ok) throw new Error(`Failed to fetch complaint stats`);\r\n  return res.json();\r\n}\r\n"],"names":[],"mappings":"AAAA;;CAEC;;;;;;;;;;;;;;AAID,MAAM,WAAW;AAyBV,eAAe,gBAAgB,SAA2B,CAAC,CAAC;IACjE,MAAM,EAAE,OAAO,CAAC,EAAE,QAAQ,EAAE,EAAE,GAAG,MAAM,GAAG;IAE1C,MAAM,eAAe,IAAI,gBAAgB;QACvC,MAAM,OAAO;QACb,OAAO,OAAO;IAChB;IAEA,OAAO,OAAO,CAAC,MAAM,OAAO,CAAC,CAAC,CAAC,KAAK,MAAM;QACxC,IAAI,SAAS,QAAQ,UAAU,IAAI;YACjC,aAAa,GAAG,CAAC,KAAK,OAAO;QAC/B;IACF;IAEA,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,cAAc,EAAE;QAAE,aAAa;IAAU;IAChF,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,4BAA4B,EAAE,IAAI,UAAU,EAAE;IAC5E,OAAO,IAAI,IAAI;AACjB;AAEO,eAAe,eAAe,EAAU;IAC7C,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,IAAI,EAAE;QAAE,aAAa;IAAU;IACtE,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,2BAA2B,EAAE,IAAI,UAAU,EAAE;IAC3E,OAAO,IAAI,IAAI;AACjB;AAEO,eAAe,gBAAgB,IAAwB;IAC5D,MAAM,MAAM,MAAM,MAAM,UAAU;QAChC,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,aAAa;QACb,MAAM,KAAK,SAAS,CAAC;IACvB;IACA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,QAAQ,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAC9C,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI,CAAC,0BAA0B,CAAC;IAC/D;IACA,OAAO,IAAI,IAAI;AACjB;AAEO,eAAe,gBAAgB,QAAgB,EAAE,IAAwB;IAC9E,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,UAAU,EAAE;QACjD,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,aAAa;QACb,MAAM,KAAK,SAAS,CAAC;IACvB;IACA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,QAAQ,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAC9C,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI,CAAC,0BAA0B,CAAC;IAC/D;IACA,OAAO,IAAI,IAAI;AACjB;AAEO,eAAe,gBAAgB,EAAU;IAC9C,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,IAAI,EAAE;QAAE,QAAQ;QAAU,aAAa;IAAU;IACxF,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,0BAA0B,CAAC;AAC3D;AAEO,eAAe;IAMpB,MAAM,MAAM,MAAM,MAAM,GAAG,SAAS,MAAM,CAAC,EAAE;QAAE,aAAa;IAAU;IACtE,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM,CAAC,+BAA+B,CAAC;IAC9D,OAAO,IAAI,IAAI;AACjB"}},
    {"offset": {"line": 6398, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/complaints/hooks/use-complaints.ts"],"sourcesContent":["/**\r\n * useComplaints - React Query hooks\r\n * \r\n * ‚ö†Ô∏è Direct import: import { useComplaints } from '@/features/complaints/hooks/use-complaints'\r\n */\r\n\r\nimport { useQuery, useMutation, useQueryClient, keepPreviousData } from '@tanstack/react-query';\r\nimport {\r\n  fetchComplaints,\r\n  fetchComplaint,\r\n  createComplaint,\r\n  updateComplaint,\r\n  deleteComplaint,\r\n  fetchComplaintStats,\r\n  type ComplaintsParams,\r\n} from '../api/complaints-api';\r\nimport type { Complaint } from '../types';\r\n\r\nexport const complaintKeys = {\r\n  all: ['complaints'] as const,\r\n  lists: () => [...complaintKeys.all, 'list'] as const,\r\n  list: (params: ComplaintsParams) => [...complaintKeys.lists(), params] as const,\r\n  details: () => [...complaintKeys.all, 'detail'] as const,\r\n  detail: (id: string) => [...complaintKeys.details(), id] as const,\r\n  stats: () => [...complaintKeys.all, 'stats'] as const,\r\n};\r\n\r\nexport function useComplaints(params: ComplaintsParams = {}) {\r\n  return useQuery({\r\n    queryKey: complaintKeys.list(params),\r\n    queryFn: () => fetchComplaints(params),\r\n    staleTime: 30_000,\r\n    gcTime: 5 * 60 * 1000,\r\n    placeholderData: keepPreviousData,\r\n  });\r\n}\r\n\r\nexport function useComplaint(id: string | null | undefined) {\r\n  return useQuery({\r\n    queryKey: complaintKeys.detail(id!),\r\n    queryFn: () => fetchComplaint(id!),\r\n    enabled: !!id,\r\n    staleTime: 60_000,\r\n  });\r\n}\r\n\r\nexport function useComplaintStats() {\r\n  return useQuery({\r\n    queryKey: complaintKeys.stats(),\r\n    queryFn: fetchComplaintStats,\r\n    staleTime: 60_000,\r\n  });\r\n}\r\n\r\ninterface UseComplaintMutationsOptions {\r\n  onCreateSuccess?: (complaint: Complaint) => void;\r\n  onUpdateSuccess?: (complaint: Complaint) => void;\r\n  onDeleteSuccess?: () => void;\r\n  onError?: (error: Error) => void;\r\n}\r\n\r\nexport function useComplaintMutations(options: UseComplaintMutationsOptions = {}) {\r\n  const queryClient = useQueryClient();\r\n  \r\n  const create = useMutation({\r\n    mutationFn: createComplaint,\r\n    onSuccess: (data) => {\r\n      queryClient.invalidateQueries({ queryKey: complaintKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: complaintKeys.stats() });\r\n      options.onCreateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const update = useMutation({\r\n    mutationFn: ({ systemId, data }: { systemId: string; data: Partial<Complaint> }) => \r\n      updateComplaint(systemId, data),\r\n    onSuccess: (data, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: complaintKeys.detail(variables.systemId) });\r\n      queryClient.invalidateQueries({ queryKey: complaintKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: complaintKeys.stats() });\r\n      options.onUpdateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const remove = useMutation({\r\n    mutationFn: deleteComplaint,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: complaintKeys.all });\r\n      options.onDeleteSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  return { create, update, remove };\r\n}\r\n\r\nexport function usePendingComplaints() {\r\n  return useComplaints({ status: 'pending' });\r\n}\r\n\r\nexport function useComplaintsByCustomer(customerId: string | null | undefined) {\r\n  return useComplaints({ customerId: customerId || undefined, limit: 50 });\r\n}\r\n\r\nexport function useComplaintsByOrder(orderId: string | null | undefined) {\r\n  return useComplaints({ orderId: orderId || undefined, limit: 20 });\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;;;CAIC,GAED;AAAA;AAAA;AAAA;AACA;;;;AAWO,MAAM,gBAAgB;IAC3B,KAAK;QAAC;KAAa;IACnB,OAAO,IAAM;eAAI,cAAc,GAAG;YAAE;SAAO;IAC3C,MAAM,CAAC,SAA6B;eAAI,cAAc,KAAK;YAAI;SAAO;IACtE,SAAS,IAAM;eAAI,cAAc,GAAG;YAAE;SAAS;IAC/C,QAAQ,CAAC,KAAe;eAAI,cAAc,OAAO;YAAI;SAAG;IACxD,OAAO,IAAM;eAAI,cAAc,GAAG;YAAE;SAAQ;AAC9C;AAEO,SAAS,cAAc,SAA2B,CAAC,CAAC;;IACzD,OAAO,IAAA,0LAAQ,EAAC;QACd,UAAU,cAAc,IAAI,CAAC;QAC7B,OAAO;sCAAE,IAAM,IAAA,wKAAe,EAAC;;QAC/B,WAAW;QACX,QAAQ,IAAI,KAAK;QACjB,iBAAiB,8LAAgB;IACnC;AACF;GARgB;;QACP,0LAAQ;;;AASV,SAAS,aAAa,EAA6B;;IACxD,OAAO,IAAA,0LAAQ,EAAC;QACd,UAAU,cAAc,MAAM,CAAC;QAC/B,OAAO;qCAAE,IAAM,IAAA,uKAAc,EAAC;;QAC9B,SAAS,CAAC,CAAC;QACX,WAAW;IACb;AACF;IAPgB;;QACP,0LAAQ;;;AAQV,SAAS;;IACd,OAAO,IAAA,0LAAQ,EAAC;QACd,UAAU,cAAc,KAAK;QAC7B,SAAS,4KAAmB;QAC5B,WAAW;IACb;AACF;IANgB;;QACP,0LAAQ;;;AAcV,SAAS,sBAAsB,UAAwC,CAAC,CAAC;;IAC9E,MAAM,cAAc,IAAA,2MAAc;IAElC,MAAM,SAAS,IAAA,gMAAW,EAAC;QACzB,YAAY,wKAAe;QAC3B,SAAS;yDAAE,CAAC;gBACV,YAAY,iBAAiB,CAAC;oBAAE,UAAU,cAAc,KAAK;gBAAG;gBAChE,YAAY,iBAAiB,CAAC;oBAAE,UAAU,cAAc,KAAK;gBAAG;gBAChE,QAAQ,eAAe,GAAG;YAC5B;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,SAAS,IAAA,gMAAW,EAAC;QACzB,UAAU;yDAAE,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAkD,GAC7E,IAAA,wKAAe,EAAC,UAAU;;QAC5B,SAAS;yDAAE,CAAC,MAAM;gBAChB,YAAY,iBAAiB,CAAC;oBAAE,UAAU,cAAc,MAAM,CAAC,UAAU,QAAQ;gBAAE;gBACnF,YAAY,iBAAiB,CAAC;oBAAE,UAAU,cAAc,KAAK;gBAAG;gBAChE,YAAY,iBAAiB,CAAC;oBAAE,UAAU,cAAc,KAAK;gBAAG;gBAChE,QAAQ,eAAe,GAAG;YAC5B;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,SAAS,IAAA,gMAAW,EAAC;QACzB,YAAY,wKAAe;QAC3B,SAAS;yDAAE;gBACT,YAAY,iBAAiB,CAAC;oBAAE,UAAU,cAAc,GAAG;gBAAC;gBAC5D,QAAQ,eAAe;YACzB;;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,OAAO;QAAE;QAAQ;QAAQ;IAAO;AAClC;IAnCgB;;QACM,2MAAc;QAEnB,gMAAW;QAUX,gMAAW;QAYX,gMAAW;;;AAYrB,SAAS;;IACd,OAAO,cAAc;QAAE,QAAQ;IAAU;AAC3C;IAFgB;;QACP;;;AAGF,SAAS,wBAAwB,UAAqC;;IAC3E,OAAO,cAAc;QAAE,YAAY,cAAc;QAAW,OAAO;IAAG;AACxE;IAFgB;;QACP;;;AAGF,SAAS,qBAAqB,OAAkC;;IACrE,OAAO,cAAc;QAAE,SAAS,WAAW;QAAW,OAAO;IAAG;AAClE;IAFgB;;QACP"}},
    {"offset": {"line": 6605, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/complaints/hooks/use-all-complaints.ts"],"sourcesContent":["/**\r\n * useAllComplaints - Convenience hook for components needing all complaints as flat array\r\n */\r\n\r\nimport { useComplaints } from './use-complaints';\r\n\r\nexport function useAllComplaints() {\r\n  const query = useComplaints({});\r\n  \r\n  return {\r\n    data: query.data?.data || [],\r\n    isLoading: query.isLoading,\r\n    isError: query.isError,\r\n    error: query.error,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;CAEC,GAED;;;AAEO,SAAS;;IACd,MAAM,QAAQ,IAAA,wKAAa,EAAC,CAAC;IAE7B,OAAO;QACL,MAAM,MAAM,IAAI,EAAE,QAAQ,EAAE;QAC5B,WAAW,MAAM,SAAS;QAC1B,SAAS,MAAM,OAAO;QACtB,OAAO,MAAM,KAAK;IACpB;AACF;GATgB;;QACA,wKAAa"}}]
}