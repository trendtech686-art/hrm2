{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/settings/SettingsActionButton.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Button, type ButtonProps } from '../ui/button';\r\nimport { cn } from '../../lib/utils';\r\n\r\n/**\r\n * SettingsActionButton chuẩn hóa các nút hành động của module Cài đặt\r\n * để luôn tuân thủ chiều cao h-9 và padding đồng nhất.\r\n */\r\nexport const SettingsActionButton = React.forwardRef<HTMLButtonElement, ButtonProps>(\r\n  ({ className, size, children, ...props }, ref) => {\r\n    return (\r\n      <Button\r\n        ref={ref}\r\n        size={size ?? 'sm'}\r\n        className={cn('h-9 px-4 font-medium gap-2', className)}\r\n        {...props}\r\n      >\r\n        {children}\r\n      </Button>\r\n    );\r\n  }\r\n);\r\n\r\nSettingsActionButton.displayName = 'SettingsActionButton';\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AAMO,MAAM,qCAAuB,mNAAgB,CAClD,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,QAAQ,EAAE,GAAG,OAAO,EAAE;IACxC,qBACE,8OAAC,qIAAM;QACL,KAAK;QACL,MAAM,QAAQ;QACd,WAAW,IAAA,kHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;kBAER;;;;;;AAGP;AAGF,qBAAqB,WAAW,GAAG"}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/kbd.tsx"],"sourcesContent":["import * as React from \"react\";\r\nimport { cn } from \"../../lib/utils\";\r\n\r\nconst Kbd = React.forwardRef<\r\n  HTMLElement,\r\n  React.HTMLAttributes<HTMLElement>\r\n>(({ className, ...props }, ref) => {\r\n  return (\r\n    <kbd\r\n      ref={ref}\r\n      className={cn(\r\n        \"pointer-events-none inline-flex h-5 select-none items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium text-muted-foreground opacity-100\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n});\r\nKbd.displayName = \"Kbd\";\r\n\r\nexport { Kbd };\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAEA,MAAM,oBAAM,mNAAgB,CAG1B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE;IAC1B,qBACE,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,kHAAE,EACX,uLACA;QAED,GAAG,KAAK;;;;;;AAGf;AACA,IAAI,WAAW,GAAG"}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/use-settings-page-header.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { usePathname } from 'next/navigation';\r\nimport { Settings2 } from 'lucide-react';\r\nimport { usePageHeader, type PageHeaderState, type PageHeaderDocLink } from '../../contexts/page-header-context';\r\nimport type { BreadcrumbItem } from '../../lib/breadcrumb-system';\r\n\r\nexport type SettingsPageHeaderOptions = Omit<PageHeaderState, 'title' | 'docLink'> & {\r\n  title: string;\r\n  icon?: React.ReactNode;\r\n  docLink?: string | PageHeaderDocLink;\r\n};\r\n\r\nconst defaultDocLabel = 'Xem hướng dẫn';\r\nconst baseBreadcrumb: BreadcrumbItem[] = [\r\n  { label: 'Trang chủ', href: '/', isCurrent: false },\r\n  { label: 'Cài đặt', href: '/settings', isCurrent: false },\r\n];\r\n\r\nconst normalizeLabel = (label?: string) => label?.trim().toLocaleLowerCase('vi');\r\nconst isHomeCrumb = (item: BreadcrumbItem) => item.href === '/' || normalizeLabel(item.label) === 'trang chủ';\r\nconst isSettingsCrumb = (item: BreadcrumbItem) => item.href === '/settings' || normalizeLabel(item.label) === 'cài đặt';\r\n\r\nexport function useSettingsPageHeader(options: SettingsPageHeaderOptions) {\r\n  const pathname = usePathname();\r\n  const { title, icon, docLink, breadcrumb, ...rest } = options;\r\n\r\n  const normalizedDocLink = React.useMemo<PageHeaderDocLink | undefined>(() => {\r\n    if (!docLink) return undefined;\r\n    if (typeof docLink === 'string') {\r\n      return { href: docLink, label: defaultDocLabel };\r\n    }\r\n    return {\r\n      href: docLink.href,\r\n      label: docLink.label ?? defaultDocLabel,\r\n    };\r\n  }, [docLink]);\r\n\r\n  const decoratedTitle = React.useMemo(() => (\r\n    <span className=\"inline-flex items-center gap-2\">\r\n      {(icon ?? <Settings2 className=\"h-5 w-5 text-muted-foreground\" aria-hidden=\"true\" />)}\r\n      <span>{title}</span>\r\n    </span>\r\n  ), [icon, title]);\r\n\r\n  const normalizedBreadcrumb = React.useMemo(() => {\r\n    const custom = (breadcrumb ?? []).map((item) => ({\r\n      ...item,\r\n      href: item.href || pathname,\r\n    }));\r\n\r\n    let merged: BreadcrumbItem[] = custom.length\r\n      ? [...custom]\r\n      : [{ label: title, href: pathname, isCurrent: true }];\r\n\r\n    if (!merged.some(isHomeCrumb)) {\r\n      merged = [{ ...baseBreadcrumb[0] }, ...merged];\r\n    }\r\n\r\n    if (!merged.some(isSettingsCrumb)) {\r\n      const homeIndex = merged.findIndex(isHomeCrumb);\r\n      const insertionIndex = homeIndex >= 0 ? homeIndex + 1 : 0;\r\n      merged = [\r\n        ...merged.slice(0, insertionIndex),\r\n        { ...baseBreadcrumb[1] },\r\n        ...merged.slice(insertionIndex),\r\n      ];\r\n    }\r\n\r\n    return merged.map((item, index) => ({\r\n      ...item,\r\n      isCurrent: index === merged.length - 1,\r\n    }));\r\n  }, [breadcrumb, pathname, title]);\r\n\r\n  return usePageHeader({\r\n    ...rest,\r\n    breadcrumb: normalizedBreadcrumb,\r\n    title: decoratedTitle,\r\n    docLink: normalizedDocLink,\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;;;;;;AASA,MAAM,kBAAkB;AACxB,MAAM,iBAAmC;IACvC;QAAE,OAAO;QAAa,MAAM;QAAK,WAAW;IAAM;IAClD;QAAE,OAAO;QAAW,MAAM;QAAa,WAAW;IAAM;CACzD;AAED,MAAM,iBAAiB,CAAC,QAAmB,OAAO,OAAO,kBAAkB;AAC3E,MAAM,cAAc,CAAC,OAAyB,KAAK,IAAI,KAAK,OAAO,eAAe,KAAK,KAAK,MAAM;AAClG,MAAM,kBAAkB,CAAC,OAAyB,KAAK,IAAI,KAAK,eAAe,eAAe,KAAK,KAAK,MAAM;AAEvG,SAAS,sBAAsB,OAAkC;IACtE,MAAM,WAAW,IAAA,iJAAW;IAC5B,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,EAAE,UAAU,EAAE,GAAG,MAAM,GAAG;IAEtD,MAAM,oBAAoB,gNAAa,CAAgC;QACrE,IAAI,CAAC,SAAS,OAAO;QACrB,IAAI,OAAO,YAAY,UAAU;YAC/B,OAAO;gBAAE,MAAM;gBAAS,OAAO;YAAgB;QACjD;QACA,OAAO;YACL,MAAM,QAAQ,IAAI;YAClB,OAAO,QAAQ,KAAK,IAAI;QAC1B;IACF,GAAG;QAAC;KAAQ;IAEZ,MAAM,iBAAiB,gNAAa,CAAC,kBACnC,8OAAC;YAAK,WAAU;;gBACZ,sBAAQ,8OAAC,6NAAS;oBAAC,WAAU;oBAAgC,eAAY;;;;;;8BAC3E,8OAAC;8BAAM;;;;;;;;;;;kBAER;QAAC;QAAM;KAAM;IAEhB,MAAM,uBAAuB,gNAAa,CAAC;QACzC,MAAM,SAAS,CAAC,cAAc,EAAE,EAAE,GAAG,CAAC,CAAC,OAAS,CAAC;gBAC/C,GAAG,IAAI;gBACP,MAAM,KAAK,IAAI,IAAI;YACrB,CAAC;QAED,IAAI,SAA2B,OAAO,MAAM,GACxC;eAAI;SAAO,GACX;YAAC;gBAAE,OAAO;gBAAO,MAAM;gBAAU,WAAW;YAAK;SAAE;QAEvD,IAAI,CAAC,OAAO,IAAI,CAAC,cAAc;YAC7B,SAAS;gBAAC;oBAAE,GAAG,cAAc,CAAC,EAAE;gBAAC;mBAAM;aAAO;QAChD;QAEA,IAAI,CAAC,OAAO,IAAI,CAAC,kBAAkB;YACjC,MAAM,YAAY,OAAO,SAAS,CAAC;YACnC,MAAM,iBAAiB,aAAa,IAAI,YAAY,IAAI;YACxD,SAAS;mBACJ,OAAO,KAAK,CAAC,GAAG;gBACnB;oBAAE,GAAG,cAAc,CAAC,EAAE;gBAAC;mBACpB,OAAO,KAAK,CAAC;aACjB;QACH;QAEA,OAAO,OAAO,GAAG,CAAC,CAAC,MAAM,QAAU,CAAC;gBAClC,GAAG,IAAI;gBACP,WAAW,UAAU,OAAO,MAAM,GAAG;YACvC,CAAC;IACH,GAAG;QAAC;QAAY;QAAU;KAAM;IAEhC,OAAO,IAAA,uJAAa,EAAC;QACnB,GAAG,IAAI;QACP,YAAY;QACZ,OAAO;QACP,SAAS;IACX;AACF"}},
    {"offset": {"line": 189, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/context-menu.tsx"],"sourcesContent":["\r\n\r\nimport * as React from \"react\"\r\nimport { createPortal } from \"react-dom\"\r\nimport { cn } from \"../../lib/utils\"\r\n\r\n// CONTEXT\r\ntype ContextMenuContextType = {\r\n  open: boolean;\r\n  setOpen: React.Dispatch<React.SetStateAction<boolean>>;\r\n  position: { x: number; y: number };\r\n  setPosition: React.Dispatch<React.SetStateAction<{ x: number; y: number }>>;\r\n};\r\n\r\nexport const ContextMenuContext = React.createContext<ContextMenuContextType>({\r\n  open: false,\r\n  setOpen: () => {},\r\n  position: { x: 0, y: 0 },\r\n  setPosition: () => {},\r\n});\r\n\r\n// ROOT COMPONENT\r\nconst ContextMenu = ({ children }: { children?: React.ReactNode }) => {\r\n  const [open, setOpen] = React.useState(false);\r\n  const [position, setPosition] = React.useState({ x: 0, y: 0 });\r\n  return (\r\n    <ContextMenuContext.Provider value={{ open, setOpen, position, setPosition }}>\r\n      {children}\r\n    </ContextMenuContext.Provider>\r\n  );\r\n};\r\n\r\n// TRIGGER\r\nconst ContextMenuTrigger = ({ children, asChild }: { children?: React.ReactNode, asChild?: boolean }) => {\r\n  const { setOpen, setPosition } = React.useContext(ContextMenuContext);\r\n\r\n  const handleContextMenu = (e: React.MouseEvent) => {\r\n    e.preventDefault();\r\n    setPosition({ x: e.clientX, y: e.clientY });\r\n    setOpen(true);\r\n  };\r\n\r\n  if (asChild && React.isValidElement(children)) {\r\n    return React.cloneElement(children as React.ReactElement<any>, {\r\n      onContextMenu: (e: React.MouseEvent) => {\r\n        handleContextMenu(e);\r\n        if ((children.props as any).onContextMenu) {\r\n          (children.props as any).onContextMenu(e);\r\n        }\r\n      },\r\n    });\r\n  }\r\n\r\n  return (\r\n    <div onContextMenu={handleContextMenu}>\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n\r\n// CONTENT & PORTAL\r\nconst ContextMenuContent = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.HTMLAttributes<HTMLDivElement>\r\n>(({ children, className, ...props }, forwardedRef) => {\r\n  const { open, setOpen, position } = React.useContext(ContextMenuContext);\r\n  const contentRef = React.useRef<HTMLDivElement>(null);\r\n  const [style, setStyle] = React.useState<React.CSSProperties>({ position: 'fixed', top: '-9999px', left: '-9999px' });\r\n\r\n  React.useImperativeHandle(forwardedRef, () => contentRef.current!);\r\n\r\n  React.useLayoutEffect(() => {\r\n    if (open && contentRef.current) {\r\n      const contentEl = contentRef.current;\r\n      // If the content isn't rendered with dimensions yet, wait.\r\n      if (contentEl.offsetHeight === 0) return;\r\n\r\n      const contentHeight = contentEl.offsetHeight;\r\n      const contentWidth = contentEl.offsetWidth;\r\n      const viewHeight = window.innerHeight;\r\n      const viewWidth = window.innerWidth;\r\n      \r\n      let top = position.y;\r\n      // Adjust if it overflows the bottom\r\n      if (top + contentHeight > viewHeight - 8) {\r\n        top = viewHeight - contentHeight - 8;\r\n      }\r\n      // Adjust if it overflows the top\r\n      if (top < 8) {\r\n          top = 8;\r\n      }\r\n\r\n      let left = position.x;\r\n      // Adjust if it overflows the right\r\n      if (left + contentWidth > viewWidth - 8) {\r\n        left = viewWidth - contentWidth - 8;\r\n      }\r\n      // Adjust if it overflows the left\r\n      if (left < 8) {\r\n          left = 8;\r\n      }\r\n\r\n      setStyle({\r\n          position: 'fixed',\r\n          top: `${top}px`,\r\n          left: `${left}px`,\r\n      });\r\n    }\r\n  }, [open, position, contentRef.current?.offsetHeight]);\r\n\r\n  React.useEffect(() => {\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n        if (e.key === \"Escape\") setOpen(false);\r\n    }\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (contentRef.current && !contentRef.current.contains(event.target as Node)) {\r\n        setOpen(false);\r\n      }\r\n    };\r\n    const handleScrollAndResize = () => {\r\n        setOpen(false);\r\n    };\r\n    if (open) {\r\n        // Defer attachment to prevent the context menu event from closing itself\r\n        const timerId = setTimeout(() => {\r\n            document.addEventListener(\"click\", handleClickOutside);\r\n            document.addEventListener(\"contextmenu\", handleClickOutside); // also close on another right click\r\n            window.addEventListener(\"scroll\", handleScrollAndResize, true);\r\n            window.addEventListener(\"resize\", handleScrollAndResize);\r\n        }, 0);\r\n        document.addEventListener(\"keydown\", handleKeyDown);\r\n        return () => {\r\n            clearTimeout(timerId);\r\n            document.removeEventListener(\"click\", handleClickOutside);\r\n            document.removeEventListener(\"contextmenu\", handleClickOutside);\r\n            document.removeEventListener(\"keydown\", handleKeyDown);\r\n            window.removeEventListener(\"scroll\", handleScrollAndResize, true);\r\n            window.removeEventListener(\"resize\", handleScrollAndResize);\r\n        }\r\n    }\r\n  }, [open, setOpen]);\r\n\r\n  const [mounted, setMounted] = React.useState(false);\r\n  React.useEffect(() => { setMounted(true) }, []);\r\n\r\n  if (!mounted) return null;\r\n\r\n  return createPortal(\r\n    open ? (\r\n      <div \r\n        ref={contentRef} \r\n        style={style}\r\n        className={cn(\"z-50 min-w-[8rem] overflow-hidden rounded-md border border-border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95\", className)}\r\n        {...props}\r\n      >\r\n        {children}\r\n      </div>\r\n    ) : null,\r\n    document.body\r\n  );\r\n});\r\nContextMenuContent.displayName = \"ContextMenuContent\";\r\n\r\n\r\n// OTHER COMPONENTS\r\nconst ContextMenuItem = ({ children, className, onSelect }: { children?: React.ReactNode, className?: string, onSelect?: () => void }) => {\r\n    const { setOpen } = React.useContext(ContextMenuContext);\r\n    const handleSelect = () => {\r\n        onSelect?.();\r\n        setOpen(false);\r\n    }\r\n    return (\r\n        <div onClick={handleSelect} className={cn(\"relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\", className)}>\r\n            {children}\r\n        </div>\r\n    )\r\n}\r\n\r\nconst ContextMenuCheckboxItem = ({ checked, onCheckedChange, children, className }: { checked: boolean, onCheckedChange: (checked: boolean) => void, children?: React.ReactNode, className?: string }) => {\r\n    return (\r\n        <div onClick={() => onCheckedChange(!checked)} className={cn(\"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\", className)}>\r\n            <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\r\n                {checked && <div className=\"h-2 w-2 rounded-full bg-primary\" />}\r\n            </span>\r\n            {children}\r\n        </div>\r\n    )\r\n}\r\n\r\nconst ContextMenuLabel = ({ children, className }: { children?: React.ReactNode, className?: string }) => (\r\n    <div className={cn(\"px-2 py-1.5 text-sm font-semibold\", className)}>{children}</div>\r\n)\r\n\r\nconst ContextMenuSeparator = ({ className } : { className?: string}) => (\r\n    <div className={cn(\"-mx-1 my-1 h-px bg-muted\", className)} />\r\n)\r\n\r\n\r\nexport { ContextMenu, ContextMenuTrigger, ContextMenuContent, ContextMenuItem, ContextMenuCheckboxItem, ContextMenuLabel, ContextMenuSeparator };\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 439, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/departments/organization-chart/components/chart-node.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Handle, Position, type NodeProps, NodeResizer } from 'reactflow';\r\nimport { cn } from '../../../../../lib/utils';\r\nimport { Avatar, AvatarFallback, AvatarImage } from '../../../../../components/ui/avatar';\r\nimport type { Employee } from '../../../../employees/types';\r\nimport { Button } from '../../../../../components/ui/button';\r\nimport { Plus, Minus, Mail, Phone, Users, Focus, User, Copy, Check, GripVertical, XCircle } from 'lucide-react';\r\nimport { Badge } from '../../../../../components/ui/badge';\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '../../../../../components/ui/tooltip';\r\nimport { ContextMenu, ContextMenuContent, ContextMenuItem, ContextMenuSeparator, ContextMenuTrigger } from '../../../../../components/ui/context-menu';\r\n\r\nconst getInitials = (name: string) => {\r\n    if (!name) return '';\r\n    const nameParts = name.split(' ');\r\n    if (nameParts.length === 1) return name.substring(0, 2).toUpperCase();\r\n    const lastInitial = nameParts[nameParts.length - 1][0];\r\n    const secondLastInitial = nameParts.length > 1 ? nameParts[nameParts.length - 2][0] : nameParts[0][0];\r\n    return (secondLastInitial + lastInitial).toUpperCase();\r\n};\r\n\r\ntype EmployeeNodeData = Partial<Employee> & { \r\n    systemId: string, \r\n    fullName: string, \r\n    jobTitle: string,\r\n    childrenCount: number;\r\n    isCollapsed: boolean;\r\n    onToggle: () => void;\r\n    totalHeadcount?: number;\r\n    navigate: (path: string) => void;\r\n    onFocus: (nodeId: string) => void;\r\n    departmentFilter?: string;\r\n    isInteractive: boolean;\r\n};\r\n\r\nconst HeadcountBadge = ({ count }: { count: number }) => (\r\n    <TooltipProvider delayDuration={100}>\r\n        <Tooltip>\r\n            <TooltipTrigger asChild>\r\n                <div className=\"absolute -top-2 -right-2 flex items-center justify-center h-5 w-5 rounded-full bg-primary text-primary-foreground text-xs font-bold\">\r\n                    {count}\r\n                </div>\r\n            </TooltipTrigger>\r\n            <TooltipContent>\r\n                <p>Tổng số nhân sự quản lý: {count}</p>\r\n            </TooltipContent>\r\n        </Tooltip>\r\n    </TooltipProvider>\r\n);\r\n\r\n\r\nexport function EmployeeNode({ data, selected }: NodeProps<EmployeeNodeData>) {\r\n    const isRoot = data.systemId === 'root';\r\n    const [copiedItem, setCopiedItem] = React.useState<null | 'email' | 'phone'>(null);\r\n\r\n    const handleCopy = (text: string, type: 'email' | 'phone') => {\r\n        navigator.clipboard.writeText(text);\r\n        setCopiedItem(type);\r\n        setTimeout(() => setCopiedItem(null), 1500);\r\n    };\r\n\r\n    const roleStyle = React.useMemo(() => {\r\n        if (isRoot) return 'border-primary bg-primary/5';\r\n        if (data.jobTitle?.includes('Giám đốc')) return 'border-blue-500 bg-blue-500/5';\r\n        if (data.jobTitle?.includes('Trưởng')) return 'border-amber-500 bg-amber-500/5';\r\n        return 'bg-card';\r\n    }, [data.jobTitle, isRoot]);\r\n\r\n    const isHighlighted = data.departmentFilter && data.departmentFilter !== 'all' && data.department === data.departmentFilter;\r\n\r\n    const nodeContent = (\r\n        <div\r\n            className={cn(\r\n                \"group relative flex items-center p-3 rounded-lg border border-border text-card-foreground shadow-sm w-64 transition-all\",\r\n                !isRoot && \"cursor-pointer hover:shadow-md\",\r\n                selected && \"ring-2 ring-primary ring-offset-2 shadow-lg\",\r\n                isHighlighted && \"ring-2 ring-offset-2 ring-green-500 shadow-lg\",\r\n                roleStyle\r\n            )}\r\n        >\r\n            {/* Drag Handle - Sử dụng drag-handle class của ReactFlow */}\r\n            {data.isInteractive && !isRoot && (\r\n                 <TooltipProvider delayDuration={100}>\r\n                    <Tooltip>\r\n                        <TooltipTrigger asChild>\r\n                            <div \r\n                                className=\"drag-handle absolute -left-3 top-1/2 -translate-y-1/2 cursor-grab active:cursor-grabbing opacity-50 group-hover:opacity-100 transition-opacity z-20\"\r\n                                onMouseDown={(e) => {\r\n                                    // Prevent event bubbling to allow drag\r\n                                    e.stopPropagation();\r\n                                }}\r\n                            >\r\n                                <div className=\"bg-background border rounded p-1 shadow-sm\">\r\n                                    <GripVertical className=\"h-4 w-4 text-muted-foreground\" />\r\n                                </div>\r\n                            </div>\r\n                        </TooltipTrigger>\r\n                        <TooltipContent side=\"left\">\r\n                            <p>Kéo để di chuyển vị trí</p>\r\n                        </TooltipContent>\r\n                    </Tooltip>\r\n                </TooltipProvider>\r\n            )}\r\n\r\n            <Avatar className=\"w-14 h-14 mr-4\">\r\n                {data.avatarUrl && <AvatarImage src={data.avatarUrl} alt={data.fullName} />}\r\n                <AvatarFallback className={cn(\"text-lg\", isRoot && \"bg-primary text-primary-foreground font-bold\")}>\r\n                    {getInitials(data.fullName)}\r\n                </AvatarFallback>\r\n            </Avatar>\r\n            <div className=\"flex-grow min-w-0\">\r\n                <p className=\"font-semibold text-sm truncate\">{data.fullName}</p>\r\n                <p className={cn(\"text-xs truncate\", \"text-muted-foreground\")}>{data.jobTitle}</p>\r\n            </div>\r\n\r\n            {data.totalHeadcount && data.totalHeadcount > 0 && <HeadcountBadge count={data.totalHeadcount} />}\r\n            \r\n            {/* Collapse/Expand button */}\r\n            {data.childrenCount > 0 && (\r\n                <div \r\n                    className=\"absolute -bottom-3 left-1/2 -translate-x-1/2 flex items-center gap-1 z-20\"\r\n                    onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        e.preventDefault();\r\n                    }}\r\n                    onMouseDown={(e) => {\r\n                        // Prevent drag when clicking collapse button\r\n                        e.stopPropagation();\r\n                    }}\r\n                >\r\n                    <Button \r\n                        size=\"icon\" \r\n                        variant=\"outline\" \r\n                        className=\"h-6 w-6 rounded-full bg-background shadow-md hover:shadow-lg transition-all\" \r\n                        onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            data.onToggle();\r\n                        }}\r\n                    >\r\n                        {data.isCollapsed ? <Plus className=\"w-3 h-3\" /> : <Minus className=\"w-3 h-3\" />}\r\n                    </Button>\r\n                    {data.isCollapsed && (\r\n                        <Badge variant=\"secondary\" className=\"shadow-sm\">+{data.childrenCount}</Badge>\r\n                    )}\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n    \r\n    if (isRoot) {\r\n        return (\r\n             <>\r\n                <Handle type=\"target\" position={Position.Top} className=\"opacity-0\" />\r\n                {nodeContent}\r\n                <Handle type=\"source\" position={Position.Bottom} className=\"opacity-0\" />\r\n            </>\r\n        )\r\n    }\r\n\r\n    return (\r\n        <ContextMenu>\r\n            <ContextMenuTrigger>\r\n                <div>\r\n                    <Handle type=\"target\" position={Position.Top} className=\"opacity-0\" />\r\n                    {nodeContent}\r\n                    <Handle type=\"source\" position={Position.Bottom} className=\"opacity-0\" />\r\n                </div>\r\n            </ContextMenuTrigger>\r\n            <ContextMenuContent className=\"w-64\">\r\n                <ContextMenuItem onSelect={() => data.navigate(`/employees/${data.systemId}`)}>\r\n                    <User className=\"mr-2 h-4 w-4\" /> Xem chi tiết hồ sơ\r\n                </ContextMenuItem>\r\n                <ContextMenuItem onSelect={() => data.onFocus(data.systemId!)}>\r\n                    <Focus className=\"mr-2 h-4 w-4\" /> Tập trung\r\n                </ContextMenuItem>\r\n                {data.childrenCount > 0 && (\r\n                    <ContextMenuItem onSelect={data.onToggle}>\r\n                        {data.isCollapsed ? 'Hiện' : 'Ẩn'} cấp dưới\r\n                    </ContextMenuItem>\r\n                )}\r\n                <ContextMenuSeparator />\r\n                <div className=\"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none\">\r\n                    <Mail className=\"mr-2 h-4 w-4 text-muted-foreground\" />\r\n                    <span className=\"flex-grow truncate\">{data.workEmail}</span>\r\n                    <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 ml-2\" onClick={(e) => { e.stopPropagation(); handleCopy(data.workEmail!, 'email'); }}>\r\n                        {copiedItem === 'email' ? <Check className=\"h-4 w-4 text-green-500\" /> : <Copy className=\"h-4 w-4 text-muted-foreground\" />}\r\n                    </Button>\r\n                </div>\r\n                <div className=\"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none\">\r\n                    <Phone className=\"mr-2 h-4 w-4 text-muted-foreground\" />\r\n                    <span className=\"flex-grow truncate\">{data.phone}</span>\r\n                     <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6 ml-2\" onClick={(e) => { e.stopPropagation(); handleCopy(data.phone!, 'phone'); }}>\r\n                        {copiedItem === 'phone' ? <Check className=\"h-4 w-4 text-green-500\" /> : <Copy className=\"h-4 w-4 text-muted-foreground\" />}\r\n                    </Button>\r\n                </div>\r\n            </ContextMenuContent>\r\n        </ContextMenu>\r\n    );\r\n};\r\n\r\nexport { EmployeeNode as CustomEmployeeNode };\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 958, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/select.tsx"],"sourcesContent":["import * as React from \"react\"\r\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\r\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\r\n\r\nimport { cn } from \"../../lib/utils\"\r\nimport { useModal } from \"../../contexts/modal-context\"\r\n\r\ntype BaseSelectProps = React.ComponentPropsWithoutRef<typeof SelectPrimitive.Root>\r\n\r\ntype SelectProps = Omit<BaseSelectProps, \"value\" | \"defaultValue\"> & {\r\n  value?: string | undefined\r\n  defaultValue?: string | undefined\r\n}\r\n\r\nconst Select = ({ value, defaultValue, ...props }: SelectProps) => {\r\n  const controlledProps: Partial<BaseSelectProps> = {}\r\n\r\n  if (value !== undefined) {\r\n    controlledProps.value = value\r\n  }\r\n\r\n  if (defaultValue !== undefined) {\r\n    controlledProps.defaultValue = defaultValue\r\n  }\r\n\r\n  return <SelectPrimitive.Root {...props} {...controlledProps} />\r\n}\r\nSelect.displayName = SelectPrimitive.Root.displayName\r\n\r\nconst SelectGroup = SelectPrimitive.Group\r\n\r\nconst SelectValue = SelectPrimitive.Value\r\n\r\nconst SelectTrigger = React.forwardRef<\r\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\r\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\r\n>(({ className, children, ...props }, ref) => (\r\n  <SelectPrimitive.Trigger\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    {children}\r\n    <SelectPrimitive.Icon asChild>\r\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\r\n    </SelectPrimitive.Icon>\r\n  </SelectPrimitive.Trigger>\r\n))\r\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\r\n\r\nconst SelectScrollUpButton = React.forwardRef<\r\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\r\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\r\n>(({ className, ...props }, ref) => (\r\n  <SelectPrimitive.ScrollUpButton\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex cursor-default items-center justify-center py-1\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    <ChevronUp className=\"h-4 w-4\" />\r\n  </SelectPrimitive.ScrollUpButton>\r\n))\r\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\r\n\r\nconst SelectScrollDownButton = React.forwardRef<\r\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\r\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\r\n>(({ className, ...props }, ref) => (\r\n  <SelectPrimitive.ScrollDownButton\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex cursor-default items-center justify-center py-1\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    <ChevronDown className=\"h-4 w-4\" />\r\n  </SelectPrimitive.ScrollDownButton>\r\n))\r\nSelectScrollDownButton.displayName =\r\n  SelectPrimitive.ScrollDownButton.displayName\r\n\r\nconst SelectContent = React.forwardRef<\r\n  React.ElementRef<typeof SelectPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\r\n>(({ className, children, position = \"popper\", ...props }, ref) => {\r\n  const modalId = React.useId();\r\n  const [isOpen, setIsOpen] = React.useState(false);\r\n  const { zIndex } = useModal(modalId, isOpen, 'select');\r\n\r\n  React.useEffect(() => {\r\n    const content = ref && 'current' in ref ? ref.current : null;\r\n    if (!content) return;\r\n\r\n    const observer = new MutationObserver((mutations) => {\r\n      mutations.forEach((mutation) => {\r\n        if (mutation.type === 'attributes' && mutation.attributeName === 'data-state') {\r\n          const target = mutation.target as HTMLElement;\r\n          const state = target.getAttribute('data-state');\r\n          setIsOpen(state === 'open');\r\n        }\r\n      });\r\n    });\r\n\r\n    observer.observe(content, { attributes: true, attributeFilter: ['data-state'] });\r\n\r\n    return () => observer.disconnect();\r\n  }, [ref]);\r\n\r\n  return (\r\n    <SelectPrimitive.Portal>\r\n      <SelectPrimitive.Content\r\n        ref={ref}\r\n        className={cn(\r\n          \"relative max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border border-border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\r\n          position === \"popper\" &&\r\n            \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\r\n          className\r\n        )}\r\n        style={{ zIndex }}\r\n        position={position}\r\n        {...props}\r\n      >\r\n        <SelectScrollUpButton />\r\n        <SelectPrimitive.Viewport\r\n          className={cn(\r\n            \"p-1\",\r\n            position === \"popper\" &&\r\n              \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\r\n          )}\r\n        >\r\n          {children}\r\n        </SelectPrimitive.Viewport>\r\n        <SelectScrollDownButton />\r\n      </SelectPrimitive.Content>\r\n    </SelectPrimitive.Portal>\r\n  );\r\n})\r\nSelectContent.displayName = SelectPrimitive.Content.displayName\r\n\r\nconst SelectLabel = React.forwardRef<\r\n  React.ElementRef<typeof SelectPrimitive.Label>,\r\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\r\n>(({ className, ...props }, ref) => (\r\n  <SelectPrimitive.Label\r\n    ref={ref}\r\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\r\n    {...props}\r\n  />\r\n))\r\nSelectLabel.displayName = SelectPrimitive.Label.displayName\r\n\r\nconst SelectItem = React.forwardRef<\r\n  React.ElementRef<typeof SelectPrimitive.Item>,\r\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\r\n>(({ className, children, ...props }, ref) => (\r\n  <SelectPrimitive.Item\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\r\n      className\r\n    )}\r\n    {...props}\r\n  >\r\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\r\n      <SelectPrimitive.ItemIndicator>\r\n        <Check className=\"h-4 w-4\" />\r\n      </SelectPrimitive.ItemIndicator>\r\n    </span>\r\n\r\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\r\n  </SelectPrimitive.Item>\r\n))\r\nSelectItem.displayName = SelectPrimitive.Item.displayName\r\n\r\nconst SelectSeparator = React.forwardRef<\r\n  React.ElementRef<typeof SelectPrimitive.Separator>,\r\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\r\n>(({ className, ...props }, ref) => (\r\n  <SelectPrimitive.Separator\r\n    ref={ref}\r\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\r\n    {...props}\r\n  />\r\n))\r\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\r\n\r\nexport {\r\n  Select,\r\n  SelectGroup,\r\n  SelectValue,\r\n  SelectTrigger,\r\n  SelectContent,\r\n  SelectLabel,\r\n  SelectItem,\r\n  SelectSeparator,\r\n  SelectScrollUpButton,\r\n  SelectScrollDownButton,\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1206, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"../../lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border border-border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLHeadingElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn(\n      \"text-h3 font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA;AAEA;;;;AAEA,MAAM,qBAAO,mNAAgB,CAG3B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,kHAAE,EACX,0EACA;QAED,GAAG,KAAK;;;;;;AAGb,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,mNAAgB,CAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,kHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,mNAAgB,CAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,kHAAE,EACX,qDACA;QAED,GAAG,KAAK;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,mNAAgB,CAGtC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,kHAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,mNAAgB,CAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QAAI,KAAK;QAAK,WAAW,IAAA,kHAAE,EAAC,YAAY;QAAa,GAAG,KAAK;;;;;;AAEhE,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,mNAAgB,CAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,IAAA,kHAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG"}},
    {"offset": {"line": 1291, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/departments/organization-chart/components/chart-search.tsx"],"sourcesContent":["/**\r\n * Chart Search Component\r\n * Search and filter employees in org chart\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { Search } from 'lucide-react';\r\nimport { Input } from '../../../../../components/ui/input';\r\nimport { \r\n  Select, \r\n  SelectContent, \r\n  SelectItem, \r\n  SelectTrigger, \r\n  SelectValue \r\n} from '../../../../../components/ui/select';\r\nimport { Card, CardContent } from '../../../../../components/ui/card';\r\nimport type { Employee } from '../../../../employees/types';\r\nimport type { Department } from '../../types';\r\nimport Fuse from 'fuse.js';\r\n\r\ninterface ChartSearchProps {\r\n  employees: Employee[];\r\n  departments: Department[];\r\n  departmentFilter: string;\r\n  onDepartmentFilterChange: (value: string) => void;\r\n  onEmployeeSelect: (employee: Employee) => void;\r\n}\r\n\r\nexport function ChartSearch({\r\n  employees,\r\n  departments,\r\n  departmentFilter,\r\n  onDepartmentFilterChange,\r\n  onEmployeeSelect\r\n}: ChartSearchProps) {\r\n  const [searchQuery, setSearchQuery] = React.useState('');\r\n\r\n  const fuse = React.useMemo(\r\n    () =>\r\n      new Fuse(\r\n        employees.filter(e => e.employmentStatus === 'Đang làm việc'),\r\n        {\r\n          keys: ['fullName', 'id', 'jobTitle', 'department'],\r\n          threshold: 0.3\r\n        }\r\n      ),\r\n    [employees]\r\n  );\r\n\r\n  const searchResults = React.useMemo(() => {\r\n    if (!searchQuery) return [];\r\n    return fuse\r\n      .search(searchQuery)\r\n      .map(result => result.item)\r\n      .slice(0, 10);\r\n  }, [searchQuery, fuse]);\r\n\r\n  const handleSelect = (employee: Employee) => {\r\n    onEmployeeSelect(employee);\r\n    setSearchQuery('');\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-2\">\r\n      <div className=\"flex items-center gap-2\">\r\n        {/* Search input */}\r\n        <div className=\"relative w-72\">\r\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n          <Input\r\n            placeholder=\"Tìm kiếm nhân viên...\"\r\n            className=\"pl-9 shadow-md\"\r\n            value={searchQuery}\r\n            onChange={(e) => setSearchQuery(e.target.value)}\r\n          />\r\n        </div>\r\n\r\n        {/* Department filter */}\r\n        <Select value={departmentFilter} onValueChange={onDepartmentFilterChange}>\r\n          <SelectTrigger className=\"w-[200px] shadow-md h-9\">\r\n            <SelectValue placeholder=\"Lọc phòng ban...\" />\r\n          </SelectTrigger>\r\n          <SelectContent>\r\n            <SelectItem value=\"all\">Tất cả phòng ban</SelectItem>\r\n            {departments.map(dep => (\r\n              <SelectItem key={dep.systemId} value={dep.name}>\r\n                {dep.name}\r\n              </SelectItem>\r\n            ))}\r\n          </SelectContent>\r\n        </Select>\r\n      </div>\r\n\r\n      {/* Search results dropdown */}\r\n      {searchQuery && (\r\n        <Card className=\"max-h-80 overflow-y-auto w-72\">\r\n          <CardContent className=\"p-2\">\r\n            {searchResults.length > 0 ? (\r\n              searchResults.map(employee => (\r\n                <div\r\n                  key={employee.systemId}\r\n                  className=\"p-2 hover:bg-accent rounded-md cursor-pointer transition-colors\"\r\n                  onClick={() => handleSelect(employee)}\r\n                >\r\n                  <p className=\"font-medium text-sm\">{employee.fullName}</p>\r\n                  <p className=\"text-xs text-muted-foreground\">\r\n                    {employee.jobTitle} - {employee.department}\r\n                  </p>\r\n                </div>\r\n              ))\r\n            ) : (\r\n              <p className=\"p-2 text-center text-sm text-muted-foreground\">\r\n                Không tìm thấy kết quả.\r\n              </p>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;;;CAGC,GAED;AACA;AACA;AACA;AAOA;AAGA;;;;;;;;AAUO,SAAS,YAAY,EAC1B,SAAS,EACT,WAAW,EACX,gBAAgB,EAChB,wBAAwB,EACxB,gBAAgB,EACC;IACjB,MAAM,CAAC,aAAa,eAAe,GAAG,iNAAc,CAAC;IAErD,MAAM,OAAO,gNAAa,CACxB,IACE,IAAI,sJAAI,CACN,UAAU,MAAM,CAAC,CAAA,IAAK,EAAE,gBAAgB,KAAK,kBAC7C;YACE,MAAM;gBAAC;gBAAY;gBAAM;gBAAY;aAAa;YAClD,WAAW;QACb,IAEJ;QAAC;KAAU;IAGb,MAAM,gBAAgB,gNAAa,CAAC;QAClC,IAAI,CAAC,aAAa,OAAO,EAAE;QAC3B,OAAO,KACJ,MAAM,CAAC,aACP,GAAG,CAAC,CAAA,SAAU,OAAO,IAAI,EACzB,KAAK,CAAC,GAAG;IACd,GAAG;QAAC;QAAa;KAAK;IAEtB,MAAM,eAAe,CAAC;QACpB,iBAAiB;QACjB,eAAe;IACjB;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCAEb,8OAAC;wBAAI,WAAU;;0CACb,8OAAC,gNAAM;gCAAC,WAAU;;;;;;0CAClB,8OAAC,mIAAK;gCACJ,aAAY;gCACZ,WAAU;gCACV,OAAO;gCACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;kCAKlD,8OAAC,qIAAM;wBAAC,OAAO;wBAAkB,eAAe;;0CAC9C,8OAAC,4IAAa;gCAAC,WAAU;0CACvB,cAAA,8OAAC,0IAAW;oCAAC,aAAY;;;;;;;;;;;0CAE3B,8OAAC,4IAAa;;kDACZ,8OAAC,yIAAU;wCAAC,OAAM;kDAAM;;;;;;oCACvB,YAAY,GAAG,CAAC,CAAA,oBACf,8OAAC,yIAAU;4CAAoB,OAAO,IAAI,IAAI;sDAC3C,IAAI,IAAI;2CADM,IAAI,QAAQ;;;;;;;;;;;;;;;;;;;;;;;YASpC,6BACC,8OAAC,iIAAI;gBAAC,WAAU;0BACd,cAAA,8OAAC,wIAAW;oBAAC,WAAU;8BACpB,cAAc,MAAM,GAAG,IACtB,cAAc,GAAG,CAAC,CAAA,yBAChB,8OAAC;4BAEC,WAAU;4BACV,SAAS,IAAM,aAAa;;8CAE5B,8OAAC;oCAAE,WAAU;8CAAuB,SAAS,QAAQ;;;;;;8CACrD,8OAAC;oCAAE,WAAU;;wCACV,SAAS,QAAQ;wCAAC;wCAAI,SAAS,UAAU;;;;;;;;2BANvC,SAAS,QAAQ;;;;kDAW1B,8OAAC;wBAAE,WAAU;kCAAgD;;;;;;;;;;;;;;;;;;;;;;AAS3E"}},
    {"offset": {"line": 1484, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/components/ui/separator.tsx"],"sourcesContent":["\"use client\"\r\n\r\nimport * as React from \"react\"\r\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\r\n\r\nimport { cn } from \"../../lib/utils\"\r\n\r\nconst Separator = React.forwardRef<\r\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\r\n>(\r\n  (\r\n    { className, orientation = \"horizontal\", decorative = true, ...props },\r\n    ref\r\n  ) => (\r\n    <SeparatorPrimitive.Root\r\n      ref={ref}\r\n      decorative={decorative}\r\n      orientation={orientation}\r\n      className={cn(\r\n        \"shrink-0 bg-border\",\r\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\r\n        className\r\n      )}\r\n      {...props}\r\n    />\r\n  )\r\n)\r\nSeparator.displayName = SeparatorPrimitive.Root.displayName\r\n\r\nexport { Separator }\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAEA;AALA;;;;;AAOA,MAAM,0BAAY,mNAAgB,CAIhC,CACE,EAAE,SAAS,EAAE,cAAc,YAAY,EAAE,aAAa,IAAI,EAAE,GAAG,OAAO,EACtE,oBAEA,8OAAC,6KAAuB;QACtB,KAAK;QACL,YAAY;QACZ,aAAa;QACb,WAAW,IAAA,kHAAE,EACX,sBACA,gBAAgB,eAAe,mBAAmB,kBAClD;QAED,GAAG,KAAK;;;;;;AAIf,UAAU,WAAW,GAAG,6KAAuB,CAAC,WAAW"}},
    {"offset": {"line": 1514, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/departments/organization-chart/components/chart-controls.tsx"],"sourcesContent":["/**\r\n * Chart Controls Component\r\n * Zoom, fit view, layout controls\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { useReactFlow } from 'reactflow';\r\nimport { \r\n  ZoomIn, \r\n  ZoomOut, \r\n  Maximize, \r\n  Save, \r\n  LayoutGrid, \r\n  ArrowLeftRight,\r\n  Lock,\r\n  Unlock\r\n} from 'lucide-react';\r\nimport { Button } from '../../../../../components/ui/button';\r\nimport { Separator } from '../../../../../components/ui/separator';\r\nimport { toast } from 'sonner';\r\nimport type { LayoutDirection } from '../utils/layout-calculator';\r\n\r\ninterface ChartControlsProps {\r\n  isLocked: boolean;\r\n  onLockToggle: () => void;\r\n  layoutDirection: LayoutDirection;\r\n  onLayoutDirectionChange: (direction: LayoutDirection) => void;\r\n  onAutoLayout: () => void;\r\n  onSaveLayout: () => void;\r\n}\r\n\r\nexport function ChartControls({\r\n  isLocked,\r\n  onLockToggle,\r\n  layoutDirection,\r\n  onLayoutDirectionChange,\r\n  onAutoLayout,\r\n  onSaveLayout\r\n}: ChartControlsProps) {\r\n  const { zoomIn, zoomOut, fitView } = useReactFlow();\r\n\r\n  const handleFitView = () => {\r\n    fitView({ duration: 200, padding: 0.2 });\r\n  };\r\n\r\n  const handleZoomIn = () => {\r\n    zoomIn({ duration: 200 });\r\n  };\r\n\r\n  const handleZoomOut = () => {\r\n    zoomOut({ duration: 200 });\r\n  };\r\n\r\n  const handleToggleDirection = () => {\r\n    const newDirection = layoutDirection === 'TB' ? 'LR' : 'TB';\r\n    onLayoutDirectionChange(newDirection);\r\n    toast.success(`Đã chuyển sang chế độ ${newDirection === 'TB' ? 'dọc' : 'ngang'}`);\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex flex-col gap-2 p-2 rounded-lg bg-card/80 backdrop-blur-sm border border-border shadow-md\">\r\n      {/* Hàng 1: Zoom & View Controls */}\r\n      <div className=\"flex items-center gap-1\">\r\n        <span className=\"text-xs font-medium text-muted-foreground mr-2\">Xem:</span>\r\n        <Button \r\n          variant=\"ghost\" \r\n          size=\"icon\" \r\n          className=\"h-9 w-10\" \r\n          onClick={handleZoomOut}\r\n          title=\"Thu nhỏ (Scroll xuống)\"\r\n        >\r\n          <ZoomOut className=\"h-4 w-4\" />\r\n        </Button>\r\n        \r\n        <Button \r\n          variant=\"ghost\" \r\n          size=\"icon\" \r\n          className=\"h-9 w-10\" \r\n          onClick={handleFitView}\r\n          title=\"Khung hình vừa\"\r\n        >\r\n          <Maximize className=\"h-4 w-4\" />\r\n        </Button>\r\n        \r\n        <Button \r\n          variant=\"ghost\" \r\n          size=\"icon\" \r\n          className=\"h-9 w-10\" \r\n          onClick={handleZoomIn}\r\n          title=\"Phóng to (Scroll lên)\"\r\n        >\r\n          <ZoomIn className=\"h-4 w-4\" />\r\n        </Button>\r\n\r\n        <Separator orientation=\"vertical\" className=\"h-6 mx-2\" />\r\n\r\n        {/* Lock toggle */}\r\n        <span className=\"text-xs font-medium text-muted-foreground mr-2\">Chế độ:</span>\r\n        <Button \r\n          variant={isLocked ? \"secondary\" : \"default\"} \r\n          size=\"sm\"\r\n          className=\"h-9 px-3\"\r\n          onClick={onLockToggle}\r\n          title={isLocked ? 'Mở khóa để chỉnh sửa' : 'Khóa để xem'}\r\n        >\r\n          {isLocked ? <Lock className=\"mr-1.5 h-3.5 w-3.5\" /> : <Unlock className=\"mr-1.5 h-3.5 w-3.5\" />}\r\n          <span className=\"text-xs\">{isLocked ? 'Khóa' : 'Mở'}</span>\r\n        </Button>\r\n      </div>\r\n\r\n      {/* Hàng 2: Layout Controls */}\r\n      <div className=\"flex items-center gap-1\">\r\n        <span className=\"text-xs font-medium text-muted-foreground mr-2\">Bố cục:</span>\r\n        <Button \r\n          variant=\"ghost\" \r\n          size=\"sm\"\r\n          className=\"h-9 px-3\"\r\n          onClick={onAutoLayout}\r\n          title=\"Tự động sắp xếp lại\"\r\n          disabled={isLocked}\r\n        >\r\n          <LayoutGrid className=\"mr-1.5 h-3.5 w-3.5\" />\r\n          <span className=\"text-xs\">Tự động</span>\r\n        </Button>\r\n        \r\n        <Button \r\n          variant=\"ghost\" \r\n          size=\"sm\"\r\n          className=\"h-9 px-3\"\r\n          onClick={onSaveLayout}\r\n          title=\"Lưu vị trí hiện tại\"\r\n          disabled={isLocked}\r\n        >\r\n          <Save className=\"mr-1.5 h-3.5 w-3.5\" />\r\n          <span className=\"text-xs\">Lưu</span>\r\n        </Button>\r\n        \r\n        <Button \r\n          variant=\"ghost\" \r\n          size=\"sm\"\r\n          className=\"h-9 px-3\"\r\n          onClick={handleToggleDirection}\r\n          title={`Chuyển sang ${layoutDirection === 'TB' ? 'ngang' : 'dọc'}`}\r\n        >\r\n          <ArrowLeftRight className=\"mr-1.5 h-3.5 w-3.5\" />\r\n          <span className=\"text-xs\">{layoutDirection === 'TB' ? 'Dọc' : 'Ngang'}</span>\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;AAGD;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AACA;AACA;;;;;;;AAYO,SAAS,cAAc,EAC5B,QAAQ,EACR,YAAY,EACZ,eAAe,EACf,uBAAuB,EACvB,YAAY,EACZ,YAAY,EACO;IACnB,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,GAAG,IAAA,4KAAY;IAEjD,MAAM,gBAAgB;QACpB,QAAQ;YAAE,UAAU;YAAK,SAAS;QAAI;IACxC;IAEA,MAAM,eAAe;QACnB,OAAO;YAAE,UAAU;QAAI;IACzB;IAEA,MAAM,gBAAgB;QACpB,QAAQ;YAAE,UAAU;QAAI;IAC1B;IAEA,MAAM,wBAAwB;QAC5B,MAAM,eAAe,oBAAoB,OAAO,OAAO;QACvD,wBAAwB;QACxB,iJAAK,CAAC,OAAO,CAAC,CAAC,sBAAsB,EAAE,iBAAiB,OAAO,QAAQ,SAAS;IAClF;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAK,WAAU;kCAAiD;;;;;;kCACjE,8OAAC,qIAAM;wBACL,SAAQ;wBACR,MAAK;wBACL,WAAU;wBACV,SAAS;wBACT,OAAM;kCAEN,cAAA,8OAAC,uNAAO;4BAAC,WAAU;;;;;;;;;;;kCAGrB,8OAAC,qIAAM;wBACL,SAAQ;wBACR,MAAK;wBACL,WAAU;wBACV,SAAS;wBACT,OAAM;kCAEN,cAAA,8OAAC,sNAAQ;4BAAC,WAAU;;;;;;;;;;;kCAGtB,8OAAC,qIAAM;wBACL,SAAQ;wBACR,MAAK;wBACL,WAAU;wBACV,SAAS;wBACT,OAAM;kCAEN,cAAA,8OAAC,oNAAM;4BAAC,WAAU;;;;;;;;;;;kCAGpB,8OAAC,2IAAS;wBAAC,aAAY;wBAAW,WAAU;;;;;;kCAG5C,8OAAC;wBAAK,WAAU;kCAAiD;;;;;;kCACjE,8OAAC,qIAAM;wBACL,SAAS,WAAW,cAAc;wBAClC,MAAK;wBACL,WAAU;wBACV,SAAS;wBACT,OAAO,WAAW,yBAAyB;;4BAE1C,yBAAW,8OAAC,0MAAI;gCAAC,WAAU;;;;;qDAA0B,8OAAC,sNAAM;gCAAC,WAAU;;;;;;0CACxE,8OAAC;gCAAK,WAAU;0CAAW,WAAW,SAAS;;;;;;;;;;;;;;;;;;0BAKnD,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAK,WAAU;kCAAiD;;;;;;kCACjE,8OAAC,qIAAM;wBACL,SAAQ;wBACR,MAAK;wBACL,WAAU;wBACV,SAAS;wBACT,OAAM;wBACN,UAAU;;0CAEV,8OAAC,gOAAU;gCAAC,WAAU;;;;;;0CACtB,8OAAC;gCAAK,WAAU;0CAAU;;;;;;;;;;;;kCAG5B,8OAAC,qIAAM;wBACL,SAAQ;wBACR,MAAK;wBACL,WAAU;wBACV,SAAS;wBACT,OAAM;wBACN,UAAU;;0CAEV,8OAAC,0MAAI;gCAAC,WAAU;;;;;;0CAChB,8OAAC;gCAAK,WAAU;0CAAU;;;;;;;;;;;;kCAG5B,8OAAC,qIAAM;wBACL,SAAQ;wBACR,MAAK;wBACL,WAAU;wBACV,SAAS;wBACT,OAAO,CAAC,YAAY,EAAE,oBAAoB,OAAO,UAAU,OAAO;;0CAElE,8OAAC,gPAAc;gCAAC,WAAU;;;;;;0CAC1B,8OAAC;gCAAK,WAAU;0CAAW,oBAAoB,OAAO,QAAQ;;;;;;;;;;;;;;;;;;;;;;;;AAKxE"}},
    {"offset": {"line": 1801, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/id-utils.ts"],"sourcesContent":["/**\r\n * ID Utilities\r\n * Helpers for generating and validating IDs (systemId & business id)\r\n */\r\n\r\nimport { getPrefix, type EntityType } from './smart-prefix';\r\nimport { ID_CONFIG } from './id-config';\r\n\r\n// Re-export EntityType for convenience\r\nexport type { EntityType } from './smart-prefix';\r\n\r\n/**\r\n * Generate SystemId (6 digits, immutable, internal use only)\r\n * Format: SYSTEMID_PREFIX + 6 digits (e.g., \"EMP000001\", \"CUSTOMER000001\", \"ORDER000001\")\r\n * Uses systemIdPrefix from ID_CONFIG (English full words)\r\n */\r\nexport function generateSystemId(entityType: EntityType, counter: number): string {\r\n  const config = ID_CONFIG[entityType];\r\n  if (!config) {\r\n    throw new Error(`No configuration found for entity type: ${entityType}`);\r\n  }\r\n  const prefix = config.systemIdPrefix;\r\n  const digitCount = config.digitCount || 6;\r\n  return `${prefix}${String(counter).padStart(digitCount, '0')}`;\r\n}\r\n\r\n/**\r\n * Generate Business ID (6 digits, user-facing, editable)\r\n * Format: PREFIX + 6 digits (e.g., \"NV000001\", \"KH000001\", \"CTV000001\")\r\n * All entities use same 6-digit format for consistency\r\n * \r\n * @param entityType - Entity type from smart-prefix\r\n * @param counter - Current counter value\r\n * @param customId - Optional custom ID from user input\r\n * @returns Generated ID or validated custom ID\r\n */\r\nexport function generateBusinessId(\r\n  entityType: EntityType, \r\n  counter: number,\r\n  customId?: string\r\n): string {\r\n  // If user provided custom ID, validate and return it\r\n  if (customId && customId.trim()) {\r\n    const sanitized = sanitizeBusinessId(customId);\r\n    if (!sanitized) {\r\n      throw new Error('Mã không hợp lệ! Chỉ được phép sử dụng chữ cái và số.');\r\n    }\r\n    return sanitized;\r\n  }\r\n  \r\n  // Otherwise, auto-generate\r\n  const prefix = getPrefix(entityType);\r\n  return `${prefix}${String(counter).padStart(6, '0')}`;\r\n}\r\n\r\n/**\r\n * Sanitize business ID\r\n * - Remove special characters (keep only letters and numbers)\r\n * - Convert to uppercase\r\n * - Trim whitespace\r\n * \r\n * @param id - Raw user input\r\n * @returns Sanitized ID or null if invalid\r\n */\r\nexport function sanitizeBusinessId(id: string): string | null {\r\n  if (!id || typeof id !== 'string') return null;\r\n  \r\n  // Remove all special characters, keep only alphanumeric\r\n  const cleaned = id.trim().replace(/[^a-zA-Z0-9]/g, '');\r\n  \r\n  if (!cleaned) return null;\r\n  \r\n  // Convert to uppercase for consistency\r\n  return cleaned.toUpperCase();\r\n}\r\n\r\n/**\r\n * Validate business ID uniqueness (case-insensitive)\r\n * \r\n * @param id - ID to check\r\n * @param existingIds - Array of existing IDs in the system\r\n * @param currentId - Current ID (for edit mode, to exclude self)\r\n * @returns true if unique, false if duplicate\r\n */\r\nexport function isBusinessIdUnique(\r\n  id: string,\r\n  existingIds: string[],\r\n  currentId?: string\r\n): boolean {\r\n  if (!id) return false;\r\n  \r\n  const normalizedId = id.toUpperCase();\r\n  const normalizedCurrentId = currentId?.toUpperCase();\r\n  \r\n  return !existingIds.some(existingId => {\r\n    // ✅ Filter out empty/undefined IDs\r\n    if (!existingId || existingId.trim() === '') return false;\r\n    \r\n    const normalizedExisting = existingId.toUpperCase();\r\n    // Skip self-comparison in edit mode\r\n    if (normalizedCurrentId && normalizedExisting === normalizedCurrentId) {\r\n      return false;\r\n    }\r\n    return normalizedExisting === normalizedId;\r\n  });\r\n}\r\n\r\n/**\r\n * Extract counter from system ID\r\n * Used to initialize counter when loading from localStorage\r\n * Supports both 6, 7 and 8 digits\r\n * \r\n * @param systemId - System ID to parse (e.g., \"EMP000001\", \"CUSTOMER000001\", \"WARRANTY0000001\")\r\n * @param prefix - Expected systemIdPrefix (e.g., \"EMP\", \"CUSTOMER\", \"WARRANTY\")\r\n * @returns Counter value or 0 if invalid\r\n */\r\nexport function extractCounterFromSystemId(systemId: string, prefix: string): number {\r\n  if (!systemId || typeof systemId !== 'string') return 0;\r\n  \r\n  // Try different digit counts (most entities use 6 digits, some use 7-8)\r\n  const regex8 = new RegExp(`^${prefix}(\\\\d{8})$`);\r\n  const regex7 = new RegExp(`^${prefix}(\\\\d{7})$`);\r\n  const regex6 = new RegExp(`^${prefix}(\\\\d{6})$`);\r\n  \r\n  const match8 = systemId.match(regex8);\r\n  if (match8) return parseInt(match8[1], 10);\r\n  \r\n  const match7 = systemId.match(regex7);\r\n  if (match7) return parseInt(match7[1], 10);\r\n  \r\n  const match6 = systemId.match(regex6);\r\n  if (match6) return parseInt(match6[1], 10);\r\n  \r\n  return 0;\r\n}\r\n\r\n/**\r\n * Extract counter from business ID\r\n * Used to initialize counter when loading from localStorage\r\n * \r\n * @param businessId - Business ID to parse (e.g., \"NV000001\")\r\n * @param prefix - Expected prefix (e.g., \"NV\")\r\n * @returns Counter value or 0 if invalid\r\n */\r\nexport function extractCounterFromBusinessId(businessId: string, prefix: string): number {\r\n  if (!businessId || typeof businessId !== 'string') return 0;\r\n  const regex = new RegExp(`^${prefix}(\\\\d+)$`);\r\n  const match = businessId.match(regex);\r\n  return match ? parseInt(match[1], 10) : 0;\r\n}\r\n\r\n/**\r\n * Get max counter from array of items (for systemId)\r\n * \r\n * @param items - Array of items with systemId\r\n * @param prefix - Prefix to match\r\n * @returns Maximum counter value\r\n */\r\nexport function getMaxSystemIdCounter<T extends { systemId: string }>(\r\n  items: T[],\r\n  prefix: string\r\n): number {\r\n  if (!items || !Array.isArray(items)) return 0;\r\n  \r\n  let maxCounter = 0;\r\n  \r\n  items.forEach(item => {\r\n    if (!item || !item.systemId) return;\r\n    const counter = extractCounterFromSystemId(item.systemId, prefix);\r\n    if (counter > maxCounter) {\r\n      maxCounter = counter;\r\n    }\r\n  });\r\n  \r\n  return maxCounter;\r\n}\r\n\r\n/**\r\n * Get max counter from array of items (for business id)\r\n * Only counts auto-generated IDs (PREFIX + digits)\r\n * \r\n * @param items - Array of items with id\r\n * @param prefix - Prefix to match\r\n * @returns Maximum counter value\r\n */\r\nexport function getMaxBusinessIdCounter<T extends { id: string }>(\r\n  items: T[],\r\n  prefix: string\r\n): number {\r\n  if (!items || !Array.isArray(items)) return 0;\r\n  \r\n  let maxCounter = 0;\r\n  \r\n  items.forEach(item => {\r\n    if (!item || !item.id) return;\r\n    const counter = extractCounterFromBusinessId(item.id, prefix);\r\n    if (counter > maxCounter) {\r\n      maxCounter = counter;\r\n    }\r\n  });\r\n  \r\n  return maxCounter;\r\n}\r\n\r\n/**\r\n * Format ID for display\r\n * Adds spacing for readability\r\n * \r\n * @param id - ID to format\r\n * @returns Formatted ID (e.g., \"NV-000001\", \"KH-000123\")\r\n */\r\nexport function formatIdForDisplay(id: string): string {\r\n  // Match pattern: PREFIX followed by numbers\r\n  const match = id.match(/^([A-Z]+)(\\d+)$/);\r\n  if (!match) return id;\r\n  \r\n  const [, prefix, numbers] = match;\r\n  return `${prefix}-${numbers}`;\r\n}\r\n\r\n/**\r\n * Validate ID format\r\n * Check if ID follows valid pattern (letters + numbers only)\r\n * \r\n * @param id - ID to validate\r\n * @returns true if valid format\r\n */\r\nexport function isValidIdFormat(id: string): boolean {\r\n  if (!id || typeof id !== 'string') return false;\r\n  \r\n  // Only alphanumeric characters allowed\r\n  const regex = /^[A-Z0-9]+$/i;\r\n  return regex.test(id);\r\n}\r\n\r\n/**\r\n * Generate suggested IDs based on entity type\r\n * Useful for autocomplete or placeholder text\r\n * \r\n * @param entityType - Entity type\r\n * @param counter - Current counter\r\n * @param count - Number of suggestions\r\n * @returns Array of suggested IDs\r\n */\r\nexport function generateSuggestedIds(\r\n  entityType: EntityType,\r\n  counter: number,\r\n  count: number = 3\r\n): string[] {\r\n  const suggestions: string[] = [];\r\n  const prefix = getPrefix(entityType);\r\n  \r\n  for (let i = 0; i < count; i++) {\r\n    suggestions.push(`${prefix}${String(counter + i + 1).padStart(6, '0')}`);\r\n  }\r\n  \r\n  return suggestions;\r\n}\r\n\r\n/**\r\n * ✨ Find next available business ID\r\n * Checks existing IDs and increments counter until finding a unique ID\r\n * \r\n * @param prefix - ID prefix (e.g., 'PT', 'PC', 'NV')\r\n * @param existingIds - Array of existing business IDs\r\n * @param startCounter - Starting counter value\r\n * @param digitCount - Number of digits (default: 6)\r\n * @returns Object with nextId and updatedCounter\r\n */\r\nexport function findNextAvailableBusinessId(\r\n  prefix: string,\r\n  existingIds: string[],\r\n  startCounter: number,\r\n  digitCount: number = 6\r\n): { nextId: string; updatedCounter: number } {\r\n  let counter = startCounter;\r\n  let nextId: string;\r\n  \r\n  // Keep incrementing until we find a unique ID\r\n  do {\r\n    counter++;\r\n    nextId = `${prefix}${String(counter).padStart(digitCount, '0')}`;\r\n  } while (existingIds.some(id => id === nextId));\r\n  \r\n  return {\r\n    nextId,\r\n    updatedCounter: counter\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1961, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/store-factory.ts"],"sourcesContent":["import { create } from 'zustand';\r\n// persist, createJSONStorage removed - database is now source of truth\r\nimport { \r\n  generateSystemId, \r\n  generateBusinessId, \r\n  isBusinessIdUnique,\r\n  getMaxSystemIdCounter,\r\n  getMaxBusinessIdCounter,\r\n  findNextAvailableBusinessId,\r\n  type EntityType \r\n} from './id-utils';\r\nimport { getPrefix } from './smart-prefix';\r\nimport { ID_CONFIG, type SystemId, type BusinessId, createSystemId, createBusinessId as brandBusinessId } from './id-config';\r\n\r\nconst SYSTEM_FALLBACK_ID: SystemId = createSystemId('SYS000000');\r\n\r\nconst asSystemIdFallback = (): SystemId => SYSTEM_FALLBACK_ID;\r\n\r\n// ✅ API Sync helper for store-factory\r\nasync function syncToAPI<T>(\r\n  apiEndpoint: string,\r\n  action: 'create' | 'update' | 'delete' | 'restore',\r\n  data: T | { systemId: SystemId },\r\n  systemId?: SystemId\r\n): Promise<boolean> {\r\n  try {\r\n    const endpoint = action === 'create' \r\n      ? apiEndpoint \r\n      : `${apiEndpoint}/${systemId || (data as any).systemId}`;\r\n    \r\n    const method = action === 'create' ? 'POST' \r\n      : action === 'update' ? 'PATCH' \r\n      : action === 'delete' ? 'DELETE'\r\n      : 'PATCH'; // restore uses PATCH\r\n    \r\n    const response = await fetch(endpoint, {\r\n      method,\r\n      headers: { 'Content-Type': 'application/json' },\r\n      credentials: 'include',\r\n      body: action !== 'delete' ? JSON.stringify(data) : undefined,\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      console.warn(`[Store Factory API] ${action} failed for ${apiEndpoint}:`, response.status);\r\n    }\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error(`[Store Factory API] ${action} error for ${apiEndpoint}:`, error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Item with SystemId (branded type)\r\nexport type ItemWithSystemId = { systemId: SystemId; [key: string]: any };\r\n\r\n// ✅ Counter state for ID generation\r\nexport type CounterState = {\r\n  systemId: number;\r\n  businessId: number;\r\n};\r\n\r\nexport type CrudState<T extends ItemWithSystemId> = {\r\n  data: T[];\r\n  _counters: CounterState; // ✅ Persisted counters\r\n  _initialized: boolean; // ✅ Track if loaded from API\r\n  add: (item: Omit<T, 'systemId'>) => T;\r\n  addMultiple: (items: Omit<T, 'systemId'>[]) => void;\r\n  update: (systemId: SystemId, item: Partial<T>) => void; // ✅ Accept partial updates\r\n  remove: (systemId: SystemId) => void; // ✅ Branded type\r\n  hardDelete: (systemId: SystemId) => void; // ✅ Branded type\r\n  restore: (systemId: SystemId) => void; // ✅ Branded type\r\n  findById: (systemId: SystemId | string) => T | undefined; // ✅ Branded type\r\n  getActive: () => T[];\r\n  getDeleted: () => T[];\r\n  loadFromAPI: () => Promise<void>; // ✅ Load data from database\r\n};\r\n\r\nexport const createCrudStore = <T extends ItemWithSystemId>(\r\n  _initialData: T[], // @deprecated - Kept for backward compatibility but NO LONGER USED\r\n  entityType: EntityType, // Changed from idPrefix to entityType\r\n  options?: {\r\n    businessIdField?: keyof T; // Field name for business ID (default: 'id')\r\n    persistKey?: string; // @deprecated - No longer used, kept for backward compatibility\r\n    getCurrentUser?: () => string | undefined; // Function to get current user systemId\r\n    apiEndpoint?: string; // ✅ API endpoint for database sync (e.g., '/api/employees')\r\n  }\r\n) => {\r\n  const businessPrefix = getPrefix(entityType); // Vietnamese prefix for Business ID (NV, KH, DH)\r\n  const config = ID_CONFIG[entityType];\r\n  const systemIdPrefix = config?.systemIdPrefix || entityType.toUpperCase(); // English prefix for SystemId (EMP, CUSTOMER, ORDER)\r\n  \r\n  const businessIdField = options?.businessIdField ?? 'id';\r\n  // const persistKey = options?.persistKey; // @deprecated - No longer used\r\n  const getCurrentUser = options?.getCurrentUser;\r\n  const apiEndpoint = options?.apiEndpoint;\r\n\r\n  // ✅ CHANGED: Start with empty array - database is source of truth\r\n  // Mock data files (data.ts) are NO LONGER USED for runtime\r\n  const normalizedInitialData: T[] = [];\r\n\r\n  const storeConfig = (set: any, get: any) => ({\r\n    data: normalizedInitialData, // ✅ Start empty - data loaded via React Query\r\n    // ✅ Counters start at 0 - will be initialized from API via loadFromAPI()\r\n    _counters: {\r\n      systemId: 0,\r\n      businessId: 0\r\n    },\r\n    _initialized: false, // ✅ Track API initialization\r\n    add: (item: Omit<T, 'systemId'>): T => {\r\n        // ✅ Get counters from state (persisted)\r\n        const currentCounters = get()._counters;\r\n        const newSystemIdCounter = currentCounters.systemId + 1;\r\n        const newSystemId = createSystemId(generateSystemId(entityType, newSystemIdCounter));\r\n        \r\n        // Generate or validate Business ID (if field exists)\r\n        let finalItem = { ...item } as any;\r\n        let newBusinessIdCounter = currentCounters.businessId;\r\n        \r\n        if (businessIdField in item) {\r\n          const customId = (item as any)[businessIdField];\r\n          const existingIds = get().data.map((d: any) => d[businessIdField]);\r\n          \r\n          // ✅ If customId provided, validate uniqueness\r\n          if (customId && customId.trim()) {\r\n            if (!isBusinessIdUnique(customId, existingIds)) {\r\n              throw new Error(`Mã \"${customId}\" đã tồn tại! Vui lòng sử dụng mã khác.`);\r\n            }\r\n            finalItem[businessIdField] = customId.trim().toUpperCase();\r\n          } else {\r\n            // ✅ Auto-generate with findNextAvailableBusinessId\r\n            const digitCount = 6; // All entities use 6 digits\r\n            const result = findNextAvailableBusinessId(businessPrefix, existingIds, newBusinessIdCounter, digitCount);\r\n            finalItem[businessIdField] = result.nextId;\r\n            newBusinessIdCounter = result.updatedCounter;\r\n          }\r\n        }\r\n        \r\n        const now = new Date().toISOString();\r\n        const currentUser = getCurrentUser?.();\r\n        const newItem = { \r\n          ...finalItem, \r\n          systemId: newSystemId, // ✅ Branded SystemId\r\n          createdAt: finalItem.createdAt || now,\r\n          updatedAt: now,\r\n          createdBy: finalItem.createdBy || currentUser,\r\n          updatedBy: currentUser,\r\n        } as unknown as T;\r\n        \r\n        // ✅ Update both data and counters atomically\r\n        set((state: any) => ({ \r\n          data: [...state.data, newItem],\r\n          _counters: {\r\n            systemId: newSystemIdCounter,\r\n            businessId: newBusinessIdCounter\r\n          }\r\n        }));\r\n        \r\n        // ✅ Sync to API in background\r\n        if (apiEndpoint) {\r\n          syncToAPI(apiEndpoint, 'create', newItem).catch(console.error);\r\n        }\r\n        \r\n        return newItem;\r\n    },\r\n    addMultiple: (items: Omit<T, 'systemId'>[]) => \r\n        set((state: any) => {\r\n            const now = new Date().toISOString();\r\n            const currentUser = getCurrentUser?.();\r\n            const newItems: T[] = [];\r\n            const digitCount = 6; // All entities use 6 digits\r\n            \r\n            // ✅ Start from current counters\r\n            let currentSystemIdCounter = state._counters.systemId;\r\n            let currentBusinessIdCounter = state._counters.businessId;\r\n            \r\n            items.forEach(item => {\r\n                // ✅ Generate SystemId from current counter\r\n                currentSystemIdCounter++;\r\n                const newSystemId = createSystemId(generateSystemId(entityType, currentSystemIdCounter));\r\n                \r\n                // Generate or validate Business ID (if field exists)\r\n                let finalItem = { ...item } as any;\r\n                if (businessIdField in item) {\r\n                  const customId = (item as any)[businessIdField];\r\n                  \r\n                  // Collect existing IDs (from state + already added in this batch)\r\n                  const existingIds = [\r\n                    ...state.data.map((d: any) => d[businessIdField]),\r\n                    ...newItems.map((d: any) => d[businessIdField])\r\n                  ];\r\n                  \r\n                  // ✅ If customId provided, validate uniqueness\r\n                  if (customId && customId.trim()) {\r\n                    if (!isBusinessIdUnique(customId, existingIds)) {\r\n                      throw new Error(`Mã \"${customId}\" đã tồn tại! Vui lòng sử dụng mã khác.`);\r\n                    }\r\n                    finalItem[businessIdField] = customId.trim().toUpperCase();\r\n                  } else {\r\n                    // ✅ Auto-generate with findNextAvailableBusinessId\r\n                    const result = findNextAvailableBusinessId(businessPrefix, existingIds, currentBusinessIdCounter, digitCount);\r\n                    finalItem[businessIdField] = result.nextId;\r\n                    currentBusinessIdCounter = result.updatedCounter;\r\n                  }\r\n                }\r\n                \r\n                newItems.push({ \r\n                  ...finalItem, \r\n                  systemId: newSystemId,\r\n                  createdAt: now,\r\n                  updatedAt: now,\r\n                  createdBy: currentUser,\r\n                  updatedBy: currentUser,\r\n                } as unknown as T);\r\n            });\r\n            \r\n            // ✅ Update both data and counters\r\n            const result = { \r\n              data: [...state.data, ...newItems],\r\n              _counters: {\r\n                systemId: currentSystemIdCounter,\r\n                businessId: currentBusinessIdCounter\r\n              }\r\n            };\r\n            \r\n            // ✅ Sync to API in background (batch)\r\n            if (apiEndpoint) {\r\n              newItems.forEach(item => {\r\n                syncToAPI(apiEndpoint, 'create', item).catch(console.error);\r\n              });\r\n            }\r\n            \r\n            return result;\r\n        }),\r\n    update: (systemId: SystemId, updatedItem: Partial<T>) => {\r\n      // Validate unique business ID (case-insensitive, skip self)\r\n      if (businessIdField in updatedItem) {\r\n        const businessId = (updatedItem as any)[businessIdField];\r\n        const existingIds = get().data\r\n          .filter((d: any) => d.systemId !== systemId)\r\n          .map((d: any) => d[businessIdField]);\r\n        \r\n        if (businessId && !isBusinessIdUnique(businessId, existingIds)) {\r\n          throw new Error(`Mã \"${businessId}\" đã tồn tại! Vui lòng sử dụng mã khác.`);\r\n        }\r\n      }\r\n\r\n      const now = new Date().toISOString();\r\n      const currentUser = getCurrentUser?.();\r\n      set((state: any) => ({\r\n        data: state.data.map((item: T) =>\r\n          item.systemId === systemId \r\n            ? { ...item, ...updatedItem, updatedAt: now, updatedBy: currentUser } as T\r\n            : item\r\n        ),\r\n      }));\r\n      \r\n      // ✅ Sync to API in background\r\n      if (apiEndpoint) {\r\n        const fullItem = get().data.find((item: T) => item.systemId === systemId);\r\n        if (fullItem) {\r\n          syncToAPI(apiEndpoint, 'update', fullItem, systemId).catch(console.error);\r\n        }\r\n      }\r\n    },\r\n    remove: (systemId: SystemId) => {\r\n      // Soft delete - mark as deleted\r\n      const now = new Date().toISOString();\r\n      set((state: any) => ({\r\n        data: state.data.map((item: T) =>\r\n          item.systemId === systemId\r\n            ? { ...item, isDeleted: true, deletedAt: now } as T\r\n            : item\r\n        ),\r\n      }));\r\n      \r\n      // ✅ Sync to API in background\r\n      if (apiEndpoint) {\r\n        const item = get().data.find((item: T) => item.systemId === systemId);\r\n        if (item) {\r\n          syncToAPI(apiEndpoint, 'update', { ...item, isDeleted: true, deletedAt: now }, systemId).catch(console.error);\r\n        }\r\n      }\r\n    },\r\n    hardDelete: (systemId: SystemId) => {\r\n      // Permanent delete - remove from array\r\n      set((state: any) => ({\r\n        data: state.data.filter((item: T) => item.systemId !== systemId),\r\n      }));\r\n      \r\n      // ✅ Sync to API in background\r\n      if (apiEndpoint) {\r\n        syncToAPI(apiEndpoint, 'delete', { systemId }, systemId).catch(console.error);\r\n      }\r\n    },\r\n    restore: (systemId: SystemId) => {\r\n      // Restore soft-deleted item\r\n      set((state: any) => ({\r\n        data: state.data.map((item: T) =>\r\n          item.systemId === systemId\r\n            ? { ...item, isDeleted: false, deletedAt: null } as T\r\n            : item\r\n        ),\r\n      }));\r\n      \r\n      // ✅ Sync to API in background\r\n      if (apiEndpoint) {\r\n        const item = get().data.find((item: T) => item.systemId === systemId);\r\n        if (item) {\r\n          syncToAPI(apiEndpoint, 'restore', { ...item, isDeleted: false, deletedAt: null }, systemId).catch(console.error);\r\n        }\r\n      }\r\n    },\r\n    getActive: () => get().data.filter((item: any) => !item.isDeleted),\r\n    getDeleted: () => get().data.filter((item: any) => item.isDeleted),\r\n    findById: (id: SystemId | string) => get().data.find((item: T) => item.systemId === id || (item as any).id === id),\r\n    \r\n    // ✅ Load data from database API - OPTIMIZED: No more limit=10000!\r\n    // This is now only used for counter initialization, NOT for loading all data\r\n    // Use React Query hooks for data fetching with proper pagination\r\n    loadFromAPI: async () => {\r\n      if (!apiEndpoint) return;\r\n      if (get()._initialized) return;\r\n      \r\n      try {\r\n        // Only fetch minimal data needed to initialize counters\r\n        // Actual data loading should be done via React Query hooks\r\n        const response = await fetch(`${apiEndpoint}?limit=1&sortBy=systemId&sortOrder=desc`, {\r\n          credentials: 'include',\r\n        });\r\n        if (response.ok) {\r\n          const json = await response.json();\r\n          const pagination = json.pagination || {};\r\n          const lastItem = json.data?.[0];\r\n          \r\n          // Initialize counters from the latest item (highest IDs)\r\n          const newCounters = {\r\n            systemId: lastItem ? getMaxSystemIdCounter([lastItem], systemIdPrefix) : 0,\r\n            businessId: (lastItem && options?.businessIdField)\r\n              ? getMaxBusinessIdCounter([lastItem] as any[], businessPrefix)\r\n              : 0\r\n          };\r\n          \r\n          set({ \r\n            data: [], // Don't store data in Zustand anymore - use React Query\r\n            _counters: newCounters,\r\n            _initialized: true \r\n          });\r\n          \r\n          console.log(`[Store Factory] ${apiEndpoint} initialized. Total records: ${pagination.total || 'unknown'}`);\r\n        }\r\n      } catch (error) {\r\n        console.error(`[Store Factory] loadFromAPI error for ${apiEndpoint}:`, error);\r\n        // Still mark as initialized to prevent infinite retry\r\n        set({ _initialized: true });\r\n      }\r\n    },\r\n  });\r\n\r\n  // ✅ SIMPLIFIED: No localStorage persistence, database is source of truth\r\n  // Data is loaded via ApiSyncProvider on app init\r\n  return create<CrudState<T>>(storeConfig);\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2269, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/repositories/in-memory-repository.ts"],"sourcesContent":["import type { SystemId } from '../lib/id-types';\r\nimport type { CrudState, ItemWithSystemId } from '../lib/store-factory';\r\nimport type { CrudRepository } from './types';\r\n\r\n/**\r\n * Adapter mặc định dùng trực tiếp Zustand store để giả lập tầng persistence.\r\n * Giữ cùng signature với repository interface để sau này thay bằng API/DB dễ dàng.\r\n */\r\nexport const createInMemoryRepository = <TEntity extends ItemWithSystemId>(\r\n  stateGetter: () => CrudState<TEntity>\r\n): CrudRepository<TEntity, Omit<TEntity, 'systemId'>, Partial<TEntity>> => {\r\n  const getStore = () => stateGetter();\r\n\r\n  const ensureEntity = (systemId: SystemId): TEntity => {\r\n    const entity = getStore().findById(systemId);\r\n    if (!entity) {\r\n      throw new Error(`Không tìm thấy entity với systemId=${systemId}`);\r\n    }\r\n    return entity;\r\n  };\r\n\r\n  return {\r\n    async list() {\r\n      return [...getStore().data];\r\n    },\r\n    async getById(systemId) {\r\n      return getStore().findById(systemId);\r\n    },\r\n    async create(payload) {\r\n      return getStore().add(payload as Omit<TEntity, 'systemId'>);\r\n    },\r\n    async update(systemId, payload) {\r\n      ensureEntity(systemId);\r\n      getStore().update(systemId, payload);\r\n      return ensureEntity(systemId);\r\n    },\r\n    async softDelete(systemId) {\r\n      ensureEntity(systemId);\r\n      getStore().remove(systemId);\r\n    },\r\n    async restore(systemId) {\r\n      ensureEntity(systemId);\r\n      getStore().restore(systemId);\r\n      return getStore().findById(systemId);\r\n    },\r\n    async hardDelete(systemId) {\r\n      ensureEntity(systemId);\r\n      getStore().hardDelete(systemId);\r\n    },\r\n  };\r\n};\r\n"],"names":[],"mappings":";;;;AAQO,MAAM,2BAA2B,CACtC;IAEA,MAAM,WAAW,IAAM;IAEvB,MAAM,eAAe,CAAC;QACpB,MAAM,SAAS,WAAW,QAAQ,CAAC;QACnC,IAAI,CAAC,QAAQ;YACX,MAAM,IAAI,MAAM,CAAC,mCAAmC,EAAE,UAAU;QAClE;QACA,OAAO;IACT;IAEA,OAAO;QACL,MAAM;YACJ,OAAO;mBAAI,WAAW,IAAI;aAAC;QAC7B;QACA,MAAM,SAAQ,QAAQ;YACpB,OAAO,WAAW,QAAQ,CAAC;QAC7B;QACA,MAAM,QAAO,OAAO;YAClB,OAAO,WAAW,GAAG,CAAC;QACxB;QACA,MAAM,QAAO,QAAQ,EAAE,OAAO;YAC5B,aAAa;YACb,WAAW,MAAM,CAAC,UAAU;YAC5B,OAAO,aAAa;QACtB;QACA,MAAM,YAAW,QAAQ;YACvB,aAAa;YACb,WAAW,MAAM,CAAC;QACpB;QACA,MAAM,SAAQ,QAAQ;YACpB,aAAa;YACb,WAAW,OAAO,CAAC;YACnB,OAAO,WAAW,QAAQ,CAAC;QAC7B;QACA,MAAM,YAAW,QAAQ;YACvB,aAAa;YACb,WAAW,UAAU,CAAC;QACxB;IACF;AACF"}},
    {"offset": {"line": 2318, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/activity-history-helper.ts"],"sourcesContent":["/**\r\n * Activity History Helper\r\n * \r\n * Helper để tạo các entry lịch sử hoạt động một cách nhất quán\r\n * Dùng chung cho tất cả các modules trong hệ thống\r\n * \r\n * NOTE: Đã remove import useEmployeeStore để tránh circular dependency\r\n * và cải thiện compile time\r\n */\r\n\r\nimport type { HistoryEntry } from '../components/ActivityHistory';\r\nimport { getCurrentUserInfo as getAuthUserInfo } from '../contexts/auth-context';\r\nimport type { SystemId } from './id-types';\r\n\r\n// Re-export HistoryEntry type for convenience\r\nexport type { HistoryEntry } from '../components/ActivityHistory';\r\n\r\n/**\r\n * Lấy thông tin người dùng hiện tại từ auth context\r\n * NOTE: Avatar lookup từ employee store đã bị remove để tránh circular dependency\r\n */\r\nexport function getCurrentUserInfo(): { systemId: string; name: string; avatar?: string } {\r\n  const authInfo = getAuthUserInfo();\r\n  \r\n  return {\r\n    systemId: authInfo.systemId || 'SYSTEM',\r\n    name: authInfo.name || 'Hệ thống',\r\n    avatar: undefined, // Avatar will be fetched by component if needed\r\n  };\r\n}\r\n\r\n/**\r\n * Lấy thông tin nhân viên từ systemId\r\n * NOTE: This function now requires employee data to be passed in\r\n * to avoid circular dependency with employee store\r\n */\r\nexport function getEmployeeInfoFromData(\r\n  employeeSystemId: SystemId | string,\r\n  employees: Array<{ systemId: string; fullName: string; avatarUrl?: string }>\r\n): { systemId: string; name: string; avatar?: string } {\r\n  const employee = employees.find(e => e.systemId === employeeSystemId);\r\n  \r\n  if (employee) {\r\n    return {\r\n      systemId: employee.systemId,\r\n      name: employee.fullName,\r\n      avatar: employee.avatarUrl,\r\n    };\r\n  }\r\n  \r\n  // Fallback to system\r\n  return {\r\n    systemId: String(employeeSystemId) || 'SYSTEM',\r\n    name: 'Hệ thống',\r\n  };\r\n}\r\n\r\n/**\r\n * @deprecated Use getEmployeeInfoFromData instead\r\n */\r\nexport function getEmployeeInfo(employeeSystemId: SystemId | string): { systemId: string; name: string; avatar?: string } {\r\n  // Return minimal info without employee store lookup\r\n  return {\r\n    systemId: String(employeeSystemId) || 'SYSTEM',\r\n    name: 'Hệ thống',\r\n  };\r\n}\r\n\r\n/**\r\n * Tạo một history entry mới\r\n */\r\nexport function createHistoryEntry(\r\n  action: HistoryEntry['action'],\r\n  userOrDescription: { systemId: string; name: string; avatar?: string } | string,\r\n  descriptionOrMetadata?: string | HistoryEntry['metadata'],\r\n  metadata?: HistoryEntry['metadata']\r\n): HistoryEntry {\r\n  const hasUserObject = typeof userOrDescription === 'object' && userOrDescription !== null;\r\n  const user = hasUserObject ? userOrDescription : getCurrentUserInfo();\r\n  const description = (hasUserObject ? descriptionOrMetadata : userOrDescription) as string | undefined;\r\n  const meta = (hasUserObject ? metadata : descriptionOrMetadata) as HistoryEntry['metadata'] | undefined;\r\n\r\n  return {\r\n    id: `history-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n    action,\r\n    timestamp: new Date(),\r\n    user: {\r\n      systemId: user.systemId,\r\n      name: user.name,\r\n      avatar: user.avatar,\r\n    },\r\n    description: description ?? '',\r\n    metadata: meta,\r\n  };\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"created\"\r\n */\r\nexport function createCreatedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('created', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"updated\"\r\n */\r\nexport function createUpdatedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('updated', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"status_changed\"\r\n */\r\nexport function createStatusChangedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  oldStatus: string,\r\n  newStatus: string,\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry(\r\n    'status_changed',\r\n    user,\r\n    description,\r\n    { field: 'status', oldValue: oldStatus, newValue: newStatus }\r\n  );\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"deleted\"\r\n */\r\nexport function createDeletedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('deleted', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"assigned\"\r\n */\r\nexport function createAssignedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('assigned', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"payment_made\"\r\n */\r\nexport function createPaymentEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('payment_made', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"comment_added\"\r\n */\r\nexport function createCommentEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('comment_added', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"cancelled\"\r\n */\r\nexport function createCancelledEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('cancelled', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"verified\"\r\n */\r\nexport function createVerifiedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('verified', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"ended\"\r\n */\r\nexport function createEndedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('ended', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"reopened\"\r\n */\r\nexport function createReopenedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('reopened', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho product actions\r\n */\r\nexport function createProductEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  action: 'product_added' | 'product_updated' | 'product_removed',\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry(action, user, description);\r\n}\r\n\r\n/**\r\n * Helper để append history entry vào existing array\r\n */\r\nexport function appendHistoryEntry(\r\n  existingHistory: HistoryEntry[] | undefined,\r\n  ...newEntries: HistoryEntry[]\r\n): HistoryEntry[] {\r\n  return [...(existingHistory || []), ...newEntries];\r\n}\r\n\r\n/**\r\n * Helper để tạo nhiều history entries cùng lúc\r\n */\r\nexport function createBulkUpdateEntries(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  changes: Array<{ field: string; description: string }>\r\n): HistoryEntry[] {\r\n  return changes.map(change => createHistoryEntry('updated', user, change.description));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2467, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/employees/store.ts"],"sourcesContent":["import { createCrudStore, CrudState } from '../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { Employee } from './types';\r\nimport type { HistoryEntry } from '../../components/ActivityHistory';\r\nimport Fuse from 'fuse.js';\r\nimport { getCurrentUserSystemId } from '../../contexts/auth-context';\r\nimport { registerBreadcrumbStore } from '../../lib/breadcrumb-generator'; // ✅ NEW\r\nimport { type SystemId } from '../../lib/id-types';\r\nimport { createInMemoryRepository } from '../../repositories/in-memory-repository';\r\nimport { \r\n  createHistoryEntry, \r\n  getCurrentUserInfo,\r\n  appendHistoryEntry \r\n} from '../../lib/activity-history-helper';\r\n\r\ntype EmployeePersistenceAdapter = {\r\n  create: (payload: Omit<Employee, 'systemId'>) => Promise<Employee>;\r\n  update: (systemId: SystemId, payload: Partial<Employee>) => Promise<Employee>;\r\n  softDelete: (systemId: SystemId) => Promise<void>;\r\n  restore: (systemId: SystemId) => Promise<Employee | undefined>;\r\n  hardDelete: (systemId: SystemId) => Promise<void>;\r\n};\r\n\r\nconst baseStore = createCrudStore<Employee>([], 'employees', {\r\n  businessIdField: 'id',\r\n  getCurrentUser: getCurrentUserSystemId, // ✅ Track who creates/updates\r\n  apiEndpoint: '/api/employees',\r\n});\r\n\r\n// ✅ Wrap add method to include activity history\r\nconst originalAdd = baseStore.getState().add;\r\nconst wrappedAdd = (item: Omit<Employee, 'systemId'>): Employee => {\r\n  const userInfo = getCurrentUserInfo();\r\n  const historyEntry = createHistoryEntry(\r\n    'created',\r\n    `${userInfo.name} đã tạo hồ sơ nhân viên ${item.fullName} (${item.id})`,\r\n    userInfo\r\n  );\r\n  \r\n  const newEmployee = originalAdd({\r\n    ...item,\r\n    activityHistory: [historyEntry],\r\n  });\r\n  \r\n  return newEmployee;\r\n};\r\n\r\n// ✅ Wrap update method to include activity history\r\nconst originalUpdate = baseStore.getState().update;\r\nconst wrappedUpdate = (systemId: SystemId, updates: Partial<Employee>): void => {\r\n  const currentEmployee = baseStore.getState().data.find(e => e.systemId === systemId);\r\n  if (!currentEmployee) return;\r\n  \r\n  const userInfo = getCurrentUserInfo();\r\n  const historyEntries: HistoryEntry[] = [];\r\n  \r\n  // Track important field changes\r\n  const trackedFields: { key: keyof Employee; label: string }[] = [\r\n    { key: 'fullName', label: 'họ tên' },\r\n    { key: 'jobTitle', label: 'chức danh' },\r\n    { key: 'department', label: 'phòng ban' },\r\n    { key: 'employmentStatus', label: 'trạng thái làm việc' },\r\n    { key: 'employeeType', label: 'loại nhân viên' },\r\n    { key: 'baseSalary', label: 'lương cơ bản' },\r\n    { key: 'phone', label: 'số điện thoại' },\r\n    { key: 'workEmail', label: 'email công việc' },\r\n    { key: 'role', label: 'vai trò' },\r\n  ];\r\n  \r\n  trackedFields.forEach(({ key, label }) => {\r\n    if (updates[key] !== undefined && updates[key] !== currentEmployee[key]) {\r\n      const oldValue = currentEmployee[key];\r\n      const newValue = updates[key];\r\n      \r\n      // Format values for display\r\n      let oldDisplay = oldValue;\r\n      let newDisplay = newValue;\r\n      \r\n      if (key === 'baseSalary') {\r\n        oldDisplay = new Intl.NumberFormat('vi-VN').format(oldValue as number) + 'đ';\r\n        newDisplay = new Intl.NumberFormat('vi-VN').format(newValue as number) + 'đ';\r\n      }\r\n      \r\n      historyEntries.push(createHistoryEntry(\r\n        'updated',\r\n        `${userInfo.name} đã cập nhật ${label}: \"${oldDisplay || '(trống)'}\" → \"${newDisplay}\"`,\r\n        userInfo,\r\n        { field: key, oldValue, newValue }\r\n      ));\r\n    }\r\n  });\r\n  \r\n  // If status changed specifically\r\n  if (updates.employmentStatus && updates.employmentStatus !== currentEmployee.employmentStatus) {\r\n    historyEntries.push(createHistoryEntry(\r\n      'status_changed',\r\n      `${userInfo.name} đã thay đổi trạng thái làm việc từ \"${currentEmployee.employmentStatus}\" thành \"${updates.employmentStatus}\"`,\r\n      userInfo,\r\n      { field: 'employmentStatus', oldValue: currentEmployee.employmentStatus, newValue: updates.employmentStatus }\r\n    ));\r\n  }\r\n  \r\n  // If no specific changes tracked, add generic update entry\r\n  if (historyEntries.length === 0) {\r\n    historyEntries.push(createHistoryEntry(\r\n      'updated',\r\n      `${userInfo.name} đã cập nhật thông tin nhân viên`,\r\n      userInfo\r\n    ));\r\n  }\r\n  \r\n  const updatedHistory = appendHistoryEntry(currentEmployee.activityHistory, ...historyEntries);\r\n  \r\n  originalUpdate(systemId, {\r\n    ...updates,\r\n    activityHistory: updatedHistory,\r\n  });\r\n};\r\n\r\n// ✅ Override base store methods\r\nbaseStore.setState({\r\n  add: wrappedAdd,\r\n  update: wrappedUpdate,\r\n});\r\n\r\nexport const employeeRepository = createInMemoryRepository<Employee>(() => baseStore.getState());\r\n\r\n// ✅ API-backed persistence adapter - syncs to PostgreSQL\r\nconst API_ENDPOINT = '/api/employees';\r\n\r\nconst persistence: EmployeePersistenceAdapter = {\r\n  create: async (payload) => {\r\n    // First create locally for immediate UI update\r\n    const localResult = await employeeRepository.create(payload);\r\n    \r\n    // Then sync to API (background)\r\n    try {\r\n      const response = await fetch(API_ENDPOINT, {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ ...payload, systemId: localResult.systemId }),\r\n      });\r\n      if (!response.ok) {\r\n        console.warn('[Employee API] Create sync failed, data saved locally');\r\n      } else {\r\n        console.log('[Employee API] Created:', localResult.systemId);\r\n      }\r\n    } catch (e) {\r\n      console.warn('[Employee API] Create sync error:', e);\r\n    }\r\n    \r\n    return localResult;\r\n  },\r\n  update: async (systemId, payload) => {\r\n    // First update locally\r\n    const localResult = await employeeRepository.update(systemId, payload);\r\n    \r\n    // Then sync to API\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}`, {\r\n        method: 'PATCH',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(payload),\r\n      });\r\n      if (!response.ok) {\r\n        console.warn('[Employee API] Update sync failed');\r\n      } else {\r\n        console.log('[Employee API] Updated:', systemId);\r\n      }\r\n    } catch (e) {\r\n      console.warn('[Employee API] Update sync error:', e);\r\n    }\r\n    \r\n    return localResult;\r\n  },\r\n  softDelete: async (systemId) => {\r\n    // First delete locally\r\n    await employeeRepository.softDelete(systemId);\r\n    \r\n    // Then sync to API\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ hard: false }),\r\n      });\r\n      if (!response.ok) {\r\n        console.warn('[Employee API] Soft delete sync failed');\r\n      } else {\r\n        console.log('[Employee API] Soft deleted:', systemId);\r\n      }\r\n    } catch (e) {\r\n      console.warn('[Employee API] Soft delete sync error:', e);\r\n    }\r\n  },\r\n  restore: async (systemId) => {\r\n    // First restore locally\r\n    const localResult = await employeeRepository.restore(systemId);\r\n    \r\n    // Then sync to API\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}/restore`, {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n      });\r\n      if (!response.ok) {\r\n        console.warn('[Employee API] Restore sync failed');\r\n      } else {\r\n        console.log('[Employee API] Restored:', systemId);\r\n      }\r\n    } catch (e) {\r\n      console.warn('[Employee API] Restore sync error:', e);\r\n    }\r\n    \r\n    return localResult;\r\n  },\r\n  hardDelete: async (systemId) => {\r\n    // First delete locally\r\n    await employeeRepository.hardDelete(systemId);\r\n    \r\n    // Then sync to API\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ hard: true }),\r\n      });\r\n      if (!response.ok) {\r\n        console.warn('[Employee API] Hard delete sync failed');\r\n      } else {\r\n        console.log('[Employee API] Hard deleted:', systemId);\r\n      }\r\n    } catch (e) {\r\n      console.warn('[Employee API] Hard delete sync error:', e);\r\n    }\r\n  },\r\n};\r\n\r\n// ✅ Register for breadcrumb auto-generation\r\nregisterBreadcrumbStore('employees', () => baseStore.getState());\r\n\r\n// Define enhanced interface\r\ninterface EmployeeStoreState extends CrudState<Employee> {\r\n  searchEmployees: (query: string, page: number, limit?: number) => Promise<{ items: { value: string; label: string }[], hasNextPage: boolean }>;\r\n  permanentDelete: (systemId: SystemId) => Promise<void>;\r\n  persistence: EmployeePersistenceAdapter;\r\n}\r\n\r\ntype EmployeeStoreHook = (() => EmployeeStoreState) & {\r\n  getState: () => EmployeeStoreState;\r\n  persistence: EmployeePersistenceAdapter;\r\n};\r\n\r\n// Augmented methods\r\nconst augmentedMethods = {\r\n    // FIX: Changed `page: number = 1` to `page: number` to make it a required parameter, matching Combobox prop type.\r\n    // ✅ CRITICAL FIX: Create fresh Fuse instance on each search to avoid stale data\r\n    searchEmployees: async (query: string, page: number, limit: number = 20) => {\r\n        return new Promise<{ items: { value: string; label: string }[], hasNextPage: boolean }>(resolve => {\r\n            setTimeout(() => {\r\n                const allEmployees = baseStore.getState().data;\r\n                \r\n                // ✅ Create fresh Fuse instance with current data\r\n                const fuse = new Fuse(allEmployees, {\r\n                    keys: ['fullName', 'id', 'phone', 'personalEmail', 'workEmail'],\r\n                    threshold: 0.3,\r\n                });\r\n                \r\n                const results = query ? fuse.search(query).map(r => r.item) : allEmployees;\r\n                \r\n                const start = (page - 1) * limit;\r\n                const end = start + limit;\r\n                const paginatedItems = results.slice(start, end);\r\n\r\n                resolve({\r\n                    items: paginatedItems.map(e => ({ value: e.systemId, label: e.fullName })),\r\n                    hasNextPage: end < results.length,\r\n                });\r\n            }, 300);\r\n        });\r\n    },\r\n    permanentDelete: async (systemId: SystemId) => {\r\n        await persistence.hardDelete(systemId);\r\n    }\r\n};\r\n\r\nconst useEmployeeStoreHook = (): EmployeeStoreState => {\r\n  const state = baseStore();\r\n  return {\r\n    ...state,\r\n    ...augmentedMethods, // This includes permanentDelete\r\n    persistence,\r\n  };\r\n};\r\n\r\nexport const useEmployeeStore = useEmployeeStoreHook as EmployeeStoreHook;\r\n\r\n// Export getState for non-hook usage\r\nuseEmployeeStore.getState = (): EmployeeStoreState => {\r\n  const state = baseStore.getState();\r\n  return {\r\n    ...state,\r\n    ...augmentedMethods,\r\n    persistence,\r\n  };\r\n};\r\n\r\nuseEmployeeStore.persistence = persistence;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2776, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/departments/store.ts"],"sourcesContent":["import { createCrudStore } from '../../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { Department } from './types';\r\n\r\nexport const useDepartmentStore = createCrudStore<Department>([], 'departments', {\r\n  apiEndpoint: '/api/departments',\r\n});\r\n"],"names":[],"mappings":";;;;AAAA;;AAIO,MAAM,qBAAqB,IAAA,0IAAe,EAAa,EAAE,EAAE,eAAe;IAC/E,aAAa;AACf"}},
    {"offset": {"line": 2789, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/id-types.ts"],"sourcesContent":["/**\r\n * Type-safe ID System\r\n * \r\n * Prevents mixing systemId with business ID at compile time\r\n */\r\n\r\n// Branded types for type safety\r\nexport type SystemId = string & { readonly __brand: 'SystemId' };\r\nexport type BusinessId = string & { readonly __brand: 'BusinessId' };\r\n\r\n/**\r\n * Create a SystemId from a string\r\n * Use this when you know for sure it's a systemId\r\n */\r\nexport function asSystemId(id: string): SystemId {\r\n  return id as SystemId;\r\n}\r\n\r\n/**\r\n * Create a BusinessId from a string\r\n * Use this when you know for sure it's a business ID\r\n */\r\nexport function asBusinessId(id: string): BusinessId {\r\n  return id as BusinessId;\r\n}\r\n\r\n/**\r\n * Check if a string is a valid systemId format\r\n */\r\nexport function isSystemIdFormat(id: string): boolean {\r\n  // SystemId: 8 digits + prefix (e.g., NV00000001, VOUCHER00000123)\r\n  return /^[A-Z]+\\d{8}$/.test(id);\r\n}\r\n\r\n/**\r\n * Check if a string is a valid business ID format\r\n */\r\nexport function isBusinessIdFormat(id: string): boolean {\r\n  // Business ID: shorter, variable length (e.g., NV001, PT000001)\r\n  return /^[A-Z]+\\d{3,6}$/.test(id);\r\n}\r\n\r\n/**\r\n * Safely convert unknown ID to proper type\r\n */\r\nexport function parseId(id: string): { type: 'system' | 'business'; value: SystemId | BusinessId } {\r\n  if (isSystemIdFormat(id)) {\r\n    return { type: 'system', value: asSystemId(id) };\r\n  }\r\n  if (isBusinessIdFormat(id)) {\r\n    return { type: 'business', value: asBusinessId(id) };\r\n  }\r\n  throw new Error(`Invalid ID format: ${id}`);\r\n}\r\n\r\n/**\r\n * ID Pair - Always keep systemId and businessId together\r\n */\r\nexport interface IDPair {\r\n  systemId: SystemId;\r\n  businessId: BusinessId;\r\n}\r\n\r\n/**\r\n * Entity with dual IDs\r\n */\r\nexport interface DualIDEntity {\r\n  systemId: SystemId;\r\n  id: BusinessId;\r\n}\r\n\r\n/**\r\n * Store methods with type-safe IDs\r\n */\r\nexport interface TypeSafeStore<T extends DualIDEntity> {\r\n  /** Find by systemId (for queries, relationships) */\r\n  findBySystemId(systemId: SystemId): T | null;\r\n  \r\n  /** Find by business ID (for user input, display) */\r\n  findByBusinessId(businessId: BusinessId): T | null;\r\n  \r\n  /** Update by systemId (always use systemId for updates) */\r\n  updateBySystemId(systemId: SystemId, updates: Partial<T>): void;\r\n  \r\n  /** Delete by systemId (always use systemId for deletes) */\r\n  deleteBySystemId(systemId: SystemId): void;\r\n}\r\n\r\n/**\r\n * Route params with type-safe IDs\r\n */\r\nexport interface RouteParams {\r\n  systemId?: SystemId;\r\n  id?: BusinessId;\r\n}\r\n\r\n/**\r\n * Link builder - always uses systemId\r\n */\r\nexport function buildEntityLink(path: string, entity: DualIDEntity): string {\r\n  return path.replace(':systemId', entity.systemId);\r\n}\r\n\r\n/**\r\n * Display ID - always uses business ID\r\n */\r\nexport function getDisplayId(entity: DualIDEntity): string {\r\n  return entity.id;\r\n}\r\n\r\n/**\r\n * Runtime guard: ensures a string is valid SystemId format and casts it\r\n * Logs warning if format is invalid\r\n */\r\nexport function ensureSystemId(id: string, context?: string): SystemId {\r\n  if (!isSystemIdFormat(id)) {\r\n    console.warn(`[ensureSystemId] Invalid SystemId format: \"${id}\"${context ? ` in ${context}` : ''}`);\r\n  }\r\n  return asSystemId(id);\r\n}\r\n\r\n/**\r\n * Runtime guard: ensures a string is valid BusinessId format and casts it\r\n * Logs warning if format is invalid\r\n */\r\nexport function ensureBusinessId(id: string, context?: string): BusinessId {\r\n  if (!isBusinessIdFormat(id)) {\r\n    console.warn(`[ensureBusinessId] Invalid BusinessId format: \"${id}\"${context ? ` in ${context}` : ''}`);\r\n  }\r\n  return asBusinessId(id);\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;CAIC,GAED,gCAAgC;;;;;;;;;;;;;;;;;;;;;AAQzB,SAAS,WAAW,EAAU;IACnC,OAAO;AACT;AAMO,SAAS,aAAa,EAAU;IACrC,OAAO;AACT;AAKO,SAAS,iBAAiB,EAAU;IACzC,kEAAkE;IAClE,OAAO,gBAAgB,IAAI,CAAC;AAC9B;AAKO,SAAS,mBAAmB,EAAU;IAC3C,gEAAgE;IAChE,OAAO,kBAAkB,IAAI,CAAC;AAChC;AAKO,SAAS,QAAQ,EAAU;IAChC,IAAI,iBAAiB,KAAK;QACxB,OAAO;YAAE,MAAM;YAAU,OAAO,WAAW;QAAI;IACjD;IACA,IAAI,mBAAmB,KAAK;QAC1B,OAAO;YAAE,MAAM;YAAY,OAAO,aAAa;QAAI;IACrD;IACA,MAAM,IAAI,MAAM,CAAC,mBAAmB,EAAE,IAAI;AAC5C;AA8CO,SAAS,gBAAgB,IAAY,EAAE,MAAoB;IAChE,OAAO,KAAK,OAAO,CAAC,aAAa,OAAO,QAAQ;AAClD;AAKO,SAAS,aAAa,MAAoB;IAC/C,OAAO,OAAO,EAAE;AAClB;AAMO,SAAS,eAAe,EAAU,EAAE,OAAgB;IACzD,IAAI,CAAC,iBAAiB,KAAK;QACzB,QAAQ,IAAI,CAAC,CAAC,2CAA2C,EAAE,GAAG,CAAC,EAAE,UAAU,CAAC,IAAI,EAAE,SAAS,GAAG,IAAI;IACpG;IACA,OAAO,WAAW;AACpB;AAMO,SAAS,iBAAiB,EAAU,EAAE,OAAgB;IAC3D,IAAI,CAAC,mBAAmB,KAAK;QAC3B,QAAQ,IAAI,CAAC,CAAC,+CAA+C,EAAE,GAAG,CAAC,EAAE,UAAU,CAAC,IAAI,EAAE,SAAS,GAAG,IAAI;IACxG;IACA,OAAO,aAAa;AACtB"}},
    {"offset": {"line": 2865, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/departments/organization-chart/utils/hierarchy-helpers.ts"],"sourcesContent":["/**\r\n * Hierarchy Helper Functions\r\n * Các hàm hỗ trợ tính toán cấu trúc cây tổ chức\r\n */\r\n\r\nimport type { Employee } from '../../../../employees/types';\r\n\r\n/**\r\n * Build parent-child relationship map\r\n */\r\nexport function buildHierarchyMaps(\r\n  employees: Employee[],\r\n  pendingChanges: Record<string, string | undefined>\r\n) {\r\n  const parentIdMap = new Map<string, string>();\r\n  const childMap = new Map<string, string[]>();\r\n\r\n  employees.forEach(e => {\r\n    const currentManagerId = pendingChanges.hasOwnProperty(e.systemId)\r\n      ? pendingChanges[e.systemId]\r\n      : e.managerId;\r\n    parentIdMap.set(e.systemId, currentManagerId || 'root');\r\n  });\r\n\r\n  parentIdMap.forEach((parentId, childId) => {\r\n    if (!childMap.has(parentId)) {\r\n      childMap.set(parentId, []);\r\n    }\r\n    childMap.get(parentId)!.push(childId);\r\n  });\r\n\r\n  return { parentIdMap, childMap };\r\n}\r\n\r\n/**\r\n * Count all descendants of a node\r\n */\r\nexport function countAllDescendants(\r\n  nodeId: string,\r\n  childMap: Map<string, string[]>,\r\n  employees: Employee[]\r\n): number {\r\n  const children = childMap.get(nodeId) || [];\r\n  const employeeChildrenIds = children.filter(id =>\r\n    employees.some(e => e.systemId === id)\r\n  );\r\n  \r\n  let count = employeeChildrenIds.length;\r\n  for (const childId of employeeChildrenIds) {\r\n    count += countAllDescendants(childId, childMap, employees);\r\n  }\r\n  \r\n  return count;\r\n}\r\n\r\n/**\r\n * Get all descendants of a node\r\n */\r\nexport function getAllDescendants(\r\n  nodeId: string,\r\n  childMap: Map<string, string[]>\r\n): Set<string> {\r\n  const descendants = new Set<string>();\r\n  \r\n  const getDescendantsRecursive = (id: string) => {\r\n    const children = childMap.get(id) || [];\r\n    children.forEach(childId => {\r\n      descendants.add(childId);\r\n      getDescendantsRecursive(childId);\r\n    });\r\n  };\r\n  \r\n  getDescendantsRecursive(nodeId);\r\n  return descendants;\r\n}\r\n\r\n/**\r\n * Get all ancestors of a node\r\n */\r\nexport function getAllAncestors(\r\n  nodeId: string,\r\n  parentIdMap: Map<string, string>\r\n): Set<string> {\r\n  const ancestors = new Set<string>();\r\n  let currentNodeId: string | undefined = nodeId;\r\n\r\n  while (currentNodeId && parentIdMap.has(currentNodeId)) {\r\n    const parentId = parentIdMap.get(currentNodeId)!;\r\n    if (parentId === 'root') break;\r\n    ancestors.add(parentId);\r\n    currentNodeId = parentId;\r\n  }\r\n\r\n  return ancestors;\r\n}\r\n\r\n/**\r\n * Check if creating an edge would create a cycle\r\n */\r\nexport function wouldCreateCycle(\r\n  sourceId: string,\r\n  targetId: string,\r\n  childMap: Map<string, string[]>\r\n): boolean {\r\n  const descendants = getAllDescendants(sourceId, childMap);\r\n  return descendants.has(targetId);\r\n}\r\n\r\n/**\r\n * Calculate organization metrics\r\n */\r\nexport function calculateOrgMetrics(\r\n  employees: Employee[],\r\n  childMap: Map<string, string[]>\r\n) {\r\n  // Average span of control (số người quản lý trung bình)\r\n  const managersWithChildren = Array.from(childMap.entries())\r\n    .filter(([_, children]) => children.length > 0);\r\n  \r\n  const avgSpan = managersWithChildren.length > 0\r\n    ? managersWithChildren.reduce((sum, [_, children]) => sum + children.length, 0) / managersWithChildren.length\r\n    : 0;\r\n\r\n  // Max depth (số cấp bậc)\r\n  const getDepth = (nodeId: string, depth = 0): number => {\r\n    const children = childMap.get(nodeId) || [];\r\n    if (children.length === 0) return depth;\r\n    return Math.max(...children.map(child => getDepth(child, depth + 1)));\r\n  };\r\n  const maxDepth = getDepth('root');\r\n\r\n  // Vacancy rate (tỷ lệ vị trí trống)\r\n  const activeEmployees = employees.filter(e => e.employmentStatus === 'Đang làm việc').length;\r\n  const totalPositions = employees.length;\r\n  const vacancyRate = totalPositions > 0 \r\n    ? ((totalPositions - activeEmployees) / totalPositions) * 100 \r\n    : 0;\r\n\r\n  return {\r\n    avgSpan: avgSpan.toFixed(1),\r\n    maxDepth,\r\n    vacancyRate: vacancyRate.toFixed(1),\r\n    totalActive: activeEmployees,\r\n    totalPositions\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2963, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/departments/organization-chart/utils/layout-calculator.ts"],"sourcesContent":["/**\r\n * Layout Calculator using Dagre\r\n * Tính toán vị trí nodes cho org chart\r\n */\r\n\r\nimport dagre from 'dagre';\r\nimport type { Node, Edge } from 'reactflow';\r\nimport type { Employee } from '../../../../employees/types';\r\nimport { buildHierarchyMaps, countAllDescendants, getAllDescendants } from './hierarchy-helpers';\r\n\r\nconst dagreGraph = new dagre.graphlib.Graph();\r\ndagreGraph.setDefaultEdgeLabel(() => ({}));\r\n\r\nexport const nodeWidth = 256;\r\nexport const nodeHeight = 88;\r\n\r\nexport type LayoutDirection = 'TB' | 'LR';\r\n\r\nexport interface LayoutOptions {\r\n  direction: LayoutDirection;\r\n  nodeSpacing?: number;\r\n  rankSpacing?: number;\r\n}\r\n\r\nconst DEFAULT_OPTIONS = {\r\n  direction: 'TB' as LayoutDirection,\r\n  nodeSpacing: 120,  // Tăng khoảng cách ngang giữa các nodes (nhánh cây)\r\n  rankSpacing: 150   // Tăng khoảng cách dọc giữa các tầng\r\n};\r\n\r\n/**\r\n * Calculate layout positions for all nodes\r\n */\r\nexport function calculateLayout(\r\n  employees: Employee[],\r\n  collapsedNodes: Set<string>,\r\n  pendingChanges: Record<string, string | undefined>,\r\n  options: Partial<LayoutOptions> = {}\r\n): {\r\n  nodes: Node[];\r\n  edges: Edge[];\r\n  parentIdMap: Map<string, string>;\r\n  childMap: Map<string, string[]>;\r\n} {\r\n  const { direction, nodeSpacing, rankSpacing } = { ...DEFAULT_OPTIONS, ...options };\r\n  \r\n  dagreGraph.setGraph({ \r\n    rankdir: direction,\r\n    nodesep: nodeSpacing,\r\n    ranksep: rankSpacing,\r\n    ranker: 'tight-tree',  // Sử dụng thuật toán tight-tree cho cây rõ ràng hơn\r\n    align: 'UL',           // Căn chỉnh từ trên xuống, trái sang phải\r\n    acyclicer: 'greedy'    // Xử lý chu trình nếu có\r\n  });\r\n\r\n  const activeEmployees = employees.filter(emp => emp.employmentStatus === 'Đang làm việc');\r\n  const { parentIdMap, childMap } = buildHierarchyMaps(activeEmployees, pendingChanges);\r\n\r\n  // Create all nodes\r\n  const allNodes = createNodes(activeEmployees, childMap, parentIdMap, collapsedNodes);\r\n  \r\n  // Create all edges\r\n  const allEdges = createEdges(parentIdMap, pendingChanges);\r\n\r\n  // Filter hidden nodes based on collapsed state\r\n  const hiddenNodeIds = getHiddenNodeIds(collapsedNodes, childMap);\r\n  const visibleNodes = allNodes.filter(n => !hiddenNodeIds.has(n.id));\r\n  const visibleEdges = allEdges.filter(e => \r\n    !hiddenNodeIds.has(e.source) && !hiddenNodeIds.has(e.target)\r\n  );\r\n\r\n  // Apply dagre layout\r\n  applyDagreLayout(visibleNodes, visibleEdges, activeEmployees);\r\n\r\n  return {\r\n    nodes: allNodes,\r\n    edges: allEdges,\r\n    parentIdMap,\r\n    childMap\r\n  };\r\n}\r\n\r\n/**\r\n * Create nodes from employees\r\n */\r\nfunction createNodes(\r\n  employees: Employee[],\r\n  childMap: Map<string, string[]>,\r\n  parentIdMap: Map<string, string>,\r\n  collapsedNodes: Set<string>\r\n): Node[] {\r\n  const nodes: Node[] = [\r\n    {\r\n      id: 'root',\r\n      type: 'employeeNode',\r\n      data: {\r\n        fullName: 'Ban Giám đốc',\r\n        jobTitle: 'Lãnh đạo công ty',\r\n        systemId: 'root',\r\n        childrenCount: childMap.get('root')?.length || 0,\r\n        totalHeadcount: countAllDescendants('root', childMap, employees),\r\n        isCollapsed: collapsedNodes.has('root'),\r\n      },\r\n      position: { x: 0, y: 0 },\r\n      deletable: false,\r\n    }\r\n  ];\r\n\r\n  employees.forEach(employee => {\r\n    nodes.push({\r\n      id: employee.systemId,\r\n      type: 'employeeNode',\r\n      data: {\r\n        ...employee,\r\n        childrenCount: childMap.get(employee.systemId)?.length || 0,\r\n        totalHeadcount: countAllDescendants(employee.systemId, childMap, employees),\r\n        isCollapsed: collapsedNodes.has(employee.systemId),\r\n      },\r\n      position: { x: 0, y: 0 },\r\n    });\r\n  });\r\n\r\n  return nodes;\r\n}\r\n\r\n/**\r\n * Create edges from parent-child relationships\r\n */\r\nfunction createEdges(\r\n  parentIdMap: Map<string, string>,\r\n  pendingChanges: Record<string, string | undefined>\r\n): Edge[] {\r\n  const edges: Edge[] = [];\r\n\r\n  parentIdMap.forEach((parentId, childId) => {\r\n    const isPending = pendingChanges.hasOwnProperty(childId);\r\n    edges.push({\r\n      id: `e-${parentId}-${childId}`,\r\n      source: parentId,\r\n      target: childId,\r\n      type: 'smoothstep',  // Sử dụng smoothstep cho góc cạnh rõ hơn\r\n      animated: isPending,\r\n      style: isPending \r\n        ? { \r\n            strokeDasharray: '5,5', \r\n            stroke: '#007bff',\r\n            strokeWidth: 2 \r\n          } \r\n        : { \r\n            stroke: '#94a3b8',    // Màu xám nhạt cho edge bình thường\r\n            strokeWidth: 2        // Độ dày đường nối\r\n          },\r\n      markerEnd: {\r\n        type: 'arrowclosed' as any,\r\n        width: 20,\r\n        height: 20,\r\n        color: isPending ? '#007bff' : '#94a3b8'\r\n      },\r\n    });\r\n  });\r\n\r\n  return edges;\r\n}\r\n\r\n/**\r\n * Get IDs of nodes that should be hidden due to collapse\r\n */\r\nfunction getHiddenNodeIds(\r\n  collapsedNodes: Set<string>,\r\n  childMap: Map<string, string[]>\r\n): Set<string> {\r\n  const hiddenNodeIds = new Set<string>();\r\n\r\n  collapsedNodes.forEach(collapsedNodeId => {\r\n    const descendants = getAllDescendants(collapsedNodeId, childMap);\r\n    descendants.forEach(id => hiddenNodeIds.add(id));\r\n  });\r\n\r\n  return hiddenNodeIds;\r\n}\r\n\r\n/**\r\n * Apply dagre layout algorithm\r\n */\r\nfunction applyDagreLayout(\r\n  nodes: Node[],\r\n  edges: Edge[],\r\n  employees: Employee[]\r\n) {\r\n  // Add nodes to dagre graph\r\n  nodes.forEach(node => {\r\n    dagreGraph.setNode(node.id, { width: nodeWidth, height: nodeHeight });\r\n  });\r\n\r\n  // Add edges to dagre graph\r\n  edges.forEach(edge => {\r\n    dagreGraph.setEdge(edge.source, edge.target);\r\n  });\r\n\r\n  // Calculate layout\r\n  dagre.layout(dagreGraph);\r\n\r\n  // Apply calculated positions\r\n  nodes.forEach(node => {\r\n    const employeeData = employees.find(e => e.systemId === node.id);\r\n    const nodeWithPosition = dagreGraph.node(node.id);\r\n\r\n    // Use saved position if exists, otherwise use calculated position\r\n    if (employeeData && \r\n        employeeData.positionX !== undefined && \r\n        employeeData.positionY !== undefined) {\r\n      node.position = {\r\n        x: employeeData.positionX,\r\n        y: employeeData.positionY,\r\n      };\r\n    } else if (nodeWithPosition) {\r\n      node.position = {\r\n        x: nodeWithPosition.x - nodeWidth / 2,\r\n        y: nodeWithPosition.y - nodeHeight / 2,\r\n      };\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Reset layout to auto-calculated positions\r\n */\r\nexport function resetToAutoLayout(\r\n  nodes: Node[],\r\n  edges: Edge[]\r\n): Node[] {\r\n  // Clear dagre graph\r\n  dagreGraph.nodes().forEach(id => dagreGraph.removeNode(id));\r\n\r\n  // Re-add nodes\r\n  nodes.forEach(node => {\r\n    dagreGraph.setNode(node.id, { width: nodeWidth, height: nodeHeight });\r\n  });\r\n\r\n  // Re-add edges\r\n  edges.forEach(edge => {\r\n    dagreGraph.setEdge(edge.source, edge.target);\r\n  });\r\n\r\n  // Recalculate\r\n  dagre.layout(dagreGraph);\r\n\r\n  // Apply new positions\r\n  return nodes.map(node => {\r\n    const nodeWithPosition = dagreGraph.node(node.id);\r\n    if (nodeWithPosition) {\r\n      return {\r\n        ...node,\r\n        position: {\r\n          x: nodeWithPosition.x - nodeWidth / 2,\r\n          y: nodeWithPosition.y - nodeHeight / 2,\r\n        }\r\n      };\r\n    }\r\n    return node;\r\n  });\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3170, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/departments/organization-chart/hooks/use-org-chart.ts"],"sourcesContent":["/**\r\n * Main hook for org chart logic\r\n * Manages all chart state and interactions\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { useReactFlow, type Node } from 'reactflow';\r\nimport { useEmployeeStore } from '../../../../employees/store';\r\nimport { useDepartmentStore } from '../../store';\r\nimport { toast } from 'sonner';\r\nimport { asSystemId } from '@/lib/id-types';\r\nimport { \r\n  calculateLayout, \r\n  resetToAutoLayout,\r\n  type LayoutDirection,\r\n  nodeWidth,\r\n  nodeHeight\r\n} from '../utils/layout-calculator';\r\nimport { \r\n  getAllAncestors, \r\n  wouldCreateCycle \r\n} from '../utils/hierarchy-helpers';\r\n\r\nexport function useOrgChart() {\r\n  const { data: employees, update: updateEmployee } = useEmployeeStore();\r\n  const { data: departments } = useDepartmentStore();\r\n  const { fitView, setCenter, setNodes: setReactFlowNodes, getNodes } = useReactFlow();\r\n\r\n  // State\r\n  const [collapsedNodes, setCollapsedNodes] = React.useState(new Set<string>());\r\n  const [pendingChanges, setPendingChanges] = React.useState<Record<string, string | undefined>>({});\r\n  const [layoutDirection, setLayoutDirection] = React.useState<LayoutDirection>('TB');\r\n  const [isLocked, setIsLocked] = React.useState(false);\r\n  const [departmentFilter, setDepartmentFilter] = React.useState('all');\r\n  const [focusNodeId, setFocusNodeId] = React.useState<string | null>(null);\r\n  const [forceAutoLayout, setForceAutoLayout] = React.useState(\r\n    !employees.some(e => e.positionX !== undefined && e.positionY !== undefined)\r\n  );\r\n\r\n  // Callbacks\r\n  const toggleNode = React.useCallback((nodeId: string) => {\r\n    setCollapsedNodes(prev => {\r\n      const newSet = new Set(prev);\r\n      if (newSet.has(nodeId)) {\r\n        newSet.delete(nodeId);\r\n      } else {\r\n        newSet.add(nodeId);\r\n      }\r\n      return newSet;\r\n    });\r\n  }, []);\r\n\r\n  const handleFocusNode = React.useCallback((nodeId: string) => {\r\n    setFocusNodeId(nodeId);\r\n  }, []);\r\n\r\n  const handleNodeDragStop = React.useCallback(\r\n    (event: React.MouseEvent, draggedNode: Node) => {\r\n      if (isLocked) return;\r\n\r\n      const nodes = getNodes();\r\n      const targetNode = nodes.find((n) => {\r\n        if (n.id === draggedNode.id) return false;\r\n\r\n        const draggedNodeCenter = {\r\n          x: draggedNode.position.x + (draggedNode.width ?? nodeWidth) / 2,\r\n          y: draggedNode.position.y + (draggedNode.height ?? nodeHeight) / 2,\r\n        };\r\n\r\n        const isOverlapping =\r\n          draggedNodeCenter.x > n.position.x &&\r\n          draggedNodeCenter.x < n.position.x + (n.width ?? nodeWidth) &&\r\n          draggedNodeCenter.y > n.position.y &&\r\n          draggedNodeCenter.y < n.position.y + (n.height ?? nodeHeight);\r\n\r\n        return isOverlapping;\r\n      });\r\n\r\n      if (targetNode) {\r\n        if (targetNode.id.startsWith('POS') || targetNode.id.startsWith('VIRTUAL')) {\r\n          return;\r\n        }\r\n\r\n        // Check for cycle\r\n        const layout = calculateLayout(\r\n          employees,\r\n          collapsedNodes,\r\n          pendingChanges,\r\n          { direction: layoutDirection }\r\n        );\r\n\r\n        if (wouldCreateCycle(draggedNode.id, targetNode.id, layout.childMap)) {\r\n          toast.error('Không thể tạo vòng lặp trong cấu trúc tổ chức');\r\n          return;\r\n        }\r\n\r\n        setPendingChanges(prev => ({\r\n          ...prev,\r\n          [draggedNode.id]: targetNode.id,\r\n        }));\r\n\r\n        toast.info(`Đã thay đổi quản lý của ${draggedNode.data.fullName}`);\r\n      }\r\n    },\r\n    [isLocked, getNodes, employees, collapsedNodes, pendingChanges, layoutDirection]\r\n  );\r\n\r\n  const handleSaveChanges = React.useCallback(() => {\r\n    Object.entries(pendingChanges).forEach(([employeeId, managerId]) => {\r\n      if (employeeId.startsWith('NV')) {\r\n        const employee = employees.find(e => e.systemId === employeeId);\r\n        if (employee) {\r\n          updateEmployee(asSystemId(employeeId), { \r\n            ...employee, \r\n            managerId: managerId ? asSystemId(managerId) : undefined,\r\n          });\r\n        }\r\n      }\r\n    });\r\n    setPendingChanges({});\r\n    toast.success('Đã lưu thay đổi quan hệ quản lý');\r\n  }, [pendingChanges, employees, updateEmployee]);\r\n\r\n  const handleCancelChanges = React.useCallback(() => {\r\n    setPendingChanges({});\r\n    toast.info('Đã hủy thay đổi');\r\n  }, []);\r\n\r\n  const handleSaveLayout = React.useCallback(() => {\r\n    const currentNodes = getNodes();\r\n    currentNodes.forEach(node => {\r\n      if (node.id.startsWith('NV')) {\r\n        const employee = employees.find(e => e.systemId === node.id);\r\n        if (employee) {\r\n          updateEmployee(node.id as any, {\r\n            ...employee,\r\n            positionX: node.position.x,\r\n            positionY: node.position.y,\r\n          });\r\n        }\r\n      }\r\n    });\r\n    toast.success('Đã lưu bố cục sơ đồ');\r\n  }, [getNodes, employees, updateEmployee]);\r\n\r\n  const handleAutoLayout = React.useCallback(() => {\r\n    setForceAutoLayout(true);\r\n    toast.info('Đang tự động sắp xếp lại...');\r\n  }, []);\r\n\r\n  const handleSearchAndFocus = React.useCallback((employee: any) => {\r\n    const layout = calculateLayout(\r\n      employees,\r\n      collapsedNodes,\r\n      pendingChanges,\r\n      { direction: layoutDirection }\r\n    );\r\n\r\n    // Uncollapse ancestors\r\n    const ancestors = getAllAncestors(employee.systemId, layout.parentIdMap);\r\n    setCollapsedNodes(prev => {\r\n      const newSet = new Set(prev);\r\n      let changed = false;\r\n      [...ancestors, 'root'].forEach(id => {\r\n        if (newSet.has(id)) {\r\n          newSet.delete(id);\r\n          changed = true;\r\n        }\r\n      });\r\n      return changed ? newSet : prev;\r\n    });\r\n\r\n    // Focus after uncollapse\r\n    setTimeout(() => {\r\n      const node = getNodes().find(n => n.id === employee.systemId);\r\n      if (node) {\r\n        setCenter(\r\n          node.position.x + (node.width ?? nodeWidth) / 2,\r\n          node.position.y + (node.height ?? nodeHeight) / 2,\r\n          { zoom: 1.2, duration: 200 }\r\n        );\r\n        setReactFlowNodes(nds =>\r\n          nds.map(n => ({\r\n            ...n,\r\n            selected: n.id === employee.systemId,\r\n          }))\r\n        );\r\n      }\r\n    }, 50);\r\n  }, [employees, collapsedNodes, pendingChanges, layoutDirection, getNodes, setCenter, setReactFlowNodes]);\r\n\r\n  return {\r\n    // Data\r\n    employees,\r\n    departments,\r\n    \r\n    // State\r\n    collapsedNodes,\r\n    pendingChanges,\r\n    layoutDirection,\r\n    isLocked,\r\n    departmentFilter,\r\n    focusNodeId,\r\n    forceAutoLayout,\r\n    \r\n    // Setters\r\n    setLayoutDirection,\r\n    setIsLocked,\r\n    setDepartmentFilter,\r\n    setFocusNodeId,\r\n    setForceAutoLayout,\r\n    \r\n    // Callbacks\r\n    toggleNode,\r\n    handleFocusNode,\r\n    handleNodeDragStop,\r\n    handleSaveChanges,\r\n    handleCancelChanges,\r\n    handleSaveLayout,\r\n    handleAutoLayout,\r\n    handleSearchAndFocus,\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3387, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/departments/organization-chart/utils/export-helpers.ts"],"sourcesContent":["/**\r\n * Export utilities for org chart\r\n * Export as PNG, SVG, PDF\r\n */\r\n\r\nimport { toPng, toSvg } from 'html-to-image';\r\nimport { jsPDF } from 'jspdf';\r\n\r\n/**\r\n * Download a data URL as a file\r\n */\r\nfunction downloadFile(dataUrl: string, filename: string) {\r\n  const link = document.createElement('a');\r\n  link.download = filename;\r\n  link.href = dataUrl;\r\n  link.click();\r\n}\r\n\r\n/**\r\n * Export chart as PNG\r\n */\r\nexport async function exportAsPNG(elementSelector = '.react-flow') {\r\n  try {\r\n    const element = document.querySelector(elementSelector) as HTMLElement;\r\n    if (!element) throw new Error('Chart element not found');\r\n\r\n    const dataUrl = await toPng(element, {\r\n      backgroundColor: '#ffffff',\r\n      pixelRatio: 2, // Higher quality\r\n      filter: (node) => {\r\n        // Exclude controls/panels\r\n        return !node.classList?.contains('react-flow__panel');\r\n      }\r\n    });\r\n\r\n    const timestamp = new Date().toISOString().split('T')[0];\r\n    downloadFile(dataUrl, `org-chart-${timestamp}.png`);\r\n    \r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error('Export PNG failed:', error);\r\n    return { success: false, error };\r\n  }\r\n}\r\n\r\n/**\r\n * Export chart as SVG\r\n */\r\nexport async function exportAsSVG(elementSelector = '.react-flow') {\r\n  try {\r\n    const element = document.querySelector(elementSelector) as HTMLElement;\r\n    if (!element) throw new Error('Chart element not found');\r\n\r\n    const dataUrl = await toSvg(element, {\r\n      backgroundColor: '#ffffff',\r\n      filter: (node) => {\r\n        return !node.classList?.contains('react-flow__panel');\r\n      }\r\n    });\r\n\r\n    const timestamp = new Date().toISOString().split('T')[0];\r\n    downloadFile(dataUrl, `org-chart-${timestamp}.svg`);\r\n    \r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error('Export SVG failed:', error);\r\n    return { success: false, error };\r\n  }\r\n}\r\n\r\n/**\r\n * Export chart as PDF\r\n */\r\nexport async function exportAsPDF(elementSelector = '.react-flow') {\r\n  try {\r\n    const element = document.querySelector(elementSelector) as HTMLElement;\r\n    if (!element) throw new Error('Chart element not found');\r\n\r\n    // Get PNG first\r\n    const dataUrl = await toPng(element, {\r\n      backgroundColor: '#ffffff',\r\n      pixelRatio: 2,\r\n      filter: (node) => {\r\n        return !node.classList?.contains('react-flow__panel');\r\n      }\r\n    });\r\n\r\n    // Calculate dimensions\r\n    const img = new Image();\r\n    img.src = dataUrl;\r\n    await new Promise((resolve) => { img.onload = resolve; });\r\n\r\n    // Create PDF with appropriate size\r\n    const pdf = new jsPDF({\r\n      orientation: img.width > img.height ? 'landscape' : 'portrait',\r\n      unit: 'px',\r\n      format: [img.width, img.height]\r\n    });\r\n\r\n    pdf.addImage(dataUrl, 'PNG', 0, 0, img.width, img.height);\r\n\r\n    const timestamp = new Date().toISOString().split('T')[0];\r\n    pdf.save(`org-chart-${timestamp}.pdf`);\r\n    \r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error('Export PDF failed:', error);\r\n    return { success: false, error };\r\n  }\r\n}\r\n\r\n/**\r\n * Export chart data as JSON\r\n */\r\nexport function exportAsJSON(data: any) {\r\n  try {\r\n    const json = JSON.stringify(data, null, 2);\r\n    const blob = new Blob([json], { type: 'application/json' });\r\n    const url = URL.createObjectURL(blob);\r\n    \r\n    const timestamp = new Date().toISOString().split('T')[0];\r\n    downloadFile(url, `org-chart-data-${timestamp}.json`);\r\n    \r\n    URL.revokeObjectURL(url);\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error('Export JSON failed:', error);\r\n    return { success: false, error };\r\n  }\r\n}\r\n\r\n/**\r\n * Copy chart to clipboard as image\r\n */\r\nexport async function copyToClipboard(elementSelector = '.react-flow') {\r\n  try {\r\n    const element = document.querySelector(elementSelector) as HTMLElement;\r\n    if (!element) throw new Error('Chart element not found');\r\n\r\n    const blob = await toPng(element, {\r\n      backgroundColor: '#ffffff',\r\n      pixelRatio: 2,\r\n      filter: (node) => {\r\n        return !node.classList?.contains('react-flow__panel');\r\n      }\r\n    }).then(dataUrl => {\r\n      return fetch(dataUrl).then(res => res.blob());\r\n    });\r\n\r\n    await navigator.clipboard.write([\r\n      new ClipboardItem({ 'image/png': blob })\r\n    ]);\r\n\r\n    return { success: true };\r\n  } catch (error) {\r\n    console.error('Copy to clipboard failed:', error);\r\n    return { success: false, error };\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;;CAGC,GAED;AACA;;;AAEA;;CAEC,GACD,SAAS,aAAa,OAAe,EAAE,QAAgB;IACrD,MAAM,OAAO,SAAS,aAAa,CAAC;IACpC,KAAK,QAAQ,GAAG;IAChB,KAAK,IAAI,GAAG;IACZ,KAAK,KAAK;AACZ;AAKO,eAAe,YAAY,kBAAkB,aAAa;IAC/D,IAAI;QACF,MAAM,UAAU,SAAS,aAAa,CAAC;QACvC,IAAI,CAAC,SAAS,MAAM,IAAI,MAAM;QAE9B,MAAM,UAAU,MAAM,IAAA,2JAAK,EAAC,SAAS;YACnC,iBAAiB;YACjB,YAAY;YACZ,QAAQ,CAAC;gBACP,0BAA0B;gBAC1B,OAAO,CAAC,KAAK,SAAS,EAAE,SAAS;YACnC;QACF;QAEA,MAAM,YAAY,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;QACxD,aAAa,SAAS,CAAC,UAAU,EAAE,UAAU,IAAI,CAAC;QAElD,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO;YAAE,SAAS;YAAO;QAAM;IACjC;AACF;AAKO,eAAe,YAAY,kBAAkB,aAAa;IAC/D,IAAI;QACF,MAAM,UAAU,SAAS,aAAa,CAAC;QACvC,IAAI,CAAC,SAAS,MAAM,IAAI,MAAM;QAE9B,MAAM,UAAU,MAAM,IAAA,2JAAK,EAAC,SAAS;YACnC,iBAAiB;YACjB,QAAQ,CAAC;gBACP,OAAO,CAAC,KAAK,SAAS,EAAE,SAAS;YACnC;QACF;QAEA,MAAM,YAAY,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;QACxD,aAAa,SAAS,CAAC,UAAU,EAAE,UAAU,IAAI,CAAC;QAElD,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO;YAAE,SAAS;YAAO;QAAM;IACjC;AACF;AAKO,eAAe,YAAY,kBAAkB,aAAa;IAC/D,IAAI;QACF,MAAM,UAAU,SAAS,aAAa,CAAC;QACvC,IAAI,CAAC,SAAS,MAAM,IAAI,MAAM;QAE9B,gBAAgB;QAChB,MAAM,UAAU,MAAM,IAAA,2JAAK,EAAC,SAAS;YACnC,iBAAiB;YACjB,YAAY;YACZ,QAAQ,CAAC;gBACP,OAAO,CAAC,KAAK,SAAS,EAAE,SAAS;YACnC;QACF;QAEA,uBAAuB;QACvB,MAAM,MAAM,IAAI;QAChB,IAAI,GAAG,GAAG;QACV,MAAM,IAAI,QAAQ,CAAC;YAAc,IAAI,MAAM,GAAG;QAAS;QAEvD,mCAAmC;QACnC,MAAM,MAAM,IAAI,4JAAK,CAAC;YACpB,aAAa,IAAI,KAAK,GAAG,IAAI,MAAM,GAAG,cAAc;YACpD,MAAM;YACN,QAAQ;gBAAC,IAAI,KAAK;gBAAE,IAAI,MAAM;aAAC;QACjC;QAEA,IAAI,QAAQ,CAAC,SAAS,OAAO,GAAG,GAAG,IAAI,KAAK,EAAE,IAAI,MAAM;QAExD,MAAM,YAAY,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;QACxD,IAAI,IAAI,CAAC,CAAC,UAAU,EAAE,UAAU,IAAI,CAAC;QAErC,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO;YAAE,SAAS;YAAO;QAAM;IACjC;AACF;AAKO,SAAS,aAAa,IAAS;IACpC,IAAI;QACF,MAAM,OAAO,KAAK,SAAS,CAAC,MAAM,MAAM;QACxC,MAAM,OAAO,IAAI,KAAK;YAAC;SAAK,EAAE;YAAE,MAAM;QAAmB;QACzD,MAAM,MAAM,IAAI,eAAe,CAAC;QAEhC,MAAM,YAAY,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;QACxD,aAAa,KAAK,CAAC,eAAe,EAAE,UAAU,KAAK,CAAC;QAEpD,IAAI,eAAe,CAAC;QACpB,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO;YAAE,SAAS;YAAO;QAAM;IACjC;AACF;AAKO,eAAe,gBAAgB,kBAAkB,aAAa;IACnE,IAAI;QACF,MAAM,UAAU,SAAS,aAAa,CAAC;QACvC,IAAI,CAAC,SAAS,MAAM,IAAI,MAAM;QAE9B,MAAM,OAAO,MAAM,IAAA,2JAAK,EAAC,SAAS;YAChC,iBAAiB;YACjB,YAAY;YACZ,QAAQ,CAAC;gBACP,OAAO,CAAC,KAAK,SAAS,EAAE,SAAS;YACnC;QACF,GAAG,IAAI,CAAC,CAAA;YACN,OAAO,MAAM,SAAS,IAAI,CAAC,CAAA,MAAO,IAAI,IAAI;QAC5C;QAEA,MAAM,UAAU,SAAS,CAAC,KAAK,CAAC;YAC9B,IAAI,cAAc;gBAAE,aAAa;YAAK;SACvC;QAED,OAAO;YAAE,SAAS;QAAK;IACzB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO;YAAE,SAAS;YAAO;QAAM;IACjC;AACF"}},
    {"offset": {"line": 3559, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/departments/organization-chart/page.tsx"],"sourcesContent":["/**\r\n * Organization Chart Page - Refactored\r\n * Clean, modular, performant\r\n */\r\n\r\nimport * as React from 'react';\r\nimport ReactFlow, {\r\n  Background,\r\n  MiniMap,\r\n  useNodesState,\r\n  useEdgesState,\r\n  ReactFlowProvider,\r\n  Panel,\r\n  ConnectionMode,\r\n} from 'reactflow';\r\nimport { useRouter } from 'next/navigation';\r\nimport { Mouse, GripVertical, Download } from 'lucide-react';\r\nimport { Button } from '../../../../components/ui/button';\r\nimport { SettingsActionButton } from '../../../../components/settings/SettingsActionButton';\r\nimport { Kbd } from '../../../../components/ui/kbd';\r\nimport { useSettingsPageHeader } from '../../use-settings-page-header';\r\nimport { CustomEmployeeNode } from './components/chart-node';\r\nimport { ChartSearch } from './components/chart-search';\r\nimport { ChartControls } from './components/chart-controls';\r\nimport { useOrgChart } from './hooks/use-org-chart';\r\nimport { calculateLayout } from './utils/layout-calculator';\r\nimport { \r\n  DropdownMenu,\r\n  DropdownMenuContent,\r\n  DropdownMenuItem,\r\n  DropdownMenuTrigger,\r\n  DropdownMenuSeparator\r\n} from '../../../../components/ui/dropdown-menu';\r\nimport { toast } from 'sonner';\r\nimport { \r\n  exportAsPNG, \r\n  exportAsSVG, \r\n  exportAsPDF,\r\n  exportAsJSON \r\n} from './utils/export-helpers';\r\n\r\nconst nodeTypes = {\r\n  employeeNode: CustomEmployeeNode,\r\n};\r\n\r\nfunction OrgChartFlow() {\r\n  const router = useRouter();\r\n  const {\r\n    employees,\r\n    departments,\r\n    collapsedNodes,\r\n    pendingChanges,\r\n    layoutDirection,\r\n    isLocked,\r\n    departmentFilter,\r\n    focusNodeId,\r\n    forceAutoLayout,\r\n    setLayoutDirection,\r\n    setIsLocked,\r\n    setDepartmentFilter,\r\n    setFocusNodeId,\r\n    setForceAutoLayout,\r\n    toggleNode,\r\n    handleFocusNode,\r\n    handleNodeDragStop,\r\n    handleSaveChanges,\r\n    handleCancelChanges,\r\n    handleSaveLayout,\r\n    handleAutoLayout,\r\n    handleSearchAndFocus,\r\n  } = useOrgChart();\r\n\r\n  const [nodes, setNodes, onNodesChange] = useNodesState([]);\r\n  const [edges, setEdges, onEdgesChange] = useEdgesState([]);\r\n\r\n  const isInteractive = !isLocked;\r\n\r\n  // Calculate and update layout\r\n  React.useLayoutEffect(() => {\r\n    if (employees.length === 0) return;\r\n\r\n    const layout = calculateLayout(\r\n      employees,\r\n      collapsedNodes,\r\n      pendingChanges,\r\n      { \r\n        direction: layoutDirection,\r\n        nodeSpacing: 120,  // Khoảng cách ngang tốt cho cây phân nhánh\r\n        rankSpacing: 150   // Khoảng cách dọc giữa các tầng\r\n      }\r\n    );\r\n\r\n    // Add callbacks to node data\r\n    const nodesWithCallbacks = layout.nodes.map(node => ({\r\n      ...node,\r\n      data: {\r\n        ...node.data,\r\n        onToggle: () => toggleNode(node.id),\r\n        router,\r\n        onFocus: handleFocusNode,\r\n        departmentFilter,\r\n        isInteractive,\r\n      }\r\n    }));\r\n\r\n    // Apply focus filter if needed\r\n    let finalNodes = nodesWithCallbacks;\r\n    let finalEdges = layout.edges;\r\n\r\n    if (focusNodeId) {\r\n      const visibleIds = new Set<string>();\r\n      const parentId = layout.parentIdMap.get(focusNodeId);\r\n      \r\n      visibleIds.add(focusNodeId);\r\n      \r\n      if (parentId && parentId !== 'root') {\r\n        visibleIds.add(parentId);\r\n        const siblings = layout.childMap.get(parentId) || [];\r\n        siblings.forEach(id => visibleIds.add(id));\r\n      } else if (parentId === 'root') {\r\n        const topLevelNodes = layout.childMap.get('root') || [];\r\n        topLevelNodes.forEach(id => visibleIds.add(id));\r\n        visibleIds.add('root');\r\n      }\r\n      \r\n      const children = layout.childMap.get(focusNodeId) || [];\r\n      children.forEach(id => visibleIds.add(id));\r\n      \r\n      finalNodes = nodesWithCallbacks.filter(n => visibleIds.has(n.id));\r\n      finalEdges = layout.edges.filter(e => \r\n        visibleIds.has(e.source) && visibleIds.has(e.target)\r\n      );\r\n    }\r\n\r\n    setNodes(finalNodes);\r\n    setEdges(finalEdges);\r\n\r\n    // Auto-fit on force layout\r\n    if (forceAutoLayout) {\r\n      setForceAutoLayout(false);\r\n      setTimeout(() => {\r\n        const { fitView } = (window as any).__reactFlowInstance || {};\r\n        if (fitView) fitView({ duration: 200, padding: 0.2 });\r\n      }, 100);\r\n    }\r\n  }, [\r\n    employees,\r\n    collapsedNodes,\r\n    pendingChanges,\r\n    layoutDirection,\r\n    focusNodeId,\r\n    departmentFilter,\r\n    isInteractive,\r\n    forceAutoLayout,\r\n    setNodes,\r\n    setEdges,\r\n    setForceAutoLayout,\r\n    toggleNode,\r\n    router,\r\n    handleFocusNode,\r\n  ]);\r\n\r\n  // Export data for JSON export\r\n  const exportData = React.useMemo(() => ({\r\n    employees: employees.filter(e => e.employmentStatus === 'Đang làm việc'),\r\n    structure: nodes.map(n => ({\r\n      id: n.id,\r\n      name: n.data.fullName,\r\n      jobTitle: n.data.jobTitle,\r\n      department: n.data.department,\r\n      managerId: n.data.managerId,\r\n    })),\r\n    metadata: {\r\n      exportDate: new Date().toISOString(),\r\n      totalEmployees: employees.filter(e => e.employmentStatus === 'Đang làm việc').length,\r\n      departments: departments.length,\r\n    }\r\n  }), [employees, departments, nodes]);\r\n\r\n  return (\r\n    <div className=\"h-[calc(100vh-9rem)] relative flex flex-col\">\r\n      {/* Fixed Toolbar */}\r\n      <div className=\"flex-shrink-0 bg-background border-b border-border p-2 flex items-center justify-between gap-2 flex-wrap\">\r\n        {/* Left: Search & Filter */}\r\n        <div className=\"flex-1 min-w-[200px] max-w-md\">\r\n          <ChartSearch\r\n            employees={employees}\r\n            departments={departments}\r\n            departmentFilter={departmentFilter}\r\n            onDepartmentFilterChange={setDepartmentFilter}\r\n            onEmployeeSelect={handleSearchAndFocus}\r\n          />\r\n        </div>\r\n        \r\n        {/* Right: Controls */}\r\n        <div className=\"flex items-center gap-2\">\r\n          <ChartControls\r\n            isLocked={isLocked}\r\n            onLockToggle={() => setIsLocked(!isLocked)}\r\n            layoutDirection={layoutDirection}\r\n            onLayoutDirectionChange={setLayoutDirection}\r\n            onAutoLayout={handleAutoLayout}\r\n            onSaveLayout={handleSaveLayout}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* ReactFlow Canvas */}\r\n      <div className=\"flex-1 relative\">\r\n        <style>\r\n          {`\r\n            .react-flow__node {\r\n              transition: transform 0s ease, width 0s ease, height 0s ease;\r\n            }\r\n            .react-flow__handle {\r\n              width: 100%;\r\n              height: 100%;\r\n              border-radius: 0;\r\n              transform: none;\r\n              border: none;\r\n              background: transparent;\r\n              pointer-events: none;\r\n            }\r\n            /* Drag handle styling */\r\n            .drag-handle {\r\n              cursor: grab !important;\r\n            }\r\n            .drag-handle:active {\r\n              cursor: grabbing !important;\r\n            }\r\n            /* Prevent text selection during drag */\r\n            .react-flow__node.dragging * {\r\n              user-select: none;\r\n              -webkit-user-select: none;\r\n              -moz-user-select: none;\r\n              -ms-user-select: none;\r\n            }\r\n            /* Always allow node dragging via drag-handle */\r\n            .react-flow__node.draggable {\r\n              cursor: default;\r\n            }\r\n          `}\r\n        </style>\r\n\r\n        <ReactFlow\r\n          nodes={nodes}\r\n          edges={edges}\r\n          onNodesChange={onNodesChange}\r\n          onEdgesChange={onEdgesChange}\r\n          onNodeDragStop={handleNodeDragStop}\r\n          nodeTypes={nodeTypes}\r\n          fitView\r\n          className=\"bg-background\"\r\n          panOnDrag={[1, 2]}\r\n          selectionOnDrag={false}\r\n          panOnScroll\r\n          zoomOnDoubleClick={false}\r\n          nodesDraggable={!isLocked}\r\n          nodesConnectable={false}\r\n          elementsSelectable={true}\r\n          minZoom={0.1}\r\n          maxZoom={4}\r\n          connectionMode={ConnectionMode.Loose}\r\n          deleteKeyCode={null}\r\n          nodeDragThreshold={1}\r\n          onInit={(instance) => {\r\n            // Store instance for export\r\n            (window as any).__reactFlowInstance = instance;\r\n          }}\r\n        >\r\n          <Background gap={16} />\r\n          <MiniMap \r\n            nodeStrokeWidth={3} \r\n            zoomable \r\n            pannable \r\n            className=\"bg-background border border-border rounded-lg shadow-sm\"\r\n          />\r\n\r\n          {/* Bottom-left: Instructions */}\r\n          <Panel position=\"bottom-left\" className=\"p-3 max-w-xs text-xs text-muted-foreground bg-card/95 backdrop-blur-sm border border-border rounded-lg shadow-lg space-y-2\">\r\n            <div className=\"font-semibold text-foreground mb-1.5 flex items-center gap-2\">\r\n              <span className=\"h-1.5 w-1.5 bg-primary rounded-full animate-pulse\"></span>\r\n              Hướng dẫn sử dụng\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <Kbd>Alt</Kbd> + <Mouse className=\"h-4 w-4\" /> Di chuyển toàn bộ sơ đồ\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <GripVertical className=\"h-4 w-4\" /> Kéo để di chuyển vị trí node\r\n            </div>\r\n            <div className=\"flex items-center gap-2\">\r\n              <span className=\"flex items-center justify-center h-4 w-4 border border-border rounded-full text-[10px]\">+/−</span>\r\n              Thu gọn/Mở rộng nhân viên cấp dưới\r\n            </div>\r\n            <div className=\"flex items-center gap-2 pt-1 border-t border-border\">\r\n              <span className=\"text-[10px] font-medium\">💡 Mẹo:</span>\r\n              <span>Nhấn vào node để xem menu</span>\r\n            </div>\r\n          </Panel>\r\n\r\n          {/* Pending Changes Notification */}\r\n          {Object.keys(pendingChanges).length > 0 && (\r\n            <Panel position=\"top-center\" className=\"animate-in slide-in-from-top\">\r\n              <div className=\"bg-orange-500 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-3\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span className=\"font-medium\">Có {Object.keys(pendingChanges).length} thay đổi chưa lưu</span>\r\n                </div>\r\n                <div className=\"flex items-center gap-2 border-l pl-3\">\r\n                  <Button \r\n                    size=\"sm\" \r\n                    variant=\"secondary\"\r\n                    className=\"h-7\"\r\n                    onClick={handleSaveChanges}\r\n                  >\r\n                    Lưu thay đổi\r\n                  </Button>\r\n                  <Button \r\n                    size=\"sm\" \r\n                    variant=\"ghost\"\r\n                    className=\"h-7 text-white hover:bg-white/20\"\r\n                    onClick={handleCancelChanges}\r\n                  >\r\n                    Hủy\r\n                  </Button>\r\n                </div>\r\n              </div>\r\n            </Panel>\r\n          )}\r\n\r\n          {/* Focus Mode Notification */}\r\n          {focusNodeId && (\r\n            <Panel position=\"top-right\" className=\"animate-in slide-in-from-right\">\r\n              <div className=\"bg-primary text-primary-foreground px-4 py-2 rounded-lg shadow-lg flex items-center gap-3\">\r\n                <span className=\"font-medium\">Chế độ tập trung</span>\r\n                <Button \r\n                  size=\"sm\" \r\n                  variant=\"secondary\"\r\n                  className=\"h-7\"\r\n                  onClick={() => setFocusNodeId(null)}\r\n                >\r\n                  Thoát\r\n                </Button>\r\n              </div>\r\n            </Panel>\r\n          )}\r\n        </ReactFlow>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function OrganizationChartPage() {\r\n  const [isExporting, setIsExporting] = React.useState(false);\r\n\r\n  const handleExportFromHeader = React.useCallback(async (type: 'png' | 'svg' | 'pdf' | 'json') => {\r\n    setIsExporting(true);\r\n    const loadingToast = toast.loading(`Đang xuất ${type.toUpperCase()}...`);\r\n\r\n    try {\r\n      let result;\r\n\r\n      switch (type) {\r\n        case 'png':\r\n          result = await exportAsPNG();\r\n          break;\r\n        case 'svg':\r\n          result = await exportAsSVG();\r\n          break;\r\n        case 'pdf':\r\n          result = await exportAsPDF();\r\n          break;\r\n        case 'json': {\r\n          const exportData = {\r\n            metadata: {\r\n              exportDate: new Date().toISOString(),\r\n              title: 'Sơ đồ tổ chức'\r\n            }\r\n          };\r\n          result = exportAsJSON(exportData);\r\n          break;\r\n        }\r\n        default:\r\n          result = { success: false };\r\n      }\r\n\r\n      if (result.success) {\r\n        toast.success(`Đã xuất ${type.toUpperCase()} thành công!`, { id: loadingToast });\r\n      } else {\r\n        toast.error(`Lỗi khi xuất ${type.toUpperCase()}`, { id: loadingToast });\r\n      }\r\n    } catch (error) {\r\n      console.error('Export error:', error);\r\n      toast.error('Có lỗi xảy ra khi xuất file', { id: loadingToast });\r\n    } finally {\r\n      setIsExporting(false);\r\n    }\r\n  }, [setIsExporting]);\r\n\r\n  const exportAction = React.useMemo(() => (\r\n    <DropdownMenu>\r\n      <DropdownMenuTrigger asChild>\r\n        <SettingsActionButton variant=\"outline\" disabled={isExporting}>\r\n          <Download className=\"h-4 w-4\" />\r\n          Xuất file\r\n        </SettingsActionButton>\r\n      </DropdownMenuTrigger>\r\n      <DropdownMenuContent align=\"end\">\r\n        <DropdownMenuItem onClick={() => handleExportFromHeader('png')}>\r\n          Xuất PNG\r\n        </DropdownMenuItem>\r\n        <DropdownMenuItem onClick={() => handleExportFromHeader('svg')}>\r\n          Xuất SVG\r\n        </DropdownMenuItem>\r\n        <DropdownMenuItem onClick={() => handleExportFromHeader('pdf')}>\r\n          Xuất PDF\r\n        </DropdownMenuItem>\r\n        <DropdownMenuSeparator />\r\n        <DropdownMenuItem onClick={() => handleExportFromHeader('json')}>\r\n          Xuất dữ liệu (JSON)\r\n        </DropdownMenuItem>\r\n      </DropdownMenuContent>\r\n    </DropdownMenu>\r\n  ), [handleExportFromHeader, isExporting]);\r\n\r\n  useSettingsPageHeader({\r\n    title: 'Sơ đồ tổ chức',\r\n    breadcrumb: [\r\n      { label: 'Phòng ban', href: '/departments', isCurrent: false },\r\n      { label: 'Sơ đồ tổ chức', href: '/organization-chart', isCurrent: true }\r\n    ],\r\n    actions: [exportAction]\r\n  });\r\n\r\n  return (\r\n    <ReactFlowProvider>\r\n      <OrgChartFlow />\r\n    </ReactFlowProvider>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4242, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/app/%28authenticated%29/organization-chart/page.tsx"],"sourcesContent":["\"use client\"\r\nimport { OrganizationChartPage } from '@/features/settings/departments/organization-chart/page'\r\nexport default OrganizationChartPage\r\n"],"names":[],"mappings":";;;;AACA;AADA;;uCAEe,8LAAqB"}}]
}