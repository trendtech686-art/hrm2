{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/brands/pkgx-brand-actions-cell.tsx"],"sourcesContent":["/**\r\n * PkgxBrandActionsCell - Shared dropdown component for PKGX brand sync actions\r\n * \r\n * Uses usePkgxEntitySync hook for consistent sync behavior\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { MoreHorizontal, RefreshCw, Globe, Search, AlignLeft, Eye, Link2, Unlink, ExternalLink } from 'lucide-react';\r\nimport { Button } from '../../components/ui/button';\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger } from '../../components/ui/dropdown-menu';\r\nimport type { Brand } from '../settings/inventory/types';\r\nimport { usePkgxEntitySync } from '../settings/pkgx/hooks';\r\nimport type { HrmBrandData } from '../settings/pkgx/hooks';\r\nimport { PkgxSyncConfirmDialog } from '../settings/pkgx/components/pkgx-sync-confirm-dialog';\r\nimport { usePkgxSettingsStore } from '../settings/pkgx/store';\r\n\r\ninterface PkgxBrandActionsCellProps {\r\n  brand: Brand;\r\n  hasPkgxMapping: boolean;\r\n  pkgxBrandId?: number;\r\n  onPkgxLink?: (brand: Brand) => void;\r\n  onPkgxUnlink?: (brand: Brand) => void;\r\n  onPkgxViewDetail?: (brand: Brand, pkgxBrandId: number) => void;\r\n}\r\n\r\nexport function PkgxBrandActionsCell({\r\n  brand,\r\n  hasPkgxMapping,\r\n  pkgxBrandId,\r\n  onPkgxLink,\r\n  onPkgxUnlink,\r\n  onPkgxViewDetail,\r\n}: PkgxBrandActionsCellProps) {\r\n  const { addLog } = usePkgxSettingsStore();\r\n  \r\n  // Use shared entity sync hook\r\n  const entitySync = usePkgxEntitySync({\r\n    entityType: 'brand',\r\n    onLog: addLog,\r\n  });\r\n  \r\n  // Build HRM brand data for sync\r\n  const buildHrmData = (): HrmBrandData => ({\r\n    systemId: brand.systemId,\r\n    name: brand.name,\r\n    website: brand.website,\r\n    seoKeywords: brand.websiteSeo?.pkgx?.seoKeywords || brand.seoKeywords,\r\n    seoTitle: brand.websiteSeo?.pkgx?.seoTitle || brand.seoTitle,\r\n    metaDescription: brand.websiteSeo?.pkgx?.metaDescription || brand.metaDescription,\r\n    shortDescription: brand.websiteSeo?.pkgx?.shortDescription || brand.shortDescription,\r\n    longDescription: brand.websiteSeo?.pkgx?.longDescription || brand.longDescription || brand.description,\r\n    websiteSeo: brand.websiteSeo,\r\n  });\r\n  \r\n  // Helper to trigger sync\r\n  const triggerSync = (actionKey: 'sync_all' | 'sync_basic' | 'sync_seo' | 'sync_description') => {\r\n    if (!pkgxBrandId) return;\r\n    const hrmData = buildHrmData();\r\n    entitySync.triggerSyncAction(actionKey, pkgxBrandId, hrmData, brand.name);\r\n  };\r\n  \r\n  return (\r\n    <>\r\n      <div className=\"flex items-center justify-center\" onClick={(e) => e.stopPropagation()}>\r\n        <DropdownMenu>\r\n          <DropdownMenuTrigger asChild onClick={(e) => e.stopPropagation()}>\r\n            <Button \r\n              variant=\"ghost\" \r\n              className={`h-8 w-8 p-0 ${hasPkgxMapping ? \"text-primary\" : \"text-muted-foreground\"}`}\r\n              onClick={(e) => e.stopPropagation()}\r\n            >\r\n              <span className=\"sr-only\">PKGX menu</span>\r\n              <MoreHorizontal className=\"h-4 w-4\" />\r\n            </Button>\r\n          </DropdownMenuTrigger>\r\n          <DropdownMenuContent align=\"end\" onClick={(e) => e.stopPropagation()}>\r\n            {hasPkgxMapping ? (\r\n              <>\r\n                {/* Sync All */}\r\n                <DropdownMenuItem \r\n                  onSelect={() => triggerSync('sync_all')}\r\n                  className=\"font-medium\"\r\n                  title=\"Đồng bộ: Tên, Website, Keywords, Meta Title, Meta Desc, Mô tả ngắn, Mô tả dài\"\r\n                >\r\n                  <RefreshCw className=\"mr-2 h-4 w-4\" />\r\n                  Đồng bộ tất cả\r\n                </DropdownMenuItem>\r\n                <DropdownMenuSeparator />\r\n                \r\n                {/* Individual sync actions */}\r\n                <DropdownMenuItem \r\n                  onSelect={() => triggerSync('sync_basic')}\r\n                  title=\"Đồng bộ: Tên thương hiệu, Website URL\"\r\n                >\r\n                  <Globe className=\"mr-2 h-4 w-4\" />\r\n                  Thông tin cơ bản\r\n                </DropdownMenuItem>\r\n                <DropdownMenuItem \r\n                  onSelect={() => triggerSync('sync_seo')}\r\n                  title=\"Đồng bộ: Keywords, Meta Title, Meta Desc\"\r\n                >\r\n                  <Search className=\"mr-2 h-4 w-4\" />\r\n                  SEO\r\n                </DropdownMenuItem>\r\n                <DropdownMenuItem \r\n                  onSelect={() => triggerSync('sync_description')}\r\n                  title=\"Đồng bộ: Mô tả ngắn (Short Desc), Mô tả dài (Long Desc)\"\r\n                >\r\n                  <AlignLeft className=\"mr-2 h-4 w-4\" />\r\n                  Mô tả\r\n                </DropdownMenuItem>\r\n                \r\n                <DropdownMenuSeparator />\r\n                {onPkgxViewDetail && pkgxBrandId && (\r\n                  <DropdownMenuItem \r\n                    onSelect={() => onPkgxViewDetail(brand, pkgxBrandId)}\r\n                  >\r\n                    <Eye className=\"mr-2 h-4 w-4\" />\r\n                    Xem trên PKGX\r\n                  </DropdownMenuItem>\r\n                )}\r\n                \r\n                {/* Hủy liên kết */}\r\n                {onPkgxUnlink && (\r\n                  <>\r\n                    <DropdownMenuSeparator />\r\n                    <DropdownMenuItem \r\n                      onSelect={() => entitySync.handleConfirm(\r\n                        'Hủy liên kết PKGX',\r\n                        `Bạn có chắc muốn hủy liên kết thương hiệu \"${brand.name}\" với PKGX?`,\r\n                        () => onPkgxUnlink(brand)\r\n                      )}\r\n                      className=\"text-destructive\"\r\n                    >\r\n                      <Unlink className=\"mr-2 h-4 w-4\" />\r\n                      Hủy liên kết\r\n                    </DropdownMenuItem>\r\n                  </>\r\n                )}\r\n              </>\r\n            ) : (\r\n              /* Not linked - show link option */\r\n              <>\r\n                {onPkgxLink && (\r\n                  <DropdownMenuItem onSelect={() => onPkgxLink(brand)}>\r\n                    <Link2 className=\"mr-2 h-4 w-4\" />\r\n                    Liên kết với PKGX\r\n                  </DropdownMenuItem>\r\n                )}\r\n              </>\r\n            )}\r\n          </DropdownMenuContent>\r\n        </DropdownMenu>\r\n      </div>\r\n      \r\n      {/* Confirmation Dialog - using shared component */}\r\n      <PkgxSyncConfirmDialog\r\n        confirmAction={entitySync.confirmAction}\r\n        isSyncing={entitySync.isSyncing}\r\n        onConfirm={entitySync.executeAction}\r\n        onCancel={entitySync.cancelConfirm}\r\n      />\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 285, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/brands/columns.tsx"],"sourcesContent":["import * as React from \"react\";\r\nimport type { Brand } from '../settings/inventory/types';\r\nimport { Checkbox } from \"../../components/ui/checkbox\";\r\nimport { DataTableColumnHeader } from \"../../components/data-table/data-table-column-header\";\r\nimport { Badge } from \"../../components/ui/badge\";\r\nimport type { ColumnDef } from '../../components/data-table/types';\r\nimport { Button } from \"../../components/ui/button\";\r\nimport { MoreHorizontal, Globe, Image as ImageIcon, Eye, Trash2, Package, Pencil, CheckCircle, AlertTriangle, XCircle, ExternalLink } from \"lucide-react\";\r\nimport { Switch } from \"../../components/ui/switch\";\r\nimport { PkgxBrandActionsCell } from './pkgx-brand-actions-cell';\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger } from \"../../components/ui/dropdown-menu\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"../../components/ui/avatar\";\r\nimport { InlineEditableCell } from '../../components/shared/inline-editable-cell';\r\nimport { useProductStore } from '../products/store';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"../../components/ui/dialog\";\r\nimport { ScrollArea } from \"../../components/ui/scroll-area\";\r\n\r\nconst formatDate = (dateString?: string) => {\r\n  if (!dateString) return '';\r\n  const date = new Date(dateString);\r\n  return new Intl.DateTimeFormat('vi-VN', {\r\n    day: '2-digit',\r\n    month: '2-digit',\r\n    year: 'numeric'\r\n  }).format(date);\r\n};\r\n\r\n// SEO Score calculation for Brand\r\nconst calculateSeoScore = (brand: Brand, website: 'pkgx' | 'trendtech'): number => {\r\n  const seo = brand.websiteSeo?.[website];\r\n  if (!seo) return 0;\r\n  \r\n  let score = 0;\r\n  if (seo.seoTitle && seo.seoTitle.length >= 30) score += 25;\r\n  if (seo.metaDescription && seo.metaDescription.length >= 100) score += 25;\r\n  if (seo.seoKeywords) score += 15;\r\n  if (seo.shortDescription) score += 15;\r\n  if (seo.longDescription && seo.longDescription.length >= 200) score += 20;\r\n  \r\n  return score;\r\n};\r\n\r\nconst getSeoStatusBadge = (score: number) => {\r\n  if (score >= 80) return <Badge variant=\"default\" className=\"bg-green-100 text-green-800 hover:bg-green-100\"><CheckCircle className=\"h-3 w-3 mr-1\" /> {score}%</Badge>;\r\n  if (score >= 50) return <Badge variant=\"secondary\" className=\"bg-yellow-100 text-yellow-800 hover:bg-yellow-100\"><AlertTriangle className=\"h-3 w-3 mr-1\" /> {score}%</Badge>;\r\n  if (score > 0) return <Badge variant=\"secondary\" className=\"bg-red-100 text-red-800 hover:bg-red-100\"><XCircle className=\"h-3 w-3 mr-1\" /> {score}%</Badge>;\r\n  return <Badge variant=\"outline\" className=\"text-muted-foreground\">—</Badge>;\r\n};\r\n\r\nexport const getColumns = (\r\n  onDelete: (systemId: string) => void,\r\n  onToggleActive: (systemId: string, isActive: boolean) => void,\r\n  navigate: (path: string) => void,\r\n  onUpdateName?: (systemId: string, name: string) => void,\r\n  // PKGX handlers - used by PkgxBrandActionsCell\r\n  hasPkgxMapping?: (brand: Brand) => boolean,\r\n  getPkgxBrandId?: (brand: Brand) => number | undefined,\r\n  onPkgxLink?: (brand: Brand) => void,\r\n  onPkgxUnlink?: (brand: Brand) => void,\r\n  onPkgxViewDetail?: (brand: Brand, pkgxBrandId: number) => void,\r\n): ColumnDef<Brand>[] => {\r\n  // Get product counts per brand\r\n  const productStore = useProductStore.getState();\r\n  const productCountByBrand: Record<string, number> = {};\r\n  productStore.data.forEach(p => {\r\n    if (p.brandSystemId && !p.isDeleted) {\r\n      productCountByBrand[String(p.brandSystemId)] = (productCountByBrand[String(p.brandSystemId)] || 0) + 1;\r\n    }\r\n  });\r\n\r\n  return [\r\n  {\r\n    id: \"select\",\r\n    header: ({ isAllPageRowsSelected, isSomePageRowsSelected, onToggleAll }) => (\r\n      <Checkbox\r\n        checked={isAllPageRowsSelected ? true : isSomePageRowsSelected ? \"indeterminate\" : false}\r\n        onCheckedChange={(value) => onToggleAll?.(!!value)}\r\n        aria-label=\"Select all\"\r\n      />\r\n    ),\r\n    cell: ({ onToggleSelect, isSelected }) => (\r\n      <Checkbox\r\n        checked={isSelected}\r\n        onCheckedChange={onToggleSelect}\r\n        aria-label=\"Select row\"\r\n      />\r\n    ),\r\n    size: 48,\r\n    meta: {\r\n      displayName: \"Chọn\",\r\n      sticky: \"left\",\r\n    }\r\n  },\r\n  // Logo\r\n  {\r\n    id: \"logo\",\r\n    accessorKey: \"logo\",\r\n    header: \"Logo\",\r\n    cell: ({ row }) => {\r\n      const brand = row as Brand;\r\n      return (\r\n        <Avatar className=\"h-10 w-10\">\r\n          {brand.logo ? (\r\n            <AvatarImage src={brand.logo} alt={brand.name} />\r\n          ) : null}\r\n          <AvatarFallback className=\"bg-muted\">\r\n            <ImageIcon className=\"h-4 w-4 text-muted-foreground\" />\r\n          </AvatarFallback>\r\n        </Avatar>\r\n      );\r\n    },\r\n    size: 60,\r\n    meta: {\r\n      displayName: \"Logo\",\r\n      group: \"Thông tin cơ bản\"\r\n    },\r\n  },\r\n  // Tên thương hiệu với inline editing\r\n  {\r\n    id: \"name\",\r\n    accessorKey: \"name\",\r\n    header: ({ sorting, setSorting }) => (\r\n      <DataTableColumnHeader \r\n        title=\"Tên thương hiệu\"\r\n        sortKey=\"name\"\r\n        isSorted={sorting?.id === 'name'}\r\n        sortDirection={sorting?.desc ? 'desc' : 'asc'}\r\n        onSort={() => setSorting?.((s: any) => ({ id: 'name', desc: s.id === 'name' ? !s.desc : false }))}\r\n      />\r\n    ),\r\n    cell: ({ row }) => {\r\n      const brand = row as Brand;\r\n      const hasMapping = hasPkgxMapping?.(brand) ?? false;\r\n      const pkgxId = getPkgxBrandId?.(brand);\r\n      \r\n      if (onUpdateName) {\r\n        return (\r\n          <InlineEditableCell\r\n            value={brand.name}\r\n            onSave={(newName) => onUpdateName(String(brand.systemId), newName)}\r\n            inputClassName=\"h-7 text-sm w-48\"\r\n            renderDisplay={(value, onEdit) => (\r\n              <div className=\"flex flex-col group\">\r\n                <div className=\"flex items-center gap-2\">\r\n                  <span \r\n                    className=\"font-medium cursor-pointer hover:text-primary\"\r\n                    onClick={() => navigate(`/brands/${brand.systemId}`)}\r\n                  >\r\n                    {value}\r\n                  </span>\r\n                  {hasMapping && (\r\n                    <Badge variant=\"secondary\" className=\"text-xs\">\r\n                      <Globe className=\"h-3 w-3 mr-1\" />\r\n                      PKGX\r\n                    </Badge>\r\n                  )}\r\n                  <Button\r\n                    variant=\"ghost\"\r\n                    size=\"icon\"\r\n                    className=\"h-5 w-5 opacity-0 group-hover:opacity-100 transition-opacity shrink-0\"\r\n                    onClick={(e) => {\r\n                      e.stopPropagation();\r\n                      onEdit();\r\n                    }}\r\n                  >\r\n                    <Pencil className=\"h-3 w-3\" />\r\n                  </Button>\r\n                </div>\r\n                {brand.description && (\r\n                  <span className=\"text-xs text-muted-foreground truncate max-w-[200px]\" title={brand.description}>\r\n                    {brand.description}\r\n                  </span>\r\n                )}\r\n              </div>\r\n            )}\r\n          />\r\n        );\r\n      }\r\n      \r\n      return (\r\n        <div \r\n          className=\"flex flex-col cursor-pointer hover:text-primary\"\r\n          onClick={() => navigate(`/brands/${brand.systemId}`)}\r\n        >\r\n          <div className=\"flex items-center gap-2\">\r\n            <span className=\"font-medium\">{brand.name}</span>\r\n            {hasMapping && (\r\n              <Badge variant=\"secondary\" className=\"text-xs\">\r\n                <Globe className=\"h-3 w-3 mr-1\" />\r\n                PKGX\r\n              </Badge>\r\n            )}\r\n          </div>\r\n          {brand.description && (\r\n            <span className=\"text-xs text-muted-foreground truncate max-w-[200px]\" title={brand.description}>\r\n              {brand.description}\r\n            </span>\r\n          )}\r\n        </div>\r\n      );\r\n    },\r\n    meta: {\r\n      displayName: \"Tên thương hiệu\",\r\n      group: \"Thông tin cơ bản\"\r\n    },\r\n  },\r\n  // Mã thương hiệu\r\n  {\r\n    id: \"id\",\r\n    accessorKey: \"id\",\r\n    header: ({ sorting, setSorting }) => (\r\n      <DataTableColumnHeader \r\n        title=\"Mã\"\r\n        sortKey=\"id\"\r\n        isSorted={sorting?.id === 'id'}\r\n        sortDirection={sorting?.desc ? 'desc' : 'asc'}\r\n        onSort={() => setSorting?.((s: any) => ({ id: 'id', desc: s.id === 'id' ? !s.desc : false }))}\r\n      />\r\n    ),\r\n    cell: ({ row }) => {\r\n      const brand = row as Brand;\r\n      return (\r\n        <span className=\"font-mono text-xs text-muted-foreground\">\r\n          {brand.id}\r\n        </span>\r\n      );\r\n    },\r\n    size: 100,\r\n    meta: {\r\n      displayName: \"Mã thương hiệu\",\r\n      group: \"Thông tin cơ bản\"\r\n    },\r\n  },\r\n  // Số sản phẩm\r\n  {\r\n    id: \"productCount\",\r\n    header: \"SP\",\r\n    cell: ({ row }) => {\r\n      const brand = row as Brand;\r\n      const count = productCountByBrand[String(brand.systemId)] || 0;\r\n      return (\r\n        <Badge variant=\"outline\" className=\"font-mono text-xs gap-1\">\r\n          <Package className=\"h-3 w-3\" />\r\n          {count}\r\n        </Badge>\r\n      );\r\n    },\r\n    size: 70,\r\n    meta: {\r\n      displayName: \"Số sản phẩm\",\r\n      group: \"Thống kê\"\r\n    },\r\n  },\r\n  // Website\r\n  {\r\n    id: \"website\",\r\n    accessorKey: \"website\",\r\n    header: \"Website\",\r\n    cell: ({ row }) => {\r\n      const brand = row as Brand;\r\n      if (!brand.website) return <span className=\"text-muted-foreground\">—</span>;\r\n      return (\r\n        <a \r\n          href={brand.website} \r\n          target=\"_blank\" \r\n          rel=\"noopener noreferrer\"\r\n          className=\"flex items-center gap-1 text-primary hover:underline text-sm\"\r\n          onClick={(e) => e.stopPropagation()}\r\n        >\r\n          <Globe className=\"h-3 w-3\" />\r\n          <span className=\"truncate max-w-[150px]\">{brand.website.replace(/^https?:\\/\\//, '')}</span>\r\n          <ExternalLink className=\"h-3 w-3\" />\r\n        </a>\r\n      );\r\n    },\r\n    meta: {\r\n      displayName: \"Website\",\r\n      group: \"Thông tin cơ bản\"\r\n    },\r\n  },\r\n  // SEO PKGX với điểm số\r\n  {\r\n    id: \"seoPkgx\",\r\n    accessorKey: \"websiteSeo\",\r\n    header: \"SEO PKGX\",\r\n    cell: ({ row }) => {\r\n      const brand = row as Brand;\r\n      const score = calculateSeoScore(brand, 'pkgx');\r\n      return getSeoStatusBadge(score);\r\n    },\r\n    size: 100,\r\n    meta: {\r\n      displayName: \"SEO PKGX\",\r\n      group: \"SEO\"\r\n    },\r\n  },\r\n  // SEO Trendtech với điểm số\r\n  {\r\n    id: \"seoTrendtech\",\r\n    accessorKey: \"websiteSeo\",\r\n    header: \"SEO Trendtech\",\r\n    cell: ({ row }) => {\r\n      const brand = row as Brand;\r\n      const score = calculateSeoScore(brand, 'trendtech');\r\n      return getSeoStatusBadge(score);\r\n    },\r\n    size: 100,\r\n    meta: {\r\n      displayName: \"SEO Trendtech\",\r\n      group: \"SEO\"\r\n    },\r\n  },\r\n  // PKGX Status - Hiển thị trạng thái liên kết\r\n  {\r\n    id: \"pkgxStatus\",\r\n    header: \"Liên kết PKGX\",\r\n    cell: ({ row }) => {\r\n      const brand = row as Brand;\r\n      const hasMapping = hasPkgxMapping?.(brand) ?? false;\r\n      const pkgxId = getPkgxBrandId?.(brand);\r\n      \r\n      return hasMapping ? (\r\n        <Badge variant=\"default\" className=\"bg-green-500 text-xs\">\r\n          <Globe className=\"h-3 w-3 mr-1\" />\r\n          {pkgxId}\r\n        </Badge>\r\n      ) : (\r\n        <Badge variant=\"secondary\" className=\"text-xs\">Chưa liên kết</Badge>\r\n      );\r\n    },\r\n    size: 110,\r\n    meta: {\r\n      displayName: \"Liên kết PKGX\",\r\n      group: \"PKGX\"\r\n    },\r\n  },\r\n  // Trạng thái\r\n  {\r\n    id: \"isActive\",\r\n    accessorKey: \"isActive\",\r\n    header: \"Trạng thái\",\r\n    cell: ({ row }) => {\r\n      const brand = row as Brand;\r\n      return (\r\n        <div className=\"flex items-center\" onClick={(e) => e.stopPropagation()}>\r\n          <Switch\r\n            checked={brand.isActive !== false}\r\n            onCheckedChange={(checked) => onToggleActive(brand.systemId, checked)}\r\n            aria-label=\"Toggle status\"\r\n          />\r\n        </div>\r\n      );\r\n    },\r\n    size: 80,\r\n    meta: {\r\n      displayName: \"Trạng thái\",\r\n      group: \"Hệ thống\"\r\n    },\r\n  },\r\n  // Ngày tạo\r\n  {\r\n    id: \"createdAt\",\r\n    accessorKey: \"createdAt\",\r\n    header: ({ sorting, setSorting }) => (\r\n      <DataTableColumnHeader \r\n        title=\"Ngày tạo\"\r\n        sortKey=\"createdAt\"\r\n        isSorted={sorting?.id === 'createdAt'}\r\n        sortDirection={sorting?.desc ? 'desc' : 'asc'}\r\n        onSort={() => setSorting?.((s: any) => ({ id: 'createdAt', desc: s.id === 'createdAt' ? !s.desc : false }))}\r\n      />\r\n    ),\r\n    cell: ({ row }) => {\r\n      const brand = row as Brand;\r\n      return (\r\n        <span className=\"text-sm text-muted-foreground\">\r\n          {formatDate(brand.createdAt)}\r\n        </span>\r\n      );\r\n    },\r\n    meta: {\r\n      displayName: \"Ngày tạo\",\r\n      group: \"Hệ thống\"\r\n    },\r\n  },\r\n  // Ngày cập nhật\r\n  {\r\n    id: \"updatedAt\",\r\n    accessorKey: \"updatedAt\",\r\n    header: ({ sorting, setSorting }) => (\r\n      <DataTableColumnHeader \r\n        title=\"Cập nhật\"\r\n        sortKey=\"updatedAt\"\r\n        isSorted={sorting?.id === 'updatedAt'}\r\n        sortDirection={sorting?.desc ? 'desc' : 'asc'}\r\n        onSort={() => setSorting?.((s: any) => ({ id: 'updatedAt', desc: s.id === 'updatedAt' ? !s.desc : false }))}\r\n      />\r\n    ),\r\n    cell: ({ row }) => {\r\n      const brand = row as Brand;\r\n      return (\r\n        <span className=\"text-sm text-muted-foreground\">\r\n          {formatDate(brand.updatedAt)}\r\n        </span>\r\n      );\r\n    },\r\n    meta: {\r\n      displayName: \"Ngày cập nhật\",\r\n      group: \"Hệ thống\"\r\n    },\r\n  },\r\n  // PKGX Actions Column\r\n  {\r\n    id: \"pkgx\",\r\n    header: \"PKGX\",\r\n    cell: ({ row }) => {\r\n      const brand = row as Brand;\r\n      const hasMapping = hasPkgxMapping?.(brand) ?? false;\r\n      const pkgxId = getPkgxBrandId?.(brand);\r\n      \r\n      return (\r\n        <PkgxBrandActionsCell\r\n          brand={brand}\r\n          hasPkgxMapping={hasMapping}\r\n          pkgxBrandId={pkgxId}\r\n          onPkgxLink={onPkgxLink}\r\n          onPkgxUnlink={onPkgxUnlink}\r\n          onPkgxViewDetail={onPkgxViewDetail}\r\n        />\r\n      );\r\n    },\r\n    size: 70,\r\n    meta: {\r\n      displayName: \"PKGX\",\r\n      group: \"PKGX\"\r\n    },\r\n  },\r\n  // Actions\r\n  {\r\n    id: \"actions\",\r\n    header: \"Hành động\",\r\n    cell: ({ row }) => {\r\n      const brand = row as Brand;\r\n      \r\n      return (\r\n        <div className=\"flex items-center justify-end gap-1\">\r\n          <DropdownMenu>\r\n            <DropdownMenuTrigger asChild>\r\n              <Button \r\n                variant=\"ghost\" \r\n                size=\"icon\"\r\n                className=\"h-7 w-7 p-0\"\r\n                onClick={(e) => e.stopPropagation()}\r\n              >\r\n                <MoreHorizontal className=\"h-4 w-4\" />\r\n              </Button>\r\n            </DropdownMenuTrigger>\r\n            <DropdownMenuContent align=\"end\" className=\"w-48\">\r\n              <DropdownMenuItem \r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  navigate(`/brands/${brand.systemId}`);\r\n                }}\r\n              >\r\n                <Eye className=\"h-4 w-4 mr-2\" />\r\n                Xem chi tiết\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem \r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  navigate(`/brands/${brand.systemId}/edit`);\r\n                }}\r\n              >\r\n                <Pencil className=\"h-4 w-4 mr-2\" />\r\n                Chỉnh sửa\r\n              </DropdownMenuItem>\r\n              <DropdownMenuSeparator />\r\n              <DropdownMenuItem \r\n                className=\"text-destructive focus:text-destructive\"\r\n                onClick={(e) => {\r\n                  e.stopPropagation();\r\n                  onDelete(brand.systemId);\r\n                }}\r\n              >\r\n                <Trash2 className=\"h-4 w-4 mr-2\" />\r\n                Xóa thương hiệu\r\n              </DropdownMenuItem>\r\n            </DropdownMenuContent>\r\n          </DropdownMenu>\r\n        </div>\r\n      );\r\n    },\r\n    size: 80,\r\n    meta: {\r\n      displayName: \"Hành động\",\r\n      sticky: \"right\",\r\n    },\r\n  },\r\n];\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1120, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/brands/card.tsx"],"sourcesContent":["import * as React from \"react\";\r\nimport type { Brand } from '../settings/inventory/types';\r\nimport { Card, CardContent, CardTitle } from \"@/components/ui/card\";\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\r\nimport { TouchButton } from \"@/components/mobile/touch-button\";\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\r\nimport { MoreHorizontal, Globe, ExternalLink, Power, Eye, Pencil, Trash2, Image as ImageIcon } from \"lucide-react\";\r\n\r\nconst formatDate = (dateString?: string) => {\r\n  if (!dateString) return '';\r\n  const date = new Date(dateString);\r\n  return new Intl.DateTimeFormat('vi-VN', {\r\n    day: '2-digit',\r\n    month: '2-digit',\r\n    year: 'numeric'\r\n  }).format(date);\r\n};\r\n\r\nexport interface MobileBrandCardProps {\r\n  brand: Brand;\r\n  onDelete: (systemId: string) => void;\r\n  onToggleActive: (systemId: string, isActive: boolean) => void;\r\n  navigate: (path: string) => void;\r\n  handleRowClick: (brand: Brand) => void;\r\n}\r\n\r\nexport const MobileBrandCard = ({ brand, onDelete, onToggleActive, navigate, handleRowClick }: MobileBrandCardProps) => {\r\n  const getInitials = (name: string) => {\r\n    return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);\r\n  };\r\n\r\n  return (\r\n    <Card \r\n      className=\"hover:shadow-md transition-shadow cursor-pointer\"\r\n      onClick={() => handleRowClick(brand)}\r\n    >\r\n      <CardContent className=\"p-4\">\r\n        {/* Header: Logo + Name + Status + Menu */}\r\n        <div className=\"flex items-start justify-between gap-3 mb-3\">\r\n          <div className=\"flex items-center gap-3 flex-1 min-w-0\">\r\n            <Avatar className=\"h-12 w-12 flex-shrink-0\">\r\n              {brand.logo ? (\r\n                <AvatarImage src={brand.logo} alt={brand.name} />\r\n              ) : null}\r\n              <AvatarFallback className=\"bg-muted\">\r\n                {brand.logo ? getInitials(brand.name) : <ImageIcon className=\"h-5 w-5 text-muted-foreground\" />}\r\n              </AvatarFallback>\r\n            </Avatar>\r\n            <div className=\"flex flex-col min-w-0\">\r\n              <div className=\"flex items-center gap-2\">\r\n                <CardTitle className=\"font-semibold text-sm truncate\">{brand.name}</CardTitle>\r\n                {brand.isActive !== false ? (\r\n                  <Badge variant=\"default\" className=\"bg-green-100 text-green-800 hover:bg-green-100 text-[10px] h-5\">\r\n                    Hoạt động\r\n                  </Badge>\r\n                ) : (\r\n                  <Badge variant=\"secondary\" className=\"bg-gray-100 text-gray-600 text-[10px] h-5\">\r\n                    Tạm tắt\r\n                  </Badge>\r\n                )}\r\n              </div>\r\n              <span className=\"text-xs text-muted-foreground font-mono\">#{brand.id}</span>\r\n            </div>\r\n          </div>\r\n          \r\n          <DropdownMenu>\r\n            <DropdownMenuTrigger asChild>\r\n              <TouchButton\r\n                variant=\"ghost\"\r\n                size=\"sm\"\r\n                className=\"h-9 w-10 p-0 flex-shrink-0\"\r\n                onClick={(e) => e.stopPropagation()}\r\n              >\r\n                <MoreHorizontal className=\"h-4 w-4\" />\r\n              </TouchButton>\r\n            </DropdownMenuTrigger>\r\n            <DropdownMenuContent align=\"end\">\r\n              <DropdownMenuItem onClick={(e) => { e.stopPropagation(); navigate(`/brands/${brand.systemId}`); }}>\r\n                <Eye className=\"mr-2 h-4 w-4\" />\r\n                Xem chi tiết\r\n              </DropdownMenuItem>\r\n              <DropdownMenuItem onClick={(e) => { e.stopPropagation(); navigate(`/brands/${brand.systemId}/edit`); }}>\r\n                <Pencil className=\"mr-2 h-4 w-4\" />\r\n                Chỉnh sửa\r\n              </DropdownMenuItem>\r\n              <DropdownMenuSeparator />\r\n              <DropdownMenuItem onClick={(e) => { \r\n                e.stopPropagation(); \r\n                onToggleActive(brand.systemId, !brand.isActive); \r\n              }}>\r\n                <Power className=\"mr-2 h-4 w-4\" />\r\n                {brand.isActive !== false ? 'Tắt hoạt động' : 'Bật hoạt động'}\r\n              </DropdownMenuItem>\r\n              <DropdownMenuSeparator />\r\n              <DropdownMenuItem \r\n                className=\"text-destructive focus:text-destructive\"\r\n                onClick={(e) => { e.stopPropagation(); onDelete(brand.systemId); }}\r\n              >\r\n                <Trash2 className=\"mr-2 h-4 w-4\" />\r\n                Xóa thương hiệu\r\n              </DropdownMenuItem>\r\n            </DropdownMenuContent>\r\n          </DropdownMenu>\r\n        </div>\r\n\r\n        {/* Description */}\r\n        {brand.description && (\r\n          <p className=\"text-xs text-muted-foreground mb-3 line-clamp-2\">\r\n            {brand.description}\r\n          </p>\r\n        )}\r\n\r\n        {/* Website */}\r\n        {brand.website && (\r\n          <div className=\"flex items-center gap-1.5 text-xs mb-3\">\r\n            <Globe className=\"h-3 w-3 text-muted-foreground flex-shrink-0\" />\r\n            <a \r\n              href={brand.website} \r\n              target=\"_blank\" \r\n              rel=\"noopener noreferrer\"\r\n              className=\"text-primary hover:underline truncate\"\r\n              onClick={(e) => e.stopPropagation()}\r\n            >\r\n              {brand.website.replace(/^https?:\\/\\//, '')}\r\n            </a>\r\n            <ExternalLink className=\"h-3 w-3 text-muted-foreground flex-shrink-0\" />\r\n          </div>\r\n        )}\r\n\r\n        {/* Footer: SEO Status + Date */}\r\n        <div className=\"flex items-center justify-between pt-3 border-t\">\r\n          <div className=\"flex items-center gap-2\">\r\n            {/* SEO PKGX */}\r\n            {(brand.websiteSeo?.pkgx?.seoTitle || brand.websiteSeo?.pkgx?.metaDescription || brand.websiteSeo?.pkgx?.slug) && (\r\n              <Badge variant=\"outline\" className=\"text-[10px] bg-red-50 text-red-700 border-red-200\">\r\n                PKGX\r\n              </Badge>\r\n            )}\r\n            {/* SEO Trendtech */}\r\n            {(brand.websiteSeo?.trendtech?.seoTitle || brand.websiteSeo?.trendtech?.metaDescription || brand.websiteSeo?.trendtech?.slug) && (\r\n              <Badge variant=\"outline\" className=\"text-[10px] bg-blue-50 text-blue-700 border-blue-200\">\r\n                Trendtech\r\n              </Badge>\r\n            )}\r\n          </div>\r\n          <span className=\"text-[10px] text-muted-foreground\">\r\n            Tạo: {formatDate(brand.createdAt)}\r\n          </span>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1505, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/brands/hooks/use-pkgx-brand-sync.ts"],"sourcesContent":["/**\r\n * Hook chứa tất cả các handlers để đồng bộ thương hiệu (Brand) với PKGX\r\n * Tương tự như use-pkgx-sync.ts của products\r\n */\r\nimport React from 'react';\r\nimport { toast } from 'sonner';\r\nimport type { Brand } from '@/features/settings/inventory/types';\r\nimport { updateBrand, getBrandById } from '@/lib/pkgx/api-service';\r\nimport { usePkgxSettingsStore } from '@/features/settings/pkgx/store';\r\n\r\n// Types\r\ntype PkgxLogEntry = {\r\n  action: \r\n    | 'sync_brand_basic_info'\r\n    | 'sync_brand_seo'\r\n    | 'sync_brand_description'\r\n    | 'sync_brand_all';\r\n  status: 'success' | 'error' | 'partial' | 'info';\r\n  message: string;\r\n  details?: Record<string, unknown>;\r\n};\r\n\r\ntype UsePkgxBrandSyncOptions = {\r\n  addPkgxLog?: (entry: PkgxLogEntry) => void;\r\n};\r\n\r\n/**\r\n * Lấy pkgxBrandId từ brand mapping\r\n */\r\nfunction getPkgxBrandId(brand: Brand, brandMappings?: Array<{ hrmBrandSystemId: string; pkgxBrandId: number }>) {\r\n  if (!brandMappings) return undefined;\r\n  const mapping = brandMappings.find(m => m.hrmBrandSystemId === brand.systemId);\r\n  return mapping?.pkgxBrandId;\r\n}\r\n\r\n/**\r\n * Hook cung cấp các handlers để đồng bộ Brand với PKGX\r\n */\r\nexport function usePkgxBrandSync({ addPkgxLog }: UsePkgxBrandSyncOptions = {}) {\r\n  const { settings: pkgxSettings, updateBrand: updateBrandInStore } = usePkgxSettingsStore();\r\n\r\n  // Default log function if not provided\r\n  const logAction = React.useCallback((entry: PkgxLogEntry) => {\r\n    if (addPkgxLog) {\r\n      addPkgxLog(entry);\r\n    }\r\n    console.log('[PKGX Brand Sync]', entry.action, entry.status, entry.message);\r\n  }, [addPkgxLog]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // HELPER: Refresh brand data từ PKGX sau khi sync thành công\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const refreshBrandFromPkgx = React.useCallback(async (pkgxBrandId: number) => {\r\n    try {\r\n      const response = await getBrandById(pkgxBrandId);\r\n      if (response.success && response.data) {\r\n        // Cập nhật vào store\r\n        updateBrandInStore(pkgxBrandId, {\r\n          id: response.data.brand_id,\r\n          name: response.data.brand_name,\r\n          logo: response.data.brand_logo || '',\r\n          description: response.data.brand_desc || '',\r\n          shortDescription: response.data.short_desc || '',\r\n          longDescription: response.data.long_desc || '',\r\n          keywords: response.data.keywords || '',\r\n          metaTitle: response.data.meta_title || '',\r\n          metaDesc: response.data.meta_desc || '',\r\n          siteUrl: response.data.site_url || '',\r\n          sortOrder: response.data.sort_order || 0,\r\n          isShow: response.data.is_show ?? 1,\r\n        });\r\n        console.log('[PKGX Brand Sync] Auto-refreshed brand data from PKGX:', pkgxBrandId);\r\n      }\r\n    } catch (error) {\r\n      console.warn('[PKGX Brand Sync] Failed to refresh brand data:', error);\r\n    }\r\n  }, [updateBrandInStore]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // 1. SYNC THÔNG TIN CƠ BẢN (brand_name, site_url)\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const handleSyncBasicInfo = React.useCallback(async (brand: Brand) => {\r\n    const pkgxBrandId = getPkgxBrandId(brand, pkgxSettings?.brandMappings);\r\n    \r\n    if (!pkgxBrandId) {\r\n      toast.error('Thương hiệu chưa được liên kết với PKGX. Vui lòng mapping trong Cài đặt > PKGX.');\r\n      return;\r\n    }\r\n    \r\n    toast.loading(`Đang đồng bộ thông tin cơ bản...`, { id: 'pkgx-brand-sync-basic' });\r\n    \r\n    try {\r\n      const basicPayload = {\r\n        brand_name: brand.name,\r\n        site_url: brand.website || '',\r\n      };\r\n      \r\n      console.log('[PKGX Brand Basic Sync] Payload:', basicPayload);\r\n      \r\n      const response = await updateBrand(pkgxBrandId, basicPayload);\r\n      \r\n      if (response.success) {\r\n        // Auto-refresh để cập nhật store\r\n        await refreshBrandFromPkgx(pkgxBrandId);\r\n        \r\n        toast.success(`Đã đồng bộ thông tin cơ bản: ${brand.name}`, { id: 'pkgx-brand-sync-basic' });\r\n        logAction({\r\n          action: 'sync_brand_basic_info',\r\n          status: 'success',\r\n          message: `Đã đồng bộ thông tin cơ bản: ${brand.name}`,\r\n          details: { brandId: brand.systemId, pkgxBrandId, payload: basicPayload },\r\n        });\r\n      } else {\r\n        throw new Error(response.error);\r\n      }\r\n    } catch (error) {\r\n      toast.error(`Lỗi đồng bộ thông tin cơ bản: ${error instanceof Error ? error.message : 'Unknown error'}`, { id: 'pkgx-brand-sync-basic' });\r\n      logAction({\r\n        action: 'sync_brand_basic_info',\r\n        status: 'error',\r\n        message: `Lỗi đồng bộ thông tin cơ bản: ${brand.name}`,\r\n        details: { brandId: brand.systemId, error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    }\r\n  }, [pkgxSettings?.brandMappings, logAction, refreshBrandFromPkgx]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // 2. SYNC SEO (keywords, meta_title, meta_desc)\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const handleSyncSeo = React.useCallback(async (brand: Brand) => {\r\n    const pkgxBrandId = getPkgxBrandId(brand, pkgxSettings?.brandMappings);\r\n    \r\n    if (!pkgxBrandId) {\r\n      toast.error('Thương hiệu chưa được liên kết với PKGX. Vui lòng mapping trong Cài đặt > PKGX.');\r\n      return;\r\n    }\r\n    \r\n    toast.loading(`Đang đồng bộ SEO thương hiệu...`, { id: 'pkgx-brand-sync-seo' });\r\n    \r\n    try {\r\n      const pkgxSeo = brand.websiteSeo?.pkgx;\r\n      // Fallback chain: SEO PKGX → SEO Chung → name\r\n      // SEO chỉ gồm: keywords, meta_title, meta_desc\r\n      const seoPayload = {\r\n        keywords: pkgxSeo?.seoKeywords || brand.seoKeywords || brand.name,\r\n        meta_title: pkgxSeo?.seoTitle || brand.seoTitle || brand.name,\r\n        meta_desc: pkgxSeo?.metaDescription || brand.metaDescription || '',\r\n      };\r\n      \r\n      // DEBUG\r\n      console.log('[PKGX Brand SEO Sync] Brand:', brand.name);\r\n      console.log('[PKGX Brand SEO Sync] websiteSeo.pkgx:', pkgxSeo);\r\n      console.log('[PKGX Brand SEO Sync] SEO Chung - seoKeywords:', brand.seoKeywords);\r\n      console.log('[PKGX Brand SEO Sync] Payload:', seoPayload);\r\n      \r\n      const response = await updateBrand(pkgxBrandId, seoPayload);\r\n      \r\n      if (response.success) {\r\n        // Auto-refresh để cập nhật store\r\n        await refreshBrandFromPkgx(pkgxBrandId);\r\n        \r\n        toast.success(`Đã đồng bộ SEO cho thương hiệu: ${brand.name}`, { id: 'pkgx-brand-sync-seo' });\r\n        logAction({\r\n          action: 'sync_brand_seo',\r\n          status: 'success',\r\n          message: `Đã đồng bộ SEO: ${brand.name}`,\r\n          details: { brandId: brand.systemId, pkgxBrandId, payload: seoPayload },\r\n        });\r\n      } else {\r\n        throw new Error(response.error);\r\n      }\r\n    } catch (error) {\r\n      toast.error(`Lỗi đồng bộ SEO thương hiệu: ${error instanceof Error ? error.message : 'Unknown error'}`, { id: 'pkgx-brand-sync-seo' });\r\n      logAction({\r\n        action: 'sync_brand_seo',\r\n        status: 'error',\r\n        message: `Lỗi đồng bộ SEO: ${brand.name}`,\r\n        details: { brandId: brand.systemId, error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    }\r\n  }, [pkgxSettings?.brandMappings, logAction, refreshBrandFromPkgx]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // 3. SYNC MÔ TẢ (short_desc, long_desc)\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const handleSyncDescription = React.useCallback(async (brand: Brand) => {\r\n    const pkgxBrandId = getPkgxBrandId(brand, pkgxSettings?.brandMappings);\r\n    \r\n    if (!pkgxBrandId) {\r\n      toast.error('Thương hiệu chưa được liên kết với PKGX. Vui lòng mapping trong Cài đặt > PKGX.');\r\n      return;\r\n    }\r\n    \r\n    toast.loading(`Đang đồng bộ mô tả thương hiệu...`, { id: 'pkgx-brand-sync-desc' });\r\n    \r\n    try {\r\n      const pkgxSeo = brand.websiteSeo?.pkgx;\r\n      // Mô tả chỉ gồm: short_desc, long_desc\r\n      const descPayload = {\r\n        short_desc: pkgxSeo?.shortDescription || brand.shortDescription || '',\r\n        long_desc: pkgxSeo?.longDescription || brand.longDescription || '',\r\n      };\r\n      \r\n      console.log('[PKGX Brand Desc Sync] Payload:', descPayload);\r\n      \r\n      const response = await updateBrand(pkgxBrandId, descPayload);\r\n      \r\n      if (response.success) {\r\n        // Auto-refresh để cập nhật store\r\n        await refreshBrandFromPkgx(pkgxBrandId);\r\n        \r\n        toast.success(`Đã đồng bộ mô tả cho thương hiệu: ${brand.name}`, { id: 'pkgx-brand-sync-desc' });\r\n        logAction({\r\n          action: 'sync_brand_description',\r\n          status: 'success',\r\n          message: `Đã đồng bộ mô tả: ${brand.name}`,\r\n          details: { brandId: brand.systemId, pkgxBrandId },\r\n        });\r\n      } else {\r\n        throw new Error(response.error);\r\n      }\r\n    } catch (error) {\r\n      toast.error(`Lỗi đồng bộ mô tả thương hiệu: ${error instanceof Error ? error.message : 'Unknown error'}`, { id: 'pkgx-brand-sync-desc' });\r\n      logAction({\r\n        action: 'sync_brand_description',\r\n        status: 'error',\r\n        message: `Lỗi đồng bộ mô tả: ${brand.name}`,\r\n        details: { brandId: brand.systemId, error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    }\r\n  }, [pkgxSettings?.brandMappings, logAction, refreshBrandFromPkgx]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // 4. SYNC TẤT CẢ (Thông tin cơ bản + SEO + Mô tả)\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const handleSyncAll = React.useCallback(async (brand: Brand) => {\r\n    const pkgxBrandId = getPkgxBrandId(brand, pkgxSettings?.brandMappings);\r\n    \r\n    if (!pkgxBrandId) {\r\n      toast.error('Thương hiệu chưa được liên kết với PKGX. Vui lòng mapping trong Cài đặt > PKGX.');\r\n      return;\r\n    }\r\n    \r\n    toast.loading(`Đang đồng bộ tất cả thông tin thương hiệu...`, { id: 'pkgx-brand-sync-all' });\r\n    \r\n    try {\r\n      const pkgxSeo = brand.websiteSeo?.pkgx;\r\n      \r\n      // Build full payload\r\n      const fullPayload = {\r\n        // Basic info\r\n        brand_name: brand.name,\r\n        site_url: brand.website || '',\r\n        // SEO fields - Fallback chain: SEO PKGX → SEO Chung → name\r\n        keywords: pkgxSeo?.seoKeywords || brand.seoKeywords || brand.name,\r\n        meta_title: pkgxSeo?.seoTitle || brand.seoTitle || brand.name,\r\n        meta_desc: pkgxSeo?.metaDescription || brand.metaDescription || '',\r\n        // Descriptions\r\n        brand_desc: brand.description || '',\r\n        short_desc: pkgxSeo?.shortDescription || brand.shortDescription || '',\r\n        long_desc: pkgxSeo?.longDescription || brand.longDescription || '',\r\n      };\r\n      \r\n      console.log('[PKGX Brand Sync All] Payload:', fullPayload);\r\n      \r\n      const response = await updateBrand(pkgxBrandId, fullPayload);\r\n      \r\n      if (response.success) {\r\n        // Auto-refresh để cập nhật store\r\n        await refreshBrandFromPkgx(pkgxBrandId);\r\n        \r\n        toast.success(`Đã đồng bộ tất cả thông tin thương hiệu: ${brand.name}`, { id: 'pkgx-brand-sync-all' });\r\n        logAction({\r\n          action: 'sync_brand_all',\r\n          status: 'success',\r\n          message: `Đã đồng bộ tất cả: ${brand.name}`,\r\n          details: { brandId: brand.systemId, pkgxBrandId },\r\n        });\r\n      } else {\r\n        throw new Error(response.error);\r\n      }\r\n    } catch (error) {\r\n      toast.error(`Lỗi đồng bộ thương hiệu: ${error instanceof Error ? error.message : 'Unknown error'}`, { id: 'pkgx-brand-sync-all' });\r\n      logAction({\r\n        action: 'sync_brand_all',\r\n        status: 'error',\r\n        message: `Lỗi đồng bộ: ${brand.name}`,\r\n        details: { brandId: brand.systemId, error: error instanceof Error ? error.message : String(error) },\r\n      });\r\n    }\r\n  }, [pkgxSettings?.brandMappings, logAction, refreshBrandFromPkgx]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // HELPER: Kiểm tra brand có mapping với PKGX không\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const hasPkgxMapping = React.useCallback((brand: Brand) => {\r\n    return !!getPkgxBrandId(brand, pkgxSettings?.brandMappings);\r\n  }, [pkgxSettings?.brandMappings]);\r\n\r\n  return {\r\n    handleSyncBasicInfo,\r\n    handleSyncSeo,\r\n    handleSyncDescription,\r\n    handleSyncAll,\r\n    hasPkgxMapping,\r\n    getPkgxBrandId: (brand: Brand) => getPkgxBrandId(brand, pkgxSettings?.brandMappings),\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1836, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/brands/components/pkgx-link-dialog.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Link2 } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { Button } from '@/components/ui/button';\r\nimport {\r\n  Dialog,\r\n  DialogContent,\r\n  DialogDescription,\r\n  DialogFooter,\r\n  DialogHeader,\r\n  DialogTitle,\r\n} from '@/components/ui/dialog';\r\nimport { VirtualizedCombobox, type ComboboxOption } from '@/components/ui/virtualized-combobox';\r\nimport { usePkgxSettingsStore } from '@/features/settings/pkgx/store';\r\nimport type { Brand } from '@/features/settings/inventory/types';\r\nimport type { PkgxBrand } from '@/features/settings/pkgx/types';\r\nimport { getBrands as fetchPkgxBrands } from '@/lib/pkgx/api-service';\r\n\r\ninterface PkgxBrandLinkDialogProps {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  brand: Brand | null;\r\n  onSuccess?: (pkgxBrandId: number) => void;\r\n}\r\n\r\nexport function PkgxBrandLinkDialog({\r\n  open,\r\n  onOpenChange,\r\n  brand,\r\n  onSuccess,\r\n}: PkgxBrandLinkDialogProps) {\r\n  const pkgxSettingsStore = usePkgxSettingsStore();\r\n  const cachedPkgxBrands = pkgxSettingsStore.settings.brands;\r\n  const brandMappings = pkgxSettingsStore.settings.brandMappings;\r\n  const addBrandMapping = pkgxSettingsStore.addBrandMapping;\r\n  const setBrands = pkgxSettingsStore.setBrands;\r\n  \r\n  const [selectedPkgxBrand, setSelectedPkgxBrand] = React.useState<ComboboxOption | null>(null);\r\n  const [pkgxBrands, setPkgxBrandsLocal] = React.useState<PkgxBrand[]>([]);\r\n  const [isLoading, setIsLoading] = React.useState(false);\r\n  const [isSyncing, setIsSyncing] = React.useState(false);\r\n  const [hasFetched, setHasFetched] = React.useState(false);\r\n\r\n  // Load PKGX brands khi mở dialog - chỉ chạy 1 lần\r\n  React.useEffect(() => {\r\n    if (open && !hasFetched) {\r\n      if (cachedPkgxBrands && cachedPkgxBrands.length > 0) {\r\n        setPkgxBrandsLocal(cachedPkgxBrands);\r\n        setHasFetched(true);\r\n      } else {\r\n        loadPkgxBrands();\r\n      }\r\n    }\r\n  }, [open, hasFetched, cachedPkgxBrands]);\r\n\r\n  // Reset state khi đóng dialog\r\n  React.useEffect(() => {\r\n    if (!open) {\r\n      setSelectedPkgxBrand(null);\r\n    }\r\n  }, [open]);\r\n\r\n  const loadPkgxBrands = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      const response = await fetchPkgxBrands();\r\n      if (response.success && response.data && response.data.data) {\r\n        // API trả về { error, message, total, data: PkgxBrandFromApi[] }\r\n        // Cần map từ PkgxBrandFromApi -> PkgxBrand\r\n        const brandsArray = response.data.data.map(b => ({\r\n          id: b.brand_id,\r\n          name: b.brand_name,\r\n          brand_logo: b.brand_logo,\r\n          brand_desc: b.brand_desc,\r\n          site_url: b.site_url,\r\n          sort_order: b.sort_order,\r\n        }));\r\n        setPkgxBrandsLocal(brandsArray);\r\n        setBrands(brandsArray); // Lưu vào store để dùng chung\r\n        setHasFetched(true);\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to load PKGX brands:', error);\r\n      toast.error('Không thể tải danh sách thương hiệu PKGX');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Filter out brands that are already linked\r\n  const linkedPkgxBrandIds = React.useMemo(() => {\r\n    return new Set(brandMappings.map(m => m.pkgxBrandId));\r\n  }, [brandMappings]);\r\n\r\n  // Convert PKGX brands to combobox options\r\n  const pkgxOptions: ComboboxOption[] = React.useMemo(() => {\r\n    return pkgxBrands\r\n      .filter(b => !linkedPkgxBrandIds.has(b.id)) // Exclude already linked\r\n      .map(b => ({\r\n        value: String(b.id),\r\n        label: b.name,\r\n        subtitle: `ID: ${b.id}`,\r\n        metadata: b,\r\n      }));\r\n  }, [pkgxBrands, linkedPkgxBrandIds]);\r\n\r\n  const handleConfirmLink = async () => {\r\n    if (!brand || !selectedPkgxBrand) {\r\n      toast.error('Vui lòng chọn thương hiệu PKGX để liên kết');\r\n      return;\r\n    }\r\n\r\n    setIsSyncing(true);\r\n    try {\r\n      const pkgxBrandId = Number(selectedPkgxBrand.value);\r\n      \r\n      // Add mapping to store\r\n      addBrandMapping({\r\n        id: `brand-mapping-${brand.systemId}-${pkgxBrandId}`,\r\n        hrmBrandSystemId: brand.systemId,\r\n        hrmBrandName: brand.name,\r\n        pkgxBrandId: pkgxBrandId,\r\n        pkgxBrandName: selectedPkgxBrand.label,\r\n      });\r\n      \r\n      // Log to console\r\n      console.log('[PKGX Brand Link]', {\r\n        action: 'link_brand',\r\n        status: 'success',\r\n        brandId: brand.systemId,\r\n        pkgxBrandId,\r\n        pkgxBrandName: selectedPkgxBrand.label,\r\n      });\r\n\r\n      toast.success(`Đã liên kết với thương hiệu PKGX: ${selectedPkgxBrand.label}`);\r\n      onSuccess?.(pkgxBrandId);\r\n      onOpenChange(false);\r\n    } catch (error) {\r\n      console.error('[PKGX Brand Link Error]', error);\r\n      toast.error('Lỗi khi liên kết thương hiệu');\r\n    } finally {\r\n      setIsSyncing(false);\r\n    }\r\n  };\r\n\r\n  if (!brand) return null;\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-[500px]\">\r\n        <DialogHeader>\r\n          <DialogTitle>Liên kết với thương hiệu PKGX</DialogTitle>\r\n          <DialogDescription>\r\n            Chọn thương hiệu PKGX để liên kết với thương hiệu HRM này\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"space-y-4 py-4\">\r\n          {/* HRM Brand Info */}\r\n          <div className=\"rounded-lg bg-muted p-3\">\r\n            <p className=\"text-sm font-medium\">Thương hiệu HRM:</p>\r\n            <p className=\"text-sm\">{brand.name}</p>\r\n            <p className=\"text-xs text-muted-foreground\">\r\n              Mã: {brand.id} | SystemID: {brand.systemId}\r\n            </p>\r\n          </div>\r\n\r\n          {/* PKGX Brand Selector */}\r\n          <div className=\"space-y-2\">\r\n            <label className=\"text-sm font-medium\">Chọn thương hiệu PKGX</label>\r\n            <VirtualizedCombobox\r\n              value={selectedPkgxBrand}\r\n              onChange={setSelectedPkgxBrand}\r\n              options={pkgxOptions}\r\n              placeholder=\"Tìm và chọn thương hiệu PKGX...\"\r\n              searchPlaceholder=\"Tìm theo tên...\"\r\n              emptyPlaceholder={isLoading ? 'Đang tải...' : 'Không tìm thấy thương hiệu PKGX'}\r\n              isLoading={isLoading}\r\n              disabled={isLoading}\r\n            />\r\n            {pkgxOptions.length === 0 && !isLoading && (\r\n              <p className=\"text-xs text-muted-foreground\">\r\n                Tất cả thương hiệu PKGX đã được liên kết. Hãy đồng bộ danh sách mới từ PKGX.\r\n              </p>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <DialogFooter>\r\n          <Button\r\n            variant=\"outline\"\r\n            onClick={() => onOpenChange(false)}\r\n            disabled={isSyncing}\r\n          >\r\n            Hủy\r\n          </Button>\r\n          <Button\r\n            onClick={handleConfirmLink}\r\n            disabled={!selectedPkgxBrand || isSyncing}\r\n          >\r\n            <Link2 className=\"h-4 w-4 mr-2\" />\r\n            {isSyncing ? 'Đang liên kết...' : 'Liên kết'}\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2138, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/brands/components/pkgx-brand-detail-dialog.tsx"],"sourcesContent":["/**\r\n * Dialog hiển thị chi tiết thương hiệu từ PKGX\r\n */\r\nimport * as React from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { ScrollArea } from '@/components/ui/scroll-area';\r\nimport { Separator } from '@/components/ui/separator';\r\nimport { ExternalLink, Loader2, Globe, Search, AlignLeft } from 'lucide-react';\r\nimport { getBrandById } from '@/lib/pkgx/api-service';\r\nimport type { Brand } from '@/features/settings/inventory/types';\r\n\r\ntype PkgxBrandData = {\r\n  brand_id: number;\r\n  brand_name: string;\r\n  brand_logo?: string;\r\n  brand_desc?: string;\r\n  short_desc?: string;\r\n  long_desc?: string;\r\n  keywords?: string;\r\n  meta_title?: string;\r\n  meta_desc?: string;\r\n  site_url?: string;\r\n  sort_order?: number;\r\n};\r\n\r\ntype Props = {\r\n  open: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  brand: Brand | null;\r\n  pkgxBrandId: number | null;\r\n};\r\n\r\nexport function PkgxBrandDetailDialog({ open, onOpenChange, brand, pkgxBrandId }: Props) {\r\n  const [loading, setLoading] = React.useState(false);\r\n  const [pkgxData, setPkgxData] = React.useState<PkgxBrandData | null>(null);\r\n  const [error, setError] = React.useState<string | null>(null);\r\n\r\n  // Fetch PKGX brand data\r\n  const fetchPkgxData = React.useCallback(async () => {\r\n    if (!pkgxBrandId) return;\r\n    \r\n    setLoading(true);\r\n    setError(null);\r\n    \r\n    try {\r\n      const response = await getBrandById(pkgxBrandId);\r\n      if (response.success && response.data) {\r\n        setPkgxData(response.data);\r\n      } else {\r\n        setError(response.error || 'Không thể tải thông tin từ PKGX');\r\n      }\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Lỗi kết nối');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [pkgxBrandId]);\r\n\r\n  // Fetch when dialog opens\r\n  React.useEffect(() => {\r\n    if (open && pkgxBrandId) {\r\n      fetchPkgxData();\r\n    }\r\n  }, [open, pkgxBrandId, fetchPkgxData]);\r\n\r\n  // Reset when dialog closes\r\n  React.useEffect(() => {\r\n    if (!open) {\r\n      setPkgxData(null);\r\n      setError(null);\r\n    }\r\n  }, [open]);\r\n\r\n  const handleOpenAdmin = () => {\r\n    if (pkgxBrandId) {\r\n      window.open(`https://phukiengiaxuong.com.vn/admin/brand.php?act=edit&id=${pkgxBrandId}`, '_blank');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"max-w-2xl max-h-[85vh]\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <span>Thông tin trên PKGX</span>\r\n            {brand && <Badge variant=\"outline\">{brand.name}</Badge>}\r\n          </DialogTitle>\r\n          <DialogDescription>\r\n            Dữ liệu hiện tại của thương hiệu trên website PKGX\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <ScrollArea className=\"max-h-[60vh] pr-4\">\r\n          {loading ? (\r\n            <div className=\"flex items-center justify-center py-12\">\r\n              <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n              <span className=\"ml-2 text-muted-foreground\">Đang tải...</span>\r\n            </div>\r\n          ) : error ? (\r\n            <div className=\"text-center py-12 text-destructive\">\r\n              <p>{error}</p>\r\n            </div>\r\n          ) : pkgxData ? (\r\n            <div className=\"space-y-4\">\r\n              {/* Basic Info */}\r\n              <div className=\"space-y-2\">\r\n                <h4 className=\"font-medium flex items-center gap-2 text-sm text-muted-foreground\">\r\n                  <Globe className=\"h-4 w-4\" />\r\n                  Thông tin cơ bản\r\n                </h4>\r\n                <div className=\"grid grid-cols-2 gap-3 p-3 bg-muted/50 rounded-lg\">\r\n                  <div>\r\n                    <p className=\"text-xs text-muted-foreground\">ID PKGX</p>\r\n                    <p className=\"font-medium\">{pkgxData.brand_id}</p>\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-xs text-muted-foreground\">Tên thương hiệu</p>\r\n                    <p className=\"font-medium\">{pkgxData.brand_name || '—'}</p>\r\n                  </div>\r\n                  <div className=\"col-span-2\">\r\n                    <p className=\"text-xs text-muted-foreground\">Website URL</p>\r\n                    <p className=\"font-medium\">{pkgxData.site_url || '—'}</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <Separator />\r\n\r\n              {/* SEO Info */}\r\n              <div className=\"space-y-2\">\r\n                <h4 className=\"font-medium flex items-center gap-2 text-sm text-muted-foreground\">\r\n                  <Search className=\"h-4 w-4\" />\r\n                  SEO\r\n                </h4>\r\n                <div className=\"space-y-3 p-3 bg-muted/50 rounded-lg\">\r\n                  <div>\r\n                    <p className=\"text-xs text-muted-foreground\">Keywords</p>\r\n                    <p className=\"text-sm\">{pkgxData.keywords || <span className=\"text-muted-foreground italic\">Chưa có</span>}</p>\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-xs text-muted-foreground\">Meta Title</p>\r\n                    <p className=\"text-sm\">{pkgxData.meta_title || <span className=\"text-muted-foreground italic\">Chưa có</span>}</p>\r\n                  </div>\r\n                  <div>\r\n                    <p className=\"text-xs text-muted-foreground\">Meta Description</p>\r\n                    <p className=\"text-sm\">{pkgxData.meta_desc || <span className=\"text-muted-foreground italic\">Chưa có</span>}</p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              <Separator />\r\n\r\n              {/* Descriptions */}\r\n              <div className=\"space-y-2\">\r\n                <h4 className=\"font-medium flex items-center gap-2 text-sm text-muted-foreground\">\r\n                  <AlignLeft className=\"h-4 w-4\" />\r\n                  Mô tả\r\n                </h4>\r\n                <div className=\"space-y-3 p-3 bg-muted/50 rounded-lg\">\r\n                  <div>\r\n                    <p className=\"text-xs text-muted-foreground\">Mô tả ngắn (Short Desc)</p>\r\n                    <div \r\n                      className=\"text-sm prose prose-sm max-w-none\"\r\n                      dangerouslySetInnerHTML={{ __html: pkgxData.short_desc || '<span class=\"text-muted-foreground italic\">Chưa có</span>' }}\r\n                    />\r\n                  </div>\r\n                  <Separator />\r\n                  <div>\r\n                    <p className=\"text-xs text-muted-foreground\">Mô tả dài (Long Desc)</p>\r\n                    <div \r\n                      className=\"text-sm prose prose-sm max-w-none max-h-40 overflow-y-auto\"\r\n                      dangerouslySetInnerHTML={{ __html: pkgxData.long_desc || '<span class=\"text-muted-foreground italic\">Chưa có</span>' }}\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ) : null}\r\n        </ScrollArea>\r\n\r\n        <div className=\"flex justify-end gap-2 pt-4 border-t\">\r\n          <Button variant=\"outline\" onClick={() => onOpenChange(false)}>\r\n            Đóng\r\n          </Button>\r\n          <Button onClick={handleOpenAdmin}>\r\n            <ExternalLink className=\"mr-2 h-4 w-4\" />\r\n            Mở trang Admin PKGX\r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2700, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/brands/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport * as React from \"react\";\r\nimport { useRouter } from 'next/navigation';\r\nimport { useShallow } from 'zustand/react/shallow';\r\nimport { useColumnVisibility, useColumnOrder, usePinnedColumns } from '@/hooks/use-column-visibility';\r\nimport { Plus, Power, PowerOff, Trash2, RefreshCw, Search, AlignLeft, ExternalLink, Link2, Unlink, FileUp, Download } from \"lucide-react\";\r\nimport { asBusinessId, asSystemId, type SystemId } from \"@/lib/id-types\";\r\nimport { usePageHeader } from \"../../contexts/page-header-context\";\r\nimport { useBrandStore } from \"../settings/inventory/brand-store\";\r\nimport type { Brand } from \"../settings/inventory/types\";\r\nimport { Button } from \"../../components/ui/button\";\r\nimport { ResponsiveDataTable } from \"@/components/data-table/responsive-data-table\";\r\nimport { Card, CardContent } from \"@/components/ui/card\";\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from \"@/components/ui/alert-dialog\";\r\nimport { DataTableColumnCustomizer } from \"@/components/data-table/data-table-column-toggle\";\r\nimport { DataTableExportDialog } from \"@/components/data-table/data-table-export-dialog\";\r\nimport { DataTableFacetedFilter } from \"@/components/data-table/data-table-faceted-filter\";\r\nimport { PageToolbar } from \"@/components/layout/page-toolbar\";\r\nimport { PageFilters } from \"@/components/layout/page-filters\";\r\nimport { useMediaQuery } from \"@/lib/use-media-query\";\r\nimport { toast } from \"sonner\";\r\nimport Fuse from \"fuse.js\";\r\nimport { getColumns } from \"./columns\";\r\nimport { MobileBrandCard } from \"./card\";\r\nimport { usePkgxBrandSync } from \"./hooks/use-pkgx-brand-sync\";\r\nimport { usePkgxSettingsStore } from \"../settings/pkgx/store\";\r\nimport { usePkgxBulkSync } from \"../settings/pkgx/hooks/use-pkgx-bulk-sync\";\r\nimport { PkgxBulkSyncConfirmDialog } from \"../settings/pkgx/components/pkgx-bulk-sync-confirm-dialog\";\r\nimport { updateBrand } from \"@/lib/pkgx/api-service\";\r\nimport { PkgxBrandLinkDialog } from \"./components/pkgx-link-dialog\";\r\nimport { PkgxBrandDetailDialog } from \"./components/pkgx-brand-detail-dialog\";\r\nimport { GenericImportDialogV2 } from \"../../components/shared/generic-import-dialog-v2\";\r\nimport { GenericExportDialogV2 } from \"../../components/shared/generic-export-dialog-v2\";\r\nimport { brandImportExportConfig } from \"@/lib/import-export/configs/brand.config\";\r\nimport { useAuth } from \"@/contexts/auth-context\";\r\n\r\nexport function BrandsPage() {\r\n  const router = useRouter();\r\n  const isMobile = useMediaQuery(\"(max-width: 768px)\");\r\n  const { employee: authEmployee } = useAuth();\r\n  \r\n  // ✅ Use shallow comparison to prevent unnecessary re-renders\r\n  const { data, add, update, remove, loadFromAPI } = useBrandStore(\r\n    useShallow((state) => ({\r\n      data: state.data,\r\n      add: state.add,\r\n      update: state.update,\r\n      remove: state.remove,\r\n      loadFromAPI: state.loadFromAPI,\r\n    }))\r\n  );\r\n\r\n  // Load data from API on mount\r\n  React.useEffect(() => {\r\n    loadFromAPI();\r\n  }, [loadFromAPI]);\r\n\r\n  const activeBrands = React.useMemo(() => data.filter(b => !b.isDeleted), [data]);\r\n\r\n  // State\r\n  const [rowSelection, setRowSelection] = React.useState<Record<string, boolean>>({});\r\n  const [isAlertOpen, setIsAlertOpen] = React.useState(false);\r\n  const [idToDelete, setIdToDelete] = React.useState<string | null>(null);\r\n  const [isBulkDeleteAlertOpen, setIsBulkDeleteAlertOpen] = React.useState(false);\r\n\r\n  const [sorting, setSorting] = React.useState({ id: 'name', desc: false });\r\n  const [globalFilter, setGlobalFilter] = React.useState('');\r\n  const [debouncedGlobalFilter, setDebouncedGlobalFilter] = React.useState('');\r\n  const [pagination, setPagination] = React.useState({ pageIndex: 0, pageSize: 20 });\r\n  const [mobileLoadedCount, setMobileLoadedCount] = React.useState(20);\r\n  \r\n  const [columnVisibility, setColumnVisibility] = useColumnVisibility('brands', {});\r\n\r\n  // Column order and pinned columns - synced to database\r\n  const [columnOrder, setColumnOrder] = useColumnOrder('brands', []);\r\n  const [pinnedColumns, setPinnedColumns] = usePinnedColumns('brands', ['select', 'logo', 'name']);\r\n\r\n  // Filters\r\n  const [statusFilter, setStatusFilter] = React.useState<Set<string>>(new Set());\r\n\r\n  // Debounce search\r\n  React.useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      setDebouncedGlobalFilter(globalFilter);\r\n    }, 300);\r\n    return () => clearTimeout(timer);\r\n  }, [globalFilter]);\r\n\r\n  // Handlers\r\n  const handleDelete = React.useCallback((systemId: string) => {\r\n    setIdToDelete(systemId);\r\n    setIsAlertOpen(true);\r\n  }, []);\r\n\r\n  const handleToggleActive = React.useCallback((systemId: string, isActive: boolean) => {\r\n    update(asSystemId(systemId), { isActive });\r\n    toast.success(isActive ? 'Đã kích hoạt thương hiệu' : 'Đã tắt thương hiệu');\r\n  }, [update]);\r\n\r\n  // Inline edit handlers\r\n  const handleUpdateName = React.useCallback((systemId: string, name: string) => {\r\n    update(asSystemId(systemId), { name });\r\n    toast.success('Đã cập nhật tên thương hiệu');\r\n  }, [update]);\r\n\r\n  // Bulk actions\r\n  const handleBulkActivate = React.useCallback(() => {\r\n    const ids = Object.keys(rowSelection);\r\n    ids.forEach(id => update(asSystemId(id), { isActive: true }));\r\n    toast.success(`Đã kích hoạt ${ids.length} thương hiệu`);\r\n    setRowSelection({});\r\n  }, [rowSelection, update]);\r\n\r\n  const handleBulkDeactivate = React.useCallback(() => {\r\n    const ids = Object.keys(rowSelection);\r\n    ids.forEach(id => update(asSystemId(id), { isActive: false }));\r\n    toast.success(`Đã tắt ${ids.length} thương hiệu`);\r\n    setRowSelection({});\r\n  }, [rowSelection, update]);\r\n\r\n  const handleRowClick = React.useCallback((brand: Brand) => {\r\n    router.push(`/brands/${brand.systemId}`);\r\n  }, [router]);\r\n\r\n  // PKGX Sync Hook\r\n  const { handleSyncBasicInfo, handleSyncSeo, handleSyncDescription, handleSyncAll, hasPkgxMapping, getPkgxBrandId } = usePkgxBrandSync();\r\n  const pkgxSettings = usePkgxSettingsStore((s) => s.settings);\r\n  const deleteBrandMapping = usePkgxSettingsStore((s) => s.deleteBrandMapping);\r\n  const getBrandMappingByHrmId = usePkgxSettingsStore((s) => s.getBrandMappingByHrmId);\r\n  \r\n  // Bulk sync hook for PKGX brands\r\n  const {\r\n    confirmAction: bulkConfirmAction,\r\n    progress: bulkProgress,\r\n    triggerBulkSync,\r\n    executeAction: executeBulkAction,\r\n    cancelConfirm: cancelBulkConfirm,\r\n    getPkgxBrandId: hookGetPkgxBrandId,\r\n  } = usePkgxBulkSync({ entityType: 'brand' });\r\n  \r\n  // PKGX Link Dialog state\r\n  const [pkgxLinkDialogOpen, setPkgxLinkDialogOpen] = React.useState(false);\r\n  const [brandToLink, setBrandToLink] = React.useState<Brand | null>(null);\r\n  \r\n  // PKGX Detail Dialog state\r\n  const [pkgxDetailDialogOpen, setPkgxDetailDialogOpen] = React.useState(false);\r\n  const [brandToViewDetail, setBrandToViewDetail] = React.useState<Brand | null>(null);\r\n  const [pkgxBrandIdToView, setPkgxBrandIdToView] = React.useState<number | null>(null);\r\n  \r\n  // Import/Export Dialog states\r\n  const [isImportOpen, setIsImportOpen] = React.useState(false);\r\n  const [isExportOpen, setIsExportOpen] = React.useState(false);\r\n  \r\n  // PKGX Link handlers\r\n  const handlePkgxLink = React.useCallback((brand: Brand) => {\r\n    setBrandToLink(brand);\r\n    setPkgxLinkDialogOpen(true);\r\n  }, []);\r\n  \r\n  const handlePkgxUnlink = React.useCallback((brand: Brand) => {\r\n    const mapping = getBrandMappingByHrmId(brand.systemId);\r\n    if (mapping) {\r\n      deleteBrandMapping(mapping.id);\r\n      toast.success(`Đã hủy liên kết thương hiệu \"${brand.name}\" với PKGX`);\r\n    }\r\n  }, [getBrandMappingByHrmId, deleteBrandMapping]);\r\n  \r\n  const handlePkgxLinkSuccess = React.useCallback(() => {\r\n    // Refresh handled by store update\r\n  }, []);\r\n  \r\n  // PKGX View Detail handler\r\n  const handlePkgxViewDetail = React.useCallback((brand: Brand, pkgxBrandId: number) => {\r\n    setBrandToViewDetail(brand);\r\n    setPkgxBrandIdToView(pkgxBrandId);\r\n    setPkgxDetailDialogOpen(true);\r\n  }, []);\r\n\r\n  const columns = React.useMemo(() => getColumns(\r\n    handleDelete, \r\n    handleToggleActive, \r\n    (path: string) => router.push(path),\r\n    handleUpdateName,\r\n    // PKGX handlers - used by PkgxBrandActionsCell\r\n    hasPkgxMapping,\r\n    getPkgxBrandId,\r\n    handlePkgxLink,\r\n    handlePkgxUnlink,\r\n    handlePkgxViewDetail,\r\n  ), [handleDelete, handleToggleActive, router, handleUpdateName, hasPkgxMapping, getPkgxBrandId, handlePkgxLink, handlePkgxUnlink, handlePkgxViewDetail]);\r\n\r\n  // Bulk actions config\r\n  const bulkActions = React.useMemo(() => [\r\n    {\r\n      label: 'Kích hoạt',\r\n      icon: Power,\r\n      onSelect: handleBulkActivate,\r\n    },\r\n    {\r\n      label: 'Tắt hoạt động',\r\n      icon: PowerOff,\r\n      onSelect: handleBulkDeactivate,\r\n    },\r\n    {\r\n      label: 'Xóa',\r\n      icon: Trash2,\r\n      onSelect: () => setIsBulkDeleteAlertOpen(true),\r\n    },\r\n  ], [handleBulkActivate, handleBulkDeactivate]);\r\n\r\n  // ═══════════════════════════════════════════════════════════════\r\n  // PKGX Bulk Actions - Using shared usePkgxBulkSync hook\r\n  // ═══════════════════════════════════════════════════════════════\r\n  const pkgxBulkActions = React.useMemo(() => [\r\n    {\r\n      label: \"Đồng bộ tất cả\",\r\n      icon: RefreshCw,\r\n      onSelect: (selectedRows: Brand[]) => {\r\n        triggerBulkSync(selectedRows, 'sync_all');\r\n      }\r\n    },\r\n    {\r\n      label: \"SEO\",\r\n      icon: Search,\r\n      onSelect: (selectedRows: Brand[]) => {\r\n        triggerBulkSync(selectedRows, 'sync_seo');\r\n      }\r\n    },\r\n    {\r\n      label: \"Mô tả\",\r\n      icon: AlignLeft,\r\n      onSelect: (selectedRows: Brand[]) => {\r\n        triggerBulkSync(selectedRows, 'sync_description');\r\n      }\r\n    },\r\n    {\r\n      label: \"Xem trên PKGX\",\r\n      icon: ExternalLink,\r\n      onSelect: (selectedRows: Brand[]) => {\r\n        const linkedBrands = selectedRows.filter(b => hasPkgxMapping(b));\r\n        if (linkedBrands.length === 0) {\r\n          toast.error('Không có thương hiệu nào đã liên kết PKGX');\r\n          return;\r\n        }\r\n        const firstBrand = linkedBrands[0];\r\n        const pkgxId = getPkgxBrandId(firstBrand);\r\n        if (pkgxId) {\r\n          window.open(`https://phukiengiaxuong.com.vn/admin/brand.php?act=edit&id=${pkgxId}`, '_blank');\r\n        }\r\n      }\r\n    },\r\n    {\r\n      label: \"Hủy liên kết\",\r\n      icon: Unlink,\r\n      variant: \"destructive\" as const,\r\n      onSelect: (selectedRows: Brand[]) => {\r\n        const linkedBrands = selectedRows.filter(b => hasPkgxMapping(b));\r\n        if (linkedBrands.length === 0) {\r\n          toast.error('Không có thương hiệu nào đã liên kết PKGX');\r\n          return;\r\n        }\r\n        \r\n        if (!confirm(`Bạn có chắc muốn hủy liên kết ${linkedBrands.length} thương hiệu với PKGX?`)) {\r\n          return;\r\n        }\r\n        \r\n        let count = 0;\r\n        for (const brand of linkedBrands) {\r\n          const mapping = getBrandMappingByHrmId(brand.systemId);\r\n          if (mapping) {\r\n            deleteBrandMapping(mapping.id);\r\n            count++;\r\n          }\r\n        }\r\n        \r\n        setRowSelection({});\r\n        toast.success(`Đã hủy liên kết ${count} thương hiệu`);\r\n      }\r\n    },\r\n  ], [triggerBulkSync, hasPkgxMapping, getPkgxBrandId, getBrandMappingByHrmId, deleteBrandMapping]);\r\n\r\n  // Import handler\r\n  const handleImport = React.useCallback(async (data: Partial<Brand>[], mode: 'insert-only' | 'update-only' | 'upsert', _branchId?: string) => {\r\n    const currentEmployeeSystemId = authEmployee?.systemId ?? asSystemId('SYSTEM');\r\n    \r\n    const results = {\r\n      success: 0,\r\n      failed: 0,\r\n      inserted: 0,\r\n      updated: 0,\r\n      skipped: 0,\r\n      errors: [] as Array<{ row: number; message: string }>,\r\n    };\r\n    \r\n    try {\r\n      for (let i = 0; i < data.length; i++) {\r\n        const item = data[i];\r\n        try {\r\n          // Check if brand exists (by id)\r\n          const existingBrand = activeBrands.find(b => \r\n            item.id && b.id === item.id\r\n          );\r\n          \r\n          if (existingBrand) {\r\n            // Brand exists\r\n            if (mode === 'insert-only') {\r\n              // Skip in insert-only mode\r\n              results.skipped++;\r\n              continue;\r\n            }\r\n            \r\n            // Update existing brand\r\n            const updatedFields: Partial<Brand> = {\r\n              ...item,\r\n              updatedAt: new Date().toISOString(),\r\n            };\r\n            // Remove fields that shouldn't be overwritten\r\n            delete (updatedFields as any).systemId;\r\n            delete (updatedFields as any).createdAt;\r\n            \r\n            update(existingBrand.systemId, updatedFields);\r\n            results.updated++;\r\n            results.success++;\r\n          } else {\r\n            // Brand does not exist\r\n            if (mode === 'update-only') {\r\n              // Skip in update-only mode\r\n              results.skipped++;\r\n              continue;\r\n            }\r\n            \r\n            // Insert new brand\r\n            const newBrand = {\r\n              ...item,\r\n              id: asBusinessId(item.id || `BRAND-${Date.now()}`),\r\n              name: item.name || '',\r\n              isActive: item.isActive !== false,\r\n              isDeleted: false,\r\n              createdAt: new Date().toISOString(),\r\n              updatedAt: new Date().toISOString(),\r\n            } as Omit<Brand, 'systemId'>;\r\n            \r\n            add(newBrand);\r\n            results.inserted++;\r\n            results.success++;\r\n          }\r\n        } catch (err) {\r\n          results.failed++;\r\n          results.errors.push({\r\n            row: i + 1,\r\n            message: err instanceof Error ? err.message : 'Lỗi không xác định',\r\n          });\r\n        }\r\n      }\r\n      \r\n      return results;\r\n    } catch (error) {\r\n      console.error('[Brands Importer] Lỗi nhập thương hiệu', error);\r\n      throw error;\r\n    }\r\n  }, [activeBrands, add, update, authEmployee?.systemId]);\r\n\r\n  // Export config\r\n  const exportConfig = {\r\n    fileName: 'Thuong_hieu',\r\n    columns,\r\n  };\r\n\r\n  // Set default column visibility - only on mount\r\n  React.useEffect(() => {\r\n    // Skip if already has stored visibility (hook handles loading from database/localStorage)\r\n    if (Object.keys(columnVisibility).length > 0 && columnOrder.length > 0) return;\r\n    \r\n    const defaultVisibleColumns = ['logo', 'name', 'id', 'productCount', 'website', 'seoPkgx', 'seoTrendtech', 'pkgxStatus', 'pkgx', 'isActive', 'createdAt'];\r\n    const columnIds = ['select', 'logo', 'name', 'id', 'productCount', 'website', 'seoPkgx', 'seoTrendtech', 'pkgxStatus', 'pkgx', 'isActive', 'createdAt', 'updatedAt', 'actions'];\r\n    const initialVisibility: Record<string, boolean> = {};\r\n    columnIds.forEach(id => {\r\n      if (id === 'select' || id === 'actions') {\r\n        initialVisibility[id] = true;\r\n      } else {\r\n        initialVisibility[id] = defaultVisibleColumns.includes(id);\r\n      }\r\n    });\r\n    if (Object.keys(columnVisibility).length === 0) {\r\n      setColumnVisibility(initialVisibility);\r\n    }\r\n    if (columnOrder.length === 0) {\r\n      setColumnOrder(columnIds);\r\n    }\r\n  }, [columnVisibility, columnOrder]);\r\n\r\n  const fuse = React.useMemo(() => new Fuse(activeBrands, {\r\n    keys: [\"id\", \"name\", \"description\", \"website\"],\r\n    threshold: 0.3,\r\n    ignoreLocation: true\r\n  }), [activeBrands]);\r\n\r\n  const confirmDelete = () => {\r\n    if (idToDelete) {\r\n      remove(asSystemId(idToDelete));\r\n      toast.success(\"Đã xóa thương hiệu\");\r\n    }\r\n    setIsAlertOpen(false);\r\n    setIdToDelete(null);\r\n  };\r\n\r\n  const confirmBulkDelete = () => {\r\n    const idsToDelete = Object.keys(rowSelection);\r\n    idsToDelete.forEach(id => remove(asSystemId(id)));\r\n    toast.success(`Đã xóa ${idsToDelete.length} thương hiệu`);\r\n    setRowSelection({});\r\n    setIsBulkDeleteAlertOpen(false);\r\n  };\r\n\r\n  // Filter options\r\n  const statusOptions = React.useMemo(() => [\r\n    { value: 'active', label: 'Hoạt động' },\r\n    { value: 'inactive', label: 'Tạm tắt' }\r\n  ], []);\r\n\r\n  // Apply all filters\r\n  const filteredData = React.useMemo(() => {\r\n    let result = activeBrands;\r\n\r\n    // Status filter\r\n    if (statusFilter.size > 0) {\r\n      result = result.filter(b => {\r\n        const status = b.isActive !== false ? 'active' : 'inactive';\r\n        return statusFilter.has(status);\r\n      });\r\n    }\r\n\r\n    // Text search (debounced)\r\n    if (debouncedGlobalFilter) {\r\n      const searchResults = fuse.search(debouncedGlobalFilter);\r\n      const searchIds = new Set(searchResults.map(r => r.item.systemId));\r\n      result = result.filter(b => searchIds.has(b.systemId));\r\n    }\r\n\r\n    return result;\r\n  }, [activeBrands, statusFilter, debouncedGlobalFilter, fuse]);\r\n\r\n  const sortedData = React.useMemo(() => {\r\n    const sorted = [...filteredData];\r\n    if (sorting.id) {\r\n      sorted.sort((a, b) => {\r\n        const aValue = (a as any)[sorting.id];\r\n        const bValue = (b as any)[sorting.id];\r\n        if (sorting.id === 'createdAt') {\r\n          const aTime = aValue ? new Date(aValue).getTime() : 0;\r\n          const bTime = bValue ? new Date(bValue).getTime() : 0;\r\n          return sorting.desc ? bTime - aTime : aTime - bTime;\r\n        }\r\n        if (aValue < bValue) return sorting.desc ? 1 : -1;\r\n        if (aValue > bValue) return sorting.desc ? -1 : 1;\r\n        return 0;\r\n      });\r\n    }\r\n    return sorted;\r\n  }, [filteredData, sorting]);\r\n\r\n  const allSelectedRows = React.useMemo(() =>\r\n    activeBrands.filter(b => rowSelection[b.systemId]),\r\n    [activeBrands, rowSelection]);\r\n\r\n  // Mobile infinite scroll\r\n  React.useEffect(() => {\r\n    if (!isMobile) return;\r\n\r\n    const handleScroll = () => {\r\n      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;\r\n      const scrollHeight = document.documentElement.scrollHeight;\r\n      const clientHeight = window.innerHeight;\r\n      const scrollPercentage = (scrollTop + clientHeight) / scrollHeight;\r\n\r\n      if (scrollPercentage > 0.8 && mobileLoadedCount < sortedData.length) {\r\n        setMobileLoadedCount(prev => Math.min(prev + 20, sortedData.length));\r\n      }\r\n    };\r\n\r\n    window.addEventListener('scroll', handleScroll);\r\n    return () => window.removeEventListener('scroll', handleScroll);\r\n  }, [isMobile, mobileLoadedCount, sortedData.length]);\r\n\r\n  // Reset mobile loaded count when filters change\r\n  React.useEffect(() => {\r\n    setMobileLoadedCount(20);\r\n  }, [debouncedGlobalFilter, statusFilter]);\r\n\r\n  const pageCount = Math.ceil(sortedData.length / pagination.pageSize);\r\n  const paginatedData = React.useMemo(() => sortedData.slice(pagination.pageIndex * pagination.pageSize, (pagination.pageIndex + 1) * pagination.pageSize), [sortedData, pagination]);\r\n\r\n  // Header actions\r\n  const headerActions = React.useMemo(() => [\r\n    <Button key=\"add\" size=\"sm\" className=\"h-9\" onClick={() => router.push('/brands/new')}>\r\n      <Plus className=\"mr-2 h-4 w-4\" />\r\n      Thêm thương hiệu\r\n    </Button>\r\n  ], [router]);\r\n\r\n  // Dùng auto-generated title từ PATH_PATTERNS\r\n  usePageHeader({\r\n    actions: headerActions,\r\n    showBackButton: false,\r\n  });\r\n\r\n  return (\r\n    <div className=\"space-y-4 h-full flex flex-col\">\r\n      {/* Desktop-only Toolbar */}\r\n      {!isMobile && (\r\n        <PageToolbar\r\n          leftActions={\r\n            <>\r\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setIsImportOpen(true)}>\r\n                <FileUp className=\"mr-2 h-4 w-4\" />\r\n                Nhập file\r\n              </Button>\r\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setIsExportOpen(true)}>\r\n                <Download className=\"mr-2 h-4 w-4\" />\r\n                Xuất Excel\r\n              </Button>\r\n            </>\r\n          }\r\n          rightActions={[\r\n            <DataTableColumnCustomizer\r\n              key=\"customizer\"\r\n              columns={columns}\r\n              columnVisibility={columnVisibility}\r\n              setColumnVisibility={setColumnVisibility}\r\n              columnOrder={columnOrder}\r\n              setColumnOrder={setColumnOrder}\r\n              pinnedColumns={pinnedColumns}\r\n              setPinnedColumns={setPinnedColumns}\r\n            />\r\n          ]}\r\n        />\r\n      )}\r\n\r\n      {/* Filters Row */}\r\n      <PageFilters\r\n        searchValue={globalFilter}\r\n        onSearchChange={setGlobalFilter}\r\n        searchPlaceholder=\"Tìm theo mã, tên thương hiệu...\"\r\n        rightFilters={\r\n          <DataTableFacetedFilter\r\n            title=\"Trạng thái\"\r\n            options={statusOptions}\r\n            selectedValues={statusFilter}\r\n            onSelectedValuesChange={setStatusFilter}\r\n          />\r\n        }\r\n      />\r\n\r\n      {/* Mobile View - Cards */}\r\n      {isMobile ? (\r\n        <div className=\"space-y-2 flex-1 overflow-y-auto\">\r\n          {sortedData.length === 0 ? (\r\n            <Card>\r\n              <CardContent className=\"p-8 text-center text-muted-foreground\">\r\n                Không tìm thấy thương hiệu nào\r\n              </CardContent>\r\n            </Card>\r\n          ) : (\r\n            <>\r\n              {sortedData.slice(0, mobileLoadedCount).map(brand => (\r\n                <MobileBrandCard\r\n                  key={brand.systemId}\r\n                  brand={brand}\r\n                  onDelete={handleDelete}\r\n                  onToggleActive={handleToggleActive}\r\n                  navigate={(path) => router.push(path)}\r\n                  handleRowClick={handleRowClick}\r\n                />\r\n              ))}\r\n              {mobileLoadedCount < sortedData.length && (\r\n                <Card>\r\n                  <CardContent className=\"p-4 text-center text-muted-foreground\">\r\n                    <div className=\"flex items-center justify-center gap-2\">\r\n                      <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-primary\"></div>\r\n                      <span>Đang tải thêm...</span>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              )}\r\n              {mobileLoadedCount >= sortedData.length && sortedData.length > 20 && (\r\n                <Card>\r\n                  <CardContent className=\"p-4 text-center text-muted-foreground text-sm\">\r\n                    Đã hiển thị tất cả {sortedData.length} thương hiệu\r\n                  </CardContent>\r\n                </Card>\r\n              )}\r\n            </>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        /* Desktop View - Table */\r\n        <div className=\"w-full py-4\">\r\n          <ResponsiveDataTable\r\n            columns={columns}\r\n            data={paginatedData}\r\n            pageCount={pageCount}\r\n            pagination={pagination}\r\n            setPagination={setPagination}\r\n            rowCount={sortedData.length}\r\n            rowSelection={rowSelection}\r\n            setRowSelection={setRowSelection}\r\n            onBulkDelete={() => setIsBulkDeleteAlertOpen(true)}\r\n            sorting={sorting}\r\n            setSorting={setSorting as React.Dispatch<React.SetStateAction<{ id: string; desc: boolean; }>>}\r\n            allSelectedRows={allSelectedRows}\r\n            bulkActions={bulkActions}\r\n            pkgxBulkActions={pkgxBulkActions}\r\n            expanded={{}}\r\n            setExpanded={() => {}}\r\n            columnVisibility={columnVisibility}\r\n            setColumnVisibility={setColumnVisibility}\r\n            columnOrder={columnOrder}\r\n            setColumnOrder={setColumnOrder}\r\n            pinnedColumns={pinnedColumns}\r\n            setPinnedColumns={setPinnedColumns}\r\n            onRowClick={handleRowClick}\r\n            renderMobileCard={(brand) => (\r\n              <MobileBrandCard\r\n                brand={brand}\r\n                onDelete={handleDelete}\r\n                onToggleActive={handleToggleActive}\r\n                navigate={(path) => router.push(path)}\r\n                handleRowClick={handleRowClick}\r\n              />\r\n            )}\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      {/* Delete Alert Dialog */}\r\n      <AlertDialog open={isAlertOpen} onOpenChange={setIsAlertOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Xóa thương hiệu?</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              Thương hiệu sẽ bị xóa khỏi hệ thống. Hành động này không thể hoàn tác.\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>Đóng</AlertDialogCancel>\r\n            <AlertDialogAction onClick={confirmDelete}>Xóa</AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Bulk Delete Alert Dialog */}\r\n      <AlertDialog open={isBulkDeleteAlertOpen} onOpenChange={setIsBulkDeleteAlertOpen}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>Xóa {Object.keys(rowSelection).length} thương hiệu?</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              Các thương hiệu sẽ bị xóa khỏi hệ thống. Hành động này không thể hoàn tác.\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel>Đóng</AlertDialogCancel>\r\n            <AlertDialogAction onClick={confirmBulkDelete}>Xóa tất cả</AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* PKGX Link Dialog */}\r\n      <PkgxBrandLinkDialog\r\n        open={pkgxLinkDialogOpen}\r\n        onOpenChange={setPkgxLinkDialogOpen}\r\n        brand={brandToLink}\r\n        onSuccess={handlePkgxLinkSuccess}\r\n      />\r\n      \r\n      {/* PKGX Detail Dialog */}\r\n      <PkgxBrandDetailDialog\r\n        open={pkgxDetailDialogOpen}\r\n        onOpenChange={setPkgxDetailDialogOpen}\r\n        brand={brandToViewDetail}\r\n        pkgxBrandId={pkgxBrandIdToView}\r\n      />\r\n\r\n      {/* PKGX Bulk Sync Confirm Dialog */}\r\n      <PkgxBulkSyncConfirmDialog\r\n        confirmAction={bulkConfirmAction}\r\n        progress={bulkProgress}\r\n        onConfirm={executeBulkAction}\r\n        onCancel={cancelBulkConfirm}\r\n      />\r\n\r\n      {/* Import Dialog V2 */}\r\n      <GenericImportDialogV2<Brand>\r\n        open={isImportOpen}\r\n        onOpenChange={setIsImportOpen}\r\n        config={brandImportExportConfig}\r\n        existingData={activeBrands}\r\n        onImport={handleImport}\r\n        currentUser={authEmployee ? {\r\n          systemId: authEmployee.systemId,\r\n          name: authEmployee.fullName || authEmployee.id,\r\n        } : undefined}\r\n      />\r\n\r\n      {/* Export Dialog V2 */}\r\n      <GenericExportDialogV2<Brand>\r\n        open={isExportOpen}\r\n        onOpenChange={setIsExportOpen}\r\n        config={brandImportExportConfig}\r\n        allData={activeBrands}\r\n        filteredData={sortedData}\r\n        currentPageData={paginatedData}\r\n        selectedData={allSelectedRows}\r\n        currentUser={authEmployee ? {\r\n          systemId: authEmployee.systemId,\r\n          name: authEmployee.fullName || authEmployee.id,\r\n        } : { systemId: asSystemId('SYSTEM'), name: 'System' }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}