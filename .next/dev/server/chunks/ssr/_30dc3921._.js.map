{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/hooks/use-workflow-templates.ts"],"sourcesContent":["import { useState, useEffect, useCallback, useRef } from 'react'\r\nimport type { Subtask } from '@/components/shared/subtask-list'\r\nimport { nanoid } from 'nanoid'\r\n\r\nexport interface WorkflowTemplate {\r\n  systemId: string\r\n  id: string\r\n  name: string // 'complaints', 'warranty' - workflow type\r\n  label: string // Display name\r\n  description: string\r\n  subtasks: Subtask[]\r\n  isDefault: boolean\r\n  createdAt: Date\r\n  updatedAt: Date\r\n}\r\n\r\n// Default templates for initial setup\r\nfunction getDefaultTemplates(): WorkflowTemplate[] {\r\n  const now = new Date()\r\n  return [\r\n    {\r\n      systemId: nanoid(),\r\n      id: nanoid(),\r\n      name: 'complaints',\r\n      label: 'Quy trình Khiếu nại tiêu chuẩn',\r\n      description: 'Các bước xử lý khiếu nại từ khách hàng',\r\n      isDefault: true,\r\n      createdAt: now,\r\n      updatedAt: now,\r\n      subtasks: [\r\n        { id: nanoid(), title: 'Tiếp nhận và ghi nhận', completed: false, order: 0, createdAt: now },\r\n        { id: nanoid(), title: 'Phân loại và đánh giá', completed: false, order: 1, createdAt: now },\r\n        { id: nanoid(), title: 'Xác minh thông tin', completed: false, order: 2, createdAt: now },\r\n        { id: nanoid(), title: 'Đề xuất giải pháp', completed: false, order: 3, createdAt: now },\r\n        { id: nanoid(), title: 'Thực hiện xử lý', completed: false, order: 4, createdAt: now },\r\n        { id: nanoid(), title: 'Phản hồi khách hàng', completed: false, order: 5, createdAt: now },\r\n        { id: nanoid(), title: 'Đánh giá kết quả', completed: false, order: 6, createdAt: now },\r\n      ],\r\n    },\r\n    {\r\n      systemId: nanoid(),\r\n      id: nanoid(),\r\n      name: 'warranty',\r\n      label: 'Quy trình Bảo hành tiêu chuẩn',\r\n      description: 'Các bước xử lý bảo hành sản phẩm',\r\n      isDefault: true,\r\n      createdAt: now,\r\n      updatedAt: now,\r\n      subtasks: [\r\n        { id: nanoid(), title: 'Tiếp nhận yêu cầu', completed: false, order: 0, createdAt: now },\r\n        { id: nanoid(), title: 'Kiểm tra điều kiện BH', completed: false, order: 1, createdAt: now },\r\n        { id: nanoid(), title: 'Kiểm tra lỗi sản phẩm', completed: false, order: 2, createdAt: now },\r\n        { id: nanoid(), title: 'Báo giá sửa chữa', completed: false, order: 3, createdAt: now },\r\n        { id: nanoid(), title: 'Thực hiện sửa chữa', completed: false, order: 4, createdAt: now },\r\n        { id: nanoid(), title: 'Kiểm tra chất lượng', completed: false, order: 5, createdAt: now },\r\n        { id: nanoid(), title: 'Trả hàng khách', completed: false, order: 6, createdAt: now },\r\n      ],\r\n    },\r\n    {\r\n      systemId: nanoid(),\r\n      id: nanoid(),\r\n      name: 'orders',\r\n      label: 'Quy trình Đơn hàng tiêu chuẩn',\r\n      description: 'Các bước xử lý đơn hàng',\r\n      isDefault: true,\r\n      createdAt: now,\r\n      updatedAt: now,\r\n      subtasks: [\r\n        { id: nanoid(), title: 'Xác nhận đơn hàng', completed: false, order: 0, createdAt: now },\r\n        { id: nanoid(), title: 'Kiểm tra tồn kho', completed: false, order: 1, createdAt: now },\r\n        { id: nanoid(), title: 'Chuẩn bị hàng hóa', completed: false, order: 2, createdAt: now },\r\n        { id: nanoid(), title: 'Đóng gói', completed: false, order: 3, createdAt: now },\r\n        { id: nanoid(), title: 'Giao hàng', completed: false, order: 4, createdAt: now },\r\n        { id: nanoid(), title: 'Thu tiền', completed: false, order: 5, createdAt: now },\r\n        { id: nanoid(), title: 'Hoàn tất', completed: false, order: 6, createdAt: now },\r\n      ],\r\n    },\r\n    {\r\n      systemId: nanoid(),\r\n      id: nanoid(),\r\n      name: 'sales-returns',\r\n      label: 'Quy trình Đổi trả hàng',\r\n      description: 'Các bước xử lý đổi trả hàng bán',\r\n      isDefault: true,\r\n      createdAt: now,\r\n      updatedAt: now,\r\n      subtasks: [\r\n        { id: nanoid(), title: 'Tiếp nhận yêu cầu', completed: false, order: 0, createdAt: now },\r\n        { id: nanoid(), title: 'Kiểm tra điều kiện', completed: false, order: 1, createdAt: now },\r\n        { id: nanoid(), title: 'Kiểm tra sản phẩm', completed: false, order: 2, createdAt: now },\r\n        { id: nanoid(), title: 'Xử lý hoàn tiền/đổi hàng', completed: false, order: 3, createdAt: now },\r\n        { id: nanoid(), title: 'Cập nhật kho', completed: false, order: 4, createdAt: now },\r\n        { id: nanoid(), title: 'Hoàn tất', completed: false, order: 5, createdAt: now },\r\n      ],\r\n    },\r\n    {\r\n      systemId: nanoid(),\r\n      id: nanoid(),\r\n      name: 'purchase-returns',\r\n      label: 'Quy trình Trả hàng NCC',\r\n      description: 'Các bước trả hàng cho nhà cung cấp',\r\n      isDefault: true,\r\n      createdAt: now,\r\n      updatedAt: now,\r\n      subtasks: [\r\n        { id: nanoid(), title: 'Phát hiện sản phẩm lỗi/hỏng', completed: false, order: 0, createdAt: now },\r\n        { id: nanoid(), title: 'Tạo phiếu trả hàng', completed: false, order: 1, createdAt: now },\r\n        { id: nanoid(), title: 'Liên hệ NCC', completed: false, order: 2, createdAt: now },\r\n        { id: nanoid(), title: 'Đóng gói trả hàng', completed: false, order: 3, createdAt: now },\r\n        { id: nanoid(), title: 'Gửi hàng trả', completed: false, order: 4, createdAt: now },\r\n        { id: nanoid(), title: 'Nhận hoàn tiền/đổi hàng', completed: false, order: 5, createdAt: now },\r\n        { id: nanoid(), title: 'Cập nhật kho', completed: false, order: 6, createdAt: now },\r\n      ],\r\n    },\r\n    {\r\n      systemId: nanoid(),\r\n      id: nanoid(),\r\n      name: 'stock-transfers',\r\n      label: 'Quy trình Chuyển kho',\r\n      description: 'Các bước chuyển hàng giữa các kho',\r\n      isDefault: true,\r\n      createdAt: now,\r\n      updatedAt: now,\r\n      subtasks: [\r\n        { id: nanoid(), title: 'Tạo phiếu chuyển kho', completed: false, order: 0, createdAt: now },\r\n        { id: nanoid(), title: 'Kiểm tra tồn kho xuất', completed: false, order: 1, createdAt: now },\r\n        { id: nanoid(), title: 'Lấy hàng và kiểm đếm', completed: false, order: 2, createdAt: now },\r\n        { id: nanoid(), title: 'Đóng gói và ghi chú vận chuyển', completed: false, order: 3, createdAt: now },\r\n        { id: nanoid(), title: 'Xuất kho nguồn', completed: false, order: 4, createdAt: now },\r\n        { id: nanoid(), title: 'Vận chuyển đến kho đích', completed: false, order: 5, createdAt: now },\r\n        { id: nanoid(), title: 'Nhận hàng và kiểm đếm tại kho đích', completed: false, order: 6, createdAt: now },\r\n        { id: nanoid(), title: 'Nhập kho đích và hoàn tất', completed: false, order: 7, createdAt: now },\r\n      ],\r\n    },\r\n    {\r\n      systemId: nanoid(),\r\n      id: nanoid(),\r\n      name: 'inventory-checks',\r\n      label: 'Quy trình Kiểm kho',\r\n      description: 'Các bước thực hiện kiểm kê hàng tồn kho',\r\n      isDefault: true,\r\n      createdAt: now,\r\n      updatedAt: now,\r\n      subtasks: [\r\n        { id: nanoid(), title: 'Lên kế hoạch kiểm kho (thời gian, phạm vi)', completed: false, order: 0, createdAt: now },\r\n        { id: nanoid(), title: 'In danh sách hàng hóa cần kiểm', completed: false, order: 1, createdAt: now },\r\n        { id: nanoid(), title: 'Phân công nhân sự kiểm kê', completed: false, order: 2, createdAt: now },\r\n        { id: nanoid(), title: 'Thực hiện kiểm đếm thực tế', completed: false, order: 3, createdAt: now },\r\n        { id: nanoid(), title: 'Ghi nhận số lượng thực tế', completed: false, order: 4, createdAt: now },\r\n        { id: nanoid(), title: 'Đối chiếu với số liệu hệ thống', completed: false, order: 5, createdAt: now },\r\n        { id: nanoid(), title: 'Xác định và giải trình chênh lệch', completed: false, order: 6, createdAt: now },\r\n        { id: nanoid(), title: 'Duyệt và cập nhật tồn kho', completed: false, order: 7, createdAt: now },\r\n      ],\r\n    },\r\n  ]\r\n}\r\n\r\n// Parse templates from API response\r\nfunction parseTemplates(data: any[]): WorkflowTemplate[] {\r\n  return data.map((t: any) => ({\r\n    ...t,\r\n    systemId: t.systemId || t.id,\r\n    createdAt: new Date(t.createdAt),\r\n    updatedAt: new Date(t.updatedAt),\r\n    subtasks: t.subtasks.map((s: any) => ({\r\n      ...s,\r\n      createdAt: new Date(s.createdAt),\r\n      completedAt: s.completedAt ? new Date(s.completedAt) : undefined,\r\n    })),\r\n  }))\r\n}\r\n\r\n// In-memory cache for templates (shared across components)\r\nlet templatesCache: WorkflowTemplate[] | null = null\r\nlet cachePromise: Promise<WorkflowTemplate[]> | null = null\r\n\r\n/**\r\n * Get workflow templates from database\r\n * This function can be called outside of React components\r\n */\r\nexport async function fetchWorkflowTemplates(): Promise<WorkflowTemplate[]> {\r\n  // Return cached if available\r\n  if (templatesCache) {\r\n    return templatesCache\r\n  }\r\n\r\n  // Prevent multiple simultaneous fetches\r\n  if (cachePromise) {\r\n    return cachePromise\r\n  }\r\n\r\n  cachePromise = (async () => {\r\n    try {\r\n      const res = await fetch('/api/workflow-templates')\r\n      if (res.ok) {\r\n        const json = await res.json()\r\n        if (json.data && json.data.length > 0) {\r\n          templatesCache = parseTemplates(json.data)\r\n          return templatesCache\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Failed to fetch workflow templates from API:', error)\r\n    }\r\n\r\n    // Return default templates if API fails\r\n    templatesCache = getDefaultTemplates()\r\n    return templatesCache\r\n  })()\r\n\r\n  const result = await cachePromise\r\n  cachePromise = null\r\n  return result\r\n}\r\n\r\n/**\r\n * Get workflow template subtasks for a specific workflow type\r\n * Returns fresh copies with new IDs and reset completed status\r\n */\r\nexport async function getWorkflowTemplateSubtasks(workflowName: string): Promise<Subtask[]> {\r\n  const templates = await fetchWorkflowTemplates()\r\n  \r\n  // Find default template for this workflow\r\n  const template = templates.find(t => t.name === workflowName && t.isDefault)\r\n  \r\n  if (!template) {\r\n    // Fallback: get first template for this workflow\r\n    const fallback = templates.find(t => t.name === workflowName)\r\n    if (!fallback) return []\r\n    \r\n    return fallback.subtasks.map(s => ({\r\n      ...s,\r\n      id: nanoid(),\r\n      completed: false,\r\n      completedAt: undefined,\r\n    }))\r\n  }\r\n  \r\n  // Deep clone and reset completed status\r\n  return template.subtasks.map(s => ({\r\n    ...s,\r\n    id: nanoid(),\r\n    completed: false,\r\n    completedAt: undefined,\r\n  }))\r\n}\r\n\r\n/**\r\n * Get all workflow templates for a specific workflow type\r\n */\r\nexport async function getWorkflowTemplatesByType(workflowName: string): Promise<WorkflowTemplate[]> {\r\n  const templates = await fetchWorkflowTemplates()\r\n  return templates.filter(t => t.name === workflowName)\r\n}\r\n\r\n/**\r\n * Clear templates cache (call after saving templates)\r\n */\r\nexport function clearWorkflowTemplatesCache() {\r\n  templatesCache = null\r\n  cachePromise = null\r\n}\r\n\r\n/**\r\n * Hook to use workflow templates in React components\r\n */\r\nexport function useWorkflowTemplates() {\r\n  const [templates, setTemplates] = useState<WorkflowTemplate[]>([])\r\n  const [isLoading, setIsLoading] = useState(true)\r\n  const [error, setError] = useState<string | null>(null)\r\n  const isSavingRef = useRef(false)\r\n\r\n  // Load templates on mount\r\n  useEffect(() => {\r\n    let mounted = true\r\n\r\n    const load = async () => {\r\n      try {\r\n        const data = await fetchWorkflowTemplates()\r\n        if (mounted) {\r\n          setTemplates(data)\r\n          setError(null)\r\n        }\r\n      } catch (err) {\r\n        if (mounted) {\r\n          setError('Failed to load templates')\r\n          // Use default templates on error\r\n          setTemplates(getDefaultTemplates())\r\n        }\r\n      } finally {\r\n        if (mounted) {\r\n          setIsLoading(false)\r\n        }\r\n      }\r\n    }\r\n\r\n    load()\r\n\r\n    return () => {\r\n      mounted = false\r\n    }\r\n  }, [])\r\n\r\n  // Save templates to database\r\n  const saveTemplates = useCallback(async (newTemplates: WorkflowTemplate[]) => {\r\n    if (isSavingRef.current) return\r\n\r\n    isSavingRef.current = true\r\n    setTemplates(newTemplates)\r\n\r\n    try {\r\n      const res = await fetch('/api/workflow-templates', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ templates: newTemplates }),\r\n      })\r\n\r\n      if (!res.ok) {\r\n        throw new Error('Failed to save templates')\r\n      }\r\n\r\n      // Clear cache so next fetch gets fresh data\r\n      clearWorkflowTemplatesCache()\r\n      templatesCache = newTemplates\r\n\r\n      setError(null)\r\n    } catch (err) {\r\n      console.error('Error saving templates:', err)\r\n      setError('Failed to save templates')\r\n    } finally {\r\n      isSavingRef.current = false\r\n    }\r\n  }, [])\r\n\r\n  return {\r\n    templates,\r\n    setTemplates: saveTemplates,\r\n    isLoading,\r\n    error,\r\n  }\r\n}\r\n\r\n/**\r\n * Synchronous getter for workflow templates (uses cache)\r\n * Returns empty array if not yet loaded - use async version for guaranteed data\r\n */\r\nexport function getWorkflowTemplatesSync(): WorkflowTemplate[] {\r\n  if (templatesCache) {\r\n    return templatesCache\r\n  }\r\n  \r\n  // Return default templates if cache not loaded\r\n  \r\n  return getDefaultTemplates()\r\n}\r\n\r\n/**\r\n * Synchronous getter for single workflow template subtasks (uses cache)\r\n */\r\nexport function getWorkflowTemplateSync(workflowName: string): Subtask[] {\r\n  const templates = getWorkflowTemplatesSync()\r\n  const template = templates.find(t => t.name === workflowName && t.isDefault)\r\n  \r\n  if (!template) {\r\n    const fallback = templates.find(t => t.name === workflowName)\r\n    if (!fallback) return []\r\n    \r\n    return fallback.subtasks.map(s => ({\r\n      ...s,\r\n      id: nanoid(),\r\n      completed: false,\r\n      completedAt: undefined,\r\n    }))\r\n  }\r\n  \r\n  return template.subtasks.map(s => ({\r\n    ...s,\r\n    id: nanoid(),\r\n    completed: false,\r\n    completedAt: undefined,\r\n  }))\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 650, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/hooks/use-debounce.ts"],"sourcesContent":["import * as React from 'react';\r\n\r\nexport function useDebounce<T>(value: T, delay: number): T {\r\n  const [debouncedValue, setDebouncedValue] = React.useState<T>(value);\r\n\r\n  React.useEffect(() => {\r\n    const handler = setTimeout(() => {\r\n      setDebouncedValue(value);\r\n    }, delay);\r\n\r\n    return () => {\r\n      clearTimeout(handler);\r\n    };\r\n  }, [value, delay]);\r\n\r\n  return debouncedValue;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,SAAS,YAAe,KAAQ,EAAE,KAAa;IACpD,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,iNAAc,CAAI;IAE9D,kNAAe,CAAC;QACd,MAAM,UAAU,WAAW;YACzB,kBAAkB;QACpB,GAAG;QAEH,OAAO;YACL,aAAa;QACf;IACF,GAAG;QAAC;QAAO;KAAM;IAEjB,OAAO;AACT"}},
    {"offset": {"line": 675, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/repositories/in-memory-repository.ts"],"sourcesContent":["import type { SystemId } from '../lib/id-types';\r\nimport type { CrudState, ItemWithSystemId } from '../lib/store-factory';\r\nimport type { CrudRepository } from './types';\r\n\r\n/**\r\n * Adapter mặc định dùng trực tiếp Zustand store để giả lập tầng persistence.\r\n * Giữ cùng signature với repository interface để sau này thay bằng API/DB dễ dàng.\r\n */\r\nexport const createInMemoryRepository = <TEntity extends ItemWithSystemId>(\r\n  stateGetter: () => CrudState<TEntity>\r\n): CrudRepository<TEntity, Omit<TEntity, 'systemId'>, Partial<TEntity>> => {\r\n  const getStore = () => stateGetter();\r\n\r\n  const ensureEntity = (systemId: SystemId): TEntity => {\r\n    const entity = getStore().findById(systemId);\r\n    if (!entity) {\r\n      throw new Error(`Không tìm thấy entity với systemId=${systemId}`);\r\n    }\r\n    return entity;\r\n  };\r\n\r\n  return {\r\n    async list() {\r\n      return [...getStore().data];\r\n    },\r\n    async getById(systemId) {\r\n      return getStore().findById(systemId);\r\n    },\r\n    async create(payload) {\r\n      return getStore().add(payload as Omit<TEntity, 'systemId'>);\r\n    },\r\n    async update(systemId, payload) {\r\n      ensureEntity(systemId);\r\n      getStore().update(systemId, payload);\r\n      return ensureEntity(systemId);\r\n    },\r\n    async softDelete(systemId) {\r\n      ensureEntity(systemId);\r\n      getStore().remove(systemId);\r\n    },\r\n    async restore(systemId) {\r\n      ensureEntity(systemId);\r\n      getStore().restore(systemId);\r\n      return getStore().findById(systemId);\r\n    },\r\n    async hardDelete(systemId) {\r\n      ensureEntity(systemId);\r\n      getStore().hardDelete(systemId);\r\n    },\r\n  };\r\n};\r\n"],"names":[],"mappings":";;;;AAQO,MAAM,2BAA2B,CACtC;IAEA,MAAM,WAAW,IAAM;IAEvB,MAAM,eAAe,CAAC;QACpB,MAAM,SAAS,WAAW,QAAQ,CAAC;QACnC,IAAI,CAAC,QAAQ;YACX,MAAM,IAAI,MAAM,CAAC,mCAAmC,EAAE,UAAU;QAClE;QACA,OAAO;IACT;IAEA,OAAO;QACL,MAAM;YACJ,OAAO;mBAAI,WAAW,IAAI;aAAC;QAC7B;QACA,MAAM,SAAQ,QAAQ;YACpB,OAAO,WAAW,QAAQ,CAAC;QAC7B;QACA,MAAM,QAAO,OAAO;YAClB,OAAO,WAAW,GAAG,CAAC;QACxB;QACA,MAAM,QAAO,QAAQ,EAAE,OAAO;YAC5B,aAAa;YACb,WAAW,MAAM,CAAC,UAAU;YAC5B,OAAO,aAAa;QACtB;QACA,MAAM,YAAW,QAAQ;YACvB,aAAa;YACb,WAAW,MAAM,CAAC;QACpB;QACA,MAAM,SAAQ,QAAQ;YACpB,aAAa;YACb,WAAW,OAAO,CAAC;YACnB,OAAO,WAAW,QAAQ,CAAC;QAC7B;QACA,MAAM,YAAW,QAAQ;YACvB,aAAa;YACb,WAAW,UAAU,CAAC;QACxB;IACF;AACF"}},
    {"offset": {"line": 724, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/app/%28authenticated%29/warranty/page.tsx"],"sourcesContent":["\"use client\"\r\nimport { WarrantyListPage } from '@/features/warranty/warranty-list-page'\r\nexport default WarrantyListPage\r\n"],"names":[],"mappings":";;;;AACA;AADA;;uCAEe,qKAAgB"}}]
}