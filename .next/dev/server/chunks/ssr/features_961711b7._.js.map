{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/employees/store.ts"],"sourcesContent":["import { createCrudStore, CrudState } from '../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { Employee } from './types';\r\nimport type { HistoryEntry } from '../../components/ActivityHistory';\r\nimport Fuse from 'fuse.js';\r\nimport { getCurrentUserSystemId } from '../../contexts/auth-context';\r\nimport { registerBreadcrumbStore } from '../../lib/breadcrumb-generator'; // ✅ NEW\r\nimport { type SystemId } from '../../lib/id-types';\r\nimport { createInMemoryRepository } from '../../repositories/in-memory-repository';\r\nimport { \r\n  createHistoryEntry, \r\n  getCurrentUserInfo,\r\n  appendHistoryEntry \r\n} from '../../lib/activity-history-helper';\r\n\r\ntype EmployeePersistenceAdapter = {\r\n  create: (payload: Omit<Employee, 'systemId'>) => Promise<Employee>;\r\n  update: (systemId: SystemId, payload: Partial<Employee>) => Promise<Employee>;\r\n  softDelete: (systemId: SystemId) => Promise<void>;\r\n  restore: (systemId: SystemId) => Promise<Employee | undefined>;\r\n  hardDelete: (systemId: SystemId) => Promise<void>;\r\n};\r\n\r\nconst baseStore = createCrudStore<Employee>([], 'employees', {\r\n  businessIdField: 'id',\r\n  getCurrentUser: getCurrentUserSystemId, // ✅ Track who creates/updates\r\n  apiEndpoint: '/api/employees',\r\n});\r\n\r\n// ✅ Wrap add method to include activity history\r\nconst originalAdd = baseStore.getState().add;\r\nconst wrappedAdd = (item: Omit<Employee, 'systemId'>): Employee => {\r\n  const userInfo = getCurrentUserInfo();\r\n  const historyEntry = createHistoryEntry(\r\n    'created',\r\n    `${userInfo.name} đã tạo hồ sơ nhân viên ${item.fullName} (${item.id})`,\r\n    userInfo\r\n  );\r\n  \r\n  const newEmployee = originalAdd({\r\n    ...item,\r\n    activityHistory: [historyEntry],\r\n  });\r\n  \r\n  return newEmployee;\r\n};\r\n\r\n// ✅ Wrap update method to include activity history\r\nconst originalUpdate = baseStore.getState().update;\r\nconst wrappedUpdate = (systemId: SystemId, updates: Partial<Employee>): void => {\r\n  const currentEmployee = baseStore.getState().data.find(e => e.systemId === systemId);\r\n  if (!currentEmployee) return;\r\n  \r\n  const userInfo = getCurrentUserInfo();\r\n  const historyEntries: HistoryEntry[] = [];\r\n  \r\n  // Track important field changes\r\n  const trackedFields: { key: keyof Employee; label: string }[] = [\r\n    { key: 'fullName', label: 'họ tên' },\r\n    { key: 'jobTitle', label: 'chức danh' },\r\n    { key: 'department', label: 'phòng ban' },\r\n    { key: 'employmentStatus', label: 'trạng thái làm việc' },\r\n    { key: 'employeeType', label: 'loại nhân viên' },\r\n    { key: 'baseSalary', label: 'lương cơ bản' },\r\n    { key: 'phone', label: 'số điện thoại' },\r\n    { key: 'workEmail', label: 'email công việc' },\r\n    { key: 'role', label: 'vai trò' },\r\n  ];\r\n  \r\n  trackedFields.forEach(({ key, label }) => {\r\n    if (updates[key] !== undefined && updates[key] !== currentEmployee[key]) {\r\n      const oldValue = currentEmployee[key];\r\n      const newValue = updates[key];\r\n      \r\n      // Format values for display\r\n      let oldDisplay = oldValue;\r\n      let newDisplay = newValue;\r\n      \r\n      if (key === 'baseSalary') {\r\n        oldDisplay = new Intl.NumberFormat('vi-VN').format(oldValue as number) + 'đ';\r\n        newDisplay = new Intl.NumberFormat('vi-VN').format(newValue as number) + 'đ';\r\n      }\r\n      \r\n      historyEntries.push(createHistoryEntry(\r\n        'updated',\r\n        `${userInfo.name} đã cập nhật ${label}: \"${oldDisplay || '(trống)'}\" → \"${newDisplay}\"`,\r\n        userInfo,\r\n        { field: key, oldValue, newValue }\r\n      ));\r\n    }\r\n  });\r\n  \r\n  // If status changed specifically\r\n  if (updates.employmentStatus && updates.employmentStatus !== currentEmployee.employmentStatus) {\r\n    historyEntries.push(createHistoryEntry(\r\n      'status_changed',\r\n      `${userInfo.name} đã thay đổi trạng thái làm việc từ \"${currentEmployee.employmentStatus}\" thành \"${updates.employmentStatus}\"`,\r\n      userInfo,\r\n      { field: 'employmentStatus', oldValue: currentEmployee.employmentStatus, newValue: updates.employmentStatus }\r\n    ));\r\n  }\r\n  \r\n  // If no specific changes tracked, add generic update entry\r\n  if (historyEntries.length === 0) {\r\n    historyEntries.push(createHistoryEntry(\r\n      'updated',\r\n      `${userInfo.name} đã cập nhật thông tin nhân viên`,\r\n      userInfo\r\n    ));\r\n  }\r\n  \r\n  const updatedHistory = appendHistoryEntry(currentEmployee.activityHistory, ...historyEntries);\r\n  \r\n  originalUpdate(systemId, {\r\n    ...updates,\r\n    activityHistory: updatedHistory,\r\n  });\r\n};\r\n\r\n// ✅ Override base store methods\r\nbaseStore.setState({\r\n  add: wrappedAdd,\r\n  update: wrappedUpdate,\r\n});\r\n\r\nexport const employeeRepository = createInMemoryRepository<Employee>(() => baseStore.getState());\r\n\r\n// ✅ API-backed persistence adapter - syncs to PostgreSQL\r\nconst API_ENDPOINT = '/api/employees';\r\n\r\nconst persistence: EmployeePersistenceAdapter = {\r\n  create: async (payload) => {\r\n    // First create locally for immediate UI update\r\n    const localResult = await employeeRepository.create(payload);\r\n    \r\n    // Then sync to API (background)\r\n    try {\r\n      const response = await fetch(API_ENDPOINT, {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ ...payload, systemId: localResult.systemId }),\r\n      });\r\n      if (!response.ok) {\r\n        console.warn('[Employee API] Create sync failed, data saved locally');\r\n      } else {\r\n        console.log('[Employee API] Created:', localResult.systemId);\r\n      }\r\n    } catch (e) {\r\n      console.warn('[Employee API] Create sync error:', e);\r\n    }\r\n    \r\n    return localResult;\r\n  },\r\n  update: async (systemId, payload) => {\r\n    // First update locally\r\n    const localResult = await employeeRepository.update(systemId, payload);\r\n    \r\n    // Then sync to API\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}`, {\r\n        method: 'PATCH',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify(payload),\r\n      });\r\n      if (!response.ok) {\r\n        console.warn('[Employee API] Update sync failed');\r\n      } else {\r\n        console.log('[Employee API] Updated:', systemId);\r\n      }\r\n    } catch (e) {\r\n      console.warn('[Employee API] Update sync error:', e);\r\n    }\r\n    \r\n    return localResult;\r\n  },\r\n  softDelete: async (systemId) => {\r\n    // First delete locally\r\n    await employeeRepository.softDelete(systemId);\r\n    \r\n    // Then sync to API\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ hard: false }),\r\n      });\r\n      if (!response.ok) {\r\n        console.warn('[Employee API] Soft delete sync failed');\r\n      } else {\r\n        console.log('[Employee API] Soft deleted:', systemId);\r\n      }\r\n    } catch (e) {\r\n      console.warn('[Employee API] Soft delete sync error:', e);\r\n    }\r\n  },\r\n  restore: async (systemId) => {\r\n    // First restore locally\r\n    const localResult = await employeeRepository.restore(systemId);\r\n    \r\n    // Then sync to API\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}/restore`, {\r\n        method: 'POST',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n      });\r\n      if (!response.ok) {\r\n        console.warn('[Employee API] Restore sync failed');\r\n      } else {\r\n        console.log('[Employee API] Restored:', systemId);\r\n      }\r\n    } catch (e) {\r\n      console.warn('[Employee API] Restore sync error:', e);\r\n    }\r\n    \r\n    return localResult;\r\n  },\r\n  hardDelete: async (systemId) => {\r\n    // First delete locally\r\n    await employeeRepository.hardDelete(systemId);\r\n    \r\n    // Then sync to API\r\n    try {\r\n      const response = await fetch(`${API_ENDPOINT}/${systemId}`, {\r\n        method: 'DELETE',\r\n        credentials: 'include',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ hard: true }),\r\n      });\r\n      if (!response.ok) {\r\n        console.warn('[Employee API] Hard delete sync failed');\r\n      } else {\r\n        console.log('[Employee API] Hard deleted:', systemId);\r\n      }\r\n    } catch (e) {\r\n      console.warn('[Employee API] Hard delete sync error:', e);\r\n    }\r\n  },\r\n};\r\n\r\n// ✅ Register for breadcrumb auto-generation\r\nregisterBreadcrumbStore('employees', () => baseStore.getState());\r\n\r\n// Define enhanced interface\r\ninterface EmployeeStoreState extends CrudState<Employee> {\r\n  searchEmployees: (query: string, page: number, limit?: number) => Promise<{ items: { value: string; label: string }[], hasNextPage: boolean }>;\r\n  permanentDelete: (systemId: SystemId) => Promise<void>;\r\n  persistence: EmployeePersistenceAdapter;\r\n}\r\n\r\ntype EmployeeStoreHook = (() => EmployeeStoreState) & {\r\n  getState: () => EmployeeStoreState;\r\n  persistence: EmployeePersistenceAdapter;\r\n};\r\n\r\n// Augmented methods\r\nconst augmentedMethods = {\r\n    // FIX: Changed `page: number = 1` to `page: number` to make it a required parameter, matching Combobox prop type.\r\n    // ✅ CRITICAL FIX: Create fresh Fuse instance on each search to avoid stale data\r\n    searchEmployees: async (query: string, page: number, limit: number = 20) => {\r\n        return new Promise<{ items: { value: string; label: string }[], hasNextPage: boolean }>(resolve => {\r\n            setTimeout(() => {\r\n                const allEmployees = baseStore.getState().data;\r\n                \r\n                // ✅ Create fresh Fuse instance with current data\r\n                const fuse = new Fuse(allEmployees, {\r\n                    keys: ['fullName', 'id', 'phone', 'personalEmail', 'workEmail'],\r\n                    threshold: 0.3,\r\n                });\r\n                \r\n                const results = query ? fuse.search(query).map(r => r.item) : allEmployees;\r\n                \r\n                const start = (page - 1) * limit;\r\n                const end = start + limit;\r\n                const paginatedItems = results.slice(start, end);\r\n\r\n                resolve({\r\n                    items: paginatedItems.map(e => ({ value: e.systemId, label: e.fullName })),\r\n                    hasNextPage: end < results.length,\r\n                });\r\n            }, 300);\r\n        });\r\n    },\r\n    permanentDelete: async (systemId: SystemId) => {\r\n        await persistence.hardDelete(systemId);\r\n    }\r\n};\r\n\r\nconst useEmployeeStoreHook = (): EmployeeStoreState => {\r\n  const state = baseStore();\r\n  return {\r\n    ...state,\r\n    ...augmentedMethods, // This includes permanentDelete\r\n    persistence,\r\n  };\r\n};\r\n\r\nexport const useEmployeeStore = useEmployeeStoreHook as EmployeeStoreHook;\r\n\r\n// Export getState for non-hook usage\r\nuseEmployeeStore.getState = (): EmployeeStoreState => {\r\n  const state = baseStore.getState();\r\n  return {\r\n    ...state,\r\n    ...augmentedMethods,\r\n    persistence,\r\n  };\r\n};\r\n\r\nuseEmployeeStore.persistence = persistence;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 313, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/departments/store.ts"],"sourcesContent":["import { createCrudStore } from '../../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { Department } from './types';\r\n\r\nexport const useDepartmentStore = createCrudStore<Department>([], 'departments', {\r\n  apiEndpoint: '/api/departments',\r\n});\r\n"],"names":[],"mappings":";;;;AAAA;;AAIO,MAAM,qBAAqB,IAAA,0IAAe,EAAa,EAAE,EAAE,eAAe;IAC/E,aAAa;AACf"}},
    {"offset": {"line": 326, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/attendance/components/daily-status-cell.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport type { DailyRecord, AttendanceStatus } from '../types';\r\nimport { cn } from '../../../lib/utils';\r\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '../../../components/ui/tooltip';\r\n\r\nconst statusStyles: Record<AttendanceStatus, { symbol: string; className: string, description: string; }> = {\r\n  present: { symbol: '✓', className: 'bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300', description: 'Đi làm đủ' },\r\n  absent: { symbol: 'V', className: 'bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-300', description: 'Vắng' },\r\n  leave: { symbol: 'P', className: 'bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-300', description: 'Nghỉ phép' },\r\n  'half-day': { symbol: '½', className: 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300', description: 'Nửa ngày' },\r\n  weekend: { symbol: '', className: '', description: 'Cuối tuần' },\r\n  holiday: { symbol: 'H', className: 'bg-purple-100 text-purple-800 dark:bg-purple-900/50 dark:text-purple-300', description: 'Ngày lễ' },\r\n  future: { symbol: '-', className: 'text-muted-foreground', description: '' },\r\n};\r\n\r\nexport const DailyStatusCell: React.FC<{ record: DailyRecord }> = ({ record }) => {\r\n  if (!record) {\r\n    return <div className=\"text-center text-muted-foreground\">-</div>;\r\n  }\r\n  \r\n  const { status, checkIn, checkOut, overtimeCheckIn, overtimeCheckOut, notes } = record;\r\n  const styleInfo = statusStyles[status] || statusStyles.future;\r\n\r\n  if (status === 'weekend') {\r\n    return null; // The background will be handled by the parent cell.\r\n  }\r\n  \r\n  const hasDetails = checkIn || checkOut || notes || overtimeCheckIn || overtimeCheckOut;\r\n\r\n  const content = (\r\n    <div className={cn(\r\n      \"flex items-center justify-center w-6 h-6 rounded-full font-semibold text-body-xs\",\r\n      styleInfo.className\r\n    )}>\r\n      {styleInfo.symbol}\r\n    </div>\r\n  );\r\n\r\n  if (hasDetails || status !== 'future') {\r\n    const tooltipParts = [\r\n      styleInfo.description,\r\n      checkIn && `Vào: ${checkIn}`,\r\n      checkOut && `Ra: ${checkOut}`,\r\n      overtimeCheckIn && `Tăng ca vào: ${overtimeCheckIn}`,\r\n      overtimeCheckOut && `Tăng ca ra: ${overtimeCheckOut}`,\r\n      notes && `Ghi chú: ${notes}`,\r\n    ].filter(Boolean);\r\n\r\n    return (\r\n      <TooltipProvider delayDuration={100}>\r\n        <Tooltip>\r\n          <TooltipTrigger asChild>\r\n            <div className=\"flex items-center justify-center w-full h-full cursor-default\">{content}</div>\r\n          </TooltipTrigger>\r\n          <TooltipContent>\r\n            <div className=\"space-y-1 p-1\">\r\n              {tooltipParts.map((part, i) => <p key={i}>{part}</p>)}\r\n            </div>\r\n          </TooltipContent>\r\n        </Tooltip>\r\n      </TooltipProvider>\r\n    );\r\n  }\r\n  \r\n  return <div className=\"flex items-center justify-center w-full h-full\">{content}</div>;\r\n};\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;;AAEA,MAAM,eAAsG;IAC1G,SAAS;QAAE,QAAQ;QAAK,WAAW;QAAwE,aAAa;IAAY;IACpI,QAAQ;QAAE,QAAQ;QAAK,WAAW;QAAgE,aAAa;IAAO;IACtH,OAAO;QAAE,QAAQ;QAAK,WAAW;QAAoE,aAAa;IAAY;IAC9H,YAAY;QAAE,QAAQ;QAAK,WAAW;QAA4E,aAAa;IAAW;IAC1I,SAAS;QAAE,QAAQ;QAAI,WAAW;QAAI,aAAa;IAAY;IAC/D,SAAS;QAAE,QAAQ;QAAK,WAAW;QAA4E,aAAa;IAAU;IACtI,QAAQ;QAAE,QAAQ;QAAK,WAAW;QAAyB,aAAa;IAAG;AAC7E;AAEO,MAAM,kBAAqD,CAAC,EAAE,MAAM,EAAE;IAC3E,IAAI,CAAC,QAAQ;QACX,qBAAO,8OAAC;YAAI,WAAU;sBAAoC;;;;;;IAC5D;IAEA,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,eAAe,EAAE,gBAAgB,EAAE,KAAK,EAAE,GAAG;IAChF,MAAM,YAAY,YAAY,CAAC,OAAO,IAAI,aAAa,MAAM;IAE7D,IAAI,WAAW,WAAW;QACxB,OAAO,MAAM,qDAAqD;IACpE;IAEA,MAAM,aAAa,WAAW,YAAY,SAAS,mBAAmB;IAEtE,MAAM,wBACJ,8OAAC;QAAI,WAAW,IAAA,kHAAE,EAChB,oFACA,UAAU,SAAS;kBAElB,UAAU,MAAM;;;;;;IAIrB,IAAI,cAAc,WAAW,UAAU;QACrC,MAAM,eAAe;YACnB,UAAU,WAAW;YACrB,WAAW,CAAC,KAAK,EAAE,SAAS;YAC5B,YAAY,CAAC,IAAI,EAAE,UAAU;YAC7B,mBAAmB,CAAC,aAAa,EAAE,iBAAiB;YACpD,oBAAoB,CAAC,YAAY,EAAE,kBAAkB;YACrD,SAAS,CAAC,SAAS,EAAE,OAAO;SAC7B,CAAC,MAAM,CAAC;QAET,qBACE,8OAAC,+IAAe;YAAC,eAAe;sBAC9B,cAAA,8OAAC,uIAAO;;kCACN,8OAAC,8IAAc;wBAAC,OAAO;kCACrB,cAAA,8OAAC;4BAAI,WAAU;sCAAiE;;;;;;;;;;;kCAElF,8OAAC,8IAAc;kCACb,cAAA,8OAAC;4BAAI,WAAU;sCACZ,aAAa,GAAG,CAAC,CAAC,MAAM,kBAAM,8OAAC;8CAAW;mCAAJ;;;;;;;;;;;;;;;;;;;;;;;;;;IAMnD;IAEA,qBAAO,8OAAC;QAAI,WAAU;kBAAkD;;;;;;AAC1E"}},
    {"offset": {"line": 471, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/attendance/columns.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { formatDate, formatDateTime, formatDateTimeSeconds, formatDateCustom, parseDate, getCurrentDate, isDateSame } from '@/lib/date-utils';\r\nimport type { AttendanceDataRow, DailyRecord } from './types';\r\nimport type { ColumnDef } from '../../components/data-table/types';\r\nimport { DataTableColumnHeader } from '../../components/data-table/data-table-column-header';\r\nimport { DailyStatusCell } from './components/daily-status-cell';\r\nimport { Checkbox } from \"../../components/ui/checkbox\";\r\nimport { cn } from '../../lib/utils';\r\nimport type { EmployeeSettings } from '../settings/employees/types';\r\nimport { SummaryStat } from './components/summary-stat';\r\nimport type { SystemId } from '../../lib/id-types';\r\nexport const getColumns = (\r\n    year: number, \r\n    month: number, \r\n  onEdit: (employeeSystemId: SystemId, day: number) => void,\r\n    settings: EmployeeSettings,\r\n    isLocked: boolean,\r\n    isSelectionMode: boolean = false,\r\n    cellSelection: Record<string, boolean> = {},\r\n  onQuickFill?: (employeeSystemId: SystemId, day: number) => void\r\n): ColumnDef<AttendanceDataRow>[] => {\r\n  const daysInMonth = new Date(year, month, 0).getDate();\r\n  const dayColumns: ColumnDef<AttendanceDataRow>[] = [];\r\n\r\n  for (let day = 1; day <= daysInMonth; day++) {\r\n    const date = new Date(year, month - 1, day);\r\n    const isWeekend = !settings.workingDays.includes(date.getDay());\r\n    const isToday = isDateSame(date, getCurrentDate());\r\n\r\n    dayColumns.push({\r\n      id: `day_${day}`,\r\n      header: () => (\r\n        <div className={cn(\r\n          \"text-center w-full rounded-sm py-1 relative\",\r\n          isWeekend && \"text-muted-foreground\"\r\n        )}>\r\n          <div className=\"text-body-xs font-medium\">{formatDateCustom(date, 'EEE')}</div>\r\n          <div className=\"font-semibold\">{day}</div>\r\n          {isToday && <div className=\"absolute -bottom-2 left-1/2 -translate-x-1/2 h-1 w-1 rounded-full bg-primary\" />}\r\n        </div>\r\n      ),\r\n      cell: ({ row }) => {\r\n        const record = row[`day_${day}`] as DailyRecord;\r\n        const isEditable = !isLocked && record && record.status !== 'future' && record.status !== 'weekend';\r\n        const cellKey = `${row.employeeSystemId}-${day}`;\r\n        const isSelected = cellSelection[cellKey];\r\n\r\n        return (\r\n          <div\r\n            className={cn(\r\n              \"h-12 w-full flex items-center justify-center rounded-md relative\",\r\n              isEditable && !isSelectionMode && \"cursor-pointer hover:bg-accent/50\",\r\n              isSelectionMode && isEditable && \"cursor-pointer hover:ring-2 hover:ring-primary\",\r\n              isWeekend && record?.status !== 'present' && record?.status !== 'leave' && \"bg-muted/30\",\r\n              isSelected && \"ring-2 ring-primary bg-primary/10\"\r\n            )}\r\n            onClick={() => isEditable && onEdit(row.employeeSystemId, day)}\r\n            onDoubleClick={(e) => {\r\n              if (isEditable && !isSelectionMode && onQuickFill) {\r\n                e.stopPropagation();\r\n                onQuickFill(row.employeeSystemId, day);\r\n              }\r\n            }}\r\n          >\r\n            <DailyStatusCell record={record} />\r\n            {isSelected && (\r\n              <div className=\"absolute top-0.5 right-0.5 h-2 w-2 rounded-full bg-primary\" />\r\n            )}\r\n          </div>\r\n        );\r\n      },\r\n      size: 60,\r\n      meta: { displayName: `Ngày ${day}` },\r\n    });\r\n  }\r\n\r\n  const columns: ColumnDef<AttendanceDataRow>[] = [\r\n    {\r\n      id: 'select',\r\n      header: ({ isAllPageRowsSelected, isSomePageRowsSelected, onToggleAll }) => (\r\n        <Checkbox\r\n          checked={isAllPageRowsSelected ? true : isSomePageRowsSelected ? \"indeterminate\" : false}\r\n          onCheckedChange={(value) => onToggleAll?.(!!value)}\r\n          aria-label=\"Select all\"\r\n        />\r\n      ),\r\n      cell: ({ isSelected, onToggleSelect }) => (\r\n        <Checkbox\r\n          checked={isSelected}\r\n          onCheckedChange={onToggleSelect}\r\n          aria-label=\"Select row\"\r\n        />\r\n      ),\r\n      size: 48,\r\n      meta: { displayName: \"Chọn\", sticky: 'left' },\r\n    },\r\n    {\r\n      id: 'fullName',\r\n      accessorKey: 'fullName',\r\n      header: ({ sorting, setSorting }) => (\r\n        <DataTableColumnHeader\r\n          title=\"Nhân viên\"\r\n          sortKey=\"fullName\"\r\n          isSorted={sorting?.id === 'fullName'}\r\n          sortDirection={sorting?.desc ? 'desc' : 'asc'}\r\n          onSort={() => setSorting?.((s: any) => ({ id: 'fullName', desc: s.id === 'fullName' ? !s.desc : false }))}\r\n        />\r\n      ),\r\n      cell: ({ row }) => (\r\n        <div>\r\n          <div className=\"font-medium\">{row.fullName}</div>\r\n          <div className=\"text-body-xs text-muted-foreground\">{row.employeeId}</div>\r\n        </div>\r\n      ),\r\n      size: 200,\r\n      meta: { displayName: \"Nhân viên\", sticky: 'left' },\r\n    },\r\n    ...dayColumns,\r\n    {\r\n      id: 'summary',\r\n      header: () => <div className=\"text-center\">Tổng kết</div>,\r\n      cell: ({ row }) => {\r\n        return (\r\n          <div className=\"text-body-xs whitespace-nowrap p-1 text-left\">\r\n            <div>\r\n              <span>Công: <span className=\"font-semibold\">{row.workDays}</span>, </span>\r\n              <span>Phép: <span className=\"font-semibold\">{row.leaveDays}</span>, </span>\r\n              <span>Vắng: <span className=\"font-semibold\">{row.absentDays}</span></span>\r\n            </div>\r\n            <div>\r\n              <span>Đi trễ: <span className=\"font-semibold\">{row.lateArrivals}</span>, </span>\r\n              <span>OT: <span className=\"font-semibold\">{row.otHours}h</span></span>\r\n            </div>\r\n          </div>\r\n        );\r\n      },\r\n      size: 180,\r\n      meta: { displayName: 'Tổng kết', sticky: 'right' },\r\n    },\r\n  ];\r\n\r\n  return columns;\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 786, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/attendance/store.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport type { AttendanceDataRow, AttendanceDayKey, DailyRecord } from './types';\r\nimport type { SystemId } from '../../lib/id-types';\r\n\r\n// API sync helper\r\nasync function syncToAPI(action: 'save' | 'lock' | 'unlock', data: any): Promise<boolean> {\r\n  try {\r\n    const endpoint = '/api/attendance';\r\n    const method = action === 'save' ? 'POST' : 'PATCH';\r\n    \r\n    const response = await fetch(endpoint, {\r\n      method,\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({ action, ...data }),\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      console.error(`[Attendance API] ${action} failed:`, await response.text());\r\n      return false;\r\n    }\r\n    return true;\r\n  } catch (error) {\r\n    console.error(`[Attendance API] ${action} error:`, error);\r\n    return false;\r\n  }\r\n}\r\n\r\nasync function fetchFromAPI(monthKey: string): Promise<AttendanceDataRow[] | null> {\r\n  try {\r\n    const [year, month] = monthKey.split('-');\r\n    const fromDate = `${year}-${month}-01`;\r\n    const lastDay = new Date(parseInt(year), parseInt(month), 0).getDate();\r\n    const toDate = `${year}-${month}-${lastDay}`;\r\n    \r\n    // Attendance is filtered by month, so 500 records should cover most cases\r\n    const response = await fetch(`/api/attendance?fromDate=${fromDate}&toDate=${toDate}&limit=500`);\r\n    if (!response.ok) return null;\r\n    \r\n    const json = await response.json();\r\n    return json.data || null;\r\n  } catch (error) {\r\n    console.error('[Attendance API] fetch error:', error);\r\n    return null;\r\n  }\r\n}\r\n\r\ntype AttendanceStoreState = {\r\n  lockedMonths: Record<string, boolean>; // key: \"YYYY-MM\"\r\n  toggleLock: (monthYear: string) => void;\r\n  lockMonth: (monthYear: string) => void;\r\n  unlockMonth: (monthYear: string) => void;\r\n  \r\n  // Data storage\r\n  attendanceData: Record<string, AttendanceDataRow[]>; // key: \"YYYY-MM\"\r\n  saveAttendanceData: (monthKey: string, data: AttendanceDataRow[]) => void;\r\n  getAttendanceData: (monthKey: string) => AttendanceDataRow[] | null;\r\n  updateEmployeeRecord: (\r\n    monthKey: string,\r\n    employeeSystemId: SystemId,\r\n    dayKey: AttendanceDayKey,\r\n    record: DailyRecord\r\n  ) => void;\r\n  \r\n  // API sync\r\n  loadFromAPI: (monthKey: string) => Promise<void>;\r\n  initialized: boolean;\r\n};\r\n\r\nexport const useAttendanceStore = create<AttendanceStoreState>()(\r\n  (set, get) => ({\r\n      lockedMonths: {},\r\n      initialized: false,\r\n      \r\n      lockMonth: (monthYear) => {\r\n        set((state) => ({\r\n          lockedMonths: {\r\n            ...state.lockedMonths,\r\n            [monthYear]: true,\r\n          },\r\n        }));\r\n        // Sync to API\r\n        syncToAPI('lock', { monthYear }).catch(console.error);\r\n      },\r\n      unlockMonth: (monthYear) => {\r\n        set((state) => {\r\n          if (!state.lockedMonths[monthYear]) {\r\n            return state;\r\n          }\r\n          const nextLocked = { ...state.lockedMonths };\r\n          delete nextLocked[monthYear];\r\n          return { lockedMonths: nextLocked };\r\n        });\r\n        // Sync to API\r\n        syncToAPI('unlock', { monthYear }).catch(console.error);\r\n      },\r\n      toggleLock: (monthYear) => {\r\n        const isLocked = Boolean(get().lockedMonths[monthYear]);\r\n        if (isLocked) {\r\n          get().unlockMonth(monthYear);\r\n        } else {\r\n          get().lockMonth(monthYear);\r\n        }\r\n      },\r\n      \r\n      // Data management\r\n      attendanceData: {},\r\n      saveAttendanceData: (monthKey, data) => {\r\n        set((state) => ({\r\n          attendanceData: {\r\n            ...state.attendanceData,\r\n            [monthKey]: data,\r\n          },\r\n        }));\r\n        // Sync to API\r\n        syncToAPI('save', { monthKey, data }).catch(console.error);\r\n      },\r\n      getAttendanceData: (monthKey) => {\r\n        return get().attendanceData[monthKey] || null;\r\n      },\r\n      updateEmployeeRecord: (monthKey, employeeSystemId, dayKey, record) => {\r\n        set((state) => {\r\n          const monthData = state.attendanceData[monthKey];\r\n          if (!monthData) return state;\r\n          \r\n          const updatedData = monthData.map(emp => {\r\n            if (emp.employeeSystemId === employeeSystemId) {\r\n              return { ...emp, [dayKey]: record };\r\n            }\r\n            return emp;\r\n          });\r\n          \r\n          return {\r\n            attendanceData: {\r\n              ...state.attendanceData,\r\n              [monthKey]: updatedData,\r\n            },\r\n          };\r\n        });\r\n        // Sync single record to API\r\n        syncToAPI('save', { monthKey, employeeSystemId, dayKey, record }).catch(console.error);\r\n      },\r\n      \r\n      // Load from API\r\n      loadFromAPI: async (monthKey: string) => {\r\n        const apiData = await fetchFromAPI(monthKey);\r\n        if (apiData && apiData.length > 0) {\r\n          set((state) => ({\r\n            attendanceData: {\r\n              ...state.attendanceData,\r\n              [monthKey]: apiData,\r\n            },\r\n            initialized: true,\r\n          }));\r\n        }\r\n      },\r\n    })\r\n);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 938, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/employees/employee-settings-store.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport type { EmployeeSettings, LeaveType, SalaryComponent, WorkShift } from './types';\r\nimport { getCurrentUserSystemId } from '../../../contexts/auth-context';\r\nimport { generateSystemId, getMaxBusinessIdCounter, getMaxSystemIdCounter, findNextAvailableBusinessId } from '../../../lib/id-utils';\r\nimport { getPrefix, type EntityType } from '../../../lib/smart-prefix';\r\nimport { getEntityConfig } from '../../../lib/id-config';\r\nimport { asBusinessId, asSystemId, type BusinessId, type SystemId } from '@/lib/id-types';\r\n\r\nconst SETTINGS_ENTITY_MAP = {\r\n  workShifts: 'work-shifts',\r\n  leaveTypes: 'leave-types',\r\n  salaryComponents: 'salary-components',\r\n} as const;\r\n\r\ntype SettingsEntityKey = keyof typeof SETTINGS_ENTITY_MAP;\r\ntype SettingsEntityType = (typeof SETTINGS_ENTITY_MAP)[SettingsEntityKey];\r\n\r\ntype CounterState = {\r\n  systemId: number;\r\n  businessId: number;\r\n};\r\n\r\ntype SettingsCounters = Record<SettingsEntityType, CounterState>;\r\n\r\nconst defaultSettings: EmployeeSettings = {\r\n  workStartTime: '08:30',\r\n  workEndTime: '18:00',\r\n  lunchBreakDuration: 90, // 1.5 giờ = 90 phút\r\n  lunchBreakStart: '12:00',\r\n  lunchBreakEnd: '13:30',\r\n  workingDays: [1, 2, 3, 4, 5, 6], // Thứ 2 - Thứ 7 (Mon-Sat)\r\n  workShifts: [\r\n    {\r\n      systemId: asSystemId('WSHIFT000001'),\r\n      id: asBusinessId('CA000001'),\r\n      name: 'Ca hành chính',\r\n      startTime: '08:30',\r\n      endTime: '18:00',\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('WSHIFT000002'),\r\n      id: asBusinessId('CA000002'),\r\n      name: 'Ca tối',\r\n      startTime: '14:00',\r\n      endTime: '22:00',\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n  ],\r\n  otHourlyRate: 25000,  // 25k/giờ làm thêm ngày thường\r\n  otRateWeekend: 1.5,   // Hệ số x1.5 cuối tuần\r\n  otRateHoliday: 3,     // Hệ số x3 ngày lễ\r\n  allowedLateMinutes: 5, // Sau 5 phút mới tính là đi trễ\r\n  latePenaltyTiers: [\r\n    { fromMinutes: 5, toMinutes: 10, amount: 10000 },   // 5-10 phút: 10k\r\n    { fromMinutes: 10, toMinutes: 30, amount: 20000 },  // 10-30 phút: 20k\r\n    { fromMinutes: 30, toMinutes: 60, amount: 50000 },  // 30-60 phút: 50k\r\n    { fromMinutes: 60, toMinutes: null, amount: 100000 }, // >60 phút: 100k\r\n  ],\r\n  earlyLeavePenaltyTiers: [\r\n    { fromMinutes: 5, toMinutes: 10, amount: 10000 },\r\n    { fromMinutes: 10, toMinutes: 30, amount: 20000 },\r\n    { fromMinutes: 30, toMinutes: 60, amount: 50000 },\r\n    { fromMinutes: 60, toMinutes: null, amount: 100000 },\r\n  ],\r\n  leaveTypes: [\r\n    {\r\n      systemId: asSystemId('LEAVETYPE000001'),\r\n      id: asBusinessId('LP000001'),\r\n      name: 'Nghỉ phép năm',\r\n      numberOfDays: 12,\r\n      isPaid: true,\r\n      requiresAttachment: false,\r\n      applicableGender: 'All',\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('LEAVETYPE000002'),\r\n      id: asBusinessId('LP000002'),\r\n      name: 'Nghỉ bệnh',\r\n      numberOfDays: 7,\r\n      isPaid: true,\r\n      requiresAttachment: true,\r\n      applicableGender: 'All',\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n  ],\r\n  baseAnnualLeaveDays: 12,\r\n  annualLeaveSeniorityBonus: {\r\n    years: 5,\r\n    additionalDays: 1,\r\n  },\r\n  allowRollover: false,\r\n  rolloverExpirationDate: '03-31',\r\n  salaryComponents: [\r\n    // =============================================\r\n    // NHÓM THU NHẬP (EARNINGS)\r\n    // =============================================\r\n    {\r\n      systemId: asSystemId('SALCOMP000001'),\r\n      id: asBusinessId('SC000001'),\r\n      name: 'Lương cơ bản',\r\n      description: 'Lương theo ngày công thực tế = Lương HĐ × (Ngày công / Ngày chuẩn)',\r\n      category: 'earning',\r\n      type: 'formula',\r\n      formula: 'baseSalary * (workDays / standardWorkDays)',\r\n      taxable: true,\r\n      partOfSocialInsurance: true,\r\n      isActive: true,\r\n      sortOrder: 1,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000002'),\r\n      id: asBusinessId('SC000002'),\r\n      name: 'Phụ cấp ăn trưa',\r\n      description: 'Phụ cấp theo ngày công thực tế = Ngày công × Mức tiền/ngày (không tính thuế)',\r\n      category: 'earning',\r\n      type: 'formula',\r\n      formula: 'workDays * mealAllowancePerDay',\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 2,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000003'),\r\n      id: asBusinessId('SC000003'),\r\n      name: 'Phụ cấp xăng xe',\r\n      description: 'Phụ cấp đi lại, xăng xe hàng tháng',\r\n      category: 'earning',\r\n      type: 'fixed',\r\n      amount: 500000,\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 3,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000004'),\r\n      id: asBusinessId('SC000004'),\r\n      name: 'Phụ cấp điện thoại',\r\n      description: 'Phụ cấp liên lạc, điện thoại công việc',\r\n      category: 'earning',\r\n      type: 'fixed',\r\n      amount: 300000,\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 4,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000005'),\r\n      id: asBusinessId('SC000005'),\r\n      name: 'Phụ cấp chức vụ',\r\n      description: 'Phụ cấp trách nhiệm theo chức vụ quản lý',\r\n      category: 'earning',\r\n      type: 'fixed',\r\n      amount: 2000000,\r\n      taxable: true,\r\n      partOfSocialInsurance: true,\r\n      isActive: true,\r\n      sortOrder: 5,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000006'),\r\n      id: asBusinessId('SC000006'),\r\n      name: 'Phụ cấp thâm niên',\r\n      description: 'Phụ cấp theo số năm làm việc tại công ty',\r\n      category: 'earning',\r\n      type: 'fixed',\r\n      amount: 500000,\r\n      taxable: true,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 6,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000007'),\r\n      id: asBusinessId('SC000007'),\r\n      name: 'Phụ cấp độc hại',\r\n      description: 'Phụ cấp cho công việc trong môi trường độc hại, nguy hiểm',\r\n      category: 'earning',\r\n      type: 'fixed',\r\n      amount: 1000000,\r\n      taxable: true,\r\n      partOfSocialInsurance: true,\r\n      isActive: false,\r\n      sortOrder: 7,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000008'),\r\n      id: asBusinessId('SC000008'),\r\n      name: 'Thưởng chuyên cần',\r\n      description: 'Thưởng đi làm đầy đủ, không nghỉ phép trong tháng',\r\n      category: 'earning',\r\n      type: 'fixed',\r\n      amount: 500000,\r\n      taxable: true,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 8,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000009'),\r\n      id: asBusinessId('SC000009'),\r\n      name: 'Thưởng KPI',\r\n      description: 'Thưởng hoàn thành chỉ tiêu KPI tháng',\r\n      category: 'earning',\r\n      type: 'formula',\r\n      formula: '[LUONG_CO_BAN] * 0.1',\r\n      taxable: true,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 9,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    // =============================================\r\n    // NHÓM LÀM THÊM GIỜ (OT) - Chi tiết theo loại ngày\r\n    // =============================================\r\n    {\r\n      systemId: asSystemId('SALCOMP000010'),\r\n      id: asBusinessId('SC000010'),\r\n      name: 'Làm thêm ngày thường',\r\n      description: 'Tiền làm thêm sau giờ tan làm (18:00) các ngày trong tuần. Công thức: Giờ OT x Tiền/giờ',\r\n      category: 'earning',\r\n      type: 'formula',\r\n      formula: 'otPayWeekday',\r\n      taxable: true,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 10,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000020'),\r\n      id: asBusinessId('SC000020'),\r\n      name: 'Làm thêm cuối tuần',\r\n      description: 'Tiền làm thêm thứ 7 & Chủ nhật. Công thức: Giờ OT x Tiền/giờ x Hệ số cuối tuần (1.5)',\r\n      category: 'earning',\r\n      type: 'formula',\r\n      formula: 'otPayWeekend',\r\n      taxable: true,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 11,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000021'),\r\n      id: asBusinessId('SC000021'),\r\n      name: 'Làm thêm ngày lễ',\r\n      description: 'Tiền làm thêm các ngày lễ. Công thức: Giờ OT x Tiền/giờ x Hệ số ngày lễ (3)',\r\n      category: 'earning',\r\n      type: 'formula',\r\n      formula: 'otPayHoliday',\r\n      taxable: true,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 12,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000011'),\r\n      id: asBusinessId('SC000011'),\r\n      name: 'Hoa hồng bán hàng',\r\n      description: 'Hoa hồng theo doanh số bán hàng (áp dụng cho bộ phận Kinh doanh)',\r\n      category: 'earning',\r\n      type: 'fixed',\r\n      amount: 0,\r\n      taxable: true,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 13,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    // =============================================\r\n    // NHÓM KHẤU TRỪ (DEDUCTIONS)\r\n    // =============================================\r\n    {\r\n      systemId: asSystemId('SALCOMP000012'),\r\n      id: asBusinessId('SC000012'),\r\n      name: 'Khấu trừ đi trễ',\r\n      description: 'Trừ lương theo số lần/phút đi trễ trong tháng',\r\n      category: 'deduction',\r\n      type: 'fixed',\r\n      amount: 0,\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 20,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000013'),\r\n      id: asBusinessId('SC000013'),\r\n      name: 'Khấu trừ nghỉ không phép',\r\n      description: 'Trừ lương theo số ngày nghỉ không phép',\r\n      category: 'deduction',\r\n      type: 'formula',\r\n      formula: '[NGAY_NGHI_KHONG_PHEP] * ([LUONG_CO_BAN] / [NGAY_CONG_CHUAN])',\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 21,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000014'),\r\n      id: asBusinessId('SC000014'),\r\n      name: 'Tạm ứng lương',\r\n      description: 'Khấu trừ khoản tạm ứng lương đã nhận trước',\r\n      category: 'deduction',\r\n      type: 'fixed',\r\n      amount: 0,\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 22,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000015'),\r\n      id: asBusinessId('SC000015'),\r\n      name: 'Khấu trừ công nợ',\r\n      description: 'Khấu trừ các khoản nợ công ty (vay, mượn...)',\r\n      category: 'deduction',\r\n      type: 'fixed',\r\n      amount: 0,\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: false,\r\n      sortOrder: 23,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    // =============================================\r\n    // NHÓM ĐÓNG GÓP (CONTRIBUTIONS) - Tự động tính\r\n    // =============================================\r\n    {\r\n      systemId: asSystemId('SALCOMP000016'),\r\n      id: asBusinessId('SC000016'),\r\n      name: 'BHXH (NV đóng)',\r\n      description: 'Bảo hiểm xã hội phần người lao động đóng (8%)',\r\n      category: 'contribution',\r\n      type: 'formula',\r\n      formula: '[LUONG_DONG_BHXH] * 0.08',\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 30,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000017'),\r\n      id: asBusinessId('SC000017'),\r\n      name: 'BHYT (NV đóng)',\r\n      description: 'Bảo hiểm y tế phần người lao động đóng (1.5%)',\r\n      category: 'contribution',\r\n      type: 'formula',\r\n      formula: '[LUONG_DONG_BHXH] * 0.015',\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 31,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000018'),\r\n      id: asBusinessId('SC000018'),\r\n      name: 'BHTN (NV đóng)',\r\n      description: 'Bảo hiểm thất nghiệp phần người lao động đóng (1%)',\r\n      category: 'contribution',\r\n      type: 'formula',\r\n      formula: '[LUONG_DONG_BHXH] * 0.01',\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: true,\r\n      sortOrder: 32,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n    {\r\n      systemId: asSystemId('SALCOMP000019'),\r\n      id: asBusinessId('SC000019'),\r\n      name: 'Công đoàn phí',\r\n      description: 'Phí công đoàn hàng tháng (1% lương cơ bản)',\r\n      category: 'contribution',\r\n      type: 'formula',\r\n      formula: '[LUONG_CO_BAN] * 0.01',\r\n      taxable: false,\r\n      partOfSocialInsurance: false,\r\n      isActive: false,\r\n      sortOrder: 33,\r\n      applicableDepartmentSystemIds: [],\r\n    },\r\n  ],\r\n  payrollCycle: 'monthly',\r\n  payday: 5,\r\n  payrollLockDate: 5,\r\n  \r\n  // =============================================\r\n  // CÀI ĐẶT BẢO HIỂM (Luật BHXH 2024)\r\n  // =============================================\r\n  insuranceRates: {\r\n    socialInsurance: {\r\n      employeeRate: 8,      // BHXH NV đóng 8%\r\n      employerRate: 17.5,   // BHXH DN đóng 17.5%\r\n    },\r\n    healthInsurance: {\r\n      employeeRate: 1.5,    // BHYT NV đóng 1.5%\r\n      employerRate: 3,      // BHYT DN đóng 3%\r\n    },\r\n    unemploymentInsurance: {\r\n      employeeRate: 1,      // BHTN NV đóng 1%\r\n      employerRate: 1,      // BHTN DN đóng 1%\r\n    },\r\n    // Trần đóng BHXH = 20 x lương cơ sở (từ 1/7/2024)\r\n    insuranceSalaryCap: 46800000,   // 20 x 2,340,000\r\n    baseSalaryReference: 2340000,    // Lương cơ sở từ 1/7/2024\r\n  },\r\n  \r\n  // =============================================\r\n  // CÀI ĐẶT THUẾ TNCN (Luật thuế TNCN hiện hành)\r\n  // =============================================\r\n  taxSettings: {\r\n    personalDeduction: 11000000,    // Giảm trừ bản thân 11 triệu/tháng\r\n    dependentDeduction: 4400000,    // Giảm trừ mỗi người phụ thuộc 4.4 triệu/tháng\r\n    // Biểu thuế lũy tiến từng phần (theo thu nhập tính thuế/tháng)\r\n    taxBrackets: [\r\n      { fromAmount: 0, toAmount: 5000000, rate: 5 },\r\n      { fromAmount: 5000000, toAmount: 10000000, rate: 10 },\r\n      { fromAmount: 10000000, toAmount: 18000000, rate: 15 },\r\n      { fromAmount: 18000000, toAmount: 32000000, rate: 20 },\r\n      { fromAmount: 32000000, toAmount: 52000000, rate: 25 },\r\n      { fromAmount: 52000000, toAmount: 80000000, rate: 30 },\r\n      { fromAmount: 80000000, toAmount: null, rate: 35 },\r\n    ],\r\n  },\r\n  \r\n  // =============================================\r\n  // LƯƠNG TỐI THIỂU VÙNG (NĐ 74/2024/NĐ-CP từ 1/7/2024)\r\n  // =============================================\r\n  minimumWage: {\r\n    region1: 4960000,   // Vùng I\r\n    region2: 4410000,   // Vùng II\r\n    region3: 3860000,   // Vùng III\r\n    region4: 3450000,   // Vùng IV\r\n  },\r\n  \r\n  // Số ngày công chuẩn trong tháng\r\n  standardWorkDays: 26,\r\n  \r\n  // Phụ cấp ăn trưa theo ngày công\r\n  mealAllowancePerDay: 30000, // 30k/ngày\r\n};\r\n\r\ntype EmployeeSettingsState = {\r\n  settings: EmployeeSettings;\r\n  counters: SettingsCounters;\r\n  initialized: boolean;\r\n  setSettings: (settings: EmployeeSettings) => void;\r\n  getShiftBySystemId: (systemId: SystemId) => WorkShift | undefined;\r\n  getLeaveTypes: () => LeaveType[];\r\n  getSalaryComponents: () => SalaryComponent[];\r\n  getDefaultPayrollWindow: () => {\r\n    cycle: EmployeeSettings['payrollCycle'];\r\n    payday: number;\r\n    lockDate: number;\r\n  };\r\n  loadFromAPI: () => Promise<void>;\r\n};\r\n\r\nconst cloneSettings = (payload?: EmployeeSettings): EmployeeSettings => ({\r\n  ...defaultSettings,\r\n  ...payload,\r\n  annualLeaveSeniorityBonus: {\r\n    ...defaultSettings.annualLeaveSeniorityBonus,\r\n    ...(payload?.annualLeaveSeniorityBonus ?? {}),\r\n  },\r\n  workShifts: (payload?.workShifts ?? defaultSettings.workShifts).map((shift) => ({ ...shift })),\r\n  leaveTypes: (payload?.leaveTypes ?? defaultSettings.leaveTypes).map((type) => ({ ...type })),\r\n  salaryComponents: (payload?.salaryComponents ?? defaultSettings.salaryComponents).map((component) => ({ ...component })),\r\n});\r\n\r\nconst computeCounter = <T extends { systemId?: SystemId; id?: BusinessId }>(\r\n  items: T[],\r\n  entityType: EntityType\r\n): CounterState => {\r\n  const config = getEntityConfig(entityType);\r\n  const systemItems = items\r\n    .filter((item): item is T & { systemId: SystemId } => Boolean(item.systemId))\r\n    .map(({ systemId }) => ({ systemId }));\r\n  const businessItems = items\r\n    .filter((item): item is T & { id: BusinessId } => Boolean(item.id))\r\n    .map(({ id }) => ({ id }));\r\n  return {\r\n    systemId: getMaxSystemIdCounter(systemItems, config.systemIdPrefix),\r\n    businessId: getMaxBusinessIdCounter(businessItems, getPrefix(entityType)),\r\n  };\r\n};\r\n\r\nconst buildCounters = (settings: EmployeeSettings): SettingsCounters => ({\r\n  'work-shifts': computeCounter(settings.workShifts, 'work-shifts'),\r\n  'leave-types': computeCounter(settings.leaveTypes, 'leave-types'),\r\n  'salary-components': computeCounter(settings.salaryComponents, 'salary-components'),\r\n});\r\n\r\ntype BaseSettingsEntity = {\r\n  systemId?: SystemId;\r\n  id?: BusinessId;\r\n  createdAt?: string;\r\n  createdBy?: SystemId;\r\n  updatedAt?: string;\r\n  updatedBy?: SystemId;\r\n  applicableDepartmentSystemIds?: SystemId[];\r\n};\r\n\r\nconst normalizeCollection = <T extends BaseSettingsEntity>(\r\n  items: T[],\r\n  entityType: SettingsEntityType,\r\n  counters: SettingsCounters,\r\n  currentUser?: SystemId\r\n): { records: T[]; counters: SettingsCounters } => {\r\n  let systemCounter = counters[entityType]?.systemId ?? 0;\r\n  let businessCounter = counters[entityType]?.businessId ?? 0;\r\n  const prefix = getPrefix(entityType);\r\n  const config = getEntityConfig(entityType);\r\n  const allKnownIds = new Set<string>(\r\n    items\r\n      .map((item) => item.id?.toUpperCase())\r\n      .filter((id): id is string => Boolean(id))\r\n  );\r\n  const usedIds = new Set<string>();\r\n  const now = new Date().toISOString();\r\n\r\n  const records = items.map((item) => {\r\n    let systemId = item.systemId;\r\n    const hasValidSystemId = Boolean(systemId && systemId.startsWith(config.systemIdPrefix));\r\n    const isNew = !hasValidSystemId;\r\n    if (!hasValidSystemId) {\r\n      systemCounter += 1;\r\n      systemId = asSystemId(generateSystemId(entityType, systemCounter));\r\n    }\r\n\r\n    let businessIdString = item.id ? String(item.id).toUpperCase() : undefined;\r\n    const hasValidBusinessId = Boolean(businessIdString && businessIdString.startsWith(prefix));\r\n    if (!hasValidBusinessId || (businessIdString && usedIds.has(businessIdString))) {\r\n      const { nextId, updatedCounter } = findNextAvailableBusinessId(prefix, Array.from(allKnownIds), businessCounter);\r\n      businessIdString = nextId;\r\n      businessCounter = updatedCounter;\r\n    }\r\n    if (!businessIdString) {\r\n      businessCounter += 1;\r\n      businessIdString = `${prefix}${String(businessCounter).padStart(config.digitCount, '0')}`;\r\n    }\r\n\r\n    allKnownIds.add(businessIdString);\r\n    usedIds.add(businessIdString);\r\n\r\n    const resolvedSystemId = systemId ?? asSystemId(generateSystemId(entityType, systemCounter));\r\n    const resolvedBusinessId = asBusinessId(businessIdString);\r\n\r\n    const createdAt = item.createdAt ?? now;\r\n    const createdBy = item.createdBy ?? (isNew && currentUser ? currentUser : item.createdBy);\r\n\r\n    return {\r\n      ...item,\r\n      systemId: resolvedSystemId,\r\n      id: resolvedBusinessId,\r\n      applicableDepartmentSystemIds: item.applicableDepartmentSystemIds ?? [],\r\n      createdAt,\r\n      createdBy,\r\n      updatedAt: now,\r\n      updatedBy: currentUser ?? item.updatedBy,\r\n    } as T;\r\n  });\r\n\r\n  return {\r\n    records,\r\n    counters: {\r\n      ...counters,\r\n      [entityType]: {\r\n        systemId: systemCounter,\r\n        businessId: businessCounter,\r\n      },\r\n    },\r\n  };\r\n};\r\n\r\nconst normalizeSettings = (\r\n  incoming: EmployeeSettings,\r\n  counters: SettingsCounters,\r\n  currentUser?: SystemId\r\n): { settings: EmployeeSettings; counters: SettingsCounters } => {\r\n  let nextCounters = { ...counters };\r\n  const normalizedShifts = normalizeCollection(incoming.workShifts, 'work-shifts', nextCounters, currentUser);\r\n  nextCounters = normalizedShifts.counters;\r\n  const normalizedLeaves = normalizeCollection(incoming.leaveTypes, 'leave-types', nextCounters, currentUser);\r\n  nextCounters = normalizedLeaves.counters;\r\n  const normalizedComponents = normalizeCollection(incoming.salaryComponents, 'salary-components', nextCounters, currentUser);\r\n\r\n  return {\r\n    settings: {\r\n      ...incoming,\r\n      workShifts: normalizedShifts.records,\r\n      leaveTypes: normalizedLeaves.records,\r\n      salaryComponents: normalizedComponents.records,\r\n    },\r\n    counters: normalizedComponents.counters,\r\n  };\r\n};\r\n\r\nconst buildInitialState = () => {\r\n  const cloned = cloneSettings(defaultSettings);\r\n  const counters = buildCounters(cloned);\r\n  return normalizeSettings(cloned, counters);\r\n};\r\n\r\nconst initialState = buildInitialState();\r\n\r\n// API sync helper\r\nasync function syncSettingsToAPI(settings: EmployeeSettings): Promise<boolean> {\r\n  try {\r\n    const response = await fetch('/api/settings/employees', {\r\n      method: 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify(settings),\r\n    });\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error('[Employee Settings API] sync error:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const useEmployeeSettingsStore = create<EmployeeSettingsState>()(\r\n  (set, get) => ({\r\n      settings: initialState.settings,\r\n      counters: initialState.counters,\r\n      initialized: false,\r\n      setSettings: (payload) => {\r\n        const cloned = cloneSettings(payload);\r\n        const currentUser = getCurrentUserSystemId();\r\n        const normalized = normalizeSettings(\r\n          cloned,\r\n          get().counters,\r\n          currentUser ? asSystemId(currentUser) : undefined\r\n        );\r\n        set(normalized);\r\n        \r\n        // Sync to API\r\n        syncSettingsToAPI(normalized.settings).catch(console.error);\r\n      },\r\n      getShiftBySystemId: (systemId) => get().settings.workShifts.find((shift) => shift.systemId === systemId),\r\n      getLeaveTypes: () => get().settings.leaveTypes,\r\n      getSalaryComponents: () => get().settings.salaryComponents,\r\n      getDefaultPayrollWindow: () => {\r\n        const current = get().settings;\r\n        return {\r\n          cycle: current.payrollCycle,\r\n          payday: current.payday,\r\n          lockDate: current.payrollLockDate,\r\n        };\r\n      },\r\n      \r\n      loadFromAPI: async () => {\r\n        if (get().initialized) return;\r\n        \r\n        try {\r\n          const response = await fetch('/api/settings/employees');\r\n          if (response.ok) {\r\n            const json = await response.json();\r\n            const settings = json.data || json.settings;\r\n            if (settings) {\r\n              const cloned = cloneSettings(settings);\r\n              const counters = buildCounters(cloned);\r\n              const normalized = normalizeSettings(cloned, counters);\r\n              set({ ...normalized, initialized: true });\r\n            } else {\r\n              set({ initialized: true });\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('[Employee Settings Store] loadFromAPI error:', error);\r\n        }\r\n      },\r\n    })\r\n);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1642, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/attendance/utils.ts"],"sourcesContent":["import { formatDate, formatDateTime, formatDateTimeSeconds, formatDateCustom, parseDate, getCurrentDate, toISODate, isValidDate, isDateAfter, getStartOfDay, getEndOfDay, getDayOfWeek } from '../../lib/date-utils';\r\nimport type { AttendanceDataRow, DailyRecord, AnyAttendanceDataRow } from './types';\r\nimport type { EmployeeSettings } from '../settings/employees/types';\r\nimport type { Employee } from '../employees/types';\r\nimport type { SystemId, BusinessId } from '../../lib/id-types';\r\n\r\n/**\r\n * Initialize empty attendance data for employees\r\n * Creates attendance rows with default status (weekend/absent) based on working days\r\n * NO mock data - just empty structure ready for real data input\r\n */\r\nexport function initializeEmptyAttendance(\r\n  employees: Employee[],\r\n  year: number,\r\n  month: number,\r\n  settings: EmployeeSettings\r\n): AttendanceDataRow[] {\r\n  const daysInMonth = new Date(year, month, 0).getDate();\r\n  \r\n  return employees.map((emp) => {\r\n    const row: AnyAttendanceDataRow = {\r\n      systemId: emp.systemId,\r\n      employeeSystemId: emp.systemId,\r\n      employeeId: emp.id,\r\n      fullName: emp.fullName,\r\n      department: emp.department,\r\n      workDays: 0,\r\n      leaveDays: 0,\r\n      absentDays: 0,\r\n      lateArrivals: 0,\r\n      earlyDepartures: 0,\r\n      otHours: 0,\r\n      otHoursWeekday: 0,\r\n      otHoursWeekend: 0,\r\n      otHoursHoliday: 0,\r\n    };\r\n\r\n    // Initialize each day with default status\r\n    for (let d = 1; d <= daysInMonth; d++) {\r\n      const workDate = new Date(year, month - 1, d);\r\n      const dayOfWeek = getDayOfWeek(workDate);\r\n      const isWorkingDay = dayOfWeek !== null && settings.workingDays.includes(dayOfWeek);\r\n      \r\n      row[`day_${d}`] = {\r\n        status: isWorkingDay ? 'absent' : 'weekend',\r\n      };\r\n    }\r\n\r\n    return row as AttendanceDataRow;\r\n  });\r\n}\r\n\r\n// Function to convert Excel serial time number to HH:mm format\r\nexport function excelSerialToTime(serial: any): string {\r\n    if (typeof serial === 'string') {\r\n        // If it's already a time string, just ensure format\r\n        const parts = serial.split(':');\r\n        if (parts.length >= 2) {\r\n            return `${parts[0].padStart(2, '0')}:${parts[1].padStart(2, '0')}`;\r\n        }\r\n        return '';\r\n    }\r\n    if (typeof serial !== 'number' || serial < 0 || serial > 1) {\r\n        // It might be a Date object from cellDates:true\r\n        if (serial instanceof Date) {\r\n            // Use local time (getHours/getMinutes) for Vietnam timezone GMT+7\r\n            const hours = serial.getHours();\r\n            const minutes = serial.getMinutes();\r\n            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;\r\n        }\r\n        return ''; // Invalid time serial\r\n    }\r\n    const totalSeconds = Math.round(serial * 86400);\r\n    const hours = Math.floor(totalSeconds / 3600);\r\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\r\n    return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;\r\n}\r\n\r\n\r\nexport function recalculateSummary(\r\n    row: AnyAttendanceDataRow, \r\n    year: number, \r\n    month: number, \r\n    settings: EmployeeSettings\r\n): Pick<AttendanceDataRow, 'workDays' | 'leaveDays' | 'absentDays' | 'lateArrivals' | 'earlyDepartures' | 'otHours' | 'otHoursWeekday' | 'otHoursWeekend' | 'otHoursHoliday'> {\r\n    let totalWorkMinutes = 0; // Tổng phút làm việc trong giờ hành chính (8:30-18:00)\r\n    let leaveDays = 0;\r\n    let absentDays = 0;\r\n    let lateArrivals = 0;\r\n    let earlyDepartures = 0;\r\n    \r\n    // OT theo loại ngày\r\n    let otMinutesWeekday = 0;  // Làm thêm ngày thường (sau 18h)\r\n    let otMinutesWeekend = 0;  // Làm thêm cuối tuần\r\n    let otMinutesHoliday = 0;  // Làm thêm ngày lễ\r\n    \r\n    const daysInMonth = new Date(year, month, 0).getDate();\r\n    \r\n    // Tính số giờ làm việc tiêu chuẩn 1 ngày (trừ nghỉ trưa)\r\n    // VD: 8:30-18:00 = 9.5h, trừ nghỉ trưa 1.5h = 8h\r\n    const workStartParts = settings.workStartTime.split(':').map(Number);\r\n    const workEndParts = settings.workEndTime.split(':').map(Number);\r\n    const workStartMinutes = workStartParts[0] * 60 + workStartParts[1];\r\n    const workEndMinutes = workEndParts[0] * 60 + workEndParts[1];\r\n    const standardDayMinutes = workEndMinutes - workStartMinutes - settings.lunchBreakDuration;\r\n    \r\n    // Lấy giờ nghỉ trưa từ settings (nếu có), fallback về hardcode\r\n    const lunchStartParts = (settings.lunchBreakStart || '12:00').split(':').map(Number);\r\n    const lunchEndParts = (settings.lunchBreakEnd || '13:30').split(':').map(Number);\r\n    const lunchStartMinutes = lunchStartParts[0] * 60 + lunchStartParts[1];\r\n    const lunchEndMinutes = lunchEndParts[0] * 60 + lunchEndParts[1];\r\n\r\n    for (let d = 1; d <= daysInMonth; d++) {\r\n        const record = row[`day_${d}`] as DailyRecord;\r\n        const workDate = new Date(year, month - 1, d);\r\n        const dayOfWeek = getDayOfWeek(workDate);\r\n        const isWorkingDay = dayOfWeek !== null && settings.workingDays.includes(dayOfWeek);\r\n        const isWeekend = dayOfWeek === 0 || dayOfWeek === 6; // CN = 0, T7 = 6\r\n        const isHoliday = record?.status === 'holiday';\r\n\r\n        if (record) {\r\n            // Xử lý cho ngày làm việc (thứ 2-6)\r\n            if (isWorkingDay) {\r\n                // Tính giờ làm việc thực tế từ checkIn/checkOut\r\n                if (record.checkIn && record.checkOut) {\r\n                    const workDateStr = toISODate(workDate);\r\n                    const checkInTime = new Date(`${workDateStr}T${record.checkIn}`);\r\n                    const checkOutTime = new Date(`${workDateStr}T${record.checkOut}`);\r\n                    \r\n                    if (isValidDate(checkInTime) && isValidDate(checkOutTime) && isDateAfter(checkOutTime, checkInTime)) {\r\n                        const checkInMins = checkInTime.getHours() * 60 + checkInTime.getMinutes();\r\n                        const checkOutMins = checkOutTime.getHours() * 60 + checkOutTime.getMinutes();\r\n                        \r\n                        // ===== TÍNH GIỜ CÔNG (trong giờ hành chính 8:30-18:00) =====\r\n                        // Giờ vào tính công = max(checkIn, workStart)\r\n                        const effectiveStartMins = Math.max(checkInMins, workStartMinutes);\r\n                        // Giờ ra tính công = min(checkOut, workEnd)\r\n                        const effectiveEndMins = Math.min(checkOutMins, workEndMinutes);\r\n                        \r\n                        let workedMinutes = effectiveEndMins - effectiveStartMins;\r\n                        \r\n                        // Trừ nghỉ trưa nếu làm qua giờ nghỉ trưa\r\n                        if (effectiveStartMins < lunchStartMinutes && effectiveEndMins > lunchEndMinutes) {\r\n                            workedMinutes -= settings.lunchBreakDuration;\r\n                        } else if (effectiveStartMins < lunchEndMinutes && effectiveEndMins > lunchStartMinutes) {\r\n                            // Nếu chỉ chạm 1 phần giờ nghỉ trưa\r\n                            const overlapStart = Math.max(effectiveStartMins, lunchStartMinutes);\r\n                            const overlapEnd = Math.min(effectiveEndMins, lunchEndMinutes);\r\n                            workedMinutes -= Math.max(0, overlapEnd - overlapStart);\r\n                        }\r\n                        \r\n                        totalWorkMinutes += Math.max(0, workedMinutes);\r\n                        \r\n                        // ===== TÍNH GIỜ LÀM THÊM (sau giờ tan làm 18:00) =====\r\n                        if (checkOutMins > workEndMinutes) {\r\n                            const otMinutes = checkOutMins - workEndMinutes;\r\n                            if (isHoliday) {\r\n                                otMinutesHoliday += otMinutes;\r\n                            } else {\r\n                                otMinutesWeekday += otMinutes;\r\n                            }\r\n                        }\r\n                        \r\n                        // Early departure calculation - ra trước giờ tan làm\r\n                        if (checkOutMins < workEndMinutes) {\r\n                            earlyDepartures++;\r\n                        }\r\n                    }\r\n                }\r\n                \r\n                // Đếm ngày nghỉ phép\r\n                if (record.status === 'leave') {\r\n                    leaveDays += 1;\r\n                }\r\n\r\n                // Late arrival calculation\r\n                if (record.checkIn) {\r\n                    const workDateStr = toISODate(workDate);\r\n                    const checkInTime = new Date(`${workDateStr}T${record.checkIn}`);\r\n                    const workStartTime = new Date(`${workDateStr}T${settings.workStartTime}`);\r\n                    const allowedLateTime = new Date(workStartTime.getTime() + settings.allowedLateMinutes * 60000);\r\n\r\n                    if (isDateAfter(checkInTime, allowedLateTime)) {\r\n                        lateArrivals++;\r\n                    }\r\n                }\r\n            }\r\n            \r\n            // ===== XỬ LÝ LÀM THÊM CUỐI TUẦN / NGÀY LỄ =====\r\n            // Nếu là cuối tuần hoặc ngày lễ mà có checkIn/checkOut → tính toàn bộ là OT\r\n            if ((isWeekend || isHoliday) && record.checkIn && record.checkOut) {\r\n                const workDateStr = toISODate(workDate);\r\n                const checkInTime = new Date(`${workDateStr}T${record.checkIn}`);\r\n                const checkOutTime = new Date(`${workDateStr}T${record.checkOut}`);\r\n                \r\n                if (isValidDate(checkInTime) && isValidDate(checkOutTime) && isDateAfter(checkOutTime, checkInTime)) {\r\n                    let otMinutes = (checkOutTime.getTime() - checkInTime.getTime()) / 60000;\r\n                    \r\n                    // Trừ nghỉ trưa nếu làm qua trưa\r\n                    const checkInMins = checkInTime.getHours() * 60 + checkInTime.getMinutes();\r\n                    const checkOutMins = checkOutTime.getHours() * 60 + checkOutTime.getMinutes();\r\n                    if (checkInMins < lunchStartMinutes && checkOutMins > lunchEndMinutes) {\r\n                        otMinutes -= settings.lunchBreakDuration;\r\n                    }\r\n                    \r\n                    if (isHoliday) {\r\n                        otMinutesHoliday += Math.max(0, otMinutes);\r\n                    } else {\r\n                        otMinutesWeekend += Math.max(0, otMinutes);\r\n                    }\r\n                }\r\n            }\r\n            \r\n            // OT từ cột overtimeCheckIn/overtimeCheckOut riêng (nếu có)\r\n            if (record.overtimeCheckIn && record.overtimeCheckOut) {\r\n                const workDateStr = toISODate(workDate);\r\n                const otStartDate = new Date(`${workDateStr}T${record.overtimeCheckIn}`);\r\n                const otEndDate = new Date(`${workDateStr}T${record.overtimeCheckOut}`);\r\n                if (isValidDate(otStartDate) && isValidDate(otEndDate) && isDateAfter(otEndDate, otStartDate)) {\r\n                    const diffInMinutes = (otEndDate.getTime() - otStartDate.getTime()) / 60000;\r\n                    if (isHoliday) {\r\n                        otMinutesHoliday += diffInMinutes;\r\n                    } else if (isWeekend) {\r\n                        otMinutesWeekend += diffInMinutes;\r\n                    } else {\r\n                        otMinutesWeekday += diffInMinutes;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Tính số công = Tổng giờ làm / Giờ tiêu chuẩn 1 ngày (tối đa = số ngày làm việc trong tháng)\r\n    const workDays = standardDayMinutes > 0 \r\n        ? parseFloat((totalWorkMinutes / standardDayMinutes).toFixed(2))\r\n        : 0;\r\n    \r\n    // Tính ngày vắng = Tổng ngày làm việc trong tháng - ngày có công - ngày phép\r\n    const totalWorkingDaysInMonth = Array.from({ length: daysInMonth }, (_, i) => {\r\n        const d = new Date(year, month - 1, i + 1);\r\n        const dow = getDayOfWeek(d);\r\n        return dow !== null && settings.workingDays.includes(dow) ? 1 : 0;\r\n    }).reduce((a, b) => a + b, 0);\r\n    \r\n    absentDays = Math.max(0, totalWorkingDaysInMonth - Math.ceil(workDays) - leaveDays);\r\n    \r\n    // Convert OT từ phút sang giờ\r\n    const otHoursWeekday = parseFloat((otMinutesWeekday / 60).toFixed(2));\r\n    const otHoursWeekend = parseFloat((otMinutesWeekend / 60).toFixed(2));\r\n    const otHoursHoliday = parseFloat((otMinutesHoliday / 60).toFixed(2));\r\n    const otHours = parseFloat((otHoursWeekday + otHoursWeekend + otHoursHoliday).toFixed(2));\r\n    \r\n    return {\r\n        workDays,\r\n        leaveDays,\r\n        absentDays,\r\n        lateArrivals,\r\n        earlyDepartures,\r\n        otHours,\r\n        otHoursWeekday,\r\n        otHoursWeekend,\r\n        otHoursHoliday,\r\n    };\r\n}\r\n\r\n/**\r\n * Tính tiền làm thêm (OT) dựa trên số giờ và cài đặt\r\n * \r\n * Công thức:\r\n * - Ngày thường: otHoursWeekday * otHourlyRate (VNĐ/giờ)\r\n * - Cuối tuần: otHoursWeekend * otHourlyRate * otRateWeekend (hệ số 1.5)\r\n * - Ngày lễ: otHoursHoliday * otHourlyRate * otRateHoliday (hệ số 3)\r\n * \r\n * VD: settings.otHourlyRate = 25000, otRateWeekend = 1.5, otRateHoliday = 3\r\n * - 2 giờ OT ngày thường = 2 * 25000 = 50,000 VNĐ\r\n * - 2 giờ OT cuối tuần = 2 * 25000 * 1.5 = 75,000 VNĐ\r\n * - 2 giờ OT ngày lễ = 2 * 25000 * 3 = 150,000 VNĐ\r\n */\r\nexport function calculateOvertimePay(\r\n    otHoursWeekday: number,\r\n    otHoursWeekend: number,\r\n    otHoursHoliday: number,\r\n    settings: EmployeeSettings\r\n): {\r\n    weekdayPay: number;\r\n    weekendPay: number;\r\n    holidayPay: number;\r\n    totalOtPay: number;\r\n} {\r\n    const hourlyRate = settings.otHourlyRate || 0;\r\n    \r\n    // Ngày thường: tiền/giờ * số giờ\r\n    const weekdayPay = otHoursWeekday * hourlyRate;\r\n    \r\n    // Cuối tuần: tiền/giờ * hệ số cuối tuần * số giờ\r\n    const weekendPay = otHoursWeekend * hourlyRate * (settings.otRateWeekend || 1.5);\r\n    \r\n    // Ngày lễ: tiền/giờ * hệ số ngày lễ * số giờ  \r\n    const holidayPay = otHoursHoliday * hourlyRate * (settings.otRateHoliday || 3);\r\n    \r\n    const totalOtPay = weekdayPay + weekendPay + holidayPay;\r\n    \r\n    return {\r\n        weekdayPay: Math.round(weekdayPay),\r\n        weekendPay: Math.round(weekendPay),\r\n        holidayPay: Math.round(holidayPay),\r\n        totalOtPay: Math.round(totalOtPay),\r\n    };\r\n}\r\n\r\n/**\r\n * Tính tiền OT từ AttendanceDataRow\r\n */\r\nexport function calculateOvertimePayFromRow(\r\n    row: AttendanceDataRow,\r\n    settings: EmployeeSettings\r\n): ReturnType<typeof calculateOvertimePay> {\r\n    return calculateOvertimePay(\r\n        row.otHoursWeekday || 0,\r\n        row.otHoursWeekend || 0,\r\n        row.otHoursHoliday || 0,\r\n        settings\r\n    );\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1888, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/leaves/leave-sync-service.ts"],"sourcesContent":["import type { LeaveRequest } from './types';\r\nimport type { AttendanceDayKey, AttendanceDataRow, AnyAttendanceDataRow, DailyRecord } from '../attendance/types';\r\nimport { useAttendanceStore } from '../attendance/store';\r\nimport { useEmployeeSettingsStore } from '../settings/employees/employee-settings-store';\r\nimport { recalculateSummary } from '../attendance/utils';\r\nimport { getCurrentDate } from '../../lib/date-utils';\r\n\r\nconst LEAVE_NOTE_PREFIX = '[LEAVE:';\r\n\r\ntype DayContext = {\r\n  date: Date;\r\n  dayOfMonth: number;\r\n};\r\n\r\ntype MonthDayMap = Map<string, DayContext[]>;\r\n\r\nconst buildMonthKey = (date: Date) => `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\r\n\r\nconst buildLeaveNote = (leave: LeaveRequest) => {\r\n  const description = `${LEAVE_NOTE_PREFIX}${leave.systemId}] ${leave.leaveTypeName}`;\r\n  return leave.reason ? `${description} - ${leave.reason}` : description;\r\n};\r\n\r\nconst isSameLeaveNote = (record: DailyRecord | undefined, leave: LeaveRequest) => {\r\n  if (!record?.notes) return false;\r\n  return record.notes.includes(`${LEAVE_NOTE_PREFIX}${leave.systemId}]`);\r\n};\r\n\r\nconst cloneDate = (input: Date) => new Date(input.getFullYear(), input.getMonth(), input.getDate());\r\n\r\nconst parseLeaveBoundary = (value: string): Date => {\r\n  const parsed = new Date(`${value}T00:00:00`);\r\n  return Number.isNaN(parsed.getTime()) ? new Date() : parsed;\r\n};\r\n\r\nconst collectWorkingDays = (leave: LeaveRequest): MonthDayMap => {\r\n  const workingDays = new Set(useEmployeeSettingsStore.getState().settings.workingDays);\r\n  if (!leave.startDate || !leave.endDate) return new Map();\r\n\r\n  let start = parseLeaveBoundary(leave.startDate);\r\n  let end = parseLeaveBoundary(leave.endDate);\r\n  if (start > end) {\r\n    const temp = start;\r\n    start = end;\r\n    end = temp;\r\n  }\r\n\r\n  const monthMap: MonthDayMap = new Map();\r\n  for (let cursor = cloneDate(start); cursor <= end; cursor.setDate(cursor.getDate() + 1)) {\r\n    const dayOfWeek = cursor.getDay();\r\n    if (!workingDays.has(dayOfWeek)) {\r\n      continue;\r\n    }\r\n\r\n    const monthKey = buildMonthKey(cursor);\r\n    const entry: DayContext = { date: cloneDate(cursor), dayOfMonth: cursor.getDate() };\r\n    const existing = monthMap.get(monthKey);\r\n    if (existing) {\r\n      existing.push(entry);\r\n    } else {\r\n      monthMap.set(monthKey, [entry]);\r\n    }\r\n  }\r\n\r\n  return monthMap;\r\n};\r\n\r\nconst buildLeaveRecord = (leave: LeaveRequest): DailyRecord => ({\r\n  status: 'leave',\r\n  notes: buildLeaveNote(leave),\r\n});\r\n\r\nconst buildRevertedRecord = (context: DayContext): DailyRecord => {\r\n  const today = getCurrentDate();\r\n  if (context.date > today) {\r\n    return { status: 'future' };\r\n  }\r\n  return { status: 'absent' };\r\n};\r\n\r\nconst applyUpdatesForMonth = (monthKey: string, days: DayContext[], leave: LeaveRequest, mode: 'apply' | 'clear') => {\r\n  if (days.length === 0) return;\r\n\r\n  const attendanceStore = useAttendanceStore.getState();\r\n  const monthData = attendanceStore.getAttendanceData(monthKey);\r\n  if (!monthData?.length) return;\r\n\r\n  const [yearStr, monthStr] = monthKey.split('-');\r\n  const year = Number(yearStr) || new Date().getFullYear();\r\n  const month = Number(monthStr) || new Date().getMonth() + 1;\r\n  const settings = useEmployeeSettingsStore.getState().settings;\r\n\r\n  let didChange = false;\r\n  const updatedRows: AttendanceDataRow[] = monthData.map((row) => {\r\n    if (row.employeeSystemId !== leave.employeeSystemId) {\r\n      return row;\r\n    }\r\n\r\n    let rowChanged = false;\r\n    const mutableRow: AnyAttendanceDataRow = { ...row };\r\n\r\n    days.forEach((ctx) => {\r\n      const dayKey = `day_${ctx.dayOfMonth}` as AttendanceDayKey;\r\n      const currentRecord = mutableRow[dayKey] as DailyRecord | undefined;\r\n\r\n      if (mode === 'apply') {\r\n        mutableRow[dayKey] = buildLeaveRecord(leave);\r\n        rowChanged = true;\r\n        return;\r\n      }\r\n\r\n      if (mode === 'clear' && currentRecord && isSameLeaveNote(currentRecord, leave)) {\r\n        mutableRow[dayKey] = buildRevertedRecord(ctx);\r\n        rowChanged = true;\r\n      }\r\n    });\r\n\r\n    if (!rowChanged) {\r\n      return row;\r\n    }\r\n\r\n    didChange = true;\r\n    const summary = recalculateSummary(mutableRow, year, month, settings);\r\n    return { ...mutableRow, ...summary } as AttendanceDataRow;\r\n  });\r\n\r\n  if (didChange) {\r\n    attendanceStore.saveAttendanceData(monthKey, updatedRows);\r\n  }\r\n};\r\n\r\nexport const leaveAttendanceSync = {\r\n  apply(leave: LeaveRequest) {\r\n    const monthMap = collectWorkingDays(leave);\r\n    monthMap.forEach((days, monthKey) => applyUpdatesForMonth(monthKey, days, leave, 'apply'));\r\n  },\r\n  clear(leave: LeaveRequest) {\r\n    const monthMap = collectWorkingDays(leave);\r\n    monthMap.forEach((days, monthKey) => applyUpdatesForMonth(monthKey, days, leave, 'clear'));\r\n  },\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2021, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/leaves/leave-quota-service.ts"],"sourcesContent":["import type { LeaveRequest } from './types';\r\nimport type { LeaveType } from '../settings/employees/types';\r\nimport { useEmployeeStore } from '../employees/store';\r\nimport { useEmployeeSettingsStore } from '../settings/employees/employee-settings-store';\r\nimport { getCurrentDate } from '../../lib/date-utils';\r\n\r\nconst clampNonNegative = (value: number) => (Number.isFinite(value) && value > 0 ? value : 0);\r\n\r\nconst resolveDelta = (leave: LeaveRequest) => {\r\n  const days = Number(leave.numberOfDays) || 0;\r\n  return days > 0 ? days : 0;\r\n};\r\n\r\ntype LeaveTypeMetadata = {\r\n  isPaid: boolean;\r\n  countsTowardsAnnual: boolean;\r\n};\r\n\r\nconst isAnnualLeaveType = (leaveType?: LeaveType | null) => {\r\n  if (!leaveType) return false;\r\n  const normalizedName = leaveType.name?.toLowerCase() ?? '';\r\n  const annualKeywords = ['phép năm', 'phep nam', 'annual'];\r\n  return annualKeywords.some((keyword) => normalizedName.includes(keyword));\r\n};\r\n\r\nconst resolveLeaveTypeMetadata = (leave: LeaveRequest): LeaveTypeMetadata => {\r\n  const settings = useEmployeeSettingsStore.getState().settings;\r\n  const matchedType = settings.leaveTypes.find((type) => {\r\n    if (leave.leaveTypeSystemId && type.systemId === leave.leaveTypeSystemId) return true;\r\n    if (leave.leaveTypeId && type.id === leave.leaveTypeId) return true;\r\n    return false;\r\n  });\r\n\r\n  const isPaid = typeof leave.leaveTypeIsPaid === 'boolean'\r\n    ? leave.leaveTypeIsPaid\r\n    : matchedType?.isPaid ?? true;\r\n\r\n  const countsTowardsAnnual = matchedType\r\n    ? isAnnualLeaveType(matchedType)\r\n    : isPaid;\r\n\r\n  return {\r\n    isPaid,\r\n    countsTowardsAnnual,\r\n  } satisfies LeaveTypeMetadata;\r\n};\r\n\r\nconst getServiceYears = (hireDate?: string) => {\r\n  if (!hireDate) return 0;\r\n  const parsed = new Date(hireDate);\r\n  if (Number.isNaN(parsed.getTime())) return 0;\r\n  const today = getCurrentDate();\r\n  let years = today.getFullYear() - parsed.getFullYear();\r\n  const hasNotReachedAnniversary =\r\n    today.getMonth() < parsed.getMonth() ||\r\n    (today.getMonth() === parsed.getMonth() && today.getDate() < parsed.getDate());\r\n  if (hasNotReachedAnniversary) {\r\n    years -= 1;\r\n  }\r\n  return Math.max(years, 0);\r\n};\r\n\r\nconst computeAnnualQuota = (employeeHireDate?: string) => {\r\n  const { baseAnnualLeaveDays, annualLeaveSeniorityBonus } = useEmployeeSettingsStore.getState().settings;\r\n  const base = baseAnnualLeaveDays ?? 0;\r\n  if (!annualLeaveSeniorityBonus) {\r\n    return clampNonNegative(base);\r\n  }\r\n  const years = getServiceYears(employeeHireDate);\r\n  const bonusInterval = annualLeaveSeniorityBonus.years || 0;\r\n  const bonusValue = annualLeaveSeniorityBonus.additionalDays || 0;\r\n  const bonusMultiplier = bonusInterval > 0 ? Math.floor(years / bonusInterval) : 0;\r\n  const bonus = bonusMultiplier * bonusValue;\r\n  return clampNonNegative(base + bonus);\r\n};\r\n\r\nconst adjustLeaveUsage = (leave: LeaveRequest, delta: number) => {\r\n  if (!delta) return;\r\n  const employeeStore = useEmployeeStore.getState();\r\n  const employee = employeeStore.findById(leave.employeeSystemId);\r\n  if (!employee) return;\r\n\r\n  const { isPaid, countsTowardsAnnual } = resolveLeaveTypeMetadata(leave);\r\n  const totalDelta = delta;\r\n  const paidDelta = isPaid ? delta : 0;\r\n  const unpaidDelta = isPaid ? 0 : delta;\r\n  const annualDelta = countsTowardsAnnual ? delta : 0;\r\n\r\n  const nextLeaveTaken = clampNonNegative((employee.leaveTaken ?? 0) + totalDelta);\r\n  const nextPaid = clampNonNegative((employee.paidLeaveTaken ?? 0) + paidDelta);\r\n  const nextUnpaid = clampNonNegative((employee.unpaidLeaveTaken ?? 0) + unpaidDelta);\r\n  const nextAnnual = clampNonNegative((employee.annualLeaveTaken ?? 0) + annualDelta);\r\n  const quota = computeAnnualQuota(employee.hireDate);\r\n  const nextBalance = clampNonNegative(quota - nextAnnual);\r\n\r\n  const hasChanges =\r\n    nextLeaveTaken !== (employee.leaveTaken ?? 0) ||\r\n    nextPaid !== (employee.paidLeaveTaken ?? 0) ||\r\n    nextUnpaid !== (employee.unpaidLeaveTaken ?? 0) ||\r\n    nextAnnual !== (employee.annualLeaveTaken ?? 0) ||\r\n    nextBalance !== (employee.annualLeaveBalance ?? quota);\r\n\r\n  if (!hasChanges) return;\r\n\r\n  employeeStore.update(leave.employeeSystemId, {\r\n    ...employee,\r\n    leaveTaken: nextLeaveTaken,\r\n    paidLeaveTaken: nextPaid,\r\n    unpaidLeaveTaken: nextUnpaid,\r\n    annualLeaveTaken: nextAnnual,\r\n    annualLeaveBalance: nextBalance,\r\n  });\r\n};\r\n\r\nexport const leaveQuotaSync = {\r\n  apply(leave: LeaveRequest) {\r\n    const delta = resolveDelta(leave);\r\n    if (!delta) return;\r\n    adjustLeaveUsage(leave, delta);\r\n  },\r\n  clear(leave: LeaveRequest) {\r\n    const delta = resolveDelta(leave);\r\n    if (!delta) return;\r\n    adjustLeaveUsage(leave, -delta);\r\n  },\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2128, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/leaves/store.ts"],"sourcesContent":["import { createCrudStore, type CrudState } from '../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { LeaveRequest } from './types';\r\nimport { leaveAttendanceSync } from './leave-sync-service';\r\nimport { leaveQuotaSync } from './leave-quota-service';\r\n\r\nexport type LeaveStoreState = CrudState<LeaveRequest>;\r\n\r\nconst baseStore = createCrudStore<LeaveRequest>([], 'leaves', {\r\n\tbusinessIdField: 'id',\r\n\tapiEndpoint: '/api/leaves',\r\n});\r\n\r\nconst isApproved = (leave?: LeaveRequest | null): leave is LeaveRequest =>\r\n\tBoolean(leave && leave.status === 'Đã duyệt');\r\n\r\nconst snapshotLeave = (leave?: LeaveRequest | null): LeaveRequest | undefined =>\r\n\tleave ? { ...leave } : undefined;\r\n\r\nconst syncApprovedLeave = {\r\n\tapply: (leave: LeaveRequest) => {\r\n\t\tleaveAttendanceSync.apply(leave);\r\n\t\tleaveQuotaSync.apply(leave);\r\n\t},\r\n\tclear: (leave: LeaveRequest) => {\r\n\t\tleaveAttendanceSync.clear(leave);\r\n\t\tleaveQuotaSync.clear(leave);\r\n\t},\r\n};\r\n\r\nconst syncAwareActions: Pick<LeaveStoreState, 'add' | 'update' | 'remove' | 'restore' | 'hardDelete'> = {\r\n\tadd: (payload) => {\r\n\t\tconst created = baseStore.getState().add(payload);\r\n\t\tif (isApproved(created)) {\r\n\t\t\tsyncApprovedLeave.apply(created);\r\n\t\t}\r\n\t\treturn created;\r\n\t},\r\n\tupdate: (systemId, next) => {\r\n\t\tconst store = baseStore.getState();\r\n\t\tconst previous = snapshotLeave(store.findById(systemId));\r\n\t\tstore.update(systemId, next);\r\n\t\tconst updated = snapshotLeave(baseStore.getState().findById(systemId));\r\n\t\tif (isApproved(previous)) {\r\n\t\t\tsyncApprovedLeave.clear(previous);\r\n\t\t}\r\n\t\tif (isApproved(updated)) {\r\n\t\t\tsyncApprovedLeave.apply(updated);\r\n\t\t}\r\n\t},\r\n\tremove: (systemId) => {\r\n\t\tconst store = baseStore.getState();\r\n\t\tconst target = snapshotLeave(store.findById(systemId));\r\n\t\tstore.remove(systemId);\r\n\t\tif (isApproved(target)) {\r\n\t\t\tsyncApprovedLeave.clear(target);\r\n\t\t}\r\n\t},\r\n\trestore: (systemId) => {\r\n\t\tconst store = baseStore.getState();\r\n\t\tstore.restore(systemId);\r\n\t\tconst restored = snapshotLeave(baseStore.getState().findById(systemId));\r\n\t\tif (isApproved(restored)) {\r\n\t\t\tsyncApprovedLeave.apply(restored);\r\n\t\t}\r\n\t},\r\n\thardDelete: (systemId) => {\r\n\t\tconst store = baseStore.getState();\r\n\t\tconst target = snapshotLeave(store.findById(systemId));\r\n\t\tstore.hardDelete(systemId);\r\n\t\tif (isApproved(target)) {\r\n\t\t\tsyncApprovedLeave.clear(target);\r\n\t\t}\r\n\t},\r\n};\r\n\r\nconst withSync = (state: LeaveStoreState): LeaveStoreState => ({\r\n\t...state,\r\n\t...syncAwareActions,\r\n});\r\n\r\nexport const useLeaveStore = () => withSync(baseStore());\r\n\r\nuseLeaveStore.getState = () => withSync(baseStore.getState());\r\n"],"names":[],"mappings":";;;;AAAA;AAGA;AACA;;;;AAIA,MAAM,YAAY,IAAA,0IAAe,EAAe,EAAE,EAAE,UAAU;IAC7D,iBAAiB;IACjB,aAAa;AACd;AAEA,MAAM,aAAa,CAAC,QACnB,QAAQ,SAAS,MAAM,MAAM,KAAK;AAEnC,MAAM,gBAAgB,CAAC,QACtB,QAAQ;QAAE,GAAG,KAAK;IAAC,IAAI;AAExB,MAAM,oBAAoB;IACzB,OAAO,CAAC;QACP,qKAAmB,CAAC,KAAK,CAAC;QAC1B,iKAAc,CAAC,KAAK,CAAC;IACtB;IACA,OAAO,CAAC;QACP,qKAAmB,CAAC,KAAK,CAAC;QAC1B,iKAAc,CAAC,KAAK,CAAC;IACtB;AACD;AAEA,MAAM,mBAAkG;IACvG,KAAK,CAAC;QACL,MAAM,UAAU,UAAU,QAAQ,GAAG,GAAG,CAAC;QACzC,IAAI,WAAW,UAAU;YACxB,kBAAkB,KAAK,CAAC;QACzB;QACA,OAAO;IACR;IACA,QAAQ,CAAC,UAAU;QAClB,MAAM,QAAQ,UAAU,QAAQ;QAChC,MAAM,WAAW,cAAc,MAAM,QAAQ,CAAC;QAC9C,MAAM,MAAM,CAAC,UAAU;QACvB,MAAM,UAAU,cAAc,UAAU,QAAQ,GAAG,QAAQ,CAAC;QAC5D,IAAI,WAAW,WAAW;YACzB,kBAAkB,KAAK,CAAC;QACzB;QACA,IAAI,WAAW,UAAU;YACxB,kBAAkB,KAAK,CAAC;QACzB;IACD;IACA,QAAQ,CAAC;QACR,MAAM,QAAQ,UAAU,QAAQ;QAChC,MAAM,SAAS,cAAc,MAAM,QAAQ,CAAC;QAC5C,MAAM,MAAM,CAAC;QACb,IAAI,WAAW,SAAS;YACvB,kBAAkB,KAAK,CAAC;QACzB;IACD;IACA,SAAS,CAAC;QACT,MAAM,QAAQ,UAAU,QAAQ;QAChC,MAAM,OAAO,CAAC;QACd,MAAM,WAAW,cAAc,UAAU,QAAQ,GAAG,QAAQ,CAAC;QAC7D,IAAI,WAAW,WAAW;YACzB,kBAAkB,KAAK,CAAC;QACzB;IACD;IACA,YAAY,CAAC;QACZ,MAAM,QAAQ,UAAU,QAAQ;QAChC,MAAM,SAAS,cAAc,MAAM,QAAQ,CAAC;QAC5C,MAAM,UAAU,CAAC;QACjB,IAAI,WAAW,SAAS;YACvB,kBAAkB,KAAK,CAAC;QACzB;IACD;AACD;AAEA,MAAM,WAAW,CAAC,QAA4C,CAAC;QAC9D,GAAG,KAAK;QACR,GAAG,gBAAgB;IACpB,CAAC;AAEM,MAAM,gBAAgB,IAAM,SAAS;AAE5C,cAAc,QAAQ,GAAG,IAAM,SAAS,UAAU,QAAQ"}},
    {"offset": {"line": 2211, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/attendance/components/attendance-edit-dialog.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { useForm } from 'react-hook-form';\r\nimport { zodResolver } from '@hookform/resolvers/zod';\r\nimport * as z from 'zod';\r\nimport type { AttendanceDataRow, DailyRecord } from '../types';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from '../../../components/ui/dialog';\r\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '../../../components/ui/form';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../../../components/ui/select';\r\nimport { Textarea } from '../../../components/ui/textarea';\r\nimport { Button } from '../../../components/ui/button';\r\nimport { TimePicker } from '../../../components/ui/time-picker';\r\nimport { CheckCircle2, XCircle, Clock, Calendar } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport type { SystemId } from '../../../lib/id-types';\r\nimport { useLeaveStore } from '../../leaves/store';\r\nimport { formatDate } from '../../../lib/date-utils';\r\nimport { Badge } from '../../../components/ui/badge';\r\nimport type { LeaveRequest } from '../../leaves/types';\r\n\r\ninterface AttendanceEditDialogProps {\r\n    isOpen: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n    recordData: { employeeSystemId: SystemId; day: number; record: DailyRecord } | null;\r\n    onSave: (updatedRecord: DailyRecord) => void;\r\n    monthDate: Date;\r\n}\r\n\r\n// Validation schema\r\nconst formSchema = z.object({\r\n    status: z.enum(['present', 'absent', 'leave', 'half-day', 'weekend', 'holiday', 'future']),\r\n    checkIn: z.string().optional(),\r\n    checkOut: z.string().optional(),\r\n    overtimeCheckIn: z.string().optional(),\r\n    overtimeCheckOut: z.string().optional(),\r\n    notes: z.string().optional(),\r\n}).refine((data) => {\r\n    // Validate checkOut > checkIn\r\n    if (data.checkIn && data.checkOut) {\r\n        const [checkInHour, checkInMin] = data.checkIn.split(':').map(Number);\r\n        const [checkOutHour, checkOutMin] = data.checkOut.split(':').map(Number);\r\n        const checkInMinutes = checkInHour * 60 + checkInMin;\r\n        const checkOutMinutes = checkOutHour * 60 + checkOutMin;\r\n        return checkOutMinutes > checkInMinutes;\r\n    }\r\n    return true;\r\n}, {\r\n    message: \"Giờ ra phải sau giờ vào\",\r\n    path: [\"checkOut\"],\r\n}).refine((data) => {\r\n    // Validate OT checkOut > OT checkIn\r\n    if (data.overtimeCheckIn && data.overtimeCheckOut) {\r\n        const [otInHour, otInMin] = data.overtimeCheckIn.split(':').map(Number);\r\n        const [otOutHour, otOutMin] = data.overtimeCheckOut.split(':').map(Number);\r\n        const otInMinutes = otInHour * 60 + otInMin;\r\n        const otOutMinutes = otOutHour * 60 + otOutMin;\r\n        return otOutMinutes > otInMinutes;\r\n    }\r\n    return true;\r\n}, {\r\n    message: \"Giờ làm thêm ra phải sau giờ làm thêm vào\",\r\n    path: [\"overtimeCheckOut\"],\r\n});\r\n\r\ntype FormValues = z.infer<typeof formSchema>;\r\n\r\nconst isDateWithinRange = (target: Date, start: Date, end: Date) => {\r\n    const normalizedStart = new Date(start.getFullYear(), start.getMonth(), start.getDate());\r\n    const normalizedEnd = new Date(end.getFullYear(), end.getMonth(), end.getDate());\r\n    const normalizedTarget = new Date(target.getFullYear(), target.getMonth(), target.getDate());\r\n    return normalizedTarget >= normalizedStart && normalizedTarget <= normalizedEnd;\r\n};\r\n\r\nexport function AttendanceEditDialog({ isOpen, onOpenChange, recordData, onSave, monthDate }: AttendanceEditDialogProps) {\r\n    const leaveStore = useLeaveStore();\r\n    const leaveRequests = leaveStore?.data ?? [];\r\n    const form = useForm<FormValues>({\r\n        resolver: zodResolver(formSchema),\r\n    });\r\n    const { handleSubmit, control, reset, watch, formState: { errors } } = form;\r\n\r\n    const status = watch('status');\r\n\r\n    const targetDate = React.useMemo(() => {\r\n        if (!recordData) return null;\r\n        return new Date(monthDate.getFullYear(), monthDate.getMonth(), recordData.day);\r\n    }, [recordData, monthDate]);\r\n\r\n    const overlappingLeaves = React.useMemo(() => {\r\n        if (!recordData || !targetDate) return [] as LeaveRequest[];\r\n        return leaveRequests.filter((leave) => {\r\n            if (leave.employeeSystemId !== recordData.employeeSystemId) return false;\r\n            if (leave.status !== 'Đã duyệt') return false;\r\n            const start = new Date(leave.startDate);\r\n            const end = new Date(leave.endDate);\r\n            if (Number.isNaN(start.getTime()) || Number.isNaN(end.getTime())) {\r\n                return false;\r\n            }\r\n            return isDateWithinRange(targetDate, start, end);\r\n        });\r\n    }, [leaveRequests, recordData, targetDate]);\r\n\r\n    const hasApprovedLeave = overlappingLeaves.length > 0;\r\n    const formattedTargetDate = targetDate ? formatDate(targetDate) : '';\r\n\r\n    React.useEffect(() => {\r\n        if (isOpen && recordData) {\r\n            reset(recordData.record);\r\n        }\r\n    }, [isOpen, recordData, reset]);\r\n\r\n    const onSubmit = (data: FormValues) => {\r\n        // Additional validation warnings\r\n        if ((data.status === 'present' || data.status === 'half-day') && (!data.checkIn || !data.checkOut)) {\r\n            toast.error('Cảnh báo', {\r\n                description: 'Nên điền đầy đủ giờ vào/ra cho ngày làm việc',\r\n            });\r\n        }\r\n\r\n        if (data.status === 'leave' && !hasApprovedLeave) {\r\n            toast.error('Không tìm thấy đơn nghỉ', {\r\n                description: 'Vui lòng tạo hoặc duyệt đơn nghỉ phép trước khi đánh dấu nghỉ.',\r\n            });\r\n            return;\r\n        }\r\n\r\n        if (data.status !== 'leave' && hasApprovedLeave) {\r\n            toast.error('Ngày này đã có đơn nghỉ', {\r\n                description: 'Bạn đang ghi đè dữ liệu nghỉ phép đã duyệt.',\r\n            });\r\n        }\r\n        \r\n        onSave(data as DailyRecord);\r\n        onOpenChange(false);\r\n    };\r\n\r\n    const handleClose = () => {\r\n        onOpenChange(false);\r\n    }\r\n    \r\n    if (!recordData) {\r\n        return null;\r\n    }\r\n\r\n    return (\r\n        <Dialog open={isOpen} onOpenChange={onOpenChange}>\r\n            <DialogContent className=\"sm:max-w-[500px]\">\r\n                <DialogHeader>\r\n                    <DialogTitle className=\"flex items-center gap-2\">\r\n                        <Calendar className=\"h-5 w-5\" />\r\n                        Chỉnh sửa chấm công\r\n                    </DialogTitle>\r\n                    <DialogDescription>\r\n                        Cập nhật chi tiết chấm công cho ngày {recordData.day}\r\n                    </DialogDescription>\r\n                </DialogHeader>\r\n                <Form {...form}>\r\n                    <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-4\">\r\n                        <FormField\r\n                            control={control}\r\n                            name=\"status\"\r\n                            render={({ field }) => (\r\n                                <FormItem>\r\n                                    <FormLabel>Trạng thái</FormLabel>\r\n                                    <Select onValueChange={field.onChange} value={field.value}>\r\n                                        <FormControl>\r\n                                            <SelectTrigger className=\"h-9\">\r\n                                                <SelectValue placeholder=\"Chọn trạng thái\" />\r\n                                            </SelectTrigger>\r\n                                        </FormControl>\r\n                                        <SelectContent>\r\n                                            <SelectItem value=\"present\">\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\r\n                                                    Đi làm đủ\r\n                                                </div>\r\n                                            </SelectItem>\r\n                                            <SelectItem value=\"half-day\">\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <Clock className=\"h-4 w-4 text-yellow-600\" />\r\n                                                    Nửa ngày\r\n                                                </div>\r\n                                            </SelectItem>\r\n                                            <SelectItem value=\"leave\">\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <Calendar className=\"h-4 w-4 text-blue-600\" />\r\n                                                    Nghỉ phép\r\n                                                </div>\r\n                                            </SelectItem>\r\n                                            <SelectItem value=\"absent\">\r\n                                                <div className=\"flex items-center gap-2\">\r\n                                                    <XCircle className=\"h-4 w-4 text-red-600\" />\r\n                                                    Vắng\r\n                                                </div>\r\n                                            </SelectItem>\r\n                                        </SelectContent>\r\n                                    </Select>\r\n                                    <FormMessage />\r\n                                </FormItem>\r\n                            )}\r\n                        />\r\n                        {targetDate && (\r\n                            <div className=\"rounded-md border p-3 text-body-xs space-y-2\">\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <span className=\"font-medium\">Ngày {formattedTargetDate}</span>\r\n                                    {hasApprovedLeave ? (\r\n                                        <Badge variant=\"secondary\" className=\"text-emerald-600\">Có {overlappingLeaves.length} đơn đã duyệt</Badge>\r\n                                    ) : (\r\n                                        <Badge variant=\"destructive\">Chưa có đơn nghỉ</Badge>\r\n                                    )}\r\n                                </div>\r\n                                {hasApprovedLeave ? (\r\n                                    <ul className=\"space-y-1\">\r\n                                        {overlappingLeaves.map((leave) => (\r\n                                            <li key={leave.systemId} className=\"flex flex-col rounded bg-muted/60 px-2 py-1\">\r\n                                                <span className=\"text-body-sm font-medium\">{leave.leaveTypeName}</span>\r\n                                                <span className=\"text-muted-foreground text-body-xs\">{formatDate(leave.startDate)} → {formatDate(leave.endDate)} · {leave.id}</span>\r\n                                            </li>\r\n                                        ))}\r\n                                    </ul>\r\n                                ) : (\r\n                                    <p className=\"text-muted-foreground\">Đánh dấu nghỉ sẽ bị chặn khi chưa có đơn được duyệt.</p>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n                        {(status === 'present' || status === 'half-day') && (\r\n                             <div className=\"space-y-4\">\r\n                                <div className=\"grid grid-cols-2 gap-4\">\r\n                                    <FormField control={control} name=\"checkIn\" render={({ field }) => (\r\n                                        <FormItem>\r\n                                            <FormLabel>Giờ vào</FormLabel>\r\n                                            <FormControl><TimePicker {...field} value={field.value ?? \"\"} /></FormControl>\r\n                                            <FormMessage />\r\n                                        </FormItem>\r\n                                    )} />\r\n                                    <FormField control={control} name=\"checkOut\" render={({ field }) => (\r\n                                        <FormItem>\r\n                                            <FormLabel>Giờ ra</FormLabel>\r\n                                            <FormControl><TimePicker {...field} value={field.value ?? \"\"} /></FormControl>\r\n                                            <FormMessage />\r\n                                        </FormItem>\r\n                                    )} />\r\n                                </div>\r\n                                <div className=\"grid grid-cols-2 gap-4\">\r\n                                     <FormField control={control} name=\"overtimeCheckIn\" render={({ field }) => (\r\n                                        <FormItem>\r\n                                            <FormLabel>Tăng ca (Vào)</FormLabel>\r\n                                            <FormControl><TimePicker {...field} value={field.value ?? \"\"} /></FormControl>\r\n                                            <FormMessage />\r\n                                        </FormItem>\r\n                                    )} />\r\n                                     <FormField control={control} name=\"overtimeCheckOut\" render={({ field }) => (\r\n                                        <FormItem>\r\n                                            <FormLabel>Tăng ca (Ra)</FormLabel>\r\n                                            <FormControl><TimePicker {...field} value={field.value ?? \"\"} /></FormControl>\r\n                                            <FormMessage />\r\n                                        </FormItem>\r\n                                    )} />\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                       \r\n                        <FormField\r\n                            control={control}\r\n                            name=\"notes\"\r\n                            render={({ field }) => (\r\n                                <FormItem>\r\n                                    <FormLabel>Ghi chú</FormLabel>\r\n                                    <FormControl>\r\n                                        <Textarea placeholder=\"Thêm ghi chú...\" {...field} value={field.value || ''} />\r\n                                    </FormControl>\r\n                                    <FormMessage />\r\n                                </FormItem>\r\n                            )}\r\n                        />\r\n\r\n                        <DialogFooter className=\"gap-2\">\r\n                            <Button type=\"button\" variant=\"outline\" onClick={handleClose} className=\"h-9\">\r\n                                Hủy\r\n                            </Button>\r\n                            <Button type=\"submit\" className=\"h-9\">\r\n                                <CheckCircle2 className=\"mr-2 h-4 w-4\" />\r\n                                Lưu thay đổi\r\n                            </Button>\r\n                        </DialogFooter>\r\n                    </form>\r\n                </Form>\r\n            </DialogContent>\r\n        </Dialog>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2979, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/attendance/components/attendance-import-dialog.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { formatDate, formatDateTime, formatDateTimeSeconds, formatDateCustom, parseDate, getCurrentDate, getStartOfMonth, getEndOfMonth, toISODate, addMonths, subtractMonths } from '../../../lib/date-utils';\r\nimport * as XLSX from 'xlsx';\r\nimport type { Employee } from '../../employees/types';\r\nimport type { DailyRecord, ImportPreviewRow } from '../types';\r\nimport { excelSerialToTime } from '../utils';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from '../../../components/ui/dialog';\r\nimport { Button } from '../../../components/ui/button';\r\nimport { Upload, FileText, ChevronLeft, ChevronRight, AlertCircle, CheckCircle2, AlertTriangle, Download, MoreHorizontal, Edit, Trash2, Search } from 'lucide-react';\r\nimport { cn } from '../../../lib/utils';\r\nimport { Spinner } from '../../../components/ui/spinner';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '../../../components/ui/table';\r\nimport { ScrollArea, ScrollBar } from '../../../components/ui/scroll-area';\r\nimport { Badge } from '../../../components/ui/badge';\r\nimport { Checkbox } from '../../../components/ui/checkbox';\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from '../../../components/ui/dropdown-menu';\r\nimport { AttendanceEditDialog } from './attendance-edit-dialog';\r\nimport { Input } from '../../../components/ui/input';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../../../components/ui/select';\r\nimport type { SystemId } from '../../../lib/id-types';\r\n\r\nconst PAGE_SIZE_OPTIONS = [10, 20, 50, 100] as const;\r\nconst MonthYearPicker = ({ value, onChange }: { value: Date, onChange: (date: Date) => void }) => {\r\n    return (\r\n        <div className=\"flex items-center gap-2 justify-center\">\r\n            <Button variant=\"outline\" size=\"icon\" className=\"h-8 w-8\" onClick={() => {\r\n                const newDate = subtractMonths(value, 1);\r\n                if (newDate) onChange(newDate);\r\n            }}><ChevronLeft className=\"h-4 w-4\" /></Button>\r\n            <div className=\"font-semibold text-body-sm w-24 text-center\">{formatDateCustom(value, 'MM/yyyy')}</div>\r\n            <Button variant=\"outline\" size=\"icon\" className=\"h-8 w-8\" onClick={() => {\r\n                const newDate = addMonths(value, 1);\r\n                if (newDate) onChange(newDate);\r\n            }}><ChevronRight className=\"h-4 w-4\" /></Button>\r\n        </div>\r\n    );\r\n};\r\n\r\ninterface AttendanceImportDialogProps {\r\n    isOpen: boolean;\r\n    onOpenChange: (open: boolean) => void;\r\n    employees: Employee[];\r\n    onConfirmImport: (\r\n        importedData: Record<SystemId, { day: number; checkIn?: string; morningCheckOut?: string; afternoonCheckIn?: string; checkOut?: string; overtimeCheckIn?: string; overtimeCheckOut?: string }[]>,\r\n        date: Date\r\n    ) => void;\r\n}\r\n\r\nexport function AttendanceImportDialog({ isOpen, onOpenChange, employees, onConfirmImport }: AttendanceImportDialogProps) {\r\n    const [step, setStep] = React.useState<'upload' | 'preview'>('upload');\r\n    const [file, setFile] = React.useState<File | null>(null);\r\n    const [isDragging, setIsDragging] = React.useState(false);\r\n    const fileInputRef = React.useRef<HTMLInputElement>(null);\r\n    const [isLoading, setIsLoading] = React.useState(false);\r\n    const [previewData, setPreviewData] = React.useState<ImportPreviewRow[]>([]);\r\n    const [selectedMonth, setSelectedMonth] = React.useState(getCurrentDate());\r\n    const [error, setError] = React.useState<string | null>(null);\r\n    \r\n    // Summary state\r\n    const [foundEmployeeCount, setFoundEmployeeCount] = React.useState(0);\r\n    const [employeesWithDataCount, setEmployeesWithDataCount] = React.useState(0);\r\n\r\n    // State for preview interactions\r\n    const [rowSelection, setRowSelection] = React.useState<Record<number, boolean>>({}); // index as key\r\n    const [isEditDialogOpen, setIsEditDialogOpen] = React.useState(false);\r\n    const [editingRowIndex, setEditingRowIndex] = React.useState<number | null>(null);\r\n\r\n    // Search and pagination state\r\n    const [searchQuery, setSearchQuery] = React.useState('');\r\n    const [currentPage, setCurrentPage] = React.useState(1);\r\n    const [pageSize, setPageSize] = React.useState<number>(20);\r\n\r\n    React.useEffect(() => {\r\n        if (!isOpen) {\r\n            setStep('upload');\r\n            setFile(null);\r\n            setPreviewData([]);\r\n            setError(null);\r\n            setRowSelection({});\r\n            setEditingRowIndex(null);\r\n            setSearchQuery('');\r\n            setCurrentPage(1);\r\n        }\r\n    }, [isOpen]);\r\n\r\n    const handleFileChange = (selectedFile: File | null) => {\r\n        if (selectedFile) {\r\n            if (selectedFile.type.includes('spreadsheet') || selectedFile.name.endsWith('.xlsx') || selectedFile.name.endsWith('.xls')) {\r\n                setFile(selectedFile);\r\n                setError(null);\r\n            } else {\r\n                setError(\"Định dạng file không hợp lệ. Vui lòng chọn file Excel.\");\r\n            }\r\n        }\r\n    };\r\n    \r\n    const handleDownloadTemplate = () => {\r\n        const wb = XLSX.utils.book_new();\r\n        const year = selectedMonth.getFullYear();\r\n        const month = selectedMonth.getMonth() + 1;\r\n        const daysInMonth = (new Date(year, month, 0).getDate());\r\n        const startDate = toISODate(getStartOfMonth(selectedMonth));\r\n        const endDate = toISODate(getEndOfMonth(selectedMonth));\r\n    \r\n        const employeeChunks: Employee[][] = [];\r\n        for (let i = 0; i < employees.length; i += 3) {\r\n            employeeChunks.push(employees.slice(i, i + 3));\r\n        }\r\n    \r\n        employeeChunks.forEach((chunk, chunkIndex) => {\r\n            const ws_data: any[][] = [];\r\n            const merges: XLSX.Range[] = [];\r\n            \r\n            // General Headers - Row 0: Title\r\n            ws_data[0] = [];\r\n            ws_data[0][11] = 'Bảng nhật ký chấm công';\r\n            \r\n            // Row 1: Date info\r\n            ws_data[1] = [];\r\n            ws_data[1][33] = `Chấm công từ:${startDate}~${endDate}`;\r\n            \r\n            // Row 2: Created date\r\n            ws_data[2] = [];\r\n            ws_data[2][33] = `Ngày tạo:${formatDateCustom(new Date(), 'yyyy-MM-dd HH:mm:ss')}`;\r\n    \r\n            chunk.forEach((emp, empIndex) => {\r\n                // Machine format: 15 cols per employee\r\n                const startCol = empIndex * 15;\r\n                \r\n                // Row 3: Employee name info\r\n                ws_data[3] = ws_data[3] || [];\r\n                ws_data[3][startCol + 0] = 'Phòng ban';\r\n                ws_data[3][startCol + 1] = 'CÔNG TY';\r\n                merges.push({ s: { r: 3, c: startCol + 1 }, e: { r: 3, c: startCol + 7 } });\r\n                ws_data[3][startCol + 8] = 'Họ tên';\r\n                ws_data[3][startCol + 9] = emp.fullName;\r\n                merges.push({ s: { r: 3, c: startCol + 9 }, e: { r: 3, c: startCol + 14 } });\r\n                \r\n                // Row 4: Date range & Employee ID\r\n                ws_data[4] = ws_data[4] || [];\r\n                ws_data[4][startCol + 0] = 'Ngày';\r\n                ws_data[4][startCol + 1] = `${startDate}~${endDate}`;\r\n                merges.push({ s: { r: 4, c: startCol + 1 }, e: { r: 4, c: startCol + 7 } });\r\n                ws_data[4][startCol + 8] = 'Mã';\r\n                ws_data[4][startCol + 9] = emp.id;\r\n                \r\n                // Row 5-6: Summary headers (Nghỉ không phép, Nghỉ phép, Công tác, Đi làm, Tăng ca, Đến muộn, Về sớm)\r\n                ws_data[5] = ws_data[5] || [];\r\n                ws_data[5][startCol + 0] = 'Nghỉ không\\nphép (ngày)';\r\n                ws_data[5][startCol + 1] = 'Nghỉ\\nphép\\n(ngày)';\r\n                ws_data[5][startCol + 2] = 'Công tác\\n(ngày)';\r\n                ws_data[5][startCol + 4] = 'Đi làm\\n(ngày)';\r\n                ws_data[5][startCol + 5] = 'Tăng ca (tiếng)';\r\n                merges.push({ s: { r: 5, c: startCol + 5 }, e: { r: 5, c: startCol + 7 } });\r\n                ws_data[5][startCol + 8] = 'Đến muộn';\r\n                merges.push({ s: { r: 5, c: startCol + 8 }, e: { r: 5, c: startCol + 10 } });\r\n                ws_data[5][startCol + 11] = 'Về sớm';\r\n                merges.push({ s: { r: 5, c: startCol + 11 }, e: { r: 5, c: startCol + 13 } });\r\n                \r\n                ws_data[6] = ws_data[6] || [];\r\n                ws_data[6][startCol + 5] = 'Bình\\nthường';\r\n                ws_data[6][startCol + 7] = 'Đặc\\nbiệt';\r\n                ws_data[6][startCol + 8] = '(Lần)';\r\n                ws_data[6][startCol + 9] = '(Phút)';\r\n                ws_data[6][startCol + 11] = '(Lần)';\r\n                ws_data[6][startCol + 13] = '(Phút)';\r\n                \r\n                // Row 7: Summary data (empty for template)\r\n                ws_data[7] = ws_data[7] || [];\r\n                \r\n                // Row 9: \"Bảng chấm công\" header\r\n                ws_data[9] = ws_data[9] || [];\r\n                ws_data[9][startCol + 0] = 'Bảng chấm công';\r\n                merges.push({ s: { r: 9, c: startCol + 0 }, e: { r: 9, c: startCol + 14 } });\r\n                \r\n                // Row 10: Main headers (Ngày Thứ, Sáng, Chiều, Tăng ca)\r\n                ws_data[10] = ws_data[10] || [];\r\n                ws_data[10][startCol + 0] = 'Ngày Thứ';\r\n                merges.push({ s: { r: 10, c: startCol + 0 }, e: { r: 11, c: startCol + 0 } });\r\n                ws_data[10][startCol + 1] = 'Sáng';\r\n                merges.push({ s: { r: 10, c: startCol + 1 }, e: { r: 10, c: startCol + 5 } });\r\n                ws_data[10][startCol + 6] = 'Chiều';\r\n                merges.push({ s: { r: 10, c: startCol + 6 }, e: { r: 10, c: startCol + 9 } });\r\n                ws_data[10][startCol + 10] = 'Tăng ca';\r\n                merges.push({ s: { r: 10, c: startCol + 10 }, e: { r: 10, c: startCol + 14 } });\r\n                \r\n                // Row 11: Sub headers\r\n                ws_data[11] = ws_data[11] || [];\r\n                ws_data[11][startCol + 1] = 'Làm việc';\r\n                merges.push({ s: { r: 11, c: startCol + 1 }, e: { r: 11, c: startCol + 2 } });\r\n                ws_data[11][startCol + 3] = 'Tan làm';\r\n                merges.push({ s: { r: 11, c: startCol + 3 }, e: { r: 11, c: startCol + 5 } });\r\n                ws_data[11][startCol + 6] = 'Làm việc';\r\n                merges.push({ s: { r: 11, c: startCol + 6 }, e: { r: 11, c: startCol + 7 } });\r\n                ws_data[11][startCol + 8] = 'Tan làm';\r\n                merges.push({ s: { r: 11, c: startCol + 8 }, e: { r: 11, c: startCol + 9 } });\r\n                ws_data[11][startCol + 10] = 'Đánh dấu\\nđến';\r\n                merges.push({ s: { r: 11, c: startCol + 10 }, e: { r: 11, c: startCol + 11 } });\r\n                ws_data[11][startCol + 12] = 'Đánh dấu\\nvề';\r\n                merges.push({ s: { r: 11, c: startCol + 12 }, e: { r: 11, c: startCol + 14 } });\r\n                \r\n                // Data Rows - start from row 12\r\n                for (let day = 1; day <= daysInMonth; day++) {\r\n                    const rowIndex = 11 + day;\r\n                    const dataRow = ws_data[rowIndex] = ws_data[rowIndex] || [];\r\n                    const date = new Date(year, month - 1, day);\r\n                    const dayOfWeek = date.getDay();\r\n                    const dayNames = ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'];\r\n                    dataRow[startCol + 0] = `${String(day).padStart(2, '0')} ${dayNames[dayOfWeek]}`;\r\n                }\r\n            });\r\n            \r\n            const ws = XLSX.utils.aoa_to_sheet(ws_data);\r\n            ws['!merges'] = merges;\r\n            XLSX.utils.book_append_sheet(wb, ws, chunkIndex === 0 ? '1,2,3' : `${chunkIndex * 3 + 1},${chunkIndex * 3 + 2},${chunkIndex * 3 + 3}`);\r\n        });\r\n\r\n        XLSX.writeFile(wb, `Mau_cham_cong_thang_${month}-${year}.xlsx`);\r\n    };\r\n\r\n    const handleProcessFile = () => {\r\n        if (!file) { setError(\"Vui lòng chọn một file.\"); return; }\r\n        setIsLoading(true);\r\n        setError(null);\r\n        const reader = new FileReader();\r\n        reader.onload = (e) => {\r\n            try {\r\n                const data = e.target?.result;\r\n                const workbook = XLSX.read(data, { type: 'binary', cellDates: true });\r\n                let fileDate: Date | null = null;\r\n\r\n                // Find date from the first sheet - support both formats\r\n                const firstWs = workbook.Sheets[workbook.SheetNames[0]];\r\n                const firstJsonData: any[][] = XLSX.utils.sheet_to_json(firstWs, { header: 1, defval: null });\r\n                for (let i = 0; i < 5 && i < firstJsonData.length; i++) {\r\n                    const row = firstJsonData[i];\r\n                    if (!row) continue;\r\n                    // Format 1: \"Chấm công từ:YYYY-MM-DD~YYYY-MM-DD\" (template chuẩn)\r\n                    // Format 2: \"Ngày thống kê:YYYY-MM-DD~YYYY-MM-DD\" (file máy chấm công)\r\n                    const dateCell = row.find(cell => \r\n                        typeof cell === 'string' && \r\n                        (cell.startsWith('Chấm công từ:') || cell.startsWith('Ngày thống kê:'))\r\n                    );\r\n                    if (dateCell) {\r\n                        const dateMatch = dateCell.match(/(\\d{4}-\\d{2}-\\d{2})/);\r\n                        if (dateMatch) {\r\n                            fileDate = parseDate(dateMatch[1]);\r\n                            if (fileDate) setSelectedMonth(fileDate);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                if (!fileDate) throw new Error('Không tìm thấy định dạng ngày \"Chấm công từ:\" hoặc \"Ngày thống kê:\" trong file.');\r\n\r\n                const newPreviewData: ImportPreviewRow[] = [];\r\n                const foundEmployeeSystemIds = new Set<SystemId>();\r\n                const employeeSystemIdsWithData = new Set<SystemId>();\r\n                \r\n                // Detect file format: check if sheet names are like \"1,2,3\" (máy chấm công) or \"Sheet 1\" (template)\r\n                const isMachineFormat = workbook.SheetNames.some(name => /^\\d+,\\d+/.test(name));\r\n                \r\n                // Skip summary sheets for machine format\r\n                const sheetsToProcess = isMachineFormat \r\n                    ? workbook.SheetNames.filter(name => /^\\d+,\\d+/.test(name))\r\n                    : workbook.SheetNames;\r\n                \r\n                for (const sheetName of sheetsToProcess) {\r\n                    const ws = workbook.Sheets[sheetName];\r\n                    const jsonData: any[][] = XLSX.utils.sheet_to_json(ws, { header: 1, defval: null });\r\n                    \r\n                    // Process 3 employees horizontally\r\n                    // Both formats now use 15 cols/employee\r\n                    const colsPerEmployee = 15;\r\n                    \r\n                    for (let empIndex = 0; empIndex < 3; empIndex++) {\r\n                        const startCol = empIndex * colsPerEmployee;\r\n                        \r\n                        // Get employee ID and Name based on format\r\n                        // Machine format: \r\n                        //   - Row 3 (index 3): \"Họ tên\" at startCol + 9\r\n                        //   - Row 4 (index 4): \"Mã\" at startCol + 9\r\n                        // Template format:\r\n                        //   - Row 4 (index 4): \"Họ tên\" at startCol + 6, \"Mã NV\" at startCol + 10\r\n                        \r\n                        let employeeIdRaw: any;\r\n                        let employeeNameRaw: any;\r\n                        \r\n                        if (isMachineFormat) {\r\n                            const nameRow = jsonData[3] || [];\r\n                            const idRow = jsonData[4] || [];\r\n                            employeeNameRaw = nameRow[startCol + 9];\r\n                            employeeIdRaw = idRow[startCol + 9];\r\n                        } else {\r\n                            // Template format: same positions as machine format\r\n                            const nameRow = jsonData[3] || [];\r\n                            const idRow = jsonData[4] || [];\r\n                            employeeNameRaw = nameRow[startCol + 9];\r\n                            employeeIdRaw = idRow[startCol + 9];\r\n                        }\r\n                        \r\n                        if (!employeeIdRaw && !employeeNameRaw) continue;\r\n\r\n                        // Find employee: Match by EXACT ID only (primary key)\r\n                        // Không tự động convert \"7\" → \"NV000007\", phải khớp chính xác\r\n                        let employee: Employee | undefined;\r\n                        \r\n                        // 1. Try matching by exact ID only\r\n                        if (employeeIdRaw) {\r\n                            const rawIdStr = String(employeeIdRaw).trim();\r\n                            \r\n                            // Exact match only - \"7\" must match \"7\", \"NV000007\" must match \"NV000007\"\r\n                            employee = employees.find(e => String(e.id).trim() === rawIdStr);\r\n                        }\r\n                        \r\n                        // 2. Fallback: Try matching by exact name only (no partial match)\r\n                        if (!employee && employeeNameRaw) {\r\n                            const normalizedName = String(employeeNameRaw).toLowerCase().trim();\r\n                            employee = employees.find(e => \r\n                                e.fullName.toLowerCase().trim() === normalizedName\r\n                            );\r\n                        }\r\n                        \r\n                        if (!employee) {\r\n                             const displayId = employeeIdRaw ? `Mã: ${employeeIdRaw}` : '';\r\n                             const displayName = employeeNameRaw ? `Tên: ${employeeNameRaw}` : '';\r\n                             newPreviewData.push({ \r\n                                 excelRow: 5, \r\n                                 sheetName, \r\n                                 day: 0, \r\n                                 status: 'warning', \r\n                                 message: `Không tìm thấy nhân viên trong hệ thống (${[displayId, displayName].filter(Boolean).join(', ')})`, \r\n                                 rawData: jsonData[4] || [] \r\n                             });\r\n                             continue;\r\n                        }\r\n\r\n                        foundEmployeeSystemIds.add(employee.systemId);\r\n                        let hasDataForEmployee = false;\r\n                        \r\n                        // Data starts from row 12 for both formats now\r\n                        const tableStartRow = 12;\r\n                        const daysInMonth = new Date(fileDate.getFullYear(), fileDate.getMonth() + 1, 0).getDate();\r\n                        \r\n                        for (let i = 0; i < daysInMonth; i++) {\r\n                            const rowIdx = tableStartRow + i;\r\n                            if (rowIdx >= jsonData.length || !jsonData[rowIdx]) continue;\r\n                            const dataRow = jsonData[rowIdx];\r\n                            \r\n                            // Day string is at startCol + 0 for both formats\r\n                            const dayStrCell = dataRow[startCol + 0];\r\n                            if (!dayStrCell || typeof dayStrCell !== 'string') continue;\r\n                            \r\n                            const day = parseInt(dayStrCell.substring(0, 2), 10);\r\n                            if (isNaN(day)) continue;\r\n\r\n                            let checkIn: string | undefined;\r\n                            let morningCheckOut: string | undefined;\r\n                            let afternoonCheckIn: string | undefined;\r\n                            let checkOut: string | undefined;\r\n                            let overtimeCheckIn: string | undefined;\r\n                            let overtimeCheckOut: string | undefined;\r\n                            \r\n                            if (isMachineFormat) {\r\n                                // Machine format columns (15 cols per employee):\r\n                                // startCol + 0: Ngày Thứ\r\n                                // startCol + 1: Sáng Làm việc (check-in sáng)\r\n                                // startCol + 3: Sáng Tan làm (check-out sáng)\r\n                                // startCol + 6: Chiều Làm việc (check-in chiều)\r\n                                // startCol + 8: Chiều Tan làm (check-out cuối ngày)\r\n                                // startCol + 10: Tăng ca Đánh dấu đến\r\n                                // startCol + 12: Tăng ca Đánh dấu về\r\n                                checkIn = excelSerialToTime(dataRow[startCol + 1]);\r\n                                morningCheckOut = excelSerialToTime(dataRow[startCol + 3]);\r\n                                afternoonCheckIn = excelSerialToTime(dataRow[startCol + 6]);\r\n                                checkOut = excelSerialToTime(dataRow[startCol + 8]);\r\n                                overtimeCheckIn = excelSerialToTime(dataRow[startCol + 10]);\r\n                                overtimeCheckOut = excelSerialToTime(dataRow[startCol + 12]);\r\n                            } else {\r\n                                // Template format: same column positions as machine format (15 cols per employee)\r\n                                checkIn = excelSerialToTime(dataRow[startCol + 1]);\r\n                                morningCheckOut = excelSerialToTime(dataRow[startCol + 3]);\r\n                                afternoonCheckIn = excelSerialToTime(dataRow[startCol + 6]);\r\n                                checkOut = excelSerialToTime(dataRow[startCol + 8]);\r\n                                overtimeCheckIn = excelSerialToTime(dataRow[startCol + 10]);\r\n                                overtimeCheckOut = excelSerialToTime(dataRow[startCol + 12]);\r\n                            }\r\n\r\n                            if (checkIn || morningCheckOut || afternoonCheckIn || checkOut || overtimeCheckIn || overtimeCheckOut) {\r\n                                hasDataForEmployee = true;\r\n                                newPreviewData.push({\r\n                                    excelRow: rowIdx + 1, sheetName,\r\n                                    employeeSystemId: employee.systemId,\r\n                                    employeeId: employee.id,\r\n                                    employeeName: employee.fullName,\r\n                                    day, checkIn, morningCheckOut, afternoonCheckIn, checkOut, overtimeCheckIn, overtimeCheckOut,\r\n                                    status: 'ok', message: 'Hợp lệ', rawData: dataRow,\r\n                                });\r\n                            }\r\n                        }\r\n                        if(hasDataForEmployee) {\r\n                            employeeSystemIdsWithData.add(employee.systemId);\r\n                        }\r\n                    }\r\n                }\r\n                setFoundEmployeeCount(foundEmployeeSystemIds.size);\r\n                setEmployeesWithDataCount(employeeSystemIdsWithData.size);\r\n                setPreviewData(newPreviewData);\r\n                setStep('preview');\r\n            } catch (err: any) {\r\n                setError(err.message || \"Lỗi khi đọc file. Vui lòng kiểm tra lại cấu trúc file.\");\r\n            } finally {\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n        reader.readAsBinaryString(file);\r\n    };\r\n    \r\n    const handleConfirm = () => {\r\n        const validData = previewData.filter(row => row.status === 'ok' && row.employeeSystemId);\r\n        const groupedData: Record<SystemId, { day: number; checkIn?: string; morningCheckOut?: string; afternoonCheckIn?: string; checkOut?: string; overtimeCheckIn?: string; overtimeCheckOut?: string }[]> = {};\r\n        \r\n        validData.forEach(row => {\r\n            const key = row.employeeSystemId!;\r\n            if (!groupedData[key]) groupedData[key] = [];\r\n            \r\n            const entry: { day: number; checkIn?: string; morningCheckOut?: string; afternoonCheckIn?: string; checkOut?: string; overtimeCheckIn?: string; overtimeCheckOut?: string } = {\r\n                day: row.day\r\n            };\r\n            if (row.checkIn) entry.checkIn = row.checkIn;\r\n            if (row.morningCheckOut) entry.morningCheckOut = row.morningCheckOut;\r\n            if (row.afternoonCheckIn) entry.afternoonCheckIn = row.afternoonCheckIn;\r\n            if (row.checkOut) entry.checkOut = row.checkOut;\r\n            if (row.overtimeCheckIn) entry.overtimeCheckIn = row.overtimeCheckIn;\r\n            if (row.overtimeCheckOut) entry.overtimeCheckOut = row.overtimeCheckOut;\r\n            \r\n            groupedData[key].push(entry);\r\n        });\r\n\r\n        onConfirmImport(groupedData, selectedMonth);\r\n        onOpenChange(false);\r\n    };\r\n\r\n    const summary = React.useMemo(() => {\r\n        const okRows = previewData.filter(r => r.status === 'ok');\r\n        const uniqueOkEntries = new Set(okRows.map(r => `${r.employeeSystemId}-${r.day}`)).size;\r\n        const errorCount = previewData.filter(r => r.status === 'error' || r.status === 'warning').length;\r\n        return { okCount: uniqueOkEntries, errorCount };\r\n    }, [previewData]);\r\n\r\n    // Filtered data based on search query\r\n    const filteredData = React.useMemo(() => {\r\n        if (!searchQuery.trim()) return previewData;\r\n        const query = searchQuery.toLowerCase().trim();\r\n        return previewData.filter(row => \r\n            row.employeeName?.toLowerCase().includes(query) ||\r\n            row.employeeId?.toLowerCase().includes(query) ||\r\n            String(row.day).includes(query) ||\r\n            row.message?.toLowerCase().includes(query)\r\n        );\r\n    }, [previewData, searchQuery]);\r\n\r\n    // Paginated data\r\n    const paginatedData = React.useMemo(() => {\r\n        const start = (currentPage - 1) * pageSize;\r\n        return filteredData.slice(start, start + pageSize);\r\n    }, [filteredData, currentPage, pageSize]);\r\n\r\n    const totalPages = Math.ceil(filteredData.length / pageSize);\r\n\r\n    // Reset page when search changes\r\n    React.useEffect(() => {\r\n        setCurrentPage(1);\r\n    }, [searchQuery]);\r\n\r\n    const statusIcons = {\r\n        ok: <CheckCircle2 className=\"h-4 w-4 text-green-500\" />,\r\n        warning: <AlertTriangle className=\"h-4 w-4 text-yellow-500\" />,\r\n        error: <AlertCircle className=\"h-4 w-4 text-red-500\" />,\r\n    };\r\n\r\n    // Handlers for preview interactions\r\n    const handleEdit = (index: number) => {\r\n        const row = previewData[index];\r\n        if (!row?.employeeSystemId) {\r\n            return;\r\n        }\r\n        setEditingRowIndex(index);\r\n        setIsEditDialogOpen(true);\r\n    };\r\n    \r\n    const handleDelete = (index: number) => {\r\n        setPreviewData(prev => prev.filter((_, i) => i !== index));\r\n    };\r\n\r\n    const handleBulkDelete = () => {\r\n        const selectedIndices = Object.keys(rowSelection).map(Number);\r\n        setPreviewData(prev => prev.filter((_, i) => !selectedIndices.includes(i)));\r\n        setRowSelection({});\r\n    };\r\n\r\n    const handleSaveEdit = (updatedRecord: DailyRecord) => {\r\n        if (editingRowIndex === null) return;\r\n    \r\n        setPreviewData((prev: ImportPreviewRow[]) => prev.map((row, index) => {\r\n            if (index === editingRowIndex) {\r\n                const hasTimeData = updatedRecord.checkIn || updatedRecord.morningCheckOut || updatedRecord.afternoonCheckIn || updatedRecord.checkOut || updatedRecord.overtimeCheckIn || updatedRecord.overtimeCheckOut;\r\n                return {\r\n                    ...row,\r\n                    checkIn: updatedRecord.checkIn || undefined,\r\n                    morningCheckOut: updatedRecord.morningCheckOut || undefined,\r\n                    afternoonCheckIn: updatedRecord.afternoonCheckIn || undefined,\r\n                    checkOut: updatedRecord.checkOut || undefined,\r\n                    overtimeCheckIn: updatedRecord.overtimeCheckIn || undefined,\r\n                    overtimeCheckOut: updatedRecord.overtimeCheckOut || undefined,\r\n                    status: hasTimeData ? 'ok' : 'warning',\r\n                    message: hasTimeData ? 'Đã chỉnh sửa' : 'Không có giờ chấm công'\r\n                };\r\n            }\r\n            return row;\r\n        }));\r\n    \r\n        setIsEditDialogOpen(false);\r\n        setEditingRowIndex(null);\r\n    };\r\n\r\n    const editingRecordData = React.useMemo(() => {\r\n        if (editingRowIndex === null) return null;\r\n        const row = previewData[editingRowIndex];\r\n        if (!row?.employeeSystemId) {\r\n            return null;\r\n        }\r\n        return {\r\n            employeeSystemId: row.employeeSystemId,\r\n            day: row.day,\r\n            record: {\r\n                status: ((row.checkIn || row.checkOut) ? 'present' : 'absent') as 'present' | 'absent',\r\n                checkIn: row.checkIn,\r\n                morningCheckOut: row.morningCheckOut,\r\n                afternoonCheckIn: row.afternoonCheckIn,\r\n                checkOut: row.checkOut,\r\n                overtimeCheckIn: row.overtimeCheckIn,\r\n                overtimeCheckOut: row.overtimeCheckOut,\r\n                notes: row.status === 'ok' ? '' : row.message,\r\n            }\r\n        };\r\n    }, [editingRowIndex, previewData]);\r\n    \r\n    const numSelected = Object.keys(rowSelection).length;\r\n    const isAllSelected = previewData.length > 0 && numSelected === previewData.length;\r\n    const isSomeSelected = numSelected > 0 && numSelected < previewData.length;\r\n    \r\n    const toggleAll = (checked: boolean) => {\r\n        if (checked) {\r\n            const newSelection: Record<number, boolean> = {};\r\n            previewData.forEach((_, index) => { newSelection[index] = true; });\r\n            setRowSelection(newSelection);\r\n        } else {\r\n            setRowSelection({});\r\n        }\r\n    };\r\n    \r\n    const toggleRow = (index: number) => {\r\n        setRowSelection(prev => {\r\n            const newSelection = { ...prev };\r\n            if (newSelection[index]) {\r\n                delete newSelection[index];\r\n            } else {\r\n                newSelection[index] = true;\r\n            }\r\n            return newSelection;\r\n        });\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <Dialog open={isOpen} onOpenChange={onOpenChange}>\r\n                <DialogContent className=\"sm:max-w-3xl max-h-[80vh] flex flex-col p-0\">\r\n                    <DialogHeader className=\"px-4 pt-4 pb-2\">\r\n                        <DialogTitle className=\"text-base\">Nhập file chấm công</DialogTitle>\r\n                        {step === 'upload' && (\r\n                            <>\r\n                                <DialogDescription className=\"text-xs\">Chọn tháng và tải lên file Excel để cập nhật chấm công hàng loạt.</DialogDescription>\r\n                                <div className=\"text-xs text-muted-foreground pt-1\">\r\n                                    Bạn chưa có file?  \r\n                                    <Button variant=\"link\" type=\"button\" className=\"p-0 h-auto px-1 text-xs\" onClick={handleDownloadTemplate}>\r\n                                        <Download className=\"mr-1 h-3 w-3\" />\r\n                                        Tải file mẫu tại đây\r\n                                    </Button>.\r\n                                </div>\r\n                            </>\r\n                        )}\r\n                        {step === 'preview' && \r\n                        <DialogDescription className=\"text-xs\">\r\n                            Đã tìm thấy {foundEmployeeCount} nhân viên trong file. {employeesWithDataCount > 0 ? `Xem trước dữ liệu cho ${employeesWithDataCount} nhân viên.` : 'Không có nhân viên nào có dữ liệu chấm công.'} Các dòng lỗi sẽ không được nhập. Nhấn \"Xác nhận\" để hoàn tất.\r\n                        </DialogDescription>}\r\n                    </DialogHeader>\r\n                    \r\n                    {step === 'upload' && (\r\n                        <div className=\"flex-grow flex flex-col justify-center items-center gap-4 px-4 py-6\">\r\n                            <MonthYearPicker value={selectedMonth} onChange={setSelectedMonth} />\r\n                            <div \r\n                                className={cn(\r\n                                    \"flex flex-col items-center justify-center w-full max-w-md h-36 border-2 border-dashed rounded-lg cursor-pointer bg-muted/50 hover:bg-muted/75 transition-colors\",\r\n                                    isDragging && \"border-primary bg-primary/10\"\r\n                                )}\r\n                                onClick={() => fileInputRef.current?.click()}\r\n                                onDragEnter={(e) => { e.preventDefault(); setIsDragging(true); }}\r\n                                onDragLeave={(e) => { e.preventDefault(); setIsDragging(false); }}\r\n                                onDragOver={(e) => e.preventDefault()}\r\n                                onDrop={(e) => { e.preventDefault(); setIsDragging(false); handleFileChange(e.dataTransfer.files?.[0] || null); }}\r\n                            >\r\n                                {file ? (\r\n                                    <div className=\"text-center\">\r\n                                        <FileText className=\"mx-auto h-8 w-8 text-primary\" />\r\n                                        <p className=\"mt-1.5 text-sm font-medium\">{file.name}</p>\r\n                                        <p className=\"text-xs text-muted-foreground\">({(file.size / 1024).toFixed(2)} KB)</p>\r\n                                    </div>\r\n                                ) : (\r\n                                    <div className=\"text-center text-muted-foreground p-4\">\r\n                                        <Upload className=\"mx-auto h-8 w-8\" />\r\n                                        <p className=\"mt-1.5 text-sm\">Kéo thả file vào đây hoặc nhấn để chọn file</p>\r\n                                        <p className=\"text-xs mt-1\">Định dạng hỗ trợ: .xlsx, .xls</p>\r\n                                    </div>\r\n                                )}\r\n                                <input type=\"file\" ref={fileInputRef} className=\"hidden\" accept=\".xlsx, .xls\" onChange={(e) => handleFileChange(e.target.files?.[0] || null)} />\r\n                            </div>\r\n                            {error && <p className=\"text-xs text-destructive\">{error}</p>}\r\n                        </div>\r\n                    )}\r\n\r\n                    {step === 'preview' && (\r\n                        <div className=\"flex-grow flex flex-col min-h-0 px-4\">\r\n                            {/* Header with title and summary */}\r\n                            <div className=\"flex-shrink-0 flex justify-between items-center mb-2\">\r\n                                <h3 className=\"text-sm font-semibold\">Xem trước dữ liệu cho tháng {formatDateCustom(selectedMonth, 'MM/yyyy')}</h3>\r\n                                <div className=\"flex items-center gap-3 text-xs\">\r\n                                    {numSelected > 0 && (\r\n                                        <Button variant=\"destructive\" size=\"sm\" className=\"h-7 text-xs\" onClick={handleBulkDelete}>\r\n                                            <Trash2 className=\"mr-1.5 h-3 w-3\" />Xóa {numSelected} mục\r\n                                        </Button>\r\n                                    )}\r\n                                    <span className=\"flex items-center gap-1\">\r\n                                        <CheckCircle2 className=\"h-3.5 w-3.5 text-green-500\" /> {summary.okCount} Hợp lệ\r\n                                    </span>\r\n                                    <span className=\"flex items-center gap-1\">\r\n                                        <AlertCircle className=\"h-3.5 w-3.5 text-red-500\" /> {summary.errorCount} Lỗi/Cảnh báo\r\n                                    </span>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Search bar */}\r\n                            <div className=\"flex-shrink-0 flex items-center gap-2 mb-2\">\r\n                                <div className=\"relative flex-1 max-w-xs\">\r\n                                    <Search className=\"absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground\" />\r\n                                    <Input\r\n                                        placeholder=\"Tìm theo tên, mã NV, ngày...\"\r\n                                        value={searchQuery}\r\n                                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                                        className=\"pl-8 h-8 text-xs\"\r\n                                    />\r\n                                </div>\r\n                                <span className=\"text-xs text-muted-foreground\">\r\n                                    {filteredData.length} dòng {searchQuery && `(lọc từ ${previewData.length})`}\r\n                                </span>\r\n                            </div>\r\n\r\n                            {/* Table with horizontal and vertical scroll */}\r\n                            <ScrollArea className=\"flex-grow border rounded-md h-[350px]\">\r\n                                <div className=\"min-w-[800px]\">\r\n                                    <Table>\r\n                                        <TableHeader className=\"sticky top-0 bg-muted z-10\">\r\n                                            <TableRow className=\"hover:bg-muted\">\r\n                                                <TableHead className=\"w-10 text-center p-2\">\r\n                                                    <Checkbox \r\n                                                        checked={isAllSelected ? true : isSomeSelected ? \"indeterminate\" : false} \r\n                                                        onCheckedChange={(checked) => toggleAll(!!checked)} \r\n                                                        className=\"h-3.5 w-3.5\"\r\n                                                    />\r\n                                                </TableHead>\r\n                                                <TableHead className=\"w-16 p-2 text-xs\">Trạng thái</TableHead>\r\n                                                <TableHead className=\"p-2 text-xs min-w-[120px]\">Nhân viên</TableHead>\r\n                                                <TableHead className=\"w-14 p-2 text-xs text-center\">Ngày</TableHead>\r\n                                                <TableHead className=\"w-16 p-2 text-xs text-center\">Sáng vào</TableHead>\r\n                                                <TableHead className=\"w-16 p-2 text-xs text-center\">Sáng ra</TableHead>\r\n                                                <TableHead className=\"w-16 p-2 text-xs text-center\">Chiều vào</TableHead>\r\n                                                <TableHead className=\"w-16 p-2 text-xs text-center\">Chiều ra</TableHead>\r\n                                                <TableHead className=\"w-16 p-2 text-xs text-center\">TC vào</TableHead>\r\n                                                <TableHead className=\"w-16 p-2 text-xs text-center\">TC ra</TableHead>\r\n                                                <TableHead className=\"p-2 text-xs min-w-[100px]\">Ghi chú</TableHead>\r\n                                                <TableHead className=\"w-16 p-2 text-xs text-right\">Hành động</TableHead>\r\n                                            </TableRow>\r\n                                        </TableHeader>\r\n                                        <TableBody>\r\n                                            {paginatedData.map((row) => {\r\n                                                // Find original index in previewData for selection\r\n                                                const originalIndex = previewData.findIndex(r => r === row);\r\n                                                return (\r\n                                                    <TableRow \r\n                                                        key={`${row.excelRow}-${row.sheetName}-${originalIndex}`} \r\n                                                        className={cn(\r\n                                                            \"hover:bg-muted/50\",\r\n                                                            row.status === 'error' && 'bg-red-50',\r\n                                                            row.status === 'warning' && 'bg-yellow-50'\r\n                                                        )}\r\n                                                    >\r\n                                                        <TableCell className=\"text-center p-2\">\r\n                                                            <Checkbox \r\n                                                                checked={!!rowSelection[originalIndex]} \r\n                                                                onCheckedChange={() => toggleRow(originalIndex)}\r\n                                                                className=\"h-3.5 w-3.5\"\r\n                                                            />\r\n                                                        </TableCell>\r\n                                                        <TableCell className=\"text-center p-2\">{statusIcons[row.status]}</TableCell>\r\n                                                        <TableCell className=\"p-2 text-xs\">{row.employeeName || '-'}</TableCell>\r\n                                                        <TableCell className=\"p-2 text-xs text-center\">{row.day || '-'}</TableCell>\r\n                                                        <TableCell className=\"p-2 text-xs text-center font-mono\">{row.checkIn || '-'}</TableCell>\r\n                                                        <TableCell className=\"p-2 text-xs text-center font-mono\">{row.morningCheckOut || '-'}</TableCell>\r\n                                                        <TableCell className=\"p-2 text-xs text-center font-mono\">{row.afternoonCheckIn || '-'}</TableCell>\r\n                                                        <TableCell className=\"p-2 text-xs text-center font-mono\">{row.checkOut || '-'}</TableCell>\r\n                                                        <TableCell className=\"p-2 text-xs text-center font-mono\">{row.overtimeCheckIn || '-'}</TableCell>\r\n                                                        <TableCell className=\"p-2 text-xs text-center font-mono\">{row.overtimeCheckOut || '-'}</TableCell>\r\n                                                        <TableCell className={cn(\"p-2 text-xs\", row.status !== 'ok' ? 'text-destructive' : 'text-muted-foreground')}>\r\n                                                            {row.message}\r\n                                                        </TableCell>\r\n                                                        <TableCell className=\"text-right p-2\">\r\n                                                            <DropdownMenu>\r\n                                                                <DropdownMenuTrigger asChild>\r\n                                                                    <Button variant=\"ghost\" size=\"icon\" className=\"h-6 w-6\">\r\n                                                                        <MoreHorizontal className=\"h-3.5 w-3.5\" />\r\n                                                                    </Button>\r\n                                                                </DropdownMenuTrigger>\r\n                                                                <DropdownMenuContent align=\"end\">\r\n                                                                    <DropdownMenuItem onSelect={() => handleEdit(originalIndex)} className=\"text-xs\">\r\n                                                                        <Edit className=\"mr-2 h-3.5 w-3.5\" />Sửa\r\n                                                                    </DropdownMenuItem>\r\n                                                                    <DropdownMenuItem onSelect={() => handleDelete(originalIndex)} className=\"text-destructive text-xs\">\r\n                                                                        <Trash2 className=\"mr-2 h-3.5 w-3.5\" />Xóa\r\n                                                                    </DropdownMenuItem>\r\n                                                                </DropdownMenuContent>\r\n                                                            </DropdownMenu>\r\n                                                        </TableCell>\r\n                                                    </TableRow>\r\n                                                );\r\n                                            })}\r\n                                            {paginatedData.length === 0 && (\r\n                                                <TableRow>\r\n                                                    <TableCell colSpan={12} className=\"text-center py-6 text-xs text-muted-foreground\">\r\n                                                        {searchQuery ? 'Không tìm thấy kết quả phù hợp' : 'Không có dữ liệu'}\r\n                                                    </TableCell>\r\n                                                </TableRow>\r\n                                            )}\r\n                                        </TableBody>\r\n                                    </Table>\r\n                                </div>\r\n                                <ScrollBar orientation=\"horizontal\" />\r\n                                <ScrollBar orientation=\"vertical\" />\r\n                            </ScrollArea>\r\n\r\n                            {/* Pagination */}\r\n                            {totalPages > 1 && (\r\n                                <div className=\"flex-shrink-0 flex items-center justify-between mt-2 py-2 border-t\">\r\n                                    <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\r\n                                        <span>Hiển thị</span>\r\n                                        <Select value={String(pageSize)} onValueChange={(v) => { setPageSize(Number(v)); setCurrentPage(1); }}>\r\n                                            <SelectTrigger className=\"h-7 w-16 text-xs\">\r\n                                                <SelectValue />\r\n                                            </SelectTrigger>\r\n                                            <SelectContent>\r\n                                                {PAGE_SIZE_OPTIONS.map(size => (\r\n                                                    <SelectItem key={size} value={String(size)} className=\"text-xs\">{size}</SelectItem>\r\n                                                ))}\r\n                                            </SelectContent>\r\n                                        </Select>\r\n                                        <span>/ trang</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-1\">\r\n                                        <Button\r\n                                            variant=\"outline\"\r\n                                            size=\"icon\"\r\n                                            className=\"h-7 w-7\"\r\n                                            onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\r\n                                            disabled={currentPage === 1}\r\n                                        >\r\n                                            <ChevronLeft className=\"h-3.5 w-3.5\" />\r\n                                        </Button>\r\n                                        <span className=\"text-xs px-2\">\r\n                                            Trang {currentPage} / {totalPages}\r\n                                        </span>\r\n                                        <Button\r\n                                            variant=\"outline\"\r\n                                            size=\"icon\"\r\n                                            className=\"h-7 w-7\"\r\n                                            onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}\r\n                                            disabled={currentPage === totalPages}\r\n                                        >\r\n                                            <ChevronRight className=\"h-3.5 w-3.5\" />\r\n                                        </Button>\r\n                                    </div>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    )}\r\n                    \r\n                    <DialogFooter className=\"px-4 py-3 border-t\">\r\n                        <Button variant=\"ghost\" size=\"sm\" className=\"h-8 text-xs\" onClick={() => onOpenChange(false)}>Thoát</Button>\r\n                        {step === 'upload' && (\r\n                            <Button size=\"sm\" className=\"h-8 text-xs\" onClick={handleProcessFile} disabled={!file || isLoading}>\r\n                                {isLoading && <Spinner className=\"mr-1.5 h-3 w-3\"/>}Tiếp tục\r\n                            </Button>\r\n                        )}\r\n                        {step === 'preview' && (\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <Button variant=\"outline\" size=\"sm\" className=\"h-8 text-xs\" onClick={() => setStep('upload')}>Quay lại</Button>\r\n                                <Button size=\"sm\" className=\"h-8 text-xs\" onClick={handleConfirm} disabled={summary.okCount === 0}>\r\n                                    Xác nhận & Nhập {summary.okCount} dòng\r\n                                </Button>\r\n                            </div>\r\n                        )}\r\n                    </DialogFooter>\r\n                </DialogContent>\r\n            </Dialog>\r\n            <AttendanceEditDialog\r\n                isOpen={isEditDialogOpen}\r\n                onOpenChange={setIsEditDialogOpen}\r\n                recordData={editingRecordData}\r\n                onSave={handleSaveEdit}\r\n                monthDate={selectedMonth}\r\n            />\r\n        </>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4723, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/attendance/components/bulk-edit-dialog.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { useForm } from 'react-hook-form';\r\nimport { zodResolver } from '@hookform/resolvers/zod';\r\nimport * as z from 'zod';\r\nimport type { DailyRecord } from '../types';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from '../../../components/ui/dialog';\r\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from '../../../components/ui/form';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../../../components/ui/select';\r\nimport { Button } from '../../../components/ui/button';\r\nimport { TimePicker } from '../../../components/ui/time-picker';\r\nimport { Separator } from '../../../components/ui/separator';\r\nimport { CheckCircle2, XCircle, Clock, Calendar, Users, Edit3 } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport type { SystemId } from '../../../lib/id-types';\r\n\r\ninterface BulkEditDialogProps {\r\n  isOpen: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  selectedCells: Array<{ employeeSystemId: SystemId; employeeCode: string; employeeName: string; day: number }>;\r\n  onSave: (updates: Array<{ employeeSystemId: SystemId; day: number; record: DailyRecord }>) => void;\r\n}\r\n\r\n// Validation schema\r\nconst formSchema = z.object({\r\n  status: z.enum(['present', 'absent', 'leave', 'half-day', 'weekend', 'holiday', 'future']),\r\n  checkIn: z.string().optional(),\r\n  checkOut: z.string().optional(),\r\n  overtimeCheckIn: z.string().optional(),\r\n  overtimeCheckOut: z.string().optional(),\r\n}).refine((data) => {\r\n  if (data.checkIn && data.checkOut) {\r\n    const [checkInHour, checkInMin] = data.checkIn.split(':').map(Number);\r\n    const [checkOutHour, checkOutMin] = data.checkOut.split(':').map(Number);\r\n    const checkInMinutes = checkInHour * 60 + checkInMin;\r\n    const checkOutMinutes = checkOutHour * 60 + checkOutMin;\r\n    return checkOutMinutes > checkInMinutes;\r\n  }\r\n  return true;\r\n}, {\r\n  message: \"Giờ ra phải sau giờ vào\",\r\n  path: [\"checkOut\"],\r\n}).refine((data) => {\r\n  if (data.overtimeCheckIn && data.overtimeCheckOut) {\r\n    const [otInHour, otInMin] = data.overtimeCheckIn.split(':').map(Number);\r\n    const [otOutHour, otOutMin] = data.overtimeCheckOut.split(':').map(Number);\r\n    const otInMinutes = otInHour * 60 + otInMin;\r\n    const otOutMinutes = otOutHour * 60 + otOutMin;\r\n    return otOutMinutes > otInMinutes;\r\n  }\r\n  return true;\r\n}, {\r\n  message: \"Giờ làm thêm ra phải sau giờ làm thêm vào\",\r\n  path: [\"overtimeCheckOut\"],\r\n});\r\n\r\ntype FormValues = z.infer<typeof formSchema>;\r\n\r\nexport function BulkEditDialog({ isOpen, onOpenChange, selectedCells, onSave }: BulkEditDialogProps) {\r\n  const form = useForm<FormValues>({\r\n    resolver: zodResolver(formSchema),\r\n    defaultValues: {\r\n      status: 'present',\r\n    }\r\n  });\r\n  const { handleSubmit, control, reset, watch } = form;\r\n\r\n  const status = watch('status');\r\n\r\n  React.useEffect(() => {\r\n    if (isOpen) {\r\n      reset({\r\n        status: 'present',\r\n        checkIn: undefined,\r\n        checkOut: undefined,\r\n        overtimeCheckIn: undefined,\r\n        overtimeCheckOut: undefined,\r\n      });\r\n    }\r\n  }, [isOpen, reset]);\r\n\r\n  const onSubmit = (data: FormValues) => {\r\n    const updates = selectedCells.map(cell => ({\r\n      employeeSystemId: cell.employeeSystemId,\r\n      day: cell.day,\r\n      record: data as DailyRecord,\r\n    }));\r\n    onSave(updates);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  const handleClose = () => {\r\n    onOpenChange(false);\r\n  };\r\n\r\n  const groupedByEmployee = React.useMemo(() => {\r\n    const groups: Record<string, { name: string; code: string; days: number[] }> = {};\r\n    selectedCells.forEach(cell => {\r\n      if (!groups[cell.employeeSystemId]) {\r\n        groups[cell.employeeSystemId] = { name: cell.employeeName, code: cell.employeeCode, days: [] };\r\n      }\r\n      groups[cell.employeeSystemId].days.push(cell.day);\r\n    });\r\n    return groups;\r\n  }, [selectedCells]);\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"sm:max-w-2xl\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <Edit3 className=\"h-5 w-5\" />\r\n            Chỉnh sửa hàng loạt\r\n          </DialogTitle>\r\n          <DialogDescription className=\"flex items-center gap-2\">\r\n            <Users className=\"h-4 w-4\" />\r\n            Áp dụng cùng giá trị cho {selectedCells.length} ô đã chọn\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        <div className=\"max-h-40 overflow-y-auto border rounded-lg p-3 bg-muted/30\">\r\n          <div className=\"space-y-2 text-body-sm\">\r\n            {Object.entries(groupedByEmployee).map(([systemId, info]) => (\r\n              <div key={systemId} className=\"flex items-start gap-2\">\r\n                <CheckCircle2 className=\"h-4 w-4 text-green-600 mt-0.5 flex-shrink-0\" />\r\n                <div>\r\n                  <span className=\"font-medium\">{info.name}</span>\r\n                  <span className=\"text-muted-foreground ml-1\">({info.code})</span>\r\n                  <span className=\"text-muted-foreground ml-2\">\r\n                    ({info.days.length} ngày: {info.days.sort((a, b) => a - b).join(', ')})\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        <Separator />\r\n\r\n        <Form {...form}>\r\n          <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-4\">\r\n            <FormField\r\n              control={control}\r\n              name=\"status\"\r\n              render={({ field }) => (\r\n                <FormItem>\r\n                  <FormLabel>Trạng thái</FormLabel>\r\n                  <Select onValueChange={field.onChange} value={field.value}>\r\n                    <FormControl>\r\n                      <SelectTrigger className=\"h-9\">\r\n                        <SelectValue placeholder=\"Chọn trạng thái\" />\r\n                      </SelectTrigger>\r\n                    </FormControl>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"present\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\r\n                          Đi làm đủ\r\n                        </div>\r\n                      </SelectItem>\r\n                      <SelectItem value=\"half-day\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Clock className=\"h-4 w-4 text-yellow-600\" />\r\n                          Nửa ngày\r\n                        </div>\r\n                      </SelectItem>\r\n                      <SelectItem value=\"leave\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <Calendar className=\"h-4 w-4 text-blue-600\" />\r\n                          Nghỉ phép\r\n                        </div>\r\n                      </SelectItem>\r\n                      <SelectItem value=\"absent\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <XCircle className=\"h-4 w-4 text-red-600\" />\r\n                          Vắng\r\n                        </div>\r\n                      </SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                  <FormMessage />\r\n                </FormItem>\r\n              )}\r\n            />\r\n            {(status === 'present' || status === 'half-day') && (\r\n              <div className=\"space-y-4\">\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <FormField control={control} name=\"checkIn\" render={({ field }) => (\r\n                    <FormItem>\r\n                      <FormLabel>Giờ vào</FormLabel>\r\n                      <FormControl><TimePicker {...field} value={field.value ?? \"\"} /></FormControl>\r\n                      <FormMessage />\r\n                    </FormItem>\r\n                  )} />\r\n                  <FormField control={control} name=\"checkOut\" render={({ field }) => (\r\n                    <FormItem>\r\n                      <FormLabel>Giờ ra</FormLabel>\r\n                      <FormControl><TimePicker {...field} value={field.value ?? \"\"} /></FormControl>\r\n                      <FormMessage />\r\n                    </FormItem>\r\n                  )} />\r\n                </div>\r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <FormField control={control} name=\"overtimeCheckIn\" render={({ field }) => (\r\n                    <FormItem>\r\n                      <FormLabel>Tăng ca (Vào)</FormLabel>\r\n                      <FormControl><TimePicker {...field} value={field.value ?? \"\"} /></FormControl>\r\n                      <FormMessage />\r\n                    </FormItem>\r\n                  )} />\r\n                  <FormField control={control} name=\"overtimeCheckOut\" render={({ field }) => (\r\n                    <FormItem>\r\n                      <FormLabel>Tăng ca (Ra)</FormLabel>\r\n                      <FormControl><TimePicker {...field} value={field.value ?? \"\"} /></FormControl>\r\n                      <FormMessage />\r\n                    </FormItem>\r\n                  )} />\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            <DialogFooter className=\"gap-2\">\r\n              <Button type=\"button\" variant=\"outline\" onClick={handleClose} className=\"h-9\">\r\n                Hủy\r\n              </Button>\r\n              <Button type=\"submit\" className=\"h-9\">\r\n                <CheckCircle2 className=\"mr-2 h-4 w-4\" />\r\n                Áp dụng cho {selectedCells.length} ô\r\n              </Button>\r\n            </DialogFooter>\r\n          </form>\r\n        </Form>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5408, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/attendance/components/statistics-dashboard.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '../../../components/ui/card';\r\nimport { Users, Calendar, AlertTriangle, Clock, TrendingUp, Award } from 'lucide-react';\r\nimport type { AttendanceDataRow } from '../types';\r\nimport { cn } from '../../../lib/utils';\r\n\r\ninterface StatisticsDashboardProps {\r\n  data: AttendanceDataRow[];\r\n  currentDate: Date;\r\n}\r\n\r\nexport function StatisticsDashboard({ data, currentDate }: StatisticsDashboardProps) {\r\n  const stats = React.useMemo(() => {\r\n    const totalEmployees = data.length;\r\n    const totalWorkDays = data.reduce((sum, emp) => sum + emp.workDays, 0);\r\n    const totalLeaveDays = data.reduce((sum, emp) => sum + emp.leaveDays, 0);\r\n    const totalAbsentDays = data.reduce((sum, emp) => sum + emp.absentDays, 0);\r\n    const totalLateArrivals = data.reduce((sum, emp) => sum + emp.lateArrivals, 0);\r\n    const totalOTHours = data.reduce((sum, emp) => sum + emp.otHours, 0);\r\n    \r\n    const avgWorkDays = totalEmployees > 0 ? (totalWorkDays / totalEmployees).toFixed(1) : 0;\r\n    const attendanceRate = totalEmployees > 0 \r\n      ? ((totalWorkDays / (totalWorkDays + totalAbsentDays)) * 100).toFixed(1)\r\n      : 0;\r\n    \r\n    // Find top performers\r\n    const topOTEmployee = data.reduce((max, emp) => emp.otHours > max.otHours ? emp : max, data[0] || { otHours: 0, fullName: '-' });\r\n    const mostLateEmployee = data.reduce((max, emp) => emp.lateArrivals > max.lateArrivals ? emp : max, data[0] || { lateArrivals: 0, fullName: '-' });\r\n    \r\n    return {\r\n      totalEmployees,\r\n      totalWorkDays,\r\n      totalLeaveDays,\r\n      totalAbsentDays,\r\n      totalLateArrivals,\r\n      totalOTHours,\r\n      avgWorkDays,\r\n      attendanceRate,\r\n      topOTEmployee,\r\n      mostLateEmployee,\r\n    };\r\n  }, [data]);\r\n\r\n  const statCards = [\r\n    {\r\n      title: 'Tổng nhân viên',\r\n      value: stats.totalEmployees,\r\n      icon: Users,\r\n      color: 'text-blue-600',\r\n      bgColor: 'bg-blue-50',\r\n    },\r\n    {\r\n      title: 'Công trung bình',\r\n      value: `${stats.avgWorkDays} ngày`,\r\n      icon: Calendar,\r\n      color: 'text-green-600',\r\n      bgColor: 'bg-green-50',\r\n    },\r\n    {\r\n      title: 'Tỷ lệ đi làm',\r\n      value: `${stats.attendanceRate}%`,\r\n      icon: TrendingUp,\r\n      color: 'text-emerald-600',\r\n      bgColor: 'bg-emerald-50',\r\n    },\r\n    {\r\n      title: 'Tổng giờ làm thêm',\r\n      value: `${stats.totalOTHours}h`,\r\n      icon: Clock,\r\n      color: 'text-purple-600',\r\n      bgColor: 'bg-purple-50',\r\n    },\r\n    {\r\n      title: 'Đi trễ nhiều nhất',\r\n      value: stats.mostLateEmployee.fullName,\r\n      subtitle: `${stats.mostLateEmployee.lateArrivals} lần`,\r\n      icon: AlertTriangle,\r\n      color: 'text-orange-600',\r\n      bgColor: 'bg-orange-50',\r\n    },\r\n    {\r\n      title: 'OT nhiều nhất',\r\n      value: stats.topOTEmployee.fullName,\r\n      subtitle: `${stats.topOTEmployee.otHours}h`,\r\n      icon: Award,\r\n      color: 'text-indigo-600',\r\n      bgColor: 'bg-indigo-50',\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4 mb-4\">\r\n      {statCards.map((stat, index) => (\r\n        <Card key={index} className=\"overflow-hidden\">\r\n          <CardHeader className=\"pb-2\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <CardTitle className=\"text-body-sm font-medium text-muted-foreground\">\r\n                {stat.title}\r\n              </CardTitle>\r\n              <div className={cn('p-2 rounded-md', stat.bgColor)}>\r\n                <stat.icon className={cn('h-4 w-4', stat.color)} />\r\n              </div>\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"text-h4 font-bold truncate\" title={String(stat.value)}>\r\n              {stat.value}\r\n            </div>\r\n            {stat.subtitle && (\r\n              <p className=\"text-body-xs text-muted-foreground mt-1\">\r\n                {stat.subtitle}\r\n              </p>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      ))}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5591, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/order.ts"],"sourcesContent":["/**\r\n * Mẫu in Đơn bán hàng - TipTap compatible\r\n * \r\n * QUAN TRỌNG - Quy tắc template:\r\n * 1. Bảng chứa {line_stt} là bảng line items - sẽ được lặp theo số sản phẩm\r\n * 2. Các bảng khác là bảng thông tin - không lặp\r\n * 3. Sử dụng inline styles để đảm bảo hiển thị đúng khi in\r\n * \r\n * CHUẨN TEMPLATE v2 (2025-12-08):\r\n * - Header: Logo trái + Store info phải (dạng table)\r\n * - Title: Căn giữa, border-bottom\r\n * - Info table: Label 22% nền xám\r\n * - Product table: table-layout fixed, responsive\r\n * - Summary: 250px căn phải\r\n * - Footer: border-top dashed, font nhỏ\r\n */\r\nexport const ORDER_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER: Logo trái + Thông tin cửa hàng phải -->\r\n<table style=\"width: 100%; margin-bottom: 12px; border-collapse: collapse;\">\r\n  <tr>\r\n    <td style=\"width: 70px; vertical-align: top; padding-right: 10px;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div style=\"font-size: 11px; color: #333;\">{store_address}</div>\r\n      <div style=\"font-size: 11px; color: #333;\">ĐT: {store_phone_number} | Email: {store_email}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 12px 0 5px 0; font-size: 14px; font-weight: bold; margin-bottom: 2px; border-bottom: 2px solid #333; padding-bottom: 8px;\">HÓA ĐƠN BÁN HÀNG</h2>\r\n<div style=\"text-align: center; margin-bottom: 12px; font-size: 11px;\">\r\n  <div>Số: <strong>{order_code}</strong></div>\r\n  <div>Ngày: {created_on} {created_on_time}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN KHÁCH HÀNG -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">Khách hàng:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\"><strong>{customer_name}</strong></td>\r\n      <td style=\"padding: 4px 6px; width: 18%; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">Mã KH:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{customer_code}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">Điện thoại:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{customer_phone_number}</td>\r\n      <td style=\"padding: 4px 6px; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">Nhóm KH:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{customer_group}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">Địa chỉ:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\" colspan=\"3\">{billing_address}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">ĐC giao hàng:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\" colspan=\"3\">{shipping_address}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">NV bán:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{account_name}</td>\r\n      <td style=\"padding: 4px 6px; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">Trạng thái:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{order_status}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẢNG SẢN PHẨM - Responsive với table-layout fixed -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <thead>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: center; width: 28px; font-size: 10px;\">STT</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: left; font-size: 10px;\">Tên sản phẩm</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: center; width: 32px; font-size: 10px;\">ĐVT</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: center; width: 28px; font-size: 10px;\">SL</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: right; width: 65px; font-size: 10px;\">Đơn giá</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: right; width: 50px; font-size: 10px;\">VAT</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: right; width: 45px; font-size: 10px;\">CK</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: right; width: 70px; font-size: 10px;\">Thành tiền</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: center; font-size: 10px;\">{line_stt}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; font-size: 10px; word-wrap: break-word;\">{line_product_name}<br><small style=\"color: #666;\">{line_variant}</small></td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: center; font-size: 10px;\">{line_unit}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: center; font-size: 10px; font-weight: bold;\">{line_quantity}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: right; font-size: 10px;\">{line_price}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: right; font-size: 10px;\">{line_tax_amount}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: right; font-size: 10px;\">{line_discount_amount}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: right; font-size: 10px;\">{line_amount}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẢNG TỔNG GIÁ TRỊ -->\r\n<table style=\"width: 250px; margin-left: auto; border-collapse: collapse; margin-bottom: 10px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Tổng số lượng:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; width: 85px; font-size: 11px;\"><strong>{total_quantity}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Tổng tiền hàng:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px;\">{total}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Chiết khấu:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px;\">{total_discount}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Thuế:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px;\">{total_tax}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Phí giao hàng:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px;\">{delivery_fee}</td>\r\n    </tr>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <td style=\"padding: 5px 6px; border: 1px solid #333; font-size: 11px;\"><strong>TỔNG CỘNG:</strong></td>\r\n      <td style=\"padding: 5px 6px; border: 1px solid #333; text-align: right; font-size: 11px;\"><strong>{total_amount}</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẰNG CHỮ -->\r\n<p style=\"margin: 8px 0; font-size: 11px;\"><strong>Bằng chữ:</strong> <em>{total_text}</em></p>\r\n\r\n<!-- THANH TOÁN -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">Phương thức TT:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{payment_name}</td>\r\n      <td style=\"padding: 4px 6px; width: 18%; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">TT thanh toán:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{payment_status}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">Khách đưa:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{payment_customer}</td>\r\n      <td style=\"padding: 4px 6px; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">Tiền thừa:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{money_return}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin: 8px 0; padding: 8px; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">\r\n  <strong>Ghi chú:</strong> {order_note}\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 25px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 50%; text-align: center; padding: 8px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; font-size: 11px;\">Người mua hàng</div>\r\n        <div style=\"color: #888; font-size: 10px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 50px;\"></div>\r\n        <div style=\"font-size: 11px;\">{customer_name}</div>\r\n      </td>\r\n      <td style=\"width: 50%; text-align: center; padding: 8px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; font-size: 11px;\">Người bán hàng</div>\r\n        <div style=\"color: #888; font-size: 10px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 50px;\"></div>\r\n        <div style=\"font-size: 11px;\">{account_name}</div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333; font-size: 10px; color: #666;\">\r\n  <div>Cảm ơn quý khách đã mua hàng!</div>\r\n  <div>Hotline: {store_phone_number} | In lúc: {print_date} {print_time}</div>\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;CAeC;;;;AACM,MAAM,iBAAiB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqK/B,CAAC"}},
    {"offset": {"line": 5780, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/quote.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu báo giá / Đơn tạm tính - TipTap compatible\r\n * Cập nhật: Thiết kế đen trắng cho máy in\r\n */\r\nexport const QUOTE_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"width: 80px; vertical-align: top;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div>{store_address}</div>\r\n      <div>ĐT: {store_phone_number} | Email: {store_email}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 15px 0 5px 0; font-size: 14px; font-weight: bold; margin-bottom: 2px; border-bottom: 2px solid #333; padding-bottom: 10px;\">PHIẾU BÁO GIÁ</h2>\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div>Số: <strong>{order_code}</strong></div>\r\n  <div>Ngày: {created_on} {created_on_time}</div>\r\n  <div style=\"font-style: italic;\">Hiệu lực đến: {issued_on}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN KHÁCH HÀNG -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333;\">Khách hàng:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{customer_name}</strong></td>\r\n      <td style=\"padding: 5px; width: 15%; background: #f5f5f5; border: 1px solid #333;\">Mã KH:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{customer_code}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Điện thoại:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{customer_phone_number}</td>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Email:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{customer_email}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Địa chỉ:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\" colspan=\"3\">{billing_address}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Nhân viên:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{account_name}</td>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Chính sách giá:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{price_list_name}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẢNG SẢN PHẨM -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <thead>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 40px;\">STT</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: left;\">Tên sản phẩm</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 60px;\">ĐVT</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 50px;\">SL</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: right; width: 100px;\">Đơn giá</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: right; width: 80px;\">CK</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: right; width: 110px;\">Thành tiền</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\">{line_stt}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333;\">{line_product_name}<br><small>{line_variant}</small></td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\">{line_unit}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\">{line_quantity}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: right;\">{line_price}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: right;\">{line_discount_amount}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: right;\">{line_amount}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- TỔNG GIÁ TRỊ -->\r\n<table style=\"width: 250px; margin-left: auto; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Tổng tiền hàng:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right; width: 120px;\">{total}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Chiết khấu:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\">{total_discount}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Thuế VAT:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\">{total_tax}</td>\r\n    </tr>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>TỔNG CỘNG:</strong></td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\"><strong>{total_amount}</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<p style=\"margin: 10px 0;\"><strong>Bằng chữ:</strong> <em>{total_text}</em></p>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin: 10px 0; padding: 10px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {order_note}\r\n</div>\r\n\r\n<!-- ĐIỀU KHOẢN -->\r\n<div style=\"margin-bottom: 10px; padding: 10px; border: 1px solid #333; font-size: 11px;\">\r\n  <strong>Điều khoản:</strong>\r\n  <ul style=\"margin: 5px 0 0 15px; padding: 0;\">\r\n    <li>Báo giá có hiệu lực trong 7 ngày kể từ ngày lập</li>\r\n    <li>Giá trên chưa bao gồm phí vận chuyển (nếu có)</li>\r\n    <li>Thanh toán: Theo thỏa thuận</li>\r\n  </ul>\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 30px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px;\">\r\n        <strong>Khách hàng</strong><br>\r\n        <em>(Ký xác nhận đồng ý)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {customer_name}\r\n      </td>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px;\">\r\n        <strong>Nhân viên báo giá</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {account_name}\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333;\">\r\n  <p style=\"margin: 5px 0;\">Cảm ơn Quý khách đã quan tâm!</p>\r\n  <p style=\"margin: 5px 0;\">Liên hệ: {store_phone_number}</p>\r\n\n  <div style=\"font-size: 10px; color: #666; margin-top: 5px;\">In lúc: {print_date} {print_time}</div></div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,MAAM,iBAAiB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgJ/B,CAAC"}},
    {"offset": {"line": 5936, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/receipt.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu thu - TipTap compatible\r\n * Cập nhật: Thiết kế đen trắng cho máy in\r\n */\r\nexport const RECEIPT_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"width: 80px; vertical-align: top;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div>{store_address}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 15px 0 5px 0; font-size: 14px; font-weight: bold; margin-bottom: 2px; border-bottom: 2px solid #333; padding-bottom: 10px;\">PHIẾU THU</h2>\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div>Số: <strong>{receipt_voucher_code}</strong></div>\r\n  <div>Ngày: {created_on}</div>\r\n</div>\r\n\r\n<!-- MÃ VẠCH -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"text-align: center; padding: 10px; border: 1px solid #333; background: #f5f5f5;\">\r\n      <div style=\"margin-bottom: 8px;\">{receipt_barcode}</div>\r\n      <div style=\"font-family: monospace;\">{receipt_voucher_code}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- THÔNG TIN PHIẾU THU -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333;\">Người nộp tiền:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{object_name}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Địa chỉ:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{object_address}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Lý do nộp:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{description}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Hình thức thanh toán:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{payment_method}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- SỐ TIỀN -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"text-align: center; padding: 15px; border: 2px solid #333;\">\r\n      <div style=\"margin-bottom: 8px;\">Số tiền</div>\r\n      <div style=\"font-size: 24px; font-weight: bold;\">{amount}</div>\r\n      <div style=\"font-style: italic; margin-top: 8px;\">({amount_text})</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin: 10px 0; padding: 10px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 30px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Người nộp tiền</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {object_name}\r\n      </td>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Thủ quỹ</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n      </td>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Người lập phiếu</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {account_name}\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333; font-size: 11px;\">\r\n  In lúc: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,MAAM,mBAAmB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoGjC,CAAC"}},
    {"offset": {"line": 6048, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/payment.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu chi - TipTap compatible\r\n * Cập nhật: Thiết kế đen trắng cho máy in\r\n */\r\nexport const PAYMENT_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"width: 80px; vertical-align: top;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div>{store_address}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 15px 0 5px 0; font-size: 14px; font-weight: bold; margin-bottom: 2px; border-bottom: 2px solid #333; padding-bottom: 10px;\">PHIẾU CHI</h2>\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div>Số: <strong>{payment_voucher_code}</strong></div>\r\n  <div>Ngày: {created_on}</div>\r\n</div>\r\n\r\n<!-- MÃ VẠCH -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"text-align: center; padding: 10px; border: 1px solid #333; background: #f5f5f5;\">\r\n      <div style=\"margin-bottom: 8px;\">{payment_barcode}</div>\r\n      <div style=\"font-family: monospace;\">{payment_voucher_code}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- THÔNG TIN PHIẾU CHI -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333;\">Người nhận tiền:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{object_name}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Địa chỉ:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{object_address}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Lý do chi:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{description}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Hình thức thanh toán:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{payment_method}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- SỐ TIỀN -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"text-align: center; padding: 15px; border: 2px solid #333;\">\r\n      <div style=\"margin-bottom: 8px;\">Số tiền</div>\r\n      <div style=\"font-size: 24px; font-weight: bold;\">{amount}</div>\r\n      <div style=\"font-style: italic; margin-top: 8px;\">({amount_text})</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin: 10px 0; padding: 10px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 30px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Người nhận tiền</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {object_name}\r\n      </td>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Thủ quỹ</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n      </td>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Người lập phiếu</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {account_name}\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333; font-size: 11px;\">\r\n  In lúc: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,MAAM,mBAAmB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoGjC,CAAC"}},
    {"offset": {"line": 6160, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/warranty.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu bảo hành - TipTap compatible\r\n * Cập nhật: Thiết kế đen trắng cho máy in\r\n */\r\nexport const WARRANTY_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"width: 80px; vertical-align: top;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div>{store_address}</div>\r\n      <div>Hotline: <strong>{store_phone_number}</strong></div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 15px 0 5px 0; font-size: 14px; font-weight: bold; margin-bottom: 2px; border-bottom: 2px solid #333; padding-bottom: 10px;\">PHIẾU BẢO HÀNH</h2>\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div>Mã phiếu: <strong>{warranty_code}</strong></div>\r\n  <div>Ngày: {created_on}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN KHÁCH HÀNG -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333;\">Khách hàng:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{customer_name}</strong></td>\r\n      <td style=\"padding: 5px; width: 15%; background: #f5f5f5; border: 1px solid #333;\">SĐT:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{customer_phone_number}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Địa chỉ:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\" colspan=\"3\">{customer_address}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- THÔNG TIN SẢN PHẨM BẢO HÀNH -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed; border: 2px solid #333;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; width: 25%; background: #f5f5f5; border: 1px solid #333;\">Sản phẩm:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\"><strong>{product_name}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333;\">Serial/IMEI:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; font-family: monospace; font-size: 14px;\">{serial_number}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333;\">Thời hạn BH:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{warranty_duration}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333;\">Ngày hết hạn:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\"><strong>{warranty_expired_on}</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- QUY ĐỊNH BẢO HÀNH -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tr>\r\n    <td style=\"width: 50%; padding: 10px; border: 1px solid #333; vertical-align: top;\">\r\n      <strong>ĐƯỢC BẢO HÀNH:</strong>\r\n      <div style=\"padding-left: 10px; margin-top: 5px;\">\r\n        <div>- Còn trong thời hạn bảo hành</div>\r\n        <div>- Tem bảo hành còn nguyên vẹn</div>\r\n        <div>- Hư hỏng do lỗi kỹ thuật từ NSX</div>\r\n      </div>\r\n    </td>\r\n    <td style=\"width: 50%; padding: 10px; border: 1px solid #333; vertical-align: top;\">\r\n      <strong>TỪ CHỐI BẢO HÀNH:</strong>\r\n      <div style=\"padding-left: 10px; margin-top: 5px;\">\r\n        <div>- Rơi vỡ, trầy xước, biến dạng</div>\r\n        <div>- Vào nước, ẩm, cháy, nổ</div>\r\n        <div>- Tự ý tháo lắp, sửa chữa</div>\r\n        <div>- Sử dụng sai cách, cố ý làm hư</div>\r\n      </div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 30px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px;\">\r\n        <strong>Khách hàng</strong><br>\r\n        <em>(Ký xác nhận)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {customer_name}\r\n      </td>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px;\">\r\n        <strong>Nhân viên</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {account_name}\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333; font-size: 11px;\">\r\n  Cảm ơn quý khách đã tin tưởng sử dụng dịch vụ của chúng tôi!\r\n\n  <div style=\"font-size: 10px; color: #666; margin-top: 5px;\">In lúc: {print_date} {print_time}</div></div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,MAAM,oBAAoB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8GlC,CAAC"}},
    {"offset": {"line": 6282, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/inventory-check.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu kiểm kho - TipTap compatible\r\n * Cập nhật: Thiết kế đen trắng cho máy in\r\n */\r\nexport const INVENTORY_CHECK_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"width: 80px; vertical-align: top;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div>{store_address}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 15px 0 5px 0; font-size: 14px; font-weight: bold; margin-bottom: 2px; border-bottom: 2px solid #333; padding-bottom: 10px;\">PHIẾU KIỂM KHO</h2>\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div>Mã phiếu: <strong>{inventory_code}</strong></div>\r\n  <div>Ngày kiểm: {created_on}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN KHO -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333;\">Kho kiểm:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{location_name}</strong></td>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333;\">Trạng thái:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{inventory_status}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Người kiểm:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\" colspan=\"3\">{account_name}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẢNG SẢN PHẨM -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <thead>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 40px;\">STT</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 100px;\">Mã SP</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: left;\">Tên sản phẩm</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 70px;\">Tồn kho</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 70px;\">Thực tế</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 60px;\">Lệch</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: left; width: 100px;\">Ghi chú</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\">{line_stt}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center; font-family: monospace;\">{line_variant_code}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333;\">{line_product_name}<br><small>{line_variant}</small></td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\">{line_on_hand}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center; font-weight: bold;\">{line_real_quantity}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center; font-weight: bold;\">{line_difference}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; font-size: 11px;\">{line_note}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- TỔNG KẾT -->\r\n<table style=\"width: 250px; margin-left: auto; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Tổng số SP kiểm:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right; width: 80px;\"><strong>{total_items}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Chênh lệch (thừa):</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\"><strong>+{total_surplus}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Chênh lệch (thiếu):</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\"><strong>-{total_shortage}</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin: 10px 0; padding: 10px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 30px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px;\">\r\n        <strong>Người kiểm kho</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {account_name}\r\n      </td>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px;\">\r\n        <strong>Thủ kho</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333; font-size: 11px;\">\r\n  In lúc: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,MAAM,2BAA2B,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+GzC,CAAC"}},
    {"offset": {"line": 6405, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/stock-transfer.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu chuyển kho - TipTap compatible\r\n * Cập nhật: Thiết kế đen trắng cho máy in\r\n */\r\nexport const STOCK_TRANSFER_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"width: 80px; vertical-align: top;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div>{store_address}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 15px 0 5px 0; font-size: 14px; font-weight: bold; margin-bottom: 2px; border-bottom: 2px solid #333; padding-bottom: 10px;\">PHIẾU CHUYỂN KHO</h2>\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div>Mã phiếu: <strong>{transfer_code}</strong></div>\r\n  <div>Ngày: {created_on}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN CHUYỂN KHO -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 10px; width: 45%; border: 2px solid #333; text-align: center;\">\r\n        <div style=\"font-size: 12px;\">KHO XUẤT</div>\r\n        <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{source_location_name}</div>\r\n      </td>\r\n      <td style=\"padding: 10px; text-align: center; font-size: 20px; width: 10%;\">--&gt;</td>\r\n      <td style=\"padding: 10px; width: 45%; border: 2px solid #333; text-align: center;\">\r\n        <div style=\"font-size: 12px;\">KHO NHẬP</div>\r\n        <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{target_location_name}</div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333;\">Trạng thái:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{status}</strong></td>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333;\">Người tạo:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{account_name}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẢNG SẢN PHẨM -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <thead>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 40px;\">STT</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 100px;\">Mã SP</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: left;\">Tên sản phẩm</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 60px;\">ĐVT</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 80px;\">Số lượng</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 40px;\">OK</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\">{line_stt}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center; font-family: monospace;\">{line_variant_code}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333;\">{line_product_name}<br><small>{line_variant}</small></td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\">{line_unit}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center; font-weight: bold;\">{line_quantity}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\"><div style=\"width: 16px; height: 16px; border: 1px solid #333; margin: 0 auto;\"></div></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- TỔNG CỘNG -->\r\n<table style=\"width: 250px; margin-left: auto; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>Tổng số lượng:</strong></td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\"><strong>{total_quantity}</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin: 10px 0; padding: 10px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 30px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Người lập phiếu</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {account_name}\r\n      </td>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Thủ kho xuất</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n      </td>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Thủ kho nhập</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333; font-size: 11px;\">\r\n  In lúc: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,MAAM,0BAA0B,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsHxC,CAAC"}},
    {"offset": {"line": 6535, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/sales-return.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu trả hàng - TipTap compatible\r\n * Cập nhật: Thiết kế đen trắng cho máy in\r\n */\r\nexport const SALES_RETURN_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"width: 80px; vertical-align: top;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div>{store_address}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 15px 0 5px 0; font-size: 14px; font-weight: bold; margin-bottom: 2px; border-bottom: 2px solid #333; padding-bottom: 10px;\">PHIẾU TRẢ HÀNG</h2>\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div>Số: <strong>{order_return_code}</strong></div>\r\n  <div>Đơn hàng gốc: <strong>{order_code}</strong></div>\r\n  <div>Ngày: {created_on}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN KHÁCH HÀNG -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333;\">Khách hàng:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{customer_name}</strong></td>\r\n      <td style=\"padding: 5px; width: 15%; background: #f5f5f5; border: 1px solid #333;\">SĐT:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{customer_phone_number}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Lý do trả:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\" colspan=\"3\"><strong>{reason_return}</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẢNG SẢN PHẨM TRẢ -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <thead>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 40px;\">STT</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 100px;\">Mã SP</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: left;\">Tên sản phẩm</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 60px;\">ĐVT</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 60px;\">SL Trả</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: right; width: 100px;\">Đơn giá</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: right; width: 110px;\">Thành tiền</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\">{line_stt}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center; font-family: monospace;\">{line_variant_code}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333;\">{line_product_name}<br><small>{line_variant}</small></td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\">{line_unit}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center; font-weight: bold;\">{line_quantity}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: right;\">{line_price}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: right;\">{line_total}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- TỔNG TIỀN HOÀN -->\r\n<table style=\"width: 250px; margin-left: auto; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Tổng số lượng trả:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right; width: 100px;\"><strong>{total_quantity}</strong></td>\r\n    </tr>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>TỔNG TIỀN HOÀN:</strong></td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\"><strong>{total}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Trạng thái hoàn:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\">{refund_status}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin: 10px 0; padding: 10px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 30px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px;\">\r\n        <strong>Khách hàng</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {customer_name}\r\n      </td>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px;\">\r\n        <strong>Người nhận hàng trả</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {account_name}\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333; font-size: 11px;\">\r\n  Hotline: {store_phone_number}\r\n\n  <div style=\"font-size: 10px; color: #666; margin-top: 5px;\">In lúc: {print_date} {print_time}</div></div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,MAAM,wBAAwB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkHtC,CAAC"}},
    {"offset": {"line": 6661, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/purchase-order.ts"],"sourcesContent":["/**\r\n * Mẫu in Đơn đặt hàng nhập - TipTap compatible\r\n * Cập nhật: Thiết kế đen trắng cho máy in\r\n */\r\nexport const PURCHASE_ORDER_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"width: 80px; vertical-align: top;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div>{store_address}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 15px 0 5px 0; font-size: 14px; font-weight: bold; margin-bottom: 2px; border-bottom: 2px solid #333; padding-bottom: 10px;\">ĐƠN ĐẶT HÀNG NHẬP</h2>\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div>Số: <strong>{order_supplier_code}</strong></div>\r\n  <div>Ngày: {created_on}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN NHÀ CUNG CẤP -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333;\">Nhà cung cấp:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{supplier_name}</strong></td>\r\n      <td style=\"padding: 5px; width: 15%; background: #f5f5f5; border: 1px solid #333;\">Mã NCC:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; font-family: monospace;\">{supplier_code}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Điện thoại:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{supplier_phone_number}</td>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Email:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{supplier_email}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Địa chỉ:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\" colspan=\"3\">{supplier_address}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẢNG SẢN PHẨM -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <thead>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 40px;\">STT</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 100px;\">Mã SP</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: left;\">Tên sản phẩm</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 60px;\">ĐVT</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 60px;\">SL Đặt</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: right; width: 100px;\">Đơn giá</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: right; width: 110px;\">Thành tiền</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\">{line_stt}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center; font-family: monospace;\">{line_variant_code}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333;\">{line_product_name}<br><small>{line_variant}</small></td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\">{line_unit}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\">{line_ordered_quantity}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: right;\">{line_price}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: right;\">{line_total}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- TỔNG TIỀN -->\r\n<table style=\"width: 250px; margin-left: auto; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Tổng tiền hàng:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right; width: 100px;\">{total}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Chiết khấu:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\">{discount}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Thuế VAT:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\">{tax_vat}</td>\r\n    </tr>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>TỔNG CỘNG:</strong></td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\"><strong>{total_order}</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin: 10px 0; padding: 10px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 30px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px;\">\r\n        <strong>Người lập đơn</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {account_name}\r\n      </td>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px;\">\r\n        <strong>Duyệt đơn</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333; font-size: 11px;\">\r\n  In lúc: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,MAAM,0BAA0B,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyHxC,CAAC"}},
    {"offset": {"line": 6794, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/packing.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu đóng gói - TipTap compatible\r\n * Cập nhật: 2025-12-08 - Responsive + Chuẩn hóa\r\n */\r\nexport const PACKING_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<table style=\"width: 100%; margin-bottom: 12px; border-collapse: collapse;\">\r\n  <tr>\r\n    <td style=\"width: 70px; vertical-align: top; padding-right: 10px;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div style=\"font-size: 11px; color: #333;\">{store_address}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 12px 0 5px 0; font-size: 14px; font-weight: bold; margin-bottom: 2px; border-bottom: 2px solid #333; padding-bottom: 8px;\">PHIẾU ĐÓNG GÓI</h2>\r\n<div style=\"text-align: center; margin-bottom: 12px; font-size: 11px;\">\r\n  <div>Mã: <strong>{fulfillment_code}</strong> | Đơn hàng: <strong>{order_code}</strong></div>\r\n  <div>Ngày: {created_on}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">Khách hàng:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\"><strong>{customer_name}</strong></td>\r\n      <td style=\"padding: 4px 6px; width: 15%; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">SĐT:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{customer_phone_number}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">Địa chỉ giao:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\" colspan=\"3\">{shipping_address}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">NV được gán:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\" colspan=\"3\">{assigned_employee}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẢNG SẢN PHẨM - Responsive -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <thead>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: center; width: 28px; font-size: 10px;\">STT</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: center; width: 70px; font-size: 10px;\">Mã SP</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: left; font-size: 10px;\">Tên sản phẩm</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: center; width: 35px; font-size: 10px;\">SL</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: center; width: 55px; font-size: 10px;\">Vị trí</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: left; width: 70px; font-size: 10px;\">Ghi chú</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: center; width: 28px; font-size: 10px;\">OK</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: center; font-size: 10px;\">{line_stt}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: center; font-family: monospace; font-size: 9px;\">{line_variant_code}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; font-size: 10px; word-wrap: break-word;\">{line_product_name}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: center; font-weight: bold; font-size: 11px;\">{line_quantity}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: center; font-size: 10px;\">{bin_location}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; font-size: 9px;\">{line_note}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: center;\"><div style=\"width: 14px; height: 14px; border: 1px solid #333; margin: 0 auto;\"></div></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- TỔNG CỘNG VÀ COD -->\r\n<table style=\"width: 220px; margin-left: auto; border-collapse: collapse; margin-bottom: 10px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Tổng số lượng:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; width: 75px; font-size: 11px;\"><strong>{total_quantity}</strong></td>\r\n    </tr>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <td style=\"padding: 5px 6px; border: 1px solid #333; font-size: 11px;\"><strong>COD - THU HỘ:</strong></td>\r\n      <td style=\"padding: 5px 6px; border: 1px solid #333; text-align: right; font-size: 11px;\"><strong>{cod}</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin: 8px 0; padding: 8px; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">\r\n  <strong>Ghi chú đóng gói:</strong> {packing_note}\r\n</div>\r\n<div style=\"margin: 8px 0; padding: 8px; border: 1px solid #333; font-size: 11px;\">\r\n  <strong>Ghi chú đơn hàng:</strong> {order_note}\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 25px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 50%; text-align: center; padding: 8px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; font-size: 11px;\">Người đóng gói</div>\r\n        <div style=\"color: #888; font-size: 10px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 50px;\"></div>\r\n        <div style=\"font-size: 11px;\">{account_name}</div>\r\n      </td>\r\n      <td style=\"width: 50%; text-align: center; padding: 8px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; font-size: 11px;\">Kiểm tra</div>\r\n        <div style=\"color: #888; font-size: 10px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 50px;\"></div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333; font-size: 10px; color: #666;\">\r\n  In lúc: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,MAAM,mBAAmB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkHjC,CAAC"}},
    {"offset": {"line": 6920, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/delivery.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu giao hàng - TipTap compatible\r\n * Cập nhật: 2025-12-08 - Responsive + Chuẩn hóa\r\n */\r\nexport const DELIVERY_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<table style=\"width: 100%; margin-bottom: 12px; border-collapse: collapse;\">\r\n  <tr>\r\n    <td style=\"width: 70px; vertical-align: top; padding-right: 10px;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div style=\"font-size: 11px; color: #333;\">{store_address}</div>\r\n      <div style=\"font-size: 11px; color: #333;\">ĐT: {store_phone_number}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 12px 0 5px 0; font-size: 14px; font-weight: bold; margin-bottom: 2px; border-bottom: 2px solid #333; padding-bottom: 8px;\">PHIẾU GIAO HÀNG</h2>\r\n<div style=\"text-align: center; margin-bottom: 12px; font-size: 11px;\">\r\n  <div>Mã: <strong>{delivery_code}</strong> | Đơn hàng: <strong>{order_code}</strong></div>\r\n  <div>Ngày: {created_on} {created_on_time}</div>\r\n</div>\r\n\r\n<!-- MÃ VẠCH VẬN ĐƠN -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"text-align: center; padding: 8px; border: 1px solid #333; background: #f5f5f5;\">\r\n      <div style=\"margin-bottom: 5px;\">{shipment_barcode}</div>\r\n      <div style=\"font-size: 14px; font-weight: bold; font-family: monospace;\">{tracking_number}</div>\r\n      <div style=\"font-size: 10px;\">Đối tác: {carrier_name}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- THÔNG TIN NGƯỜI NHẬN -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">Người nhận:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\"><strong>{receiver_name}</strong></td>\r\n      <td style=\"padding: 4px 6px; width: 15%; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">SĐT:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{receiver_phone}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">Địa chỉ giao:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\" colspan=\"3\">{shipping_address}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">NV giao hàng:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{shipper_name}</td>\r\n      <td style=\"padding: 4px 6px; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">Trạng thái:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{delivery_status}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẢNG SẢN PHẨM - Responsive -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <thead>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: center; width: 28px; font-size: 10px;\">STT</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: center; width: 70px; font-size: 10px;\">Mã SP</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: left; font-size: 10px;\">Tên sản phẩm</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: center; width: 32px; font-size: 10px;\">ĐVT</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: center; width: 30px; font-size: 10px;\">SL</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: right; width: 60px; font-size: 10px;\">Đơn giá</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: right; width: 70px; font-size: 10px;\">Thành tiền</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: center; font-size: 10px;\">{line_stt}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: center; font-family: monospace; font-size: 9px;\">{line_variant_code}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; font-size: 10px; word-wrap: break-word;\">{line_product_name}<br><small style=\"color: #666;\">{line_variant}</small></td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: center; font-size: 10px;\">{line_unit}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: center; font-weight: bold; font-size: 11px;\">{line_quantity}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: right; font-size: 10px;\">{line_price}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: right; font-size: 10px;\">{line_amount}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- TỔNG GIÁ TRỊ -->\r\n<table style=\"width: 250px; margin-left: auto; border-collapse: collapse; margin-bottom: 10px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Tổng số lượng:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; width: 85px; font-size: 11px;\"><strong>{total_quantity}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Tổng tiền hàng:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px;\">{total}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Phí vận chuyển:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px;\">{delivery_fee}</td>\r\n    </tr>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <td style=\"padding: 5px 6px; border: 1px solid #333; font-size: 11px;\"><strong>COD - THU HỘ:</strong></td>\r\n      <td style=\"padding: 5px 6px; border: 1px solid #333; text-align: right; font-size: 11px;\"><strong>{cod_amount}</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin: 8px 0; padding: 8px; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 25px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 50%; text-align: center; padding: 8px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; font-size: 11px;\">Người giao</div>\r\n        <div style=\"color: #888; font-size: 10px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 50px;\"></div>\r\n        <div style=\"font-size: 11px;\">{shipper_name}</div>\r\n      </td>\r\n      <td style=\"width: 50%; text-align: center; padding: 8px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; font-size: 11px;\">Người nhận</div>\r\n        <div style=\"color: #888; font-size: 10px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 50px;\"></div>\r\n        <div style=\"font-size: 11px;\">{receiver_name}</div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333; font-size: 10px; color: #666;\">\r\n  <div>Cảm ơn quý khách!</div>\r\n  <div>Hotline: {store_phone_number} | In lúc: {print_date} {print_time}</div>\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,MAAM,oBAAoB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuIlC,CAAC"}},
    {"offset": {"line": 7067, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/shipping-label.ts"],"sourcesContent":["/**\r\n * Mẫu in Nhãn giao hàng - TipTap compatible\r\n * Cập nhật: Thiết kế đen trắng cho máy in\r\n */\r\nexport const SHIPPING_LABEL_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 13px; line-height: 1.4; max-width: 400px; margin: 0 auto; border: 2px solid #333; padding: 15px;\">\r\n\r\n<!-- HEADER -->\r\n<div style=\"text-align: center; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 2px dashed #333;\">\r\n  <div style=\"font-size: 14px; font-weight: bold;\">{store_name}</div>\r\n  <div style=\"font-size: 12px;\">{store_phone_number}</div>\r\n</div>\r\n\r\n<!-- MÃ VẬN ĐƠN -->\r\n<div style=\"text-align: center; margin-bottom: 10px; padding: 10px; background: #f5f5f5;\">\r\n  <div style=\"margin-bottom: 8px;\">{shipment_barcode}</div>\r\n  <div style=\"font-size: 18px; font-weight: bold; font-family: monospace;\">{shipment_code}</div>\r\n  <div style=\"font-size: 12px;\">Đơn: {order_code}</div>\r\n</div>\r\n\r\n<!-- NGƯỜI GỬI -->\r\n<div style=\"margin-bottom: 10px; padding: 8px; background: #f5f5f5;\">\r\n  <div style=\"font-weight: bold; font-size: 11px;\">Gửi:</div>\r\n  <div><strong>{store_name}</strong></div>\r\n  <div style=\"font-size: 11px;\">{store_address}</div>\r\n</div>\r\n\r\n<!-- NGƯỜI NHẬN -->\r\n<div style=\"margin-bottom: 10px; padding: 10px; border: 1px solid #333;\">\r\n  <div style=\"font-weight: bold; font-size: 11px;\">Nhận:</div>\r\n  <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{customer_name}</div>\r\n  <div style=\"font-size: 14px; font-weight: bold;\">{customer_phone_number}</div>\r\n  <div style=\"font-size: 12px;\">{shipping_address}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN KIỆN -->\r\n<table style=\"width: 100%; margin-bottom: 10px; border-collapse: collapse;\">\r\n  <tr>\r\n    <td style=\"text-align: center; padding: 8px; background: #f5f5f5; width: 50%; border: 1px solid #333;\">\r\n      <div style=\"font-size: 11px;\">Số lượng</div>\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{total_quantity}</div>\r\n    </td>\r\n    <td style=\"text-align: center; padding: 8px; background: #f5f5f5; width: 50%; border: 1px solid #333;\">\r\n      <div style=\"font-size: 11px;\">Khối lượng</div>\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{total_weight_g}g</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- COD -->\r\n<div style=\"text-align: center; padding: 12px; border: 2px solid #333; margin-bottom: 10px;\">\r\n  <div style=\"font-size: 12px; font-weight: bold;\">THU HỘ (COD)</div>\r\n  <div style=\"font-size: 22px; font-weight: bold;\">{cod}</div>\r\n</div>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"font-size: 11px;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n</div>\r\n`;\r\n\r\n/**\r\n * Mẫu nhãn nhỏ - compact\r\n */\r\nexport const SHIPPING_LABEL_TEMPLATE_SMALL = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 11px; line-height: 1.3; max-width: 300px; padding: 10px; border: 1px solid #333;\">\r\n  <div style=\"text-align: center; margin-bottom: 8px;\">{shipment_barcode}</div>\r\n  <div style=\"text-align: center; font-weight: bold; font-family: monospace; margin-bottom: 10px;\">{shipment_code}</div>\r\n  <div style=\"border-top: 1px dashed #333; padding-top: 8px;\">\r\n    <div><strong>{customer_name}</strong></div>\r\n    <div>{customer_phone_number}</div>\r\n    <div style=\"font-size: 10px;\">{shipping_address}</div>\r\n  </div>\r\n  <div style=\"text-align: center; margin-top: 10px; padding: 5px; background: #f5f5f5; font-weight: bold;\">\r\n    COD: {cod}\r\n  </div>\r\n</div>\r\n`;\r\n\r\n/**\r\n * Mẫu nhãn lớn - đầy đủ thông tin\r\n */\r\nexport const SHIPPING_LABEL_TEMPLATE_LARGE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 13px; line-height: 1.4; max-width: 500px; margin: 0 auto; border: 3px solid #333; padding: 20px;\">\r\n\r\n<!-- HEADER -->\r\n<div style=\"text-align: center; margin-bottom: 10px; padding-bottom: 15px; border-bottom: 2px solid #333;\">\r\n  <div style=\"font-size: 18px; font-weight: bold;\">{store_name}</div>\r\n  <div>{store_phone_number}</div>\r\n</div>\r\n\r\n<!-- MÃ VẠCH + QR -->\r\n<table style=\"width: 100%; margin-bottom: 20px;\">\r\n  <tr>\r\n    <td style=\"text-align: center; width: 60%;\">{shipment_barcode}</td>\r\n    <td style=\"text-align: center; width: 40%;\">{shipment_qrcode}</td>\r\n  </tr>\r\n</table>\r\n\r\n<div style=\"text-align: center; margin-bottom: 20px;\">\r\n  <div style=\"font-size: 28px; font-weight: bold; font-family: monospace;\">{shipment_code}</div>\r\n  <div>Đơn: {order_code}</div>\r\n</div>\r\n\r\n<!-- NGƯỜI GỬI / NHẬN -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 20px;\">\r\n  <tr>\r\n    <td style=\"padding: 15px; background: #f5f5f5; border: 1px solid #333; vertical-align: top; width: 50%;\">\r\n      <div style=\"font-weight: bold; margin-bottom: 5px;\">NGƯỜI GỬI</div>\r\n      <div><strong>{store_name}</strong></div>\r\n      <div>{store_phone_number}</div>\r\n      <div style=\"font-size: 11px;\">{store_address}</div>\r\n    </td>\r\n    <td style=\"padding: 15px; border: 2px solid #333; vertical-align: top; width: 50%;\">\r\n      <div style=\"font-weight: bold; margin-bottom: 5px;\">NGƯỜI NHẬN</div>\r\n      <div style=\"font-size: 16px;\"><strong>{customer_name}</strong></div>\r\n      <div style=\"font-size: 15px; font-weight: bold;\">{customer_phone_number}</div>\r\n      <div style=\"font-size: 12px;\">{shipping_address}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- THÔNG TIN KIỆN -->\r\n<table style=\"width: 100%; margin-bottom: 10px; border-collapse: collapse;\">\r\n  <tr>\r\n    <td style=\"text-align: center; padding: 15px; background: #f5f5f5; width: 50%; border: 1px solid #333;\">\r\n      <div style=\"font-size: 12px;\">Số lượng</div>\r\n      <div style=\"font-size: 24px; font-weight: bold;\">{total_quantity}</div>\r\n    </td>\r\n    <td style=\"text-align: center; padding: 15px; background: #f5f5f5; width: 50%; border: 1px solid #333;\">\r\n      <div style=\"font-size: 12px;\">Khối lượng</div>\r\n      <div style=\"font-size: 24px; font-weight: bold;\">{total_weight_kg} kg</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- COD -->\r\n<div style=\"text-align: center; padding: 20px; border: 3px solid #333; margin-bottom: 10px;\">\r\n  <div style=\"font-size: 14px; font-weight: bold;\">THU HỘ (COD)</div>\r\n  <div style=\"font-size: 32px; font-weight: bold;\">{cod}</div>\r\n</div>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"padding: 10px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;AACM,MAAM,0BAA0B,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyDxC,CAAC;AAKM,MAAM,gCAAgC,CAAC;;;;;;;;;;;;;AAa9C,CAAC;AAKM,MAAM,gCAAgC,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkE9C,CAAC"}},
    {"offset": {"line": 7221, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/product-label.ts"],"sourcesContent":["/**\r\n * Mẫu in Tem phụ sản phẩm (product label)\r\n * Thiết kế theo mẫu tem phụ nhập khẩu chuẩn\r\n */\r\nexport const PRODUCT_LABEL_TEMPLATE = `\r\n<div style=\"font-family: 'Inter', Arial, sans-serif; width: 320px; background: #fff; padding: 16px; line-height: 1.5; font-size: 13px; color: #111;\">\r\n  <!-- TÊN SẢN PHẨM -->\r\n  <div style=\"margin-bottom: 12px;\">\r\n    <span style=\"font-weight: 700;\">TÊN SẢN PHẨM:</span> {product_name_vat}\r\n  </div>\r\n\r\n  <!-- THƯƠNG HIỆU & ĐỊA CHỈ SẢN XUẤT -->\r\n  <div style=\"margin-bottom: 8px;\">\r\n    <span style=\"font-weight: 700;\">Thương Hiệu:</span> {product_brand}. <span style=\"font-weight: 700;\">Địa chỉ sản xuất:</span> {product_origin}\r\n  </div>\r\n\r\n  <!-- HƯỚNG DẪN SỬ DỤNG -->\r\n  <div style=\"margin-bottom: 8px;\">\r\n    <span style=\"font-weight: 700;\">Hướng Dẫn sử dụng:</span> {product_usage_guide}\r\n  </div>\r\n\r\n  <!-- ĐƠN VỊ NHẬP KHẨU -->\r\n  <div style=\"margin-bottom: 8px;\">\r\n    <span style=\"font-weight: 700;\">ĐƠN VỊ NHẬP KHẨU:</span> {product_importer_name}\r\n  </div>\r\n\r\n  <!-- ĐỊA CHỈ NHẬP KHẨU -->\r\n  <div style=\"margin-bottom: 12px;\">\r\n    <span style=\"font-weight: 700;\">Địa chỉ:</span> {product_importer_address}\r\n  </div>\r\n\r\n  <!-- BARCODE -->\r\n  <div style=\"display: flex; align-items: center; gap: 12px; padding-top: 8px; border-top: 1px dashed #ccc;\">\r\n    <div style=\"flex: 1;\">\r\n      {product_barcode_image}\r\n      <div style=\"font-size: 11px; margin-top: 2px;\">{product_barcode}</div>\r\n    </div>\r\n  </div>\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,MAAM,yBAAyB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCvC,CAAC"}},
    {"offset": {"line": 7268, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/stock-in.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu nhập kho - TipTap compatible\r\n * Cập nhật: Thiết kế đen trắng cho máy in\r\n */\r\nexport const STOCK_IN_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"width: 80px; vertical-align: top;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div>{store_address}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 15px 0 5px 0; font-size: 14px; font-weight: bold; margin-bottom: 2px; border-bottom: 2px solid #333; padding-bottom: 10px;\">PHIẾU NHẬP KHO</h2>\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div>Mã: <strong>{stock_in_code}</strong></div>\r\n  <div>Đơn đặt hàng: <strong>{order_supplier_code}</strong></div>\r\n  <div>Ngày: {created_on}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN NHẬP KHO -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333;\">Kho nhập:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{location_name}</strong></td>\r\n      <td style=\"padding: 5px; width: 15%; background: #f5f5f5; border: 1px solid #333;\">Trạng thái:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{stock_in_status}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Nhà cung cấp:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{supplier_name}</strong></td>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Mã NCC:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; font-family: monospace;\">{supplier_code}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Người tạo:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\" colspan=\"3\">{account_name}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẢNG SẢN PHẨM -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <thead>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 35px;\">STT</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 90px;\">Mã SP</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: left;\">Tên sản phẩm</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 50px;\">ĐVT</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 55px;\">SL Đặt</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 55px;\">SL Nhập</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: right; width: 90px;\">Đơn giá</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: right; width: 100px;\">Thành tiền</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\">{line_stt}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center; font-family: monospace;\">{line_variant_code}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333;\">{line_product_name}<br><small>{line_variant}</small></td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\">{line_unit}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\">{line_ordered_quantity}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center; font-weight: bold;\">{line_received_quantity}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: right;\">{line_price}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: right;\">{line_total}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- TỔNG TIỀN -->\r\n<table style=\"width: 250px; margin-left: auto; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Tổng tiền hàng:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right; width: 100px;\">{total}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Chiết khấu:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\">{discount}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Thuế VAT:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\">{tax_vat}</td>\r\n    </tr>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>TỔNG CỘNG:</strong></td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\"><strong>{total_order}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Đã thanh toán:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\">{paid}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Còn phải trả:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\"><strong>{remaining}</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin: 10px 0; padding: 10px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 30px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Người giao</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n      </td>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Thủ kho</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n      </td>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Người lập</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {account_name}\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333; font-size: 11px;\">\r\n  In lúc: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,MAAM,oBAAoB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyIlC,CAAC"}},
    {"offset": {"line": 7417, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/supplier-return.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu trả hàng NCC - TipTap compatible\r\n * Cập nhật: Thiết kế đen trắng cho máy in\r\n */\r\nexport const SUPPLIER_RETURN_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"width: 80px; vertical-align: top;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div>{store_address}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 15px 0 5px 0; font-size: 14px; font-weight: bold; margin-bottom: 2px; border-bottom: 2px solid #333; padding-bottom: 10px;\">PHIẾU TRẢ HÀNG NHÀ CUNG CẤP</h2>\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div>Mã: <strong>{return_supplier_code}</strong></div>\r\n  <div>Ngày: {created_on}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN NHÀ CUNG CẤP -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333;\">Nhà cung cấp:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{supplier_name}</strong></td>\r\n      <td style=\"padding: 5px; width: 15%; background: #f5f5f5; border: 1px solid #333;\">Mã NCC:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; font-family: monospace;\">{supplier_code}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Điện thoại:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{supplier_phone_number}</td>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Email:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{supplier_email}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Địa chỉ:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\" colspan=\"3\">{supplier_address}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Lý do trả:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\" colspan=\"3\"><strong>{reason_return}</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẢNG SẢN PHẨM TRẢ -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <thead>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 40px;\">STT</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 100px;\">Mã SP</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: left;\">Tên sản phẩm</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 60px;\">ĐVT</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: center; width: 60px;\">SL Trả</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: right; width: 100px;\">Đơn giá</th>\r\n      <th style=\"padding: 8px; border: 1px solid #333; text-align: right; width: 110px;\">Thành tiền</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\">{line_stt}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center; font-family: monospace;\">{line_variant_code}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333;\">{line_product_name}<br><small>{line_variant}</small></td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center;\">{line_unit}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: center; font-weight: bold;\">{line_quantity}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: right;\">{line_price}</td>\r\n      <td style=\"padding: 6px; border: 1px solid #333; text-align: right;\">{line_total}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- TỔNG GIÁ TRỊ -->\r\n<table style=\"width: 250px; margin-left: auto; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <td style=\"padding: 8px; border: 1px solid #333;\"><strong>TỔNG GIÁ TRỊ TRẢ:</strong></td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: right; width: 100px;\"><strong>{total_order}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Đã nhận hoàn:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\">{refunded}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">Còn phải nhận:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\"><strong>{remaining}</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin: 10px 0; padding: 10px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 30px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Đại diện NCC</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n      </td>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Thủ kho</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n      </td>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Người lập</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {account_name}\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333; font-size: 11px;\">\r\n  In lúc: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,MAAM,2BAA2B,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8HzC,CAAC"}},
    {"offset": {"line": 7555, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/complaint.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu khiếu nại - TipTap compatible\r\n * Cập nhật: Thiết kế đen trắng cho máy in\r\n */\r\nexport const COMPLAINT_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"width: 80px; vertical-align: top;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div>{store_address}</div>\r\n      <div>Hotline: <strong>{store_phone_number}</strong></div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 15px 0 5px 0; font-size: 14px; font-weight: bold; margin-bottom: 2px; border-bottom: 2px solid #333; padding-bottom: 10px;\">PHIẾU KHIẾU NẠI</h2>\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div>Mã phiếu: <strong>{complaint_code}</strong></div>\r\n  <div>Ngày: {created_on}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN KHÁCH HÀNG -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333;\">Khách hàng:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{customer_name}</strong></td>\r\n      <td style=\"padding: 5px; width: 15%; background: #f5f5f5; border: 1px solid #333;\">SĐT:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{customer_phone_number}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Email:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{customer_email}</td>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Địa chỉ:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{customer_address}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- THÔNG TIN ĐƠN HÀNG -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333;\">Mã đơn hàng:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{order_code}</strong></td>\r\n      <td style=\"padding: 5px; width: 15%; background: #f5f5f5; border: 1px solid #333;\">Ngày mua:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{order_date}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- NỘI DUNG KHIẾU NẠI -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed; border: 2px solid #333;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; width: 25%; background: #f5f5f5; border: 1px solid #333;\">Loại khiếu nại:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\"><strong>{complaint_type}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333;\">Sản phẩm:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{line_product_name} - <small>{line_variant}</small></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333;\">Mô tả vấn đề:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{complaint_description}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333;\">Yêu cầu của KH:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\"><strong>{customer_request}</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- XỬ LÝ KHIẾU NẠI -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333;\">Trạng thái:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{complaint_status}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Phương án xử lý:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{resolution}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Người xử lý:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{assignee_name}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Ngày hoàn thành:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{resolved_on}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin: 10px 0; padding: 10px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {complaint_note}\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 30px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Khách hàng</strong><br>\r\n        <em>(Ký xác nhận)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {customer_name}\r\n      </td>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Người xử lý</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {assignee_name}\r\n      </td>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Quản lý</strong><br>\r\n        <em>(Ký duyệt)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333; font-size: 11px;\">\r\n  Cảm ơn quý khách đã phản hồi. Chúng tôi sẽ xử lý trong thời gian sớm nhất!\r\n\n  <div style=\"font-size: 10px; color: #666; margin-top: 5px;\">In lúc: {print_date} {print_time}</div></div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,MAAM,qBAAqB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqInC,CAAC"}},
    {"offset": {"line": 7700, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/penalty.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu phạt - TipTap compatible\r\n * Cập nhật: Thiết kế đen trắng cho máy in\r\n */\r\nexport const PENALTY_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"width: 80px; vertical-align: top;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div>{store_address}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 15px 0 5px 0; font-size: 14px; font-weight: bold; margin-bottom: 2px; border-bottom: 2px solid #333; padding-bottom: 10px;\">PHIẾU XỬ PHẠT</h2>\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div>Số: <strong>{penalty_code}</strong></div>\r\n  <div>Ngày: {created_on}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN NGƯỜI BỊ PHẠT -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333;\">Họ và tên:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{employee_name}</strong></td>\r\n      <td style=\"padding: 5px; width: 15%; background: #f5f5f5; border: 1px solid #333;\">Mã NV:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; font-family: monospace;\">{employee_code}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Bộ phận:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{department_name}</td>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Chức vụ:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{position_name}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- NỘI DUNG VI PHẠM -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; background: #f5f5f5; border: 1px solid #333;\">Loại vi phạm:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{violation_type}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Ngày vi phạm:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{violation_date}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Mô tả vi phạm:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{violation_description}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Bằng chứng:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{evidence}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- HÌNH THỨC XỬ PHẠT -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed; border: 2px solid #333;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; width: 30%; background: #f5f5f5; border: 1px solid #333;\">Hình thức:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\"><strong>{penalty_type}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333;\">Lần vi phạm:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">Lần thứ <strong>{violation_count}</strong></td>\r\n    </tr>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <td style=\"padding: 12px; border: 1px solid #333;\"><strong>SỐ TIỀN PHẠT:</strong></td>\r\n      <td style=\"padding: 12px; border: 1px solid #333; font-size: 18px; font-weight: bold;\">{penalty_amount}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">Bằng chữ:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; font-style: italic;\">{penalty_amount_text}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin: 10px 0; padding: 10px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {penalty_note}\r\n</div>\r\n\r\n<!-- CĂN CỨ PHÁP LÝ -->\r\n<div style=\"margin: 10px 0; padding: 10px; border: 1px solid #333; font-size: 12px;\">\r\n  <strong>Căn cứ pháp lý:</strong> Theo quy định nội bộ công ty và Bộ luật Lao động Việt Nam.\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 30px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Người vi phạm</strong><br>\r\n        <em>(Ký xác nhận)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n        {employee_name}\r\n      </td>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Trưởng bộ phận</strong><br>\r\n        <em>(Ký, ghi rõ họ tên)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n      </td>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px;\">\r\n        <strong>Giám đốc</strong><br>\r\n        <em>(Ký duyệt)</em><br>\r\n        <div style=\"height: 50px;\"></div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333; font-size: 11px;\">\r\n  Phiếu này được lập thành 02 bản, mỗi bên giữ 01 bản có giá trị như nhau.\r\n\n  <div style=\"font-size: 10px; color: #666; margin-top: 5px;\">In lúc: {print_date} {print_time}</div></div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,MAAM,mBAAmB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4HjC,CAAC"}},
    {"offset": {"line": 7836, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/cost-adjustment.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu điều chỉnh giá vốn - TipTap compatible\r\n * Cập nhật: Thiết kế đen trắng cho máy in\r\n */\r\nexport const COST_ADJUSTMENT_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<table style=\"width: 100%; margin-bottom: 10px;\">\r\n  <tr>\r\n    <td style=\"width: 80px; vertical-align: top;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div>{store_address}</div>\r\n      <div>ĐT: {store_phone}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 15px 0 5px 0; font-size: 16px; font-weight: bold; border-bottom: 2px solid #333; padding-bottom: 10px;\">PHIẾU ĐIỀU CHỈNH GIÁ VỐN</h2>\r\n<div style=\"text-align: center; margin-bottom: 15px;\">\r\n  <div>Số: <strong>{adjustment_code}</strong></div>\r\n  <div>Ngày: {created_on} {created_on_time}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN CHI NHÁNH -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 15px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 5px; width: 25%; background: #f5f5f5; border: 1px solid #333;\">Chi nhánh:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{location_name}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Địa chỉ:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{location_address}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Lý do điều chỉnh:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\"><strong>{reason}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Trạng thái:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{status}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- DANH SÁCH SẢN PHẨM -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 15px; font-size: 11px;\">\r\n  <thead>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <th style=\"padding: 6px; border: 1px solid #333; text-align: center; width: 30px;\">STT</th>\r\n      <th style=\"padding: 6px; border: 1px solid #333; text-align: left;\">Mã SP</th>\r\n      <th style=\"padding: 6px; border: 1px solid #333; text-align: left;\">Tên sản phẩm</th>\r\n      <th style=\"padding: 6px; border: 1px solid #333; text-align: center; width: 50px;\">ĐVT</th>\r\n      <th style=\"padding: 6px; border: 1px solid #333; text-align: right;\">Giá vốn cũ</th>\r\n      <th style=\"padding: 6px; border: 1px solid #333; text-align: right;\">Giá vốn mới</th>\r\n      <th style=\"padding: 6px; border: 1px solid #333; text-align: right;\">Chênh lệch</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr data-line-item>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: center;\">{line_stt}</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; font-family: monospace;\">{line_variant_code}</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333;\">{line_product_name}</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: center;\">{line_unit}</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\">{line_old_price}</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\">{line_new_price}</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\">{line_difference}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- TỔNG KẾT -->\r\n<table style=\"width: 50%; margin-left: auto; border-collapse: collapse; margin-bottom: 15px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Tổng số sản phẩm:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right;\"><strong>{total_items}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Tổng tăng giá vốn:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right; color: green;\">{total_increase}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px; background: #f5f5f5; border: 1px solid #333;\">Tổng giảm giá vốn:</td>\r\n      <td style=\"padding: 5px; border: 1px solid #333; text-align: right; color: red;\">{total_decrease}</td>\r\n    </tr>\r\n    <tr style=\"font-weight: bold; font-size: 13px;\">\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333;\">CHÊNH LỆCH:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: right;\">{total_difference}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin: 15px 0; padding: 10px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 30px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 50%; text-align: center;\">\r\n        <strong>Người lập phiếu</strong>\r\n        <div style=\"margin-top: 50px; font-style: italic;\">{account_name}</div>\r\n      </td>\r\n      <td style=\"width: 50%; text-align: center;\">\r\n        <strong>Người xác nhận</strong>\r\n        <div style=\"margin-top: 50px; font-style: italic;\">{confirmed_by}</div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- NGÀY IN -->\r\n<div style=\"text-align: right; margin-top: 20px; font-size: 10px; color: #666;\">\r\n  In ngày: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,MAAM,2BAA2B,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuHzC,CAAC"}},
    {"offset": {"line": 7967, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/payroll.ts"],"sourcesContent":["/**\r\n * Payroll Template - Bảng lương\r\n * Mẫu in mặc định theo chuẩn TEMPLATE v2\r\n * \r\n * QUAN TRỌNG - Quy tắc template:\r\n * 1. Bảng chứa {line_stt} hoặc {line_index} là bảng line items - sẽ được lặp theo số nhân viên\r\n * 2. Các bảng khác là bảng thông tin - không lặp\r\n * 3. Sử dụng inline styles để đảm bảo hiển thị đúng khi in\r\n * \r\n * CHUẨN TEMPLATE v2 (2025-12-08):\r\n * - Header: Logo trái + Store info phải (dạng table)\r\n * - Title: Căn giữa, border-bottom\r\n * - Info table: Label 22% nền xám\r\n * - Product table: table-layout fixed, responsive\r\n * - Summary: 280px căn phải\r\n * - Footer: border-top dashed, font nhỏ\r\n */\r\nexport const PAYROLL_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 900px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER: Logo trái + Thông tin cửa hàng phải -->\r\n<table style=\"width: 100%; margin-bottom: 12px; border-collapse: collapse;\">\r\n  <tr>\r\n    <td style=\"width: 70px; vertical-align: top; padding-right: 10px;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div style=\"font-size: 11px; color: #333;\">{store_address}</div>\r\n      <div style=\"font-size: 11px; color: #333;\">ĐT: {store_phone_number} | Email: {store_email}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 12px 0 5px 0; font-size: 16px; font-weight: bold; border-bottom: 2px solid #333; padding-bottom: 8px;\">BẢNG LƯƠNG TỔNG HỢP</h2>\r\n<div style=\"text-align: center; margin-bottom: 12px; font-size: 12px;\">\r\n  <div><strong>{batch_title}</strong></div>\r\n  <div>Mã: <strong>{batch_code}</strong> | Kỳ lương: <strong>{pay_period}</strong></div>\r\n</div>\r\n\r\n<!-- THÔNG TIN BẢNG LƯƠNG -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 20%; border: 1px solid #333; font-size: 11px;\">Trạng thái:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\"><strong>{batch_status}</strong></td>\r\n      <td style=\"padding: 4px 6px; width: 20%; border: 1px solid #333; font-size: 11px;\">Ngày thanh toán:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{payroll_date}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Tháng chấm công:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{reference_months}</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Số nhân viên:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\"><strong>{total_employees}</strong> người</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Người lập:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{created_by}</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Ngày lập:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{created_on}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Ghi chú:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\" colspan=\"3\">{notes}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẢNG CHI TIẾT LƯƠNG TỪNG NHÂN VIÊN - Table layout fixed -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <thead>\r\n    <tr>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: center; width: 28px; font-size: 10px;\">STT</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: left; width: 58px; font-size: 10px;\">Mã NV</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: left; font-size: 10px;\">Họ tên</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: left; width: 80px; font-size: 10px;\">Phòng ban</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: right; width: 72px; font-size: 10px;\">Thu nhập</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: right; width: 55px; font-size: 10px;\">Bảo hiểm</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: right; width: 60px; font-size: 10px;\">Thuế TNCN</th>\r\n      <th style=\"padding: 5px 3px; border: 1px solid #333; text-align: right; width: 72px; font-size: 10px; font-weight: bold;\">Thực lĩnh</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: center; font-size: 10px;\">{line_stt}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; font-size: 10px;\">{employee_code}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; font-size: 10px; word-wrap: break-word;\">{employee_name}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; font-size: 10px; word-wrap: break-word;\">{department_name}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: right; font-size: 10px;\">{earnings}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: right; font-size: 10px;\">{total_insurance}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: right; font-size: 10px;\">{personal_income_tax}</td>\r\n      <td style=\"padding: 4px 3px; border: 1px solid #333; text-align: right; font-size: 10px; font-weight: bold;\">{net_pay}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẢNG TỔNG KẾT -->\r\n<table style=\"width: 300px; margin-left: auto; border-collapse: collapse; margin-bottom: 10px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Tổng thu nhập:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; width: 120px; font-size: 11px;\">{total_earnings}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Tổng bảo hiểm (NV):</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px;\">{total_insurance}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Tổng thuế TNCN:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px;\">{total_tax}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Tổng khấu trừ:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px;\">{total_deductions}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Đóng góp (DN):</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px;\">{total_contributions}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 5px 6px; border: 1px solid #333; font-size: 12px; font-weight: bold; background: #f0f0f0;\">TỔNG THỰC LĨNH:</td>\r\n      <td style=\"padding: 5px 6px; border: 1px solid #333; text-align: right; font-size: 12px; font-weight: bold; background: #f0f0f0;\">{total_net}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẰNG CHỮ -->\r\n<p style=\"font-style: italic; margin: 10px 0; font-size: 11px;\">\r\n  <strong>Bằng chữ:</strong> {total_net_text}\r\n</p>\r\n\r\n<!-- FOOTER: Chữ ký -->\r\n<table style=\"width: 100%; margin-top: 25px; border-collapse: collapse;\">\r\n  <tr>\r\n    <td style=\"width: 33%; text-align: center; padding: 5px; vertical-align: top;\">\r\n      <div style=\"font-weight: bold; margin-bottom: 50px; font-size: 11px;\">Người lập</div>\r\n      <div style=\"font-size: 11px;\">{created_by}</div>\r\n    </td>\r\n    <td style=\"width: 33%; text-align: center; padding: 5px; vertical-align: top;\">\r\n      <div style=\"font-weight: bold; margin-bottom: 50px; font-size: 11px;\">Kế toán trưởng</div>\r\n      <div style=\"font-size: 11px;\"></div>\r\n    </td>\r\n    <td style=\"width: 33%; text-align: center; padding: 5px; vertical-align: top;\">\r\n      <div style=\"font-weight: bold; margin-bottom: 50px; font-size: 11px;\">Giám đốc</div>\r\n      <div style=\"font-size: 11px;\"></div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- NGÀY IN -->\r\n<div style=\"margin-top: 15px; padding-top: 8px; border-top: 1px dashed #ccc; font-size: 10px; color: #666; text-align: right;\">\r\n  Ngày in: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;CAgBC;;;;AACM,MAAM,mBAAmB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyIjC,CAAC"}},
    {"offset": {"line": 8129, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/payslip.ts"],"sourcesContent":["/**\r\n * Payslip Template - Phiếu lương cá nhân\r\n * Mẫu in mặc định theo chuẩn TEMPLATE v2\r\n * \r\n * QUAN TRỌNG - Quy tắc template:\r\n * 1. Bảng chứa {line_stt} là bảng line items - sẽ được lặp theo số components\r\n * 2. Các bảng khác là bảng thông tin - không lặp\r\n * 3. Sử dụng inline styles để đảm bảo hiển thị đúng khi in\r\n * \r\n * CHUẨN TEMPLATE v2 (2025-12-08):\r\n * - Header: Logo trái + Store info phải (dạng table)\r\n * - Title: Căn giữa, border-bottom\r\n * - Info table: Label 22% nền xám\r\n * - Component table: table-layout fixed, responsive\r\n * - Summary: 280px căn phải\r\n * - Footer: border-top dashed, font nhỏ\r\n */\r\nexport const PAYSLIP_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 700px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER: Logo trái + Thông tin cửa hàng phải -->\r\n<table style=\"width: 100%; margin-bottom: 12px; border-collapse: collapse;\">\r\n  <tr>\r\n    <td style=\"width: 70px; vertical-align: top; padding-right: 10px;\">{store_logo}</td>\r\n    <td style=\"vertical-align: top;\">\r\n      <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n      <div style=\"font-size: 11px; color: #333;\">{store_address}</div>\r\n      <div style=\"font-size: 11px; color: #333;\">ĐT: {store_phone_number} | Email: {store_email}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 12px 0 5px 0; font-size: 16px; font-weight: bold; border-bottom: 2px solid #333; padding-bottom: 8px;\">PHIẾU LƯƠNG</h2>\r\n<div style=\"text-align: center; margin-bottom: 12px; font-size: 12px;\">\r\n  <div>Kỳ lương: <strong>{pay_period}</strong></div>\r\n  <div>Mã phiếu: <strong>{payslip_code}</strong></div>\r\n</div>\r\n\r\n<!-- THÔNG TIN NHÂN VIÊN -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; width: 22%; border: 1px solid #333; font-size: 11px; background: #f5f5f5;\">Mã nhân viên:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\"><strong>{employee_code}</strong></td>\r\n      <td style=\"padding: 4px 6px; width: 22%; border: 1px solid #333; font-size: 11px; background: #f5f5f5;\">Họ và tên:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\"><strong>{employee_name}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px; background: #f5f5f5;\">Phòng ban:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{department_name}</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px; background: #f5f5f5;\">Chức vụ:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{position}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px; background: #f5f5f5;\">Bảng lương:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\" colspan=\"3\">{batch_title} ({batch_code})</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px; background: #f5f5f5;\">Ngày thanh toán:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{payroll_date}</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px; background: #f5f5f5;\">Kỳ lương:</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">{pay_period}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- THÔNG TIN CHẤM CÔNG -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; background: #f8f9fa;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 6px 8px; border: 1px solid #333; font-size: 11px; width: 25%; background: #e8e8e8; font-weight: bold;\">Ngày công</td>\r\n      <td style=\"padding: 6px 8px; border: 1px solid #333; font-size: 11px; width: 25%; text-align: center;\"><strong>{work_days}</strong> / {standard_work_days}</td>\r\n      <td style=\"padding: 6px 8px; border: 1px solid #333; font-size: 11px; width: 25%; background: #e8e8e8; font-weight: bold;\">Nghỉ phép</td>\r\n      <td style=\"padding: 6px 8px; border: 1px solid #333; font-size: 11px; width: 25%; text-align: center;\">{leave_days} ngày</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 6px 8px; border: 1px solid #333; font-size: 11px; background: #e8e8e8; font-weight: bold;\">Tổng giờ OT</td>\r\n      <td style=\"padding: 6px 8px; border: 1px solid #333; font-size: 11px; text-align: center; color: #0066cc;\"><strong>{ot_hours}h</strong></td>\r\n      <td style=\"padding: 6px 8px; border: 1px solid #333; font-size: 11px; background: #e8e8e8; font-weight: bold;\">Vắng không phép</td>\r\n      <td style=\"padding: 6px 8px; border: 1px solid #333; font-size: 11px; text-align: center;\">{absent_days} ngày</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 6px 8px; border: 1px solid #333; font-size: 11px; background: #e8e8e8;\">OT ngày thường</td>\r\n      <td style=\"padding: 6px 8px; border: 1px solid #333; font-size: 11px; text-align: center;\">{ot_hours_weekday}h</td>\r\n      <td style=\"padding: 6px 8px; border: 1px solid #333; font-size: 11px; background: #e8e8e8;\">Đi trễ/Về sớm</td>\r\n      <td style=\"padding: 6px 8px; border: 1px solid #333; font-size: 11px; text-align: center;\">{late_arrivals} lần / {early_departures} lần</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 6px 8px; border: 1px solid #333; font-size: 11px; background: #e8e8e8;\">OT cuối tuần</td>\r\n      <td style=\"padding: 6px 8px; border: 1px solid #333; font-size: 11px; text-align: center;\">{ot_hours_weekend}h</td>\r\n      <td style=\"padding: 6px 8px; border: 1px solid #333; font-size: 11px; background: #e8e8e8;\">OT ngày lễ</td>\r\n      <td style=\"padding: 6px 8px; border: 1px solid #333; font-size: 11px; text-align: center;\">{ot_hours_holiday}h</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- CHI TIẾT CÁC THÀNH PHẦN LƯƠNG (LINE ITEMS) -->\r\n<h4 style=\"margin: 15px 0 8px 0; font-size: 12px; font-weight: bold; border-bottom: 1px solid #333; padding-bottom: 4px;\">I. CHI TIẾT THU NHẬP</h4>\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px;\">\r\n  <thead>\r\n    <tr style=\"background: #e8e8e8;\">\r\n      <th style=\"padding: 5px 6px; border: 1px solid #333; text-align: center; font-size: 11px; width: 30px;\">STT</th>\r\n      <th style=\"padding: 5px 6px; border: 1px solid #333; text-align: left; font-size: 11px; width: 140px;\">Tên thành phần</th>\r\n      <th style=\"padding: 5px 6px; border: 1px solid #333; text-align: left; font-size: 11px;\">Chi tiết tính</th>\r\n      <th style=\"padding: 5px 6px; border: 1px solid #333; text-align: right; font-size: 11px; width: 110px;\">Số tiền</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: center; font-size: 10px;\">{line_stt}</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 10px;\">{component_name}</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 10px; color: #555;\">{component_formula}</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 10px; font-weight: bold;\">{component_amount}</td>\r\n    </tr>\r\n  </tbody>\r\n  <tfoot>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <td colspan=\"3\" style=\"padding: 5px 6px; border: 1px solid #333; font-size: 11px; font-weight: bold;\">Tổng thu nhập (Gross)</td>\r\n      <td style=\"padding: 5px 6px; border: 1px solid #333; text-align: right; font-size: 11px; font-weight: bold;\">{total_earnings}</td>\r\n    </tr>\r\n  </tfoot>\r\n</table>\r\n\r\n<!-- CÁC KHOẢN KHẤU TRỪ -->\r\n<h4 style=\"margin: 15px 0 8px 0; font-size: 12px; font-weight: bold; border-bottom: 1px solid #333; padding-bottom: 4px;\">II. CÁC KHOẢN KHẤU TRỪ</h4>\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px;\">\r\n  <thead>\r\n    <tr style=\"background: #e8e8e8;\">\r\n      <th style=\"padding: 5px 6px; border: 1px solid #333; text-align: left; font-size: 11px;\">Khoản mục</th>\r\n      <th style=\"padding: 5px 6px; border: 1px solid #333; text-align: right; font-size: 11px; width: 120px;\">Số tiền</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px; padding-left: 10px;\">BHXH (8%)</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px; color: #c00;\">{bhxh_amount}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px; padding-left: 10px;\">BHYT (1.5%)</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px; color: #c00;\">{bhyt_amount}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px; padding-left: 10px;\">BHTN (1%)</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px; color: #c00;\">{bhtn_amount}</td>\r\n    </tr>\r\n    <tr style=\"background: #fff5f5;\">\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px; font-weight: bold;\">Tổng bảo hiểm (10.5%)</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px; font-weight: bold; color: #c00;\">{total_insurance}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px; padding-left: 10px;\">Thuế TNCN</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px; color: #c00;\">{personal_income_tax}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px; padding-left: 10px;\">Khấu trừ phạt</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px; color: #c00;\">{penalty_deductions}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px; padding-left: 10px;\">Khấu trừ khác</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px; color: #c00;\">{other_deductions}</td>\r\n    </tr>\r\n  </tbody>\r\n  <tfoot>\r\n    <tr style=\"background: #fff5f5;\">\r\n      <td style=\"padding: 5px 6px; border: 1px solid #333; font-size: 11px; font-weight: bold;\">Tổng khấu trừ</td>\r\n      <td style=\"padding: 5px 6px; border: 1px solid #333; text-align: right; font-size: 11px; font-weight: bold; color: #c00;\">{total_deductions}</td>\r\n    </tr>\r\n  </tfoot>\r\n</table>\r\n\r\n<!-- TÍNH THUẾ TNCN (Tham khảo) -->\r\n<h4 style=\"margin: 15px 0 8px 0; font-size: 12px; font-weight: bold; border-bottom: 1px solid #333; padding-bottom: 4px;\">III. TÍNH THUẾ TNCN</h4>\r\n<p style=\"font-size: 10px; color: #666; margin: 0 0 8px 0; font-style: italic;\">Công thức: Thu nhập chịu thuế = Tổng thu nhập - BH (NV đóng) - Giảm trừ gia cảnh</p>\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px; width: 60%;\">Mức giảm trừ bản thân (theo luật thuế TNCN)</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px; color: #666;\">{personal_deduction}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px;\">Mức giảm trừ người phụ thuộc ({dependents_count} người × 4.400.000)</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px; color: #666;\">{dependent_deduction}</td>\r\n    </tr>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px; font-weight: bold;\">→ Thu nhập chịu thuế</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px; font-weight: bold;\">{taxable_income}</td>\r\n    </tr>\r\n    <tr style=\"background: #fff5f5;\">\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; font-size: 11px; font-weight: bold;\">→ Thuế TNCN phải nộp</td>\r\n      <td style=\"padding: 4px 6px; border: 1px solid #333; text-align: right; font-size: 11px; font-weight: bold; color: #c00;\">{personal_income_tax}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- THỰC LĨNH -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px;\">\r\n  <tbody>\r\n    <tr style=\"background: #d4edda;\">\r\n      <td style=\"padding: 8px 10px; border: 2px solid #333; font-size: 14px; font-weight: bold; width: 50%;\">THỰC LĨNH</td>\r\n      <td style=\"padding: 8px 10px; border: 2px solid #333; text-align: right; font-size: 14px; font-weight: bold; color: #155724;\">{net_pay}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẰNG CHỮ -->\r\n<p style=\"font-style: italic; margin: 10px 0; font-size: 11px; padding: 8px; border: 1px solid #333; background: #fffde7;\">\r\n  <strong>Số tiền bằng chữ:</strong> {net_pay_text}\r\n</p>\r\n\r\n<!-- FOOTER: Chữ ký -->\r\n<table style=\"width: 100%; margin-top: 25px; border-collapse: collapse;\">\r\n  <tr>\r\n    <td style=\"width: 50%; text-align: center; padding: 5px; vertical-align: top;\">\r\n      <div style=\"font-weight: bold; margin-bottom: 50px; font-size: 11px;\">Người lập phiếu</div>\r\n      <div style=\"font-size: 11px;\"></div>\r\n    </td>\r\n    <td style=\"width: 50%; text-align: center; padding: 5px; vertical-align: top;\">\r\n      <div style=\"font-weight: bold; margin-bottom: 50px; font-size: 11px;\">Người nhận</div>\r\n      <div style=\"font-size: 11px;\">{employee_name}</div>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n<!-- NGÀY IN -->\r\n<div style=\"margin-top: 15px; padding-top: 8px; border-top: 1px dashed #ccc; font-size: 10px; color: #666; text-align: right;\">\r\n  Ngày in: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;;;CAgBC;;;;AACM,MAAM,mBAAmB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqNjC,CAAC"}},
    {"offset": {"line": 8367, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/supplier-order.ts"],"sourcesContent":["/**\r\n * Mẫu in Đơn đặt hàng nhập (Extended) - TipTap compatible\r\n */\r\nexport const SUPPLIER_ORDER_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div style=\"margin-bottom: 5px;\">{store_logo}</div>\r\n  <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n  <div style=\"color: #666;\">{store_address}</div>\r\n  <div style=\"color: #666;\">ĐT: {store_phone_number}</div>\r\n</div>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 20px 0 10px 0; font-size: 18px; text-transform: uppercase; border-bottom: 2px solid #333; padding-bottom: 10px;\">ĐƠN ĐẶT HÀNG NHẬP</h2>\r\n<div style=\"text-align: center; margin-bottom: 20px;\">\r\n  <div style=\"font-size: 14px;\">Số: <strong>{order_supplier_code}</strong></div>\r\n  <div>Ngày: {created_on} {created_on_time}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN NHÀ CUNG CẤP -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; width: 20%; background: #f5f5f5; border: 1px solid #ddd; font-weight: bold;\">Nhà cung cấp:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #ddd;\"><strong>{supplier_name}</strong></td>\r\n      <td style=\"padding: 8px; width: 15%; background: #f5f5f5; border: 1px solid #ddd; font-weight: bold;\">Mã NCC:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #ddd;\">{supplier_code}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #ddd; font-weight: bold;\">Điện thoại:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #ddd;\">{supplier_phone_number}</td>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #ddd; font-weight: bold;\">Email:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #ddd;\">{supplier_email}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #ddd; font-weight: bold;\">Địa chỉ:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #ddd;\" colspan=\"3\">{supplier_address}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #ddd; font-weight: bold;\">Kho nhập:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #ddd;\">{location_name}</td>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #ddd; font-weight: bold;\">Ngày giao dự kiến:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #ddd;\">{expected_on}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẢNG SẢN PHẨM -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <thead>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 40px;\">STT</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 100px;\">Mã SP</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: left;\">Tên sản phẩm</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 60px;\">ĐVT</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 60px;\">SL Đặt</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: right; width: 100px;\">Đơn giá</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: right; width: 110px;\">Thành tiền</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center;\">{line_stt}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center; font-family: monospace;\">{line_variant_code}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{line_product_name}<br><small style=\"color: #666;\">{line_variant}</small></td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center;\">{line_unit}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center; font-weight: bold;\">{line_quantity}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: right;\">{line_price}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: right;\">{line_amount}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- TỔNG GIÁ TRỊ -->\r\n<table style=\"width: 250px; margin-left: auto; border-collapse: collapse; margin-bottom: 20px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">Tổng tiền hàng:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: right; width: 120px;\">{total}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">Chiết khấu:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: right;\">{total_discount}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">Thuế VAT:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: right;\">{total_tax}</td>\r\n    </tr>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <td style=\"padding: 10px; border: 1px solid #333; font-weight: bold; font-size: 14px;\">TỔNG CỘNG:</td>\r\n      <td style=\"padding: 10px; border: 1px solid #333; text-align: right; font-weight: bold; font-size: 14px;\">{total_amount}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin-bottom: 20px; padding: 12px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 40px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; margin-bottom: 5px;\">NGƯỜI LẬP ĐƠN</div>\r\n        <div style=\"color: #888; font-size: 12px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 60px;\"></div>\r\n        <div>{account_name}</div>\r\n      </td>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; margin-bottom: 5px;\">PHÊ DUYỆT</div>\r\n        <div style=\"color: #888; font-size: 12px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 60px;\"></div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"margin-top: 15px; padding-top: 8px; border-top: 1px dashed #ccc; font-size: 10px; color: #666; text-align: center;\">\r\n  In lúc: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;CAEC;;;;AACM,MAAM,0BAA0B,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4HxC,CAAC"}},
    {"offset": {"line": 8502, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/return-order.ts"],"sourcesContent":["/**\r\n * Mẫu in Đơn trả hàng (Extended) - TipTap compatible\r\n */\r\nexport const RETURN_ORDER_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div style=\"margin-bottom: 5px;\">{store_logo}</div>\r\n  <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n  <div style=\"color: #666;\">{store_address}</div>\r\n  <div style=\"color: #666;\">ĐT: {store_phone_number}</div>\r\n</div>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 20px 0 10px 0; font-size: 18px; text-transform: uppercase; border-bottom: 2px solid #333; padding-bottom: 10px;\">PHIẾU TRẢ HÀNG</h2>\r\n<div style=\"text-align: center; margin-bottom: 20px;\">\r\n  <div style=\"font-size: 14px;\">Số: <strong>{return_code}</strong></div>\r\n  <div>Ngày: {created_on} {created_on_time}</div>\r\n  <div>Đơn hàng gốc: <strong>{order_code}</strong></div>\r\n</div>\r\n\r\n<!-- THÔNG TIN KHÁCH HÀNG -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; width: 20%; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Khách hàng:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\"><strong>{customer_name}</strong></td>\r\n      <td style=\"padding: 8px; width: 15%; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Mã KH:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{customer_code}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Điện thoại:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{customer_phone_number}</td>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Email:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{customer_email}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Lý do trả:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\" colspan=\"3\"><strong>{reason}</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẢNG SẢN PHẨM TRẢ -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <thead>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 40px;\">STT</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 100px;\">Mã SP</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: left;\">Tên sản phẩm</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 60px;\">ĐVT</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 60px;\">SL Trả</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: right; width: 100px;\">Đơn giá</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: right; width: 110px;\">Thành tiền</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center;\">{line_stt}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center; font-family: monospace;\">{line_variant_code}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{line_product_name}<br><small style=\"color: #666;\">{line_variant}</small></td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center;\">{line_unit}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center; font-weight: bold;\">{line_quantity}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: right;\">{line_price}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: right;\">{line_amount}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- TỔNG GIÁ TRỊ HOÀN -->\r\n<table style=\"width: 250px; margin-left: auto; border-collapse: collapse; margin-bottom: 20px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">Tổng số lượng trả:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: right; width: 120px;\"><strong>{total_quantity}</strong></td>\r\n    </tr>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <td style=\"padding: 10px; border: 1px solid #333; font-weight: bold; font-size: 14px;\">TỔNG TIỀN HOÀN:</td>\r\n      <td style=\"padding: 10px; border: 1px solid #333; text-align: right; font-weight: bold; font-size: 14px;\">{total_amount}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">Bằng chữ:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: right; font-style: italic;\">{total_text}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">Trạng thái hoàn tiền:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: right;\"><strong>{refund_status}</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin-bottom: 20px; padding: 12px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 40px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; margin-bottom: 5px;\">KHÁCH HÀNG</div>\r\n        <div style=\"color: #888; font-size: 12px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 60px;\"></div>\r\n        <div>{customer_name}</div>\r\n      </td>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; margin-bottom: 5px;\">NGƯỜI NHẬN HÀNG</div>\r\n        <div style=\"color: #888; font-size: 12px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 60px;\"></div>\r\n        <div>{account_name}</div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"margin-top: 15px; padding-top: 8px; border-top: 1px dashed #ccc; font-size: 10px; color: #666; text-align: center;\">\r\n  In lúc: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;CAEC;;;;AACM,MAAM,wBAAwB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwHtC,CAAC"}},
    {"offset": {"line": 8633, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/handover.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu bàn giao (Extended) - TipTap compatible\r\n */\r\nexport const HANDOVER_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div style=\"margin-bottom: 5px;\">{store_logo}</div>\r\n  <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n  <div style=\"color: #666;\">{store_address}</div>\r\n</div>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 20px 0 10px 0; font-size: 18px; text-transform: uppercase; border-bottom: 2px solid #333; padding-bottom: 10px;\">PHIẾU BÀN GIAO</h2>\r\n<div style=\"text-align: center; margin-bottom: 20px;\">\r\n  <div style=\"font-size: 14px;\">Số: <strong>{handover_code}</strong></div>\r\n  <div>Ngày: {created_on} {created_on_time}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN BÀN GIAO -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; width: 20%; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Người bàn giao:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\"><strong>{from_employee}</strong></td>\r\n      <td style=\"padding: 8px; width: 20%; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Bộ phận:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{from_department}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Người nhận:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\"><strong>{to_employee}</strong></td>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Bộ phận:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{to_department}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Loại bàn giao:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{handover_type}</td>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Trạng thái:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\"><strong>{status}</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- BẢNG NỘI DUNG BÀN GIAO -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <thead>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 40px;\">STT</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: left;\">Nội dung bàn giao</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 80px;\">Số lượng</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 100px;\">Tình trạng</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: left; width: 150px;\">Ghi chú</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center;\">{line_stt}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{line_description}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center; font-weight: bold;\">{line_quantity}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center;\">{line_condition}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{line_note}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- GHI CHÚ CHUNG -->\r\n<div style=\"margin-bottom: 20px; padding: 12px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n<!-- CAM KẾT -->\r\n<div style=\"margin-bottom: 20px; padding: 12px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Cam kết:</strong> Hai bên đã kiểm tra và xác nhận đầy đủ các nội dung bàn giao trên. Người nhận cam kết bảo quản và sử dụng đúng mục đích.\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 40px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; margin-bottom: 5px;\">NGƯỜI BÀN GIAO</div>\r\n        <div style=\"color: #888; font-size: 12px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 60px;\"></div>\r\n        <div>{from_employee}</div>\r\n      </td>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; margin-bottom: 5px;\">NGƯỜI NHẬN</div>\r\n        <div style=\"color: #888; font-size: 12px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 60px;\"></div>\r\n        <div>{to_employee}</div>\r\n      </td>\r\n      <td style=\"width: 33%; text-align: center; padding: 10px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; margin-bottom: 5px;\">XÁC NHẬN</div>\r\n        <div style=\"color: #888; font-size: 12px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 60px;\"></div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333; color: #666; font-size: 11px;\">\r\n  Phiếu này được lập thành 02 bản, mỗi bên giữ 01 bản có giá trị như nhau.\r\n\n  <div style=\"font-size: 10px; color: #666; margin-top: 5px;\">In lúc: {print_date} {print_time}</div></div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;CAEC;;;;AACM,MAAM,oBAAoB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyGlC,CAAC"}},
    {"offset": {"line": 8749, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/refund-confirmation.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu xác nhận hoàn (Extended) - TipTap compatible\r\n */\r\nexport const REFUND_CONFIRMATION_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div style=\"margin-bottom: 5px;\">{store_logo}</div>\r\n  <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n  <div style=\"color: #666;\">{store_address}</div>\r\n  <div style=\"color: #666;\">ĐT: {store_phone_number}</div>\r\n</div>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 20px 0 10px 0; font-size: 18px; text-transform: uppercase; border-bottom: 2px solid #333; padding-bottom: 10px;\">PHIẾU XÁC NHẬN HOÀN TIỀN</h2>\r\n<div style=\"text-align: center; margin-bottom: 20px;\">\r\n  <div style=\"font-size: 14px;\">Số: <strong>{refund_code}</strong></div>\r\n  <div>Ngày: {created_on} {created_on_time}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN HOÀN TIỀN -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; width: 25%; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Mã đơn hàng gốc:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\"><strong>{order_code}</strong></td>\r\n      <td style=\"padding: 8px; width: 20%; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Ngày đặt:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{order_date}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Mã phiếu trả:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\"><strong>{return_code}</strong></td>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Ngày trả:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{return_date}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- THÔNG TIN KHÁCH HÀNG -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; width: 25%; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Khách hàng:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\"><strong>{customer_name}</strong></td>\r\n      <td style=\"padding: 8px; width: 20%; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Điện thoại:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{customer_phone_number}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Lý do hoàn:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\" colspan=\"3\">{refund_reason}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- CHI TIẾT HOÀN TIỀN -->\r\n<div style=\"background: #f5f5f5; border: 2px solid #333; padding: 20px; margin-bottom: 20px; text-align: center;\">\r\n  <div style=\"font-size: 14px; color: #666; margin-bottom: 10px;\">SỐ TIỀN HOÀN</div>\r\n  <div style=\"font-size: 28px; font-weight: bold;\">{refund_amount}</div>\r\n  <div style=\"font-style: italic; color: #666; margin-top: 5px;\">({refund_amount_text})</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN HOÀN -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; width: 25%; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Hình thức hoàn:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\"><strong>{refund_method}</strong></td>\r\n      <td style=\"padding: 8px; width: 20%; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Trạng thái:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\"><strong>{refund_status}</strong></td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Ngày hoàn tiền:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{refunded_on}</td>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Người xử lý:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{account_name}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- THÔNG TIN TÀI KHOẢN (nếu chuyển khoản) -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; width: 25%; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Ngân hàng:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{bank_name}</td>\r\n      <td style=\"padding: 8px; width: 20%; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Chi nhánh:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{bank_branch}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Số tài khoản:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\"><strong>{bank_account}</strong></td>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Chủ tài khoản:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{bank_account_name}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin-bottom: 20px; padding: 12px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 40px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; margin-bottom: 5px;\">KHÁCH HÀNG</div>\r\n        <div style=\"color: #888; font-size: 12px; font-style: italic;\">(Ký xác nhận đã nhận tiền)</div>\r\n        <div style=\"height: 60px;\"></div>\r\n        <div>{customer_name}</div>\r\n      </td>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; margin-bottom: 5px;\">NGƯỜI XỬ LÝ</div>\r\n        <div style=\"color: #888; font-size: 12px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 60px;\"></div>\r\n        <div>{account_name}</div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"margin-top: 15px; padding-top: 8px; border-top: 1px dashed #ccc; font-size: 10px; color: #666; text-align: center;\">\r\n  In lúc: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;CAEC;;;;AACM,MAAM,+BAA+B,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8H7C,CAAC"}},
    {"offset": {"line": 8886, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/packing-guide.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu hướng dẫn đóng gói (Extended) - TipTap compatible\r\n */\r\nexport const PACKING_GUIDE_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div style=\"margin-bottom: 5px;\">{store_logo}</div>\r\n  <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n</div>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 20px 0 10px 0; font-size: 18px; text-transform: uppercase; border-bottom: 2px solid #333; padding-bottom: 10px;\">HƯỚNG DẪN ĐÓNG GÓI</h2>\r\n<div style=\"text-align: center; margin-bottom: 20px;\">\r\n  <div style=\"font-size: 14px;\">Đơn hàng: <strong>{order_code}</strong></div>\r\n  <div>Ngày: {created_on}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN NGƯỜI NHẬN -->\r\n<div style=\"background: #f5f5f5; border: 1px solid #333; padding: 15px; margin-bottom: 20px;\">\r\n  <div style=\"font-weight: bold; margin-bottom: 10px;\">THÔNG TIN GIAO HÀNG</div>\r\n  <table style=\"width: 100%;\">\r\n    <tbody>\r\n      <tr>\r\n        <td style=\"padding: 5px 0; width: 120px;\"><strong>Người nhận:</strong></td>\r\n        <td>{customer_name}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 5px 0;\"><strong>Điện thoại:</strong></td>\r\n        <td>{customer_phone_number}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 5px 0;\"><strong>Địa chỉ:</strong></td>\r\n        <td>{shipping_address}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n\r\n<!-- CHECKLIST ĐÓNG GÓI -->\r\n<div style=\"background: #f5f5f5; border: 1px solid #333; padding: 15px; margin-bottom: 20px;\">\r\n  <div style=\"font-weight: bold; margin-bottom: 10px;\">CHECKLIST ĐÓNG GÓI</div>\r\n  <table style=\"width: 100%;\">\r\n    <tbody>\r\n      <tr><td style=\"padding: 5px 0;\">[ ] Kiểm tra đầy đủ sản phẩm theo danh sách</td></tr>\r\n      <tr><td style=\"padding: 5px 0;\">[ ] Kiểm tra tình trạng sản phẩm</td></tr>\r\n      <tr><td style=\"padding: 5px 0;\">[ ] Bọc chống sốc cho sản phẩm dễ vỡ</td></tr>\r\n      <tr><td style=\"padding: 5px 0;\">[ ] Đóng gói chắc chắn, dán kín</td></tr>\r\n      <tr><td style=\"padding: 5px 0;\">[ ] Dán nhãn giao hàng</td></tr>\r\n      <tr><td style=\"padding: 5px 0;\">[ ] Kèm hóa đơn/phiếu giao hàng</td></tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n\r\n<!-- DANH SÁCH SẢN PHẨM -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <thead>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 40px;\">STT</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 100px;\">Mã SP</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: left;\">Tên sản phẩm</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 60px;\">SL</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 100px;\">Vị trí kho</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 60px;\">Đã lấy</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center;\">{line_stt}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center; font-family: monospace;\">{line_variant_code}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{line_product_name}<br><small style=\"color: #666;\">{line_variant}</small></td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center; font-weight: bold; font-size: 16px;\">{line_quantity}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center;\">{bin_location}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center; font-size: 20px;\">[ ]</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- TỔNG QUAN -->\r\n<table style=\"width: 250px; margin-left: auto; border-collapse: collapse; margin-bottom: 20px;\">\r\n  <tbody>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <td style=\"padding: 10px; border: 1px solid #333; font-weight: bold;\">Tổng số lượng:</td>\r\n      <td style=\"padding: 10px; border: 1px solid #333; text-align: right; font-weight: bold; font-size: 16px;\">{total_quantity}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 10px; border: 1px solid #333;\">COD thu hộ:</td>\r\n      <td style=\"padding: 10px; border: 1px solid #333; text-align: right; font-weight: bold;\">{cod}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- LƯU Ý ĐẶC BIỆT -->\r\n<div style=\"background: #f5f5f5; border: 1px solid #333; padding: 15px; margin-bottom: 20px;\">\r\n  <div style=\"font-weight: bold; margin-bottom: 10px;\">LƯU Ý ĐẶC BIỆT</div>\r\n  <div>{packing_note}</div>\r\n  <div style=\"margin-top: 10px; padding-top: 10px; border-top: 1px dashed #333;\">\r\n    <strong>Ghi chú đơn hàng:</strong> {order_note}\r\n  </div>\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 30px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; margin-bottom: 5px;\">NGƯỜI ĐÓNG GÓI</div>\r\n        <div style=\"color: #888; font-size: 12px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 50px;\"></div>\r\n        <div>{account_name}</div>\r\n      </td>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; margin-bottom: 5px;\">KIỂM TRA</div>\r\n        <div style=\"color: #888; font-size: 12px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 50px;\"></div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333; font-size: 10px; color: #666;\">\r\n  In lúc: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;CAEC;;;;AACM,MAAM,yBAAyB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4HvC,CAAC"}},
    {"offset": {"line": 9021, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/sales-summary.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu tổng kết bán hàng (Extended) - TipTap compatible\r\n */\r\nexport const SALES_SUMMARY_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div style=\"margin-bottom: 5px;\">{store_logo}</div>\r\n  <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n  <div style=\"color: #666;\">Chi nhánh: {location_name}</div>\r\n</div>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 20px 0 10px 0; font-size: 18px; text-transform: uppercase; border-bottom: 2px solid #333; padding-bottom: 10px;\">BÁO CÁO TỔNG KẾT BÁN HÀNG</h2>\r\n<div style=\"text-align: center; margin-bottom: 20px;\">\r\n  <div style=\"font-size: 14px;\">Kỳ báo cáo: <strong>{period}</strong></div>\r\n  <div>Từ ngày: {from_date} - Đến ngày: {to_date}</div>\r\n  <div>Người lập: {account_name} | Ngày lập: {created_on}</div>\r\n</div>\r\n\r\n<!-- THỐNG KÊ TỔNG QUAN -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 20px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 25%; padding: 15px; text-align: center; background: #f5f5f5; border: 1px solid #333;\">\r\n        <div style=\"font-size: 12px; color: #666;\">Tổng đơn hàng</div>\r\n        <div style=\"font-size: 24px; font-weight: bold;\">{total_orders}</div>\r\n      </td>\r\n      <td style=\"width: 25%; padding: 15px; text-align: center; background: #f5f5f5; border: 1px solid #333;\">\r\n        <div style=\"font-size: 12px; color: #666;\">Doanh thu</div>\r\n        <div style=\"font-size: 24px; font-weight: bold;\">{total_revenue}</div>\r\n      </td>\r\n      <td style=\"width: 25%; padding: 15px; text-align: center; background: #f5f5f5; border: 1px solid #333;\">\r\n        <div style=\"font-size: 12px; color: #666;\">Chiết khấu</div>\r\n        <div style=\"font-size: 24px; font-weight: bold;\">{total_discount}</div>\r\n      </td>\r\n      <td style=\"width: 25%; padding: 15px; text-align: center; background: #f5f5f5; border: 1px solid #333;\">\r\n        <div style=\"font-size: 12px; color: #666;\">Trả hàng</div>\r\n        <div style=\"font-size: 24px; font-weight: bold;\">{total_returns}</div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- CHI TIẾT DOANH THU -->\r\n<div style=\"background: #f5f5f5; border: 1px solid #333; padding: 15px; margin-bottom: 20px;\">\r\n  <div style=\"font-weight: bold; margin-bottom: 10px; font-size: 14px;\">CHI TIẾT DOANH THU</div>\r\n  <table style=\"width: 100%; border-collapse: collapse;\">\r\n    <tbody>\r\n      <tr>\r\n        <td style=\"padding: 8px; border-bottom: 1px solid #333;\">Doanh thu bán hàng:</td>\r\n        <td style=\"padding: 8px; border-bottom: 1px solid #333; text-align: right; font-weight: bold;\">{sales_revenue}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 8px; border-bottom: 1px solid #333;\">Phí giao hàng thu được:</td>\r\n        <td style=\"padding: 8px; border-bottom: 1px solid #333; text-align: right;\">{delivery_revenue}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 8px; border-bottom: 1px solid #333;\">Thuế VAT:</td>\r\n        <td style=\"padding: 8px; border-bottom: 1px solid #333; text-align: right;\">{total_tax}</td>\r\n      </tr>\r\n      <tr style=\"background: #f5f5f5;\">\r\n        <td style=\"padding: 10px; font-weight: bold; font-size: 14px;\">TỔNG DOANH THU:</td>\r\n        <td style=\"padding: 10px; text-align: right; font-weight: bold; font-size: 16px;\">{total_revenue}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n\r\n<!-- THỐNG KÊ THANH TOÁN -->\r\n<div style=\"background: #f5f5f5; border: 1px solid #333; padding: 15px; margin-bottom: 20px;\">\r\n  <div style=\"font-weight: bold; margin-bottom: 10px; font-size: 14px;\">THỐNG KÊ THANH TOÁN</div>\r\n  <table style=\"width: 100%; border-collapse: collapse;\">\r\n    <tbody>\r\n      <tr>\r\n        <td style=\"padding: 8px; border-bottom: 1px solid #333;\">Tiền mặt:</td>\r\n        <td style=\"padding: 8px; border-bottom: 1px solid #333; text-align: right; font-weight: bold;\">{cash_amount}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 8px; border-bottom: 1px solid #333;\">Chuyển khoản:</td>\r\n        <td style=\"padding: 8px; border-bottom: 1px solid #333; text-align: right;\">{bank_transfer_amount}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 8px; border-bottom: 1px solid #333;\">Thẻ tín dụng:</td>\r\n        <td style=\"padding: 8px; border-bottom: 1px solid #333; text-align: right;\">{card_amount}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 8px; border-bottom: 1px solid #333;\">Ví điện tử:</td>\r\n        <td style=\"padding: 8px; border-bottom: 1px solid #333; text-align: right;\">{ewallet_amount}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 8px; border-bottom: 1px solid #333;\">COD:</td>\r\n        <td style=\"padding: 8px; border-bottom: 1px solid #333; text-align: right;\">{cod_amount}</td>\r\n      </tr>\r\n      <tr style=\"background: #f5f5f5;\">\r\n        <td style=\"padding: 10px; font-weight: bold;\">TỔNG THU:</td>\r\n        <td style=\"padding: 10px; text-align: right; font-weight: bold; font-size: 14px;\">{total_collected}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n\r\n<!-- TOP SẢN PHẨM BÁN CHẠY -->\r\n<div style=\"margin-bottom: 20px;\">\r\n  <div style=\"font-weight: bold; margin-bottom: 10px; color: #333; font-size: 14px;\">TOP SẢN PHẨM BÁN CHẠY</div>\r\n  <table style=\"width: 100%; border-collapse: collapse;\">\r\n    <thead>\r\n      <tr style=\"background: #f5f5f5;\">\r\n        <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 40px;\">STT</th>\r\n        <th style=\"padding: 10px; border: 1px solid #333; text-align: left;\">Sản phẩm</th>\r\n        <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 80px;\">SL bán</th>\r\n        <th style=\"padding: 10px; border: 1px solid #333; text-align: right; width: 120px;\">Doanh thu</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td style=\"padding: 8px; border: 1px solid #333; text-align: center;\">{line_stt}</td>\r\n        <td style=\"padding: 8px; border: 1px solid #333;\">{line_product_name}</td>\r\n        <td style=\"padding: 8px; border: 1px solid #333; text-align: center; font-weight: bold;\">{line_quantity}</td>\r\n        <td style=\"padding: 8px; border: 1px solid #333; text-align: right;\">{line_amount}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin-bottom: 20px; padding: 12px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 40px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; margin-bottom: 5px;\">NGƯỜI LẬP BÁO CÁO</div>\r\n        <div style=\"color: #888; font-size: 12px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 60px;\"></div>\r\n        <div>{account_name}</div>\r\n      </td>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; margin-bottom: 5px;\">QUẢN LÝ XÁC NHẬN</div>\r\n        <div style=\"color: #888; font-size: 12px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 60px;\"></div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"margin-top: 15px; padding-top: 8px; border-top: 1px dashed #ccc; font-size: 10px; color: #666; text-align: center;\">\r\n  In lúc: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;CAEC;;;;AACM,MAAM,yBAAyB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyJvC,CAAC"}},
    {"offset": {"line": 9185, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/warranty-request.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu yêu cầu bảo hành (Extended) - TipTap compatible\r\n */\r\nexport const WARRANTY_REQUEST_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div style=\"margin-bottom: 5px;\">{store_logo}</div>\r\n  <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n  <div style=\"color: #666;\">{store_address}</div>\r\n  <div style=\"color: #666;\">Hotline: {store_phone_number}</div>\r\n</div>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 20px 0 10px 0; font-size: 18px; text-transform: uppercase; border-bottom: 2px solid #333; padding-bottom: 10px;\">PHIẾU YÊU CẦU BẢO HÀNH</h2>\r\n<div style=\"text-align: center; margin-bottom: 20px;\">\r\n  <div style=\"font-size: 14px;\">Số: <strong>{warranty_request_code}</strong></div>\r\n  <div>Ngày tiếp nhận: {created_on} {created_on_time}</div>\r\n</div>\r\n\r\n<!-- THÔNG TIN KHÁCH HÀNG -->\r\n<div style=\"background: #f5f5f5; border: 1px solid #333; padding: 15px; margin-bottom: 20px;\">\r\n  <div style=\"font-weight: bold; margin-bottom: 10px;\">THÔNG TIN KHÁCH HÀNG</div>\r\n  <table style=\"width: 100%;\">\r\n    <tbody>\r\n      <tr>\r\n        <td style=\"padding: 5px 0; width: 25%;\"><strong>Họ tên:</strong></td>\r\n        <td style=\"padding: 5px 0;\"><strong>{customer_name}</strong></td>\r\n        <td style=\"padding: 5px 0; width: 20%;\"><strong>Mã KH:</strong></td>\r\n        <td style=\"padding: 5px 0;\">{customer_code}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 5px 0;\"><strong>Điện thoại:</strong></td>\r\n        <td style=\"padding: 5px 0;\">{customer_phone_number}</td>\r\n        <td style=\"padding: 5px 0;\"><strong>Email:</strong></td>\r\n        <td style=\"padding: 5px 0;\">{customer_email}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 5px 0;\"><strong>Địa chỉ:</strong></td>\r\n        <td style=\"padding: 5px 0;\" colspan=\"3\">{customer_address}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n\r\n<!-- THÔNG TIN SẢN PHẨM -->\r\n<div style=\"background: #f5f5f5; border: 1px solid #333; padding: 15px; margin-bottom: 20px;\">\r\n  <div style=\"font-weight: bold; margin-bottom: 10px;\">THÔNG TIN SẢN PHẨM BẢO HÀNH</div>\r\n  <table style=\"width: 100%;\">\r\n    <tbody>\r\n      <tr>\r\n        <td style=\"padding: 5px 0; width: 25%;\"><strong>Sản phẩm:</strong></td>\r\n        <td style=\"padding: 5px 0;\"><strong>{product_name}</strong></td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 5px 0;\"><strong>Mã SP:</strong></td>\r\n        <td style=\"padding: 5px 0;\">{product_code}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 5px 0;\"><strong>Serial/IMEI:</strong></td>\r\n        <td style=\"padding: 5px 0;\"><strong>{serial_number}</strong></td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 5px 0;\"><strong>Mã đơn hàng gốc:</strong></td>\r\n        <td style=\"padding: 5px 0;\">{order_code}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 5px 0;\"><strong>Ngày mua:</strong></td>\r\n        <td style=\"padding: 5px 0;\">{purchase_date}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 5px 0;\"><strong>Thời hạn BH:</strong></td>\r\n        <td style=\"padding: 5px 0;\">{warranty_duration}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 5px 0;\"><strong>Hết hạn BH:</strong></td>\r\n        <td style=\"padding: 5px 0;\"><strong>{warranty_expired_on}</strong></td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n\r\n<!-- TÌNH TRẠNG LỖI -->\r\n<div style=\"background: #f5f5f5; border: 1px solid #333; padding: 15px; margin-bottom: 20px;\">\r\n  <div style=\"font-weight: bold; margin-bottom: 10px;\">TÌNH TRẠNG LỖI</div>\r\n  <table style=\"width: 100%;\">\r\n    <tbody>\r\n      <tr>\r\n        <td style=\"padding: 5px 0; width: 25%;\"><strong>Loại lỗi:</strong></td>\r\n        <td style=\"padding: 5px 0;\"><strong>{issue_type}</strong></td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 5px 0; vertical-align: top;\"><strong>Mô tả lỗi:</strong></td>\r\n        <td style=\"padding: 5px 0;\">{issue_description}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 5px 0;\"><strong>Tình trạng máy:</strong></td>\r\n        <td style=\"padding: 5px 0;\">{device_condition}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 5px 0;\"><strong>Phụ kiện kèm:</strong></td>\r\n        <td style=\"padding: 5px 0;\">{accessories}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n\r\n<!-- TRẠNG THÁI XỬ LÝ -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 20px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; width: 25%; background: #f5f5f5; border: 1px solid #d9d9d9; font-weight: bold;\">Trạng thái:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #d9d9d9;\"><strong style=\"color: #eb2f96;\">{status}</strong></td>\r\n      <td style=\"padding: 8px; width: 25%; background: #f5f5f5; border: 1px solid #d9d9d9; font-weight: bold;\">Ưu tiên:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #d9d9d9;\">{priority}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #d9d9d9; font-weight: bold;\">Người tiếp nhận:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #d9d9d9;\">{received_by}</td>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #d9d9d9; font-weight: bold;\">Kỹ thuật viên:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #d9d9d9;\">{technician_name}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #d9d9d9; font-weight: bold;\">Dự kiến hoàn thành:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #d9d9d9;\" colspan=\"3\">{expected_completion_date}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin-bottom: 20px; padding: 12px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú:</strong> {note}\r\n</div>\r\n\r\n<!-- QUY ĐỊNH BẢO HÀNH -->\r\n<div style=\"margin-bottom: 20px; padding: 12px; background: #f5f5f5; border: 1px solid #333; font-size: 11px;\">\r\n  <strong>QUY ĐỊNH BẢO HÀNH:</strong>\r\n  <ul style=\"margin: 5px 0 0 15px; padding: 0;\">\r\n    <li>Thời gian xử lý: 7-14 ngày làm việc (tùy mức độ lỗi)</li>\r\n    <li>Khách hàng vui lòng mang theo phiếu này khi nhận máy</li>\r\n    <li>Cửa hàng không chịu trách nhiệm nếu máy không được nhận trong 30 ngày</li>\r\n    <li>Hotline hỗ trợ: {store_phone_number}</li>\r\n  </ul>\r\n</div>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 30px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; margin-bottom: 5px;\">KHÁCH HÀNG</div>\r\n        <div style=\"color: #888; font-size: 12px; font-style: italic;\">(Ký xác nhận)</div>\r\n        <div style=\"height: 50px;\"></div>\r\n        <div>{customer_name}</div>\r\n      </td>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; margin-bottom: 5px;\">NHÂN VIÊN TIẾP NHẬN</div>\r\n        <div style=\"color: #888; font-size: 12px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 50px;\"></div>\r\n        <div>{received_by}</div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"margin-top: 15px; padding-top: 8px; border-top: 1px dashed #ccc; font-size: 10px; color: #666; text-align: center;\">\r\n  In lúc: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;CAEC;;;;AACM,MAAM,4BAA4B,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyK1C,CAAC"}},
    {"offset": {"line": 9365, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/packing-request.ts"],"sourcesContent":["/**\r\n * Mẫu in Phiếu yêu cầu đóng gói (Extended) - TipTap compatible\r\n */\r\nexport const PACKING_REQUEST_TEMPLATE = `\r\n<div style=\"font-family: Arial, sans-serif; font-size: 12px; line-height: 1.4; max-width: 800px; margin: 0 auto; padding: 10px;\">\r\n\r\n<!-- HEADER -->\r\n<div style=\"text-align: center; margin-bottom: 10px;\">\r\n  <div style=\"margin-bottom: 5px;\">{store_logo}</div>\r\n  <div style=\"font-size: 14px; font-weight: bold; margin-bottom: 2px;\">{store_name}</div>\r\n  <div style=\"color: #666;\">Kho: {location_name}</div>\r\n</div>\r\n\r\n<!-- TIÊU ĐỀ -->\r\n<h2 style=\"text-align: center; margin: 20px 0 10px 0; font-size: 18px; text-transform: uppercase; border-bottom: 2px solid #333; padding-bottom: 10px;\">PHIẾU YÊU CẦU ĐÓNG GÓI</h2>\r\n<div style=\"text-align: center; margin-bottom: 20px;\">\r\n  <div style=\"font-size: 14px;\">Mã yêu cầu: <strong>{packing_request_code}</strong></div>\r\n  <div>Đơn hàng: <strong>{order_code}</strong></div>\r\n  <div>Ngày tạo: {created_on} {created_on_time}</div>\r\n</div>\r\n\r\n<!-- ĐỘ ƯU TIÊN -->\r\n<div style=\"text-align: center; margin-bottom: 20px;\">\r\n  <span style=\"background: #f5f5f5; border: 1px solid #333; padding: 8px 20px; font-weight: bold; font-size: 14px;\">\r\n    ĐỘ ƯU TIÊN: {priority}\r\n  </span>\r\n</div>\r\n\r\n<!-- THÔNG TIN GIAO HÀNG -->\r\n<div style=\"background: #f5f5f5; border: 1px solid #333; padding: 15px; margin-bottom: 20px;\">\r\n  <div style=\"font-weight: bold; margin-bottom: 10px;\">THÔNG TIN GIAO HÀNG</div>\r\n  <table style=\"width: 100%;\">\r\n    <tbody>\r\n      <tr>\r\n        <td style=\"padding: 5px 0; width: 25%;\"><strong>Người nhận:</strong></td>\r\n        <td style=\"padding: 5px 0;\"><strong>{customer_name}</strong></td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 5px 0;\"><strong>Điện thoại:</strong></td>\r\n        <td style=\"padding: 5px 0;\">{customer_phone_number}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 5px 0;\"><strong>Địa chỉ:</strong></td>\r\n        <td style=\"padding: 5px 0;\">{shipping_address}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 5px 0;\"><strong>Đơn vị VC:</strong></td>\r\n        <td style=\"padding: 5px 0;\">{carrier_name}</td>\r\n      </tr>\r\n      <tr>\r\n        <td style=\"padding: 5px 0;\"><strong>Dịch vụ:</strong></td>\r\n        <td style=\"padding: 5px 0;\">{service_name}</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n\r\n<!-- DANH SÁCH SẢN PHẨM CẦN ĐÓNG GÓI -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed;\">\r\n  <thead>\r\n    <tr style=\"background: #f5f5f5;\">\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 40px;\">STT</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 100px;\">Mã SP</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: left;\">Tên sản phẩm</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 60px;\">SL</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 100px;\">Vị trí kho</th>\r\n      <th style=\"padding: 10px; border: 1px solid #333; text-align: center; width: 60px;\">Lấy</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center;\">{line_stt}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center; font-family: monospace;\">{line_variant_code}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{line_product_name}<br><small style=\"color: #666;\">{line_variant}</small></td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center; font-weight: bold; font-size: 16px;\">{line_quantity}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center; font-weight: bold;\">{bin_location}</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333; text-align: center; font-size: 20px;\">[ ]</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- THỐNG KÊ -->\r\n<table style=\"width: 250px; margin-left: auto; border-collapse: collapse; margin-bottom: 20px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 10px; border: 1px solid #333; background: #f5f5f5; font-weight: bold;\">Tổng số lượng:</td>\r\n      <td style=\"padding: 10px; border: 1px solid #333; text-align: right; font-weight: bold; font-size: 16px;\">{total_quantity}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 10px; border: 1px solid #333;\">Tổng khối lượng:</td>\r\n      <td style=\"padding: 10px; border: 1px solid #333; text-align: right;\">{total_weight} g</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 10px; border: 1px solid #333;\">COD thu hộ:</td>\r\n      <td style=\"padding: 10px; border: 1px solid #333; text-align: right; font-weight: bold;\">{cod}</td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- YÊU CẦU ĐẶC BIỆT -->\r\n<div style=\"background: #f5f5f5; border: 1px solid #333; padding: 15px; margin-bottom: 20px;\">\r\n  <div style=\"font-weight: bold; margin-bottom: 10px;\">YÊU CẦU ĐẶC BIỆT</div>\r\n  <div>{special_request}</div>\r\n</div>\r\n\r\n<!-- GHI CHÚ -->\r\n<div style=\"margin-bottom: 20px; padding: 12px; background: #f5f5f5; border: 1px solid #333;\">\r\n  <strong>Ghi chú đóng gói:</strong> {packing_note}\r\n</div>\r\n\r\n<!-- TRẠNG THÁI -->\r\n<table style=\"width: 100%; border-collapse: collapse; margin-bottom: 20px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"padding: 8px; width: 25%; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Trạng thái:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\"><strong>{status}</strong></td>\r\n      <td style=\"padding: 8px; width: 25%; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Người được gán:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\">{assigned_employee}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 8px; background: #f5f5f5; border: 1px solid #333; font-weight: bold;\">Thời hạn:</td>\r\n      <td style=\"padding: 8px; border: 1px solid #333;\" colspan=\"3\"><strong>{deadline}</strong></td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- CHỮ KÝ -->\r\n<table style=\"width: 100%; margin-top: 30px;\">\r\n  <tbody>\r\n    <tr>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; margin-bottom: 5px;\">NGƯỜI ĐÓNG GÓI</div>\r\n        <div style=\"color: #888; font-size: 12px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 50px;\"></div>\r\n      </td>\r\n      <td style=\"width: 50%; text-align: center; padding: 10px; vertical-align: top;\">\r\n        <div style=\"font-weight: bold; margin-bottom: 5px;\">KIỂM TRA</div>\r\n        <div style=\"color: #888; font-size: 12px; font-style: italic;\">(Ký, ghi rõ họ tên)</div>\r\n        <div style=\"height: 50px;\"></div>\r\n      </td>\r\n    </tr>\r\n  </tbody>\r\n</table>\r\n\r\n<!-- FOOTER -->\r\n<div style=\"text-align: center; margin-top: 15px; padding-top: 8px; border-top: 1px dashed #333; font-size: 10px; color: #666;\">\r\n  In lúc: {print_date} {print_time}\r\n</div>\r\n\r\n</div>\r\n`;\r\n"],"names":[],"mappings":"AAAA;;CAEC;;;;AACM,MAAM,2BAA2B,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmJzC,CAAC"}},
    {"offset": {"line": 9523, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/attendance.ts"],"sourcesContent":["/**\r\n * Attendance Template - Bảng chấm công\r\n * Mẫu in mặc định cho bảng chấm công\r\n * \r\n * CHUẨN TEMPLATE v3 (2025-12-10):\r\n * - Dạng DỌC (portrait) - mỗi nhân viên 1 tờ A4\r\n * - Compact: Chia 2 nửa tháng theo chiều ngang\r\n * - Font nhỏ gọn, vừa 1 trang\r\n */\r\n\r\n// Template cho BÁO CÁO CÁ NHÂN (mỗi nhân viên 1 trang)\r\nexport const ATTENDANCE_TEMPLATE = `<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <style>\r\n    * { margin: 0; padding: 0; box-sizing: border-box; }\r\n    body { \r\n      font-family: Arial, sans-serif; \r\n      font-size: 9px; \r\n      line-height: 1.2;\r\n      padding: 8mm;\r\n    }\r\n    @page { size: A4 portrait; margin: 8mm; }\r\n    .page-break { page-break-after: always; }\r\n    \r\n    .header { \r\n      display: flex;\r\n      align-items: center;\r\n      margin-bottom: 8px;\r\n      gap: 10px;\r\n    }\r\n    .store-logo {\r\n      max-width: 40px;\r\n      max-height: 40px;\r\n    }\r\n    .store-info-container { flex: 1; }\r\n    .store-name { \r\n      font-size: 11px; \r\n      font-weight: bold; \r\n    }\r\n    .store-info { \r\n      font-size: 8px; \r\n      color: #333;\r\n    }\r\n    \r\n    .title { \r\n      font-size: 13px; \r\n      font-weight: bold; \r\n      text-align: center;\r\n      margin: 8px 0 4px 0;\r\n      text-transform: uppercase;\r\n    }\r\n    .subtitle {\r\n      font-size: 11px;\r\n      text-align: center;\r\n      margin-bottom: 8px;\r\n      font-weight: bold;\r\n    }\r\n    \r\n    .employee-info {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      margin-bottom: 8px;\r\n      padding: 6px 10px;\r\n      background: #f0f0f0;\r\n      border-radius: 3px;\r\n      font-size: 9px;\r\n    }\r\n    .info-group { display: flex; gap: 20px; }\r\n    .info-item strong { font-weight: bold; }\r\n    \r\n    .legend {\r\n      margin: 6px 0;\r\n      font-size: 8px;\r\n      color: #666;\r\n    }\r\n    .legend span { margin-right: 10px; }\r\n    \r\n    .tables-container {\r\n      display: flex;\r\n      gap: 8px;\r\n    }\r\n    .half-month {\r\n      flex: 1;\r\n    }\r\n    .half-month h4 {\r\n      font-size: 9px;\r\n      text-align: center;\r\n      margin-bottom: 4px;\r\n      background: #333;\r\n      color: white;\r\n      padding: 3px;\r\n    }\r\n    \r\n    table { \r\n      width: 100%; \r\n      border-collapse: collapse; \r\n      font-size: 8px;\r\n    }\r\n    th, td { \r\n      border: 1px solid #999; \r\n      padding: 2px 3px; \r\n      text-align: center;\r\n    }\r\n    th { \r\n      background: #e0e0e0; \r\n      font-weight: bold;\r\n      font-size: 7px;\r\n    }\r\n    .col-day { width: 22px; }\r\n    .col-dow { width: 22px; }\r\n    .col-status { width: 28px; }\r\n    .col-time { width: 38px; font-size: 7px; }\r\n    \r\n    .summary-section {\r\n      margin: 10px 0;\r\n      display: flex;\r\n      gap: 10px;\r\n    }\r\n    .summary-box {\r\n      flex: 1;\r\n      padding: 6px 10px;\r\n      background: #f5f5f5;\r\n      border-radius: 3px;\r\n      border: 1px solid #ddd;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      font-size: 9px;\r\n    }\r\n    .summary-box strong {\r\n      font-size: 11px;\r\n    }\r\n    \r\n    .footer { \r\n      margin-top: 15px;\r\n      display: flex;\r\n      justify-content: space-between;\r\n    }\r\n    .signature-box {\r\n      width: 30%;\r\n      text-align: center;\r\n    }\r\n    .signature-title {\r\n      font-weight: bold;\r\n      font-size: 9px;\r\n      margin-bottom: 35px;\r\n    }\r\n    .signature-line {\r\n      border-top: 1px dotted #333;\r\n      padding-top: 3px;\r\n      font-size: 8px;\r\n    }\r\n    \r\n    .print-date {\r\n      font-size: 8px;\r\n      color: #666;\r\n      text-align: right;\r\n      margin-top: 10px;\r\n    }\r\n    \r\n    @media print {\r\n      body { padding: 5mm; }\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  {{#line_items}}\r\n  <div class=\"employee-page\">\r\n    <!-- Header -->\r\n    <div class=\"header\">\r\n      <img src=\"{store_logo}\" class=\"store-logo\" onerror=\"this.style.display='none'\">\r\n      <div class=\"store-info-container\">\r\n        <div class=\"store-name\">{store_name}</div>\r\n        <div class=\"store-info\">{store_address} | ĐT: {store_phone_number}</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"title\">BẢNG CHẤM CÔNG CÁ NHÂN</div>\r\n    <div class=\"subtitle\">Tháng {month_year}</div>\r\n\r\n    <!-- Thông tin nhân viên -->\r\n    <div class=\"employee-info\">\r\n      <div class=\"info-group\">\r\n        <div class=\"info-item\"><strong>Mã NV:</strong> {employee_code}</div>\r\n        <div class=\"info-item\"><strong>Họ tên:</strong> {employee_name}</div>\r\n      </div>\r\n      <div class=\"info-group\">\r\n        <div class=\"info-item\"><strong>Phòng ban:</strong> {department_name}</div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Chú thích -->\r\n    <div class=\"legend\">\r\n      <span>✓ Có mặt</span>\r\n      <span>X Vắng</span>\r\n      <span>P Nghỉ phép</span>\r\n      <span>½ Nửa ngày</span>\r\n      <span>L Nghỉ lễ</span>\r\n      <span>- Cuối tuần/Chưa đến</span>\r\n    </div>\r\n\r\n    <!-- 2 bảng song song: Nửa đầu + Nửa cuối tháng -->\r\n    <div class=\"tables-container\">\r\n      <!-- Nửa đầu tháng (1-15) -->\r\n      <div class=\"half-month\">\r\n        <h4>Ngày 1 - 15</h4>\r\n        <table>\r\n          <thead>\r\n            <tr>\r\n              <th class=\"col-day\">Ngày</th>\r\n              <th class=\"col-dow\">Thứ</th>\r\n              <th class=\"col-status\">TT</th>\r\n              <th class=\"col-time\">Vào</th>\r\n              <th class=\"col-time\">Ra</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr><td>1</td><td>{dow_1}</td><td>{day_1}</td><td>{checkin_1}</td><td>{checkout_1}</td></tr>\r\n            <tr><td>2</td><td>{dow_2}</td><td>{day_2}</td><td>{checkin_2}</td><td>{checkout_2}</td></tr>\r\n            <tr><td>3</td><td>{dow_3}</td><td>{day_3}</td><td>{checkin_3}</td><td>{checkout_3}</td></tr>\r\n            <tr><td>4</td><td>{dow_4}</td><td>{day_4}</td><td>{checkin_4}</td><td>{checkout_4}</td></tr>\r\n            <tr><td>5</td><td>{dow_5}</td><td>{day_5}</td><td>{checkin_5}</td><td>{checkout_5}</td></tr>\r\n            <tr><td>6</td><td>{dow_6}</td><td>{day_6}</td><td>{checkin_6}</td><td>{checkout_6}</td></tr>\r\n            <tr><td>7</td><td>{dow_7}</td><td>{day_7}</td><td>{checkin_7}</td><td>{checkout_7}</td></tr>\r\n            <tr><td>8</td><td>{dow_8}</td><td>{day_8}</td><td>{checkin_8}</td><td>{checkout_8}</td></tr>\r\n            <tr><td>9</td><td>{dow_9}</td><td>{day_9}</td><td>{checkin_9}</td><td>{checkout_9}</td></tr>\r\n            <tr><td>10</td><td>{dow_10}</td><td>{day_10}</td><td>{checkin_10}</td><td>{checkout_10}</td></tr>\r\n            <tr><td>11</td><td>{dow_11}</td><td>{day_11}</td><td>{checkin_11}</td><td>{checkout_11}</td></tr>\r\n            <tr><td>12</td><td>{dow_12}</td><td>{day_12}</td><td>{checkin_12}</td><td>{checkout_12}</td></tr>\r\n            <tr><td>13</td><td>{dow_13}</td><td>{day_13}</td><td>{checkin_13}</td><td>{checkout_13}</td></tr>\r\n            <tr><td>14</td><td>{dow_14}</td><td>{day_14}</td><td>{checkin_14}</td><td>{checkout_14}</td></tr>\r\n            <tr><td>15</td><td>{dow_15}</td><td>{day_15}</td><td>{checkin_15}</td><td>{checkout_15}</td></tr>\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      <!-- Nửa cuối tháng (16-31) -->\r\n      <div class=\"half-month\">\r\n        <h4>Ngày 16 - 31</h4>\r\n        <table>\r\n          <thead>\r\n            <tr>\r\n              <th class=\"col-day\">Ngày</th>\r\n              <th class=\"col-dow\">Thứ</th>\r\n              <th class=\"col-status\">TT</th>\r\n              <th class=\"col-time\">Vào</th>\r\n              <th class=\"col-time\">Ra</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            <tr><td>16</td><td>{dow_16}</td><td>{day_16}</td><td>{checkin_16}</td><td>{checkout_16}</td></tr>\r\n            <tr><td>17</td><td>{dow_17}</td><td>{day_17}</td><td>{checkin_17}</td><td>{checkout_17}</td></tr>\r\n            <tr><td>18</td><td>{dow_18}</td><td>{day_18}</td><td>{checkin_18}</td><td>{checkout_18}</td></tr>\r\n            <tr><td>19</td><td>{dow_19}</td><td>{day_19}</td><td>{checkin_19}</td><td>{checkout_19}</td></tr>\r\n            <tr><td>20</td><td>{dow_20}</td><td>{day_20}</td><td>{checkin_20}</td><td>{checkout_20}</td></tr>\r\n            <tr><td>21</td><td>{dow_21}</td><td>{day_21}</td><td>{checkin_21}</td><td>{checkout_21}</td></tr>\r\n            <tr><td>22</td><td>{dow_22}</td><td>{day_22}</td><td>{checkin_22}</td><td>{checkout_22}</td></tr>\r\n            <tr><td>23</td><td>{dow_23}</td><td>{day_23}</td><td>{checkin_23}</td><td>{checkout_23}</td></tr>\r\n            <tr><td>24</td><td>{dow_24}</td><td>{day_24}</td><td>{checkin_24}</td><td>{checkout_24}</td></tr>\r\n            <tr><td>25</td><td>{dow_25}</td><td>{day_25}</td><td>{checkin_25}</td><td>{checkout_25}</td></tr>\r\n            <tr><td>26</td><td>{dow_26}</td><td>{day_26}</td><td>{checkin_26}</td><td>{checkout_26}</td></tr>\r\n            <tr><td>27</td><td>{dow_27}</td><td>{day_27}</td><td>{checkin_27}</td><td>{checkout_27}</td></tr>\r\n            <tr><td>28</td><td>{dow_28}</td><td>{day_28}</td><td>{checkin_28}</td><td>{checkout_28}</td></tr>\r\n            <tr><td>29</td><td>{dow_29}</td><td>{day_29}</td><td>{checkin_29}</td><td>{checkout_29}</td></tr>\r\n            <tr><td>30</td><td>{dow_30}</td><td>{day_30}</td><td>{checkin_30}</td><td>{checkout_30}</td></tr>\r\n            <tr><td>31</td><td>{dow_31}</td><td>{day_31}</td><td>{checkin_31}</td><td>{checkout_31}</td></tr>\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Tổng kết -->\r\n    <div class=\"summary-section\">\r\n      <div class=\"summary-box\"><span>Ngày công:</span> <strong>{work_days}</strong></div>\r\n      <div class=\"summary-box\"><span>Nghỉ phép:</span> <strong>{leave_days}</strong></div>\r\n      <div class=\"summary-box\"><span>Vắng mặt:</span> <strong>{absent_days}</strong></div>\r\n      <div class=\"summary-box\"><span>Đi trễ:</span> <strong>{late_arrivals}</strong></div>\r\n      <div class=\"summary-box\"><span>Về sớm:</span> <strong>{early_departures}</strong></div>\r\n      <div class=\"summary-box\"><span>Giờ làm thêm:</span> <strong>{ot_hours}h</strong></div>\r\n    </div>\r\n\r\n    <!-- Chữ ký -->\r\n    <div class=\"footer\">\r\n      <div class=\"signature-box\">\r\n        <div class=\"signature-title\">Nhân viên</div>\r\n        <div class=\"signature-line\">(Ký, ghi rõ họ tên)</div>\r\n      </div>\r\n      <div class=\"signature-box\">\r\n        <div class=\"signature-title\">Trưởng phòng</div>\r\n        <div class=\"signature-line\">(Ký, ghi rõ họ tên)</div>\r\n      </div>\r\n      <div class=\"signature-box\">\r\n        <div class=\"signature-title\">Giám đốc</div>\r\n        <div class=\"signature-line\">(Ký, đóng dấu)</div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"print-date\">Ngày in: {print_date}</div>\r\n  </div>\r\n  <div class=\"page-break\"></div>\r\n  {{/line_items}}\r\n</body>\r\n</html>`;\r\n\r\n\r\n// ============================================\r\n// Template cho BÁO CÁO TỔNG HỢP (nhiều nhân viên - dạng ngang)\r\n// ============================================\r\nexport const ATTENDANCE_SUMMARY_TEMPLATE = `<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <meta charset=\"UTF-8\">\r\n  <style>\r\n    * { margin: 0; padding: 0; box-sizing: border-box; }\r\n    body { \r\n      font-family: Arial, sans-serif; \r\n      font-size: 8px; \r\n      line-height: 1.2;\r\n      padding: 5mm;\r\n    }\r\n    @page { size: A4 landscape; margin: 5mm; }\r\n    \r\n    .header { \r\n      display: flex;\r\n      align-items: center;\r\n      margin-bottom: 8px;\r\n      gap: 10px;\r\n    }\r\n    .store-logo {\r\n      max-width: 40px;\r\n      max-height: 40px;\r\n    }\r\n    .store-name { \r\n      font-size: 11px; \r\n      font-weight: bold; \r\n    }\r\n    .store-info { \r\n      font-size: 8px; \r\n      color: #333;\r\n    }\r\n    \r\n    .title { \r\n      font-size: 14px; \r\n      font-weight: bold; \r\n      text-align: center;\r\n      margin: 5px 0;\r\n      text-transform: uppercase;\r\n    }\r\n    .subtitle {\r\n      font-size: 10px;\r\n      text-align: center;\r\n      margin-bottom: 8px;\r\n    }\r\n    \r\n    .legend {\r\n      font-size: 7px;\r\n      margin-bottom: 5px;\r\n      color: #666;\r\n    }\r\n    \r\n    table { \r\n      width: 100%; \r\n      border-collapse: collapse; \r\n      font-size: 7px;\r\n    }\r\n    th, td { \r\n      border: 1px solid #999; \r\n      padding: 2px; \r\n      text-align: center;\r\n    }\r\n    th { \r\n      background: #e0e0e0; \r\n      font-weight: bold;\r\n    }\r\n    .col-name { \r\n      text-align: left; \r\n      padding-left: 3px !important;\r\n      min-width: 80px;\r\n    }\r\n    \r\n    .summary {\r\n      margin-top: 8px;\r\n      font-size: 9px;\r\n    }\r\n    \r\n    .footer { \r\n      margin-top: 15px;\r\n      display: flex;\r\n      justify-content: space-between;\r\n    }\r\n    .signature-box {\r\n      width: 25%;\r\n      text-align: center;\r\n    }\r\n    .signature-title {\r\n      font-weight: bold;\r\n      font-size: 9px;\r\n      margin-bottom: 30px;\r\n    }\r\n    \r\n    .print-date {\r\n      font-size: 7px;\r\n      color: #666;\r\n      text-align: right;\r\n      margin-top: 8px;\r\n    }\r\n  </style>\r\n</head>\r\n<body>\r\n  <div class=\"header\">\r\n    <img src=\"{store_logo}\" class=\"store-logo\" onerror=\"this.style.display='none'\">\r\n    <div>\r\n      <div class=\"store-name\">{store_name}</div>\r\n      <div class=\"store-info\">{store_address}</div>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"title\">BẢNG CHẤM CÔNG TỔNG HỢP</div>\r\n  <div class=\"subtitle\">Tháng {month_year} | Phòng ban: {department_name}</div>\r\n\r\n  <div class=\"legend\">\r\n    ✓ = Có mặt | X = Vắng | P = Nghỉ phép | ½ = Nửa ngày | L = Nghỉ lễ | - = Cuối tuần\r\n  </div>\r\n\r\n  <table>\r\n    <thead>\r\n      <tr>\r\n        <th rowspan=\"2\">STT</th>\r\n        <th rowspan=\"2\">Mã NV</th>\r\n        <th rowspan=\"2\" class=\"col-name\">Họ và tên</th>\r\n        <th colspan=\"4\">Tổng kết</th>\r\n        <th colspan=\"31\">Ngày trong tháng</th>\r\n      </tr>\r\n      <tr>\r\n        <th>Công</th>\r\n        <th>Phép</th>\r\n        <th>Vắng</th>\r\n        <th>OT</th>\r\n        <th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th>\r\n        <th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th>\r\n        <th>16</th><th>17</th><th>18</th><th>19</th><th>20</th><th>21</th><th>22</th>\r\n        <th>23</th><th>24</th><th>25</th><th>26</th><th>27</th><th>28</th><th>29</th><th>30</th><th>31</th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      {{#line_items}}\r\n      <tr>\r\n        <td>{line_index}</td>\r\n        <td>{employee_code}</td>\r\n        <td class=\"col-name\">{employee_name}</td>\r\n        <td>{work_days}</td>\r\n        <td>{leave_days}</td>\r\n        <td>{absent_days}</td>\r\n        <td>{ot_hours}</td>\r\n        <td>{day_1}</td><td>{day_2}</td><td>{day_3}</td><td>{day_4}</td><td>{day_5}</td><td>{day_6}</td><td>{day_7}</td>\r\n        <td>{day_8}</td><td>{day_9}</td><td>{day_10}</td><td>{day_11}</td><td>{day_12}</td><td>{day_13}</td><td>{day_14}</td><td>{day_15}</td>\r\n        <td>{day_16}</td><td>{day_17}</td><td>{day_18}</td><td>{day_19}</td><td>{day_20}</td><td>{day_21}</td><td>{day_22}</td>\r\n        <td>{day_23}</td><td>{day_24}</td><td>{day_25}</td><td>{day_26}</td><td>{day_27}</td><td>{day_28}</td><td>{day_29}</td><td>{day_30}</td><td>{day_31}</td>\r\n      </tr>\r\n      {{/line_items}}\r\n    </tbody>\r\n  </table>\r\n\r\n  <div class=\"summary\">\r\n    <strong>Tổng cộng:</strong> {total_employees} nhân viên | \r\n    {total_work_days} công | {total_leave_days} phép | {total_absent_days} vắng | {total_ot_hours}h OT\r\n  </div>\r\n\r\n  <div class=\"footer\">\r\n    <div class=\"signature-box\">\r\n      <div class=\"signature-title\">Người lập</div>\r\n    </div>\r\n    <div class=\"signature-box\">\r\n      <div class=\"signature-title\">Kế toán</div>\r\n    </div>\r\n    <div class=\"signature-box\">\r\n      <div class=\"signature-title\">Trưởng phòng</div>\r\n    </div>\r\n    <div class=\"signature-box\">\r\n      <div class=\"signature-title\">Giám đốc</div>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"print-date\">Ngày in: {print_date}</div>\r\n</body>\r\n</html>`;\r\n"],"names":[],"mappings":"AAAA;;;;;;;;CAQC,GAED,uDAAuD;;;;;;;AAChD,MAAM,sBAAsB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;OAoS7B,CAAC;AAMD,MAAM,8BAA8B,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;OAiLrC,CAAC"}},
    {"offset": {"line": 10013, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/templates/index.ts"],"sourcesContent":["// =============================================\r\n// EXPORT ALL DEFAULT TEMPLATES\r\n// =============================================\r\n\r\n// MAIN TEMPLATES (16 loại chính)\r\nexport { ORDER_TEMPLATE } from './order';\r\nexport { QUOTE_TEMPLATE } from './quote';\r\nexport { RECEIPT_TEMPLATE } from './receipt';\r\nexport { PAYMENT_TEMPLATE } from './payment';\r\nexport { WARRANTY_TEMPLATE } from './warranty';\r\nexport { INVENTORY_CHECK_TEMPLATE } from './inventory-check';\r\nexport { STOCK_TRANSFER_TEMPLATE } from './stock-transfer';\r\nexport { SALES_RETURN_TEMPLATE } from './sales-return';\r\nexport { PURCHASE_ORDER_TEMPLATE } from './purchase-order';\r\nexport { PACKING_TEMPLATE } from './packing';\r\nexport { DELIVERY_TEMPLATE } from './delivery';\r\nexport { SHIPPING_LABEL_TEMPLATE } from './shipping-label';\r\nexport { PRODUCT_LABEL_TEMPLATE } from './product-label';\r\nexport { STOCK_IN_TEMPLATE } from './stock-in';\r\nexport { SUPPLIER_RETURN_TEMPLATE } from './supplier-return';\r\nexport { COMPLAINT_TEMPLATE } from './complaint';\r\nexport { PENALTY_TEMPLATE } from './penalty';\r\nexport { COST_ADJUSTMENT_TEMPLATE } from './cost-adjustment';\r\nexport { PAYROLL_TEMPLATE } from './payroll';\r\nexport { PAYSLIP_TEMPLATE } from './payslip';\r\n\r\n// EXTENDED TEMPLATES (8 loại mở rộng - MỚI)\r\nexport { SUPPLIER_ORDER_TEMPLATE } from './supplier-order';\r\nexport { RETURN_ORDER_TEMPLATE } from './return-order';\r\nexport { HANDOVER_TEMPLATE } from './handover';\r\nexport { REFUND_CONFIRMATION_TEMPLATE } from './refund-confirmation';\r\nexport { PACKING_GUIDE_TEMPLATE } from './packing-guide';\r\nexport { SALES_SUMMARY_TEMPLATE } from './sales-summary';\r\nexport { WARRANTY_REQUEST_TEMPLATE } from './warranty-request';\r\nexport { PACKING_REQUEST_TEMPLATE } from './packing-request';\r\n\r\nimport { TemplateType } from '../types';\r\n\r\n// =============================================\r\n// IMPORT ALL TEMPLATES\r\n// =============================================\r\n\r\n// Main Templates\r\nimport { ORDER_TEMPLATE } from './order';\r\nimport { QUOTE_TEMPLATE } from './quote';\r\nimport { RECEIPT_TEMPLATE } from './receipt';\r\nimport { PAYMENT_TEMPLATE } from './payment';\r\nimport { WARRANTY_TEMPLATE } from './warranty';\r\nimport { INVENTORY_CHECK_TEMPLATE } from './inventory-check';\r\nimport { STOCK_TRANSFER_TEMPLATE } from './stock-transfer';\r\nimport { SALES_RETURN_TEMPLATE } from './sales-return';\r\nimport { PURCHASE_ORDER_TEMPLATE } from './purchase-order';\r\nimport { PACKING_TEMPLATE } from './packing';\r\nimport { DELIVERY_TEMPLATE } from './delivery';\r\nimport { SHIPPING_LABEL_TEMPLATE } from './shipping-label';\r\nimport { PRODUCT_LABEL_TEMPLATE } from './product-label';\r\nimport { STOCK_IN_TEMPLATE } from './stock-in';\r\nimport { SUPPLIER_RETURN_TEMPLATE } from './supplier-return';\r\nimport { COMPLAINT_TEMPLATE } from './complaint';\r\nimport { PENALTY_TEMPLATE } from './penalty';\r\nimport { COST_ADJUSTMENT_TEMPLATE } from './cost-adjustment';\r\nimport { PAYROLL_TEMPLATE } from './payroll';\r\nimport { PAYSLIP_TEMPLATE } from './payslip';\r\nimport { ATTENDANCE_TEMPLATE } from './attendance';\r\n\r\n// Extended Templates\r\nimport { SUPPLIER_ORDER_TEMPLATE } from './supplier-order';\r\nimport { RETURN_ORDER_TEMPLATE } from './return-order';\r\nimport { HANDOVER_TEMPLATE } from './handover';\r\nimport { REFUND_CONFIRMATION_TEMPLATE } from './refund-confirmation';\r\nimport { PACKING_GUIDE_TEMPLATE } from './packing-guide';\r\nimport { SALES_SUMMARY_TEMPLATE } from './sales-summary';\r\nimport { WARRANTY_REQUEST_TEMPLATE } from './warranty-request';\r\nimport { PACKING_REQUEST_TEMPLATE } from './packing-request';\r\n\r\n// =============================================\r\n// MAP TEMPLATE TYPE TO DEFAULT TEMPLATE CONTENT\r\n// =============================================\r\n\r\n// Main Templates (16 loại trong TEMPLATE_TYPES)\r\nexport const DEFAULT_TEMPLATES: Record<TemplateType, string> = {\r\n  'order': ORDER_TEMPLATE,\r\n  'quote': QUOTE_TEMPLATE,\r\n  'receipt': RECEIPT_TEMPLATE,\r\n  'payment': PAYMENT_TEMPLATE,\r\n  'warranty': WARRANTY_TEMPLATE,\r\n  'inventory-check': INVENTORY_CHECK_TEMPLATE,\r\n  'stock-transfer': STOCK_TRANSFER_TEMPLATE,\r\n  'sales-return': SALES_RETURN_TEMPLATE,\r\n  'purchase-order': PURCHASE_ORDER_TEMPLATE,\r\n  'packing': PACKING_TEMPLATE,\r\n  'delivery': DELIVERY_TEMPLATE,\r\n  'shipping-label': SHIPPING_LABEL_TEMPLATE,\r\n  'product-label': PRODUCT_LABEL_TEMPLATE,\r\n  'stock-in': STOCK_IN_TEMPLATE,\r\n  'supplier-return': SUPPLIER_RETURN_TEMPLATE,\r\n  'complaint': COMPLAINT_TEMPLATE,\r\n  'penalty': PENALTY_TEMPLATE,\r\n  'leave': PENALTY_TEMPLATE, // TODO: Create dedicated LEAVE_TEMPLATE\r\n  'cost-adjustment': COST_ADJUSTMENT_TEMPLATE,\r\n  'handover': HANDOVER_TEMPLATE,\r\n  'payroll': PAYROLL_TEMPLATE,\r\n  'payslip': PAYSLIP_TEMPLATE,\r\n  'attendance': ATTENDANCE_TEMPLATE,\r\n};\r\n\r\n// Extended Templates (8 loại mở rộng)\r\nexport const EXTENDED_TEMPLATES: Record<string, string> = {\r\n  'supplier-order': SUPPLIER_ORDER_TEMPLATE,\r\n  'return-order': RETURN_ORDER_TEMPLATE,\r\n  'refund-confirmation': REFUND_CONFIRMATION_TEMPLATE,\r\n  'packing-guide': PACKING_GUIDE_TEMPLATE,\r\n  'sales-summary': SALES_SUMMARY_TEMPLATE,\r\n  'warranty-request': WARRANTY_REQUEST_TEMPLATE,\r\n  'packing-request': PACKING_REQUEST_TEMPLATE,\r\n};\r\n\r\n// Get default template by type (includes extended types)\r\nexport function getDefaultTemplate(type: TemplateType | string): string {\r\n  if (type in DEFAULT_TEMPLATES) {\r\n    return DEFAULT_TEMPLATES[type as TemplateType];\r\n  }\r\n  if (type in EXTENDED_TEMPLATES) {\r\n    return EXTENDED_TEMPLATES[type];\r\n  }\r\n  return '';\r\n}\r\n\r\n// Get all template types\r\nexport function getAllTemplateTypes(): string[] {\r\n  return [\r\n    ...Object.keys(DEFAULT_TEMPLATES),\r\n    ...Object.keys(EXTENDED_TEMPLATES),\r\n  ];\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA,gDAAgD;AAChD,+BAA+B;AAC/B,gDAAgD;AAEhD,iCAAiC;AACjC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA6BA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiBO,MAAM,oBAAkD;IAC7D,SAAS,uKAAc;IACvB,SAAS,uKAAc;IACvB,WAAW,2KAAgB;IAC3B,WAAW,2KAAgB;IAC3B,YAAY,6KAAiB;IAC7B,mBAAmB,8LAAwB;IAC3C,kBAAkB,4LAAuB;IACzC,gBAAgB,wLAAqB;IACrC,kBAAkB,4LAAuB;IACzC,WAAW,2KAAgB;IAC3B,YAAY,6KAAiB;IAC7B,kBAAkB,4LAAuB;IACzC,iBAAiB,0LAAsB;IACvC,YAAY,gLAAiB;IAC7B,mBAAmB,8LAAwB;IAC3C,aAAa,+KAAkB;IAC/B,WAAW,2KAAgB;IAC3B,SAAS,2KAAgB;IACzB,mBAAmB,8LAAwB;IAC3C,YAAY,6KAAiB;IAC7B,WAAW,2KAAgB;IAC3B,WAAW,2KAAgB;IAC3B,cAAc,iLAAmB;AACnC;AAGO,MAAM,qBAA6C;IACxD,kBAAkB,4LAAuB;IACzC,gBAAgB,wLAAqB;IACrC,uBAAuB,sMAA4B;IACnD,iBAAiB,0LAAsB;IACvC,iBAAiB,0LAAsB;IACvC,oBAAoB,gMAAyB;IAC7C,mBAAmB,8LAAwB;AAC7C;AAGO,SAAS,mBAAmB,IAA2B;IAC5D,IAAI,QAAQ,mBAAmB;QAC7B,OAAO,iBAAiB,CAAC,KAAqB;IAChD;IACA,IAAI,QAAQ,oBAAoB;QAC9B,OAAO,kBAAkB,CAAC,KAAK;IACjC;IACA,OAAO;AACT;AAGO,SAAS;IACd,OAAO;WACF,OAAO,IAAI,CAAC;WACZ,OAAO,IAAI,CAAC;KAChB;AACH"}},
    {"offset": {"line": 10167, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/default-templates.ts"],"sourcesContent":["// Re-export từ templates/index.ts - các template mới đã được tối ưu với inline styles\r\n// Các template này tương thích với TipTap editor và preview\r\nexport { DEFAULT_TEMPLATES, getDefaultTemplate } from './templates';\r\n"],"names":[],"mappings":";AAAA,sFAAsF;AACtF,4DAA4D;AAC5D"}},
    {"offset": {"line": 10176, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/printer/store.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { PrintTemplate, TemplateType, PaperSize } from './types';\r\nimport { getDefaultTemplate } from './default-templates';\r\n\r\n// Key format: \"type-size-branchId\" e.g. \"order-A4-branch1\" or \"type-size\" for all branches\r\ntype TemplateKey = string;\r\n\r\ninterface PrintTemplateState {\r\n  templates: Record<TemplateKey, PrintTemplate>;\r\n  defaultSizes: Record<TemplateType, PaperSize>; // Khổ in mặc định cho mỗi loại mẫu\r\n  initialized: boolean;\r\n  \r\n  // Actions\r\n  getTemplate: (type: TemplateType, size: PaperSize, branchId?: string) => PrintTemplate;\r\n  updateTemplate: (type: TemplateType, size: PaperSize, content: string, branchId?: string) => void;\r\n  updateTemplateAllBranches: (type: TemplateType, size: PaperSize, content: string) => void;\r\n  resetTemplate: (type: TemplateType, size: PaperSize, branchId?: string) => void;\r\n  setDefaultSize: (type: TemplateType, size: PaperSize) => void;\r\n  getDefaultSize: (type: TemplateType) => PaperSize;\r\n  loadFromAPI: () => Promise<void>;\r\n}\r\n\r\nconst getTemplateKey = (type: TemplateType, size: PaperSize, branchId?: string): TemplateKey => \r\n  branchId ? `${type}-${size}-${branchId}` : `${type}-${size}`;\r\n\r\n// API sync helper\r\nasync function syncTemplateToAPI(template: PrintTemplate, action: 'create' | 'update' | 'delete'): Promise<boolean> {\r\n  try {\r\n    const response = await fetch('/api/settings/print-templates', {\r\n      method: action === 'create' ? 'POST' : action === 'delete' ? 'DELETE' : 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify(template),\r\n    });\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error('syncTemplateToAPI error:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const usePrintTemplateStore = create<PrintTemplateState>()(\r\n  (set, get) => ({\r\n    templates: {} as Record<TemplateKey, PrintTemplate>,\r\n    defaultSizes: {} as Record<TemplateType, PaperSize>,\r\n    initialized: false,\r\n\r\n      getTemplate: (type: TemplateType, size: PaperSize, branchId?: string) => {\r\n        const state = get();\r\n        const key = getTemplateKey(type, size, branchId);\r\n        \r\n        // Thử tìm template cho branch cụ thể\r\n        const branchTemplate = state.templates[key];\r\n        if (branchTemplate && branchTemplate.content && branchTemplate.content.trim() !== '') {\r\n          // Auto-reset payroll templates nếu phát hiện dùng syntax cũ\r\n          // - {{#line_items}} : Mustache syntax không được hỗ trợ\r\n          // - {line_index} : biến cũ, phải dùng {line_stt}\r\n          if ((type === 'payroll' || type === 'payslip') && \r\n              (branchTemplate.content.includes('{{#line_items}}') || branchTemplate.content.includes('{line_index}'))) {\r\n            // Template đang dùng syntax cũ không được hỗ trợ -> reset về mặc định\r\n            return {\r\n              id: `template-${key}`,\r\n              type,\r\n              name: type === 'payroll' ? 'Bảng lương' : 'Phiếu lương',\r\n              content: getDefaultTemplate(type),\r\n              paperSize: size,\r\n              isActive: true,\r\n              updatedAt: new Date().toISOString(),\r\n            };\r\n          }\r\n          return branchTemplate;\r\n        }\r\n        \r\n        // Nếu không có template cho branch, tìm template chung\r\n        const generalKey = getTemplateKey(type, size);\r\n        const generalTemplate = state.templates[generalKey];\r\n        if (branchId && generalTemplate && generalTemplate.content && generalTemplate.content.trim() !== '') {\r\n          // Auto-reset payroll templates nếu phát hiện dùng syntax cũ\r\n          if ((type === 'payroll' || type === 'payslip') && \r\n              (generalTemplate.content.includes('{{#line_items}}') || generalTemplate.content.includes('{line_index}'))) {\r\n            return {\r\n              id: `template-${key}`,\r\n              type,\r\n              name: type === 'payroll' ? 'Bảng lương' : 'Phiếu lương',\r\n              content: getDefaultTemplate(type),\r\n              paperSize: size,\r\n              isActive: true,\r\n              updatedAt: new Date().toISOString(),\r\n            };\r\n          }\r\n          return generalTemplate;\r\n        }\r\n        \r\n        // Return default template if not exists or empty\r\n        // Đây là điểm quan trọng: nếu chưa có template hoặc template trống\r\n        // thì sử dụng mẫu mặc định của hệ thống\r\n        return {\r\n          id: `template-${key}`,\r\n          type,\r\n          name: type === 'order' ? 'Mẫu hóa đơn bán hàng' : 'Mẫu in',\r\n          content: getDefaultTemplate(type),\r\n          paperSize: size,\r\n          isActive: true,\r\n          updatedAt: new Date().toISOString(),\r\n        };\r\n      },\r\n\r\n      updateTemplate: (type, size, content, branchId?) => {\r\n        const key = getTemplateKey(type, size, branchId);\r\n        set((state) => {\r\n          const current = state.templates[key] || {\r\n            id: `template-${key}`,\r\n            type,\r\n            name: 'Mẫu in',\r\n            content: getDefaultTemplate(type),\r\n            paperSize: size,\r\n            isActive: true,\r\n            updatedAt: new Date().toISOString(),\r\n          };\r\n\r\n          return {\r\n            templates: {\r\n              ...state.templates,\r\n              [key]: {\r\n                ...current,\r\n                content,\r\n                updatedAt: new Date().toISOString(),\r\n              },\r\n            },\r\n          };\r\n        });\r\n      },\r\n\r\n      updateTemplateAllBranches: (type, size, content) => {\r\n        // Lưu template chung (không có branchId) - sẽ áp dụng cho tất cả chi nhánh\r\n        const key = getTemplateKey(type, size);\r\n        set((state) => {\r\n          // Xóa tất cả template cụ thể của các branch cho type và size này\r\n          const newTemplates = { ...state.templates };\r\n          Object.keys(newTemplates).forEach((k) => {\r\n            if (k.startsWith(`${type}-${size}-`)) {\r\n              delete newTemplates[k];\r\n            }\r\n          });\r\n\r\n          return {\r\n            templates: {\r\n              ...newTemplates,\r\n              [key]: {\r\n                id: `template-${key}`,\r\n                type,\r\n                name: 'Mẫu in',\r\n                content,\r\n                paperSize: size,\r\n                isActive: true,\r\n                updatedAt: new Date().toISOString(),\r\n              },\r\n            },\r\n          };\r\n        });\r\n      },\r\n\r\n      resetTemplate: (type, size, branchId?) => {\r\n        const key = getTemplateKey(type, size, branchId);\r\n        set((state) => ({\r\n          templates: {\r\n            ...state.templates,\r\n            [key]: {\r\n              id: `template-${key}`,\r\n              type,\r\n              name: 'Mẫu mặc định',\r\n              content: getDefaultTemplate(type),\r\n              paperSize: size,\r\n              isActive: true,\r\n              updatedAt: new Date().toISOString(),\r\n            },\r\n          },\r\n        }));\r\n      },\r\n\r\n      setDefaultSize: (type: TemplateType, size: PaperSize) => {\r\n        set((state) => ({\r\n          defaultSizes: {\r\n            ...state.defaultSizes,\r\n            [type]: size,\r\n          },\r\n        }));\r\n      },\r\n\r\n      getDefaultSize: (type: TemplateType) => {\r\n        const state = get();\r\n        return state.defaultSizes[type] || 'A4';\r\n      },\r\n\r\n      loadFromAPI: async () => {\r\n        if (get().initialized) return;\r\n        try {\r\n          const response = await fetch('/api/settings/print-templates');\r\n          if (response.ok) {\r\n            const json = await response.json();\r\n            if (json.data) {\r\n              set({ \r\n                templates: json.data.templates || {},\r\n                defaultSizes: json.data.defaultSizes || {},\r\n                initialized: true,\r\n              });\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('loadFromAPI error:', error);\r\n        }\r\n        set({ initialized: true });\r\n      },\r\n    })\r\n);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10368, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/store-info/store-info-store.ts"],"sourcesContent":["import { create } from 'zustand';\r\n\r\nexport type StoreGeneralInfoInput = {\r\n  companyName: string;\r\n  brandName: string;\r\n  logo?: string;\r\n  taxCode: string;\r\n  registrationNumber: string;\r\n  representativeName: string;\r\n  representativeTitle: string;\r\n  hotline: string;\r\n  email: string;\r\n  website: string;\r\n  headquartersAddress: string;\r\n  ward: string;\r\n  district: string;\r\n  province: string;\r\n  note: string;\r\n  bankAccountName: string;\r\n  bankAccountNumber: string;\r\n  bankName: string;\r\n};\r\n\r\nexport type StoreGeneralInfo = StoreGeneralInfoInput & {\r\n  updatedAt?: string | undefined;\r\n  updatedBySystemId?: string | undefined;\r\n  updatedByName?: string | undefined;\r\n};\r\n\r\ninterface StoreInfoState {\r\n  info: StoreGeneralInfo;\r\n  updateInfo: (\r\n    values: StoreGeneralInfoInput,\r\n    metadata?: { updatedBySystemId?: string | undefined; updatedByName?: string | undefined }\r\n  ) => void;\r\n  reset: () => void;\r\n  loadFromAPI: () => Promise<void>;\r\n  saveToAPI: () => Promise<void>;\r\n}\r\n\r\nconst defaultInfo: StoreGeneralInfo = {\r\n  companyName: '',\r\n  brandName: '',\r\n  logo: '',\r\n  taxCode: '',\r\n  registrationNumber: '',\r\n  representativeName: '',\r\n  representativeTitle: '',\r\n  hotline: '',\r\n  email: '',\r\n  website: '',\r\n  headquartersAddress: '',\r\n  ward: '',\r\n  district: '',\r\n  province: '',\r\n  note: '',\r\n  bankAccountName: '',\r\n  bankAccountNumber: '',\r\n  bankName: '',\r\n  updatedAt: undefined,\r\n  updatedBySystemId: undefined,\r\n  updatedByName: undefined,\r\n};\r\n\r\nexport const useStoreInfoStore = create<StoreInfoState>()(\r\n  (set) => ({\r\n    info: { ...defaultInfo },\r\n    updateInfo: (values, metadata) =>\r\n      set(() => ({\r\n        info: {\r\n          ...values,\r\n          updatedAt: new Date().toISOString(),\r\n          updatedBySystemId: metadata?.updatedBySystemId,\r\n          updatedByName: metadata?.updatedByName,\r\n        },\r\n      })),\r\n    reset: () => set(() => ({ info: { ...defaultInfo } })),\r\n    // Load from API - should be called on app init\r\n    loadFromAPI: async () => {\r\n      try {\r\n        const res = await fetch('/api/settings?key=store-info');\r\n        if (res.ok) {\r\n          const data = await res.json();\r\n          if (data?.value) {\r\n            set({ info: { ...defaultInfo, ...data.value } });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('[StoreInfo] Failed to load from API:', error);\r\n      }\r\n    },\r\n    // Save to API\r\n    saveToAPI: async () => {\r\n      try {\r\n        const state = useStoreInfoStore.getState();\r\n        await fetch('/api/settings', {\r\n          method: 'POST',\r\n          headers: { 'Content-Type': 'application/json' },\r\n          body: JSON.stringify({\r\n            key: 'store-info',\r\n            group: 'store',\r\n            value: state.info,\r\n          }),\r\n        });\r\n      } catch (error) {\r\n        console.error('[StoreInfo] Failed to save to API:', error);\r\n      }\r\n    },\r\n  })\r\n);\r\n\r\nexport function getDefaultStoreInfo(): StoreGeneralInfo {\r\n  return { ...defaultInfo };\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAwCA,MAAM,cAAgC;IACpC,aAAa;IACb,WAAW;IACX,MAAM;IACN,SAAS;IACT,oBAAoB;IACpB,oBAAoB;IACpB,qBAAqB;IACrB,SAAS;IACT,OAAO;IACP,SAAS;IACT,qBAAqB;IACrB,MAAM;IACN,UAAU;IACV,UAAU;IACV,MAAM;IACN,iBAAiB;IACjB,mBAAmB;IACnB,UAAU;IACV,WAAW;IACX,mBAAmB;IACnB,eAAe;AACjB;AAEO,MAAM,oBAAoB,IAAA,kJAAM,IACrC,CAAC,MAAQ,CAAC;QACR,MAAM;YAAE,GAAG,WAAW;QAAC;QACvB,YAAY,CAAC,QAAQ,WACnB,IAAI,IAAM,CAAC;oBACT,MAAM;wBACJ,GAAG,MAAM;wBACT,WAAW,IAAI,OAAO,WAAW;wBACjC,mBAAmB,UAAU;wBAC7B,eAAe,UAAU;oBAC3B;gBACF,CAAC;QACH,OAAO,IAAM,IAAI,IAAM,CAAC;oBAAE,MAAM;wBAAE,GAAG,WAAW;oBAAC;gBAAE,CAAC;QACpD,+CAA+C;QAC/C,aAAa;YACX,IAAI;gBACF,MAAM,MAAM,MAAM,MAAM;gBACxB,IAAI,IAAI,EAAE,EAAE;oBACV,MAAM,OAAO,MAAM,IAAI,IAAI;oBAC3B,IAAI,MAAM,OAAO;wBACf,IAAI;4BAAE,MAAM;gCAAE,GAAG,WAAW;gCAAE,GAAG,KAAK,KAAK;4BAAC;wBAAE;oBAChD;gBACF;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,wCAAwC;YACxD;QACF;QACA,cAAc;QACd,WAAW;YACT,IAAI;gBACF,MAAM,QAAQ,kBAAkB,QAAQ;gBACxC,MAAM,MAAM,iBAAiB;oBAC3B,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;wBACnB,KAAK;wBACL,OAAO;wBACP,OAAO,MAAM,IAAI;oBACnB;gBACF;YACF,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,sCAAsC;YACtD;QACF;IACF,CAAC;AAGI,SAAS;IACd,OAAO;QAAE,GAAG,WAAW;IAAC;AAC1B"}},
    {"offset": {"line": 10464, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/penalties/store.ts"],"sourcesContent":["import { createCrudStore } from '../../../lib/store-factory';\r\n// REMOVED: import { data as initialData, penaltyTypesData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { Penalty, PenaltyType } from './types';\r\n\r\nexport const usePenaltyStore = createCrudStore<Penalty>([], 'penalties', {\r\n  businessIdField: 'id',\r\n  apiEndpoint: '/api/settings/data?type=penalty',\r\n});\r\n\r\nexport const usePenaltyTypeStore = createCrudStore<PenaltyType>([], 'penalties', {\r\n  businessIdField: 'id',\r\n  apiEndpoint: '/api/settings/data?type=penalty-type',\r\n});\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAIO,MAAM,kBAAkB,IAAA,0IAAe,EAAU,EAAE,EAAE,aAAa;IACvE,iBAAiB;IACjB,aAAa;AACf;AAEO,MAAM,sBAAsB,IAAA,0IAAe,EAAc,EAAE,EAAE,aAAa;IAC/E,iBAAiB;IACjB,aAAa;AACf"}},
    {"offset": {"line": 10484, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/attendance/penalty-sync-service.ts"],"sourcesContent":["/**\r\n * Penalty Sync Service\r\n * Tự động tạo phiếu phạt khi phát hiện đi trễ hoặc về sớm trong chấm công\r\n */\r\n\r\nimport { usePenaltyStore } from '../settings/penalties/store';\r\nimport { useEmployeeSettingsStore } from '../settings/employees/employee-settings-store';\r\nimport type { Penalty } from '../settings/penalties/types';\r\nimport type { AttendanceDataRow, DailyRecord, AnyAttendanceDataRow } from './types';\r\nimport type { EmployeeSettings } from '../settings/employees/types';\r\nimport { asBusinessId, asSystemId, type SystemId, type BusinessId } from '@/lib/id-types';\r\nimport { toISODate, getDayOfWeek, isValidDate } from '../../lib/date-utils';\r\nimport { getCurrentUserSystemId } from '../../contexts/auth-context';\r\n\r\n// Penalty type SystemIds (từ data.ts)\r\nconst LATE_ARRIVAL_PENALTY_TYPE = asSystemId('PENTYPE000004'); // Đi làm trễ\r\nconst EARLY_LEAVE_PENALTY_TYPE = asSystemId('PENTYPE000006'); // Quên chấm công (có thể tạo mới cho về sớm)\r\n\r\nexport type ViolationInfo = {\r\n  day: number;\r\n  date: string; // YYYY-MM-DD\r\n  type: 'late' | 'early';\r\n  checkIn?: string;\r\n  checkOut?: string;\r\n  minutesLate?: number;\r\n  minutesEarly?: number;\r\n};\r\n\r\n/**\r\n * Phân tích dữ liệu chấm công để tìm các vi phạm (đi trễ/về sớm)\r\n */\r\nexport function detectViolations(\r\n  row: AnyAttendanceDataRow,\r\n  year: number,\r\n  month: number,\r\n  settings: EmployeeSettings\r\n): ViolationInfo[] {\r\n  const violations: ViolationInfo[] = [];\r\n  const daysInMonth = new Date(year, month, 0).getDate();\r\n  \r\n  const workStartParts = settings.workStartTime.split(':').map(Number);\r\n  const workEndParts = settings.workEndTime.split(':').map(Number);\r\n  const workStartMinutes = workStartParts[0] * 60 + workStartParts[1];\r\n  const workEndMinutes = workEndParts[0] * 60 + workEndParts[1];\r\n\r\n  for (let d = 1; d <= daysInMonth; d++) {\r\n    const record = row[`day_${d}`] as DailyRecord;\r\n    const workDate = new Date(year, month - 1, d);\r\n    const dayOfWeek = getDayOfWeek(workDate);\r\n    const isWorkingDay = dayOfWeek !== null && settings.workingDays.includes(dayOfWeek);\r\n    const workDateStr = toISODate(workDate);\r\n\r\n    if (record && isWorkingDay && record.checkIn && record.checkOut) {\r\n      const checkInTime = new Date(`${workDateStr}T${record.checkIn}`);\r\n      const checkOutTime = new Date(`${workDateStr}T${record.checkOut}`);\r\n      \r\n      if (!isValidDate(checkInTime) || !isValidDate(checkOutTime)) continue;\r\n      \r\n      const checkInMins = checkInTime.getHours() * 60 + checkInTime.getMinutes();\r\n      const checkOutMins = checkOutTime.getHours() * 60 + checkOutTime.getMinutes();\r\n      \r\n      // Kiểm tra đi trễ\r\n      const allowedLateMinutes = workStartMinutes + settings.allowedLateMinutes;\r\n      if (checkInMins > allowedLateMinutes) {\r\n        violations.push({\r\n          day: d,\r\n          date: workDateStr,\r\n          type: 'late',\r\n          checkIn: record.checkIn,\r\n          minutesLate: checkInMins - workStartMinutes,\r\n        });\r\n      }\r\n      \r\n      // Kiểm tra về sớm\r\n      if (checkOutMins < workEndMinutes) {\r\n        violations.push({\r\n          day: d,\r\n          date: workDateStr,\r\n          type: 'early',\r\n          checkOut: record.checkOut,\r\n          minutesEarly: workEndMinutes - checkOutMins,\r\n        });\r\n      }\r\n    }\r\n  }\r\n  \r\n  return violations;\r\n}\r\n\r\n/**\r\n * Tính số tiền phạt dựa trên số phút và bảng mức phạt\r\n */\r\nfunction getPenaltyAmount(\r\n  minutes: number,\r\n  tiers: { fromMinutes: number; toMinutes: number | null; amount: number }[]\r\n): number {\r\n  if (!tiers || tiers.length === 0) return 0;\r\n  \r\n  // Sắp xếp tiers theo fromMinutes\r\n  const sortedTiers = [...tiers].sort((a, b) => a.fromMinutes - b.fromMinutes);\r\n  \r\n  for (const tier of sortedTiers) {\r\n    const inRange = minutes >= tier.fromMinutes && \r\n                    (tier.toMinutes === null || minutes < tier.toMinutes);\r\n    if (inRange) {\r\n      return tier.amount;\r\n    }\r\n  }\r\n  \r\n  // Nếu vượt quá tất cả các mức, lấy mức cao nhất\r\n  const lastTier = sortedTiers[sortedTiers.length - 1];\r\n  if (lastTier && lastTier.toMinutes === null && minutes >= lastTier.fromMinutes) {\r\n    return lastTier.amount;\r\n  }\r\n  \r\n  return 0;\r\n}\r\n\r\n/**\r\n * Tạo phiếu phạt từ các vi phạm đã phát hiện\r\n * Trả về penalty không có systemId (store sẽ tự tạo)\r\n */\r\nexport function createPenaltiesFromViolations(\r\n  violations: ViolationInfo[],\r\n  employeeSystemId: SystemId,\r\n  employeeName: string,\r\n  settings: EmployeeSettings\r\n): Omit<Penalty, 'systemId'>[] {\r\n  const penalties: Omit<Penalty, 'systemId'>[] = [];\r\n  const now = new Date().toISOString();\r\n  const currentUserStr = getCurrentUserSystemId();\r\n  const currentUser = currentUserStr ? asSystemId(currentUserStr) : undefined;\r\n  \r\n  violations.forEach((violation, index) => {\r\n    const isLate = violation.type === 'late';\r\n    const minutes = isLate ? (violation.minutesLate || 0) : (violation.minutesEarly || 0);\r\n    \r\n    // Tính số tiền phạt theo bảng mức phạt\r\n    const tiers = isLate ? settings.latePenaltyTiers : settings.earlyLeavePenaltyTiers;\r\n    const amount = getPenaltyAmount(minutes, tiers || []);\r\n    \r\n    // Nếu số tiền phạt = 0, không tạo phiếu phạt\r\n    if (amount <= 0) return;\r\n    \r\n    // Không cần tạo ID - store sẽ tự generate với prefix PF đúng chuẩn\r\n    const penalty: Omit<Penalty, 'systemId'> = {\r\n      id: '' as BusinessId, // Store sẽ auto-generate: PF000001, PF000002...\r\n      employeeSystemId,\r\n      employeeName,\r\n      reason: isLate \r\n        ? `Đi làm trễ ${violation.minutesLate} phút ngày ${violation.date} (vào lúc ${violation.checkIn})`\r\n        : `Về sớm ${violation.minutesEarly} phút ngày ${violation.date} (ra lúc ${violation.checkOut})`,\r\n      amount,\r\n      issueDate: violation.date,\r\n      status: 'Chưa thanh toán',\r\n      issuerName: 'Hệ thống',\r\n      issuerSystemId: currentUser,\r\n      penaltyTypeSystemId: isLate ? LATE_ARRIVAL_PENALTY_TYPE : LATE_ARRIVAL_PENALTY_TYPE,\r\n      penaltyTypeName: isLate ? 'Đi làm trễ' : 'Về sớm',\r\n      category: 'attendance',\r\n      createdAt: now,\r\n      createdBy: currentUser,\r\n    };\r\n    \r\n    penalties.push(penalty);\r\n  });\r\n  \r\n  return penalties;\r\n}\r\n\r\nexport type PenaltyPreviewItem = Omit<Penalty, 'systemId'> & {\r\n  violation: ViolationInfo;\r\n  isDuplicate: boolean;\r\n  previewId: string; // ID tạm thời để tracking trong UI (không phải BusinessId)\r\n};\r\n\r\n/**\r\n * Preview các phiếu phạt sẽ tạo từ dữ liệu chấm công (không tạo ngay)\r\n * @returns Danh sách phiếu phạt sẽ tạo (có đánh dấu trùng)\r\n */\r\nexport function previewAttendancePenalties(\r\n  attendanceData: AttendanceDataRow[],\r\n  year: number,\r\n  month: number\r\n): PenaltyPreviewItem[] {\r\n  const settings = useEmployeeSettingsStore.getState().settings;\r\n  const allPenaltiesPreview: PenaltyPreviewItem[] = [];\r\n  \r\n  attendanceData.forEach((row) => {\r\n    const violations = detectViolations(row, year, month, settings);\r\n    \r\n    if (violations.length > 0) {\r\n      const penalties = createPenaltiesFromViolations(\r\n        violations,\r\n        row.employeeSystemId,\r\n        row.fullName,\r\n        settings\r\n      );\r\n      \r\n      // Map mỗi penalty với violation tương ứng và check duplicate\r\n      penalties.forEach((penalty, index) => {\r\n        const violation = violations[index];\r\n        const isDuplicate = hasPenaltyForDate(\r\n          row.employeeSystemId,\r\n          violation.date,\r\n          violation.type\r\n        );\r\n        \r\n        // Tạo previewId tạm thời cho UI tracking\r\n        const previewId = `${row.employeeSystemId}-${violation.date}-${violation.type}`;\r\n        \r\n        allPenaltiesPreview.push({\r\n          ...penalty,\r\n          violation,\r\n          isDuplicate,\r\n          previewId,\r\n        });\r\n      });\r\n    }\r\n  });\r\n  \r\n  return allPenaltiesPreview;\r\n}\r\n\r\n/**\r\n * Tạo các phiếu phạt đã được xác nhận\r\n * @param penalties Danh sách phiếu phạt đã được user chọn để tạo\r\n * @returns Số phiếu phạt đã tạo\r\n */\r\nexport function confirmCreatePenalties(\r\n  penalties: Omit<Penalty, 'systemId'>[]\r\n): number {\r\n  const penaltyStore = usePenaltyStore.getState();\r\n  \r\n  penalties.forEach((penalty) => {\r\n    penaltyStore.add(penalty);\r\n  });\r\n  \r\n  return penalties.length;\r\n}\r\n\r\n/**\r\n * Xử lý tự động tạo phiếu phạt từ dữ liệu chấm công\r\n * @deprecated Sử dụng previewAttendancePenalties + confirmCreatePenalties thay thế\r\n * @returns Số phiếu phạt đã tạo\r\n */\r\nexport function processAttendancePenalties(\r\n  attendanceData: AttendanceDataRow[],\r\n  year: number,\r\n  month: number\r\n): { created: number; violations: ViolationInfo[] } {\r\n  const settings = useEmployeeSettingsStore.getState().settings;\r\n  const penaltyStore = usePenaltyStore.getState();\r\n  \r\n  let totalCreated = 0;\r\n  const allViolations: ViolationInfo[] = [];\r\n  \r\n  attendanceData.forEach((row) => {\r\n    const violations = detectViolations(row, year, month, settings);\r\n    \r\n    if (violations.length > 0) {\r\n      allViolations.push(...violations);\r\n      \r\n      const penalties = createPenaltiesFromViolations(\r\n        violations,\r\n        row.employeeSystemId,\r\n        row.fullName,\r\n        settings\r\n      );\r\n      \r\n      // Kiểm tra duplicate trước khi thêm\r\n      penalties.forEach((penalty, index) => {\r\n        const violation = violations[index];\r\n        const isDuplicate = hasPenaltyForDate(\r\n          row.employeeSystemId,\r\n          violation.date,\r\n          violation.type\r\n        );\r\n        \r\n        if (!isDuplicate) {\r\n          penaltyStore.add(penalty);\r\n          totalCreated++;\r\n        }\r\n      });\r\n    }\r\n  });\r\n  \r\n  return { created: totalCreated, violations: allViolations };\r\n}\r\n\r\n/**\r\n * Kiểm tra xem đã có phiếu phạt cho ngày này chưa (tránh tạo trùng)\r\n */\r\nexport function hasPenaltyForDate(\r\n  employeeSystemId: SystemId,\r\n  date: string,\r\n  type: 'late' | 'early'\r\n): boolean {\r\n  const penalties = usePenaltyStore.getState().data;\r\n  const reason = type === 'late' ? 'Đi làm trễ' : 'Về sớm';\r\n  \r\n  return penalties.some(\r\n    (p) => \r\n      p.employeeSystemId === employeeSystemId &&\r\n      p.issueDate === date &&\r\n      p.reason.includes(reason) &&\r\n      p.status !== 'Đã hủy'\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10679, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/employees/shared-columns.tsx"],"sourcesContent":["/**\r\n * Shared Employee Column Factories\r\n * \r\n * This module provides reusable column definitions for employee tables.\r\n * Used by both regular columns.tsx and trash-columns.tsx to reduce duplication.\r\n */\r\n\r\nimport * as React from \"react\";\r\nimport { formatDateCustom } from '../../lib/date-utils';\r\nimport type { Employee } from './types';\r\nimport type { Branch } from \"../settings/branches/types\";\r\nimport { Checkbox } from \"../../components/ui/checkbox\";\r\nimport { DataTableColumnHeader } from \"../../components/data-table/data-table-column-header\";\r\nimport { Badge } from \"../../components/ui/badge\";\r\nimport type { ColumnDef } from '../../components/data-table/types';\r\n\r\n// ============================================\r\n// Utility Functions\r\n// ============================================\r\n\r\nexport const formatCurrency = (value?: number) => {\r\n  if (typeof value !== 'number') return '';\r\n  return new Intl.NumberFormat('vi-VN').format(value);\r\n};\r\n\r\nexport const formatDateDisplay = (dateString?: string) => {\r\n  if (!dateString) return '';\r\n  const date = new Date(dateString);\r\n  return formatDateCustom(date, \"dd/MM/yyyy\");\r\n};\r\n\r\nexport const formatAddress = (address: any): string => {\r\n  if (!address) return '';\r\n  if (typeof address === 'string') return address;\r\n  \r\n  const parts = [\r\n    address.street,\r\n    address.ward,\r\n    address.district,\r\n    address.province\r\n  ].filter(Boolean);\r\n  \r\n  return parts.join(', ');\r\n};\r\n\r\n// ============================================\r\n// Base Column Factories\r\n// ============================================\r\n\r\n/**\r\n * Create select checkbox column\r\n */\r\nexport const createSelectColumn = (): ColumnDef<Employee> => ({\r\n  id: \"select\",\r\n  header: ({ isAllPageRowsSelected, isSomePageRowsSelected, onToggleAll }) => (\r\n    <Checkbox\r\n      checked={isAllPageRowsSelected ? true : isSomePageRowsSelected ? \"indeterminate\" : false}\r\n      onCheckedChange={(value) => onToggleAll?.(!!value)}\r\n      aria-label=\"Select all\"\r\n    />\r\n  ),\r\n  cell: ({ onToggleSelect, isSelected }) => (\r\n    <Checkbox\r\n      checked={isSelected}\r\n      onCheckedChange={onToggleSelect}\r\n      aria-label=\"Select row\"\r\n    />\r\n  ),\r\n  size: 48,\r\n  meta: {\r\n    displayName: \"Chọn\",\r\n    sticky: \"left\",\r\n  }\r\n});\r\n\r\n/**\r\n * Create employee ID column\r\n */\r\nexport const createIdColumn = (): ColumnDef<Employee> => ({\r\n  id: \"id\",\r\n  accessorKey: \"id\",\r\n  header: ({ sorting, setSorting }) => (\r\n    <DataTableColumnHeader \r\n      title=\"Mã NV\"\r\n      sortKey=\"id\"\r\n      isSorted={sorting?.id === 'id'}\r\n      sortDirection={sorting?.desc ? 'desc' : 'asc'}\r\n      onSort={() => setSorting?.((s: any) => ({ id: 'id', desc: s.id === 'id' ? !s.desc : false }))}\r\n    />\r\n  ),\r\n  cell: ({ row }) => <span className=\"font-mono\">{row.id}</span>,\r\n  meta: {\r\n    displayName: \"Mã NV\",\r\n    group: \"Thông tin cơ bản\"\r\n  },\r\n});\r\n\r\n/**\r\n * Create full name column\r\n */\r\nexport const createFullNameColumn = (): ColumnDef<Employee> => ({\r\n  id: \"fullName\",\r\n  accessorKey: \"fullName\",\r\n  header: ({ sorting, setSorting }) => (\r\n    <DataTableColumnHeader \r\n      title=\"Họ và tên\"\r\n      sortKey=\"fullName\"\r\n      isSorted={sorting?.id === 'fullName'}\r\n      sortDirection={sorting?.desc ? 'desc' : 'asc'}\r\n      onSort={() => setSorting?.((s: any) => ({ id: 'fullName', desc: s.id === 'fullName' ? !s.desc : false }))}\r\n    />\r\n  ),\r\n  cell: ({ row }) => (\r\n    <div className=\"max-w-[200px] truncate\" title={row.fullName}>\r\n      {row.fullName}\r\n    </div>\r\n  ),\r\n  meta: {\r\n    displayName: \"Họ và tên\",\r\n    group: \"Thông tin cá nhân\"\r\n  },\r\n});\r\n\r\n/**\r\n * Create gender column\r\n */\r\nexport const createGenderColumn = (): ColumnDef<Employee> => ({\r\n  id: \"gender\",\r\n  accessorKey: \"gender\",\r\n  header: \"Giới tính\",\r\n  cell: ({ row }) => row.gender,\r\n  meta: {\r\n    displayName: \"Giới tính\",\r\n    group: \"Thông tin cá nhân\"\r\n  },\r\n});\r\n\r\n/**\r\n * Create department column\r\n */\r\nexport const createDepartmentColumn = (): ColumnDef<Employee> => ({\r\n  id: \"department\",\r\n  accessorKey: \"department\",\r\n  header: \"Phòng ban\",\r\n  cell: ({ row }) => row.department || '-',\r\n  meta: {\r\n    displayName: \"Phòng ban\",\r\n    group: \"Thông tin công việc\"\r\n  },\r\n});\r\n\r\n/**\r\n * Create job title column\r\n */\r\nexport const createJobTitleColumn = (): ColumnDef<Employee> => ({\r\n  id: \"jobTitle\",\r\n  accessorKey: \"jobTitle\",\r\n  header: \"Chức danh\",\r\n  cell: ({ row }) => row.jobTitle || '-',\r\n  meta: {\r\n    displayName: \"Chức danh\",\r\n    group: \"Thông tin công việc\"\r\n  },\r\n});\r\n\r\n/**\r\n * Create branch column\r\n */\r\nexport const createBranchColumn = (branches: Branch[]): ColumnDef<Employee> => ({\r\n  id: \"branchSystemId\",\r\n  accessorKey: \"branchSystemId\",\r\n  header: \"Chi nhánh\",\r\n  cell: ({ row }) => {\r\n    const branch = branches.find(b => b.systemId === row.branchSystemId);\r\n    return branch?.name || row.branchSystemId || '-';\r\n  },\r\n  meta: {\r\n    displayName: \"Chi nhánh\",\r\n    group: \"Thông tin công việc\"\r\n  },\r\n});\r\n\r\n/**\r\n * Create employment status column\r\n */\r\nexport const createEmploymentStatusColumn = (): ColumnDef<Employee> => ({\r\n  id: \"employmentStatus\",\r\n  accessorKey: \"employmentStatus\",\r\n  header: \"Trạng thái\",\r\n  cell: ({ row }) => {\r\n    const status = row.employmentStatus;\r\n    const variant = status === \"Đang làm việc\" ? \"default\" :\r\n                    status === \"Tạm nghỉ\" ? \"secondary\" : \"destructive\";\r\n    return <Badge variant={variant} className=\"text-body-xs\">{status}</Badge>;\r\n  },\r\n  meta: {\r\n    displayName: \"Trạng thái\",\r\n    group: \"Thông tin công việc\"\r\n  },\r\n});\r\n\r\n/**\r\n * Create phone column\r\n */\r\nexport const createPhoneColumn = (): ColumnDef<Employee> => ({\r\n  id: \"phone\",\r\n  accessorKey: \"phone\",\r\n  header: \"Điện thoại\",\r\n  cell: ({ row }) => row.phone || '-',\r\n  meta: {\r\n    displayName: \"Điện thoại\",\r\n    group: \"Thông tin liên hệ\"\r\n  },\r\n});\r\n\r\n/**\r\n * Create work email column\r\n */\r\nexport const createWorkEmailColumn = (): ColumnDef<Employee> => ({\r\n  id: \"workEmail\",\r\n  accessorKey: \"workEmail\",\r\n  header: \"Email công việc\",\r\n  cell: ({ row }) => (\r\n    <div className=\"max-w-[180px] truncate\" title={row.workEmail}>\r\n      {row.workEmail || '-'}\r\n    </div>\r\n  ),\r\n  meta: {\r\n    displayName: \"Email công việc\",\r\n    group: \"Thông tin liên hệ\"\r\n  },\r\n});\r\n\r\n/**\r\n * Create hire date column\r\n */\r\nexport const createHireDateColumn = (): ColumnDef<Employee> => ({\r\n  id: \"hireDate\",\r\n  accessorKey: \"hireDate\",\r\n  header: \"Ngày vào làm\",\r\n  cell: ({ row }) => formatDateDisplay(row.hireDate),\r\n  meta: {\r\n    displayName: \"Ngày vào làm\",\r\n    group: \"Thông tin công việc\"\r\n  },\r\n});\r\n\r\n/**\r\n * Create base salary column\r\n */\r\nexport const createBaseSalaryColumn = (): ColumnDef<Employee> => ({\r\n  id: \"baseSalary\",\r\n  accessorKey: \"baseSalary\",\r\n  header: \"Lương cơ bản\",\r\n  cell: ({ row }) => formatCurrency(row.baseSalary),\r\n  meta: {\r\n    displayName: \"Lương cơ bản\",\r\n    group: \"Lương & Phụ cấp\"\r\n  },\r\n});\r\n\r\n/**\r\n * Create deleted at column (for trash view)\r\n */\r\nexport const createDeletedAtColumn = (): ColumnDef<Employee> => ({\r\n  id: \"deletedAt\",\r\n  accessorKey: \"deletedAt\",\r\n  header: ({ sorting, setSorting }) => (\r\n    <DataTableColumnHeader \r\n      title=\"Ngày xóa\"\r\n      sortKey=\"deletedAt\"\r\n      isSorted={sorting?.id === 'deletedAt'}\r\n      sortDirection={sorting?.desc ? 'desc' : 'asc'}\r\n      onSort={() => setSorting?.((s: any) => ({ id: 'deletedAt', desc: s.id === 'deletedAt' ? !s.desc : false }))}\r\n    />\r\n  ),\r\n  cell: ({ row }) => formatDateDisplay(row.deletedAt || undefined),\r\n  meta: {\r\n    displayName: \"Ngày xóa\",\r\n    group: \"Thông tin xóa\"\r\n  },\r\n});\r\n\r\n// ============================================\r\n// Column Set Helpers\r\n// ============================================\r\n\r\n/**\r\n * Get base columns shared between regular and trash views\r\n */\r\nexport const getBaseColumns = (branches: Branch[]): ColumnDef<Employee>[] => [\r\n  createSelectColumn(),\r\n  createIdColumn(),\r\n  createFullNameColumn(),\r\n  createDepartmentColumn(),\r\n  createJobTitleColumn(),\r\n  createBranchColumn(branches),\r\n  createEmploymentStatusColumn(),\r\n];\r\n\r\n/**\r\n * Get personal info columns\r\n */\r\nexport const getPersonalInfoColumns = (): ColumnDef<Employee>[] => [\r\n  createGenderColumn(),\r\n  createPhoneColumn(),\r\n  createWorkEmailColumn(),\r\n];\r\n\r\n/**\r\n * Get employment columns\r\n */\r\nexport const getEmploymentColumns = (): ColumnDef<Employee>[] => [\r\n  createHireDateColumn(),\r\n  createBaseSalaryColumn(),\r\n];\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10999, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/attendance/components/penalty-confirm-dialog.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from '../../../components/ui/dialog';\r\nimport { Button } from '../../../components/ui/button';\r\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '../../../components/ui/table';\r\nimport { ScrollArea } from '../../../components/ui/scroll-area';\r\nimport { Checkbox } from '../../../components/ui/checkbox';\r\nimport { Badge } from '../../../components/ui/badge';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../../../components/ui/select';\r\nimport { AlertTriangle, AlertCircle, CheckCircle2, Clock, User, ChevronLeft, ChevronRight } from 'lucide-react';\r\nimport { cn } from '../../../lib/utils';\r\nimport { formatCurrency } from '../../employees/shared-columns';\r\nimport type { PenaltyPreviewItem } from '../penalty-sync-service';\r\nimport type { Penalty } from '../../settings/penalties/types';\r\n\r\nconst PAGE_SIZE_OPTIONS = [10, 20, 50, 100] as const;\r\n\r\ninterface PenaltyConfirmDialogProps {\r\n  isOpen: boolean;\r\n  onOpenChange: (open: boolean) => void;\r\n  penalties: PenaltyPreviewItem[];\r\n  onConfirm: (selectedPenalties: Omit<Penalty, 'systemId'>[]) => void;\r\n  onSkip: () => void;\r\n}\r\n\r\nexport function PenaltyConfirmDialog({\r\n  isOpen,\r\n  onOpenChange,\r\n  penalties,\r\n  onConfirm,\r\n  onSkip,\r\n}: PenaltyConfirmDialogProps) {\r\n  // Selection state - mặc định chọn tất cả không trùng\r\n  const [selectedIds, setSelectedIds] = React.useState<Set<string>>(() => {\r\n    return new Set(\r\n      penalties\r\n        .filter(p => !p.isDuplicate)\r\n        .map(p => p.previewId)\r\n    );\r\n  });\r\n\r\n  // Pagination state\r\n  const [currentPage, setCurrentPage] = React.useState(1);\r\n  const [pageSize, setPageSize] = React.useState<number>(10);\r\n\r\n  // Reset selection và pagination khi penalties thay đổi\r\n  React.useEffect(() => {\r\n    setSelectedIds(new Set(\r\n      penalties\r\n        .filter(p => !p.isDuplicate)\r\n        .map(p => p.previewId)\r\n    ));\r\n    setCurrentPage(1);\r\n  }, [penalties]);\r\n\r\n  const nonDuplicatePenalties = penalties.filter(p => !p.isDuplicate);\r\n  const duplicatePenalties = penalties.filter(p => p.isDuplicate);\r\n  \r\n  // Tổng tiền của các phiếu đã chọn\r\n  const totalAmount = penalties\r\n    .filter(p => selectedIds.has(p.previewId))\r\n    .reduce((sum, p) => sum + p.amount, 0);\r\n\r\n  // Pagination calculations\r\n  const totalPages = Math.ceil(penalties.length / pageSize);\r\n  const startIndex = (currentPage - 1) * pageSize;\r\n  const endIndex = startIndex + pageSize;\r\n  const paginatedPenalties = penalties.slice(startIndex, endIndex);\r\n\r\n  const handleToggle = (id: string) => {\r\n    setSelectedIds(prev => {\r\n      const next = new Set(prev);\r\n      if (next.has(id)) {\r\n        next.delete(id);\r\n      } else {\r\n        next.add(id);\r\n      }\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const handleSelectAll = (checked: boolean) => {\r\n    if (checked) {\r\n      setSelectedIds(new Set(nonDuplicatePenalties.map(p => p.previewId)));\r\n    } else {\r\n      setSelectedIds(new Set());\r\n    }\r\n  };\r\n\r\n  // Chọn/bỏ chọn tất cả trong trang hiện tại\r\n  const handleSelectAllInPage = (checked: boolean) => {\r\n    const pageNonDuplicates = paginatedPenalties.filter(p => !p.isDuplicate);\r\n    setSelectedIds(prev => {\r\n      const next = new Set(prev);\r\n      if (checked) {\r\n        pageNonDuplicates.forEach(p => next.add(p.previewId));\r\n      } else {\r\n        pageNonDuplicates.forEach(p => next.delete(p.previewId));\r\n      }\r\n      return next;\r\n    });\r\n  };\r\n\r\n  const handleConfirm = () => {\r\n    const selected = penalties\r\n      .filter(p => selectedIds.has(p.previewId))\r\n      .map(({ isDuplicate, violation, previewId, ...penalty }) => penalty);\r\n    onConfirm(selected);\r\n    onOpenChange(false);\r\n  };\r\n\r\n  const handleSkip = () => {\r\n    onSkip();\r\n    onOpenChange(false);\r\n  };\r\n\r\n  // Check if all in current page are selected\r\n  const pageNonDuplicates = paginatedPenalties.filter(p => !p.isDuplicate);\r\n  const allInPageSelected = pageNonDuplicates.length > 0 && \r\n    pageNonDuplicates.every(p => selectedIds.has(p.previewId));\r\n  const someInPageSelected = pageNonDuplicates.some(p => selectedIds.has(p.previewId));\r\n\r\n  if (penalties.length === 0) {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <Dialog open={isOpen} onOpenChange={onOpenChange}>\r\n      <DialogContent className=\"max-w-4xl max-h-[90vh] flex flex-col\">\r\n        <DialogHeader>\r\n          <DialogTitle className=\"flex items-center gap-2\">\r\n            <AlertTriangle className=\"h-5 w-5 text-amber-500\" />\r\n            Xác nhận tạo phiếu phạt\r\n          </DialogTitle>\r\n          <DialogDescription>\r\n            Hệ thống phát hiện {penalties.length} vi phạm chấm công. Vui lòng xác nhận các phiếu phạt muốn tạo.\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n\r\n        {/* Summary */}\r\n        <div className=\"flex gap-4 py-3 px-4 bg-muted/50 rounded-lg\">\r\n          <div className=\"flex items-center gap-2\">\r\n            <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\r\n            <span className=\"text-sm\">\r\n              <span className=\"font-medium\">{nonDuplicatePenalties.length}</span> phiếu mới\r\n            </span>\r\n          </div>\r\n          {duplicatePenalties.length > 0 && (\r\n            <div className=\"flex items-center gap-2\">\r\n              <AlertCircle className=\"h-4 w-4 text-amber-500\" />\r\n              <span className=\"text-sm\">\r\n                <span className=\"font-medium\">{duplicatePenalties.length}</span> đã tồn tại\r\n              </span>\r\n            </div>\r\n          )}\r\n          <div className=\"flex items-center gap-2 ml-auto\">\r\n            <span className=\"text-sm text-muted-foreground\">Tổng tiền phạt:</span>\r\n            <span className=\"font-semibold text-destructive\">{formatCurrency(totalAmount)}</span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Table with fixed height ScrollArea */}\r\n        <ScrollArea className=\"h-[400px] border rounded-lg\">\r\n          <Table>\r\n            <TableHeader className=\"sticky top-0 bg-background z-10\">\r\n              <TableRow>\r\n                <TableHead className=\"w-12\">\r\n                  <Checkbox\r\n                    checked={allInPageSelected}\r\n                    onCheckedChange={handleSelectAllInPage}\r\n                    aria-label=\"Chọn tất cả trong trang\"\r\n                    disabled={pageNonDuplicates.length === 0}\r\n                    className={cn(someInPageSelected && !allInPageSelected && \"data-[state=checked]:bg-primary/50\")}\r\n                  />\r\n                </TableHead>\r\n                <TableHead>Nhân viên</TableHead>\r\n                <TableHead>Vi phạm</TableHead>\r\n                <TableHead>Ngày</TableHead>\r\n                <TableHead>Chi tiết</TableHead>\r\n                <TableHead className=\"text-right\">Số tiền</TableHead>\r\n                <TableHead>Trạng thái</TableHead>\r\n              </TableRow>\r\n            </TableHeader>\r\n            <TableBody>\r\n              {paginatedPenalties.map((penalty) => {\r\n                const isSelected = selectedIds.has(penalty.previewId);\r\n                const violation = penalty.violation;\r\n                \r\n                return (\r\n                  <TableRow \r\n                    key={penalty.previewId}\r\n                    className={cn(\r\n                      penalty.isDuplicate && \"opacity-50 bg-muted/30\"\r\n                    )}\r\n                  >\r\n                    <TableCell>\r\n                      <Checkbox\r\n                        checked={isSelected}\r\n                        onCheckedChange={() => handleToggle(penalty.previewId)}\r\n                        disabled={penalty.isDuplicate}\r\n                        aria-label={`Chọn phiếu phạt ${penalty.employeeName}`}\r\n                      />\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      <div className=\"flex items-center gap-2\">\r\n                        <User className=\"h-4 w-4 text-muted-foreground\" />\r\n                        <span className=\"font-medium\">{penalty.employeeName}</span>\r\n                      </div>\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      <Badge variant={violation.type === 'late' ? 'destructive' : 'warning'}>\r\n                        {violation.type === 'late' ? 'Đi trễ' : 'Về sớm'}\r\n                      </Badge>\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      <span className=\"text-sm\">{violation.date}</span>\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\r\n                        <Clock className=\"h-3 w-3\" />\r\n                        {violation.type === 'late' \r\n                          ? `Vào ${violation.checkIn} (trễ ${violation.minutesLate} phút)`\r\n                          : `Ra ${violation.checkOut} (sớm ${violation.minutesEarly} phút)`\r\n                        }\r\n                      </div>\r\n                    </TableCell>\r\n                    <TableCell className=\"text-right font-medium text-destructive\">\r\n                      {formatCurrency(penalty.amount)}\r\n                    </TableCell>\r\n                    <TableCell>\r\n                      {penalty.isDuplicate ? (\r\n                        <Badge variant=\"outline\" className=\"text-amber-600 border-amber-300\">\r\n                          Đã tồn tại\r\n                        </Badge>\r\n                      ) : (\r\n                        <Badge variant=\"outline\" className=\"text-green-600 border-green-300\">\r\n                          Mới\r\n                        </Badge>\r\n                      )}\r\n                    </TableCell>\r\n                  </TableRow>\r\n                );\r\n              })}\r\n            </TableBody>\r\n          </Table>\r\n        </ScrollArea>\r\n\r\n        {/* Pagination */}\r\n        {penalties.length > PAGE_SIZE_OPTIONS[0] && (\r\n          <div className=\"flex items-center justify-between gap-4 pt-2\">\r\n            <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\r\n              <span>Hiển thị</span>\r\n              <Select\r\n                value={String(pageSize)}\r\n                onValueChange={(value) => {\r\n                  setPageSize(Number(value));\r\n                  setCurrentPage(1);\r\n                }}\r\n              >\r\n                <SelectTrigger className=\"h-8 w-[70px]\">\r\n                  <SelectValue />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  {PAGE_SIZE_OPTIONS.map((size) => (\r\n                    <SelectItem key={size} value={String(size)}>\r\n                      {size}\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n              <span>/ {penalties.length} vi phạm</span>\r\n            </div>\r\n\r\n            <div className=\"flex items-center gap-1\">\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"icon\"\r\n                className=\"h-8 w-8\"\r\n                onClick={() => setCurrentPage(p => Math.max(1, p - 1))}\r\n                disabled={currentPage === 1}\r\n              >\r\n                <ChevronLeft className=\"h-4 w-4\" />\r\n              </Button>\r\n              <span className=\"text-sm px-2\">\r\n                Trang {currentPage} / {totalPages}\r\n              </span>\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"icon\"\r\n                className=\"h-8 w-8\"\r\n                onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))}\r\n                disabled={currentPage === totalPages}\r\n              >\r\n                <ChevronRight className=\"h-4 w-4\" />\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Select all toggle */}\r\n        <div className=\"flex items-center gap-2 pt-2 border-t\">\r\n          <Checkbox\r\n            id=\"selectAllPenalties\"\r\n            checked={selectedIds.size === nonDuplicatePenalties.length && nonDuplicatePenalties.length > 0}\r\n            onCheckedChange={handleSelectAll}\r\n            disabled={nonDuplicatePenalties.length === 0}\r\n          />\r\n          <label htmlFor=\"selectAllPenalties\" className=\"text-sm cursor-pointer\">\r\n            Chọn tất cả {nonDuplicatePenalties.length} phiếu mới\r\n          </label>\r\n          <span className=\"text-sm text-muted-foreground ml-auto\">\r\n            Đã chọn: <span className=\"font-medium\">{selectedIds.size}</span> phiếu\r\n          </span>\r\n        </div>\r\n\r\n        <DialogFooter className=\"gap-2 sm:gap-0\">\r\n          <Button variant=\"ghost\" onClick={handleSkip}>\r\n            Bỏ qua\r\n          </Button>\r\n          <Button \r\n            onClick={handleConfirm}\r\n            disabled={selectedIds.size === 0}\r\n          >\r\n            Tạo {selectedIds.size} phiếu phạt\r\n          </Button>\r\n        </DialogFooter>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 11723, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/attendance/page.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { formatDate, formatDateTime, formatDateTimeSeconds, formatDateCustom, parseDate, getCurrentDate, getStartOfMonth, getEndOfMonth, addMonths, subtractMonths, toISODate, getDayOfWeek, formatMonthYear } from '../../lib/date-utils';\r\nimport { ROUTES } from '../../lib/router';\r\nimport * as XLSX from 'xlsx';\r\n\r\nimport { useEmployeeStore } from '../employees/store';\r\nimport { useDepartmentStore } from '../settings/departments/store';\r\nimport { usePageHeader } from '../../contexts/page-header-context';\r\nimport { getColumns } from './columns';\r\nimport type { AttendanceDataRow, DailyRecord, AnyAttendanceDataRow, ImportPreviewRow } from './types';\r\nimport type { SystemId } from '../../lib/id-types';\r\nimport { ResponsiveDataTable } from '../../components/data-table/responsive-data-table';\r\nimport { Card, CardContent } from '../../components/ui/card';\r\nimport { Button } from '../../components/ui/button';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../../components/ui/select';\r\nimport { Input } from '../../components/ui/input';\r\nimport { Upload, Download, Lock, ChevronLeft, ChevronRight, Search, Edit2, Printer } from 'lucide-react';\r\nimport Fuse from 'fuse.js';\r\nimport { AttendanceEditDialog } from './components/attendance-edit-dialog';\r\nimport { DataTableColumnCustomizer } from '../../components/data-table/data-table-column-toggle';\r\nimport { useEmployeeSettingsStore } from '../settings/employees/employee-settings-store';\r\nimport { useAttendanceStore } from './store';\r\nimport { useShallow } from 'zustand/react/shallow';\r\nimport { recalculateSummary, excelSerialToTime, initializeEmptyAttendance } from './utils';\r\nimport { AttendanceImportDialog } from './components/attendance-import-dialog';\r\nimport { BulkEditDialog } from './components/bulk-edit-dialog';\r\nimport { StatisticsDashboard } from './components/statistics-dashboard';\r\nimport { useDebounce } from '../../hooks/use-debounce';\r\nimport { toast } from 'sonner';\r\nimport { useLeaveStore } from '../leaves/store';\r\nimport { leaveAttendanceSync } from '../leaves/leave-sync-service';\r\nimport { usePrint } from '../../lib/use-print';\r\nimport { useStoreInfoStore } from '../settings/store-info/store-info-store';\r\nimport {\r\n  convertAttendanceSheetForPrint,\r\n  mapAttendanceSheetToPrintData,\r\n  mapAttendanceSheetLineItems,\r\n  createStoreSettings,\r\n} from '../../lib/print/attendance-print-helper';\r\nimport { previewAttendancePenalties, confirmCreatePenalties, type PenaltyPreviewItem } from './penalty-sync-service';\r\nimport { PenaltyConfirmDialog } from './components/penalty-confirm-dialog';\r\n\r\nconst MonthYearPicker = ({ value, onChange }: { value: Date, onChange: (date: Date) => void }) => {\r\n    const displayText = formatDateCustom(value, 'MM/yyyy');\r\n    return (\r\n        <div className=\"flex items-center gap-2\">\r\n            <Button variant=\"outline\" size=\"icon\" className=\"h-9 w-10\" onClick={() => { const prev = subtractMonths(value, 1); if (prev) onChange(prev); }}>\r\n                <ChevronLeft className=\"h-4 w-4\" />\r\n            </Button>\r\n            <div className=\"font-semibold text-body-sm w-24 text-center\">{displayText}</div>\r\n            <Button variant=\"outline\" size=\"icon\" className=\"h-9 w-10\" onClick={() => { const next = addMonths(value, 1); if (next) onChange(next); }}>\r\n                <ChevronRight className=\"h-4 w-4\" />\r\n            </Button>\r\n        </div>\r\n    )\r\n}\r\n\r\n\r\nexport function AttendancePage() {\r\n    const { data: employees } = useEmployeeStore();\r\n    const { data: departments } = useDepartmentStore();\r\n    const { settings } = useEmployeeSettingsStore();\r\n    \r\n    // Use selectors to minimize re-renders - functions are stable, only lockedMonths needs shallow compare\r\n    const lockedMonths = useAttendanceStore(useShallow((state) => state.lockedMonths));\r\n    const toggleLock = useAttendanceStore((state) => state.toggleLock);\r\n    const saveAttendanceData = useAttendanceStore((state) => state.saveAttendanceData);\r\n    const getAttendanceData = useAttendanceStore((state) => state.getAttendanceData);\r\n    \r\n    const { data: leaveRequests } = useLeaveStore();\r\n    \r\n    // Print integration\r\n    const { info: storeInfo } = useStoreInfoStore();\r\n    const { print } = usePrint();\r\n\r\n    // State\r\n    const [currentDate, setCurrentDate] = React.useState(getCurrentDate());\r\n    const [departmentFilter, setDepartmentFilter] = React.useState('all');\r\n    const [globalFilter, setGlobalFilter] = React.useState('');\r\n    const debouncedGlobalFilter = useDebounce(globalFilter, 300); // Debounce search\r\n    const [rowSelection, setRowSelection] = React.useState<Record<string, boolean>>({});\r\n    const [sorting, setSorting] = React.useState<{ id: string, desc: boolean }>({ id: 'createdAt', desc: true });\r\n    const [pagination, setPagination] = React.useState({ pageIndex: 0, pageSize: 20 });\r\n    const [columnVisibility, setColumnVisibility] = React.useState({});\r\n    const [columnOrder, setColumnOrder] = React.useState<string[]>([]);\r\n    const [pinnedColumns, setPinnedColumns] = React.useState<string[]>([]);\r\n    const [attendanceData, setAttendanceData] = React.useState<AttendanceDataRow[]>([]);\r\n    const [isEditModalOpen, setIsEditModalOpen] = React.useState(false);\r\n    const [editingRecordInfo, setEditingRecordInfo] = React.useState<{ employeeSystemId: SystemId; day: number; record: DailyRecord } | null>(null);\r\n    const [isImportDialogOpen, setIsImportDialogOpen] = React.useState(false);\r\n    \r\n    // Bulk edit states\r\n    const [isBulkEditDialogOpen, setIsBulkEditDialogOpen] = React.useState(false);\r\n    const [cellSelection, setCellSelection] = React.useState<Record<string, boolean>>({}); // key: \"employeeSystemId-day\"\r\n    const [isSelectionMode, setIsSelectionMode] = React.useState(false);\r\n\r\n    // Penalty confirmation states\r\n    const [isPenaltyConfirmOpen, setIsPenaltyConfirmOpen] = React.useState(false);\r\n    const [pendingPenalties, setPendingPenalties] = React.useState<PenaltyPreviewItem[]>([]);\r\n    const [pendingImportDate, setPendingImportDate] = React.useState<Date | null>(null);\r\n\r\n    const currentMonthKey = formatDateCustom(currentDate, 'yyyy-MM');\r\n    const isLocked = !!lockedMonths[currentMonthKey];\r\n\r\n    // Handle lock with feedback - use startTransition to prevent UI blocking\r\n    const handleToggleLock = React.useCallback(() => {\r\n        const monthLabel = formatDateCustom(currentDate, 'MM/yyyy');\r\n        const willBeLocked = !isLocked;\r\n        \r\n        // Use startTransition for non-urgent update\r\n        React.startTransition(() => {\r\n            toggleLock(currentMonthKey);\r\n        });\r\n        \r\n        // Show toast immediately (outside transition)\r\n        if (willBeLocked) {\r\n            toast.success('Đã khóa chấm công', { \r\n                description: `Tháng ${monthLabel} đã được khóa. Không thể chỉnh sửa dữ liệu.` \r\n            });\r\n        } else {\r\n            toast.success('Đã mở khóa chấm công', { \r\n                description: `Tháng ${monthLabel} đã được mở khóa. Có thể chỉnh sửa dữ liệu.` \r\n            });\r\n        }\r\n    }, [currentDate, currentMonthKey, isLocked, toggleLock]);\r\n\r\n    const replayApprovedLeavesForMonth = React.useCallback((monthKey: string) => {\r\n        if (!leaveRequests?.length) return;\r\n        const [yearStr, monthStr] = monthKey.split('-');\r\n        const year = Number(yearStr);\r\n        const month = Number(monthStr);\r\n        if (!year || !month) return;\r\n        const monthStart = new Date(year, month - 1, 1);\r\n        const monthEnd = new Date(year, month, 0);\r\n\r\n        leaveRequests.forEach((leave) => {\r\n            if (leave.status !== 'Đã duyệt') return;\r\n            const start = new Date(leave.startDate);\r\n            const end = new Date(leave.endDate);\r\n            if (Number.isNaN(start.getTime()) || Number.isNaN(end.getTime())) {\r\n                return;\r\n            }\r\n            if (start <= monthEnd && end >= monthStart) {\r\n                leaveAttendanceSync.apply(leave);\r\n            }\r\n        });\r\n    }, [leaveRequests]);\r\n\r\n    \r\n    \r\n    const handleConfirmImport = (\r\n        importedData: Record<SystemId, { day: number; checkIn?: string; morningCheckOut?: string; afternoonCheckIn?: string; checkOut?: string; overtimeCheckIn?: string; overtimeCheckOut?: string }[]>,\r\n        date: Date\r\n    ) => {\r\n        const year = date.getFullYear();\r\n        const month = date.getMonth() + 1;\r\n\r\n        const baseAttendanceData = initializeEmptyAttendance(employees, year, month, settings);\r\n\r\n        const updatedData = baseAttendanceData.map(employeeRow => {\r\n            const employeeUpdates = importedData[employeeRow.employeeSystemId];\r\n            if (employeeUpdates) {\r\n                // @ts-ignore\r\n                let mutableRow: AnyAttendanceDataRow = { ...employeeRow };\r\n\r\n                const dateObj = currentDate;\r\n                const daysInMonth = new Date(year, month, 0).getDate();\r\n                for (let d = 1; d <= daysInMonth; d++) {\r\n                    const workDate = new Date(year, month - 1, d);\r\n                    const dayOfWeek = getDayOfWeek(workDate);\r\n                    const isWorkingDay = dayOfWeek !== null && settings.workingDays.includes(dayOfWeek);\r\n                    // Clear existing data for this employee\r\n                    mutableRow[`day_${d}`] = { status: isWorkingDay ? 'absent' : 'weekend' };\r\n                }\r\n\r\n                employeeUpdates.forEach(update => {\r\n                    const dayKey = `day_${update.day}`;\r\n                    // Debug: Log imported data\r\n                    if (update.day === 3) {\r\n                        console.log('Import day 3:', JSON.stringify(update));\r\n                    }\r\n                    // Chỉ tính công khi có checkOut (giờ ra cuối ngày)\r\n                    // - Có checkIn VÀ checkOut → present (1 công)\r\n                    // - Chỉ có checkIn (quên chấm ra) → absent (không tính công, nhưng ghi nhận giờ vào)\r\n                    // - Chỉ có checkOut (hiếm) → absent\r\n                    const hasFullDay = update.checkIn && update.checkOut;\r\n                    \r\n                    const newRecord: DailyRecord = { \r\n                        status: hasFullDay ? 'present' : 'absent',\r\n                        checkIn: update.checkIn || undefined,\r\n                        morningCheckOut: update.morningCheckOut || undefined,\r\n                        afternoonCheckIn: update.afternoonCheckIn || undefined,\r\n                        checkOut: update.checkOut || undefined,\r\n                        overtimeCheckIn: update.overtimeCheckIn || undefined,\r\n                        overtimeCheckOut: update.overtimeCheckOut || undefined,\r\n                    };\r\n                    // Debug: Log saved record\r\n                    if (update.day === 3) {\r\n                        console.log('Saved record day 3:', JSON.stringify(newRecord));\r\n                    }\r\n                    mutableRow[dayKey] = newRecord;\r\n                });\r\n                \r\n                const summary = recalculateSummary(mutableRow, year, month, settings);\r\n                return { ...mutableRow, ...summary } as AttendanceDataRow;\r\n            }\r\n            return employeeRow;\r\n        });\r\n        \r\n        setAttendanceData(updatedData);\r\n        saveAttendanceData(formatDateCustom(date, 'yyyy-MM'), updatedData); // Save to store\r\n        setCurrentDate(date);\r\n        \r\n        // Preview phiếu phạt cho các vi phạm đi trễ/về sớm (không tạo ngay)\r\n        const penaltyPreviews = previewAttendancePenalties(updatedData, year, month);\r\n        \r\n        if (penaltyPreviews.length > 0) {\r\n            // Có vi phạm → hiển thị dialog xác nhận\r\n            setPendingPenalties(penaltyPreviews);\r\n            setPendingImportDate(date);\r\n            setIsPenaltyConfirmOpen(true);\r\n            toast.success('Nhập thành công', {\r\n                description: `Đã cập nhật chấm công cho tháng ${formatDateCustom(date, 'MM/yyyy')}. Phát hiện ${penaltyPreviews.length} vi phạm.`,\r\n            });\r\n        } else {\r\n            // Không có vi phạm\r\n            toast.success('Nhập thành công', {\r\n                description: `Đã cập nhật chấm công cho tháng ${formatDateCustom(date, 'MM/yyyy')}`,\r\n            });\r\n        }\r\n    };\r\n\r\n    // Handler khi user xác nhận tạo phiếu phạt\r\n    const handleConfirmPenalties = (selectedPenalties: Omit<import('../settings/penalties/types').Penalty, 'systemId'>[]) => {\r\n        const created = confirmCreatePenalties(selectedPenalties);\r\n        toast.success('Tạo phiếu phạt thành công', {\r\n            description: `Đã tạo ${created} phiếu phạt từ dữ liệu chấm công.`,\r\n        });\r\n        setPendingPenalties([]);\r\n        setPendingImportDate(null);\r\n    };\r\n\r\n    // Handler khi user bỏ qua tạo phiếu phạt\r\n    const handleSkipPenalties = () => {\r\n        toast.info('Đã bỏ qua tạo phiếu phạt');\r\n        setPendingPenalties([]);\r\n        setPendingImportDate(null);\r\n    };\r\n\r\n    // Bulk edit handlers\r\n    const toggleCellSelection = React.useCallback((employeeSystemId: SystemId, day: number) => {\r\n        if (!isSelectionMode || isLocked) return;\r\n        \r\n        const key = `${employeeSystemId}-${day}`;\r\n        setCellSelection(prev => {\r\n            const newSelection = { ...prev };\r\n            if (newSelection[key]) {\r\n                delete newSelection[key];\r\n            } else {\r\n                newSelection[key] = true;\r\n            }\r\n            return newSelection;\r\n        });\r\n    }, [isSelectionMode, isLocked]);\r\n\r\n    const selectedCellsArray = React.useMemo<Array<{ employeeSystemId: SystemId; employeeCode: string; employeeName: string; day: number }>>(\r\n        () =>\r\n            Object.keys(cellSelection).map((key) => {\r\n                const [systemId, dayStr] = key.split('-');\r\n                const employeeSystemId = systemId as SystemId;\r\n                const employee = attendanceData.find((e) => e.employeeSystemId === employeeSystemId);\r\n                return {\r\n                    employeeSystemId,\r\n                    employeeCode: employee?.employeeId ?? '',\r\n                    employeeName: employee?.fullName || '',\r\n                    day: parseInt(dayStr, 10),\r\n                };\r\n            }),\r\n        [cellSelection, attendanceData]\r\n    );\r\n\r\n    const handleBulkSave = (updates: Array<{ employeeSystemId: SystemId; day: number; record: DailyRecord }>) => {\r\n        setAttendanceData(prevData =>\r\n            prevData.map(row => {\r\n                const employeeUpdates = updates.filter(u => u.employeeSystemId === row.employeeSystemId);\r\n                if (employeeUpdates.length > 0) {\r\n                    const newRow = { ...row } as AnyAttendanceDataRow;\r\n                    employeeUpdates.forEach(update => {\r\n                        newRow[`day_${update.day}`] = update.record;\r\n                    });\r\n                    const summary = recalculateSummary(newRow, currentDate.getFullYear(), currentDate.getMonth() + 1, settings);\r\n                    return { ...newRow, ...summary } as AttendanceDataRow;\r\n                }\r\n                return row;\r\n            })\r\n        );\r\n        \r\n        // Save to store\r\n        const updatedData = attendanceData.map(row => {\r\n            const employeeUpdates = updates.filter(u => u.employeeSystemId === row.employeeSystemId);\r\n            if (employeeUpdates.length > 0) {\r\n                const newRow = { ...row } as AnyAttendanceDataRow;\r\n                employeeUpdates.forEach(update => {\r\n                    newRow[`day_${update.day}`] = update.record;\r\n                });\r\n                const summary = recalculateSummary(newRow, currentDate.getFullYear(), currentDate.getMonth() + 1, settings);\r\n                return { ...newRow, ...summary } as AttendanceDataRow;\r\n            }\r\n            return row;\r\n        });\r\n        saveAttendanceData(currentMonthKey, updatedData);\r\n\r\n        setCellSelection({});\r\n        setIsSelectionMode(false);\r\n        toast.success('Cập nhật thành công', {\r\n            description: `Đã chỉnh sửa ${updates.length} ô`,\r\n        });\r\n    };\r\n\r\n    const handleQuickFill = React.useCallback((employeeSystemId: SystemId, day: number) => {\r\n        if (isLocked) return;\r\n        \r\n        // Double-click to quick fill with default work hours\r\n        const defaultRecord: DailyRecord = {\r\n            status: 'present',\r\n            checkIn: settings.workStartTime,\r\n            checkOut: settings.workEndTime,\r\n        };\r\n\r\n        setAttendanceData(prevData =>\r\n            prevData.map(row => {\r\n                if (row.employeeSystemId === employeeSystemId) {\r\n                    const newRow = { ...row } as AnyAttendanceDataRow;\r\n                    newRow[`day_${day}`] = defaultRecord;\r\n                    const summary = recalculateSummary(newRow, currentDate.getFullYear(), currentDate.getMonth() + 1, settings);\r\n                    return { ...newRow, ...summary } as AttendanceDataRow;\r\n                }\r\n                return row;\r\n            })\r\n        );\r\n\r\n        // Save to store\r\n        const updatedData = attendanceData.map(row => {\r\n            if (row.employeeSystemId === employeeSystemId) {\r\n                const newRow = { ...row } as AnyAttendanceDataRow;\r\n                newRow[`day_${day}`] = defaultRecord;\r\n                const summary = recalculateSummary(newRow, currentDate.getFullYear(), currentDate.getMonth() + 1, settings);\r\n                return { ...newRow, ...summary } as AttendanceDataRow;\r\n            }\r\n            return row;\r\n        });\r\n        saveAttendanceData(currentMonthKey, updatedData);\r\n\r\n        toast('Điền nhanh', {\r\n            description: 'Đã áp dụng giờ làm việc mặc định',\r\n        });\r\n    }, [attendanceData, currentDate, settings, isLocked, currentMonthKey, saveAttendanceData, toast]);\r\n\r\n     React.useEffect(() => {\r\n        // Load from store first, fallback to empty data structure\r\n        const storedMonthData = getAttendanceData(currentMonthKey);\r\n        if (storedMonthData && storedMonthData.length > 0) {\r\n            setAttendanceData(storedMonthData);\r\n        } else {\r\n            const emptyData = initializeEmptyAttendance(employees, currentDate.getFullYear(), currentDate.getMonth() + 1, settings);\r\n            setAttendanceData(emptyData);\r\n            saveAttendanceData(currentMonthKey, emptyData); // Save initial data\r\n            replayApprovedLeavesForMonth(currentMonthKey);\r\n        }\r\n    }, [employees, currentDate, settings, currentMonthKey, getAttendanceData, saveAttendanceData, replayApprovedLeavesForMonth]);\r\n    \r\n    // Filtering logic with debounced search\r\n    const filteredData = React.useMemo(() => {\r\n        let data = attendanceData;\r\n        if (departmentFilter !== 'all') {\r\n            data = data.filter(row => row.department === departmentFilter);\r\n        }\r\n        if (debouncedGlobalFilter) {\r\n            const fuse = new Fuse(data, { keys: [\"fullName\", \"employeeId\"], threshold: 0.3 });\r\n            return fuse.search(debouncedGlobalFilter).map(result => result.item);\r\n        }\r\n        return data;\r\n    }, [attendanceData, debouncedGlobalFilter, departmentFilter]);\r\n    \r\n     const sortedData = React.useMemo(() => {\r\n        const sorted = [...filteredData];\r\n        if (sorting.id) {\r\n          sorted.sort((a, b) => {\r\n            const aValue = (a as any)[sorting.id];\r\n            const bValue = (b as any)[sorting.id];\r\n            if (aValue === null || aValue === undefined) return 1;\r\n            if (bValue === null || bValue === undefined) return -1;\r\n            // Special handling for date columns\r\n            if (sorting.id === 'createdAt') {\r\n              const aTime = aValue ? new Date(aValue).getTime() : 0;\r\n              const bTime = bValue ? new Date(bValue).getTime() : 0;\r\n              return sorting.desc ? bTime - aTime : aTime - bTime;\r\n            }\r\n            if (aValue < bValue) return sorting.desc ? 1 : -1;\r\n            if (aValue > bValue) return sorting.desc ? -1 : 1;\r\n            return 0;\r\n          });\r\n        }\r\n        return sorted;\r\n     }, [filteredData, sorting]);\r\n\r\n        const handleExport = React.useCallback(() => {\r\n            // Re-check data at call time to avoid stale closure\r\n            const currentFilteredData = (() => {\r\n                let data = attendanceData;\r\n                if (departmentFilter !== 'all') {\r\n                    data = data.filter(row => row.department === departmentFilter);\r\n                }\r\n                if (debouncedGlobalFilter) {\r\n                    const fuse = new Fuse(data, { keys: [\"fullName\", \"employeeId\"], threshold: 0.3 });\r\n                    return fuse.search(debouncedGlobalFilter).map(result => result.item);\r\n                }\r\n                return data;\r\n            })();\r\n            \r\n            // Debug: Log data để kiểm tra\r\n            console.log('Export - currentMonthKey:', formatDateCustom(currentDate, 'yyyy-MM'));\r\n            console.log('Export - attendanceData length:', attendanceData.length);\r\n            console.log('Export - currentFilteredData length:', currentFilteredData.length);\r\n            \r\n            // Check store directly\r\n            const storeData = getAttendanceData(formatDateCustom(currentDate, 'yyyy-MM'));\r\n            console.log('Export - storeData:', storeData ? `${storeData.length} rows` : 'NULL');\r\n            if (storeData && storeData.length > 0) {\r\n                console.log('Export - Store sample day_1:', JSON.stringify(storeData[0]?.day_1));\r\n                console.log('Export - Store sample day_3:', JSON.stringify(storeData[0]?.day_3));\r\n            }\r\n            \r\n            if (currentFilteredData.length > 0) {\r\n                console.log('Export - State sample day_1:', JSON.stringify(currentFilteredData[0]?.day_1));\r\n                console.log('Export - State sample day_3:', JSON.stringify(currentFilteredData[0]?.day_3));\r\n            }\r\n            \r\n            const dataToExport = currentFilteredData;\r\n            if (dataToExport.length === 0) {\r\n                toast.error('Không có dữ liệu', {\r\n                    description: 'Không có dữ liệu để xuất file',\r\n                });\r\n                return;\r\n            }\r\n\r\n            const year = currentDate.getFullYear();\r\n            const month = currentDate.getMonth() + 1;\r\n            const daysInMonth = new Date(year, month, 0).getDate();\r\n            const startMonth = getStartOfMonth(currentDate);\r\n            const endMonth = getEndOfMonth(currentDate);\r\n            const startDate = startMonth ? toISODate(startMonth) : '';\r\n            const endDate = endMonth ? toISODate(endMonth) : '';\r\n\r\n            const wb = XLSX.utils.book_new();\r\n\r\n            const employeeChunks: AttendanceDataRow[][] = [];\r\n            for (let i = 0; i < dataToExport.length; i += 3) {\r\n                employeeChunks.push(dataToExport.slice(i, i + 3));\r\n            }\r\n\r\n            employeeChunks.forEach((chunk, chunkIndex) => {\r\n                const ws_data: any[][] = [];\r\n                const merges: XLSX.Range[] = [];\r\n            \r\n                // General Headers - Row 0: Title\r\n                ws_data[0] = [];\r\n                ws_data[0][11] = 'Bảng nhật ký chấm công';\r\n                \r\n                // Row 1: Date info\r\n                ws_data[1] = [];\r\n                ws_data[1][33] = `Chấm công từ:${startDate}~${endDate}`;\r\n                \r\n                // Row 2: Created date\r\n                ws_data[2] = [];\r\n                ws_data[2][33] = `Ngày tạo:${formatDateCustom(new Date(), 'yyyy-MM-dd HH:mm:ss')}`;\r\n\r\n                chunk.forEach((emp, empIndex) => {\r\n                    // 15 cols per employee to match machine format\r\n                    const startCol = empIndex * 15;\r\n\r\n                    // Row 3: Employee name info\r\n                    ws_data[3] = ws_data[3] || [];\r\n                    ws_data[3][startCol + 0] = 'Phòng ban';\r\n                    ws_data[3][startCol + 1] = 'CÔNG TY';\r\n                    merges.push({ s: { r: 3, c: startCol + 1 }, e: { r: 3, c: startCol + 7 } });\r\n                    ws_data[3][startCol + 8] = 'Họ tên';\r\n                    ws_data[3][startCol + 9] = emp.fullName;\r\n                    merges.push({ s: { r: 3, c: startCol + 9 }, e: { r: 3, c: startCol + 14 } });\r\n                    \r\n                    // Row 4: Date range & Employee ID\r\n                    ws_data[4] = ws_data[4] || [];\r\n                    ws_data[4][startCol + 0] = 'Ngày';\r\n                    ws_data[4][startCol + 1] = `${startDate}~${endDate}`;\r\n                    merges.push({ s: { r: 4, c: startCol + 1 }, e: { r: 4, c: startCol + 7 } });\r\n                    ws_data[4][startCol + 8] = 'Mã';\r\n                    ws_data[4][startCol + 9] = emp.employeeId;\r\n\r\n                    // Row 5-6: Summary headers\r\n                    ws_data[5] = ws_data[5] || [];\r\n                    ws_data[5][startCol + 0] = 'Nghỉ không\\nphép (ngày)';\r\n                    ws_data[5][startCol + 1] = 'Nghỉ\\nphép\\n(ngày)';\r\n                    ws_data[5][startCol + 2] = 'Công tác\\n(ngày)';\r\n                    ws_data[5][startCol + 4] = 'Đi làm\\n(ngày)';\r\n                    ws_data[5][startCol + 5] = 'Tăng ca (tiếng)';\r\n                    merges.push({ s: { r: 5, c: startCol + 5 }, e: { r: 5, c: startCol + 7 } });\r\n                    ws_data[5][startCol + 8] = 'Đến muộn';\r\n                    merges.push({ s: { r: 5, c: startCol + 8 }, e: { r: 5, c: startCol + 10 } });\r\n                    ws_data[5][startCol + 11] = 'Về sớm';\r\n                    merges.push({ s: { r: 5, c: startCol + 11 }, e: { r: 5, c: startCol + 13 } });\r\n                    \r\n                    ws_data[6] = ws_data[6] || [];\r\n                    ws_data[6][startCol + 5] = 'Bình\\nthường';\r\n                    ws_data[6][startCol + 7] = 'Đặc\\nbiệt';\r\n                    ws_data[6][startCol + 8] = '(Lần)';\r\n                    ws_data[6][startCol + 9] = '(Phút)';\r\n                    ws_data[6][startCol + 11] = '(Lần)';\r\n                    ws_data[6][startCol + 13] = '(Phút)';\r\n                    \r\n                    // Row 7: Summary data\r\n                    ws_data[7] = ws_data[7] || [];\r\n                    ws_data[7][startCol + 0] = emp.absentDays || 0;\r\n                    ws_data[7][startCol + 1] = emp.leaveDays || 0;\r\n                    ws_data[7][startCol + 2] = 0; // Công tác\r\n                    ws_data[7][startCol + 4] = emp.workDays || 0;\r\n                    ws_data[7][startCol + 5] = emp.otHours || 0;\r\n                    ws_data[7][startCol + 8] = emp.lateArrivals || 0;\r\n                    ws_data[7][startCol + 11] = emp.earlyDepartures || 0;\r\n\r\n                    // Row 9: \"Bảng chấm công\" header\r\n                    ws_data[9] = ws_data[9] || [];\r\n                    ws_data[9][startCol + 0] = 'Bảng chấm công';\r\n                    merges.push({ s: { r: 9, c: startCol + 0 }, e: { r: 9, c: startCol + 14 } });\r\n\r\n                    // Row 10: Main headers (Ngày Thứ, Sáng, Chiều, Tăng ca)\r\n                    ws_data[10] = ws_data[10] || [];\r\n                    ws_data[10][startCol + 0] = 'Ngày Thứ';\r\n                    merges.push({ s: { r: 10, c: startCol + 0 }, e: { r: 11, c: startCol + 0 } });\r\n                    ws_data[10][startCol + 1] = 'Sáng';\r\n                    merges.push({ s: { r: 10, c: startCol + 1 }, e: { r: 10, c: startCol + 5 } });\r\n                    ws_data[10][startCol + 6] = 'Chiều';\r\n                    merges.push({ s: { r: 10, c: startCol + 6 }, e: { r: 10, c: startCol + 9 } });\r\n                    ws_data[10][startCol + 10] = 'Tăng ca';\r\n                    merges.push({ s: { r: 10, c: startCol + 10 }, e: { r: 10, c: startCol + 14 } });\r\n\r\n                    // Row 11: Sub headers\r\n                    ws_data[11] = ws_data[11] || [];\r\n                    ws_data[11][startCol + 1] = 'Làm việc';\r\n                    merges.push({ s: { r: 11, c: startCol + 1 }, e: { r: 11, c: startCol + 2 } });\r\n                    ws_data[11][startCol + 3] = 'Tan làm';\r\n                    merges.push({ s: { r: 11, c: startCol + 3 }, e: { r: 11, c: startCol + 5 } });\r\n                    ws_data[11][startCol + 6] = 'Làm việc';\r\n                    merges.push({ s: { r: 11, c: startCol + 6 }, e: { r: 11, c: startCol + 7 } });\r\n                    ws_data[11][startCol + 8] = 'Tan làm';\r\n                    merges.push({ s: { r: 11, c: startCol + 8 }, e: { r: 11, c: startCol + 9 } });\r\n                    ws_data[11][startCol + 10] = 'Đánh dấu\\nđến';\r\n                    merges.push({ s: { r: 11, c: startCol + 10 }, e: { r: 11, c: startCol + 11 } });\r\n                    ws_data[11][startCol + 12] = 'Đánh dấu\\nvề';\r\n                    merges.push({ s: { r: 11, c: startCol + 12 }, e: { r: 11, c: startCol + 14 } });\r\n\r\n                    // Data rows - start from row 12\r\n                    for (let day = 1; day <= daysInMonth; day++) {\r\n                        const rowIndex = 11 + day;\r\n                        const dataRow = ws_data[rowIndex] = ws_data[rowIndex] || [];\r\n                        const date = new Date(year, month - 1, day);\r\n                        const dayOfWeek = date.getDay();\r\n                        const dayNames = ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7'];\r\n                        const dayStr = `${String(day).padStart(2, '0')} ${dayNames[dayOfWeek]}`;\r\n                        \r\n                        const dayKey = `day_${day}` as keyof AttendanceDataRow;\r\n                        const record = emp[dayKey] as DailyRecord | undefined;\r\n\r\n                        // Debug: Log record when exporting day 3\r\n                        if (day === 3 && chunkIndex === 0 && empIndex === 0) {\r\n                            console.log('Export Record day_3 for emp 0:', JSON.stringify(record));\r\n                        }\r\n\r\n                        dataRow[startCol + 0] = dayStr;\r\n                        dataRow[startCol + 1] = record?.checkIn || null;           // Sáng - Làm việc\r\n                        dataRow[startCol + 3] = record?.morningCheckOut || null;   // Sáng - Tan làm\r\n                        dataRow[startCol + 6] = record?.afternoonCheckIn || null;  // Chiều - Làm việc\r\n                        dataRow[startCol + 8] = record?.checkOut || null;          // Chiều - Tan làm\r\n                        dataRow[startCol + 10] = record?.overtimeCheckIn || null;  // Tăng ca - Đánh dấu đến\r\n                        dataRow[startCol + 12] = record?.overtimeCheckOut || null; // Tăng ca - Đánh dấu về\r\n                    }\r\n                });\r\n\r\n                const ws = XLSX.utils.aoa_to_sheet(ws_data);\r\n                ws['!merges'] = merges;\r\n                XLSX.utils.book_append_sheet(wb, ws, chunkIndex === 0 ? '1,2,3' : `${chunkIndex * 3 + 1},${chunkIndex * 3 + 2},${chunkIndex * 3 + 3}`);\r\n            });\r\n\r\n            XLSX.writeFile(wb, `Bang_cham_cong_thang_${month}-${year}.xlsx`);\r\n\r\n            toast.success('Xuất file thành công', {\r\n                description: `Đã xuất ${dataToExport.length} nhân viên sang Excel`,\r\n            });\r\n        }, [attendanceData, departmentFilter, debouncedGlobalFilter, currentDate]);\r\n\r\n        const handlePrint = React.useCallback(() => {\r\n            if (!sortedData?.length) return;\r\n\r\n            const storeSettings = createStoreSettings(storeInfo);\r\n            const monthKey = formatDateCustom(currentDate, 'yyyy-MM');\r\n            const departmentName = departmentFilter !== 'all' \r\n                ? departments.find(d => d.systemId === departmentFilter)?.name \r\n                : undefined;\r\n\r\n            const sheetForPrint = convertAttendanceSheetForPrint(\r\n                monthKey,\r\n                sortedData as any, // Cast to flexible interface\r\n                {\r\n                    isLocked,\r\n                    departmentName,\r\n                }\r\n            );\r\n\r\n            print('attendance', {\r\n                data: mapAttendanceSheetToPrintData(sheetForPrint, storeSettings),\r\n                lineItems: mapAttendanceSheetLineItems(sheetForPrint.employees, monthKey),\r\n            });\r\n        }, [sortedData, currentDate, departmentFilter, departments, isLocked, storeInfo, print]);\r\n\r\n        const pageActions = React.useMemo(() => [\r\n            isSelectionMode ? (\r\n                <Button key=\"bulk-edit\" variant=\"default\" size=\"sm\" className=\"h-9\" disabled={selectedCellsArray.length === 0} onClick={() => setIsBulkEditDialogOpen(true)}>\r\n                    <Edit2 className=\"mr-2 h-4 w-4\" />\r\n                    Sửa {selectedCellsArray.length} ô\r\n                </Button>\r\n            ) : null,\r\n            <Button \r\n                key=\"selection-mode\" \r\n                variant={isSelectionMode ? \"secondary\" : \"outline\"} \r\n                size=\"sm\" \r\n                className=\"h-9\" \r\n                disabled={isLocked}\r\n                onClick={() => {\r\n                    setIsSelectionMode(!isSelectionMode);\r\n                    if (isSelectionMode) setCellSelection({});\r\n                }}\r\n            >\r\n                {isSelectionMode ? 'Thoát chế độ chọn' : 'Chọn nhiều ô'}\r\n            </Button>,\r\n            <Button key=\"print\" variant=\"outline\" size=\"sm\" className=\"h-9\" onClick={handlePrint}>\r\n                <Printer className=\"mr-2 h-4 w-4\" />\r\n                In\r\n            </Button>,\r\n            <Button key=\"import\" variant=\"outline\" size=\"sm\" className=\"h-9\" disabled={isLocked} onClick={() => setIsImportDialogOpen(true)}>\r\n                <Upload className=\"mr-2 h-4 w-4\" />\r\n                Nhập file\r\n            </Button>,\r\n            <Button key=\"export\" variant=\"outline\" size=\"sm\" className=\"h-9\" onClick={handleExport}>\r\n                <Download className=\"mr-2 h-4 w-4\" />\r\n                Xuất file\r\n            </Button>,\r\n            <Button key={`lock-${currentMonthKey}`} size=\"sm\" className=\"h-9\" onClick={handleToggleLock}>\r\n                <Lock className=\"mr-2 h-4 w-4\" />\r\n                {isLocked ? 'Mở khóa' : 'Khóa'}\r\n            </Button>\r\n        ].filter(Boolean), [\r\n            isSelectionMode,\r\n            selectedCellsArray.length,\r\n            isLocked,\r\n            handlePrint,\r\n            handleExport,\r\n            currentMonthKey,\r\n            handleToggleLock\r\n        ]);\r\n\r\n        usePageHeader({\r\n            title: 'Chấm công',\r\n            breadcrumb: [\r\n                { label: 'Nhân sự', href: ROUTES.HRM.EMPLOYEES, isCurrent: false },\r\n                { label: 'Chấm công', href: ROUTES.HRM.ATTENDANCE, isCurrent: true }\r\n            ],\r\n            actions: pageActions\r\n        });\r\n\r\n    const handleEditRecord = React.useCallback((employeeSystemId: SystemId, day: number) => {\r\n        if (isLocked) return;\r\n        \r\n        // If in selection mode, toggle selection instead\r\n        if (isSelectionMode) {\r\n            toggleCellSelection(employeeSystemId, day);\r\n            return;\r\n        }\r\n        \r\n        const employeeData = attendanceData.find(emp => emp.employeeSystemId === employeeSystemId);\r\n        if (employeeData) {\r\n            setEditingRecordInfo({\r\n                employeeSystemId,\r\n                day,\r\n                record: employeeData[`day_${day}`] as DailyRecord,\r\n            });\r\n            setIsEditModalOpen(true);\r\n        }\r\n    }, [attendanceData, isLocked, isSelectionMode, toggleCellSelection]);\r\n\r\n    const handleSaveRecord = (updatedRecord: DailyRecord) => {\r\n        if (!editingRecordInfo) return;\r\n    \r\n        const updatedData = attendanceData.map(row => {\r\n            if (row.employeeSystemId === editingRecordInfo.employeeSystemId) {\r\n                const newRow = { ...row } as AnyAttendanceDataRow;\r\n                newRow[`day_${editingRecordInfo.day}`] = updatedRecord;\r\n\r\n                const summary = recalculateSummary(newRow, currentDate.getFullYear(), currentDate.getMonth() + 1, settings);\r\n\r\n                return { ...newRow, ...summary } as AttendanceDataRow;\r\n            }\r\n            return row;\r\n        });\r\n\r\n        setAttendanceData(updatedData);\r\n        saveAttendanceData(currentMonthKey, updatedData); // Save to store\r\n    \r\n        setIsEditModalOpen(false);\r\n        setEditingRecordInfo(null);\r\n        \r\n        toast.success('Cập nhật thành công', {\r\n            description: `Đã lưu chấm công ngày ${editingRecordInfo.day}`,\r\n        });\r\n    };\r\n\r\n    // Columns - Pass cell selection state\r\n    const columns = React.useMemo(\r\n        () => getColumns(\r\n            currentDate.getFullYear(), \r\n            currentDate.getMonth() + 1, \r\n            handleEditRecord, \r\n            settings, \r\n            isLocked,\r\n            isSelectionMode,\r\n            cellSelection,\r\n            handleQuickFill\r\n        ),\r\n        [currentDate, handleEditRecord, settings, isLocked, isSelectionMode, cellSelection, handleQuickFill]\r\n    );\r\n    \r\n    // Initialize column visibility once\r\n    const hasInitializedColumns = React.useRef(false);\r\n    React.useEffect(() => {\r\n        if (hasInitializedColumns.current || columns.length === 0) return;\r\n        \r\n        const initialVisibility: Record<string, boolean> = {};\r\n        columns.forEach(c => {\r\n          initialVisibility[c.id!] = true;\r\n        });\r\n        setColumnVisibility(initialVisibility);\r\n        setColumnOrder(columns.map(c => c.id).filter(Boolean) as string[]);\r\n        setPinnedColumns(['select', 'fullName']);\r\n        hasInitializedColumns.current = true;\r\n      }, [columns]);\r\n\r\n    const pageCount = Math.ceil(sortedData.length / pagination.pageSize);\r\n    const paginatedData = sortedData.slice(pagination.pageIndex * pagination.pageSize, pagination.pageIndex * pagination.pageSize + pagination.pageSize);\r\n\r\n         const allSelectedRows = React.useMemo(() => \r\n                attendanceData.filter(att => rowSelection[att.systemId]),\r\n            [attendanceData, rowSelection]);\r\n\r\n    return (\r\n        <div className=\"flex flex-col h-full space-y-4\">\r\n            {/* Statistics Dashboard */}\r\n            <StatisticsDashboard data={filteredData} currentDate={currentDate} />\r\n            \r\n            <Card className=\"flex-shrink-0\">\r\n                <CardContent className=\"p-4\">\r\n                    <div className=\"flex flex-wrap items-center justify-between gap-2\">\r\n                        <div className=\"flex flex-wrap items-center gap-2\">\r\n                           <MonthYearPicker value={currentDate} onChange={setCurrentDate} />\r\n                           <Select value={departmentFilter} onValueChange={setDepartmentFilter}>\r\n                                <SelectTrigger className=\"h-9 w-full sm:w-[180px]\">\r\n                                    <SelectValue placeholder=\"Tất cả phòng ban\" />\r\n                                </SelectTrigger>\r\n                                <SelectContent>\r\n                                    <SelectItem value=\"all\">Tất cả phòng ban</SelectItem>\r\n                                    {departments.map(d => <SelectItem key={d.id} value={d.name}>{d.name}</SelectItem>)}\r\n                                </SelectContent>\r\n                           </Select>\r\n                           <div className=\"relative\">\r\n                                <Search className=\"absolute left-2.5 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\r\n                                <Input\r\n                                    placeholder=\"Tìm nhân viên...\"\r\n                                    value={globalFilter}\r\n                                    onChange={(e) => setGlobalFilter(e.target.value)}\r\n                                    className=\"h-9 w-[200px] pl-8\"\r\n                                />\r\n                           </div>\r\n                        </div>\r\n                         <div className=\"flex items-center justify-end gap-2\">\r\n                            <DataTableColumnCustomizer\r\n                                columns={columns}\r\n                                columnVisibility={columnVisibility}\r\n                                setColumnVisibility={setColumnVisibility}\r\n                                columnOrder={columnOrder}\r\n                                setColumnOrder={setColumnOrder}\r\n                                pinnedColumns={pinnedColumns}\r\n                                setPinnedColumns={setPinnedColumns}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </CardContent>\r\n            </Card>\r\n\r\n            <ResponsiveDataTable\r\n                columns={columns}\r\n                data={paginatedData}\r\n                rowCount={filteredData.length}\r\n                pageCount={pageCount}\r\n                pagination={pagination}\r\n                setPagination={setPagination}\r\n                rowSelection={rowSelection}\r\n                setRowSelection={setRowSelection}\r\n                sorting={sorting}\r\n                setSorting={setSorting}\r\n                columnVisibility={columnVisibility}\r\n                setColumnVisibility={setColumnVisibility}\r\n                columnOrder={columnOrder}\r\n                setColumnOrder={setColumnOrder}\r\n                pinnedColumns={pinnedColumns}\r\n                setPinnedColumns={setPinnedColumns}\r\n                className=\"flex-grow\"\r\n                allSelectedRows={allSelectedRows}\r\n                expanded={{}}\r\n                setExpanded={() => {}}\r\n            />\r\n\r\n            <AttendanceEditDialog\r\n                isOpen={isEditModalOpen}\r\n                onOpenChange={setIsEditModalOpen}\r\n                recordData={editingRecordInfo}\r\n                onSave={handleSaveRecord}\r\n                monthDate={currentDate}\r\n            />\r\n\r\n            <AttendanceImportDialog\r\n                isOpen={isImportDialogOpen}\r\n                onOpenChange={setIsImportDialogOpen}\r\n                onConfirmImport={handleConfirmImport}\r\n                employees={employees}\r\n            />\r\n\r\n            <BulkEditDialog\r\n                isOpen={isBulkEditDialogOpen}\r\n                onOpenChange={setIsBulkEditDialogOpen}\r\n                selectedCells={selectedCellsArray}\r\n                onSave={handleBulkSave}\r\n            />\r\n\r\n            <PenaltyConfirmDialog\r\n                isOpen={isPenaltyConfirmOpen}\r\n                onOpenChange={setIsPenaltyConfirmOpen}\r\n                penalties={pendingPenalties}\r\n                onConfirm={handleConfirmPenalties}\r\n                onSkip={handleSkipPenalties}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}