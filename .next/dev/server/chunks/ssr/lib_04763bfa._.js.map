{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/api-config.ts"],"sourcesContent":["/**\r\n * API Configuration Utilities\r\n * \r\n * Centralized configuration for API endpoints.\r\n * All API URLs should use these utilities instead of hardcoding.\r\n */\r\n\r\n/**\r\n * Get the API base URL from environment variables\r\n * Falls back to localhost:3001 for development\r\n */\r\nexport function getApiBaseUrl(): string {\r\n  // Use relative path to leverage Vite proxy in development\r\n  // This avoids CORS issues when frontend (5173) talks to backend (3001)\r\n  if ((import.meta as any).env?.DEV) {\r\n    return '/api';\r\n  }\r\n  return (import.meta as any).env?.VITE_API_BASE_URL || 'http://localhost:3001/api';\r\n}\r\n\r\n/**\r\n * Get the base URL without /api suffix\r\n * Falls back to localhost:3001 for development\r\n */\r\nexport function getBaseUrl(): string {\r\n  const apiUrl = getApiBaseUrl();\r\n  return apiUrl.replace('/api', '');\r\n}\r\n\r\n/**\r\n * Build a full file URL from a relative path\r\n * @param relativePath - Relative file path (e.g., \"/uploads/documents/file.pdf\")\r\n * @returns Full URL to the file\r\n */\r\nexport function getFileUrl(relativePath: string): string {\r\n  if (!relativePath) return '';\r\n  \r\n  // If already a full URL, return as is\r\n  if (relativePath.startsWith('http://') || relativePath.startsWith('https://')) {\r\n    return relativePath;\r\n  }\r\n  \r\n  // Build full URL\r\n  const baseUrl = getBaseUrl();\r\n  return `${baseUrl}${relativePath}`;\r\n}\r\n\r\n/**\r\n * Build an API endpoint URL\r\n * @param endpoint - API endpoint path (e.g., \"/employees/documents\")\r\n * @returns Full API URL\r\n */\r\nexport function getApiUrl(endpoint: string): string {\r\n  const apiBaseUrl = getApiBaseUrl();\r\n  return `${apiBaseUrl}${endpoint}`;\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;;CAKC,GAED;;;CAGC;;;;;;;;;;;;;;;AACM,SAAS;IACd,0DAA0D;IAC1D,uEAAuE;IACvE,IAAI,8BAAqB,GAAG,EAAE,KAAK;QACjC,OAAO;IACT;IACA,OAAO,8BAAqB,GAAG,EAAE,qBAAqB;AACxD;AAMO,SAAS;IACd,MAAM,SAAS;IACf,OAAO,OAAO,OAAO,CAAC,QAAQ;AAChC;AAOO,SAAS,WAAW,YAAoB;IAC7C,IAAI,CAAC,cAAc,OAAO;IAE1B,sCAAsC;IACtC,IAAI,aAAa,UAAU,CAAC,cAAc,aAAa,UAAU,CAAC,aAAa;QAC7E,OAAO;IACT;IAEA,iBAAiB;IACjB,MAAM,UAAU;IAChB,OAAO,GAAG,UAAU,cAAc;AACpC;AAOO,SAAS,UAAU,QAAgB;IACxC,MAAM,aAAa;IACnB,OAAO,GAAG,aAAa,UAAU;AACnC"}},
    {"offset": {"line": 57, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/id-utils.ts"],"sourcesContent":["/**\r\n * ID Utilities\r\n * Helpers for generating and validating IDs (systemId & business id)\r\n */\r\n\r\nimport { getPrefix, type EntityType } from './smart-prefix';\r\nimport { ID_CONFIG } from './id-config';\r\n\r\n// Re-export EntityType for convenience\r\nexport type { EntityType } from './smart-prefix';\r\n\r\n/**\r\n * Generate SystemId (6 digits, immutable, internal use only)\r\n * Format: SYSTEMID_PREFIX + 6 digits (e.g., \"EMP000001\", \"CUSTOMER000001\", \"ORDER000001\")\r\n * Uses systemIdPrefix from ID_CONFIG (English full words)\r\n */\r\nexport function generateSystemId(entityType: EntityType, counter: number): string {\r\n  const config = ID_CONFIG[entityType];\r\n  if (!config) {\r\n    throw new Error(`No configuration found for entity type: ${entityType}`);\r\n  }\r\n  const prefix = config.systemIdPrefix;\r\n  const digitCount = config.digitCount || 6;\r\n  return `${prefix}${String(counter).padStart(digitCount, '0')}`;\r\n}\r\n\r\n/**\r\n * Generate Business ID (6 digits, user-facing, editable)\r\n * Format: PREFIX + 6 digits (e.g., \"NV000001\", \"KH000001\", \"CTV000001\")\r\n * All entities use same 6-digit format for consistency\r\n * \r\n * @param entityType - Entity type from smart-prefix\r\n * @param counter - Current counter value\r\n * @param customId - Optional custom ID from user input\r\n * @returns Generated ID or validated custom ID\r\n */\r\nexport function generateBusinessId(\r\n  entityType: EntityType, \r\n  counter: number,\r\n  customId?: string\r\n): string {\r\n  // If user provided custom ID, validate and return it\r\n  if (customId && customId.trim()) {\r\n    const sanitized = sanitizeBusinessId(customId);\r\n    if (!sanitized) {\r\n      throw new Error('Mã không hợp lệ! Chỉ được phép sử dụng chữ cái và số.');\r\n    }\r\n    return sanitized;\r\n  }\r\n  \r\n  // Otherwise, auto-generate\r\n  const prefix = getPrefix(entityType);\r\n  return `${prefix}${String(counter).padStart(6, '0')}`;\r\n}\r\n\r\n/**\r\n * Sanitize business ID\r\n * - Remove special characters (keep only letters and numbers)\r\n * - Convert to uppercase\r\n * - Trim whitespace\r\n * \r\n * @param id - Raw user input\r\n * @returns Sanitized ID or null if invalid\r\n */\r\nexport function sanitizeBusinessId(id: string): string | null {\r\n  if (!id || typeof id !== 'string') return null;\r\n  \r\n  // Remove all special characters, keep only alphanumeric\r\n  const cleaned = id.trim().replace(/[^a-zA-Z0-9]/g, '');\r\n  \r\n  if (!cleaned) return null;\r\n  \r\n  // Convert to uppercase for consistency\r\n  return cleaned.toUpperCase();\r\n}\r\n\r\n/**\r\n * Validate business ID uniqueness (case-insensitive)\r\n * \r\n * @param id - ID to check\r\n * @param existingIds - Array of existing IDs in the system\r\n * @param currentId - Current ID (for edit mode, to exclude self)\r\n * @returns true if unique, false if duplicate\r\n */\r\nexport function isBusinessIdUnique(\r\n  id: string,\r\n  existingIds: string[],\r\n  currentId?: string\r\n): boolean {\r\n  if (!id) return false;\r\n  \r\n  const normalizedId = id.toUpperCase();\r\n  const normalizedCurrentId = currentId?.toUpperCase();\r\n  \r\n  return !existingIds.some(existingId => {\r\n    // ✅ Filter out empty/undefined IDs\r\n    if (!existingId || existingId.trim() === '') return false;\r\n    \r\n    const normalizedExisting = existingId.toUpperCase();\r\n    // Skip self-comparison in edit mode\r\n    if (normalizedCurrentId && normalizedExisting === normalizedCurrentId) {\r\n      return false;\r\n    }\r\n    return normalizedExisting === normalizedId;\r\n  });\r\n}\r\n\r\n/**\r\n * Extract counter from system ID\r\n * Used to initialize counter when loading from localStorage\r\n * Supports both 6, 7 and 8 digits\r\n * \r\n * @param systemId - System ID to parse (e.g., \"EMP000001\", \"CUSTOMER000001\", \"WARRANTY0000001\")\r\n * @param prefix - Expected systemIdPrefix (e.g., \"EMP\", \"CUSTOMER\", \"WARRANTY\")\r\n * @returns Counter value or 0 if invalid\r\n */\r\nexport function extractCounterFromSystemId(systemId: string, prefix: string): number {\r\n  if (!systemId || typeof systemId !== 'string') return 0;\r\n  \r\n  // Try different digit counts (most entities use 6 digits, some use 7-8)\r\n  const regex8 = new RegExp(`^${prefix}(\\\\d{8})$`);\r\n  const regex7 = new RegExp(`^${prefix}(\\\\d{7})$`);\r\n  const regex6 = new RegExp(`^${prefix}(\\\\d{6})$`);\r\n  \r\n  const match8 = systemId.match(regex8);\r\n  if (match8) return parseInt(match8[1], 10);\r\n  \r\n  const match7 = systemId.match(regex7);\r\n  if (match7) return parseInt(match7[1], 10);\r\n  \r\n  const match6 = systemId.match(regex6);\r\n  if (match6) return parseInt(match6[1], 10);\r\n  \r\n  return 0;\r\n}\r\n\r\n/**\r\n * Extract counter from business ID\r\n * Used to initialize counter when loading from localStorage\r\n * \r\n * @param businessId - Business ID to parse (e.g., \"NV000001\")\r\n * @param prefix - Expected prefix (e.g., \"NV\")\r\n * @returns Counter value or 0 if invalid\r\n */\r\nexport function extractCounterFromBusinessId(businessId: string, prefix: string): number {\r\n  if (!businessId || typeof businessId !== 'string') return 0;\r\n  const regex = new RegExp(`^${prefix}(\\\\d+)$`);\r\n  const match = businessId.match(regex);\r\n  return match ? parseInt(match[1], 10) : 0;\r\n}\r\n\r\n/**\r\n * Get max counter from array of items (for systemId)\r\n * \r\n * @param items - Array of items with systemId\r\n * @param prefix - Prefix to match\r\n * @returns Maximum counter value\r\n */\r\nexport function getMaxSystemIdCounter<T extends { systemId: string }>(\r\n  items: T[],\r\n  prefix: string\r\n): number {\r\n  if (!items || !Array.isArray(items)) return 0;\r\n  \r\n  let maxCounter = 0;\r\n  \r\n  items.forEach(item => {\r\n    if (!item || !item.systemId) return;\r\n    const counter = extractCounterFromSystemId(item.systemId, prefix);\r\n    if (counter > maxCounter) {\r\n      maxCounter = counter;\r\n    }\r\n  });\r\n  \r\n  return maxCounter;\r\n}\r\n\r\n/**\r\n * Get max counter from array of items (for business id)\r\n * Only counts auto-generated IDs (PREFIX + digits)\r\n * \r\n * @param items - Array of items with id\r\n * @param prefix - Prefix to match\r\n * @returns Maximum counter value\r\n */\r\nexport function getMaxBusinessIdCounter<T extends { id: string }>(\r\n  items: T[],\r\n  prefix: string\r\n): number {\r\n  if (!items || !Array.isArray(items)) return 0;\r\n  \r\n  let maxCounter = 0;\r\n  \r\n  items.forEach(item => {\r\n    if (!item || !item.id) return;\r\n    const counter = extractCounterFromBusinessId(item.id, prefix);\r\n    if (counter > maxCounter) {\r\n      maxCounter = counter;\r\n    }\r\n  });\r\n  \r\n  return maxCounter;\r\n}\r\n\r\n/**\r\n * Format ID for display\r\n * Adds spacing for readability\r\n * \r\n * @param id - ID to format\r\n * @returns Formatted ID (e.g., \"NV-000001\", \"KH-000123\")\r\n */\r\nexport function formatIdForDisplay(id: string): string {\r\n  // Match pattern: PREFIX followed by numbers\r\n  const match = id.match(/^([A-Z]+)(\\d+)$/);\r\n  if (!match) return id;\r\n  \r\n  const [, prefix, numbers] = match;\r\n  return `${prefix}-${numbers}`;\r\n}\r\n\r\n/**\r\n * Validate ID format\r\n * Check if ID follows valid pattern (letters + numbers only)\r\n * \r\n * @param id - ID to validate\r\n * @returns true if valid format\r\n */\r\nexport function isValidIdFormat(id: string): boolean {\r\n  if (!id || typeof id !== 'string') return false;\r\n  \r\n  // Only alphanumeric characters allowed\r\n  const regex = /^[A-Z0-9]+$/i;\r\n  return regex.test(id);\r\n}\r\n\r\n/**\r\n * Generate suggested IDs based on entity type\r\n * Useful for autocomplete or placeholder text\r\n * \r\n * @param entityType - Entity type\r\n * @param counter - Current counter\r\n * @param count - Number of suggestions\r\n * @returns Array of suggested IDs\r\n */\r\nexport function generateSuggestedIds(\r\n  entityType: EntityType,\r\n  counter: number,\r\n  count: number = 3\r\n): string[] {\r\n  const suggestions: string[] = [];\r\n  const prefix = getPrefix(entityType);\r\n  \r\n  for (let i = 0; i < count; i++) {\r\n    suggestions.push(`${prefix}${String(counter + i + 1).padStart(6, '0')}`);\r\n  }\r\n  \r\n  return suggestions;\r\n}\r\n\r\n/**\r\n * ✨ Find next available business ID\r\n * Checks existing IDs and increments counter until finding a unique ID\r\n * \r\n * @param prefix - ID prefix (e.g., 'PT', 'PC', 'NV')\r\n * @param existingIds - Array of existing business IDs\r\n * @param startCounter - Starting counter value\r\n * @param digitCount - Number of digits (default: 6)\r\n * @returns Object with nextId and updatedCounter\r\n */\r\nexport function findNextAvailableBusinessId(\r\n  prefix: string,\r\n  existingIds: string[],\r\n  startCounter: number,\r\n  digitCount: number = 6\r\n): { nextId: string; updatedCounter: number } {\r\n  let counter = startCounter;\r\n  let nextId: string;\r\n  \r\n  // Keep incrementing until we find a unique ID\r\n  do {\r\n    counter++;\r\n    nextId = `${prefix}${String(counter).padStart(digitCount, '0')}`;\r\n  } while (existingIds.some(id => id === nextId));\r\n  \r\n  return {\r\n    nextId,\r\n    updatedCounter: counter\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 217, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/store-factory.ts"],"sourcesContent":["import { create } from 'zustand';\r\n// persist, createJSONStorage removed - database is now source of truth\r\nimport { \r\n  generateSystemId, \r\n  generateBusinessId, \r\n  isBusinessIdUnique,\r\n  getMaxSystemIdCounter,\r\n  getMaxBusinessIdCounter,\r\n  findNextAvailableBusinessId,\r\n  type EntityType \r\n} from './id-utils';\r\nimport { getPrefix } from './smart-prefix';\r\nimport { ID_CONFIG, type SystemId, type BusinessId, createSystemId, createBusinessId as brandBusinessId } from './id-config';\r\n\r\nconst SYSTEM_FALLBACK_ID: SystemId = createSystemId('SYS000000');\r\n\r\nconst asSystemIdFallback = (): SystemId => SYSTEM_FALLBACK_ID;\r\n\r\n// ✅ API Sync helper for store-factory\r\nasync function syncToAPI<T>(\r\n  apiEndpoint: string,\r\n  action: 'create' | 'update' | 'delete' | 'restore',\r\n  data: T | { systemId: SystemId },\r\n  systemId?: SystemId\r\n): Promise<boolean> {\r\n  try {\r\n    const endpoint = action === 'create' \r\n      ? apiEndpoint \r\n      : `${apiEndpoint}/${systemId || (data as any).systemId}`;\r\n    \r\n    const method = action === 'create' ? 'POST' \r\n      : action === 'update' ? 'PATCH' \r\n      : action === 'delete' ? 'DELETE'\r\n      : 'PATCH'; // restore uses PATCH\r\n    \r\n    const response = await fetch(endpoint, {\r\n      method,\r\n      headers: { 'Content-Type': 'application/json' },\r\n      credentials: 'include',\r\n      body: action !== 'delete' ? JSON.stringify(data) : undefined,\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      console.warn(`[Store Factory API] ${action} failed for ${apiEndpoint}:`, response.status);\r\n    }\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error(`[Store Factory API] ${action} error for ${apiEndpoint}:`, error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// Item with SystemId (branded type)\r\nexport type ItemWithSystemId = { systemId: SystemId; [key: string]: any };\r\n\r\n// ✅ Counter state for ID generation\r\nexport type CounterState = {\r\n  systemId: number;\r\n  businessId: number;\r\n};\r\n\r\nexport type CrudState<T extends ItemWithSystemId> = {\r\n  data: T[];\r\n  _counters: CounterState; // ✅ Persisted counters\r\n  _initialized: boolean; // ✅ Track if loaded from API\r\n  add: (item: Omit<T, 'systemId'>) => T;\r\n  addMultiple: (items: Omit<T, 'systemId'>[]) => void;\r\n  update: (systemId: SystemId, item: Partial<T>) => void; // ✅ Accept partial updates\r\n  remove: (systemId: SystemId) => void; // ✅ Branded type\r\n  hardDelete: (systemId: SystemId) => void; // ✅ Branded type\r\n  restore: (systemId: SystemId) => void; // ✅ Branded type\r\n  findById: (systemId: SystemId | string) => T | undefined; // ✅ Branded type\r\n  getActive: () => T[];\r\n  getDeleted: () => T[];\r\n  loadFromAPI: () => Promise<void>; // ✅ Load data from database\r\n};\r\n\r\nexport const createCrudStore = <T extends ItemWithSystemId>(\r\n  _initialData: T[], // @deprecated - Kept for backward compatibility but NO LONGER USED\r\n  entityType: EntityType, // Changed from idPrefix to entityType\r\n  options?: {\r\n    businessIdField?: keyof T; // Field name for business ID (default: 'id')\r\n    persistKey?: string; // @deprecated - No longer used, kept for backward compatibility\r\n    getCurrentUser?: () => string | undefined; // Function to get current user systemId\r\n    apiEndpoint?: string; // ✅ API endpoint for database sync (e.g., '/api/employees')\r\n  }\r\n) => {\r\n  const businessPrefix = getPrefix(entityType); // Vietnamese prefix for Business ID (NV, KH, DH)\r\n  const config = ID_CONFIG[entityType];\r\n  const systemIdPrefix = config?.systemIdPrefix || entityType.toUpperCase(); // English prefix for SystemId (EMP, CUSTOMER, ORDER)\r\n  \r\n  const businessIdField = options?.businessIdField ?? 'id';\r\n  // const persistKey = options?.persistKey; // @deprecated - No longer used\r\n  const getCurrentUser = options?.getCurrentUser;\r\n  const apiEndpoint = options?.apiEndpoint;\r\n\r\n  // ✅ CHANGED: Start with empty array - database is source of truth\r\n  // Mock data files (data.ts) are NO LONGER USED for runtime\r\n  const normalizedInitialData: T[] = [];\r\n\r\n  const storeConfig = (set: any, get: any) => ({\r\n    data: normalizedInitialData, // ✅ Start empty - data loaded via React Query\r\n    // ✅ Counters start at 0 - will be initialized from API via loadFromAPI()\r\n    _counters: {\r\n      systemId: 0,\r\n      businessId: 0\r\n    },\r\n    _initialized: false, // ✅ Track API initialization\r\n    add: (item: Omit<T, 'systemId'>): T => {\r\n        // ✅ Get counters from state (persisted)\r\n        const currentCounters = get()._counters;\r\n        const newSystemIdCounter = currentCounters.systemId + 1;\r\n        const newSystemId = createSystemId(generateSystemId(entityType, newSystemIdCounter));\r\n        \r\n        // Generate or validate Business ID (if field exists)\r\n        let finalItem = { ...item } as any;\r\n        let newBusinessIdCounter = currentCounters.businessId;\r\n        \r\n        if (businessIdField in item) {\r\n          const customId = (item as any)[businessIdField];\r\n          const existingIds = get().data.map((d: any) => d[businessIdField]);\r\n          \r\n          // ✅ If customId provided, validate uniqueness\r\n          if (customId && customId.trim()) {\r\n            if (!isBusinessIdUnique(customId, existingIds)) {\r\n              throw new Error(`Mã \"${customId}\" đã tồn tại! Vui lòng sử dụng mã khác.`);\r\n            }\r\n            finalItem[businessIdField] = customId.trim().toUpperCase();\r\n          } else {\r\n            // ✅ Auto-generate with findNextAvailableBusinessId\r\n            const digitCount = 6; // All entities use 6 digits\r\n            const result = findNextAvailableBusinessId(businessPrefix, existingIds, newBusinessIdCounter, digitCount);\r\n            finalItem[businessIdField] = result.nextId;\r\n            newBusinessIdCounter = result.updatedCounter;\r\n          }\r\n        }\r\n        \r\n        const now = new Date().toISOString();\r\n        const currentUser = getCurrentUser?.();\r\n        const newItem = { \r\n          ...finalItem, \r\n          systemId: newSystemId, // ✅ Branded SystemId\r\n          createdAt: finalItem.createdAt || now,\r\n          updatedAt: now,\r\n          createdBy: finalItem.createdBy || currentUser,\r\n          updatedBy: currentUser,\r\n        } as unknown as T;\r\n        \r\n        // ✅ Update both data and counters atomically\r\n        set((state: any) => ({ \r\n          data: [...state.data, newItem],\r\n          _counters: {\r\n            systemId: newSystemIdCounter,\r\n            businessId: newBusinessIdCounter\r\n          }\r\n        }));\r\n        \r\n        // ✅ Sync to API in background\r\n        if (apiEndpoint) {\r\n          syncToAPI(apiEndpoint, 'create', newItem).catch(console.error);\r\n        }\r\n        \r\n        return newItem;\r\n    },\r\n    addMultiple: (items: Omit<T, 'systemId'>[]) => \r\n        set((state: any) => {\r\n            const now = new Date().toISOString();\r\n            const currentUser = getCurrentUser?.();\r\n            const newItems: T[] = [];\r\n            const digitCount = 6; // All entities use 6 digits\r\n            \r\n            // ✅ Start from current counters\r\n            let currentSystemIdCounter = state._counters.systemId;\r\n            let currentBusinessIdCounter = state._counters.businessId;\r\n            \r\n            items.forEach(item => {\r\n                // ✅ Generate SystemId from current counter\r\n                currentSystemIdCounter++;\r\n                const newSystemId = createSystemId(generateSystemId(entityType, currentSystemIdCounter));\r\n                \r\n                // Generate or validate Business ID (if field exists)\r\n                let finalItem = { ...item } as any;\r\n                if (businessIdField in item) {\r\n                  const customId = (item as any)[businessIdField];\r\n                  \r\n                  // Collect existing IDs (from state + already added in this batch)\r\n                  const existingIds = [\r\n                    ...state.data.map((d: any) => d[businessIdField]),\r\n                    ...newItems.map((d: any) => d[businessIdField])\r\n                  ];\r\n                  \r\n                  // ✅ If customId provided, validate uniqueness\r\n                  if (customId && customId.trim()) {\r\n                    if (!isBusinessIdUnique(customId, existingIds)) {\r\n                      throw new Error(`Mã \"${customId}\" đã tồn tại! Vui lòng sử dụng mã khác.`);\r\n                    }\r\n                    finalItem[businessIdField] = customId.trim().toUpperCase();\r\n                  } else {\r\n                    // ✅ Auto-generate with findNextAvailableBusinessId\r\n                    const result = findNextAvailableBusinessId(businessPrefix, existingIds, currentBusinessIdCounter, digitCount);\r\n                    finalItem[businessIdField] = result.nextId;\r\n                    currentBusinessIdCounter = result.updatedCounter;\r\n                  }\r\n                }\r\n                \r\n                newItems.push({ \r\n                  ...finalItem, \r\n                  systemId: newSystemId,\r\n                  createdAt: now,\r\n                  updatedAt: now,\r\n                  createdBy: currentUser,\r\n                  updatedBy: currentUser,\r\n                } as unknown as T);\r\n            });\r\n            \r\n            // ✅ Update both data and counters\r\n            const result = { \r\n              data: [...state.data, ...newItems],\r\n              _counters: {\r\n                systemId: currentSystemIdCounter,\r\n                businessId: currentBusinessIdCounter\r\n              }\r\n            };\r\n            \r\n            // ✅ Sync to API in background (batch)\r\n            if (apiEndpoint) {\r\n              newItems.forEach(item => {\r\n                syncToAPI(apiEndpoint, 'create', item).catch(console.error);\r\n              });\r\n            }\r\n            \r\n            return result;\r\n        }),\r\n    update: (systemId: SystemId, updatedItem: Partial<T>) => {\r\n      // Validate unique business ID (case-insensitive, skip self)\r\n      if (businessIdField in updatedItem) {\r\n        const businessId = (updatedItem as any)[businessIdField];\r\n        const existingIds = get().data\r\n          .filter((d: any) => d.systemId !== systemId)\r\n          .map((d: any) => d[businessIdField]);\r\n        \r\n        if (businessId && !isBusinessIdUnique(businessId, existingIds)) {\r\n          throw new Error(`Mã \"${businessId}\" đã tồn tại! Vui lòng sử dụng mã khác.`);\r\n        }\r\n      }\r\n\r\n      const now = new Date().toISOString();\r\n      const currentUser = getCurrentUser?.();\r\n      set((state: any) => ({\r\n        data: state.data.map((item: T) =>\r\n          item.systemId === systemId \r\n            ? { ...item, ...updatedItem, updatedAt: now, updatedBy: currentUser } as T\r\n            : item\r\n        ),\r\n      }));\r\n      \r\n      // ✅ Sync to API in background\r\n      if (apiEndpoint) {\r\n        const fullItem = get().data.find((item: T) => item.systemId === systemId);\r\n        if (fullItem) {\r\n          syncToAPI(apiEndpoint, 'update', fullItem, systemId).catch(console.error);\r\n        }\r\n      }\r\n    },\r\n    remove: (systemId: SystemId) => {\r\n      // Soft delete - mark as deleted\r\n      const now = new Date().toISOString();\r\n      set((state: any) => ({\r\n        data: state.data.map((item: T) =>\r\n          item.systemId === systemId\r\n            ? { ...item, isDeleted: true, deletedAt: now } as T\r\n            : item\r\n        ),\r\n      }));\r\n      \r\n      // ✅ Sync to API in background\r\n      if (apiEndpoint) {\r\n        const item = get().data.find((item: T) => item.systemId === systemId);\r\n        if (item) {\r\n          syncToAPI(apiEndpoint, 'update', { ...item, isDeleted: true, deletedAt: now }, systemId).catch(console.error);\r\n        }\r\n      }\r\n    },\r\n    hardDelete: (systemId: SystemId) => {\r\n      // Permanent delete - remove from array\r\n      set((state: any) => ({\r\n        data: state.data.filter((item: T) => item.systemId !== systemId),\r\n      }));\r\n      \r\n      // ✅ Sync to API in background\r\n      if (apiEndpoint) {\r\n        syncToAPI(apiEndpoint, 'delete', { systemId }, systemId).catch(console.error);\r\n      }\r\n    },\r\n    restore: (systemId: SystemId) => {\r\n      // Restore soft-deleted item\r\n      set((state: any) => ({\r\n        data: state.data.map((item: T) =>\r\n          item.systemId === systemId\r\n            ? { ...item, isDeleted: false, deletedAt: null } as T\r\n            : item\r\n        ),\r\n      }));\r\n      \r\n      // ✅ Sync to API in background\r\n      if (apiEndpoint) {\r\n        const item = get().data.find((item: T) => item.systemId === systemId);\r\n        if (item) {\r\n          syncToAPI(apiEndpoint, 'restore', { ...item, isDeleted: false, deletedAt: null }, systemId).catch(console.error);\r\n        }\r\n      }\r\n    },\r\n    getActive: () => get().data.filter((item: any) => !item.isDeleted),\r\n    getDeleted: () => get().data.filter((item: any) => item.isDeleted),\r\n    findById: (id: SystemId | string) => get().data.find((item: T) => item.systemId === id || (item as any).id === id),\r\n    \r\n    // ✅ Load data from database API - OPTIMIZED: No more limit=10000!\r\n    // This is now only used for counter initialization, NOT for loading all data\r\n    // Use React Query hooks for data fetching with proper pagination\r\n    loadFromAPI: async () => {\r\n      if (!apiEndpoint) return;\r\n      if (get()._initialized) return;\r\n      \r\n      try {\r\n        // Only fetch minimal data needed to initialize counters\r\n        // Actual data loading should be done via React Query hooks\r\n        const response = await fetch(`${apiEndpoint}?limit=1&sortBy=systemId&sortOrder=desc`, {\r\n          credentials: 'include',\r\n        });\r\n        if (response.ok) {\r\n          const json = await response.json();\r\n          const pagination = json.pagination || {};\r\n          const lastItem = json.data?.[0];\r\n          \r\n          // Initialize counters from the latest item (highest IDs)\r\n          const newCounters = {\r\n            systemId: lastItem ? getMaxSystemIdCounter([lastItem], systemIdPrefix) : 0,\r\n            businessId: (lastItem && options?.businessIdField)\r\n              ? getMaxBusinessIdCounter([lastItem] as any[], businessPrefix)\r\n              : 0\r\n          };\r\n          \r\n          set({ \r\n            data: [], // Don't store data in Zustand anymore - use React Query\r\n            _counters: newCounters,\r\n            _initialized: true \r\n          });\r\n          \r\n          console.log(`[Store Factory] ${apiEndpoint} initialized. Total records: ${pagination.total || 'unknown'}`);\r\n        }\r\n      } catch (error) {\r\n        console.error(`[Store Factory] loadFromAPI error for ${apiEndpoint}:`, error);\r\n        // Still mark as initialized to prevent infinite retry\r\n        set({ _initialized: true });\r\n      }\r\n    },\r\n  });\r\n\r\n  // ✅ SIMPLIFIED: No localStorage persistence, database is source of truth\r\n  // Data is loaded via ApiSyncProvider on app init\r\n  return create<CrudState<T>>(storeConfig);\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AACA,uEAAuE;AACvE;AASA;AACA;;;;;AAEA,MAAM,qBAA+B,IAAA,qIAAc,EAAC;AAEpD,MAAM,qBAAqB,IAAgB;AAE3C,sCAAsC;AACtC,eAAe,UACb,WAAmB,EACnB,MAAkD,EAClD,IAAgC,EAChC,QAAmB;IAEnB,IAAI;QACF,MAAM,WAAW,WAAW,WACxB,cACA,GAAG,YAAY,CAAC,EAAE,YAAY,AAAC,KAAa,QAAQ,EAAE;QAE1D,MAAM,SAAS,WAAW,WAAW,SACjC,WAAW,WAAW,UACtB,WAAW,WAAW,WACtB,SAAS,qBAAqB;QAElC,MAAM,WAAW,MAAM,MAAM,UAAU;YACrC;YACA,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,aAAa;YACb,MAAM,WAAW,WAAW,KAAK,SAAS,CAAC,QAAQ;QACrD;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,QAAQ,IAAI,CAAC,CAAC,oBAAoB,EAAE,OAAO,YAAY,EAAE,YAAY,CAAC,CAAC,EAAE,SAAS,MAAM;QAC1F;QACA,OAAO,SAAS,EAAE;IACpB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,oBAAoB,EAAE,OAAO,WAAW,EAAE,YAAY,CAAC,CAAC,EAAE;QACzE,OAAO;IACT;AACF;AA2BO,MAAM,kBAAkB,CAC7B,cACA,YACA;IAOA,MAAM,iBAAiB,IAAA,mIAAS,EAAC,aAAa,iDAAiD;IAC/F,MAAM,SAAS,gIAAS,CAAC,WAAW;IACpC,MAAM,iBAAiB,QAAQ,kBAAkB,WAAW,WAAW,IAAI,qDAAqD;IAEhI,MAAM,kBAAkB,SAAS,mBAAmB;IACpD,0EAA0E;IAC1E,MAAM,iBAAiB,SAAS;IAChC,MAAM,cAAc,SAAS;IAE7B,kEAAkE;IAClE,2DAA2D;IAC3D,MAAM,wBAA6B,EAAE;IAErC,MAAM,cAAc,CAAC,KAAU,MAAa,CAAC;YAC3C,MAAM;YACN,yEAAyE;YACzE,WAAW;gBACT,UAAU;gBACV,YAAY;YACd;YACA,cAAc;YACd,KAAK,CAAC;gBACF,wCAAwC;gBACxC,MAAM,kBAAkB,MAAM,SAAS;gBACvC,MAAM,qBAAqB,gBAAgB,QAAQ,GAAG;gBACtD,MAAM,cAAc,IAAA,qIAAc,EAAC,IAAA,sIAAgB,EAAC,YAAY;gBAEhE,qDAAqD;gBACrD,IAAI,YAAY;oBAAE,GAAG,IAAI;gBAAC;gBAC1B,IAAI,uBAAuB,gBAAgB,UAAU;gBAErD,IAAI,mBAAmB,MAAM;oBAC3B,MAAM,WAAW,AAAC,IAAY,CAAC,gBAAgB;oBAC/C,MAAM,cAAc,MAAM,IAAI,CAAC,GAAG,CAAC,CAAC,IAAW,CAAC,CAAC,gBAAgB;oBAEjE,8CAA8C;oBAC9C,IAAI,YAAY,SAAS,IAAI,IAAI;wBAC/B,IAAI,CAAC,IAAA,wIAAkB,EAAC,UAAU,cAAc;4BAC9C,MAAM,IAAI,MAAM,CAAC,IAAI,EAAE,SAAS,uCAAuC,CAAC;wBAC1E;wBACA,SAAS,CAAC,gBAAgB,GAAG,SAAS,IAAI,GAAG,WAAW;oBAC1D,OAAO;wBACL,mDAAmD;wBACnD,MAAM,aAAa,GAAG,4BAA4B;wBAClD,MAAM,SAAS,IAAA,iJAA2B,EAAC,gBAAgB,aAAa,sBAAsB;wBAC9F,SAAS,CAAC,gBAAgB,GAAG,OAAO,MAAM;wBAC1C,uBAAuB,OAAO,cAAc;oBAC9C;gBACF;gBAEA,MAAM,MAAM,IAAI,OAAO,WAAW;gBAClC,MAAM,cAAc;gBACpB,MAAM,UAAU;oBACd,GAAG,SAAS;oBACZ,UAAU;oBACV,WAAW,UAAU,SAAS,IAAI;oBAClC,WAAW;oBACX,WAAW,UAAU,SAAS,IAAI;oBAClC,WAAW;gBACb;gBAEA,6CAA6C;gBAC7C,IAAI,CAAC,QAAe,CAAC;wBACnB,MAAM;+BAAI,MAAM,IAAI;4BAAE;yBAAQ;wBAC9B,WAAW;4BACT,UAAU;4BACV,YAAY;wBACd;oBACF,CAAC;gBAED,8BAA8B;gBAC9B,IAAI,aAAa;oBACf,UAAU,aAAa,UAAU,SAAS,KAAK,CAAC,QAAQ,KAAK;gBAC/D;gBAEA,OAAO;YACX;YACA,aAAa,CAAC,QACV,IAAI,CAAC;oBACD,MAAM,MAAM,IAAI,OAAO,WAAW;oBAClC,MAAM,cAAc;oBACpB,MAAM,WAAgB,EAAE;oBACxB,MAAM,aAAa,GAAG,4BAA4B;oBAElD,gCAAgC;oBAChC,IAAI,yBAAyB,MAAM,SAAS,CAAC,QAAQ;oBACrD,IAAI,2BAA2B,MAAM,SAAS,CAAC,UAAU;oBAEzD,MAAM,OAAO,CAAC,CAAA;wBACV,2CAA2C;wBAC3C;wBACA,MAAM,cAAc,IAAA,qIAAc,EAAC,IAAA,sIAAgB,EAAC,YAAY;wBAEhE,qDAAqD;wBACrD,IAAI,YAAY;4BAAE,GAAG,IAAI;wBAAC;wBAC1B,IAAI,mBAAmB,MAAM;4BAC3B,MAAM,WAAW,AAAC,IAAY,CAAC,gBAAgB;4BAE/C,kEAAkE;4BAClE,MAAM,cAAc;mCACf,MAAM,IAAI,CAAC,GAAG,CAAC,CAAC,IAAW,CAAC,CAAC,gBAAgB;mCAC7C,SAAS,GAAG,CAAC,CAAC,IAAW,CAAC,CAAC,gBAAgB;6BAC/C;4BAED,8CAA8C;4BAC9C,IAAI,YAAY,SAAS,IAAI,IAAI;gCAC/B,IAAI,CAAC,IAAA,wIAAkB,EAAC,UAAU,cAAc;oCAC9C,MAAM,IAAI,MAAM,CAAC,IAAI,EAAE,SAAS,uCAAuC,CAAC;gCAC1E;gCACA,SAAS,CAAC,gBAAgB,GAAG,SAAS,IAAI,GAAG,WAAW;4BAC1D,OAAO;gCACL,mDAAmD;gCACnD,MAAM,SAAS,IAAA,iJAA2B,EAAC,gBAAgB,aAAa,0BAA0B;gCAClG,SAAS,CAAC,gBAAgB,GAAG,OAAO,MAAM;gCAC1C,2BAA2B,OAAO,cAAc;4BAClD;wBACF;wBAEA,SAAS,IAAI,CAAC;4BACZ,GAAG,SAAS;4BACZ,UAAU;4BACV,WAAW;4BACX,WAAW;4BACX,WAAW;4BACX,WAAW;wBACb;oBACJ;oBAEA,kCAAkC;oBAClC,MAAM,SAAS;wBACb,MAAM;+BAAI,MAAM,IAAI;+BAAK;yBAAS;wBAClC,WAAW;4BACT,UAAU;4BACV,YAAY;wBACd;oBACF;oBAEA,sCAAsC;oBACtC,IAAI,aAAa;wBACf,SAAS,OAAO,CAAC,CAAA;4BACf,UAAU,aAAa,UAAU,MAAM,KAAK,CAAC,QAAQ,KAAK;wBAC5D;oBACF;oBAEA,OAAO;gBACX;YACJ,QAAQ,CAAC,UAAoB;gBAC3B,4DAA4D;gBAC5D,IAAI,mBAAmB,aAAa;oBAClC,MAAM,aAAa,AAAC,WAAmB,CAAC,gBAAgB;oBACxD,MAAM,cAAc,MAAM,IAAI,CAC3B,MAAM,CAAC,CAAC,IAAW,EAAE,QAAQ,KAAK,UAClC,GAAG,CAAC,CAAC,IAAW,CAAC,CAAC,gBAAgB;oBAErC,IAAI,cAAc,CAAC,IAAA,wIAAkB,EAAC,YAAY,cAAc;wBAC9D,MAAM,IAAI,MAAM,CAAC,IAAI,EAAE,WAAW,uCAAuC,CAAC;oBAC5E;gBACF;gBAEA,MAAM,MAAM,IAAI,OAAO,WAAW;gBAClC,MAAM,cAAc;gBACpB,IAAI,CAAC,QAAe,CAAC;wBACnB,MAAM,MAAM,IAAI,CAAC,GAAG,CAAC,CAAC,OACpB,KAAK,QAAQ,KAAK,WACd;gCAAE,GAAG,IAAI;gCAAE,GAAG,WAAW;gCAAE,WAAW;gCAAK,WAAW;4BAAY,IAClE;oBAER,CAAC;gBAED,8BAA8B;gBAC9B,IAAI,aAAa;oBACf,MAAM,WAAW,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,OAAY,KAAK,QAAQ,KAAK;oBAChE,IAAI,UAAU;wBACZ,UAAU,aAAa,UAAU,UAAU,UAAU,KAAK,CAAC,QAAQ,KAAK;oBAC1E;gBACF;YACF;YACA,QAAQ,CAAC;gBACP,gCAAgC;gBAChC,MAAM,MAAM,IAAI,OAAO,WAAW;gBAClC,IAAI,CAAC,QAAe,CAAC;wBACnB,MAAM,MAAM,IAAI,CAAC,GAAG,CAAC,CAAC,OACpB,KAAK,QAAQ,KAAK,WACd;gCAAE,GAAG,IAAI;gCAAE,WAAW;gCAAM,WAAW;4BAAI,IAC3C;oBAER,CAAC;gBAED,8BAA8B;gBAC9B,IAAI,aAAa;oBACf,MAAM,OAAO,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,OAAY,KAAK,QAAQ,KAAK;oBAC5D,IAAI,MAAM;wBACR,UAAU,aAAa,UAAU;4BAAE,GAAG,IAAI;4BAAE,WAAW;4BAAM,WAAW;wBAAI,GAAG,UAAU,KAAK,CAAC,QAAQ,KAAK;oBAC9G;gBACF;YACF;YACA,YAAY,CAAC;gBACX,uCAAuC;gBACvC,IAAI,CAAC,QAAe,CAAC;wBACnB,MAAM,MAAM,IAAI,CAAC,MAAM,CAAC,CAAC,OAAY,KAAK,QAAQ,KAAK;oBACzD,CAAC;gBAED,8BAA8B;gBAC9B,IAAI,aAAa;oBACf,UAAU,aAAa,UAAU;wBAAE;oBAAS,GAAG,UAAU,KAAK,CAAC,QAAQ,KAAK;gBAC9E;YACF;YACA,SAAS,CAAC;gBACR,4BAA4B;gBAC5B,IAAI,CAAC,QAAe,CAAC;wBACnB,MAAM,MAAM,IAAI,CAAC,GAAG,CAAC,CAAC,OACpB,KAAK,QAAQ,KAAK,WACd;gCAAE,GAAG,IAAI;gCAAE,WAAW;gCAAO,WAAW;4BAAK,IAC7C;oBAER,CAAC;gBAED,8BAA8B;gBAC9B,IAAI,aAAa;oBACf,MAAM,OAAO,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,OAAY,KAAK,QAAQ,KAAK;oBAC5D,IAAI,MAAM;wBACR,UAAU,aAAa,WAAW;4BAAE,GAAG,IAAI;4BAAE,WAAW;4BAAO,WAAW;wBAAK,GAAG,UAAU,KAAK,CAAC,QAAQ,KAAK;oBACjH;gBACF;YACF;YACA,WAAW,IAAM,MAAM,IAAI,CAAC,MAAM,CAAC,CAAC,OAAc,CAAC,KAAK,SAAS;YACjE,YAAY,IAAM,MAAM,IAAI,CAAC,MAAM,CAAC,CAAC,OAAc,KAAK,SAAS;YACjE,UAAU,CAAC,KAA0B,MAAM,IAAI,CAAC,IAAI,CAAC,CAAC,OAAY,KAAK,QAAQ,KAAK,MAAM,AAAC,KAAa,EAAE,KAAK;YAE/G,kEAAkE;YAClE,6EAA6E;YAC7E,iEAAiE;YACjE,aAAa;gBACX,IAAI,CAAC,aAAa;gBAClB,IAAI,MAAM,YAAY,EAAE;gBAExB,IAAI;oBACF,wDAAwD;oBACxD,2DAA2D;oBAC3D,MAAM,WAAW,MAAM,MAAM,GAAG,YAAY,uCAAuC,CAAC,EAAE;wBACpF,aAAa;oBACf;oBACA,IAAI,SAAS,EAAE,EAAE;wBACf,MAAM,OAAO,MAAM,SAAS,IAAI;wBAChC,MAAM,aAAa,KAAK,UAAU,IAAI,CAAC;wBACvC,MAAM,WAAW,KAAK,IAAI,EAAE,CAAC,EAAE;wBAE/B,yDAAyD;wBACzD,MAAM,cAAc;4BAClB,UAAU,WAAW,IAAA,2IAAqB,EAAC;gCAAC;6BAAS,EAAE,kBAAkB;4BACzE,YAAY,AAAC,YAAY,SAAS,kBAC9B,IAAA,6IAAuB,EAAC;gCAAC;6BAAS,EAAW,kBAC7C;wBACN;wBAEA,IAAI;4BACF,MAAM,EAAE;4BACR,WAAW;4BACX,cAAc;wBAChB;wBAEA,QAAQ,GAAG,CAAC,CAAC,gBAAgB,EAAE,YAAY,6BAA6B,EAAE,WAAW,KAAK,IAAI,WAAW;oBAC3G;gBACF,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,CAAC,sCAAsC,EAAE,YAAY,CAAC,CAAC,EAAE;oBACvE,sDAAsD;oBACtD,IAAI;wBAAE,cAAc;oBAAK;gBAC3B;YACF;QACF,CAAC;IAED,yEAAyE;IACzE,iDAAiD;IACjD,OAAO,IAAA,kJAAM,EAAe;AAC9B"}},
    {"offset": {"line": 525, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/id-types.ts"],"sourcesContent":["/**\r\n * Type-safe ID System\r\n * \r\n * Prevents mixing systemId with business ID at compile time\r\n */\r\n\r\n// Branded types for type safety\r\nexport type SystemId = string & { readonly __brand: 'SystemId' };\r\nexport type BusinessId = string & { readonly __brand: 'BusinessId' };\r\n\r\n/**\r\n * Create a SystemId from a string\r\n * Use this when you know for sure it's a systemId\r\n */\r\nexport function asSystemId(id: string): SystemId {\r\n  return id as SystemId;\r\n}\r\n\r\n/**\r\n * Create a BusinessId from a string\r\n * Use this when you know for sure it's a business ID\r\n */\r\nexport function asBusinessId(id: string): BusinessId {\r\n  return id as BusinessId;\r\n}\r\n\r\n/**\r\n * Check if a string is a valid systemId format\r\n */\r\nexport function isSystemIdFormat(id: string): boolean {\r\n  // SystemId: 8 digits + prefix (e.g., NV00000001, VOUCHER00000123)\r\n  return /^[A-Z]+\\d{8}$/.test(id);\r\n}\r\n\r\n/**\r\n * Check if a string is a valid business ID format\r\n */\r\nexport function isBusinessIdFormat(id: string): boolean {\r\n  // Business ID: shorter, variable length (e.g., NV001, PT000001)\r\n  return /^[A-Z]+\\d{3,6}$/.test(id);\r\n}\r\n\r\n/**\r\n * Safely convert unknown ID to proper type\r\n */\r\nexport function parseId(id: string): { type: 'system' | 'business'; value: SystemId | BusinessId } {\r\n  if (isSystemIdFormat(id)) {\r\n    return { type: 'system', value: asSystemId(id) };\r\n  }\r\n  if (isBusinessIdFormat(id)) {\r\n    return { type: 'business', value: asBusinessId(id) };\r\n  }\r\n  throw new Error(`Invalid ID format: ${id}`);\r\n}\r\n\r\n/**\r\n * ID Pair - Always keep systemId and businessId together\r\n */\r\nexport interface IDPair {\r\n  systemId: SystemId;\r\n  businessId: BusinessId;\r\n}\r\n\r\n/**\r\n * Entity with dual IDs\r\n */\r\nexport interface DualIDEntity {\r\n  systemId: SystemId;\r\n  id: BusinessId;\r\n}\r\n\r\n/**\r\n * Store methods with type-safe IDs\r\n */\r\nexport interface TypeSafeStore<T extends DualIDEntity> {\r\n  /** Find by systemId (for queries, relationships) */\r\n  findBySystemId(systemId: SystemId): T | null;\r\n  \r\n  /** Find by business ID (for user input, display) */\r\n  findByBusinessId(businessId: BusinessId): T | null;\r\n  \r\n  /** Update by systemId (always use systemId for updates) */\r\n  updateBySystemId(systemId: SystemId, updates: Partial<T>): void;\r\n  \r\n  /** Delete by systemId (always use systemId for deletes) */\r\n  deleteBySystemId(systemId: SystemId): void;\r\n}\r\n\r\n/**\r\n * Route params with type-safe IDs\r\n */\r\nexport interface RouteParams {\r\n  systemId?: SystemId;\r\n  id?: BusinessId;\r\n}\r\n\r\n/**\r\n * Link builder - always uses systemId\r\n */\r\nexport function buildEntityLink(path: string, entity: DualIDEntity): string {\r\n  return path.replace(':systemId', entity.systemId);\r\n}\r\n\r\n/**\r\n * Display ID - always uses business ID\r\n */\r\nexport function getDisplayId(entity: DualIDEntity): string {\r\n  return entity.id;\r\n}\r\n\r\n/**\r\n * Runtime guard: ensures a string is valid SystemId format and casts it\r\n * Logs warning if format is invalid\r\n */\r\nexport function ensureSystemId(id: string, context?: string): SystemId {\r\n  if (!isSystemIdFormat(id)) {\r\n    console.warn(`[ensureSystemId] Invalid SystemId format: \"${id}\"${context ? ` in ${context}` : ''}`);\r\n  }\r\n  return asSystemId(id);\r\n}\r\n\r\n/**\r\n * Runtime guard: ensures a string is valid BusinessId format and casts it\r\n * Logs warning if format is invalid\r\n */\r\nexport function ensureBusinessId(id: string, context?: string): BusinessId {\r\n  if (!isBusinessIdFormat(id)) {\r\n    console.warn(`[ensureBusinessId] Invalid BusinessId format: \"${id}\"${context ? ` in ${context}` : ''}`);\r\n  }\r\n  return asBusinessId(id);\r\n}\r\n"],"names":[],"mappings":"AAAA;;;;CAIC,GAED,gCAAgC;;;;;;;;;;;;;;;;;;;;;AAQzB,SAAS,WAAW,EAAU;IACnC,OAAO;AACT;AAMO,SAAS,aAAa,EAAU;IACrC,OAAO;AACT;AAKO,SAAS,iBAAiB,EAAU;IACzC,kEAAkE;IAClE,OAAO,gBAAgB,IAAI,CAAC;AAC9B;AAKO,SAAS,mBAAmB,EAAU;IAC3C,gEAAgE;IAChE,OAAO,kBAAkB,IAAI,CAAC;AAChC;AAKO,SAAS,QAAQ,EAAU;IAChC,IAAI,iBAAiB,KAAK;QACxB,OAAO;YAAE,MAAM;YAAU,OAAO,WAAW;QAAI;IACjD;IACA,IAAI,mBAAmB,KAAK;QAC1B,OAAO;YAAE,MAAM;YAAY,OAAO,aAAa;QAAI;IACrD;IACA,MAAM,IAAI,MAAM,CAAC,mBAAmB,EAAE,IAAI;AAC5C;AA8CO,SAAS,gBAAgB,IAAY,EAAE,MAAoB;IAChE,OAAO,KAAK,OAAO,CAAC,aAAa,OAAO,QAAQ;AAClD;AAKO,SAAS,aAAa,MAAoB;IAC/C,OAAO,OAAO,EAAE;AAClB;AAMO,SAAS,eAAe,EAAU,EAAE,OAAgB;IACzD,IAAI,CAAC,iBAAiB,KAAK;QACzB,QAAQ,IAAI,CAAC,CAAC,2CAA2C,EAAE,GAAG,CAAC,EAAE,UAAU,CAAC,IAAI,EAAE,SAAS,GAAG,IAAI;IACpG;IACA,OAAO,WAAW;AACpB;AAMO,SAAS,iBAAiB,EAAU,EAAE,OAAgB;IAC3D,IAAI,CAAC,mBAAmB,KAAK;QAC3B,QAAQ,IAAI,CAAC,CAAC,+CAA+C,EAAE,GAAG,CAAC,EAAE,UAAU,CAAC,IAAI,EAAE,SAAS,GAAG,IAAI;IACxG;IACA,OAAO,aAAa;AACtB"}},
    {"offset": {"line": 601, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/activity-history-helper.ts"],"sourcesContent":["/**\r\n * Activity History Helper\r\n * \r\n * Helper để tạo các entry lịch sử hoạt động một cách nhất quán\r\n * Dùng chung cho tất cả các modules trong hệ thống\r\n * \r\n * NOTE: Đã remove import useEmployeeStore để tránh circular dependency\r\n * và cải thiện compile time\r\n */\r\n\r\nimport type { HistoryEntry } from '../components/ActivityHistory';\r\nimport { getCurrentUserInfo as getAuthUserInfo } from '../contexts/auth-context';\r\nimport type { SystemId } from './id-types';\r\n\r\n// Re-export HistoryEntry type for convenience\r\nexport type { HistoryEntry } from '../components/ActivityHistory';\r\n\r\n/**\r\n * Lấy thông tin người dùng hiện tại từ auth context\r\n * NOTE: Avatar lookup từ employee store đã bị remove để tránh circular dependency\r\n */\r\nexport function getCurrentUserInfo(): { systemId: string; name: string; avatar?: string } {\r\n  const authInfo = getAuthUserInfo();\r\n  \r\n  return {\r\n    systemId: authInfo.systemId || 'SYSTEM',\r\n    name: authInfo.name || 'Hệ thống',\r\n    avatar: undefined, // Avatar will be fetched by component if needed\r\n  };\r\n}\r\n\r\n/**\r\n * Lấy thông tin nhân viên từ systemId\r\n * NOTE: This function now requires employee data to be passed in\r\n * to avoid circular dependency with employee store\r\n */\r\nexport function getEmployeeInfoFromData(\r\n  employeeSystemId: SystemId | string,\r\n  employees: Array<{ systemId: string; fullName: string; avatarUrl?: string }>\r\n): { systemId: string; name: string; avatar?: string } {\r\n  const employee = employees.find(e => e.systemId === employeeSystemId);\r\n  \r\n  if (employee) {\r\n    return {\r\n      systemId: employee.systemId,\r\n      name: employee.fullName,\r\n      avatar: employee.avatarUrl,\r\n    };\r\n  }\r\n  \r\n  // Fallback to system\r\n  return {\r\n    systemId: String(employeeSystemId) || 'SYSTEM',\r\n    name: 'Hệ thống',\r\n  };\r\n}\r\n\r\n/**\r\n * @deprecated Use getEmployeeInfoFromData instead\r\n */\r\nexport function getEmployeeInfo(employeeSystemId: SystemId | string): { systemId: string; name: string; avatar?: string } {\r\n  // Return minimal info without employee store lookup\r\n  return {\r\n    systemId: String(employeeSystemId) || 'SYSTEM',\r\n    name: 'Hệ thống',\r\n  };\r\n}\r\n\r\n/**\r\n * Tạo một history entry mới\r\n */\r\nexport function createHistoryEntry(\r\n  action: HistoryEntry['action'],\r\n  userOrDescription: { systemId: string; name: string; avatar?: string } | string,\r\n  descriptionOrMetadata?: string | HistoryEntry['metadata'],\r\n  metadata?: HistoryEntry['metadata']\r\n): HistoryEntry {\r\n  const hasUserObject = typeof userOrDescription === 'object' && userOrDescription !== null;\r\n  const user = hasUserObject ? userOrDescription : getCurrentUserInfo();\r\n  const description = (hasUserObject ? descriptionOrMetadata : userOrDescription) as string | undefined;\r\n  const meta = (hasUserObject ? metadata : descriptionOrMetadata) as HistoryEntry['metadata'] | undefined;\r\n\r\n  return {\r\n    id: `history-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\r\n    action,\r\n    timestamp: new Date(),\r\n    user: {\r\n      systemId: user.systemId,\r\n      name: user.name,\r\n      avatar: user.avatar,\r\n    },\r\n    description: description ?? '',\r\n    metadata: meta,\r\n  };\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"created\"\r\n */\r\nexport function createCreatedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('created', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"updated\"\r\n */\r\nexport function createUpdatedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('updated', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"status_changed\"\r\n */\r\nexport function createStatusChangedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  oldStatus: string,\r\n  newStatus: string,\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry(\r\n    'status_changed',\r\n    user,\r\n    description,\r\n    { field: 'status', oldValue: oldStatus, newValue: newStatus }\r\n  );\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"deleted\"\r\n */\r\nexport function createDeletedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('deleted', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"assigned\"\r\n */\r\nexport function createAssignedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('assigned', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"payment_made\"\r\n */\r\nexport function createPaymentEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('payment_made', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"comment_added\"\r\n */\r\nexport function createCommentEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('comment_added', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"cancelled\"\r\n */\r\nexport function createCancelledEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('cancelled', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"verified\"\r\n */\r\nexport function createVerifiedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('verified', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"ended\"\r\n */\r\nexport function createEndedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('ended', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho action \"reopened\"\r\n */\r\nexport function createReopenedEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry('reopened', user, description);\r\n}\r\n\r\n/**\r\n * Tạo history entry cho product actions\r\n */\r\nexport function createProductEntry(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  action: 'product_added' | 'product_updated' | 'product_removed',\r\n  description: string\r\n): HistoryEntry {\r\n  return createHistoryEntry(action, user, description);\r\n}\r\n\r\n/**\r\n * Helper để append history entry vào existing array\r\n */\r\nexport function appendHistoryEntry(\r\n  existingHistory: HistoryEntry[] | undefined,\r\n  ...newEntries: HistoryEntry[]\r\n): HistoryEntry[] {\r\n  return [...(existingHistory || []), ...newEntries];\r\n}\r\n\r\n/**\r\n * Helper để tạo nhiều history entries cùng lúc\r\n */\r\nexport function createBulkUpdateEntries(\r\n  user: { systemId: string; name: string; avatar?: string },\r\n  changes: Array<{ field: string; description: string }>\r\n): HistoryEntry[] {\r\n  return changes.map(change => createHistoryEntry('updated', user, change.description));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 750, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/ghtk-constants.ts"],"sourcesContent":["/**\r\n * GHTK Status Mapping & Constants\r\n * Based on GHTK API documentation: https://api.ghtk.vn/docs/submit-order/webhook\r\n */\r\n\r\nimport type { OrderDeliveryStatus } from '@/features/orders/types';\r\n\r\nexport type GHTKStatusId = -1 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13 | 20 | 21 | 123 | 127 | 128 | 45 | 49 | 410;\r\n\r\nexport type GHTKReasonCode = \r\n  // Chậm lấy hàng (100-107)\r\n  | '100' | '101' | '102' | '103' | '104' | '105' | '106' | '107'\r\n  // Không lấy được (110-115)\r\n  | '110' | '111' | '112' | '113' | '114' | '115'\r\n  // Chậm giao (120-129)\r\n  | '120' | '121' | '122' | '123' | '124' | '125' | '126' | '127' | '128' | '129' | '1200'\r\n  // Không giao được (130-135)\r\n  | '130' | '131' | '132' | '133' | '134' | '135'\r\n  // Delay trả hàng (140-144)\r\n  | '140' | '141' | '142' | '143' | '144';\r\n\r\nexport interface GHTKStatusMapping {\r\n  statusId: GHTKStatusId;\r\n  statusText: string;\r\n  deliveryStatus: OrderDeliveryStatus;\r\n  description: string;\r\n  canCancel: boolean; // Có thể hủy qua API không\r\n  shouldUpdateStock: boolean; // Có cần update stock không\r\n  stockAction?: 'dispatch' | 'complete' | 'return'; // Loại stock action\r\n  isFinal: boolean; // Trạng thái cuối (không cần sync nữa)\r\n}\r\n\r\n/**\r\n * Complete GHTK Status Mapping\r\n */\r\nexport const GHTK_STATUS_MAP: Record<GHTKStatusId, GHTKStatusMapping> = {\r\n  '-1': {\r\n    statusId: -1,\r\n    statusText: 'Hủy đơn hàng',\r\n    deliveryStatus: 'Chờ giao lại',\r\n    description: 'Đơn hàng đã bị hủy',\r\n    canCancel: false,\r\n    shouldUpdateStock: true,\r\n    stockAction: 'return',\r\n    isFinal: true,\r\n  },\r\n  '1': {\r\n    statusId: 1,\r\n    statusText: 'Chưa tiếp nhận',\r\n    deliveryStatus: 'Chờ lấy hàng',\r\n    description: 'GHTK chưa tiếp nhận đơn hàng',\r\n    canCancel: true,\r\n    shouldUpdateStock: false,\r\n    isFinal: false,\r\n  },\r\n  '2': {\r\n    statusId: 2,\r\n    statusText: 'Đã tiếp nhận',\r\n    deliveryStatus: 'Chờ lấy hàng',\r\n    description: 'GHTK đã tiếp nhận và đang chuẩn bị lấy hàng',\r\n    canCancel: true,\r\n    shouldUpdateStock: false,\r\n    isFinal: false,\r\n  },\r\n  '3': {\r\n    statusId: 3,\r\n    statusText: 'Đã lấy hàng/Đã nhập kho',\r\n    deliveryStatus: 'Đang giao hàng',\r\n    description: 'Shipper đã lấy hàng thành công',\r\n    canCancel: false,\r\n    shouldUpdateStock: true,\r\n    stockAction: 'dispatch',\r\n    isFinal: false,\r\n  },\r\n  '4': {\r\n    statusId: 4,\r\n    statusText: 'Đã điều phối giao hàng/Đang giao hàng',\r\n    deliveryStatus: 'Đang giao hàng',\r\n    description: 'Đơn hàng đang được giao đến khách',\r\n    canCancel: false,\r\n    shouldUpdateStock: false,\r\n    isFinal: false,\r\n  },\r\n  '5': {\r\n    statusId: 5,\r\n    statusText: 'Đã giao hàng/Chưa đối soát',\r\n    deliveryStatus: 'Đã giao hàng',\r\n    description: 'Giao hàng thành công, chưa đối soát',\r\n    canCancel: false,\r\n    shouldUpdateStock: true,\r\n    stockAction: 'complete',\r\n    isFinal: false,\r\n  },\r\n  '6': {\r\n    statusId: 6,\r\n    statusText: 'Đã đối soát',\r\n    deliveryStatus: 'Đã giao hàng',\r\n    description: 'Đã đối soát COD với GHTK',\r\n    canCancel: false,\r\n    shouldUpdateStock: false,\r\n    isFinal: true,\r\n  },\r\n  '7': {\r\n    statusId: 7,\r\n    statusText: 'Không lấy được hàng',\r\n    deliveryStatus: 'Chờ giao lại',\r\n    description: 'Shipper không lấy được hàng từ người gửi',\r\n    canCancel: false,\r\n    shouldUpdateStock: true,\r\n    stockAction: 'return',\r\n    isFinal: false,\r\n  },\r\n  '8': {\r\n    statusId: 8,\r\n    statusText: 'Hoãn lấy hàng',\r\n    deliveryStatus: 'Chờ lấy hàng',\r\n    description: 'Lấy hàng bị hoãn, sẽ lấy lại sau',\r\n    canCancel: false,\r\n    shouldUpdateStock: false,\r\n    isFinal: false,\r\n  },\r\n  '9': {\r\n    statusId: 9,\r\n    statusText: 'Không giao được hàng',\r\n    deliveryStatus: 'Chờ giao lại',\r\n    description: 'Giao hàng thất bại, sẽ giao lại hoặc trả hàng',\r\n    canCancel: false,\r\n    shouldUpdateStock: true,\r\n    stockAction: 'return',\r\n    isFinal: false,\r\n  },\r\n  '10': {\r\n    statusId: 10,\r\n    statusText: 'Delay giao hàng',\r\n    deliveryStatus: 'Đang giao hàng',\r\n    description: 'Giao hàng bị chậm trễ',\r\n    canCancel: false,\r\n    shouldUpdateStock: false,\r\n    isFinal: false,\r\n  },\r\n  '11': {\r\n    statusId: 11,\r\n    statusText: 'Đã đối soát công nợ trả hàng',\r\n    deliveryStatus: 'Chờ giao lại',\r\n    description: 'Đã đối soát tiền trả hàng',\r\n    canCancel: false,\r\n    shouldUpdateStock: false,\r\n    isFinal: true,\r\n  },\r\n  '12': {\r\n    statusId: 12,\r\n    statusText: 'Đã điều phối lấy hàng/Đang lấy hàng',\r\n    deliveryStatus: 'Chờ lấy hàng',\r\n    description: 'Shipper đang trên đường đến lấy hàng',\r\n    canCancel: true,\r\n    shouldUpdateStock: false,\r\n    isFinal: false,\r\n  },\r\n  '13': {\r\n    statusId: 13,\r\n    statusText: 'Đơn hàng bồi hoàn',\r\n    deliveryStatus: 'Chờ giao lại',\r\n    description: 'Đơn hàng bị mất/hỏng, đang xử lý bồi hoàn',\r\n    canCancel: false,\r\n    shouldUpdateStock: true,\r\n    stockAction: 'return',\r\n    isFinal: true,\r\n  },\r\n  '20': {\r\n    statusId: 20,\r\n    statusText: 'Đang trả hàng (COD cầm hàng đi trả)',\r\n    deliveryStatus: 'Chờ giao lại',\r\n    description: 'Shipper đang mang hàng về trả người gửi',\r\n    canCancel: false,\r\n    shouldUpdateStock: true,\r\n    stockAction: 'return',\r\n    isFinal: false,\r\n  },\r\n  '21': {\r\n    statusId: 21,\r\n    statusText: 'Đã trả hàng (COD đã trả xong hàng)',\r\n    deliveryStatus: 'Chờ giao lại',\r\n    description: 'Đã trả hàng về cho người gửi',\r\n    canCancel: false,\r\n    shouldUpdateStock: false,\r\n    isFinal: true,\r\n  },\r\n  '123': {\r\n    statusId: 123,\r\n    statusText: 'Shipper báo đã lấy hàng',\r\n    deliveryStatus: 'Chờ lấy hàng',\r\n    description: 'Shipper cập nhật đã lấy hàng (chưa xác nhận)',\r\n    canCancel: false,\r\n    shouldUpdateStock: false,\r\n    isFinal: false,\r\n  },\r\n  '127': {\r\n    statusId: 127,\r\n    statusText: 'Shipper báo không lấy được hàng',\r\n    deliveryStatus: 'Chờ lấy hàng',\r\n    description: 'Shipper báo không lấy được (chưa xác nhận)',\r\n    canCancel: false,\r\n    shouldUpdateStock: false,\r\n    isFinal: false,\r\n  },\r\n  '128': {\r\n    statusId: 128,\r\n    statusText: 'Shipper báo delay lấy hàng',\r\n    deliveryStatus: 'Chờ lấy hàng',\r\n    description: 'Shipper báo hoãn lấy hàng (chưa xác nhận)',\r\n    canCancel: false,\r\n    shouldUpdateStock: false,\r\n    isFinal: false,\r\n  },\r\n  '45': {\r\n    statusId: 45,\r\n    statusText: 'Shipper báo đã giao hàng',\r\n    deliveryStatus: 'Đang giao hàng',\r\n    description: 'Shipper cập nhật đã giao (chưa xác nhận)',\r\n    canCancel: false,\r\n    shouldUpdateStock: false,\r\n    isFinal: false,\r\n  },\r\n  '49': {\r\n    statusId: 49,\r\n    statusText: 'Shipper báo không giao được hàng',\r\n    deliveryStatus: 'Đang giao hàng',\r\n    description: 'Shipper báo giao thất bại (chưa xác nhận)',\r\n    canCancel: false,\r\n    shouldUpdateStock: false,\r\n    isFinal: false,\r\n  },\r\n  '410': {\r\n    statusId: 410,\r\n    statusText: 'Shipper báo delay giao hàng',\r\n    deliveryStatus: 'Đang giao hàng',\r\n    description: 'Shipper báo hoãn giao hàng (chưa xác nhận)',\r\n    canCancel: false,\r\n    shouldUpdateStock: false,\r\n    isFinal: false,\r\n  },\r\n};\r\n\r\n/**\r\n * Reason code mappings\r\n */\r\nexport const GHTK_REASON_MAP: Record<GHTKReasonCode, string> = {\r\n  // Chậm lấy hàng (100-107)\r\n  '100': 'Nhà cung cấp (NCC) hẹn lấy vào ca tiếp theo',\r\n  '101': 'GHTK không liên lạc được với NCC',\r\n  '102': 'NCC chưa có hàng',\r\n  '103': 'NCC đổi địa chỉ',\r\n  '104': 'NCC hẹn ngày lấy hàng',\r\n  '105': 'GHTK quá tải, không lấy kịp',\r\n  '106': 'Do điều kiện thời tiết, khách quan',\r\n  '107': 'Lý do khác',\r\n  \r\n  // Không lấy được hàng (110-115)\r\n  '110': 'Địa chỉ ngoài vùng phục vụ',\r\n  '111': 'Hàng không nhận vận chuyển',\r\n  '112': 'NCC báo hủy',\r\n  '113': 'NCC hoãn/không liên lạc được 3 lần',\r\n  '114': 'Lý do khác',\r\n  '115': 'Đối tác hủy đơn qua API',\r\n  \r\n  // Chậm giao hàng (120-1200)\r\n  '120': 'GHTK quá tải, giao không kịp',\r\n  '121': 'Người nhận hàng hẹn giao ca tiếp theo',\r\n  '122': 'Không gọi được cho người nhận hàng',\r\n  '123': 'Người nhận hàng hẹn ngày giao',\r\n  '124': 'Người nhận hàng chuyển địa chỉ nhận mới',\r\n  '125': 'Địa chỉ người nhận sai, cần NCC check lại',\r\n  '126': 'Do điều kiện thời tiết, khách quan',\r\n  '127': 'Lý do khác',\r\n  '128': 'Đối tác hẹn thời gian giao hàng',\r\n  '129': 'Không tìm thấy hàng',\r\n  '1200': 'SĐT người nhận sai, cần NCC check lại',\r\n  \r\n  // Không giao được hàng (130-135)\r\n  '130': 'Người nhận không đồng ý nhận sản phẩm',\r\n  '131': 'Không liên lạc được với KH 3 lần',\r\n  '132': 'KH hẹn giao lại quá 3 lần',\r\n  '133': 'Shop báo hủy đơn hàng',\r\n  '134': 'Lý do khác',\r\n  '135': 'Đối tác hủy đơn qua API',\r\n  \r\n  // Delay trả hàng (140-144)\r\n  '140': 'NCC hẹn trả ca sau',\r\n  '141': 'Không liên lạc được với NCC',\r\n  '142': 'NCC không có nhà',\r\n  '143': 'NCC hẹn ngày trả',\r\n  '144': 'Lý do khác',\r\n};\r\n\r\n/**\r\n * Helper functions\r\n */\r\n\r\nexport function getGHTKStatusInfo(statusId: number): GHTKStatusMapping | null {\r\n  return GHTK_STATUS_MAP[statusId as GHTKStatusId] || null;\r\n}\r\n\r\n/**\r\n * Get GHTK status text\r\n */\r\nexport function getGHTKStatusText(statusId: number): string {\r\n  const info = getGHTKStatusInfo(statusId);\r\n  return info?.statusText || `Trạng thái #${statusId}`;\r\n}\r\n\r\nexport function getGHTKReasonText(reasonCode: string): string {\r\n  return GHTK_REASON_MAP[reasonCode as GHTKReasonCode] || reasonCode;\r\n}\r\n\r\nexport function canCancelGHTKShipment(statusId?: number): boolean {\r\n  if (!statusId) return false;\r\n  const info = getGHTKStatusInfo(statusId);\r\n  return info?.canCancel || false;\r\n}\r\n\r\nexport function shouldSyncGHTKStatus(statusId?: number): boolean {\r\n  if (!statusId) return true; // Sync nếu chưa có status\r\n  const info = getGHTKStatusInfo(statusId);\r\n  return !info?.isFinal; // Sync nếu chưa đến trạng thái cuối\r\n}\r\n\r\n/**\r\n * Badge variant for UI\r\n */\r\nexport function getGHTKStatusVariant(statusId?: number): 'default' | 'secondary' | 'success' | 'destructive' | 'warning' {\r\n  if (!statusId) return 'secondary';\r\n  \r\n  const info = getGHTKStatusInfo(statusId);\r\n  if (!info) return 'secondary';\r\n  \r\n  // Đã giao hàng, đã đối soát\r\n  if ([5, 6].includes(statusId)) return 'success';\r\n  \r\n  // Hủy, không lấy/giao được, bồi hoàn\r\n  if ([-1, 7, 9, 13].includes(statusId)) return 'destructive';\r\n  \r\n  // Delay, hoãn\r\n  if ([8, 10].includes(statusId)) return 'warning';\r\n  \r\n  // Đang xử lý\r\n  if ([3, 4, 12].includes(statusId)) return 'default';\r\n  \r\n  return 'secondary';\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1074, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/file-upload-api.ts"],"sourcesContent":["// API client để giao tiếp với server - Staging System\r\nimport { getApiBaseUrl } from './api-config';\r\n\r\nconst API_BASE_URL = getApiBaseUrl();\r\n\r\nexport type StagingFile = {\r\n  id: string;\r\n  sessionId: string;\r\n  name: string; // Display name (smart filename với metadata)\r\n  originalName: string; // Tên file gốc\r\n  slug: string; // URL-safe slug\r\n  filename: string; // Tên file hệ thống (UUID) - cần cho preview URL\r\n  size: number;\r\n  type: string;\r\n  url: string;\r\n  status: 'staging' | 'permanent'; // ✅ Support both staging and permanent files\r\n  uploadedAt: string;\r\n  metadata: string; // Smart filename metadata\r\n};\r\n\r\nexport type ServerFile = {\r\n  id: string;\r\n  employeeId: string;\r\n  documentType: string;\r\n  documentName: string;\r\n  name: string; // Display name\r\n  originalName: string; // Tên file gốc\r\n  slug: string; // URL-safe slug\r\n  filename: string; // Tên file hệ thống\r\n  size: number;\r\n  type: string;\r\n  url: string;\r\n  uploadedAt: string;\r\n  confirmedAt?: string;\r\n  metadata: string; // Smart filename metadata\r\n};\r\n\r\nexport type UploadedAsset = {\r\n  id: string;\r\n  name: string;\r\n  size: number;\r\n  type: string;\r\n  url: string;\r\n  uploadedAt: string;\r\n};\r\n\r\nexport type UploadedFile = {\r\n  id: string;\r\n  name: string;\r\n  filename?: string;\r\n  type: string;\r\n  size: number;\r\n  url: string;\r\n  uploadedAt?: string;\r\n  metadata?: Record<string, unknown>;\r\n};\r\n\r\nexport class FileUploadAPI {\r\n  // Upload files vào staging (tạm thời)\r\n  static async uploadToStaging(files: File[], sessionId?: string): Promise<{\r\n    files: StagingFile[];\r\n    sessionId: string;\r\n  }> {\r\n    const formData = new FormData();\r\n    \r\n    files.forEach(file => {\r\n      formData.append('files', file);\r\n    });\r\n\r\n    // CRITICAL FIX: sessionId in FormData doesn't work with multer\r\n    // Send via query params instead\r\n    const url = sessionId \r\n      ? `${API_BASE_URL}/staging/upload?sessionId=${encodeURIComponent(sessionId)}`\r\n      : `${API_BASE_URL}/staging/upload`;\r\n\r\n    console.log('📤 Uploading to:', url);\r\n    console.log('📦 Files:', files.map(f => `${f.name} (${(f.size / 1024).toFixed(1)}KB)`));\r\n\r\n    let response;\r\n    try {\r\n      response = await fetch(url, {\r\n        method: 'POST',\r\n        body: formData,\r\n      });\r\n    } catch (fetchError) {\r\n      console.error('❌ Network fetch failed:', fetchError);\r\n      throw new Error(`Không thể kết nối đến server (${API_BASE_URL}). Vui lòng kiểm tra server có đang chạy.`);\r\n    }\r\n\r\n    if (!response.ok) {\r\n      const errorText = await response.text();\r\n      console.error('❌ Server error:', response.status, errorText);\r\n      throw new Error(`Server error (${response.status}): ${errorText}`);\r\n    }\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Staging upload failed');\r\n    }\r\n\r\n    return {\r\n      files: result.files,\r\n      sessionId: result.sessionId\r\n    };\r\n  }\r\n\r\n  // Confirm staging files → permanent với smart filename\r\n  // NOTE: entitySystemId MUST be immutable (systemId) to avoid broken references\r\n  static async confirmStagingFiles(\r\n    sessionId: string,\r\n    entitySystemId: string,\r\n    documentType: string,\r\n    documentName: string,\r\n    metadata?: Record<string, any>\r\n  ): Promise<ServerFile[]> {\r\n    const response = await fetch(\r\n      `${API_BASE_URL}/staging/confirm/${sessionId}/${entitySystemId}/${documentType}/${encodeURIComponent(documentName)}`,\r\n      { \r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({ metadata })\r\n      }\r\n    );\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Confirm failed');\r\n    }\r\n\r\n    return result.files;\r\n  }\r\n\r\n  // Lấy staging files theo session\r\n  static async getStagingFiles(sessionId: string): Promise<StagingFile[]> {\r\n    const response = await fetch(`${API_BASE_URL}/staging/files/${sessionId}`);\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Failed to fetch staging files');\r\n    }\r\n\r\n    return result.files;\r\n  }\r\n\r\n  // Xóa staging files (cancel)\r\n  static async deleteStagingFiles(sessionId: string): Promise<void> {\r\n    const response = await fetch(`${API_BASE_URL}/staging/${sessionId}`, {\r\n      method: 'DELETE',\r\n    });\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Delete staging failed');\r\n    }\r\n  }\r\n\r\n  // Upload files lên server (legacy - direct permanent)\r\n  // NOTE: employeeId MUST be the systemId (immutable), NOT the business ID\r\n  static async uploadFiles(\r\n    employeeId: string, // ⚠️ MUST use systemId (e.g., \"NV00000001\"), NOT business ID\r\n    documentType: string,\r\n    documentName: string,\r\n    files: File[]\r\n  ): Promise<ServerFile[]> {\r\n    const formData = new FormData();\r\n    \r\n    files.forEach(file => {\r\n      formData.append('files', file);\r\n    });\r\n\r\n    const response = await fetch(\r\n      `${API_BASE_URL}/upload/${employeeId}/${documentType}/${encodeURIComponent(documentName)}`,\r\n      {\r\n        method: 'POST',\r\n        body: formData,\r\n      }\r\n    );\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Upload failed');\r\n    }\r\n\r\n    return result.files;\r\n  }\r\n\r\n  // Lấy danh sách file permanent\r\n  // NOTE: employeeId MUST be the systemId (immutable), NOT the business ID\r\n  static async getFiles(\r\n    employeeId: string, // ⚠️ MUST use systemId (e.g., \"NV00000001\"), NOT business ID\r\n    documentType?: string\r\n  ): Promise<ServerFile[]> {\r\n    try {\r\n      const url = documentType \r\n        ? `${API_BASE_URL}/files/${employeeId}/${documentType}`\r\n        : `${API_BASE_URL}/files/${employeeId}`;\r\n\r\n      const response = await fetch(url);\r\n      \r\n      // Check if response is ok\r\n      if (!response.ok) {\r\n        return []; // Return empty array instead of throwing\r\n      }\r\n      \r\n      const result = await response.json();\r\n      \r\n      if (!result.success) {\r\n        return []; // Return empty array instead of throwing\r\n      }\r\n\r\n      return result.files || [];\r\n    } catch (error) {\r\n      return []; // Return empty array on network error\r\n    }\r\n  }\r\n\r\n  // Xóa file permanent\r\n  static async deleteFile(fileId: string): Promise<void> {\r\n    const response = await fetch(`${API_BASE_URL}/files/${fileId}`, {\r\n      method: 'DELETE',\r\n    });\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Delete failed');\r\n    }\r\n  }\r\n\r\n  // Lấy URL file để hiển thị (bao gồm staging và permanent)\r\n  static getFileUrl(file: StagingFile | ServerFile): string {\r\n    // ✅ Return relative path to use Vite proxy - avoid CORS\r\n    // Server already returns relative path like /api/staging/files/...\r\n    return file.url;\r\n  }\r\n\r\n  // Thống kê storage (chỉ permanent files)\r\n  static async getStorageInfo(): Promise<{\r\n    totalFiles: number;\r\n    totalSize: number;\r\n    totalSizeMB: number;\r\n  }> {\r\n    const response = await fetch(`${API_BASE_URL}/storage/info`);\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error('Failed to get storage info');\r\n    }\r\n\r\n    return result.stats;\r\n  }\r\n\r\n  // Helper: Generate session ID cho staging\r\n  static generateSessionId(): string {\r\n    return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n  }\r\n\r\n  static async getProductFiles(productId: string): Promise<ServerFile[]> {\r\n    return this.getFiles(productId, 'products');\r\n  }\r\n\r\n  // Get customer files (images)\r\n  static async getCustomerFiles(customerId: string): Promise<ServerFile[]> {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}/files/customers/${customerId}`);\r\n      \r\n      if (!response.ok) {\r\n        return [];\r\n      }\r\n      \r\n      const result = await response.json();\r\n      \r\n      if (!result.success) {\r\n        return [];\r\n      }\r\n\r\n      return result.files || [];\r\n    } catch (error) {\r\n      console.error('Failed to get customer files:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  // Get customer contract files\r\n  static async getCustomerContractFiles(customerId: string): Promise<ServerFile[]> {\r\n    try {\r\n      const response = await fetch(`${API_BASE_URL}/files/customers/${customerId}/contracts`);\r\n      \r\n      if (!response.ok) {\r\n        return [];\r\n      }\r\n      \r\n      const result = await response.json();\r\n      \r\n      if (!result.success) {\r\n        return [];\r\n      }\r\n\r\n      return result.files || [];\r\n    } catch (error) {\r\n      console.error('Failed to get customer contract files:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  // Confirm customer contract files from staging to permanent\r\n  static async confirmCustomerContractFiles(\r\n    sessionId: string,\r\n    customerId: string,\r\n    customerData?: Record<string, any>\r\n  ): Promise<ServerFile[]> {\r\n    const response = await fetch(\r\n      `${API_BASE_URL}/staging/confirm/${sessionId}/customers/${customerId}/contracts`,\r\n      { \r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({ customerData })\r\n      }\r\n    );\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Confirm customer contract files failed');\r\n    }\r\n\r\n    return result.files;\r\n  }\r\n\r\n  // Confirm customer images from staging to permanent\r\n  static async confirmCustomerImages(\r\n    sessionId: string,\r\n    customerId: string,\r\n    customerData?: {\r\n      name?: string;\r\n      [key: string]: any;\r\n    }\r\n  ): Promise<ServerFile[]> {\r\n    const response = await fetch(\r\n      `${API_BASE_URL}/staging/confirm/${sessionId}/customers/${customerId}`,\r\n      { \r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({ customerData })\r\n      }\r\n    );\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Confirm customer images failed');\r\n    }\r\n\r\n    return result.files;\r\n  }\r\n\r\n  // Confirm warranty images from staging to permanent\r\n  static async confirmWarrantyImages(\r\n    sessionId: string,\r\n    warrantyId: string,\r\n    imageType: 'received' | 'processed',\r\n    warrantyData?: {\r\n      customerName?: string;\r\n      [key: string]: any;\r\n    }\r\n  ): Promise<ServerFile[]> {\r\n    const response = await fetch(\r\n      `${API_BASE_URL}/staging/confirm/${sessionId}/warranty/${warrantyId}/${imageType}`,\r\n      { \r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({ warrantyData })\r\n      }\r\n    );\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Confirm warranty images failed');\r\n    }\r\n\r\n    return result.files;\r\n  }\r\n\r\n  // Delete staging session (cleanup on cancel)\r\n  static async deleteStagingSession(sessionId: string): Promise<void> {\r\n    const response = await fetch(\r\n      `${API_BASE_URL}/staging/${sessionId}`,\r\n      { method: 'DELETE' }\r\n    );\r\n\r\n    const result = await response.json();\r\n    \r\n    if (!result.success) {\r\n      throw new Error(result.message || 'Delete staging session failed');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Upload ảnh từ TipTap Editor vào STAGING\r\n   * Ảnh sẽ được move sang permanent khi entity được save\r\n   * \r\n   * @param file - File ảnh cần upload\r\n   * @param sessionId - Session ID để group các ảnh cùng editor\r\n   * @returns StagingFile với URL tạm thời\r\n   */\r\n  static async uploadEditorImageToStaging(file: File, sessionId?: string): Promise<{\r\n    file: StagingFile;\r\n    sessionId: string;\r\n  }> {\r\n    const result = await FileUploadAPI.uploadToStaging([file], sessionId);\r\n    return {\r\n      file: result.files[0],\r\n      sessionId: result.sessionId,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Confirm ảnh editor từ staging sang permanent\r\n   * Đồng thời replace staging URLs trong HTML content bằng permanent URLs\r\n   * \r\n   * @param sessionId - Editor staging session\r\n   * @param entityId - ID của entity (category, product, etc.)\r\n   * @param entityType - Loại entity ('categories', 'products', etc.)\r\n   * @param htmlContent - Nội dung HTML cần update URLs\r\n   * @returns Updated HTML với permanent URLs\r\n   */\r\n  static async confirmEditorImages(\r\n    sessionId: string,\r\n    entityId: string,\r\n    entityType: string,\r\n    htmlContent: string\r\n  ): Promise<{ html: string; files: ServerFile[] }> {\r\n    // Confirm staging files\r\n    const confirmedFiles = await FileUploadAPI.confirmStagingFiles(\r\n      sessionId,\r\n      entityId,\r\n      entityType,\r\n      'editor-images',\r\n      { source: 'tiptap-editor' }\r\n    );\r\n\r\n    // Replace staging URLs with permanent URLs in HTML\r\n    let updatedHtml = htmlContent;\r\n    for (const file of confirmedFiles) {\r\n      // Staging URL pattern: /api/staging/preview/{sessionId}/{filename}\r\n      // Find and replace with permanent URL\r\n      const stagingPattern = new RegExp(\r\n        `/api/staging/preview/[^/]+/${file.filename.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}`,\r\n        'g'\r\n      );\r\n      updatedHtml = updatedHtml.replace(stagingPattern, file.url);\r\n    }\r\n\r\n    return {\r\n      html: updatedHtml,\r\n      files: confirmedFiles,\r\n    };\r\n  }\r\n\r\n  static async uploadCommentImage(file: File): Promise<UploadedAsset> {\r\n    const formData = new FormData();\r\n    formData.append('image', file);\r\n\r\n    const response = await fetch(`${API_BASE_URL}/comments/upload-image`, {\r\n      method: 'POST',\r\n      body: formData,\r\n    });\r\n\r\n    const result = await response.json();\r\n    if (!response.ok || !result.success) {\r\n      throw new Error(result.message || 'Upload ảnh bình luận thất bại');\r\n    }\r\n\r\n    return FileUploadAPI.mapDirectUpload(result.file, file.name);\r\n  }\r\n\r\n  static async uploadPrintTemplateImage(file: File): Promise<UploadedAsset> {\r\n    const formData = new FormData();\r\n    formData.append('image', file);\r\n\r\n    const response = await fetch(`${API_BASE_URL}/print-templates/upload-image`, {\r\n      method: 'POST',\r\n      body: formData,\r\n    });\r\n\r\n    const result = await response.json();\r\n    if (!response.ok || !result.success) {\r\n      throw new Error(result.message || 'Upload ảnh mẫu in thất bại');\r\n    }\r\n\r\n    return FileUploadAPI.mapDirectUpload(result.file, file.name);\r\n  }\r\n\r\n  static async uploadComplaintCommentImage(complaintId: string, file: File): Promise<UploadedAsset> {\r\n    const formData = new FormData();\r\n    formData.append('image', file);\r\n\r\n    const response = await fetch(`${API_BASE_URL}/complaints/${complaintId}/comments/upload`, {\r\n      method: 'POST',\r\n      body: formData,\r\n    });\r\n\r\n    const result = await response.json();\r\n    if (!response.ok || !result.success) {\r\n      throw new Error(result.message || 'Upload ảnh khiếu nại thất bại');\r\n    }\r\n\r\n    return FileUploadAPI.mapDirectUpload(result.file, file.name);\r\n  }\r\n\r\n  static async uploadTaskEvidence(taskId: string, files: File[]): Promise<UploadedAsset[]> {\r\n    if (files.length === 0) {\r\n      return [];\r\n    }\r\n\r\n    const formData = new FormData();\r\n    files.forEach((file) => formData.append('files', file));\r\n\r\n    const response = await fetch(`${API_BASE_URL}/tasks/${taskId}/evidence`, {\r\n      method: 'POST',\r\n      body: formData,\r\n    });\r\n\r\n    const result = await response.json();\r\n    if (!response.ok || !result.success) {\r\n      throw new Error(result.message || 'Upload bằng chứng công việc thất bại');\r\n    }\r\n\r\n    return (result.files || []).map((file: any, index: number) =>\r\n      FileUploadAPI.mapDirectUpload(file, files[index]?.name || `evidence-${index}`)\r\n    );\r\n  }\r\n\r\n  private static mapDirectUpload(file: any, fallbackName: string): UploadedAsset {\r\n    return {\r\n      id: file.id,\r\n      name: file.originalName || file.name || fallbackName,\r\n      size: file.size || file.filesize || 0,\r\n      type: file.mimetype || file.type || 'application/octet-stream',\r\n      url: file.url,\r\n      uploadedAt: file.uploadedAt || new Date().toISOString(),\r\n    };\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1431, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-service.ts"],"sourcesContent":["import { usePrintTemplateStore } from '@/features/settings/printer/store';\r\nimport { TemplateType, PaperSize } from '@/features/settings/printer/types';\r\nimport { formatDateForDisplay, formatTimeForDisplay, formatDateTimeForDisplay } from '@/lib/date-utils';\r\nimport { getGeneralSettingsSync } from '@/lib/settings-cache';\r\n\r\n// ============================================\r\n// HELPER FUNCTIONS\r\n// ============================================\r\n\r\n/**\r\n * Lấy general-settings từ cache (loaded from database)\r\n */\r\nexport function getGeneralSettings(): {\r\n  companyName?: string;\r\n  companyAddress?: string;\r\n  phoneNumber?: string;\r\n  email?: string;\r\n  website?: string;\r\n  taxCode?: string;\r\n  logoUrl?: string;\r\n  storeName?: string;\r\n  storeAddress?: string;\r\n  storePhone?: string;\r\n} | null {\r\n  try {\r\n    const settings = getGeneralSettingsSync();\r\n    return {\r\n      companyName: settings.storeName,\r\n      companyAddress: settings.storeAddress,\r\n      phoneNumber: settings.storePhone,\r\n      storeName: settings.storeName,\r\n      storeAddress: settings.storeAddress,\r\n      storePhone: settings.storePhone,\r\n      logoUrl: settings.logoUrl,\r\n    };\r\n  } catch (e) { /* ignore */ }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Lấy logo từ general-settings (fallback khi storeInfo không có logo)\r\n */\r\nexport function getStoreLogo(storeInfoLogo?: string): string | undefined {\r\n  if (storeInfoLogo) return storeInfoLogo;\r\n  try {\r\n    const settings = getGeneralSettingsSync();\r\n    return settings.logoUrl || undefined;\r\n  } catch (e) { /* ignore */ }\r\n  return undefined;\r\n}\r\n\r\n/**\r\n * Format số tiền theo định dạng VN\r\n */\r\nexport function formatCurrency(amount: number | undefined | null): string {\r\n  if (amount === undefined || amount === null) return '0';\r\n  return new Intl.NumberFormat('vi-VN').format(amount);\r\n}\r\n\r\n/**\r\n * Chuyển số sang chữ tiếng Việt\r\n */\r\nexport function numberToWords(amount: number | undefined | null): string {\r\n  if (!amount || amount === 0) return 'Không đồng';\r\n  \r\n  const units = ['', 'một', 'hai', 'ba', 'bốn', 'năm', 'sáu', 'bảy', 'tám', 'chín'];\r\n  const positions = ['', 'nghìn', 'triệu', 'tỷ', 'nghìn tỷ', 'triệu tỷ'];\r\n  \r\n  const readThreeDigits = (num: number): string => {\r\n    const hundred = Math.floor(num / 100);\r\n    const ten = Math.floor((num % 100) / 10);\r\n    const unit = num % 10;\r\n    \r\n    let result = '';\r\n    \r\n    if (hundred > 0) {\r\n      result += units[hundred] + ' trăm ';\r\n    }\r\n    \r\n    if (ten > 1) {\r\n      result += units[ten] + ' mươi ';\r\n      if (unit === 1) {\r\n        result += 'mốt ';\r\n      } else if (unit === 5) {\r\n        result += 'lăm ';\r\n      } else if (unit > 0) {\r\n        result += units[unit] + ' ';\r\n      }\r\n    } else if (ten === 1) {\r\n      result += 'mười ';\r\n      if (unit === 5) {\r\n        result += 'lăm ';\r\n      } else if (unit > 0) {\r\n        result += units[unit] + ' ';\r\n      }\r\n    } else if (ten === 0 && hundred > 0 && unit > 0) {\r\n      result += 'lẻ ' + units[unit] + ' ';\r\n    } else if (unit > 0) {\r\n      result += units[unit] + ' ';\r\n    }\r\n    \r\n    return result.trim();\r\n  };\r\n  \r\n  let result = '';\r\n  let num = Math.abs(Math.round(amount));\r\n  let posIndex = 0;\r\n  \r\n  while (num > 0) {\r\n    const threeDigits = num % 1000;\r\n    if (threeDigits > 0) {\r\n      const words = readThreeDigits(threeDigits);\r\n      result = words + ' ' + positions[posIndex] + ' ' + result;\r\n    }\r\n    num = Math.floor(num / 1000);\r\n    posIndex++;\r\n  }\r\n  \r\n  result = result.trim();\r\n  // Capitalize first letter\r\n  result = result.charAt(0).toUpperCase() + result.slice(1) + ' đồng';\r\n  \r\n  if (amount < 0) {\r\n    result = 'Âm ' + result;\r\n  }\r\n  \r\n  return result;\r\n}\r\n\r\n/**\r\n * Format ngày theo định dạng dd/MM/yyyy\r\n * Uses centralized date-utils for consistent formatting\r\n */\r\nexport function formatDate(date: string | Date | undefined | null): string {\r\n  return formatDateForDisplay(date);\r\n}\r\n\r\n/**\r\n * Format giờ theo định dạng HH:mm\r\n * Uses centralized date-utils for consistent formatting\r\n */\r\nexport function formatTime(date: string | Date | undefined | null): string {\r\n  return formatTimeForDisplay(date);\r\n}\r\n\r\n/**\r\n * Format ngày giờ đầy đủ\r\n * Uses centralized date-utils for consistent formatting\r\n */\r\nexport function formatDateTime(date: string | Date | undefined | null): string {\r\n  return formatDateTimeForDisplay(date);\r\n}\r\n\r\n// ============================================\r\n// PRINT SERVICE\r\n// ============================================\r\n\r\n/**\r\n * CSS styles cho in ấn\r\n */\r\nconst PRINT_STYLES = `\r\n  * { box-sizing: border-box; }\r\n  body { \r\n    font-family: 'Times New Roman', Times, serif;\r\n    font-size: 13px;\r\n    line-height: 1.5;\r\n    margin: 0;\r\n    padding: 20px;\r\n    color: #000;\r\n  }\r\n  h1, h2, h3, h4 { margin: 0.5em 0; }\r\n  h2 { font-size: 18px; font-weight: bold; }\r\n  p { margin: 0.3em 0; }\r\n  table { \r\n    width: 100%; \r\n    border-collapse: collapse; \r\n    margin: 10px 0;\r\n  }\r\n  th, td { \r\n    border: 1px solid #333; \r\n    padding: 6px 8px; \r\n    text-align: left;\r\n    vertical-align: top;\r\n  }\r\n  th { \r\n    background: #f0f0f0; \r\n    font-weight: bold;\r\n  }\r\n  strong { font-weight: bold; }\r\n  em { font-style: italic; }\r\n  hr { border: none; border-top: 1px solid #333; margin: 10px 0; }\r\n  ul { margin: 0.5em 0; padding-left: 25px; list-style-type: disc; }\r\n  ol { margin: 0.5em 0; padding-left: 25px; list-style-type: decimal; }\r\n  li { margin: 0.2em 0; display: list-item; }\r\n  img { max-width: 100%; height: auto; }\r\n  @media print { \r\n    body { padding: 0; } \r\n    @page { margin: 15mm; }\r\n  }\r\n`;\r\n\r\n/**\r\n * Interface cho dữ liệu in\r\n */\r\nexport interface PrintData {\r\n  [key: string]: string | number | boolean | undefined | null | PrintLineItem[];\r\n}\r\n\r\nexport interface PrintLineItem {\r\n  [key: string]: string | number | boolean | undefined | null;\r\n}\r\n\r\n/**\r\n * Replace tất cả variables trong template với data\r\n */\r\nexport function replaceVariables(template: string, data: PrintData): string {\r\n  let result = template;\r\n  \r\n  // Replace các biến đơn lẻ\r\n  Object.entries(data).forEach(([key, value]) => {\r\n    // Nếu không phải array (line items), replace trực tiếp\r\n    if (!Array.isArray(value)) {\r\n      const placeholder = key.startsWith('{') ? key : `{${key}}`;\r\n      const stringValue = value?.toString() || '';\r\n      result = result.split(placeholder).join(stringValue);\r\n    }\r\n  });\r\n  \r\n  return result;\r\n}\r\n\r\n/**\r\n * Tạo HTML rows cho line items (sản phẩm trong đơn hàng)\r\n * Template row sẽ được nhân bản cho mỗi item\r\n */\r\nexport function generateLineItemsHtml(\r\n  templateRow: string, \r\n  items: PrintLineItem[],\r\n  startIndex: number = 1\r\n): string {\r\n  return items.map((item, index) => {\r\n    let row = templateRow;\r\n    \r\n    // Replace {line_stt} với số thứ tự\r\n    row = row.replace(/{line_stt}/g, (startIndex + index).toString());\r\n    \r\n    // Replace các biến line_* khác\r\n    Object.entries(item).forEach(([key, value]) => {\r\n      const placeholder = key.startsWith('{') ? key : `{${key}}`;\r\n      const stringValue = value?.toString() || '';\r\n      row = row.split(placeholder).join(stringValue);\r\n    });\r\n    \r\n    return row;\r\n  }).join('\\n');\r\n}\r\n\r\n/**\r\n * Tạo nội dung HTML để in từ template và data\r\n */\r\nexport function generatePrintHtml(\r\n  templateType: TemplateType,\r\n  data: PrintData,\r\n  branchId?: string\r\n): string {\r\n  const store = usePrintTemplateStore.getState();\r\n  const defaultSize = store.getDefaultSize(templateType);\r\n  const template = store.getTemplate(templateType, defaultSize, branchId);\r\n  \r\n  let html = template.content;\r\n  \r\n  // Replace variables\r\n  html = replaceVariables(html, data);\r\n  \r\n  return html;\r\n}\r\n\r\n/**\r\n * In document với template\r\n */\r\nexport function printDocument(\r\n  templateType: TemplateType,\r\n  data: PrintData,\r\n  options?: {\r\n    branchId?: string;\r\n    paperSize?: PaperSize;\r\n    title?: string;\r\n  }\r\n): void {\r\n  const store = usePrintTemplateStore.getState();\r\n  const paperSize = options?.paperSize || store.getDefaultSize(templateType);\r\n  const template = store.getTemplate(templateType, paperSize, options?.branchId);\r\n  \r\n  // Generate HTML content\r\n  let html = replaceVariables(template.content, data);\r\n  \r\n  // Tạo iframe ẩn để in\r\n  const printFrame = document.createElement('iframe');\r\n  printFrame.style.position = 'absolute';\r\n  printFrame.style.top = '-10000px';\r\n  printFrame.style.left = '-10000px';\r\n  document.body.appendChild(printFrame);\r\n  \r\n  const printDoc = printFrame.contentDocument || printFrame.contentWindow?.document;\r\n  if (printDoc) {\r\n    const title = options?.title || `In ${templateType}`;\r\n    \r\n    printDoc.write(`\r\n      <!DOCTYPE html>\r\n      <html>\r\n      <head>\r\n        <title>${title}</title>\r\n        <style>${PRINT_STYLES}</style>\r\n      </head>\r\n      <body>${html}</body>\r\n      </html>\r\n    `);\r\n    printDoc.close();\r\n    \r\n    // Đợi load xong rồi in\r\n    setTimeout(() => {\r\n      printFrame.contentWindow?.print();\r\n      // Xóa iframe sau khi in\r\n      setTimeout(() => {\r\n        if (document.body.contains(printFrame)) {\r\n          document.body.removeChild(printFrame);\r\n        }\r\n      }, 1000);\r\n    }, 100);\r\n  }\r\n}\r\n\r\n/**\r\n * Preview document (trả về HTML string)\r\n */\r\nexport function getPreviewHtml(\r\n  templateType: TemplateType,\r\n  data: PrintData,\r\n  options?: {\r\n    branchId?: string;\r\n    paperSize?: PaperSize;\r\n  }\r\n): string {\r\n  const store = usePrintTemplateStore.getState();\r\n  const paperSize = options?.paperSize || store.getDefaultSize(templateType);\r\n  const template = store.getTemplate(templateType, paperSize, options?.branchId);\r\n  \r\n  return replaceVariables(template.content, data);\r\n}\r\n\r\n// ============================================\r\n// DATA MAPPERS - Chuyển đổi data từ entity sang print data\r\n// ============================================\r\n\r\n/**\r\n * Base interface cho store settings (cần import từ settings store)\r\n */\r\nexport interface StoreSettings {\r\n  name?: string;\r\n  address?: string;\r\n  phone?: string;\r\n  hotline?: string;\r\n  email?: string;\r\n  logo?: string;\r\n  fax?: string;\r\n  province?: string;\r\n  website?: string;\r\n  taxCode?: string;\r\n}\r\n\r\n/**\r\n * Tạo data cho thông tin cửa hàng\r\n */\r\nexport function getStoreData(settings: StoreSettings): PrintData {\r\n  const now = new Date();\r\n  const logo = getStoreLogo(settings.logo);\r\n  return {\r\n    '{store_logo}': logo \r\n      ? `<img src=\"${logo}\" alt=\"Logo\" style=\"max-height:60px\"/>` \r\n      : '',\r\n    '{store_name}': settings.name || '',\r\n    '{store_address}': settings.address || '',\r\n    '{store_phone_number}': settings.phone || '',\r\n    '{hotline}': settings.hotline || settings.phone || '',\r\n    '{store_hotline}': settings.hotline || settings.phone || '',\r\n    '{store_email}': settings.email || '',\r\n    '{store_fax}': settings.fax || '',\r\n    '{store_website}': settings.website || '',\r\n    '{store_tax_code}': settings.taxCode || '',\r\n    // Print timestamp - always inject current time\r\n    '{print_date}': formatDate(now),\r\n    '{print_time}': formatTime(now),\r\n  };\r\n}\r\n\r\n/**\r\n * Export default cho tiện import\r\n */\r\nexport const PrintService = {\r\n  formatCurrency,\r\n  numberToWords,\r\n  formatDate,\r\n  formatTime,\r\n  formatDateTime,\r\n  replaceVariables,\r\n  generateLineItemsHtml,\r\n  generatePrintHtml,\r\n  printDocument,\r\n  getPreviewHtml,\r\n  getStoreData,\r\n  getStoreLogo,\r\n};\r\n\r\nexport default PrintService;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1741, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/use-print.ts"],"sourcesContent":["/**\r\n * Hook để sử dụng Print Service trong các component\r\n */\r\n\r\nimport * as React from 'react';\r\nimport type { TemplateType, PaperSize } from '../features/settings/printer/types';\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  replaceVariables,\r\n} from './print-service';\r\nimport { usePrintTemplateStore } from '../features/settings/printer/store';\r\n\r\ninterface PrintOptions {\r\n  /** Dữ liệu để thay thế biến trong template */\r\n  data: PrintData;\r\n  /** Line items (sản phẩm, hàng hóa) */\r\n  lineItems?: PrintLineItem[];\r\n  /** Khổ giấy cụ thể (nếu muốn override default) */\r\n  paperSize?: PaperSize;\r\n  /** Branch ID cụ thể (nếu muốn override current branch) */\r\n  branchId?: string;\r\n}\r\n\r\ninterface UsePrintResult {\r\n  /** Hàm in tài liệu */\r\n  print: (type: TemplateType, options: PrintOptions) => void;\r\n  /** Hàm in nhiều tài liệu cùng lúc (gộp thành 1 document) */\r\n  printMultiple: (type: TemplateType, optionsList: PrintOptions[]) => void;\r\n  /** Hàm in nhiều loại tài liệu khác nhau cùng lúc (gộp thành 1 popup) */\r\n  printMixedDocuments: (documents: Array<{ type: TemplateType; options: PrintOptions }>) => void;\r\n  /** Hàm lấy HTML preview */\r\n  getPreview: (type: TemplateType, options: PrintOptions) => string;\r\n  /** Kiểm tra template có tồn tại không */\r\n  hasTemplate: (type: TemplateType, paperSize?: PaperSize) => boolean;\r\n  /** Lấy danh sách khổ giấy có template */\r\n  getAvailableSizes: (type: TemplateType) => PaperSize[];\r\n  /** Lấy khổ giấy mặc định cho loại template */\r\n  getDefaultSize: (type: TemplateType) => PaperSize;\r\n  /** Đang loading template store */\r\n  isLoading: boolean;\r\n}\r\n\r\n/**\r\n * Kiểm tra giá trị có \"empty\" không (null, undefined, '', '0', 0)\r\n */\r\nfunction isEmptyValue(value: unknown): boolean {\r\n  if (value === undefined || value === null || value === '') return true;\r\n  // Coi '0' và các biến thể như empty\r\n  const strValue = String(value).trim();\r\n  if (strValue === '0' || strValue === '0đ' || strValue === '0 đ') return true;\r\n  return false;\r\n}\r\n\r\n/**\r\n * Xử lý các điều kiện trong template\r\n * Hỗ trợ:\r\n * - {{#if has_tax}}...{{/if}} - Điều kiện boolean\r\n * - {{#if_empty {field}}}...{{/if_empty}} - Nếu field rỗng\r\n * - {{#if_not_empty {field}}}...{{/if_not_empty}} - Nếu field không rỗng\r\n * - {{#if_gt {field} value}}...{{/if_gt}} - Nếu field > value (greater than)\r\n */\r\nfunction processConditionals(html: string, data: PrintData, lineItems?: PrintLineItem[]): string {\r\n  let result = html;\r\n\r\n  // 1. Xử lý {{#if_not_empty {field}}}...{{/if_not_empty}}\r\n  const ifNotEmptyPattern = /\\{\\{#if_not_empty\\s+\\{([^}]+)\\}\\}\\}([\\s\\S]*?)\\{\\{\\/if_not_empty\\}\\}/gi;\r\n  result = result.replace(ifNotEmptyPattern, (match, field, content) => {\r\n    const key = `{${field}}`;\r\n    const value = data[key];\r\n    if (!isEmptyValue(value)) {\r\n      return content;\r\n    }\r\n    return '';\r\n  });\r\n\r\n  // 2. Xử lý {{#if_empty {field}}}...{{/if_empty}}\r\n  const ifEmptyPattern = /\\{\\{#if_empty\\s+\\{([^}]+)\\}\\}\\}([\\s\\S]*?)\\{\\{\\/if_empty\\}\\}/gi;\r\n  result = result.replace(ifEmptyPattern, (match, field, content) => {\r\n    const key = `{${field}}`;\r\n    const value = data[key];\r\n    if (isEmptyValue(value)) {\r\n      return content;\r\n    }\r\n    return '';\r\n  });\r\n\r\n  // 3. Xử lý {{#if_gt {field} value}}...{{/if_gt}} (greater than 0)\r\n  const ifGtPattern = /\\{\\{#if_gt\\s+\\{([^}]+)\\}\\s+(\\d+)\\}\\}([\\s\\S]*?)\\{\\{\\/if_gt\\}\\}/gi;\r\n  result = result.replace(ifGtPattern, (match, field, compareValue, content) => {\r\n    const key = `{${field}}`;\r\n    const value = data[key];\r\n    // Parse số từ giá trị (loại bỏ dấu chấm, đ, etc.)\r\n    const numValue = parseFloat((value || '0').toString().replace(/[^\\d.-]/g, ''));\r\n    const numCompare = parseFloat(compareValue);\r\n    if (numValue > numCompare) {\r\n      return content;\r\n    }\r\n    return '';\r\n  });\r\n\r\n  // 4. Xử lý {{#if has_tax}}...{{/if}} - Boolean conditions\r\n  // has_tax = true nếu total_tax > 0\r\n  const hasTax = !isEmptyValue(data['{total_tax}']);\r\n  const hasDiscount = !isEmptyValue(data['{total_discount}']);\r\n  const hasDeliveryFee = !isEmptyValue(data['{delivery_fee}']);\r\n  const hasNote = !isEmptyValue(data['{order_note}']);\r\n\r\n  const booleanConditions: Record<string, boolean> = {\r\n    'has_tax': hasTax,\r\n    'has_discount': hasDiscount,\r\n    'has_delivery_fee': hasDeliveryFee,\r\n    'has_note': hasNote,\r\n    'has_shipping_address': !isEmptyValue(data['{shipping_address}']),\r\n    'has_customer_email': !isEmptyValue(data['{customer_email}']),\r\n    'has_customer_phone': !isEmptyValue(data['{customer_phone_number}']),\r\n  };\r\n\r\n  // Xử lý {{#if condition}}...{{/if}}\r\n  const ifPattern = /\\{\\{#if\\s+(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/if\\}\\}/gi;\r\n  result = result.replace(ifPattern, (match, condition, content) => {\r\n    if (booleanConditions[condition]) {\r\n      return content;\r\n    }\r\n    return '';\r\n  });\r\n\r\n  // 5. Xử lý {{#unless condition}}...{{/unless}} (ngược lại với if)\r\n  const unlessPattern = /\\{\\{#unless\\s+(\\w+)\\}\\}([\\s\\S]*?)\\{\\{\\/unless\\}\\}/gi;\r\n  result = result.replace(unlessPattern, (match, condition, content) => {\r\n    if (!booleanConditions[condition]) {\r\n      return content;\r\n    }\r\n    return '';\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Xử lý điều kiện cho line items\r\n * Ví dụ: {{#line_if_not_empty {line_tax_amount}}}...{{/line_if_not_empty}}\r\n */\r\nfunction processLineItemConditionals(rowHtml: string, item: PrintLineItem): string {\r\n  let result = rowHtml;\r\n\r\n  // Xử lý {{#line_if_not_empty {field}}}...{{/line_if_not_empty}}\r\n  const lineIfNotEmptyPattern = /\\{\\{#line_if_not_empty\\s+\\{([^}]+)\\}\\}\\}([\\s\\S]*?)\\{\\{\\/line_if_not_empty\\}\\}/gi;\r\n  result = result.replace(lineIfNotEmptyPattern, (match, field, content) => {\r\n    const key = `{${field}}`;\r\n    const value = item[key];\r\n    if (!isEmptyValue(value)) {\r\n      return content;\r\n    }\r\n    return '';\r\n  });\r\n\r\n  // Xử lý {{#line_if_empty {field}}}...{{/line_if_empty}}\r\n  const lineIfEmptyPattern = /\\{\\{#line_if_empty\\s+\\{([^}]+)\\}\\}\\}([\\s\\S]*?)\\{\\{\\/line_if_empty\\}\\}/gi;\r\n  result = result.replace(lineIfEmptyPattern, (match, field, content) => {\r\n    const key = `{${field}}`;\r\n    const value = item[key];\r\n    if (isEmptyValue(value)) {\r\n      return content;\r\n    }\r\n    return '';\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Hook để sử dụng chức năng in trong các trang\r\n * @param currentBranchId - ID của branch hiện tại (optional)\r\n * @example\r\n * const { print, getPreview } = usePrint(currentBranch?.systemId);\r\n * \r\n * // In đơn hàng\r\n * print('order', {\r\n *   data: mapOrderToPrintData(order, storeSettings),\r\n *   lineItems: mapOrderLineItems(order.items),\r\n * });\r\n */\r\nexport function usePrint(currentBranchId?: string): UsePrintResult {\r\n  const templateStore = usePrintTemplateStore();\r\n  const [isLoading] = React.useState(false);\r\n\r\n  const getTemplateContent = React.useCallback((\r\n    type: TemplateType, \r\n    paperSize?: PaperSize, \r\n    branchId?: string\r\n  ): string | null => {\r\n    // Xác định paperSize sử dụng\r\n    const size = paperSize || templateStore.getDefaultSize(type);\r\n    const branch = branchId || currentBranchId;\r\n\r\n    // Lấy template\r\n    const template = templateStore.getTemplate(type, size, branch);\r\n    if (template?.content) {\r\n      return template.content;\r\n    }\r\n\r\n    // Fallback: thử lấy template không có branch\r\n    const defaultTemplate = templateStore.getTemplate(type, size);\r\n    return defaultTemplate?.content || null;\r\n  }, [templateStore, currentBranchId]);\r\n\r\n  const processTemplate = React.useCallback((\r\n    templateContent: string,\r\n    data: PrintData,\r\n    lineItems?: PrintLineItem[]\r\n  ): string => {\r\n    // Bước 1: Xử lý line items nếu có\r\n    let html = templateContent;\r\n    \r\n    console.log('[processTemplate] Starting, lineItems count:', lineItems?.length);\r\n    \r\n    if (lineItems && lineItems.length > 0) {\r\n      // === XỬ LÝ CÚ PHÁP {{#line_items}}...{{/line_items}} ===\r\n      // Dành cho template lặp toàn bộ section (mỗi employee 1 page)\r\n      const lineItemsBlockPattern = /\\{\\{#line_items\\}\\}([\\s\\S]*?)\\{\\{\\/line_items\\}\\}/gi;\r\n      const lineItemsBlockMatch = html.match(lineItemsBlockPattern);\r\n      \r\n      console.log('[processTemplate] Block match found:', !!lineItemsBlockMatch, lineItemsBlockMatch?.length);\r\n      \r\n      if (lineItemsBlockMatch && lineItemsBlockMatch.length > 0) {\r\n        // Có block {{#line_items}} - lặp cả block cho mỗi item\r\n        html = html.replace(lineItemsBlockPattern, (match, blockContent) => {\r\n          return lineItems.map((item, index) => {\r\n            let itemHtml = blockContent;\r\n            \r\n            // Thêm {line_index}\r\n            itemHtml = itemHtml.replace(/\\{line_index\\}/g, String(index + 1));\r\n            \r\n            // Replace các biến từ item (line item data)\r\n            Object.entries(item).forEach(([key, value]) => {\r\n              const placeholder = key.startsWith('{') ? key : `{${key}}`;\r\n              const regex = new RegExp(placeholder.replace(/[{}]/g, '\\\\$&'), 'g');\r\n              itemHtml = itemHtml.replace(regex, value?.toString() || '');\r\n            });\r\n            \r\n            // Replace các biến global (data) cho mỗi item page\r\n            Object.entries(data).forEach(([key, value]) => {\r\n              const placeholder = key.startsWith('{') ? key : `{${key}}`;\r\n              const regex = new RegExp(placeholder.replace(/[{}]/g, '\\\\$&'), 'g');\r\n              itemHtml = itemHtml.replace(regex, value?.toString() || '');\r\n            });\r\n            \r\n            return itemHtml;\r\n          }).join('\\n');\r\n        });\r\n        \r\n        // Đã xử lý xong line items theo block mode, skip table mode\r\n      } else {\r\n        // === XỬ LÝ TABLE MODE (cũ) ===\r\n        // Tìm tất cả các table trong template\r\n        const tablePattern = /<table[^>]*>[\\s\\S]*?<\\/table>/gi;\r\n        const tables = html.match(tablePattern);\r\n      \r\n        if (tables) {\r\n          // Tìm table chứa {line_stt} - đây là bảng line items\r\n          const lineItemsTable = tables.find(table => table.includes('{line_stt}'));\r\n        \r\n          if (lineItemsTable) {\r\n            // Tìm tbody trong table này\r\n            let tbodyMatch = lineItemsTable.match(/<tbody[^>]*>([\\s\\S]*?)<\\/tbody>/i);\r\n          \r\n            // Nếu không có tbody, có thể table chỉ có tr trực tiếp\r\n            // (một số template không dùng thead/tbody)\r\n            if (!tbodyMatch) {\r\n              // Tìm tất cả tr trong table (trừ tr trong thead)\r\n              const theadMatch = lineItemsTable.match(/<thead[^>]*>[\\s\\S]*?<\\/thead>/i);\r\n              let tableWithoutThead = lineItemsTable;\r\n              if (theadMatch) {\r\n                tableWithoutThead = lineItemsTable.replace(theadMatch[0], '');\r\n              }\r\n            \r\n              // Tìm tr chứa {line_stt}\r\n              const rowPattern = /<tr[^>]*>[\\s\\S]*?\\{line_stt\\}[\\s\\S]*?<\\/tr>/i;\r\n              const rowMatch = tableWithoutThead.match(rowPattern);\r\n            \r\n              if (rowMatch) {\r\n                const templateRow = rowMatch[0];\r\n              \r\n                // Tạo các row mới từ template\r\n                const rowsHtml = lineItems.map((item) => {\r\n                  let row = templateRow;\r\n                \r\n                  // Xử lý điều kiện cho line item trước\r\n                  row = processLineItemConditionals(row, item);\r\n                \r\n                  Object.entries(item).forEach(([key, value]) => {\r\n                    const placeholder = key.startsWith('{') ? key : `{${key}}`;\r\n                    const regex = new RegExp(placeholder.replace(/[{}]/g, '\\\\$&'), 'g');\r\n                    row = row.replace(regex, value?.toString() || '');\r\n                  });\r\n                  return row;\r\n                }).join('\\n    ');\r\n              \r\n                // Thay thế row mẫu bằng các rows mới\r\n                const newTable = lineItemsTable.replace(templateRow, rowsHtml);\r\n                html = html.replace(lineItemsTable, newTable);\r\n              }\r\n            } else {\r\n              // Có tbody - xử lý như cũ\r\n              const tbodyContent = tbodyMatch[1];\r\n            \r\n              // Tìm TẤT CẢ các row trong tbody\r\n              const allRowsPattern = /<tr[^>]*>[\\s\\S]*?<\\/tr>/gi;\r\n              const allRows = tbodyContent.match(allRowsPattern);\r\n            \r\n              if (allRows && allRows.length > 0) {\r\n                // Tìm row chứa {line_stt} - đây là row mẫu\r\n                const templateRow = allRows.find(row => row.includes('{line_stt}')) || allRows[0];\r\n              \r\n                // Tạo các row mới từ template\r\n                const rowsHtml = lineItems.map((item) => {\r\n                  let row = templateRow;\r\n                \r\n                  // Xử lý điều kiện cho line item trước\r\n                  row = processLineItemConditionals(row, item);\r\n                \r\n                  // Replace từng biến trong item\r\n                  Object.entries(item).forEach(([key, value]) => {\r\n                    const placeholder = key.startsWith('{') ? key : `{${key}}`;\r\n                    const regex = new RegExp(placeholder.replace(/[{}]/g, '\\\\$&'), 'g');\r\n                    row = row.replace(regex, value?.toString() || '');\r\n                  });\r\n                \r\n                  return row;\r\n                }).join('\\n    ');\r\n              \r\n                // Tạo tbody mới\r\n                const newTbody = `<tbody>\\n    ${rowsHtml}\\n  </tbody>`;\r\n              \r\n                // Thay thế tbody cũ trong table\r\n                const newTable = lineItemsTable.replace(tbodyMatch[0], newTbody);\r\n              \r\n                // Thay thế table cũ bằng table mới trong html\r\n                html = html.replace(lineItemsTable, newTable);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } // End of else (TABLE MODE)\r\n    }\r\n\r\n    // Bước 2: Xử lý các điều kiện (conditionals)\r\n    html = processConditionals(html, data, lineItems);\r\n\r\n    // Bước 3: Thay thế các biến còn lại\r\n    html = replaceVariables(html, data);\r\n\r\n    return html;\r\n  }, []);\r\n\r\n  const print = React.useCallback((type: TemplateType, options: PrintOptions) => {\r\n    const { data, lineItems, paperSize, branchId } = options;\r\n\r\n    console.log('[usePrint] Starting print for type:', type);\r\n    console.log('[usePrint] Data keys:', Object.keys(data));\r\n    console.log('[usePrint] LineItems count:', lineItems?.length || 0);\r\n\r\n    // Lấy template content\r\n    const size = paperSize || templateStore.getDefaultSize(type);\r\n    const templateContent = getTemplateContent(type, size, branchId);\r\n    \r\n    if (!templateContent) {\r\n      console.error(`[usePrint] No template found for type: ${type}`);\r\n      return;\r\n    }\r\n\r\n    console.log('[usePrint] Template found, length:', templateContent.length);\r\n\r\n    // Xử lý template\r\n    let html: string;\r\n    try {\r\n      html = processTemplate(templateContent, data, lineItems);\r\n      console.log('[usePrint] Template processed, html length:', html.length);\r\n    } catch (err) {\r\n      console.error('[usePrint] Error processing template:', err);\r\n      return;\r\n    }\r\n\r\n    // Tạo iframe ẩn để in\r\n    const printFrame = document.createElement('iframe');\r\n    printFrame.style.position = 'absolute';\r\n    printFrame.style.top = '-10000px';\r\n    printFrame.style.left = '-10000px';\r\n    document.body.appendChild(printFrame);\r\n    \r\n    const printDoc = printFrame.contentDocument || printFrame.contentWindow?.document;\r\n    if (printDoc) {\r\n      // CSS cơ bản cho print - giống với Settings preview\r\n      const printCSS = `\r\n        body { font-family: Arial, sans-serif; font-size: 12px; line-height: 1.5; }\r\n        table { width: 100%; border-collapse: collapse; margin: 8px 0; }\r\n        th, td { border: 1px solid #333; padding: 6px 8px; }\r\n        th { background-color: #f5f5f5; font-weight: bold; }\r\n        .text-center, [style*=\"text-align: center\"] { text-align: center; }\r\n        .text-right, [style*=\"text-align: right\"] { text-align: right; }\r\n        img { max-width: 100%; height: auto; }\r\n        h1, h2, h3 { margin: 8px 0; }\r\n        p { margin: 4px 0; }\r\n      `;\r\n      \r\n      printDoc.write(`\r\n        <!DOCTYPE html>\r\n        <html>\r\n        <head>\r\n          <title>In ${type}</title>\r\n          <style>${printCSS}</style>\r\n        </head>\r\n        <body>${html}</body>\r\n        </html>\r\n      `);\r\n      printDoc.close();\r\n      \r\n      // Đợi load xong rồi in\r\n      setTimeout(() => {\r\n        printFrame.contentWindow?.print();\r\n        // Xóa iframe sau khi in\r\n        setTimeout(() => {\r\n          if (document.body.contains(printFrame)) {\r\n            document.body.removeChild(printFrame);\r\n          }\r\n        }, 1000);\r\n      }, 100);\r\n    }\r\n  }, [getTemplateContent, processTemplate]);\r\n\r\n  /**\r\n   * In nhiều tài liệu cùng lúc - gộp thành 1 document với page break giữa các tài liệu\r\n   */\r\n  const printMultiple = React.useCallback((type: TemplateType, optionsList: PrintOptions[]) => {\r\n    if (optionsList.length === 0) return;\r\n\r\n    // Lấy template content (dùng paperSize của item đầu tiên hoặc default)\r\n    const firstOptions = optionsList[0];\r\n    const size = firstOptions.paperSize || templateStore.getDefaultSize(type);\r\n    const templateContent = getTemplateContent(type, size, firstOptions.branchId);\r\n    \r\n    if (!templateContent) {\r\n      console.error(`[usePrint] No template found for type: ${type}`);\r\n      return;\r\n    }\r\n\r\n    // Xử lý từng document và gộp lại với page break\r\n    const allHtmlParts = optionsList.map((options, index) => {\r\n      const html = processTemplate(templateContent, options.data, options.lineItems);\r\n      // Thêm page break sau mỗi document (trừ document cuối)\r\n      if (index < optionsList.length - 1) {\r\n        return `<div class=\"print-page\" style=\"page-break-after: always; break-after: page;\">${html}</div>`;\r\n      }\r\n      return `<div class=\"print-page-last\">${html}</div>`;\r\n    });\r\n\r\n    const combinedHtml = allHtmlParts.join('\\n');\r\n\r\n    // Tạo iframe ẩn để in\r\n    const printFrame = document.createElement('iframe');\r\n    printFrame.style.position = 'absolute';\r\n    printFrame.style.top = '-10000px';\r\n    printFrame.style.left = '-10000px';\r\n    document.body.appendChild(printFrame);\r\n    \r\n    const printDoc = printFrame.contentDocument || printFrame.contentWindow?.document;\r\n    if (printDoc) {\r\n      // CSS cơ bản cho print với page break\r\n      const printCSS = `\r\n        * { box-sizing: border-box; }\r\n        body { font-family: Arial, sans-serif; font-size: 12px; line-height: 1.5; margin: 0; padding: 0; }\r\n        table { width: 100%; border-collapse: collapse; margin: 8px 0; }\r\n        th, td { border: 1px solid #333; padding: 6px 8px; }\r\n        th { background-color: #f5f5f5; font-weight: bold; }\r\n        .text-center, [style*=\"text-align: center\"] { text-align: center; }\r\n        .text-right, [style*=\"text-align: right\"] { text-align: right; }\r\n        img { max-width: 100%; height: auto; }\r\n        h1, h2, h3 { margin: 8px 0; }\r\n        p { margin: 4px 0; }\r\n        .print-page { \r\n          page-break-after: always !important; \r\n          break-after: page !important;\r\n          page-break-inside: avoid;\r\n        }\r\n        .print-page-last { \r\n          page-break-after: auto; \r\n        }\r\n        @media print {\r\n          .print-page { \r\n            page-break-after: always !important; \r\n            break-after: page !important;\r\n          }\r\n          .print-page-last { \r\n            page-break-after: auto; \r\n          }\r\n        }\r\n      `;\r\n      \r\n      printDoc.write(`\r\n        <!DOCTYPE html>\r\n        <html>\r\n        <head>\r\n          <title>In ${optionsList.length} ${type}</title>\r\n          <style>${printCSS}</style>\r\n        </head>\r\n        <body>${combinedHtml}</body>\r\n        </html>\r\n      `);\r\n      printDoc.close();\r\n      \r\n      // Đợi load xong rồi in\r\n      setTimeout(() => {\r\n        printFrame.contentWindow?.print();\r\n        // Xóa iframe sau khi in\r\n        setTimeout(() => {\r\n          if (document.body.contains(printFrame)) {\r\n            document.body.removeChild(printFrame);\r\n          }\r\n        }, 1000);\r\n      }, 100);\r\n    }\r\n  }, [templateStore, getTemplateContent, processTemplate]);\r\n\r\n  /**\r\n   * In nhiều loại tài liệu khác nhau cùng lúc - gộp thành 1 popup duy nhất\r\n   * Ví dụ: In đơn hàng + phiếu giao hàng + phiếu đóng gói trong 1 lần\r\n   */\r\n  const printMixedDocuments = React.useCallback((documents: Array<{ type: TemplateType; options: PrintOptions }>) => {\r\n    if (documents.length === 0) return;\r\n\r\n    // Xử lý từng document và gộp lại với page break\r\n    const allHtmlParts: string[] = [];\r\n    \r\n    documents.forEach((doc, docIndex) => {\r\n      const { type, options } = doc;\r\n      const { data, lineItems, paperSize, branchId } = options;\r\n      \r\n      // Lấy template content cho loại này\r\n      const size = paperSize || templateStore.getDefaultSize(type);\r\n      const templateContent = getTemplateContent(type, size, branchId);\r\n      \r\n      if (!templateContent) {\r\n        console.warn(`[printMixedDocuments] No template found for type: ${type}, skipping`);\r\n        return;\r\n      }\r\n      \r\n      const html = processTemplate(templateContent, data, lineItems);\r\n      \r\n      // Thêm page break sau mỗi document (trừ document cuối)\r\n      if (docIndex < documents.length - 1) {\r\n        allHtmlParts.push(`<div class=\"print-page\" style=\"page-break-after: always; break-after: page;\">${html}</div>`);\r\n      } else {\r\n        allHtmlParts.push(`<div class=\"print-page-last\">${html}</div>`);\r\n      }\r\n    });\r\n\r\n    if (allHtmlParts.length === 0) {\r\n      console.error('[printMixedDocuments] No documents to print');\r\n      return;\r\n    }\r\n\r\n    const combinedHtml = allHtmlParts.join('\\n');\r\n\r\n    // Tạo iframe ẩn để in\r\n    const printFrame = document.createElement('iframe');\r\n    printFrame.style.position = 'absolute';\r\n    printFrame.style.top = '-10000px';\r\n    printFrame.style.left = '-10000px';\r\n    document.body.appendChild(printFrame);\r\n    \r\n    const printDoc = printFrame.contentDocument || printFrame.contentWindow?.document;\r\n    if (printDoc) {\r\n      // CSS cơ bản cho print với page break\r\n      const printCSS = `\r\n        * { box-sizing: border-box; }\r\n        body { font-family: Arial, sans-serif; font-size: 12px; line-height: 1.5; margin: 0; padding: 0; }\r\n        table { width: 100%; border-collapse: collapse; margin: 8px 0; }\r\n        th, td { border: 1px solid #333; padding: 6px 8px; }\r\n        th { background-color: #f5f5f5; font-weight: bold; }\r\n        .text-center, [style*=\"text-align: center\"] { text-align: center; }\r\n        .text-right, [style*=\"text-align: right\"] { text-align: right; }\r\n        img { max-width: 100%; height: auto; }\r\n        h1, h2, h3 { margin: 8px 0; }\r\n        p { margin: 4px 0; }\r\n        .print-page { \r\n          page-break-after: always !important; \r\n          break-after: page !important;\r\n          page-break-inside: avoid;\r\n        }\r\n        .print-page-last { \r\n          page-break-after: auto; \r\n        }\r\n        @media print {\r\n          .print-page { \r\n            page-break-after: always !important; \r\n            break-after: page !important;\r\n          }\r\n          .print-page-last { \r\n            page-break-after: auto; \r\n          }\r\n        }\r\n      `;\r\n      \r\n      printDoc.write(`\r\n        <!DOCTYPE html>\r\n        <html>\r\n        <head>\r\n          <title>In ${documents.length} tài liệu</title>\r\n          <style>${printCSS}</style>\r\n        </head>\r\n        <body>${combinedHtml}</body>\r\n        </html>\r\n      `);\r\n      printDoc.close();\r\n      \r\n      // Đợi load xong rồi in\r\n      setTimeout(() => {\r\n        printFrame.contentWindow?.print();\r\n        // Xóa iframe sau khi in\r\n        setTimeout(() => {\r\n          if (document.body.contains(printFrame)) {\r\n            document.body.removeChild(printFrame);\r\n          }\r\n        }, 1000);\r\n      }, 100);\r\n    }\r\n  }, [templateStore, getTemplateContent, processTemplate]);\r\n\r\n  const getPreview = React.useCallback((type: TemplateType, options: PrintOptions): string => {\r\n    const { data, lineItems, paperSize, branchId } = options;\r\n\r\n    // Lấy template content\r\n    const templateContent = getTemplateContent(type, paperSize, branchId);\r\n    if (!templateContent) {\r\n      return '<p style=\"color: red;\">Không tìm thấy mẫu in</p>';\r\n    }\r\n\r\n    // Xử lý template\r\n    return processTemplate(templateContent, data, lineItems);\r\n  }, [getTemplateContent, processTemplate]);\r\n\r\n  const hasTemplate = React.useCallback((type: TemplateType, paperSize?: PaperSize): boolean => {\r\n    const size = paperSize || templateStore.getDefaultSize(type);\r\n    const template = templateStore.getTemplate(type, size, currentBranchId);\r\n    return !!template?.content;\r\n  }, [templateStore, currentBranchId]);\r\n\r\n  const getAvailableSizes = React.useCallback((type: TemplateType): PaperSize[] => {\r\n    const sizes: PaperSize[] = ['K57', 'K80', 'A4', 'A5'];\r\n    return sizes.filter(size => {\r\n      const template = templateStore.getTemplate(type, size, currentBranchId);\r\n      return !!template?.content;\r\n    });\r\n  }, [templateStore, currentBranchId]);\r\n\r\n  const getDefaultSize = React.useCallback((type: TemplateType): PaperSize => {\r\n    return templateStore.getDefaultSize(type);\r\n  }, [templateStore]);\r\n\r\n  return {\r\n    print,\r\n    printMultiple,\r\n    printMixedDocuments,\r\n    getPreview,\r\n    hasTemplate,\r\n    getAvailableSizes,\r\n    getDefaultSize,\r\n    isLoading,\r\n  };\r\n}\r\n\r\nexport type { PrintOptions, UsePrintResult };\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2303, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/types.ts"],"sourcesContent":["/**\r\n * Print Mappers - Shared Types\r\n * Types và utilities dùng chung cho tất cả mappers\r\n */\r\n\r\nexport { \r\n  formatCurrency, \r\n  numberToWords, \r\n  formatDate, \r\n  formatTime,\r\n  getStoreData,\r\n} from '../print-service';\r\n\r\nexport type { \r\n  PrintData, \r\n  PrintLineItem, \r\n  StoreSettings\r\n} from '../print-service';\r\n\r\n/**\r\n * Helper: Ẩn 4 số giữa của SĐT\r\n * VD: 0912345678 -> 0912***678\r\n */\r\nexport const hidePhoneMiddle = (phone?: string): string => {\r\n  if (!phone || phone.length < 8) return phone || '';\r\n  return phone.slice(0, 4) + '***' + phone.slice(-3);\r\n};\r\n\r\n/**\r\n * Helper: Format ngày dạng chữ\r\n * VD: 05/12/2025 -> Ngày 05 tháng 12 năm 2025\r\n * Note: This is a specific Vietnamese text format, not using date-utils\r\n */\r\nexport const formatDateText = (date?: string | Date): string => {\r\n  if (!date) return '';\r\n  const d = typeof date === 'string' ? new Date(date) : date;\r\n  if (isNaN(d.getTime())) return '';\r\n  const day = d.getDate();\r\n  const month = d.getMonth() + 1;\r\n  const year = d.getFullYear();\r\n  return `Ngày ${day} tháng ${month} năm ${year}`;\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;;;CAGC,GAED;;AAkBO,MAAM,kBAAkB,CAAC;IAC9B,IAAI,CAAC,SAAS,MAAM,MAAM,GAAG,GAAG,OAAO,SAAS;IAChD,OAAO,MAAM,KAAK,CAAC,GAAG,KAAK,QAAQ,MAAM,KAAK,CAAC,CAAC;AAClD;AAOO,MAAM,iBAAiB,CAAC;IAC7B,IAAI,CAAC,MAAM,OAAO;IAClB,MAAM,IAAI,OAAO,SAAS,WAAW,IAAI,KAAK,QAAQ;IACtD,IAAI,MAAM,EAAE,OAAO,KAAK,OAAO;IAC/B,MAAM,MAAM,EAAE,OAAO;IACrB,MAAM,QAAQ,EAAE,QAAQ,KAAK;IAC7B,MAAM,OAAO,EAAE,WAAW;IAC1B,OAAO,CAAC,KAAK,EAAE,IAAI,OAAO,EAAE,MAAM,KAAK,EAAE,MAAM;AACjD"}},
    {"offset": {"line": 2331, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/packing.mapper.ts"],"sourcesContent":["/**\r\n * Packing Mapper - Phiếu đóng gói\r\n * Đồng bộ với variables/phieu-dong-goi.ts\r\n * \r\n * Variables coverage: 100%\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatCurrency,\r\n  formatDate,\r\n  formatTime,\r\n  hidePhoneMiddle,\r\n  numberToWords,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface PackingForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  createdAt: string | Date;\r\n  modifiedAt?: string | Date;\r\n  packedAt?: string | Date;\r\n  shippedAt?: string | Date;\r\n  createdBy?: string;\r\n  orderCode: string;\r\n  \r\n  // Trạng thái\r\n  fulfillmentStatus?: string;\r\n  \r\n  // NV được gán\r\n  assignedEmployee?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    province?: string;\r\n    country?: string;\r\n    phone?: string;\r\n  };\r\n  \r\n  // Thông tin khách hàng\r\n  customerName: string;\r\n  customerCode?: string;\r\n  customerPhone?: string;\r\n  customerPhoneHide?: boolean;\r\n  customerEmail?: string;\r\n  customerAddress?: string;\r\n  billingAddress?: string;\r\n  \r\n  // Thông tin giao hàng\r\n  shippingAddress: string;\r\n  shippingProvince?: string;\r\n  shippingDistrict?: string;\r\n  shippingWard?: string;\r\n  \r\n  // Ghi chú\r\n  note?: string;\r\n  packageNote?: string;\r\n  orderNote?: string;\r\n  \r\n  // Danh sách sản phẩm\r\n  items: Array<{\r\n    variantCode?: string;\r\n    productName: string;\r\n    productNameVariantName?: string;\r\n    variantName?: string;\r\n    barcode?: string;\r\n    unit?: string;\r\n    quantity: number;\r\n    price?: number;\r\n    priceAfterDiscount?: number;\r\n    discountRate?: number;\r\n    discountAmount?: number;\r\n    taxRate?: number;\r\n    taxAmount?: number;\r\n    taxIncluded?: number;\r\n    taxExclude?: number;\r\n    taxName?: string;\r\n    amount?: number;\r\n    brand?: string;\r\n    category?: string;\r\n    variantOptions?: string;\r\n    weight?: number;\r\n    weightUnit?: string;\r\n    binLocation?: string;\r\n    note?: string;\r\n    // Lot/Serial\r\n    serial?: string;\r\n    lotNumber?: string;\r\n    lotWithQty?: string;\r\n    lotWithDates?: string;\r\n    lotWithDatesQty?: string;\r\n    // Composite\r\n    compositeVariantCode?: string;\r\n    compositeVariantName?: string;\r\n    compositeUnit?: string;\r\n    compositeQuantity?: number;\r\n  }>;\r\n  \r\n  // Composite fields (legacy)\r\n  compositeItems?: Array<{\r\n    productName: string;\r\n    compositeComponents?: Array<{\r\n      componentName: string;\r\n      quantity: number;\r\n    }>;\r\n  }>;\r\n  \r\n  // Tổng giá trị\r\n  totalQuantity?: number;\r\n  subtotal?: number;\r\n  totalDiscount?: number;\r\n  fulfillmentDiscount?: number;\r\n  totalTax?: number;\r\n  totalExtraTax?: number;\r\n  totalTaxIncludedLine?: number;\r\n  totalAmountBeforeTax?: number;\r\n  totalAmountAfterTax?: number;\r\n  total?: number;\r\n  totalAmount?: number;\r\n  totalWeight?: number;\r\n  codAmount?: number;\r\n}\r\n\r\nexport function mapPackingToPrintData(packing: PackingForPrint, storeSettings: StoreSettings): PrintData {\r\n  const phone = packing.customerPhoneHide \r\n    ? hidePhoneMiddle(packing.customerPhone || '')\r\n    : (packing.customerPhone || '');\r\n  \r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CỬA HÀNG / CHI NHÁNH ===\r\n    '{location_name}': packing.location?.name || storeSettings.name || '',\r\n    '{location_address}': packing.location?.address || storeSettings.address || '',\r\n    '{location_province}': packing.location?.province || '',\r\n    '{location_country}': packing.location?.country || 'Việt Nam',\r\n    '{location_phone}': packing.location?.phone || storeSettings.phone || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === THÔNG TIN PHIẾU ĐÓNG GÓI ===\r\n    '{fulfillment_code}': packing.code,\r\n    '{packing_code}': packing.code,\r\n    '{order_code}': packing.orderCode,\r\n    '{created_on}': formatDate(packing.createdAt),\r\n    '{created_on_time}': formatTime(packing.createdAt),\r\n    '{modified_on}': formatDate(packing.modifiedAt),\r\n    '{modified_on_time}': formatTime(packing.modifiedAt),\r\n    '{packed_on}': formatDate(packing.packedAt),\r\n    '{packed_on_time}': formatTime(packing.packedAt),\r\n    '{shipped_on}': formatDate(packing.shippedAt),\r\n    '{shipped_on_time}': formatTime(packing.shippedAt),\r\n    '{account_name}': packing.createdBy || '',\r\n    '{assigned_employee}': packing.assignedEmployee || '',\r\n    '{fulfillment_status}': packing.fulfillmentStatus || '',\r\n    \r\n    // === THÔNG TIN KHÁCH HÀNG ===\r\n    '{customer_name}': packing.customerName,\r\n    '{customer_code}': packing.customerCode || '',\r\n    '{customer_phone}': phone,\r\n    '{customer_phone_number}': phone,\r\n    '{customer_phone_number_hide}': hidePhoneMiddle(packing.customerPhone || ''),\r\n    '{customer_email}': packing.customerEmail || '',\r\n    '{customer_address}': packing.customerAddress || '',\r\n    '{billing_address}': packing.billingAddress || '',\r\n    \r\n    // === THÔNG TIN GIAO HÀNG ===\r\n    '{shipping_address}': packing.shippingAddress,\r\n    '{shipping_province}': packing.shippingProvince || '',\r\n    '{shipping_district}': packing.shippingDistrict || '',\r\n    '{shipping_ward}': packing.shippingWard || '',\r\n    \r\n    // === TỔNG GIÁ TRỊ ===\r\n    '{total_quantity}': (packing.totalQuantity ?? 0).toString(),\r\n    '{subtotal}': formatCurrency(packing.subtotal || 0),\r\n    '{total_discounts}': formatCurrency(packing.totalDiscount || 0),\r\n    '{fulfillment_discount}': formatCurrency(packing.fulfillmentDiscount || packing.totalDiscount || 0),\r\n    '{total_tax}': formatCurrency(packing.totalTax || 0),\r\n    '{total_extra_tax}': formatCurrency(packing.totalExtraTax || 0),\r\n    '{total_tax_included_line}': formatCurrency(packing.totalTaxIncludedLine || 0),\r\n    '{total_amount_before_tax}': formatCurrency(packing.totalAmountBeforeTax || 0),\r\n    '{total_amount_after_tax}': formatCurrency(packing.totalAmountAfterTax || 0),\r\n    '{total}': formatCurrency(packing.total || 0),\r\n    '{total_amount}': formatCurrency(packing.totalAmount || packing.total || 0),\r\n    '{total_amount_text}': numberToWords(packing.totalAmount || packing.total || 0),\r\n    '{total_weight}': packing.totalWeight?.toString() || '',\r\n    '{cod}': formatCurrency(packing.codAmount),\r\n    '{cod_amount}': formatCurrency(packing.codAmount || 0),\r\n    '{cod_amount_text}': numberToWords(packing.codAmount || 0),\r\n    \r\n    // === GHI CHÚ ===\r\n    '{packing_note}': packing.note || '',\r\n    '{package_note}': packing.packageNote || packing.note || '',\r\n    '{note}': packing.note || '',\r\n    '{order_note}': packing.orderNote || '',\r\n  };\r\n}\r\n\r\nexport function mapPackingLineItems(items: PackingForPrint['items']): PrintLineItem[] {\r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_variant_code}': item.variantCode || '',\r\n    '{line_product_name}': item.productName,\r\n    '{line_product_name_variant_name}': item.productNameVariantName || `${item.productName}${item.variantName ? ' - ' + item.variantName : ''}`,\r\n    '{line_variant}': item.variantName || '',\r\n    '{line_variant_name}': item.variantName || '',\r\n    '{line_variant_barcode}': item.barcode || '',\r\n    '{line_unit}': item.unit || 'Cái',\r\n    '{line_quantity}': item.quantity.toString(),\r\n    '{line_price}': formatCurrency(item.price || 0),\r\n    '{line_price_after_discount}': formatCurrency(item.priceAfterDiscount || item.price || 0),\r\n    '{line_discount_rate}': item.discountRate ? `${item.discountRate}%` : '',\r\n    '{line_discount_amount}': formatCurrency(item.discountAmount),\r\n    '{line_tax_rate}': item.taxRate ? `${item.taxRate}%` : '',\r\n    '{line_tax_amount}': formatCurrency(item.taxAmount),\r\n    '{line_tax_included}': formatCurrency(item.taxIncluded || 0),\r\n    '{line_tax_exclude}': formatCurrency(item.taxExclude || 0),\r\n    '{line_tax}': item.taxName || '',\r\n    '{line_amount}': formatCurrency(item.amount || 0),\r\n    '{line_product_brand}': item.brand || '',\r\n    '{line_brand}': item.brand || '',\r\n    '{line_product_category}': item.category || '',\r\n    '{line_category}': item.category || '',\r\n    '{line_variant_options}': item.variantOptions || '',\r\n    '{line_weight}': item.weight?.toString() || '',\r\n    '{line_weight_unit}': item.weightUnit || 'g',\r\n    '{bin_location}': item.binLocation || '',\r\n    '{line_note}': item.note || '',\r\n    // Serial/Lot\r\n    '{serials}': item.serial || '',\r\n    '{lots_number_code1}': item.lotNumber || '',\r\n    '{lots_number_code2}': item.lotWithQty || '',\r\n    '{lots_number_code3}': item.lotWithDates || '',\r\n    '{lots_number_code4}': item.lotWithDatesQty || '',\r\n    // Composite\r\n    '{line_composite_variant_code}': item.compositeVariantCode || '',\r\n    '{line_composite_variant_name}': item.compositeVariantName || '',\r\n    '{line_composite_unit}': item.compositeUnit || '',\r\n    '{line_composite_quantity}': item.compositeQuantity?.toString() || '',\r\n  }));\r\n}\r\n\r\nexport function mapPackingCompositeLineItems(compositeItems: PackingForPrint['compositeItems']): PrintLineItem[] {\r\n  if (!compositeItems) return [];\r\n  \r\n  const results: PrintLineItem[] = [];\r\n  let stt = 1;\r\n  \r\n  for (const item of compositeItems) {\r\n    if (item.compositeComponents) {\r\n      for (const component of item.compositeComponents) {\r\n        results.push({\r\n          '{line_stt}': stt.toString(),\r\n          '{composite_product_name}': item.productName,\r\n          '{composite_component_name}': component.componentName,\r\n          '{composite_quantity}': component.quantity.toString(),\r\n        });\r\n        stt++;\r\n      }\r\n    }\r\n  }\r\n  \r\n  return results;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2477, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/shipping-label.mapper.ts"],"sourcesContent":["/**\r\n * Shipping Label Mapper - Nhãn giao hàng\r\n * Đồng bộ với variables/nhan-giao-hang.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  formatCurrency,\r\n  formatDate,\r\n  formatTime,\r\n  getStoreData,\r\n  StoreSettings,\r\n  hidePhoneMiddle\r\n} from './types';\r\n\r\n// Helper function để tạo barcode image\r\nfunction generateBarcodeImage(code: string | undefined, height = 50): string {\r\n  if (!code) return '';\r\n  // Sử dụng barcodeapi.org - CODE128 format\r\n  return `<img src=\"https://barcodeapi.org/api/128/${encodeURIComponent(code)}\" style=\"height:${height}px\" alt=\"barcode\"/>`;\r\n}\r\n\r\n// Helper function để tạo QR code image  \r\nfunction generateQRCodeImage(code: string | undefined, size = 100): string {\r\n  if (!code) return '';\r\n  // Sử dụng quickchart.io cho QR code\r\n  return `<img src=\"https://quickchart.io/qr?text=${encodeURIComponent(code)}&size=${size}\" style=\"width:${size}px;height:${size}px\" alt=\"qrcode\"/>`;\r\n}\r\n\r\nexport interface ShippingLabelForPrint {\r\n  // Thông tin đơn hàng\r\n  orderCode: string;\r\n  orderQrCode?: string;\r\n  orderBarCode?: string;\r\n  createdAt?: string | Date;\r\n  modifiedAt?: string | Date;\r\n  receivedOn?: string | Date;\r\n  packedOn?: string | Date;\r\n  shippedOn?: string | Date;\r\n  createdBy?: string;\r\n  creatorName?: string;\r\n  status?: string;\r\n  pushingStatus?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    phone?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // Thông tin khách hàng\r\n  customerName: string;\r\n  customerPhone?: string;\r\n  customerEmail?: string;\r\n  shippingAddress: string;\r\n  billingAddress?: string;\r\n  city?: string;\r\n  district?: string;\r\n  \r\n  // Thông tin người nhận\r\n  receiverName?: string;\r\n  receiverPhone?: string;\r\n  \r\n  // Thông tin vận chuyển\r\n  trackingCode?: string;\r\n  trackingQrCode?: string;\r\n  trackingBarCode?: string;\r\n  carrierName?: string;\r\n  deliveryType?: string;\r\n  serviceName?: string;\r\n  partnerType?: string;\r\n  partnerPhone?: string;\r\n  \r\n  // VNPost\r\n  vnpostCrmCode?: string;\r\n  vnpostCrmBarCode?: string;\r\n  \r\n  // Sapo Express\r\n  routeCodeSe?: string;\r\n  sortingCode?: string;\r\n  sortingCodeBarCode?: string;\r\n  \r\n  // Ngày giao\r\n  shipOnMin?: string | Date;\r\n  shipOnMax?: string | Date;\r\n  \r\n  // Giá trị\r\n  totalItems: number;\r\n  total?: number;\r\n  totalTax?: number;\r\n  deliveryFee?: number;\r\n  codAmount?: number;\r\n  totalAmount?: number;\r\n  fulfillmentDiscount?: number;\r\n  freightAmount?: number;\r\n  shipperDeposits?: number;\r\n  packingWeight?: number;\r\n  \r\n  reasonCancel?: string;\r\n  note?: string;\r\n}\r\n\r\nexport function mapShippingLabelToPrintData(label: ShippingLabelForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': label.location?.name || storeSettings.name || '',\r\n    '{location_address}': label.location?.address || storeSettings.address || '',\r\n    '{location_phone_number}': label.location?.phone || storeSettings.phone || '',\r\n    '{location_province}': label.location?.province || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === THÔNG TIN ĐƠN HÀNG ===\r\n    '{order_code}': label.orderCode,\r\n    '{order_qr_code}': label.orderQrCode ? `<img src=\"${label.orderQrCode}\" style=\"max-width:100px;max-height:100px\"/>` : '',\r\n    '{order_bar_code}': label.orderBarCode ? `<img src=\"${label.orderBarCode}\" style=\"max-height:50px\"/>` : '',\r\n    '{created_on}': formatDate(label.createdAt),\r\n    '{created_on_time}': formatTime(label.createdAt),\r\n    '{modified_on}': formatDate(label.modifiedAt),\r\n    '{modified_on_time}': formatTime(label.modifiedAt),\r\n    '{received_on}': formatDate(label.receivedOn),\r\n    '{received_on_time}': formatTime(label.receivedOn),\r\n    '{packed_on}': formatDate(label.packedOn),\r\n    '{packed_on_time}': formatTime(label.packedOn),\r\n    '{shipped_on_time}': formatTime(label.shippedOn),\r\n    '{account_name}': label.createdBy || '',\r\n    '{creator_name}': label.creatorName || label.createdBy || '',\r\n    '{status}': label.status || '',\r\n    '{pushing_status}': label.pushingStatus || '',\r\n    \r\n    // === THÔNG TIN KHÁCH HÀNG ===\r\n    '{customer_name}': label.customerName,\r\n    '{customer_phone_number}': label.customerPhone || '',\r\n    '{customer_phone_number_hide}': hidePhoneMiddle(label.customerPhone),\r\n    '{customer_email}': label.customerEmail || '',\r\n    '{shipping_address}': label.shippingAddress,\r\n    '{billing_address}': label.billingAddress || '',\r\n    '{city}': label.city || '',\r\n    '{district}': label.district || '',\r\n    \r\n    // === THÔNG TIN NGƯỜI NHẬN ===\r\n    '{receiver_name}': label.receiverName || label.customerName,\r\n    '{receiver_phone}': label.receiverPhone || label.customerPhone || '',\r\n    '{receiver_phone_hide}': hidePhoneMiddle(label.receiverPhone || label.customerPhone),\r\n    \r\n    // === THÔNG TIN VẬN CHUYỂN ===\r\n    '{tracking_number}': label.trackingCode || '',\r\n    '{shipment_code}': label.trackingCode || '',\r\n    '{shipment_barcode}': generateBarcodeImage(label.trackingCode, 50),\r\n    '{shipment_qrcode}': generateQRCodeImage(label.trackingCode, 100),\r\n    '{tracking_number_qr_code}': label.trackingQrCode ? `<img src=\"${label.trackingQrCode}\" style=\"max-width:100px;max-height:100px\"/>` : generateQRCodeImage(label.trackingCode, 100),\r\n    '{tracking_number_bar_code}': label.trackingBarCode ? `<img src=\"${label.trackingBarCode}\" style=\"max-height:50px\"/>` : generateBarcodeImage(label.trackingCode, 50),\r\n    '{delivery_service_provider}': label.carrierName || '',\r\n    '{partner_name}': label.carrierName || '',\r\n    '{delivery_type}': label.deliveryType || '',\r\n    '{service_name}': label.serviceName || '',\r\n    '{partner_type}': label.partnerType || '',\r\n    '{partner_phone_number}': label.partnerPhone || '',\r\n    \r\n    // === VNPOST ===\r\n    '{vnpost_crm_code}': label.vnpostCrmCode || '',\r\n    '{vnpost_crm_bar_code}': label.vnpostCrmBarCode ? `<img src=\"${label.vnpostCrmBarCode}\" style=\"max-height:50px\"/>` : '',\r\n    \r\n    // === SAPO EXPRESS ===\r\n    '{route_code_se}': label.routeCodeSe || '',\r\n    '{sorting_code}': label.sortingCode || '',\r\n    '{sorting_code_bar_code}': label.sortingCodeBarCode ? `<img src=\"${label.sortingCodeBarCode}\" style=\"max-height:50px\"/>` : '',\r\n    \r\n    // === NGÀY GIAO ===\r\n    '{ship_on_min}': formatDate(label.shipOnMin),\r\n    '{ship_on_max}': formatDate(label.shipOnMax),\r\n    \r\n    // === TỔNG GIÁ TRỊ ===\r\n    '{total_quantity}': label.totalItems.toString(),\r\n    '{total}': formatCurrency(label.total),\r\n    '{total_tax}': formatCurrency(label.totalTax),\r\n    '{delivery_fee}': formatCurrency(label.deliveryFee),\r\n    '{cod_amount}': formatCurrency(label.codAmount),\r\n    '{cod}': formatCurrency(label.codAmount), // Alias cho template\r\n    '{total_amount}': formatCurrency(label.totalAmount),\r\n    '{fulfillment_discount}': formatCurrency(label.fulfillmentDiscount),\r\n    '{freight_amount}': formatCurrency(label.freightAmount),\r\n    '{shipper_deposits}': formatCurrency(label.shipperDeposits),\r\n    '{packing_weight}': label.packingWeight?.toString() || '',\r\n    // Khối lượng - đổi đơn vị\r\n    '{total_weight_g}': label.packingWeight ? Math.round(label.packingWeight * 1000).toString() : '0',\r\n    '{total_weight_kg}': label.packingWeight?.toString() || '0',\r\n    \r\n    '{reason_cancel}': label.reasonCancel || '',\r\n    '{shipment_note}': label.note || '',\r\n    '{note}': label.note || '', // Alias cho template\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GAED;AAAA;;AAUA,uCAAuC;AACvC,SAAS,qBAAqB,IAAwB,EAAE,SAAS,EAAE;IACjE,IAAI,CAAC,MAAM,OAAO;IAClB,0CAA0C;IAC1C,OAAO,CAAC,yCAAyC,EAAE,mBAAmB,MAAM,gBAAgB,EAAE,OAAO,mBAAmB,CAAC;AAC3H;AAEA,yCAAyC;AACzC,SAAS,oBAAoB,IAAwB,EAAE,OAAO,GAAG;IAC/D,IAAI,CAAC,MAAM,OAAO;IAClB,oCAAoC;IACpC,OAAO,CAAC,wCAAwC,EAAE,mBAAmB,MAAM,MAAM,EAAE,KAAK,eAAe,EAAE,KAAK,UAAU,EAAE,KAAK,kBAAkB,CAAC;AACpJ;AA6EO,SAAS,4BAA4B,KAA4B,EAAE,aAA4B;IACpG,OAAO;QACL,GAAG,IAAA,uIAAY,EAAC,cAAc;QAE9B,8BAA8B;QAC9B,mBAAmB,MAAM,QAAQ,EAAE,QAAQ,cAAc,IAAI,IAAI;QACjE,sBAAsB,MAAM,QAAQ,EAAE,WAAW,cAAc,OAAO,IAAI;QAC1E,2BAA2B,MAAM,QAAQ,EAAE,SAAS,cAAc,KAAK,IAAI;QAC3E,uBAAuB,MAAM,QAAQ,EAAE,YAAY;QACnD,oBAAoB,cAAc,QAAQ,IAAI;QAE9C,6BAA6B;QAC7B,gBAAgB,MAAM,SAAS;QAC/B,mBAAmB,MAAM,WAAW,GAAG,CAAC,UAAU,EAAE,MAAM,WAAW,CAAC,4CAA4C,CAAC,GAAG;QACtH,oBAAoB,MAAM,YAAY,GAAG,CAAC,UAAU,EAAE,MAAM,YAAY,CAAC,2BAA2B,CAAC,GAAG;QACxG,gBAAgB,IAAA,qIAAU,EAAC,MAAM,SAAS;QAC1C,qBAAqB,IAAA,qIAAU,EAAC,MAAM,SAAS;QAC/C,iBAAiB,IAAA,qIAAU,EAAC,MAAM,UAAU;QAC5C,sBAAsB,IAAA,qIAAU,EAAC,MAAM,UAAU;QACjD,iBAAiB,IAAA,qIAAU,EAAC,MAAM,UAAU;QAC5C,sBAAsB,IAAA,qIAAU,EAAC,MAAM,UAAU;QACjD,eAAe,IAAA,qIAAU,EAAC,MAAM,QAAQ;QACxC,oBAAoB,IAAA,qIAAU,EAAC,MAAM,QAAQ;QAC7C,qBAAqB,IAAA,qIAAU,EAAC,MAAM,SAAS;QAC/C,kBAAkB,MAAM,SAAS,IAAI;QACrC,kBAAkB,MAAM,WAAW,IAAI,MAAM,SAAS,IAAI;QAC1D,YAAY,MAAM,MAAM,IAAI;QAC5B,oBAAoB,MAAM,aAAa,IAAI;QAE3C,+BAA+B;QAC/B,mBAAmB,MAAM,YAAY;QACrC,2BAA2B,MAAM,aAAa,IAAI;QAClD,gCAAgC,IAAA,mKAAe,EAAC,MAAM,aAAa;QACnE,oBAAoB,MAAM,aAAa,IAAI;QAC3C,sBAAsB,MAAM,eAAe;QAC3C,qBAAqB,MAAM,cAAc,IAAI;QAC7C,UAAU,MAAM,IAAI,IAAI;QACxB,cAAc,MAAM,QAAQ,IAAI;QAEhC,+BAA+B;QAC/B,mBAAmB,MAAM,YAAY,IAAI,MAAM,YAAY;QAC3D,oBAAoB,MAAM,aAAa,IAAI,MAAM,aAAa,IAAI;QAClE,yBAAyB,IAAA,mKAAe,EAAC,MAAM,aAAa,IAAI,MAAM,aAAa;QAEnF,+BAA+B;QAC/B,qBAAqB,MAAM,YAAY,IAAI;QAC3C,mBAAmB,MAAM,YAAY,IAAI;QACzC,sBAAsB,qBAAqB,MAAM,YAAY,EAAE;QAC/D,qBAAqB,oBAAoB,MAAM,YAAY,EAAE;QAC7D,6BAA6B,MAAM,cAAc,GAAG,CAAC,UAAU,EAAE,MAAM,cAAc,CAAC,4CAA4C,CAAC,GAAG,oBAAoB,MAAM,YAAY,EAAE;QAC9K,8BAA8B,MAAM,eAAe,GAAG,CAAC,UAAU,EAAE,MAAM,eAAe,CAAC,2BAA2B,CAAC,GAAG,qBAAqB,MAAM,YAAY,EAAE;QACjK,+BAA+B,MAAM,WAAW,IAAI;QACpD,kBAAkB,MAAM,WAAW,IAAI;QACvC,mBAAmB,MAAM,YAAY,IAAI;QACzC,kBAAkB,MAAM,WAAW,IAAI;QACvC,kBAAkB,MAAM,WAAW,IAAI;QACvC,0BAA0B,MAAM,YAAY,IAAI;QAEhD,iBAAiB;QACjB,qBAAqB,MAAM,aAAa,IAAI;QAC5C,yBAAyB,MAAM,gBAAgB,GAAG,CAAC,UAAU,EAAE,MAAM,gBAAgB,CAAC,2BAA2B,CAAC,GAAG;QAErH,uBAAuB;QACvB,mBAAmB,MAAM,WAAW,IAAI;QACxC,kBAAkB,MAAM,WAAW,IAAI;QACvC,2BAA2B,MAAM,kBAAkB,GAAG,CAAC,UAAU,EAAE,MAAM,kBAAkB,CAAC,2BAA2B,CAAC,GAAG;QAE3H,oBAAoB;QACpB,iBAAiB,IAAA,qIAAU,EAAC,MAAM,SAAS;QAC3C,iBAAiB,IAAA,qIAAU,EAAC,MAAM,SAAS;QAE3C,uBAAuB;QACvB,oBAAoB,MAAM,UAAU,CAAC,QAAQ;QAC7C,WAAW,IAAA,yIAAc,EAAC,MAAM,KAAK;QACrC,eAAe,IAAA,yIAAc,EAAC,MAAM,QAAQ;QAC5C,kBAAkB,IAAA,yIAAc,EAAC,MAAM,WAAW;QAClD,gBAAgB,IAAA,yIAAc,EAAC,MAAM,SAAS;QAC9C,SAAS,IAAA,yIAAc,EAAC,MAAM,SAAS;QACvC,kBAAkB,IAAA,yIAAc,EAAC,MAAM,WAAW;QAClD,0BAA0B,IAAA,yIAAc,EAAC,MAAM,mBAAmB;QAClE,oBAAoB,IAAA,yIAAc,EAAC,MAAM,aAAa;QACtD,sBAAsB,IAAA,yIAAc,EAAC,MAAM,eAAe;QAC1D,oBAAoB,MAAM,aAAa,EAAE,cAAc;QACvD,0BAA0B;QAC1B,oBAAoB,MAAM,aAAa,GAAG,KAAK,KAAK,CAAC,MAAM,aAAa,GAAG,MAAM,QAAQ,KAAK;QAC9F,qBAAqB,MAAM,aAAa,EAAE,cAAc;QAExD,mBAAmB,MAAM,YAAY,IAAI;QACzC,mBAAmB,MAAM,IAAI,IAAI;QACjC,UAAU,MAAM,IAAI,IAAI;IAC1B;AACF"}},
    {"offset": {"line": 2585, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/delivery.mapper.ts"],"sourcesContent":["/**\r\n * Delivery Mapper - Phiếu giao hàng\r\n * Đồng bộ với variables/phieu-giao-hang.ts\r\n * \r\n * Variables coverage: 100%\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatCurrency,\r\n  formatDate,\r\n  formatTime,\r\n  numberToWords,\r\n  getStoreData,\r\n  StoreSettings,\r\n  hidePhoneMiddle\r\n} from './types';\r\n\r\n// Helper function để tạo barcode image\r\nfunction generateBarcodeImage(code: string | undefined, height = 50): string {\r\n  if (!code) return '';\r\n  return `<img src=\"https://barcodeapi.org/api/128/${encodeURIComponent(code)}\" style=\"height:${height}px\" alt=\"barcode\"/>`;\r\n}\r\n\r\n// Helper function để tạo QR code image  \r\nfunction generateQRCodeImage(code: string | undefined, size = 100): string {\r\n  if (!code) return '';\r\n  return `<img src=\"https://quickchart.io/qr?text=${encodeURIComponent(code)}&size=${size}\" style=\"width:${size}px;height:${size}px\" alt=\"qrcode\"/>`;\r\n}\r\n\r\nexport interface DeliveryForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  orderCode: string;\r\n  createdAt: string | Date;\r\n  shippedAt?: string | Date;\r\n  createdBy?: string;\r\n  shipperName?: string;\r\n  deliveryStatus?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    phone?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // Thông tin vận chuyển\r\n  trackingCode?: string;\r\n  carrierName?: string;\r\n  deliveryType?: string;\r\n  serviceName?: string;\r\n  \r\n  // Thông tin khách hàng\r\n  customerName: string;\r\n  customerCode?: string;\r\n  customerPhone?: string;\r\n  customerEmail?: string;\r\n  \r\n  // Thông tin người nhận\r\n  receiverName?: string;\r\n  receiverPhone?: string;\r\n  shippingAddress: string;\r\n  city?: string;\r\n  district?: string;\r\n  ward?: string;\r\n  \r\n  // Danh sách sản phẩm\r\n  items: Array<{\r\n    variantCode?: string;\r\n    productName: string;\r\n    variantName?: string;\r\n    barcode?: string;\r\n    unit?: string;\r\n    quantity: number;\r\n    price?: number;\r\n    amount?: number;\r\n    weight?: number;\r\n    note?: string;\r\n    serial?: string;\r\n    lotNumber?: string;\r\n  }>;\r\n  \r\n  // Tổng giá trị\r\n  totalQuantity?: number;\r\n  totalWeight?: number;\r\n  subtotal?: number;\r\n  deliveryFee?: number;\r\n  codAmount?: number;\r\n  totalAmount?: number;\r\n  \r\n  note?: string;\r\n}\r\n\r\nexport function mapDeliveryToPrintData(delivery: DeliveryForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CỬA HÀNG / CHI NHÁNH ===\r\n    '{location_name}': delivery.location?.name || storeSettings.name || '',\r\n    '{location_address}': delivery.location?.address || storeSettings.address || '',\r\n    '{location_phone_number}': delivery.location?.phone || storeSettings.phone || '',\r\n    '{location_province}': delivery.location?.province || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === THÔNG TIN PHIẾU GIAO HÀNG ===\r\n    '{delivery_code}': delivery.code,\r\n    '{order_code}': delivery.orderCode,\r\n    '{order_qr_code}': generateQRCodeImage(delivery.orderCode, 100),\r\n    '{order_bar_code}': generateBarcodeImage(delivery.orderCode, 50),\r\n    '{created_on}': formatDate(delivery.createdAt),\r\n    '{created_on_time}': formatTime(delivery.createdAt),\r\n    '{shipped_on}': formatDate(delivery.shippedAt),\r\n    '{shipped_on_time}': formatTime(delivery.shippedAt),\r\n    '{account_name}': delivery.createdBy || '',\r\n    '{shipper_name}': delivery.shipperName || '',\r\n    '{delivery_status}': delivery.deliveryStatus || '',\r\n    \r\n    // === THÔNG TIN VẬN CHUYỂN ===\r\n    '{tracking_number}': delivery.trackingCode || '',\r\n    '{tracking_number_qr_code}': generateQRCodeImage(delivery.trackingCode, 100),\r\n    '{tracking_number_bar_code}': generateBarcodeImage(delivery.trackingCode, 50),\r\n    '{shipment_barcode}': generateBarcodeImage(delivery.trackingCode, 50),\r\n    '{shipment_qrcode}': generateQRCodeImage(delivery.trackingCode, 100),\r\n    '{carrier_name}': delivery.carrierName || '',\r\n    '{partner_name}': delivery.carrierName || '',\r\n    '{delivery_type}': delivery.deliveryType || '',\r\n    '{service_name}': delivery.serviceName || '',\r\n    \r\n    // === THÔNG TIN KHÁCH HÀNG ===\r\n    '{customer_name}': delivery.customerName,\r\n    '{customer_code}': delivery.customerCode || '',\r\n    '{customer_phone_number}': delivery.customerPhone || '',\r\n    '{customer_phone_number_hide}': hidePhoneMiddle(delivery.customerPhone),\r\n    '{customer_email}': delivery.customerEmail || '',\r\n    \r\n    // === THÔNG TIN NGƯỜI NHẬN ===\r\n    '{receiver_name}': delivery.receiverName || delivery.customerName,\r\n    '{receiver_phone}': delivery.receiverPhone || delivery.customerPhone || '',\r\n    '{receiver_phone_hide}': hidePhoneMiddle(delivery.receiverPhone || delivery.customerPhone),\r\n    '{shipping_address}': delivery.shippingAddress,\r\n    '{city}': delivery.city || '',\r\n    '{district}': delivery.district || '',\r\n    '{ward}': delivery.ward || '',\r\n    \r\n    // === TỔNG GIÁ TRỊ ===\r\n    '{total_quantity}': (delivery.totalQuantity ?? 0).toString(),\r\n    '{total_weight}': delivery.totalWeight?.toString() || '',\r\n    '{total}': formatCurrency(delivery.subtotal || 0),\r\n    '{delivery_fee}': formatCurrency(delivery.deliveryFee || 0),\r\n    '{cod_amount}': formatCurrency(delivery.codAmount || 0),\r\n    '{cod_amount_text}': numberToWords(delivery.codAmount || 0),\r\n    '{total_amount}': formatCurrency(delivery.totalAmount || 0),\r\n    '{total_text}': numberToWords(delivery.totalAmount || 0),\r\n    \r\n    '{note}': delivery.note || '',\r\n  };\r\n}\r\n\r\nexport function mapDeliveryLineItems(items: DeliveryForPrint['items']): PrintLineItem[] {\r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_variant_code}': item.variantCode || '',\r\n    '{line_product_name}': item.productName,\r\n    '{line_variant}': item.variantName || '',\r\n    '{line_variant_barcode}': item.barcode || '',\r\n    '{line_unit}': item.unit || 'Cái',\r\n    '{line_quantity}': item.quantity.toString(),\r\n    '{line_price}': formatCurrency(item.price || 0),\r\n    '{line_amount}': formatCurrency(item.amount || 0),\r\n    '{line_weight}': item.weight?.toString() || '',\r\n    '{line_note}': item.note || '',\r\n    '{serials}': item.serial || '',\r\n    '{lots_number_code1}': item.lotNumber || '',\r\n  }));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2687, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/receipt.mapper.ts"],"sourcesContent":["/**\r\n * Receipt Mapper - Phiếu thu\r\n * Đồng bộ với variables/phieu-thu.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  formatCurrency, \r\n  numberToWords, \r\n  formatDate,\r\n  formatTime,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface ReceiptForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  createdAt: string | Date;\r\n  issuedAt?: string | Date;\r\n  createdBy?: string;\r\n  \r\n  // Thông tin người nộp\r\n  payerName: string;\r\n  payerPhone?: string;\r\n  payerAddress?: string;\r\n  payerType?: string; // Loại người nộp (KH, NCC, Khác)\r\n  \r\n  // Thông tin phiếu\r\n  groupName?: string; // Loại phiếu thu\r\n  description?: string;\r\n  amount: number;\r\n  paymentMethod?: string;\r\n  reference?: string;\r\n  documentRootCode?: string; // Chứng từ gốc\r\n  counted?: boolean; // Hạch toán KQKD\r\n  note?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // Nợ khách hàng\r\n  customerDebtBefore?: number;\r\n  customerDebtAfter?: number;\r\n  customerDebt?: number;\r\n  customerDebtPrev?: number;\r\n  \r\n  // Nợ nhà cung cấp\r\n  supplierDebtBefore?: number;\r\n  supplierDebtAfter?: number;\r\n  supplierDebt?: number;\r\n  supplierDebtPrev?: number;\r\n}\r\n\r\nexport function mapReceiptToPrintData(receipt: ReceiptForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': receipt.location?.name || storeSettings.name || '',\r\n    '{location_address}': receipt.location?.address || storeSettings.address || '',\r\n    '{location_province}': receipt.location?.province || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === THÔNG TIN PHIẾU THU ===\r\n    '{receipt_voucher_code}': receipt.code,\r\n    '{receipt_barcode}': `<img src=\"https://barcodeapi.org/api/128/${encodeURIComponent(receipt.code)}\" style=\"height:40px\"/>`,\r\n    '{created_on}': formatDate(receipt.createdAt),\r\n    '{issued_on}': formatDate(receipt.issuedAt || receipt.createdAt),\r\n    '{issued_on_time}': formatTime(receipt.issuedAt || receipt.createdAt),\r\n    '{account_name}': receipt.createdBy || '',\r\n    '{group_name}': receipt.groupName || '',\r\n    '{counted}': receipt.counted ? 'Có' : 'Không',\r\n    \r\n    // === THÔNG TIN NGƯỜI NỘP ===\r\n    '{object_name}': receipt.payerName,\r\n    '{object_phone_number}': receipt.payerPhone || '',\r\n    '{object_address}': receipt.payerAddress || '',\r\n    '{object_type}': receipt.payerType || '',\r\n    \r\n    // === GIÁ TRỊ ===\r\n    '{amount}': formatCurrency(receipt.amount),\r\n    '{amount_text}': numberToWords(receipt.amount),\r\n    '{total_text}': numberToWords(receipt.amount),\r\n    '{payment_method_name}': receipt.paymentMethod || 'Tiền mặt',\r\n    '{payment_method}': receipt.paymentMethod || 'Tiền mặt', // Alias for template compatibility\r\n    '{reference}': receipt.reference || '',\r\n    '{document_root_code}': receipt.documentRootCode || '',\r\n    '{note}': receipt.note || '',\r\n    '{description}': receipt.description || receipt.note || '', // Map description for template\r\n    \r\n    // === NỢ KHÁCH HÀNG ===\r\n    '{customer_debt}': formatCurrency(receipt.customerDebt),\r\n    '{customer_debt_text}': numberToWords(receipt.customerDebt || 0),\r\n    '{customer_debt_prev}': formatCurrency(receipt.customerDebtPrev),\r\n    '{customer_debt_prev_text}': numberToWords(receipt.customerDebtPrev || 0),\r\n    '{customer_debt_before_create_receipt}': formatCurrency(receipt.customerDebtBefore),\r\n    '{customer_debt_before_create_receipt_text}': numberToWords(receipt.customerDebtBefore || 0),\r\n    '{customer_debt_after_create_receipt}': formatCurrency(receipt.customerDebtAfter),\r\n    '{customer_debt_after_create_receipt_text}': numberToWords(receipt.customerDebtAfter || 0),\r\n    \r\n    // === NỢ NHÀ CUNG CẤP ===\r\n    '{supplier_debt}': formatCurrency(receipt.supplierDebt),\r\n    '{supplier_debt_text}': numberToWords(receipt.supplierDebt || 0),\r\n    '{supplier_debt_prev}': formatCurrency(receipt.supplierDebtPrev),\r\n    '{supplier_debt_prev_text}': numberToWords(receipt.supplierDebtPrev || 0),\r\n    '{supplier_debt_before_create_receipt}': formatCurrency(receipt.supplierDebtBefore),\r\n    '{supplier_debt_before_create_receipt_text}': numberToWords(receipt.supplierDebtBefore || 0),\r\n    '{supplier_debt_after_create_receipt}': formatCurrency(receipt.supplierDebtAfter),\r\n    '{supplier_debt_after_create_receipt_text}': numberToWords(receipt.supplierDebtAfter || 0),\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GAED;AAAA;;AAqDO,SAAS,sBAAsB,OAAwB,EAAE,aAA4B;IAC1F,OAAO;QACL,GAAG,IAAA,uIAAY,EAAC,cAAc;QAE9B,8BAA8B;QAC9B,mBAAmB,QAAQ,QAAQ,EAAE,QAAQ,cAAc,IAAI,IAAI;QACnE,sBAAsB,QAAQ,QAAQ,EAAE,WAAW,cAAc,OAAO,IAAI;QAC5E,uBAAuB,QAAQ,QAAQ,EAAE,YAAY;QACrD,oBAAoB,cAAc,QAAQ,IAAI;QAE9C,8BAA8B;QAC9B,0BAA0B,QAAQ,IAAI;QACtC,qBAAqB,CAAC,yCAAyC,EAAE,mBAAmB,QAAQ,IAAI,EAAE,uBAAuB,CAAC;QAC1H,gBAAgB,IAAA,qIAAU,EAAC,QAAQ,SAAS;QAC5C,eAAe,IAAA,qIAAU,EAAC,QAAQ,QAAQ,IAAI,QAAQ,SAAS;QAC/D,oBAAoB,IAAA,qIAAU,EAAC,QAAQ,QAAQ,IAAI,QAAQ,SAAS;QACpE,kBAAkB,QAAQ,SAAS,IAAI;QACvC,gBAAgB,QAAQ,SAAS,IAAI;QACrC,aAAa,QAAQ,OAAO,GAAG,OAAO;QAEtC,8BAA8B;QAC9B,iBAAiB,QAAQ,SAAS;QAClC,yBAAyB,QAAQ,UAAU,IAAI;QAC/C,oBAAoB,QAAQ,YAAY,IAAI;QAC5C,iBAAiB,QAAQ,SAAS,IAAI;QAEtC,kBAAkB;QAClB,YAAY,IAAA,yIAAc,EAAC,QAAQ,MAAM;QACzC,iBAAiB,IAAA,wIAAa,EAAC,QAAQ,MAAM;QAC7C,gBAAgB,IAAA,wIAAa,EAAC,QAAQ,MAAM;QAC5C,yBAAyB,QAAQ,aAAa,IAAI;QAClD,oBAAoB,QAAQ,aAAa,IAAI;QAC7C,eAAe,QAAQ,SAAS,IAAI;QACpC,wBAAwB,QAAQ,gBAAgB,IAAI;QACpD,UAAU,QAAQ,IAAI,IAAI;QAC1B,iBAAiB,QAAQ,WAAW,IAAI,QAAQ,IAAI,IAAI;QAExD,wBAAwB;QACxB,mBAAmB,IAAA,yIAAc,EAAC,QAAQ,YAAY;QACtD,wBAAwB,IAAA,wIAAa,EAAC,QAAQ,YAAY,IAAI;QAC9D,wBAAwB,IAAA,yIAAc,EAAC,QAAQ,gBAAgB;QAC/D,6BAA6B,IAAA,wIAAa,EAAC,QAAQ,gBAAgB,IAAI;QACvE,yCAAyC,IAAA,yIAAc,EAAC,QAAQ,kBAAkB;QAClF,8CAA8C,IAAA,wIAAa,EAAC,QAAQ,kBAAkB,IAAI;QAC1F,wCAAwC,IAAA,yIAAc,EAAC,QAAQ,iBAAiB;QAChF,6CAA6C,IAAA,wIAAa,EAAC,QAAQ,iBAAiB,IAAI;QAExF,0BAA0B;QAC1B,mBAAmB,IAAA,yIAAc,EAAC,QAAQ,YAAY;QACtD,wBAAwB,IAAA,wIAAa,EAAC,QAAQ,YAAY,IAAI;QAC9D,wBAAwB,IAAA,yIAAc,EAAC,QAAQ,gBAAgB;QAC/D,6BAA6B,IAAA,wIAAa,EAAC,QAAQ,gBAAgB,IAAI;QACvE,yCAAyC,IAAA,yIAAc,EAAC,QAAQ,kBAAkB;QAClF,8CAA8C,IAAA,wIAAa,EAAC,QAAQ,kBAAkB,IAAI;QAC1F,wCAAwC,IAAA,yIAAc,EAAC,QAAQ,iBAAiB;QAChF,6CAA6C,IAAA,wIAAa,EAAC,QAAQ,iBAAiB,IAAI;IAC1F;AACF"}},
    {"offset": {"line": 2753, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/payment.mapper.ts"],"sourcesContent":["/**\r\n * Payment Mapper - Phiếu chi\r\n * Đồng bộ với variables/phieu-chi.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  formatCurrency, \r\n  numberToWords, \r\n  formatDate,\r\n  formatTime,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\n// Helper function để tạo barcode image\r\nfunction generateBarcodeImage(code: string | undefined, height = 50): string {\r\n  if (!code) return '';\r\n  return `<img src=\"https://barcodeapi.org/api/128/${encodeURIComponent(code)}\" style=\"height:${height}px\" alt=\"barcode\"/>`;\r\n}\r\n\r\nexport interface PaymentForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  createdAt: string | Date;\r\n  issuedAt?: string | Date;\r\n  createdBy?: string;\r\n  \r\n  // Thông tin người nhận\r\n  recipientName: string;\r\n  recipientPhone?: string;\r\n  recipientAddress?: string;\r\n  recipientType?: string; // Loại người nhận (KH, NCC, Khác)\r\n  \r\n  // Thông tin phiếu\r\n  groupName?: string; // Loại phiếu chi\r\n  description?: string;\r\n  amount: number;\r\n  paymentMethod?: string;\r\n  reference?: string;\r\n  documentRootCode?: string; // Chứng từ gốc\r\n  counted?: boolean; // Hạch toán KQKD\r\n  note?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // Nợ khách hàng\r\n  customerDebtBefore?: number;\r\n  customerDebtAfter?: number;\r\n  customerDebt?: number;\r\n  customerDebtPrev?: number;\r\n  \r\n  // Nợ nhà cung cấp\r\n  supplierDebtBefore?: number;\r\n  supplierDebtAfter?: number;\r\n  supplierDebt?: number;\r\n  supplierDebtPrev?: number;\r\n}\r\n\r\nexport function mapPaymentToPrintData(payment: PaymentForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': payment.location?.name || storeSettings.name || '',\r\n    '{location_address}': payment.location?.address || storeSettings.address || '',\r\n    '{location_province}': payment.location?.province || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === THÔNG TIN PHIẾU CHI ===\r\n    '{payment_voucher_code}': payment.code,\r\n    '{payment_barcode}': generateBarcodeImage(payment.code),\r\n    '{created_on}': formatDate(payment.createdAt),\r\n    '{issued_on}': formatDate(payment.issuedAt || payment.createdAt),\r\n    '{issued_on_time}': formatTime(payment.issuedAt || payment.createdAt),\r\n    '{account_name}': payment.createdBy || '',\r\n    '{group_name}': payment.groupName || '',\r\n    '{counted}': payment.counted ? 'Có' : 'Không',\r\n    \r\n    // === THÔNG TIN NGƯỜI NHẬN ===\r\n    '{object_name}': payment.recipientName,\r\n    '{object_phone_number}': payment.recipientPhone || '',\r\n    '{object_address}': payment.recipientAddress || '',\r\n    '{object_type}': payment.recipientType || '',\r\n    \r\n    // === GIÁ TRỊ ===\r\n    '{amount}': formatCurrency(payment.amount),\r\n    '{amount_text}': numberToWords(payment.amount),\r\n    '{total_text}': numberToWords(payment.amount),\r\n    '{payment_method_name}': payment.paymentMethod || 'Tiền mặt',\r\n    '{payment_method}': payment.paymentMethod || 'Tiền mặt', // Alias for template compatibility\r\n    '{reference}': payment.reference || '',\r\n    '{document_root_code}': payment.documentRootCode || '',\r\n    '{note}': payment.note || '',\r\n    '{description}': payment.description || payment.note || '', // Map description for template\r\n    \r\n    // === NỢ KHÁCH HÀNG ===\r\n    '{customer_debt}': formatCurrency(payment.customerDebt),\r\n    '{customer_debt_text}': numberToWords(payment.customerDebt || 0),\r\n    '{customer_debt_prev}': formatCurrency(payment.customerDebtPrev),\r\n    '{customer_debt_prev_text}': numberToWords(payment.customerDebtPrev || 0),\r\n    '{customer_debt_before_create_payment}': formatCurrency(payment.customerDebtBefore),\r\n    '{customer_debt_before_create_payment_text}': numberToWords(payment.customerDebtBefore || 0),\r\n    '{customer_debt_after_create_payment}': formatCurrency(payment.customerDebtAfter),\r\n    '{customer_debt_after_create_payment_text}': numberToWords(payment.customerDebtAfter || 0),\r\n    \r\n    // === NỢ NHÀ CUNG CẤP ===\r\n    '{supplier_debt}': formatCurrency(payment.supplierDebt),\r\n    '{supplier_debt_text}': numberToWords(payment.supplierDebt || 0),\r\n    '{supplier_debt_prev}': formatCurrency(payment.supplierDebtPrev),\r\n    '{supplier_debt_prev_text}': numberToWords(payment.supplierDebtPrev || 0),\r\n    '{supplier_debt_before_create_payment}': formatCurrency(payment.supplierDebtBefore),\r\n    '{supplier_debt_before_create_payment_text}': numberToWords(payment.supplierDebtBefore || 0),\r\n    '{supplier_debt_after_create_payment}': formatCurrency(payment.supplierDebtAfter),\r\n    '{supplier_debt_after_create_payment_text}': numberToWords(payment.supplierDebtAfter || 0),\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GAED;AAAA;;AAUA,uCAAuC;AACvC,SAAS,qBAAqB,IAAwB,EAAE,SAAS,EAAE;IACjE,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO,CAAC,yCAAyC,EAAE,mBAAmB,MAAM,gBAAgB,EAAE,OAAO,mBAAmB,CAAC;AAC3H;AA6CO,SAAS,sBAAsB,OAAwB,EAAE,aAA4B;IAC1F,OAAO;QACL,GAAG,IAAA,uIAAY,EAAC,cAAc;QAE9B,8BAA8B;QAC9B,mBAAmB,QAAQ,QAAQ,EAAE,QAAQ,cAAc,IAAI,IAAI;QACnE,sBAAsB,QAAQ,QAAQ,EAAE,WAAW,cAAc,OAAO,IAAI;QAC5E,uBAAuB,QAAQ,QAAQ,EAAE,YAAY;QACrD,oBAAoB,cAAc,QAAQ,IAAI;QAE9C,8BAA8B;QAC9B,0BAA0B,QAAQ,IAAI;QACtC,qBAAqB,qBAAqB,QAAQ,IAAI;QACtD,gBAAgB,IAAA,qIAAU,EAAC,QAAQ,SAAS;QAC5C,eAAe,IAAA,qIAAU,EAAC,QAAQ,QAAQ,IAAI,QAAQ,SAAS;QAC/D,oBAAoB,IAAA,qIAAU,EAAC,QAAQ,QAAQ,IAAI,QAAQ,SAAS;QACpE,kBAAkB,QAAQ,SAAS,IAAI;QACvC,gBAAgB,QAAQ,SAAS,IAAI;QACrC,aAAa,QAAQ,OAAO,GAAG,OAAO;QAEtC,+BAA+B;QAC/B,iBAAiB,QAAQ,aAAa;QACtC,yBAAyB,QAAQ,cAAc,IAAI;QACnD,oBAAoB,QAAQ,gBAAgB,IAAI;QAChD,iBAAiB,QAAQ,aAAa,IAAI;QAE1C,kBAAkB;QAClB,YAAY,IAAA,yIAAc,EAAC,QAAQ,MAAM;QACzC,iBAAiB,IAAA,wIAAa,EAAC,QAAQ,MAAM;QAC7C,gBAAgB,IAAA,wIAAa,EAAC,QAAQ,MAAM;QAC5C,yBAAyB,QAAQ,aAAa,IAAI;QAClD,oBAAoB,QAAQ,aAAa,IAAI;QAC7C,eAAe,QAAQ,SAAS,IAAI;QACpC,wBAAwB,QAAQ,gBAAgB,IAAI;QACpD,UAAU,QAAQ,IAAI,IAAI;QAC1B,iBAAiB,QAAQ,WAAW,IAAI,QAAQ,IAAI,IAAI;QAExD,wBAAwB;QACxB,mBAAmB,IAAA,yIAAc,EAAC,QAAQ,YAAY;QACtD,wBAAwB,IAAA,wIAAa,EAAC,QAAQ,YAAY,IAAI;QAC9D,wBAAwB,IAAA,yIAAc,EAAC,QAAQ,gBAAgB;QAC/D,6BAA6B,IAAA,wIAAa,EAAC,QAAQ,gBAAgB,IAAI;QACvE,yCAAyC,IAAA,yIAAc,EAAC,QAAQ,kBAAkB;QAClF,8CAA8C,IAAA,wIAAa,EAAC,QAAQ,kBAAkB,IAAI;QAC1F,wCAAwC,IAAA,yIAAc,EAAC,QAAQ,iBAAiB;QAChF,6CAA6C,IAAA,wIAAa,EAAC,QAAQ,iBAAiB,IAAI;QAExF,0BAA0B;QAC1B,mBAAmB,IAAA,yIAAc,EAAC,QAAQ,YAAY;QACtD,wBAAwB,IAAA,wIAAa,EAAC,QAAQ,YAAY,IAAI;QAC9D,wBAAwB,IAAA,yIAAc,EAAC,QAAQ,gBAAgB;QAC/D,6BAA6B,IAAA,wIAAa,EAAC,QAAQ,gBAAgB,IAAI;QACvE,yCAAyC,IAAA,yIAAc,EAAC,QAAQ,kBAAkB;QAClF,8CAA8C,IAAA,wIAAa,EAAC,QAAQ,kBAAkB,IAAI;QAC1F,wCAAwC,IAAA,yIAAc,EAAC,QAAQ,iBAAiB;QAChF,6CAA6C,IAAA,wIAAa,EAAC,QAAQ,iBAAiB,IAAI;IAC1F;AACF"}},
    {"offset": {"line": 2824, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/utils/shipping-config-migration.ts"],"sourcesContent":["/**\r\n * Shipping Configuration Migration - V2 Multi-Account Structure\r\n * \r\n * NOTE: localStorage has been removed - all data comes from API/database\r\n */\r\n\r\nimport { ShippingConfig, GlobalShippingConfig, PartnerAccount } from '@/lib/types/shipping-config';\r\n\r\n// In-memory cache\r\nlet configCache: ShippingConfig | null = null;\r\n\r\n/**\r\n * Get default global config\r\n */\r\nfunction getDefaultGlobalConfig(): GlobalShippingConfig {\r\n  return {\r\n    weight: {\r\n      mode: 'FROM_PRODUCTS',\r\n      customValue: 500,\r\n    },\r\n    dimensions: {\r\n      length: 30,\r\n      width: 20,\r\n      height: 10,\r\n    },\r\n    requirement: 'ALLOW_CHECK_NOT_TRY',\r\n    note: '',\r\n    autoSyncCancelStatus: false,\r\n    autoSyncCODCollection: false,\r\n    latePickupWarningDays: 2,\r\n    lateDeliveryWarningDays: 7,\r\n  };\r\n}\r\n\r\n/**\r\n * Get default empty shipping config\r\n */\r\nexport function getDefaultShippingConfig(): ShippingConfig {\r\n  return {\r\n    version: 2,\r\n    partners: {\r\n      GHN: { accounts: [] },\r\n      GHTK: { accounts: [] },\r\n      VTP: { accounts: [] },\r\n      'J&T': { accounts: [] },\r\n      SPX: { accounts: [] },\r\n      VNPOST: { accounts: [] },\r\n      NINJA_VAN: { accounts: [] },\r\n      AHAMOVE: { accounts: [] },\r\n    },\r\n    global: getDefaultGlobalConfig(),\r\n    lastUpdated: new Date().toISOString(),\r\n  };\r\n}\r\n\r\n/**\r\n * Load shipping config from database (async)\r\n */\r\nexport async function loadShippingConfigAsync(): Promise<ShippingConfig> {\r\n  try {\r\n    const response = await fetch('/api/shipping-config');\r\n    if (!response.ok) throw new Error('Failed to fetch');\r\n    const config = await response.json();\r\n    configCache = config;\r\n    return config;\r\n  } catch (error) {\r\n    console.error('[ShippingConfig] Failed to load from database:', error);\r\n    // Return cached or default\r\n    return configCache ?? getDefaultShippingConfig();\r\n  }\r\n}\r\n\r\n/**\r\n * Load shipping config (sync) - returns cache or default\r\n */\r\nexport function loadShippingConfig(): ShippingConfig {\r\n  // Return cache if available\r\n  if (configCache) return configCache;\r\n  \r\n  // Return default - async load should be triggered on app init\r\n  return getDefaultShippingConfig();\r\n}\r\n\r\n/**\r\n * Save shipping config to database\r\n */\r\nexport function saveShippingConfig(config: ShippingConfig): void {\r\n  config.lastUpdated = new Date().toISOString();\r\n  \r\n  // Update cache\r\n  configCache = config;\r\n  \r\n  // Save to database\r\n  fetch('/api/shipping-config', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(config),\r\n  }).then(response => {\r\n    if (response.ok) {\r\n      console.log('✅ Shipping config saved to database');\r\n    } else {\r\n      console.warn('⚠️ Failed to save shipping config to database');\r\n    }\r\n  }).catch(error => {\r\n    console.error('❌ Error saving shipping config to database:', error);\r\n  });\r\n}\r\n\r\n/**\r\n * Get partner accounts\r\n */\r\nexport function getPartnerAccounts(\r\n  config: ShippingConfig,\r\n  partnerCode: keyof ShippingConfig['partners']\r\n): PartnerAccount[] {\r\n  return config.partners[partnerCode]?.accounts || [];\r\n}\r\n\r\n/**\r\n * Get default account for partner\r\n */\r\nexport function getDefaultAccount(\r\n  config: ShippingConfig,\r\n  partnerCode: keyof ShippingConfig['partners']\r\n): PartnerAccount | null {\r\n  const accounts = getPartnerAccounts(config, partnerCode);\r\n  const defaultAcc = accounts.find(acc => acc.isDefault && acc.active);\r\n  \r\n  if (defaultAcc) return defaultAcc;\r\n  \r\n  // Return first active account if no default\r\n  return accounts.find(acc => acc.active) || null;\r\n}\r\n\r\n/**\r\n * Add new account\r\n */\r\nexport function addPartnerAccount(\r\n  config: ShippingConfig,\r\n  partnerCode: keyof ShippingConfig['partners'],\r\n  account: Omit<PartnerAccount, 'id' | 'createdAt' | 'updatedAt'>\r\n): ShippingConfig {\r\n  const newAccount: PartnerAccount = {\r\n    ...account,\r\n    id: `acc_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n    createdAt: new Date().toISOString(),\r\n    updatedAt: new Date().toISOString(),\r\n  };\r\n  \r\n  config.partners[partnerCode].accounts.push(newAccount);\r\n  saveShippingConfig(config);\r\n  \r\n  return config;\r\n}\r\n\r\n/**\r\n * Update account\r\n */\r\nexport function updatePartnerAccount(\r\n  config: ShippingConfig,\r\n  partnerCode: keyof ShippingConfig['partners'],\r\n  accountId: string,\r\n  updates: Partial<PartnerAccount>\r\n): ShippingConfig {\r\n  const accounts = config.partners[partnerCode].accounts;\r\n  const index = accounts.findIndex(acc => acc.id === accountId);\r\n  \r\n  if (index !== -1) {\r\n    accounts[index] = {\r\n      ...accounts[index],\r\n      ...updates,\r\n      updatedAt: new Date().toISOString(),\r\n    };\r\n    \r\n    saveShippingConfig(config);\r\n  }\r\n  \r\n  return config;\r\n}\r\n\r\n/**\r\n * Delete account\r\n */\r\nexport function deletePartnerAccount(\r\n  config: ShippingConfig,\r\n  partnerCode: keyof ShippingConfig['partners'],\r\n  accountId: string\r\n): ShippingConfig {\r\n  const accounts = config.partners[partnerCode].accounts;\r\n  const account = accounts.find(acc => acc.id === accountId);\r\n  \r\n  // Remove the account\r\n  config.partners[partnerCode].accounts = accounts.filter(acc => acc.id !== accountId);\r\n  \r\n  // Set a new default if we deleted the default account\r\n  if (account?.isDefault && config.partners[partnerCode].accounts.length > 0) {\r\n    config.partners[partnerCode].accounts[0].isDefault = true;\r\n  }\r\n  \r\n  saveShippingConfig(config);\r\n  return config;\r\n}\r\n\r\n/**\r\n * Set default account\r\n */\r\nexport function setDefaultAccount(\r\n  config: ShippingConfig,\r\n  partnerCode: keyof ShippingConfig['partners'],\r\n  accountId: string\r\n): ShippingConfig {\r\n  const accounts = config.partners[partnerCode].accounts;\r\n  \r\n  // Remove default from all accounts\r\n  accounts.forEach(acc => {\r\n    acc.isDefault = false;\r\n  });\r\n  \r\n  // Set new default\r\n  const account = accounts.find(acc => acc.id === accountId);\r\n  if (account) {\r\n    account.isDefault = true;\r\n    account.updatedAt = new Date().toISOString();\r\n  }\r\n  \r\n  saveShippingConfig(config);\r\n  return config;\r\n}\r\n\r\n/**\r\n * Update global config\r\n */\r\nexport function updateGlobalConfig(\r\n  config: ShippingConfig,\r\n  updates: Partial<GlobalShippingConfig>\r\n): ShippingConfig {\r\n  config.global = {\r\n    ...config.global,\r\n    ...updates,\r\n  };\r\n  \r\n  saveShippingConfig(config);\r\n  return config;\r\n}\r\n\r\n/**\r\n * Export config as JSON\r\n */\r\nexport function exportShippingConfig(): string {\r\n  const config = loadShippingConfig();\r\n  return JSON.stringify(config, null, 2);\r\n}\r\n\r\n/**\r\n * Import config from JSON\r\n */\r\nexport function importShippingConfig(jsonString: string): ShippingConfig {\r\n  try {\r\n    const config = JSON.parse(jsonString);\r\n    \r\n    if (config.version !== 2) {\r\n      throw new Error('Invalid config version');\r\n    }\r\n    \r\n    saveShippingConfig(config);\r\n    return config;\r\n  } catch (error) {\r\n    console.error('Import failed:', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAID,kBAAkB;AAClB,IAAI,cAAqC;AAEzC;;CAEC,GACD,SAAS;IACP,OAAO;QACL,QAAQ;YACN,MAAM;YACN,aAAa;QACf;QACA,YAAY;YACV,QAAQ;YACR,OAAO;YACP,QAAQ;QACV;QACA,aAAa;QACb,MAAM;QACN,sBAAsB;QACtB,uBAAuB;QACvB,uBAAuB;QACvB,yBAAyB;IAC3B;AACF;AAKO,SAAS;IACd,OAAO;QACL,SAAS;QACT,UAAU;YACR,KAAK;gBAAE,UAAU,EAAE;YAAC;YACpB,MAAM;gBAAE,UAAU,EAAE;YAAC;YACrB,KAAK;gBAAE,UAAU,EAAE;YAAC;YACpB,OAAO;gBAAE,UAAU,EAAE;YAAC;YACtB,KAAK;gBAAE,UAAU,EAAE;YAAC;YACpB,QAAQ;gBAAE,UAAU,EAAE;YAAC;YACvB,WAAW;gBAAE,UAAU,EAAE;YAAC;YAC1B,SAAS;gBAAE,UAAU,EAAE;YAAC;QAC1B;QACA,QAAQ;QACR,aAAa,IAAI,OAAO,WAAW;IACrC;AACF;AAKO,eAAe;IACpB,IAAI;QACF,MAAM,WAAW,MAAM,MAAM;QAC7B,IAAI,CAAC,SAAS,EAAE,EAAE,MAAM,IAAI,MAAM;QAClC,MAAM,SAAS,MAAM,SAAS,IAAI;QAClC,cAAc;QACd,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kDAAkD;QAChE,2BAA2B;QAC3B,OAAO,eAAe;IACxB;AACF;AAKO,SAAS;IACd,4BAA4B;IAC5B,IAAI,aAAa,OAAO;IAExB,8DAA8D;IAC9D,OAAO;AACT;AAKO,SAAS,mBAAmB,MAAsB;IACvD,OAAO,WAAW,GAAG,IAAI,OAAO,WAAW;IAE3C,eAAe;IACf,cAAc;IAEd,mBAAmB;IACnB,MAAM,wBAAwB;QAC5B,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;IACvB,GAAG,IAAI,CAAC,CAAA;QACN,IAAI,SAAS,EAAE,EAAE;YACf,QAAQ,GAAG,CAAC;QACd,OAAO;YACL,QAAQ,IAAI,CAAC;QACf;IACF,GAAG,KAAK,CAAC,CAAA;QACP,QAAQ,KAAK,CAAC,+CAA+C;IAC/D;AACF;AAKO,SAAS,mBACd,MAAsB,EACtB,WAA6C;IAE7C,OAAO,OAAO,QAAQ,CAAC,YAAY,EAAE,YAAY,EAAE;AACrD;AAKO,SAAS,kBACd,MAAsB,EACtB,WAA6C;IAE7C,MAAM,WAAW,mBAAmB,QAAQ;IAC5C,MAAM,aAAa,SAAS,IAAI,CAAC,CAAA,MAAO,IAAI,SAAS,IAAI,IAAI,MAAM;IAEnE,IAAI,YAAY,OAAO;IAEvB,4CAA4C;IAC5C,OAAO,SAAS,IAAI,CAAC,CAAA,MAAO,IAAI,MAAM,KAAK;AAC7C;AAKO,SAAS,kBACd,MAAsB,EACtB,WAA6C,EAC7C,OAA+D;IAE/D,MAAM,aAA6B;QACjC,GAAG,OAAO;QACV,IAAI,CAAC,IAAI,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,IAAI;QAClE,WAAW,IAAI,OAAO,WAAW;QACjC,WAAW,IAAI,OAAO,WAAW;IACnC;IAEA,OAAO,QAAQ,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,CAAC;IAC3C,mBAAmB;IAEnB,OAAO;AACT;AAKO,SAAS,qBACd,MAAsB,EACtB,WAA6C,EAC7C,SAAiB,EACjB,OAAgC;IAEhC,MAAM,WAAW,OAAO,QAAQ,CAAC,YAAY,CAAC,QAAQ;IACtD,MAAM,QAAQ,SAAS,SAAS,CAAC,CAAA,MAAO,IAAI,EAAE,KAAK;IAEnD,IAAI,UAAU,CAAC,GAAG;QAChB,QAAQ,CAAC,MAAM,GAAG;YAChB,GAAG,QAAQ,CAAC,MAAM;YAClB,GAAG,OAAO;YACV,WAAW,IAAI,OAAO,WAAW;QACnC;QAEA,mBAAmB;IACrB;IAEA,OAAO;AACT;AAKO,SAAS,qBACd,MAAsB,EACtB,WAA6C,EAC7C,SAAiB;IAEjB,MAAM,WAAW,OAAO,QAAQ,CAAC,YAAY,CAAC,QAAQ;IACtD,MAAM,UAAU,SAAS,IAAI,CAAC,CAAA,MAAO,IAAI,EAAE,KAAK;IAEhD,qBAAqB;IACrB,OAAO,QAAQ,CAAC,YAAY,CAAC,QAAQ,GAAG,SAAS,MAAM,CAAC,CAAA,MAAO,IAAI,EAAE,KAAK;IAE1E,sDAAsD;IACtD,IAAI,SAAS,aAAa,OAAO,QAAQ,CAAC,YAAY,CAAC,QAAQ,CAAC,MAAM,GAAG,GAAG;QAC1E,OAAO,QAAQ,CAAC,YAAY,CAAC,QAAQ,CAAC,EAAE,CAAC,SAAS,GAAG;IACvD;IAEA,mBAAmB;IACnB,OAAO;AACT;AAKO,SAAS,kBACd,MAAsB,EACtB,WAA6C,EAC7C,SAAiB;IAEjB,MAAM,WAAW,OAAO,QAAQ,CAAC,YAAY,CAAC,QAAQ;IAEtD,mCAAmC;IACnC,SAAS,OAAO,CAAC,CAAA;QACf,IAAI,SAAS,GAAG;IAClB;IAEA,kBAAkB;IAClB,MAAM,UAAU,SAAS,IAAI,CAAC,CAAA,MAAO,IAAI,EAAE,KAAK;IAChD,IAAI,SAAS;QACX,QAAQ,SAAS,GAAG;QACpB,QAAQ,SAAS,GAAG,IAAI,OAAO,WAAW;IAC5C;IAEA,mBAAmB;IACnB,OAAO;AACT;AAKO,SAAS,mBACd,MAAsB,EACtB,OAAsC;IAEtC,OAAO,MAAM,GAAG;QACd,GAAG,OAAO,MAAM;QAChB,GAAG,OAAO;IACZ;IAEA,mBAAmB;IACnB,OAAO;AACT;AAKO,SAAS;IACd,MAAM,SAAS;IACf,OAAO,KAAK,SAAS,CAAC,QAAQ,MAAM;AACtC;AAKO,SAAS,qBAAqB,UAAkB;IACrD,IAAI;QACF,MAAM,SAAS,KAAK,KAAK,CAAC;QAE1B,IAAI,OAAO,OAAO,KAAK,GAAG;YACxB,MAAM,IAAI,MAAM;QAClB;QAEA,mBAAmB;QACnB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kBAAkB;QAChC,MAAM;IACR;AACF"}},
    {"offset": {"line": 3042, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/seed-audit.ts"],"sourcesContent":["import { asSystemId, type SystemId } from './id-types';\r\n\r\nexport const DEFAULT_SEED_AUTHOR = asSystemId('EMP000001');\r\n\r\ntype SeedAuditInput = {\r\n  createdAt: string;\r\n  createdBy?: SystemId;\r\n  updatedAt?: string;\r\n  updatedBy?: SystemId;\r\n};\r\n\r\nexport const buildSeedAuditFields = ({\r\n  createdAt,\r\n  createdBy = DEFAULT_SEED_AUTHOR,\r\n  updatedAt,\r\n  updatedBy,\r\n}: SeedAuditInput) => ({\r\n  createdAt,\r\n  updatedAt: updatedAt ?? createdAt,\r\n  createdBy,\r\n  updatedBy: updatedBy ?? createdBy,\r\n});\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,MAAM,sBAAsB,IAAA,gIAAU,EAAC;AASvC,MAAM,uBAAuB,CAAC,EACnC,SAAS,EACT,YAAY,mBAAmB,EAC/B,SAAS,EACT,SAAS,EACM,GAAK,CAAC;QACrB;QACA,WAAW,aAAa;QACxB;QACA,WAAW,aAAa;IAC1B,CAAC"}},
    {"offset": {"line": 3061, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/utils/get-shipping-credentials.ts"],"sourcesContent":["/**\r\n * Helper functions to get shipping partner credentials\r\n * Centralized source from shipping_partners_config (localStorage)\r\n */\r\n\r\nimport { loadShippingConfig } from './shipping-config-migration';\r\nimport type { PartnerAccount } from '../types/shipping-config';\r\n\r\nexport type ShippingCredentials = {\r\n  apiToken: string;\r\n  partnerCode: string;\r\n  account: PartnerAccount;\r\n};\r\n\r\n/**\r\n * Get GHTK credentials from config\r\n * @throws Error if no active account found\r\n */\r\nexport function getGHTKCredentials(): ShippingCredentials {\r\n  const config = loadShippingConfig();\r\n  const accounts = config.partners.GHTK.accounts;\r\n  \r\n  // Find default active account first, then any active account\r\n  const activeAccount = accounts.find(a => a.isDefault && a.active) \r\n                     || accounts.find(a => a.active);\r\n  \r\n  if (!activeAccount) {\r\n    throw new Error('Chưa cấu hình GHTK. Vui lòng vào Cài đặt → Đối tác vận chuyển.');\r\n  }\r\n  \r\n  if (!activeAccount.credentials?.apiToken) {\r\n    throw new Error('Tài khoản GHTK chưa có API Token. Vui lòng cấu hình lại.');\r\n  }\r\n  \r\n  return {\r\n    apiToken: activeAccount.credentials.apiToken,\r\n    partnerCode: (activeAccount.credentials as any).partnerCode || '',\r\n    account: activeAccount\r\n  };\r\n}\r\n\r\n/**\r\n * Get GHN credentials from config\r\n * @throws Error if no active account found\r\n */\r\nexport function getGHNCredentials(): ShippingCredentials {\r\n  const config = loadShippingConfig();\r\n  const accounts = config.partners.GHN.accounts;\r\n  \r\n  const activeAccount = accounts.find(a => a.isDefault && a.active) \r\n                     || accounts.find(a => a.active);\r\n  \r\n  if (!activeAccount) {\r\n    throw new Error('Chưa cấu hình GHN. Vui lòng vào Cài đặt → Đối tác vận chuyển.');\r\n  }\r\n  \r\n  if (!activeAccount.credentials?.apiToken) {\r\n    throw new Error('Tài khoản GHN chưa có API Token. Vui lòng cấu hình lại.');\r\n  }\r\n  \r\n  return {\r\n    apiToken: activeAccount.credentials.apiToken,\r\n    partnerCode: (activeAccount.credentials as any).partnerCode || '',\r\n    account: activeAccount\r\n  };\r\n}\r\n\r\n/**\r\n * Check if a partner has active account\r\n */\r\nexport function hasActiveAccount(partnerCode: 'GHTK' | 'GHN' | 'VTP' | 'J&T' | 'SPX'): boolean {\r\n  try {\r\n    const config = loadShippingConfig();\r\n    const accounts = config.partners[partnerCode].accounts;\r\n    return accounts.some(a => a.active);\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Get all active partners\r\n */\r\nexport function getActivePartners(): Array<'GHTK' | 'GHN' | 'VTP' | 'J&T' | 'SPX'> {\r\n  const partners: Array<'GHTK' | 'GHN' | 'VTP' | 'J&T' | 'SPX'> = ['GHTK', 'GHN', 'VTP', 'J&T', 'SPX'];\r\n  return partners.filter(p => hasActiveAccount(p));\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;CAGC,GAED;;AAaO,SAAS;IACd,MAAM,SAAS,IAAA,qKAAkB;IACjC,MAAM,WAAW,OAAO,QAAQ,CAAC,IAAI,CAAC,QAAQ;IAE9C,6DAA6D;IAC7D,MAAM,gBAAgB,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,SAAS,IAAI,EAAE,MAAM,KAC1C,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,MAAM;IAEjD,IAAI,CAAC,eAAe;QAClB,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI,CAAC,cAAc,WAAW,EAAE,UAAU;QACxC,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO;QACL,UAAU,cAAc,WAAW,CAAC,QAAQ;QAC5C,aAAa,AAAC,cAAc,WAAW,CAAS,WAAW,IAAI;QAC/D,SAAS;IACX;AACF;AAMO,SAAS;IACd,MAAM,SAAS,IAAA,qKAAkB;IACjC,MAAM,WAAW,OAAO,QAAQ,CAAC,GAAG,CAAC,QAAQ;IAE7C,MAAM,gBAAgB,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,SAAS,IAAI,EAAE,MAAM,KAC1C,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,MAAM;IAEjD,IAAI,CAAC,eAAe;QAClB,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI,CAAC,cAAc,WAAW,EAAE,UAAU;QACxC,MAAM,IAAI,MAAM;IAClB;IAEA,OAAO;QACL,UAAU,cAAc,WAAW,CAAC,QAAQ;QAC5C,aAAa,AAAC,cAAc,WAAW,CAAS,WAAW,IAAI;QAC/D,SAAS;IACX;AACF;AAKO,SAAS,iBAAiB,WAAmD;IAClF,IAAI;QACF,MAAM,SAAS,IAAA,qKAAkB;QACjC,MAAM,WAAW,OAAO,QAAQ,CAAC,YAAY,CAAC,QAAQ;QACtD,OAAO,SAAS,IAAI,CAAC,CAAA,IAAK,EAAE,MAAM;IACpC,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAKO,SAAS;IACd,MAAM,WAA0D;QAAC;QAAQ;QAAO;QAAO;QAAO;KAAM;IACpG,OAAO,SAAS,MAAM,CAAC,CAAA,IAAK,iBAAiB;AAC/C"}},
    {"offset": {"line": 3132, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/order.mapper.ts"],"sourcesContent":["/**\r\n * Order Mapper - Đơn bán hàng\r\n * Chuyển đổi Order entity sang format để in\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem, \r\n  formatCurrency, \r\n  numberToWords, \r\n  formatDate, \r\n  formatTime,\r\n  getStoreData,\r\n  StoreSettings,\r\n  hidePhoneMiddle,\r\n  formatDateText\r\n} from './types';\r\n\r\n// ============================================\r\n// INTERFACE\r\n// ============================================\r\n\r\nexport interface OrderForPrint {\r\n  // === THÔNG TIN CƠ BẢN ===\r\n  code: string;\r\n  createdAt: string | Date;\r\n  createdBy?: string;\r\n  modifiedAt?: string | Date;\r\n  issuedAt?: string | Date;\r\n  \r\n  // === NGUỒN / KÊNH ===\r\n  source?: string;\r\n  channel?: string;\r\n  reference?: string;\r\n  tags?: string[];\r\n  \r\n  // === TRẠNG THÁI ===\r\n  status?: string;\r\n  paymentStatus?: string;\r\n  fulfillmentStatus?: string;\r\n  packedStatus?: string;\r\n  returnStatus?: string;\r\n  \r\n  // === GIAO HÀNG ===\r\n  expectedDeliveryType?: string;\r\n  expectedPaymentMethod?: string;\r\n  shipOnMin?: string | Date;\r\n  shipOnMax?: string | Date;\r\n  shippedOn?: string | Date;\r\n  \r\n  // === PHỤ TRÁCH ===\r\n  assigneeName?: string;\r\n  \r\n  // === CHÍNH SÁCH ===\r\n  priceListName?: string;\r\n  currencyName?: string;\r\n  taxTreatment?: string;\r\n  \r\n  // === KHỐI LƯỢNG ===\r\n  totalWeightG?: number;\r\n  totalWeightKg?: number;\r\n  \r\n  // === CHI NHÁNH ===\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    phone?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // === KHÁCH HÀNG ===\r\n  customer?: {\r\n    name?: string;\r\n    code?: string;\r\n    phone?: string;\r\n    email?: string;\r\n    group?: string;\r\n    address?: string;\r\n    // Mở rộng\r\n    contactName?: string;\r\n    contactPhone?: string;\r\n    cardLevel?: string;\r\n    taxNumber?: string;\r\n    // Điểm tích lũy\r\n    currentPoint?: number;\r\n    pointUsed?: number;\r\n    pointEarned?: number;\r\n    pointBeforeOrder?: number;\r\n    pointAfterOrder?: number;\r\n    // Nợ\r\n    currentDebt?: number;\r\n    previousDebt?: number;\r\n    debtBeforeOrder?: number;\r\n    debtAfterOrder?: number;\r\n  };\r\n  \r\n  // === ĐỊA CHỈ ===\r\n  billingAddress?: string;\r\n  shippingAddress?: string;\r\n  recipient?: {\r\n    name?: string;\r\n    phone?: string;\r\n  };\r\n  \r\n  // === LINE ITEMS ===\r\n  items: Array<{\r\n    productName: string;\r\n    variantName?: string;\r\n    variantCode?: string;\r\n    barcode?: string;\r\n    imageUrl?: string;\r\n    unit?: string;\r\n    quantity: number;\r\n    price: number;\r\n    priceAfterDiscount?: number;\r\n    discountAmount?: number;\r\n    discountRate?: number;\r\n    taxAmount?: number;\r\n    taxRate?: number;\r\n    taxIncluded?: number;\r\n    taxExclude?: number;\r\n    amount: number;\r\n    amountBeforeDiscount?: number;\r\n    // Mở rộng\r\n    note?: string;\r\n    brand?: string;\r\n    category?: string;\r\n    description?: string;\r\n    weightG?: number;\r\n    variantOptions?: string;\r\n    binLocation?: string;\r\n    serial?: string;\r\n    lotNumber?: string;\r\n    lotInfo?: string;\r\n    warrantyPolicy?: string;\r\n    warrantyPeriod?: string;\r\n    compositeDetails?: string;\r\n    promotionInfo?: string;\r\n  }>;\r\n  \r\n  // === TỔNG GIÁ TRỊ ===\r\n  totalQuantity: number;\r\n  subtotal: number;\r\n  subtotalBeforeDiscount?: number;\r\n  totalLineItemDiscount?: number;\r\n  orderDiscount?: number;\r\n  orderDiscountRate?: number;\r\n  orderDiscountValue?: number;\r\n  totalDiscount?: number;\r\n  discountDetails?: string;\r\n  totalTax?: number;\r\n  totalExtraTax?: number;\r\n  totalTaxIncludedLine?: number;\r\n  totalAmountBeforeTax?: number;\r\n  totalAmountAfterTax?: number;\r\n  deliveryFee?: number;\r\n  total: number;\r\n  totalRemain?: number;\r\n  \r\n  // === THANH TOÁN ===\r\n  paymentMethod?: string;\r\n  paidAmount?: number;\r\n  changeAmount?: number;\r\n  payments?: Array<{\r\n    method: string;\r\n    amount: number;\r\n  }>;\r\n  paymentQrUrl?: string;\r\n  \r\n  // === KHUYẾN MẠI ===\r\n  promotionName?: string;\r\n  promotionCode?: string;\r\n  \r\n  note?: string;\r\n}\r\n\r\n// ============================================\r\n// MAPPER FUNCTIONS\r\n// ============================================\r\n\r\nexport function mapOrderToPrintData(order: OrderForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': order.location?.name || storeSettings.name || '',\r\n    '{location_address}': order.location?.address || storeSettings.address || '',\r\n    '{location_phone_number}': order.location?.phone || storeSettings.phone || '',\r\n    '{location_province}': order.location?.province || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === THÔNG TIN ĐƠN HÀNG ===\r\n    '{order_code}': order.code,\r\n    '{order_qr_code}': '', // Will be generated if needed\r\n    '{bar_code(code)}': `<img src=\"https://barcodeapi.org/api/128/${encodeURIComponent(order.code)}\" style=\"height:40px\"/>`,\r\n    '{created_on}': formatDate(order.createdAt),\r\n    '{created_on_time}': formatTime(order.createdAt),\r\n    '{created_on_text}': formatDateText(order.createdAt),\r\n    '{modified_on}': formatDate(order.modifiedAt),\r\n    '{modified_on_time}': formatTime(order.modifiedAt),\r\n    '{issued_on}': formatDate(order.issuedAt || order.createdAt),\r\n    '{issued_on_time}': formatTime(order.issuedAt || order.createdAt),\r\n    '{issued_on_text}': formatDateText(order.issuedAt || order.createdAt),\r\n    '{account_name}': order.createdBy || '',\r\n    '{assignee_name}': order.assigneeName || order.createdBy || '',\r\n    \r\n    // === TRẠNG THÁI ===\r\n    '{order_status}': order.status || '',\r\n    '{payment_status}': order.paymentStatus || '',\r\n    '{fulfillment_status}': order.fulfillmentStatus || '',\r\n    '{packed_status}': order.packedStatus || '',\r\n    '{return_status}': order.returnStatus || '',\r\n    \r\n    // === NGUỒN / KÊNH ===\r\n    '{source}': order.source || '',\r\n    '{channel}': order.channel || '',\r\n    '{reference}': order.reference || '',\r\n    '{tag}': order.tags?.join(', ') || '',\r\n    '{bar_code(reference_number)}': order.reference ? `<img src=\"https://barcodeapi.org/api/128/${encodeURIComponent(order.reference)}\" style=\"height:40px\"/>` : '',\r\n    \r\n    // === GIAO HÀNG ===\r\n    '{expected_delivery_type}': order.expectedDeliveryType || '',\r\n    '{expected_payment_method}': order.expectedPaymentMethod || '',\r\n    '{ship_on_min}': formatDate(order.shipOnMin),\r\n    '{ship_on_max}': formatDate(order.shipOnMax),\r\n    '{shipped_on}': formatDate(order.shippedOn),\r\n    \r\n    // === CHÍNH SÁCH ===\r\n    '{price_list_name}': order.priceListName || '',\r\n    '{currency_name}': order.currencyName || 'VND',\r\n    '{tax_treatment}': order.taxTreatment || '',\r\n    \r\n    // === KHỐI LƯỢNG ===\r\n    '{weight_g}': order.totalWeightG?.toString() || '0',\r\n    '{weight_kg}': order.totalWeightKg?.toString() || '0',\r\n    \r\n    // === THÔNG TIN KHÁCH HÀNG ===\r\n    '{customer_name}': order.customer?.name || '',\r\n    '{customer_code}': order.customer?.code || '',\r\n    '{customer_phone_number}': order.customer?.phone || '',\r\n    '{customer_phone_number_hide}': hidePhoneMiddle(order.customer?.phone),\r\n    '{customer_email}': order.customer?.email || '',\r\n    '{customer_group}': order.customer?.group || '',\r\n    '{customer_contact}': order.customer?.contactName || order.customer?.name || '',\r\n    '{customer_contact_phone_number}': order.customer?.contactPhone || order.customer?.phone || '',\r\n    '{customer_contact_phone_number_hide}': hidePhoneMiddle(order.customer?.contactPhone || order.customer?.phone),\r\n    '{customer_card}': order.customer?.cardLevel || '',\r\n    '{customer_tax_number}': order.customer?.taxNumber || '',\r\n    \r\n    // === ĐIỂM KHÁCH HÀNG ===\r\n    '{customer_point}': order.customer?.currentPoint?.toString() || '0',\r\n    '{customer_point_used}': order.customer?.pointUsed?.toString() || '0',\r\n    '{customer_point_new}': order.customer?.pointEarned?.toString() || '0',\r\n    '{customer_point_before_create_invoice}': order.customer?.pointBeforeOrder?.toString() || '0',\r\n    '{customer_point_after_create_invoice}': order.customer?.pointAfterOrder?.toString() || '0',\r\n    \r\n    // === NỢ KHÁCH HÀNG ===\r\n    '{customer_debt}': formatCurrency(order.customer?.currentDebt),\r\n    '{customer_debt_text}': numberToWords(order.customer?.currentDebt || 0),\r\n    '{customer_debt_prev}': formatCurrency(order.customer?.previousDebt),\r\n    '{customer_debt_prev_text}': numberToWords(order.customer?.previousDebt || 0),\r\n    '{debt_before_create_invoice}': formatCurrency(order.customer?.debtBeforeOrder || order.customer?.previousDebt),\r\n    '{debt_before_create_invoice_text}': numberToWords(order.customer?.debtBeforeOrder || order.customer?.previousDebt || 0),\r\n    '{debt_after_create_invoice}': formatCurrency(order.customer?.debtAfterOrder || order.customer?.currentDebt),\r\n    '{debt_after_create_invoice_text}': numberToWords(order.customer?.debtAfterOrder || order.customer?.currentDebt || 0),\r\n    '{total_amount_and_debt_before_create_invoice}': formatCurrency((order.customer?.debtBeforeOrder || 0) + order.total),\r\n    '{total_amount_and_debt_before_create_invoice_text}': numberToWords((order.customer?.debtBeforeOrder || 0) + order.total),\r\n    \r\n    // === ĐỊA CHỈ ===\r\n    '{billing_address}': order.billingAddress || order.customer?.address || '',\r\n    '{shipping_address}': order.shippingAddress || '',\r\n    '{shipping_address:full_name}': order.recipient?.name || order.customer?.name || '',\r\n    '{shipping_address:phone_number}': order.recipient?.phone || order.customer?.phone || '',\r\n    '{shipping_address:phone_number_hide}': hidePhoneMiddle(order.recipient?.phone || order.customer?.phone),\r\n    \r\n    // === TỔNG GIÁ TRỊ ===\r\n    '{total_quantity}': order.totalQuantity.toString(),\r\n    '{total}': formatCurrency(order.subtotal),\r\n    '{total_none_discount}': formatCurrency(order.subtotalBeforeDiscount || order.subtotal),\r\n    '{total_line_item_discount}': formatCurrency(order.totalLineItemDiscount),\r\n    '{product_discount}': formatCurrency(order.totalLineItemDiscount),\r\n    '{order_discount}': formatCurrency(order.orderDiscount),\r\n    '{order_discount_rate}': order.orderDiscountRate ? `${order.orderDiscountRate}%` : '',\r\n    '{order_discount_value}': formatCurrency(order.orderDiscountValue || order.orderDiscount),\r\n    '{total_discount}': formatCurrency(order.totalDiscount),\r\n    '{discount_details}': order.discountDetails || '',\r\n    '{total_tax}': formatCurrency(order.totalTax),\r\n    '{total_extra_tax}': formatCurrency(order.totalExtraTax),\r\n    '{total_tax_included_line}': formatCurrency(order.totalTaxIncludedLine),\r\n    '{total_amount_before_tax}': formatCurrency(order.totalAmountBeforeTax),\r\n    '{total_amount_after_tax}': formatCurrency(order.totalAmountAfterTax),\r\n    '{delivery_fee}': formatCurrency(order.deliveryFee),\r\n    '{total_amount}': formatCurrency(order.total),\r\n    '{total_text}': numberToWords(order.total),\r\n    '{total_remain}': formatCurrency(order.totalRemain),\r\n    '{total_remain_text}': numberToWords(order.totalRemain || 0),\r\n    \r\n    // === THANH TOÁN ===\r\n    '{payment_name}': order.paymentMethod || '',\r\n    '{payment_customer}': formatCurrency(order.paidAmount),\r\n    '{money_return}': formatCurrency(order.changeAmount),\r\n    '{payments}': order.payments?.map(p => `${p.method}: ${formatCurrency(p.amount)}`).join(', ') || '',\r\n    '{payment_qr}': order.paymentQrUrl ? `<img src=\"${order.paymentQrUrl}\" style=\"max-width:120px;max-height:120px\"/>` : '',\r\n    \r\n    // === KHUYẾN MẠI ===\r\n    '{promotion_name}': order.promotionName || '',\r\n    '{promotion_code}': order.promotionCode || '',\r\n    \r\n    '{order_note}': order.note || '',\r\n  };\r\n}\r\n\r\nexport function mapOrderLineItems(items: OrderForPrint['items']): PrintLineItem[] {\r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_product_name}': item.productName,\r\n    '{line_variant}': item.variantName || '',\r\n    '{line_variant_code}': item.variantCode || '',\r\n    '{line_variant_barcode}': item.barcode || '',\r\n    '{line_variant_barcode_image}': item.barcode ? `<img src=\"https://barcodeapi.org/api/128/${item.barcode}\" style=\"height:30px\"/>` : '',\r\n    '{line_variant_options}': item.variantOptions || '',\r\n    '{line_image}': item.imageUrl ? `<img src=\"${item.imageUrl}\" style=\"max-width:50px;max-height:50px\"/>` : '',\r\n    '{line_unit}': item.unit || 'Cái',\r\n    '{line_quantity}': item.quantity.toString(),\r\n    '{line_price}': formatCurrency(item.price),\r\n    '{line_price_after_discount}': formatCurrency(item.priceAfterDiscount || (item.amount / item.quantity)),\r\n    '{line_price_discount}': `${formatCurrency(item.priceAfterDiscount || item.price)} / ${formatCurrency(item.price)}`,\r\n    '{line_discount_amount}': formatCurrency(item.discountAmount),\r\n    '{line_discount_rate}': item.discountRate ? `${item.discountRate}%` : '',\r\n    '{line_tax_amount}': formatCurrency(item.taxAmount),\r\n    '{line_tax_rate}': item.taxRate ? `${item.taxRate}%` : '',\r\n    '{line_tax_included}': formatCurrency(item.taxIncluded),\r\n    '{line_tax_exclude}': formatCurrency(item.taxExclude),\r\n    '{line_amount}': formatCurrency(item.amount),\r\n    '{line_amount_none_discount}': formatCurrency(item.amountBeforeDiscount || (item.price * item.quantity)),\r\n    // Mở rộng\r\n    '{line_note}': item.note || '',\r\n    '{line_brand}': item.brand || '',\r\n    '{line_category}': item.category || '',\r\n    '{line_product_description}': item.description || '',\r\n    '{line_weight_g}': item.weightG?.toString() || '',\r\n    '{line_weight_kg}': item.weightG ? (item.weightG / 1000).toFixed(2) : '',\r\n    '{bin_location}': item.binLocation || '',\r\n    '{serials}': item.serial || '',\r\n    '{lots_number_code1}': item.lotNumber || '',\r\n    '{lots_number_code2}': '', // Mã lô - SL: sẽ được format từ data\r\n    '{lots_number_code3}': item.lotInfo || '',\r\n    '{lots_number_code4}': '', // Mã lô - NSX - NHH - SL: sẽ được format từ data\r\n    '{lots_number_combo}': '', // Mã lô combo: sẽ được format từ data\r\n    '{packsizes}': '', // Đơn vị quy đổi: sẽ được format từ data\r\n    '{term_name}': item.warrantyPolicy || '',\r\n    '{term_number}': item.warrantyPeriod || '',\r\n    '{term_name_combo}': '', // BH thành phần combo\r\n    '{term_number_combo}': '', // Thời hạn BH thành phần combo\r\n    '{composite_details}': item.compositeDetails || '',\r\n    '{line_promotion_or_loyalty}': item.promotionInfo || '',\r\n  }));\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;CAGC,GAED;AAAA;;AA+KO,SAAS,oBAAoB,KAAoB,EAAE,aAA4B;IACpF,OAAO;QACL,GAAG,IAAA,uIAAY,EAAC,cAAc;QAE9B,8BAA8B;QAC9B,mBAAmB,MAAM,QAAQ,EAAE,QAAQ,cAAc,IAAI,IAAI;QACjE,sBAAsB,MAAM,QAAQ,EAAE,WAAW,cAAc,OAAO,IAAI;QAC1E,2BAA2B,MAAM,QAAQ,EAAE,SAAS,cAAc,KAAK,IAAI;QAC3E,uBAAuB,MAAM,QAAQ,EAAE,YAAY;QACnD,oBAAoB,cAAc,QAAQ,IAAI;QAE9C,6BAA6B;QAC7B,gBAAgB,MAAM,IAAI;QAC1B,mBAAmB;QACnB,oBAAoB,CAAC,yCAAyC,EAAE,mBAAmB,MAAM,IAAI,EAAE,uBAAuB,CAAC;QACvH,gBAAgB,IAAA,qIAAU,EAAC,MAAM,SAAS;QAC1C,qBAAqB,IAAA,qIAAU,EAAC,MAAM,SAAS;QAC/C,qBAAqB,IAAA,kKAAc,EAAC,MAAM,SAAS;QACnD,iBAAiB,IAAA,qIAAU,EAAC,MAAM,UAAU;QAC5C,sBAAsB,IAAA,qIAAU,EAAC,MAAM,UAAU;QACjD,eAAe,IAAA,qIAAU,EAAC,MAAM,QAAQ,IAAI,MAAM,SAAS;QAC3D,oBAAoB,IAAA,qIAAU,EAAC,MAAM,QAAQ,IAAI,MAAM,SAAS;QAChE,oBAAoB,IAAA,kKAAc,EAAC,MAAM,QAAQ,IAAI,MAAM,SAAS;QACpE,kBAAkB,MAAM,SAAS,IAAI;QACrC,mBAAmB,MAAM,YAAY,IAAI,MAAM,SAAS,IAAI;QAE5D,qBAAqB;QACrB,kBAAkB,MAAM,MAAM,IAAI;QAClC,oBAAoB,MAAM,aAAa,IAAI;QAC3C,wBAAwB,MAAM,iBAAiB,IAAI;QACnD,mBAAmB,MAAM,YAAY,IAAI;QACzC,mBAAmB,MAAM,YAAY,IAAI;QAEzC,uBAAuB;QACvB,YAAY,MAAM,MAAM,IAAI;QAC5B,aAAa,MAAM,OAAO,IAAI;QAC9B,eAAe,MAAM,SAAS,IAAI;QAClC,SAAS,MAAM,IAAI,EAAE,KAAK,SAAS;QACnC,gCAAgC,MAAM,SAAS,GAAG,CAAC,yCAAyC,EAAE,mBAAmB,MAAM,SAAS,EAAE,uBAAuB,CAAC,GAAG;QAE7J,oBAAoB;QACpB,4BAA4B,MAAM,oBAAoB,IAAI;QAC1D,6BAA6B,MAAM,qBAAqB,IAAI;QAC5D,iBAAiB,IAAA,qIAAU,EAAC,MAAM,SAAS;QAC3C,iBAAiB,IAAA,qIAAU,EAAC,MAAM,SAAS;QAC3C,gBAAgB,IAAA,qIAAU,EAAC,MAAM,SAAS;QAE1C,qBAAqB;QACrB,qBAAqB,MAAM,aAAa,IAAI;QAC5C,mBAAmB,MAAM,YAAY,IAAI;QACzC,mBAAmB,MAAM,YAAY,IAAI;QAEzC,qBAAqB;QACrB,cAAc,MAAM,YAAY,EAAE,cAAc;QAChD,eAAe,MAAM,aAAa,EAAE,cAAc;QAElD,+BAA+B;QAC/B,mBAAmB,MAAM,QAAQ,EAAE,QAAQ;QAC3C,mBAAmB,MAAM,QAAQ,EAAE,QAAQ;QAC3C,2BAA2B,MAAM,QAAQ,EAAE,SAAS;QACpD,gCAAgC,IAAA,mKAAe,EAAC,MAAM,QAAQ,EAAE;QAChE,oBAAoB,MAAM,QAAQ,EAAE,SAAS;QAC7C,oBAAoB,MAAM,QAAQ,EAAE,SAAS;QAC7C,sBAAsB,MAAM,QAAQ,EAAE,eAAe,MAAM,QAAQ,EAAE,QAAQ;QAC7E,mCAAmC,MAAM,QAAQ,EAAE,gBAAgB,MAAM,QAAQ,EAAE,SAAS;QAC5F,wCAAwC,IAAA,mKAAe,EAAC,MAAM,QAAQ,EAAE,gBAAgB,MAAM,QAAQ,EAAE;QACxG,mBAAmB,MAAM,QAAQ,EAAE,aAAa;QAChD,yBAAyB,MAAM,QAAQ,EAAE,aAAa;QAEtD,0BAA0B;QAC1B,oBAAoB,MAAM,QAAQ,EAAE,cAAc,cAAc;QAChE,yBAAyB,MAAM,QAAQ,EAAE,WAAW,cAAc;QAClE,wBAAwB,MAAM,QAAQ,EAAE,aAAa,cAAc;QACnE,0CAA0C,MAAM,QAAQ,EAAE,kBAAkB,cAAc;QAC1F,yCAAyC,MAAM,QAAQ,EAAE,iBAAiB,cAAc;QAExF,wBAAwB;QACxB,mBAAmB,IAAA,yIAAc,EAAC,MAAM,QAAQ,EAAE;QAClD,wBAAwB,IAAA,wIAAa,EAAC,MAAM,QAAQ,EAAE,eAAe;QACrE,wBAAwB,IAAA,yIAAc,EAAC,MAAM,QAAQ,EAAE;QACvD,6BAA6B,IAAA,wIAAa,EAAC,MAAM,QAAQ,EAAE,gBAAgB;QAC3E,gCAAgC,IAAA,yIAAc,EAAC,MAAM,QAAQ,EAAE,mBAAmB,MAAM,QAAQ,EAAE;QAClG,qCAAqC,IAAA,wIAAa,EAAC,MAAM,QAAQ,EAAE,mBAAmB,MAAM,QAAQ,EAAE,gBAAgB;QACtH,+BAA+B,IAAA,yIAAc,EAAC,MAAM,QAAQ,EAAE,kBAAkB,MAAM,QAAQ,EAAE;QAChG,oCAAoC,IAAA,wIAAa,EAAC,MAAM,QAAQ,EAAE,kBAAkB,MAAM,QAAQ,EAAE,eAAe;QACnH,iDAAiD,IAAA,yIAAc,EAAC,CAAC,MAAM,QAAQ,EAAE,mBAAmB,CAAC,IAAI,MAAM,KAAK;QACpH,sDAAsD,IAAA,wIAAa,EAAC,CAAC,MAAM,QAAQ,EAAE,mBAAmB,CAAC,IAAI,MAAM,KAAK;QAExH,kBAAkB;QAClB,qBAAqB,MAAM,cAAc,IAAI,MAAM,QAAQ,EAAE,WAAW;QACxE,sBAAsB,MAAM,eAAe,IAAI;QAC/C,gCAAgC,MAAM,SAAS,EAAE,QAAQ,MAAM,QAAQ,EAAE,QAAQ;QACjF,mCAAmC,MAAM,SAAS,EAAE,SAAS,MAAM,QAAQ,EAAE,SAAS;QACtF,wCAAwC,IAAA,mKAAe,EAAC,MAAM,SAAS,EAAE,SAAS,MAAM,QAAQ,EAAE;QAElG,uBAAuB;QACvB,oBAAoB,MAAM,aAAa,CAAC,QAAQ;QAChD,WAAW,IAAA,yIAAc,EAAC,MAAM,QAAQ;QACxC,yBAAyB,IAAA,yIAAc,EAAC,MAAM,sBAAsB,IAAI,MAAM,QAAQ;QACtF,8BAA8B,IAAA,yIAAc,EAAC,MAAM,qBAAqB;QACxE,sBAAsB,IAAA,yIAAc,EAAC,MAAM,qBAAqB;QAChE,oBAAoB,IAAA,yIAAc,EAAC,MAAM,aAAa;QACtD,yBAAyB,MAAM,iBAAiB,GAAG,GAAG,MAAM,iBAAiB,CAAC,CAAC,CAAC,GAAG;QACnF,0BAA0B,IAAA,yIAAc,EAAC,MAAM,kBAAkB,IAAI,MAAM,aAAa;QACxF,oBAAoB,IAAA,yIAAc,EAAC,MAAM,aAAa;QACtD,sBAAsB,MAAM,eAAe,IAAI;QAC/C,eAAe,IAAA,yIAAc,EAAC,MAAM,QAAQ;QAC5C,qBAAqB,IAAA,yIAAc,EAAC,MAAM,aAAa;QACvD,6BAA6B,IAAA,yIAAc,EAAC,MAAM,oBAAoB;QACtE,6BAA6B,IAAA,yIAAc,EAAC,MAAM,oBAAoB;QACtE,4BAA4B,IAAA,yIAAc,EAAC,MAAM,mBAAmB;QACpE,kBAAkB,IAAA,yIAAc,EAAC,MAAM,WAAW;QAClD,kBAAkB,IAAA,yIAAc,EAAC,MAAM,KAAK;QAC5C,gBAAgB,IAAA,wIAAa,EAAC,MAAM,KAAK;QACzC,kBAAkB,IAAA,yIAAc,EAAC,MAAM,WAAW;QAClD,uBAAuB,IAAA,wIAAa,EAAC,MAAM,WAAW,IAAI;QAE1D,qBAAqB;QACrB,kBAAkB,MAAM,aAAa,IAAI;QACzC,sBAAsB,IAAA,yIAAc,EAAC,MAAM,UAAU;QACrD,kBAAkB,IAAA,yIAAc,EAAC,MAAM,YAAY;QACnD,cAAc,MAAM,QAAQ,EAAE,IAAI,CAAA,IAAK,GAAG,EAAE,MAAM,CAAC,EAAE,EAAE,IAAA,yIAAc,EAAC,EAAE,MAAM,GAAG,EAAE,KAAK,SAAS;QACjG,gBAAgB,MAAM,YAAY,GAAG,CAAC,UAAU,EAAE,MAAM,YAAY,CAAC,4CAA4C,CAAC,GAAG;QAErH,qBAAqB;QACrB,oBAAoB,MAAM,aAAa,IAAI;QAC3C,oBAAoB,MAAM,aAAa,IAAI;QAE3C,gBAAgB,MAAM,IAAI,IAAI;IAChC;AACF;AAEO,SAAS,kBAAkB,KAA6B;IAC7D,OAAO,MAAM,GAAG,CAAC,CAAC,MAAM,QAAU,CAAC;YACjC,cAAc,CAAC,QAAQ,CAAC,EAAE,QAAQ;YAClC,uBAAuB,KAAK,WAAW;YACvC,kBAAkB,KAAK,WAAW,IAAI;YACtC,uBAAuB,KAAK,WAAW,IAAI;YAC3C,0BAA0B,KAAK,OAAO,IAAI;YAC1C,gCAAgC,KAAK,OAAO,GAAG,CAAC,yCAAyC,EAAE,KAAK,OAAO,CAAC,uBAAuB,CAAC,GAAG;YACnI,0BAA0B,KAAK,cAAc,IAAI;YACjD,gBAAgB,KAAK,QAAQ,GAAG,CAAC,UAAU,EAAE,KAAK,QAAQ,CAAC,0CAA0C,CAAC,GAAG;YACzG,eAAe,KAAK,IAAI,IAAI;YAC5B,mBAAmB,KAAK,QAAQ,CAAC,QAAQ;YACzC,gBAAgB,IAAA,yIAAc,EAAC,KAAK,KAAK;YACzC,+BAA+B,IAAA,yIAAc,EAAC,KAAK,kBAAkB,IAAK,KAAK,MAAM,GAAG,KAAK,QAAQ;YACrG,yBAAyB,GAAG,IAAA,yIAAc,EAAC,KAAK,kBAAkB,IAAI,KAAK,KAAK,EAAE,GAAG,EAAE,IAAA,yIAAc,EAAC,KAAK,KAAK,GAAG;YACnH,0BAA0B,IAAA,yIAAc,EAAC,KAAK,cAAc;YAC5D,wBAAwB,KAAK,YAAY,GAAG,GAAG,KAAK,YAAY,CAAC,CAAC,CAAC,GAAG;YACtE,qBAAqB,IAAA,yIAAc,EAAC,KAAK,SAAS;YAClD,mBAAmB,KAAK,OAAO,GAAG,GAAG,KAAK,OAAO,CAAC,CAAC,CAAC,GAAG;YACvD,uBAAuB,IAAA,yIAAc,EAAC,KAAK,WAAW;YACtD,sBAAsB,IAAA,yIAAc,EAAC,KAAK,UAAU;YACpD,iBAAiB,IAAA,yIAAc,EAAC,KAAK,MAAM;YAC3C,+BAA+B,IAAA,yIAAc,EAAC,KAAK,oBAAoB,IAAK,KAAK,KAAK,GAAG,KAAK,QAAQ;YACtG,UAAU;YACV,eAAe,KAAK,IAAI,IAAI;YAC5B,gBAAgB,KAAK,KAAK,IAAI;YAC9B,mBAAmB,KAAK,QAAQ,IAAI;YACpC,8BAA8B,KAAK,WAAW,IAAI;YAClD,mBAAmB,KAAK,OAAO,EAAE,cAAc;YAC/C,oBAAoB,KAAK,OAAO,GAAG,CAAC,KAAK,OAAO,GAAG,IAAI,EAAE,OAAO,CAAC,KAAK;YACtE,kBAAkB,KAAK,WAAW,IAAI;YACtC,aAAa,KAAK,MAAM,IAAI;YAC5B,uBAAuB,KAAK,SAAS,IAAI;YACzC,uBAAuB;YACvB,uBAAuB,KAAK,OAAO,IAAI;YACvC,uBAAuB;YACvB,uBAAuB;YACvB,eAAe;YACf,eAAe,KAAK,cAAc,IAAI;YACtC,iBAAiB,KAAK,cAAc,IAAI;YACxC,qBAAqB;YACrB,uBAAuB;YACvB,uBAAuB,KAAK,gBAAgB,IAAI;YAChD,+BAA+B,KAAK,aAAa,IAAI;QACvD,CAAC;AACH"}},
    {"offset": {"line": 3310, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/quote.mapper.ts"],"sourcesContent":["/**\r\n * Quote Mapper - Phiếu đơn tạm tính / Báo giá\r\n * Đồng bộ với variables/phieu-don-tam-tinh.ts\r\n * \r\n * Note: Quote có cấu trúc gần giống Order nên share nhiều biến\r\n * Variables coverage: 100%\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatCurrency,\r\n  numberToWords,\r\n  formatDate,\r\n  formatTime,\r\n  formatDateText,\r\n  hidePhoneMiddle,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface QuoteForPrint {\r\n  // === THÔNG TIN CƠ BẢN ===\r\n  code: string;\r\n  createdAt: string | Date;\r\n  createdBy?: string;\r\n  modifiedAt?: string | Date;\r\n  issuedAt?: string | Date;\r\n  \r\n  // === NGUỒN / KÊNH ===\r\n  source?: string;\r\n  channel?: string;\r\n  reference?: string;\r\n  tags?: string[];\r\n  \r\n  // === TRẠNG THÁI ===\r\n  status?: string;\r\n  paymentStatus?: string;\r\n  fulfillmentStatus?: string;\r\n  packedStatus?: string;\r\n  returnStatus?: string;\r\n  \r\n  // === GIAO HÀNG ===\r\n  expectedDeliveryType?: string;\r\n  expectedPaymentMethod?: string;\r\n  shipOnMin?: string | Date;\r\n  shipOnMax?: string | Date;\r\n  shippedOn?: string | Date;\r\n  \r\n  // === PHỤ TRÁCH ===\r\n  assigneeName?: string;\r\n  \r\n  // === CHÍNH SÁCH ===\r\n  priceListName?: string;\r\n  currencyName?: string;\r\n  taxTreatment?: string;\r\n  \r\n  // === KHỐI LƯỢNG ===\r\n  totalWeightG?: number;\r\n  totalWeightKg?: number;\r\n  \r\n  // === CHI NHÁNH ===\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    phone?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // === KHÁCH HÀNG ===\r\n  customer?: {\r\n    name?: string;\r\n    code?: string;\r\n    phone?: string;\r\n    email?: string;\r\n    group?: string;\r\n    address?: string;\r\n    contactName?: string;\r\n    contactPhone?: string;\r\n    cardLevel?: string;\r\n    taxNumber?: string;\r\n    currentPoint?: number;\r\n    pointUsed?: number;\r\n    pointEarned?: number;\r\n    pointBeforeOrder?: number;\r\n    pointAfterOrder?: number;\r\n    currentDebt?: number;\r\n    previousDebt?: number;\r\n    debtBeforeOrder?: number;\r\n    debtAfterOrder?: number;\r\n  };\r\n  \r\n  // === ĐỊA CHỈ ===\r\n  billingAddress?: string;\r\n  shippingAddress?: string;\r\n  recipient?: {\r\n    name?: string;\r\n    phone?: string;\r\n  };\r\n  \r\n  // === LINE ITEMS ===\r\n  items: Array<{\r\n    productName: string;\r\n    variantName?: string;\r\n    variantCode?: string;\r\n    barcode?: string;\r\n    imageUrl?: string;\r\n    unit?: string;\r\n    quantity: number;\r\n    price: number;\r\n    priceAfterDiscount?: number;\r\n    discountAmount?: number;\r\n    discountRate?: number;\r\n    taxAmount?: number;\r\n    taxRate?: number;\r\n    taxIncluded?: number;\r\n    taxExclude?: number;\r\n    amount: number;\r\n    amountBeforeDiscount?: number;\r\n    note?: string;\r\n    brand?: string;\r\n    category?: string;\r\n    description?: string;\r\n    weightG?: number;\r\n    variantOptions?: string;\r\n    binLocation?: string;\r\n    serial?: string;\r\n    lotNumber?: string;\r\n    lotInfo?: string;\r\n    warrantyPolicy?: string;\r\n    warrantyPeriod?: string;\r\n    compositeDetails?: string;\r\n    promotionInfo?: string;\r\n  }>;\r\n  \r\n  // === TỔNG GIÁ TRỊ ===\r\n  totalQuantity: number;\r\n  subtotal: number;\r\n  subtotalBeforeDiscount?: number;\r\n  totalLineItemDiscount?: number;\r\n  orderDiscount?: number;\r\n  orderDiscountRate?: number;\r\n  orderDiscountValue?: number;\r\n  totalDiscount?: number;\r\n  discountDetails?: string;\r\n  totalTax?: number;\r\n  totalExtraTax?: number;\r\n  totalTaxIncludedLine?: number;\r\n  totalAmountBeforeTax?: number;\r\n  totalAmountAfterTax?: number;\r\n  deliveryFee?: number;\r\n  total: number;\r\n  totalRemain?: number;\r\n  \r\n  // === THANH TOÁN ===\r\n  paymentMethod?: string;\r\n  paidAmount?: number;\r\n  changeAmount?: number;\r\n  payments?: Array<{\r\n    method: string;\r\n    amount: number;\r\n  }>;\r\n  paymentQrUrl?: string;\r\n  \r\n  // === KHUYẾN MẠI ===\r\n  promotionName?: string;\r\n  promotionCode?: string;\r\n  \r\n  note?: string;\r\n}\r\n\r\nexport function mapQuoteToPrintData(quote: QuoteForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': quote.location?.name || storeSettings.name || '',\r\n    '{location_address}': quote.location?.address || storeSettings.address || '',\r\n    '{location_phone_number}': quote.location?.phone || storeSettings.phone || '',\r\n    '{location_province}': quote.location?.province || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === THÔNG TIN ĐƠN HÀNG ===\r\n    '{order_code}': quote.code,\r\n    '{order_qr_code}': '', // Will be generated if needed\r\n    '{bar_code(code)}': `<img src=\"https://barcodeapi.org/api/128/${encodeURIComponent(quote.code)}\" style=\"height:40px\"/>`,\r\n    '{created_on}': formatDate(quote.createdAt),\r\n    '{created_on_time}': formatTime(quote.createdAt),\r\n    '{created_on_text}': formatDateText(quote.createdAt),\r\n    '{modified_on}': formatDate(quote.modifiedAt),\r\n    '{modified_on_time}': formatTime(quote.modifiedAt),\r\n    '{issued_on}': formatDate(quote.issuedAt || quote.createdAt),\r\n    '{issued_on_time}': formatTime(quote.issuedAt || quote.createdAt),\r\n    '{issued_on_text}': formatDateText(quote.issuedAt || quote.createdAt),\r\n    '{account_name}': quote.createdBy || '',\r\n    '{assignee_name}': quote.assigneeName || quote.createdBy || '',\r\n    \r\n    // === TRẠNG THÁI ===\r\n    '{order_status}': quote.status || '',\r\n    '{payment_status}': quote.paymentStatus || '',\r\n    '{fulfillment_status}': quote.fulfillmentStatus || '',\r\n    '{packed_status}': quote.packedStatus || '',\r\n    '{return_status}': quote.returnStatus || '',\r\n    \r\n    // === NGUỒN / KÊNH ===\r\n    '{source}': quote.source || '',\r\n    '{channel}': quote.channel || '',\r\n    '{reference}': quote.reference || '',\r\n    '{tag}': quote.tags?.join(', ') || '',\r\n    '{bar_code(reference_number)}': quote.reference ? `<img src=\"https://barcodeapi.org/api/128/${encodeURIComponent(quote.reference)}\" style=\"height:40px\"/>` : '',\r\n    \r\n    // === GIAO HÀNG ===\r\n    '{expected_delivery_type}': quote.expectedDeliveryType || '',\r\n    '{expected_payment_method}': quote.expectedPaymentMethod || '',\r\n    '{ship_on_min}': formatDate(quote.shipOnMin),\r\n    '{ship_on_max}': formatDate(quote.shipOnMax),\r\n    '{shipped_on}': formatDate(quote.shippedOn),\r\n    \r\n    // === CHÍNH SÁCH ===\r\n    '{price_list_name}': quote.priceListName || '',\r\n    '{currency_name}': quote.currencyName || 'VND',\r\n    '{tax_treatment}': quote.taxTreatment || '',\r\n    \r\n    // === KHỐI LƯỢNG ===\r\n    '{weight_g}': quote.totalWeightG?.toString() || '0',\r\n    '{weight_kg}': quote.totalWeightKg?.toString() || '0',\r\n    \r\n    // === THÔNG TIN KHÁCH HÀNG ===\r\n    '{customer_name}': quote.customer?.name || '',\r\n    '{customer_code}': quote.customer?.code || '',\r\n    '{customer_phone_number}': quote.customer?.phone || '',\r\n    '{customer_phone_number_hide}': hidePhoneMiddle(quote.customer?.phone),\r\n    '{customer_email}': quote.customer?.email || '',\r\n    '{customer_group}': quote.customer?.group || '',\r\n    '{customer_contact}': quote.customer?.contactName || quote.customer?.name || '',\r\n    '{customer_contact_phone_number}': quote.customer?.contactPhone || quote.customer?.phone || '',\r\n    '{customer_contact_phone_number_hide}': hidePhoneMiddle(quote.customer?.contactPhone || quote.customer?.phone),\r\n    '{customer_card}': quote.customer?.cardLevel || '',\r\n    '{customer_tax_number}': quote.customer?.taxNumber || '',\r\n    \r\n    // === ĐIỂM KHÁCH HÀNG ===\r\n    '{customer_point}': quote.customer?.currentPoint?.toString() || '0',\r\n    '{customer_point_used}': quote.customer?.pointUsed?.toString() || '0',\r\n    '{customer_point_new}': quote.customer?.pointEarned?.toString() || '0',\r\n    '{customer_point_before_create_invoice}': quote.customer?.pointBeforeOrder?.toString() || '0',\r\n    '{customer_point_after_create_invoice}': quote.customer?.pointAfterOrder?.toString() || '0',\r\n    \r\n    // === NỢ KHÁCH HÀNG ===\r\n    '{customer_debt}': formatCurrency(quote.customer?.currentDebt),\r\n    '{customer_debt_text}': numberToWords(quote.customer?.currentDebt || 0),\r\n    '{customer_debt_prev}': formatCurrency(quote.customer?.previousDebt),\r\n    '{customer_debt_prev_text}': numberToWords(quote.customer?.previousDebt || 0),\r\n    '{debt_before_create_invoice}': formatCurrency(quote.customer?.debtBeforeOrder || quote.customer?.previousDebt),\r\n    '{debt_before_create_invoice_text}': numberToWords(quote.customer?.debtBeforeOrder || quote.customer?.previousDebt || 0),\r\n    '{debt_after_create_invoice}': formatCurrency(quote.customer?.debtAfterOrder || quote.customer?.currentDebt),\r\n    '{debt_after_create_invoice_text}': numberToWords(quote.customer?.debtAfterOrder || quote.customer?.currentDebt || 0),\r\n    '{total_amount_and_debt_before_create_invoice}': formatCurrency((quote.customer?.debtBeforeOrder || 0) + quote.total),\r\n    '{total_amount_and_debt_before_create_invoice_text}': numberToWords((quote.customer?.debtBeforeOrder || 0) + quote.total),\r\n    \r\n    // === ĐỊA CHỈ ===\r\n    '{billing_address}': quote.billingAddress || quote.customer?.address || '',\r\n    '{shipping_address}': quote.shippingAddress || '',\r\n    '{shipping_address:full_name}': quote.recipient?.name || quote.customer?.name || '',\r\n    '{shipping_address:phone_number}': quote.recipient?.phone || quote.customer?.phone || '',\r\n    '{shipping_address:phone_number_hide}': hidePhoneMiddle(quote.recipient?.phone || quote.customer?.phone),\r\n    \r\n    // === TỔNG GIÁ TRỊ ===\r\n    '{total_quantity}': quote.totalQuantity.toString(),\r\n    '{total}': formatCurrency(quote.subtotal),\r\n    '{total_none_discount}': formatCurrency(quote.subtotalBeforeDiscount || quote.subtotal),\r\n    '{total_line_item_discount}': formatCurrency(quote.totalLineItemDiscount),\r\n    '{product_discount}': formatCurrency(quote.totalLineItemDiscount),\r\n    '{order_discount}': formatCurrency(quote.orderDiscount),\r\n    '{order_discount_rate}': quote.orderDiscountRate ? `${quote.orderDiscountRate}%` : '',\r\n    '{order_discount_value}': formatCurrency(quote.orderDiscountValue || quote.orderDiscount),\r\n    '{total_discount}': formatCurrency(quote.totalDiscount),\r\n    '{discount_details}': quote.discountDetails || '',\r\n    '{total_tax}': formatCurrency(quote.totalTax),\r\n    '{total_extra_tax}': formatCurrency(quote.totalExtraTax),\r\n    '{total_tax_included_line}': formatCurrency(quote.totalTaxIncludedLine),\r\n    '{total_amount_before_tax}': formatCurrency(quote.totalAmountBeforeTax),\r\n    '{total_amount_after_tax}': formatCurrency(quote.totalAmountAfterTax),\r\n    '{delivery_fee}': formatCurrency(quote.deliveryFee),\r\n    '{total_amount}': formatCurrency(quote.total),\r\n    '{total_text}': numberToWords(quote.total),\r\n    '{total_remain}': formatCurrency(quote.totalRemain),\r\n    '{total_remain_text}': numberToWords(quote.totalRemain || 0),\r\n    \r\n    // === THANH TOÁN ===\r\n    '{payment_name}': quote.paymentMethod || '',\r\n    '{payment_customer}': formatCurrency(quote.paidAmount),\r\n    '{money_return}': formatCurrency(quote.changeAmount),\r\n    '{payments}': quote.payments?.map(p => `${p.method}: ${formatCurrency(p.amount)}`).join(', ') || '',\r\n    '{payment_qr}': quote.paymentQrUrl ? `<img src=\"${quote.paymentQrUrl}\" style=\"max-width:120px;max-height:120px\"/>` : '',\r\n    \r\n    // === KHUYẾN MẠI ===\r\n    '{promotion_name}': quote.promotionName || '',\r\n    '{promotion_code}': quote.promotionCode || '',\r\n    \r\n    '{order_note}': quote.note || '',\r\n  };\r\n}\r\n\r\nexport function mapQuoteLineItems(items: QuoteForPrint['items']): PrintLineItem[] {\r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_product_name}': item.productName,\r\n    '{line_variant}': item.variantName || '',\r\n    '{line_variant_code}': item.variantCode || '',\r\n    '{line_variant_barcode}': item.barcode || '',\r\n    '{line_variant_barcode_image}': item.barcode ? `<img src=\"https://barcodeapi.org/api/128/${item.barcode}\" style=\"height:30px\"/>` : '',\r\n    '{line_variant_options}': item.variantOptions || '',\r\n    '{line_image}': item.imageUrl ? `<img src=\"${item.imageUrl}\" style=\"max-width:50px;max-height:50px\"/>` : '',\r\n    '{line_unit}': item.unit || 'Cái',\r\n    '{line_quantity}': item.quantity.toString(),\r\n    '{line_price}': formatCurrency(item.price),\r\n    '{line_price_after_discount}': formatCurrency(item.priceAfterDiscount || (item.amount / item.quantity)),\r\n    '{line_price_discount}': `${formatCurrency(item.priceAfterDiscount || item.price)} / ${formatCurrency(item.price)}`,\r\n    '{line_discount_amount}': formatCurrency(item.discountAmount),\r\n    '{line_discount_rate}': item.discountRate ? `${item.discountRate}%` : '',\r\n    '{line_tax_amount}': formatCurrency(item.taxAmount),\r\n    '{line_tax_rate}': item.taxRate ? `${item.taxRate}%` : '',\r\n    '{line_tax_included}': formatCurrency(item.taxIncluded),\r\n    '{line_tax_exclude}': formatCurrency(item.taxExclude),\r\n    '{line_amount}': formatCurrency(item.amount),\r\n    '{line_amount_none_discount}': formatCurrency(item.amountBeforeDiscount || (item.price * item.quantity)),\r\n    // Mở rộng\r\n    '{line_note}': item.note || '',\r\n    '{line_brand}': item.brand || '',\r\n    '{line_category}': item.category || '',\r\n    '{line_product_description}': item.description || '',\r\n    '{line_weight_g}': item.weightG?.toString() || '',\r\n    '{line_weight_kg}': item.weightG ? (item.weightG / 1000).toFixed(2) : '',\r\n    '{bin_location}': item.binLocation || '',\r\n    '{serials}': item.serial || '',\r\n    '{lots_number_code1}': item.lotNumber || '',\r\n    '{lots_number_code2}': '', // Mã lô - SL\r\n    '{lots_number_code3}': item.lotInfo || '',\r\n    '{lots_number_code4}': '', // Mã lô - NSX - NHH - SL\r\n    '{lots_number_combo}': '', // Mã lô combo\r\n    '{packsizes}': '', // Đơn vị quy đổi\r\n    '{term_name}': item.warrantyPolicy || '',\r\n    '{term_number}': item.warrantyPeriod || '',\r\n    '{term_name_combo}': '', // BH thành phần combo\r\n    '{term_number_combo}': '', // Thời hạn BH thành phần combo\r\n    '{composite_details}': item.compositeDetails || '',\r\n    '{line_promotion_or_loyalty}': item.promotionInfo || '',\r\n  }));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3491, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/sales-return.mapper.ts"],"sourcesContent":["/**\r\n * Sales Return Mapper - Đơn đổi trả hàng\r\n * Đồng bộ với variables/don-doi-tra-hang.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatCurrency,\r\n  formatDate,\r\n  formatTime,\r\n  numberToWords,\r\n  getStoreData,\r\n  StoreSettings,\r\n  hidePhoneMiddle\r\n} from './types';\r\n\r\nexport interface SalesReturnForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  orderReturnCode?: string;\r\n  createdAt: string | Date;\r\n  modifiedAt?: string | Date;\r\n  issuedAt?: string | Date;\r\n  createdBy?: string;\r\n  assigneeName?: string;\r\n  \r\n  // Trạng thái\r\n  orderStatus?: string;\r\n  paymentStatus?: string;\r\n  fulfillmentStatus?: string;\r\n  packedStatus?: string;\r\n  returnStatus?: string;\r\n  refundStatus?: string;\r\n  reason?: string;\r\n  \r\n  // Nguồn / Kênh\r\n  source?: string;\r\n  channel?: string;\r\n  reference?: string;\r\n  tags?: string[];\r\n  \r\n  // Chính sách\r\n  priceListName?: string;\r\n  currencyName?: string;\r\n  expectedDeliveryType?: string;\r\n  expectedPaymentMethod?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // Thông tin đơn hàng gốc\r\n  orderCode: string;\r\n  orderQrCode?: string;\r\n  orderBarCode?: string;\r\n  \r\n  // Thông tin khách hàng\r\n  customerName: string;\r\n  customerCode?: string;\r\n  customerPhone?: string;\r\n  customerEmail?: string;\r\n  customerContact?: string;\r\n  customerCard?: string;\r\n  customerTaxNumber?: string;\r\n  customerPoint?: number;\r\n  customerDebt?: number;\r\n  customerDebtPrev?: number;\r\n  billingAddress?: string;\r\n  shippingAddress?: string;\r\n  shippingRecipient?: string;\r\n  shippingRecipientPhone?: string;\r\n  \r\n  // Ngày giao\r\n  shipOnMin?: string | Date;\r\n  shipOnMax?: string | Date;\r\n  \r\n  // Danh sách sản phẩm mua\r\n  items: Array<{\r\n    variantCode?: string;\r\n    productName: string;\r\n    variantName?: string;\r\n    barcode?: string;\r\n    unit?: string;\r\n    quantity: number;\r\n    price: number;\r\n    priceAfterDiscount?: number;\r\n    discountRate?: number;\r\n    discountAmount?: number;\r\n    taxRate?: number;\r\n    taxAmount?: number;\r\n    taxIncluded?: number;\r\n    taxExclude?: number;\r\n    amount: number;\r\n    amountNoneDiscount?: number;\r\n    brand?: string;\r\n    category?: string;\r\n    variantOptions?: string;\r\n    promotionOrLoyalty?: string;\r\n    serial?: string;\r\n    lotNumber?: string;\r\n    lotInfo?: string;\r\n    lotInfoQty?: string;\r\n    lotInfoExpiry?: string;\r\n    note?: string;\r\n  }>;\r\n  \r\n  // Danh sách sản phẩm trả\r\n  returnItems?: Array<{\r\n    variantCode?: string;\r\n    productName: string;\r\n    variantName?: string;\r\n    unit?: string;\r\n    quantity: number;\r\n    price: number;\r\n    amount: number;\r\n    serial?: string;\r\n    note?: string;\r\n  }>;\r\n  \r\n  // Tổng giá trị\r\n  totalQuantity?: number;\r\n  returnTotalQuantity?: number;\r\n  total?: number;\r\n  totalNoneDiscount?: number;\r\n  totalLineItemDiscount?: number;\r\n  orderDiscount?: number;\r\n  orderDiscountRate?: number;\r\n  orderDiscountValue?: number;\r\n  totalDiscount?: number;\r\n  productDiscount?: number;\r\n  totalTax?: number;\r\n  totalExtraTax?: number;\r\n  totalTaxIncludedLine?: number;\r\n  totalAmountBeforeTax?: number;\r\n  totalAmountAfterTax?: number;\r\n  deliveryFee?: number;\r\n  totalAmount?: number;\r\n  returnTotalAmount?: number;\r\n  totalOrderExchangeAmount?: number;\r\n  orderExchangePaymentNote?: string;\r\n  paymentCustomer?: number;\r\n  moneyReturn?: number;\r\n  totalRemain?: number;\r\n  paymentName?: string;\r\n  promotionName?: string;\r\n  promotionCode?: string;\r\n  \r\n  note?: string;\r\n}\r\n\r\nexport function mapSalesReturnToPrintData(ret: SalesReturnForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': ret.location?.name || storeSettings.name || '',\r\n    '{location_address}': ret.location?.address || storeSettings.address || '',\r\n    '{location_province}': ret.location?.province || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === THÔNG TIN ĐƠN TRẢ ===\r\n    '{order_return_code}': ret.orderReturnCode || ret.code,\r\n    '{order_code}': ret.orderCode,\r\n    '{order_qr_code}': ret.orderQrCode ? `<img src=\"${ret.orderQrCode}\" style=\"max-width:100px;max-height:100px\"/>` : '',\r\n    '{bar_code(code)}': ret.orderBarCode ? `<img src=\"${ret.orderBarCode}\" style=\"max-height:50px\"/>` : '',\r\n    '{created_on}': formatDate(ret.createdAt),\r\n    '{created_on_time}': formatTime(ret.createdAt),\r\n    '{modified_on}': formatDate(ret.modifiedAt),\r\n    '{modified_on_time}': formatTime(ret.modifiedAt),\r\n    '{issued_on}': formatDate(ret.issuedAt || ret.createdAt),\r\n    '{issued_on_time}': formatTime(ret.issuedAt || ret.createdAt),\r\n    '{account_name}': ret.createdBy || '',\r\n    '{assignee_name}': ret.assigneeName || '',\r\n    \r\n    // === TRẠNG THÁI ===\r\n    '{order_status}': ret.orderStatus || '',\r\n    '{payment_status}': ret.paymentStatus || '',\r\n    '{fulfillment_status}': ret.fulfillmentStatus || '',\r\n    '{packed_status}': ret.packedStatus || '',\r\n    '{return_status}': ret.returnStatus || '',\r\n    \r\n    // === NGUỒN / KÊNH ===\r\n    '{source}': ret.source || '',\r\n    '{channel}': ret.channel || '',\r\n    '{reference}': ret.reference || '',\r\n    '{bar_code(reference_number)}': '', // TODO: generate barcode\r\n    '{tag}': ret.tags?.join(', ') || '',\r\n    \r\n    // === CHÍNH SÁCH ===\r\n    '{price_list_name}': ret.priceListName || '',\r\n    '{currency_name}': ret.currencyName || 'VND',\r\n    '{expected_delivery_type}': ret.expectedDeliveryType || '',\r\n    '{expected_payment_method}': ret.expectedPaymentMethod || '',\r\n    \r\n    // === NGÀY GIAO ===\r\n    '{ship_on_min}': formatDate(ret.shipOnMin),\r\n    '{ship_on_max}': formatDate(ret.shipOnMax),\r\n    \r\n    // === THÔNG TIN KHÁCH HÀNG ===\r\n    '{customer_name}': ret.customerName,\r\n    '{customer_code}': ret.customerCode || '',\r\n    '{customer_phone_number}': ret.customerPhone || '',\r\n    '{customer_email}': ret.customerEmail || '',\r\n    '{customer_contact}': ret.customerContact || ret.customerName,\r\n    '{customer_card}': ret.customerCard || '',\r\n    '{customer_tax_number}': ret.customerTaxNumber || '',\r\n    '{customer_point}': ret.customerPoint?.toString() || '0',\r\n    '{customer_debt}': formatCurrency(ret.customerDebt),\r\n    '{customer_debt_text}': numberToWords(ret.customerDebt || 0),\r\n    '{customer_debt_prev}': formatCurrency(ret.customerDebtPrev),\r\n    '{customer_debt_prev_text}': numberToWords(ret.customerDebtPrev || 0),\r\n    '{billing_address}': ret.billingAddress || '',\r\n    '{shipping_address}': ret.shippingAddress || '',\r\n    '{shipping_address:full_name}': ret.shippingRecipient || ret.customerName,\r\n    '{shipping_address:phone_number}': ret.shippingRecipientPhone || ret.customerPhone || '',\r\n    \r\n    // === TỔNG GIÁ TRỊ ===\r\n    '{total_quantity}': ret.totalQuantity?.toString() || '0',\r\n    '{return_total_quantity}': ret.returnTotalQuantity?.toString() || '0',\r\n    '{total}': formatCurrency(ret.total),\r\n    '{total_none_discount}': formatCurrency(ret.totalNoneDiscount),\r\n    '{total_line_item_discount}': formatCurrency(ret.totalLineItemDiscount),\r\n    '{order_discount}': formatCurrency(ret.orderDiscount),\r\n    '{order_discount_rate}': ret.orderDiscountRate ? `${ret.orderDiscountRate}%` : '',\r\n    '{order_discount_value}': formatCurrency(ret.orderDiscountValue),\r\n    '{total_discount}': formatCurrency(ret.totalDiscount),\r\n    '{product_discount}': formatCurrency(ret.productDiscount),\r\n    '{total_tax}': formatCurrency(ret.totalTax),\r\n    '{total_extra_tax}': formatCurrency(ret.totalExtraTax),\r\n    '{total_tax_included_line}': formatCurrency(ret.totalTaxIncludedLine),\r\n    '{total_amount_before_tax}': formatCurrency(ret.totalAmountBeforeTax),\r\n    '{total_amount_after_tax}': formatCurrency(ret.totalAmountAfterTax),\r\n    '{delivery_fee}': formatCurrency(ret.deliveryFee),\r\n    '{total_amount}': formatCurrency(ret.totalAmount),\r\n    '{total_text}': numberToWords(ret.totalAmount || 0),\r\n    '{return_total_amount}': formatCurrency(ret.returnTotalAmount),\r\n    '{total_order_exchange_amount}': formatCurrency(ret.totalOrderExchangeAmount),\r\n    '{order_exchange_payment_note}': ret.orderExchangePaymentNote || '',\r\n    '{payment_customer}': formatCurrency(ret.paymentCustomer),\r\n    '{money_return}': formatCurrency(ret.moneyReturn),\r\n    '{total_remain}': formatCurrency(ret.totalRemain),\r\n    '{payment_name}': ret.paymentName || '',\r\n    '{promotion_name}': ret.promotionName || '',\r\n    '{promotion_code}': ret.promotionCode || '',\r\n    \r\n    '{order_note}': ret.note || '',\r\n    '{note}': ret.note || '',\r\n    '{reason_return}': ret.reason || '',\r\n    '{refund_status}': ret.refundStatus || '',\r\n  };\r\n}\r\n\r\nexport function mapSalesReturnLineItems(items: SalesReturnForPrint['items']): PrintLineItem[] {\r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_variant_code}': item.variantCode || '',\r\n    '{line_product_name}': item.productName,\r\n    '{line_variant}': item.variantName || '',\r\n    '{line_variant_barcode}': item.barcode || '',\r\n    '{line_unit}': item.unit || 'Cái',\r\n    '{line_quantity}': item.quantity.toString(),\r\n    '{line_price}': formatCurrency(item.price),\r\n    '{line_price_after_discount}': formatCurrency(item.priceAfterDiscount),\r\n    '{line_discount_rate}': item.discountRate ? `${item.discountRate}%` : '',\r\n    '{line_discount_amount}': formatCurrency(item.discountAmount),\r\n    '{line_tax_rate}': item.taxRate ? `${item.taxRate}%` : '',\r\n    '{line_tax_amount}': formatCurrency(item.taxAmount),\r\n    '{line_tax_included}': formatCurrency(item.taxIncluded),\r\n    '{line_tax_exclude}': formatCurrency(item.taxExclude),\r\n    '{line_amount}': formatCurrency(item.amount),\r\n    '{line_amount_none_discount}': formatCurrency(item.amountNoneDiscount),\r\n    '{line_brand}': item.brand || '',\r\n    '{line_category}': item.category || '',\r\n    '{line_variant_options}': item.variantOptions || '',\r\n    '{line_promotion_or_loyalty}': item.promotionOrLoyalty || '',\r\n    '{serials}': item.serial || '',\r\n    '{lots_number_code1}': item.lotNumber || '',\r\n    '{lots_number_code2}': item.lotInfoQty || '',\r\n    '{lots_number_code3}': item.lotInfo || '',\r\n    '{lots_number_code4}': item.lotInfoExpiry || '',\r\n    '{line_note}': item.note || '',\r\n  }));\r\n}\r\n\r\nexport function mapSalesReturnReturnLineItems(items: SalesReturnForPrint['returnItems']): PrintLineItem[] {\r\n  if (!items) return [];\r\n  \r\n  return items.map((item, index) => ({\r\n    '{return_line_stt}': (index + 1).toString(),\r\n    '{return_line_variant_code}': item.variantCode || '',\r\n    '{return_line_product_name}': item.productName,\r\n    '{return_line_variant}': item.variantName || '',\r\n    '{return_line_unit}': item.unit || 'Cái',\r\n    '{return_line_quantity}': item.quantity.toString(),\r\n    '{return_line_price}': formatCurrency(item.price),\r\n    '{return_line_amount}': formatCurrency(item.amount),\r\n    '{return_serials}': item.serial || '',\r\n    '{return_line_note}': item.note || '',\r\n\r\n    // Map to standard line item variables as well (for templates that use generic names)\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_variant_code}': item.variantCode || '',\r\n    '{line_product_name}': item.productName,\r\n    '{line_variant}': item.variantName || '',\r\n    '{line_unit}': item.unit || 'Cái',\r\n    '{line_quantity}': item.quantity.toString(),\r\n    '{line_price}': formatCurrency(item.price),\r\n    '{line_total}': formatCurrency(item.amount), // Template uses line_total\r\n    '{line_amount}': formatCurrency(item.amount),\r\n    '{line_note}': item.note || '',\r\n  }));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3658, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/product-label.mapper.ts"],"sourcesContent":["import type { Product } from '@/features/products/types';\r\nimport {\r\n  PrintData,\r\n  StoreSettings,\r\n  formatCurrency,\r\n  formatDate,\r\n  getStoreData,\r\n} from './types';\r\n\r\nconst DEFAULT_QR_SIZE = 96;\r\nconst DEFAULT_BARCODE_HEIGHT = 48;\r\n\r\nfunction generateBarcodeImage(value?: string, height: number = DEFAULT_BARCODE_HEIGHT): string {\r\n  if (!value) return '';\r\n  return `<img src=\"https://barcodeapi.org/api/128/${encodeURIComponent(value)}\" style=\"height:${height}px\" alt=\"barcode\"/>`;\r\n}\r\n\r\nfunction generateQRCodeImage(value?: string, size: number = DEFAULT_QR_SIZE): string {\r\n  if (!value) return '';\r\n  return `<img src=\"https://quickchart.io/qr?text=${encodeURIComponent(value)}&size=${size}\" style=\"width:${size}px;height:${size}px\" alt=\"qr\"/>`;\r\n}\r\n\r\nfunction formatWeight(value?: number, unit?: string): string {\r\n  if (value === undefined || value === null) return '';\r\n  if (unit === 'g') return `${value} g`;\r\n  if (unit === 'kg') return `${value} kg`;\r\n  return `${value} ${unit || ''}`.trim();\r\n}\r\n\r\nexport interface ProductLabelForPrint {\r\n  sku: string;\r\n  name: string;\r\n  nameVat?: string; // Tên sản phẩm VAT đầy đủ\r\n  unit?: string;\r\n  price?: number;\r\n  brand?: string;\r\n  category?: string;\r\n  weightText?: string;\r\n  weightValue?: number;\r\n  weightUnit?: string;\r\n  origin?: string;\r\n  ingredients?: string;\r\n  manufactureDate?: string | Date;\r\n  expiryDate?: string | Date;\r\n  lotNumber?: string;\r\n  storageInstructions?: string;\r\n  description?: string;\r\n  shortDescription?: string;\r\n  barcode?: string;\r\n  qrCodeValue?: string;\r\n  // Tem phụ fields\r\n  usageGuide?: string;\r\n  importerName?: string;\r\n  importerAddress?: string;\r\n}\r\n\r\nexport function mapProductLabelToPrintData(\r\n  product: ProductLabelForPrint,\r\n  storeSettings: StoreSettings,\r\n): PrintData {\r\n  const barcodeValue = product.barcode || product.sku || product.name;\r\n  const qrValue = product.qrCodeValue || barcodeValue || product.name;\r\n\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n\r\n    '{product_name}': product.name,\r\n    '{product_name_vat}': product.nameVat || product.name,\r\n    '{product_sku}': product.sku,\r\n    '{product_unit}': product.unit || '',\r\n    '{product_price}': product.price !== undefined ? formatCurrency(product.price) : '',\r\n    '{product_brand}': product.brand || '',\r\n    '{product_category}': product.category || '',\r\n    '{product_weight}': product.weightText || formatWeight(product.weightValue, product.weightUnit),\r\n    '{product_origin}': product.origin || '',\r\n    '{product_ingredients}': product.ingredients || '',\r\n    '{product_mfg_date}': formatDate(product.manufactureDate),\r\n    '{product_expiry_date}': formatDate(product.expiryDate),\r\n    '{product_lot_number}': product.lotNumber || '',\r\n    '{product_description}': product.description || '',\r\n    '{product_short_description}': product.shortDescription || product.description || '',\r\n    '{product_storage_instructions}': product.storageInstructions || '',\r\n    '{product_barcode}': barcodeValue || '',\r\n    '{product_barcode_image}': generateBarcodeImage(barcodeValue),\r\n    '{product_qr_code}': generateQRCodeImage(qrValue),\r\n    // Tem phụ fields\r\n    '{product_usage_guide}': product.usageGuide || '',\r\n    '{product_importer_name}': product.importerName || '',\r\n    '{product_importer_address}': product.importerAddress || '',\r\n  };\r\n}\r\n\r\nexport function mapProductToLabelPrintData(\r\n  product: Product,\r\n  storeSettings: StoreSettings,\r\n  overrides: Partial<ProductLabelForPrint> = {},\r\n): PrintData {\r\n  const firstPrice = Object.values(product.prices || {})[0];\r\n  const resolvedPrice = overrides.price ?? product.sellingPrice ?? firstPrice;\r\n\r\n  return mapProductLabelToPrintData(\r\n    {\r\n      sku: overrides.sku || product.id || product.sku || '',\r\n      name: overrides.name || product.name,\r\n      nameVat: overrides.nameVat || product.nameVat || product.name,\r\n      unit: overrides.unit || product.unit,\r\n      price: resolvedPrice,\r\n      brand: overrides.brand || '',\r\n      category: overrides.category || product.category || '',\r\n      weightText: overrides.weightText,\r\n      weightValue: overrides.weightValue ?? product.weight,\r\n      weightUnit: overrides.weightUnit ?? product.weightUnit,\r\n      origin: overrides.origin || product.origin,\r\n      ingredients: overrides.ingredients,\r\n      manufactureDate: overrides.manufactureDate,\r\n      expiryDate: overrides.expiryDate,\r\n      lotNumber: overrides.lotNumber,\r\n      storageInstructions: overrides.storageInstructions,\r\n      description: overrides.description || product.description,\r\n      shortDescription: overrides.shortDescription || product.shortDescription,\r\n      barcode: overrides.barcode || product.barcode || product.id,\r\n      qrCodeValue: overrides.qrCodeValue || product.id,\r\n      // Tem phụ fields from product\r\n      usageGuide: overrides.usageGuide || product.usageGuide,\r\n      importerName: overrides.importerName || product.importerName,\r\n      importerAddress: overrides.importerAddress || product.importerAddress,\r\n    },\r\n    storeSettings,\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3747, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/purchase-order.mapper.ts"],"sourcesContent":["/**\r\n * Purchase Order Mapper - Đơn nhập hàng\r\n * Đồng bộ với variables/don-nhap-hang.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatCurrency,\r\n  formatDate,\r\n  formatTime,\r\n  numberToWords,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface PurchaseOrderForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  createdAt: string | Date;\r\n  modifiedAt?: string | Date;\r\n  receivedOn?: string | Date;\r\n  completedOn?: string | Date;\r\n  cancelledOn?: string | Date;\r\n  dueOn?: string | Date;\r\n  createdBy?: string;\r\n  assigneeName?: string;\r\n  activatedAccountName?: string;\r\n  \r\n  // Trạng thái\r\n  status?: string;\r\n  receivedStatus?: string;\r\n  financialStatus?: string;\r\n  refundStatus?: string;\r\n  refundTransactionStatus?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // Thông tin NCC\r\n  supplierName: string;\r\n  supplierCode?: string;\r\n  supplierPhone?: string;\r\n  supplierEmail?: string;\r\n  supplierAddress?: string;\r\n  billingAddress?: string;\r\n  \r\n  // Nợ NCC\r\n  supplierDebt?: number;\r\n  supplierDebtPrev?: number;\r\n  \r\n  // Khối lượng\r\n  totalWeightG?: number;\r\n  totalWeightKg?: number;\r\n  \r\n  // Tags\r\n  tags?: string[];\r\n  reference?: string;\r\n  \r\n  // Danh sách sản phẩm\r\n  items: Array<{\r\n    variantCode?: string;\r\n    productName: string;\r\n    variantName?: string;\r\n    title?: string;\r\n    barcode?: string;\r\n    unit?: string;\r\n    quantity: number;\r\n    receivedQuantity?: number;\r\n    price: number;\r\n    priceAfterDiscount?: number;\r\n    discountRate?: number;\r\n    discountAmount?: number;\r\n    taxRate?: number;\r\n    taxAmount?: number;\r\n    taxType?: string;\r\n    taxIncluded?: number;\r\n    taxExclude?: number;\r\n    amount: number;\r\n    brand?: string;\r\n    category?: string;\r\n    variantOptions?: string;\r\n    weightG?: number;\r\n    weightKg?: number;\r\n    serial?: string;\r\n    lotNumber?: string;\r\n    lotInfo?: string;\r\n    lotInfoExpiry?: string;\r\n    lotInfoQty?: string;\r\n    note?: string;\r\n  }>;\r\n  \r\n  // Tổng giá trị\r\n  totalQuantity: number;\r\n  total: number;\r\n  totalPrice?: number;\r\n  totalDiscountsRate?: number;\r\n  totalDiscountsValue?: number;\r\n  totalDiscounts?: number;\r\n  productDiscount?: number;\r\n  totalTax?: number;\r\n  totalExtraTax?: number;\r\n  totalTaxIncludedLine?: number;\r\n  totalAmountBeforeTax?: number;\r\n  totalAmountAfterTax?: number;\r\n  totalLandedCosts?: number;\r\n  totalTransactionAmount?: number;\r\n  totalAmountTransaction?: number;\r\n  totalRemain?: number;\r\n  payments?: string;\r\n  \r\n  note?: string;\r\n}\r\n\r\nexport function mapPurchaseOrderToPrintData(po: PurchaseOrderForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': po.location?.name || storeSettings.name || '',\r\n    '{location_address}': po.location?.address || storeSettings.address || '',\r\n    '{location_province}': po.location?.province || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === THÔNG TIN ĐƠN NHẬP ===\r\n    '{purchase_order_code}': po.code,\r\n    '{created_on}': formatDate(po.createdAt),\r\n    '{created_on_time}': formatTime(po.createdAt),\r\n    '{modified_on}': formatDate(po.modifiedAt),\r\n    '{received_on}': formatDate(po.receivedOn),\r\n    '{received_on_time}': formatTime(po.receivedOn),\r\n    '{completed_on}': formatDate(po.completedOn || po.receivedOn),\r\n    '{ended_on}': formatDate(po.completedOn || po.receivedOn),\r\n    '{cancelled_on}': formatDate(po.cancelledOn),\r\n    '{due_on}': formatDate(po.dueOn),\r\n    '{due_on_time}': formatTime(po.dueOn),\r\n    '{account_name}': po.createdBy || '',\r\n    '{activated_account_name}': po.activatedAccountName || po.createdBy || '',\r\n    '{assignee_name}': po.assigneeName || '',\r\n    '{reference}': po.reference || '',\r\n    '{tags}': po.tags?.join(', ') || '',\r\n    \r\n    // === TRẠNG THÁI ===\r\n    '{status}': po.status || '',\r\n    '{received_status}': po.receivedStatus || '',\r\n    '{financial_status}': po.financialStatus || '',\r\n    '{refund_status}': po.refundStatus || '',\r\n    '{refund_transaction_status}': po.refundTransactionStatus || '',\r\n    \r\n    // === THÔNG TIN NHÀ CUNG CẤP ===\r\n    '{supplier_name}': po.supplierName,\r\n    '{supplier_code}': po.supplierCode || '',\r\n    '{order_supplier_code}': po.supplierCode || '',\r\n    '{supplier_phone}': po.supplierPhone || '',\r\n    '{supplier_phone_number}': po.supplierPhone || '',\r\n    '{supplier_email}': po.supplierEmail || '',\r\n    '{supplier_address}': po.supplierAddress || '',\r\n    '{billing_address}': po.billingAddress || '',\r\n    \r\n    // === NỢ NCC ===\r\n    '{supplier_debt}': formatCurrency(po.supplierDebt),\r\n    '{supplier_debt_text}': numberToWords(po.supplierDebt || 0),\r\n    '{supplier_debt_prev}': formatCurrency(po.supplierDebtPrev),\r\n    '{supplier_debt_prev_text}': numberToWords(po.supplierDebtPrev || 0),\r\n    \r\n    // === KHỐI LƯỢNG ===\r\n    '{weight_g}': po.totalWeightG?.toString() || '0',\r\n    '{weight_kg}': po.totalWeightKg?.toString() || '0',\r\n    \r\n    // === TỔNG GIÁ TRỊ ===\r\n    '{total_quantity}': po.totalQuantity.toString(),\r\n    '{total}': formatCurrency(po.total),\r\n    '{total_order}': formatCurrency(po.total),\r\n    '{total_price}': formatCurrency(po.totalPrice || po.total),\r\n    '{total_discounts_rate}': po.totalDiscountsRate ? `${po.totalDiscountsRate}%` : '',\r\n    '{total_discounts_value}': formatCurrency(po.totalDiscountsValue),\r\n    '{total_discounts}': formatCurrency(po.totalDiscounts),\r\n    '{discount}': formatCurrency(po.totalDiscounts),\r\n    '{product_discount}': formatCurrency(po.productDiscount),\r\n    '{total_tax}': formatCurrency(po.totalTax),\r\n    '{tax_vat}': formatCurrency(po.totalTax),\r\n    '{total_extra_tax}': formatCurrency(po.totalExtraTax),\r\n    '{total_tax_included_line}': formatCurrency(po.totalTaxIncludedLine),\r\n    '{total_amount_before_tax}': formatCurrency(po.totalAmountBeforeTax),\r\n    '{total_amount_after_tax}': formatCurrency(po.totalAmountAfterTax),\r\n    '{total_landed_costs}': formatCurrency(po.totalLandedCosts),\r\n    '{total_transaction_amount}': formatCurrency(po.totalTransactionAmount),\r\n    '{total_amount_transaction}': formatCurrency(po.totalAmountTransaction),\r\n    '{total_remain}': formatCurrency(po.totalRemain),\r\n    '{total_amount_text}': numberToWords(po.totalPrice || po.total),\r\n    '{payments}': po.payments || '',\r\n    \r\n    '{note}': po.note || '',\r\n  };\r\n}\r\n\r\nexport function mapPurchaseOrderLineItems(items: PurchaseOrderForPrint['items']): PrintLineItem[] {\r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_title}': item.title || item.productName,\r\n    '{line_product_name}': item.productName || item.title,\r\n    '{line_variant_code}': item.variantCode || '',\r\n    '{line_variant_name}': item.variantName || '',\r\n    '{line_variant}': item.variantName || '',\r\n    '{line_variant_barcode}': item.barcode || '',\r\n    '{line_unit}': item.unit || 'Cái',\r\n    '{line_quantity}': item.quantity.toString(),\r\n    '{line_ordered_quantity}': item.quantity.toString(),\r\n    '{line_received_quantity}': item.receivedQuantity?.toString() || '0',\r\n    '{line_price}': formatCurrency(item.price),\r\n    '{line_price_after_discount}': formatCurrency(item.priceAfterDiscount),\r\n    '{line_discount_rate}': item.discountRate ? `${item.discountRate}%` : '',\r\n    '{line_discount_amount}': formatCurrency(item.discountAmount),\r\n    '{line_tax_rate}': item.taxRate ? `${item.taxRate}%` : '',\r\n    '{line_tax_amount}': formatCurrency(item.taxAmount),\r\n    '{line_tax}': item.taxType || '',\r\n    '{line_tax_included}': formatCurrency(item.taxIncluded),\r\n    '{line_tax_exclude}': formatCurrency(item.taxExclude),\r\n    '{line_amount}': formatCurrency(item.amount),\r\n    '{line_total}': formatCurrency(item.amount),\r\n    '{total_line_amount}': formatCurrency(item.amount),\r\n    '{total_line_amount_text}': numberToWords(item.amount),\r\n    '{line_brand}': item.brand || '',\r\n    '{line_category}': item.category || '',\r\n    '{line_variant_options}': item.variantOptions || '',\r\n    '{line_weight_g}': item.weightG?.toString() || '',\r\n    '{line_weight_kg}': item.weightKg?.toString() || '',\r\n    '{serials}': item.serial || '',\r\n    '{lots_number_code1}': item.lotNumber || '',\r\n    '{lots_number_code2}': item.lotInfoQty || '',\r\n    '{lots_number_code3}': item.lotInfo || '',\r\n    '{lots_number_code4}': item.lotInfoExpiry || '',\r\n    '{line_note}': item.note || '',\r\n  }));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3875, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/stock-in.mapper.ts"],"sourcesContent":["/**\r\n * Stock In Mapper - Phiếu nhập kho\r\n * Đồng bộ với variables/phieu-nhap-kho.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatCurrency,\r\n  formatDate,\r\n  formatTime,\r\n  numberToWords,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface StockInForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  createdAt: string | Date;\r\n  modifiedAt?: string | Date;\r\n  receivedOn?: string | Date;\r\n  createdBy?: string;\r\n  purchaseOrderCode?: string;\r\n  reference?: string;\r\n  status?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // Thông tin NCC\r\n  supplierName?: string;\r\n  supplierCode?: string;\r\n  supplierPhone?: string;\r\n  supplierEmail?: string;\r\n  supplierDebt?: number;\r\n  supplierDebtPrev?: number;\r\n  \r\n  // Danh sách sản phẩm\r\n  items: Array<{\r\n    variantCode?: string;\r\n    productName: string;\r\n    variantName?: string;\r\n    barcode?: string;\r\n    unit?: string;\r\n    quantity: number;\r\n    receivedQuantity?: number;\r\n    price: number;\r\n    discountRate?: number;\r\n    discountAmount?: number;\r\n    taxRate?: number;\r\n    taxAmount?: number;\r\n    taxType?: string;\r\n    amount: number;\r\n    brand?: string;\r\n    category?: string;\r\n    variantOptions?: string;\r\n    binLocation?: string;\r\n    serial?: string;\r\n  }>;\r\n  \r\n  // Tổng giá trị\r\n  totalQuantity: number;\r\n  total: number;\r\n  totalPrice?: number;\r\n  totalDiscounts?: number;\r\n  totalTax?: number;\r\n  totalLandedCosts?: number;\r\n  paid?: number;\r\n  remaining?: number;\r\n  \r\n  note?: string;\r\n}\r\n\r\nexport function mapStockInToPrintData(stockIn: StockInForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': stockIn.location?.name || storeSettings.name || '',\r\n    '{location_address}': stockIn.location?.address || storeSettings.address || '',\r\n    '{location_province}': stockIn.location?.province || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === THÔNG TIN PHIẾU NHẬP KHO ===\r\n    '{receipt_code}': stockIn.code,\r\n    '{stock_in_code}': stockIn.code,\r\n    '{purchase_order_code}': stockIn.purchaseOrderCode || '',\r\n    '{order_supplier_code}': stockIn.purchaseOrderCode || '',\r\n    '{created_on}': formatDate(stockIn.createdAt),\r\n    '{modified_on}': formatDate(stockIn.modifiedAt),\r\n    '{received_on}': formatDate(stockIn.receivedOn),\r\n    '{received_on_time}': formatTime(stockIn.receivedOn),\r\n    '{account_name}': stockIn.createdBy || '',\r\n    '{reference}': stockIn.reference || '',\r\n    '{stock_in_status}': stockIn.status || '',\r\n    \r\n    // === THÔNG TIN NHÀ CUNG CẤP ===\r\n    '{supplier_name}': stockIn.supplierName || '',\r\n    '{supplier_code}': stockIn.supplierCode || '',\r\n    '{supplier_phone}': stockIn.supplierPhone || '',\r\n    '{supplier_email}': stockIn.supplierEmail || '',\r\n    '{supplier_debt}': formatCurrency(stockIn.supplierDebt),\r\n    '{supplier_debt_text}': numberToWords(stockIn.supplierDebt || 0),\r\n    '{supplier_debt_prev}': formatCurrency(stockIn.supplierDebtPrev),\r\n    '{supplier_debt_prev_text}': numberToWords(stockIn.supplierDebtPrev || 0),\r\n    \r\n    // === TỔNG GIÁ TRỊ ===\r\n    '{total_quantity}': stockIn.totalQuantity.toString(),\r\n    '{total}': formatCurrency(stockIn.total),\r\n    '{total_order}': formatCurrency(stockIn.total),\r\n    '{total_price}': formatCurrency(stockIn.totalPrice || stockIn.total),\r\n    '{total_discounts}': formatCurrency(stockIn.totalDiscounts),\r\n    '{discount}': formatCurrency(stockIn.totalDiscounts),\r\n    '{total_tax}': formatCurrency(stockIn.totalTax),\r\n    '{tax_vat}': formatCurrency(stockIn.totalTax),\r\n    '{total_landed_costs}': formatCurrency(stockIn.totalLandedCosts),\r\n    '{total_amount_text}': numberToWords(stockIn.totalPrice || stockIn.total),\r\n    '{paid}': formatCurrency(stockIn.paid),\r\n    '{remaining}': formatCurrency(stockIn.remaining),\r\n    \r\n    '{note}': stockIn.note || '',\r\n  };\r\n}\r\n\r\nexport function mapStockInLineItems(items: StockInForPrint['items']): PrintLineItem[] {\r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_variant_code}': item.variantCode || '',\r\n    '{line_product_name}': item.productName,\r\n    '{line_variant_name}': item.variantName || '',\r\n    '{line_variant}': item.variantName || '',\r\n    '{line_variant_barcode}': item.barcode || '',\r\n    '{line_unit}': item.unit || 'Cái',\r\n    '{line_quantity}': item.quantity.toString(),\r\n    '{line_ordered_quantity}': item.quantity.toString(),\r\n    '{line_received_quantity}': item.receivedQuantity?.toString() || '0',\r\n    '{line_price}': formatCurrency(item.price),\r\n    '{line_discount_rate}': item.discountRate ? `${item.discountRate}%` : '',\r\n    '{line_discount_amount}': formatCurrency(item.discountAmount),\r\n    '{line_tax_rate}': item.taxRate ? `${item.taxRate}%` : '',\r\n    '{line_tax_amount}': formatCurrency(item.taxAmount),\r\n    '{line_tax}': item.taxType || '',\r\n    '{line_amount}': formatCurrency(item.amount),\r\n    '{line_total}': formatCurrency(item.amount),\r\n    '{line_brand}': item.brand || '',\r\n    '{line_category}': item.category || '',\r\n    '{line_variant_options}': item.variantOptions || '',\r\n    '{bin_location}': item.binLocation || '',\r\n    '{serials}': item.serial || '',\r\n  }));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3963, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/stock-transfer.mapper.ts"],"sourcesContent":["/**\r\n * Stock Transfer Mapper - Phiếu chuyển kho\r\n * Đồng bộ với variables/phieu-chuyen-hang.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatDate,\r\n  formatTime,\r\n  formatCurrency,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface StockTransferForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  createdAt: string | Date;\r\n  modifiedAt?: string | Date;\r\n  shippedOn?: string | Date;\r\n  receivedOn?: string | Date;\r\n  createdBy?: string;\r\n  status?: string;\r\n  reference?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // Chi nhánh chuyển\r\n  sourceLocationName: string;\r\n  sourceLocationAddress?: string;\r\n  \r\n  // Chi nhánh nhận\r\n  destinationLocationName: string;\r\n  destinationLocationAddress?: string;\r\n  \r\n  // Khối lượng\r\n  totalWeightG?: number;\r\n  totalWeightKg?: number;\r\n  \r\n  // Danh sách sản phẩm\r\n  items: Array<{\r\n    variantCode?: string;\r\n    productName: string;\r\n    variantName?: string;\r\n    barcode?: string;\r\n    imageUrl?: string;\r\n    unit?: string;\r\n    quantity: number;\r\n    receiptQuantity?: number;\r\n    changeQuantity?: number;\r\n    price?: number;\r\n    amount?: number;\r\n    amountReceived?: number;\r\n    weightG?: number;\r\n    weightKg?: number;\r\n    brand?: string;\r\n    category?: string;\r\n    variantOptions?: string;\r\n    serial?: string;\r\n    lotNumber?: string;\r\n    lotInfo?: string;\r\n    lotInfoExpiry?: string;\r\n    lotInfoQty?: string;\r\n  }>;\r\n  \r\n  // Tổng giá trị\r\n  totalQuantity?: number;\r\n  totalReceiptQuantity?: number;\r\n  totalAmountTransfer?: number;\r\n  totalAmountReceipt?: number;\r\n  totalFeeAmount?: number;\r\n  \r\n  note?: string;\r\n}\r\n\r\nexport function mapStockTransferToPrintData(transfer: StockTransferForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': transfer.location?.name || storeSettings.name || '',\r\n    '{location_address}': transfer.location?.address || storeSettings.address || '',\r\n    '{location_province}': transfer.location?.province || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === THÔNG TIN PHIẾU CHUYỂN HÀNG ===\r\n    '{order_code}': transfer.code,\r\n    '{transfer_code}': transfer.code,\r\n    '{created_on}': formatDate(transfer.createdAt),\r\n    '{created_on_time}': formatTime(transfer.createdAt),\r\n    '{modified_on}': formatDate(transfer.modifiedAt),\r\n    '{modified_on_time}': formatTime(transfer.modifiedAt),\r\n    '{shipped_on}': formatDate(transfer.shippedOn),\r\n    '{shipped_on_time}': formatTime(transfer.shippedOn),\r\n    '{received_on}': formatDate(transfer.receivedOn),\r\n    '{received_on_time}': formatTime(transfer.receivedOn),\r\n    '{account_name}': transfer.createdBy || '',\r\n    '{status}': transfer.status || '',\r\n    '{reference}': transfer.reference || '',\r\n    \r\n    // === CHI NHÁNH CHUYỂN ===\r\n    '{source_location_name}': transfer.sourceLocationName,\r\n    '{source_location_address}': transfer.sourceLocationAddress || '',\r\n    \r\n    // === CHI NHÁNH NHẬN ===\r\n    '{destination_location_name}': transfer.destinationLocationName,\r\n    '{target_location_name}': transfer.destinationLocationName,\r\n    '{destination_location_address}': transfer.destinationLocationAddress || '',\r\n    \r\n    // === KHỐI LƯỢNG ===\r\n    '{weight_g}': transfer.totalWeightG?.toString() || '0',\r\n    '{weight_kg}': transfer.totalWeightKg?.toString() || '0',\r\n    \r\n    // === TỔNG GIÁ TRỊ ===\r\n    '{total_quantity}': transfer.totalQuantity?.toString() || '0',\r\n    '{total_receipt_quantity}': transfer.totalReceiptQuantity?.toString() || '0',\r\n    '{total_amount_transfer}': formatCurrency(transfer.totalAmountTransfer),\r\n    '{total_amount_receipt}': formatCurrency(transfer.totalAmountReceipt),\r\n    '{total_fee_amount}': formatCurrency(transfer.totalFeeAmount),\r\n    \r\n    '{note}': transfer.note || '',\r\n  };\r\n}\r\n\r\nexport function mapStockTransferLineItems(items: StockTransferForPrint['items']): PrintLineItem[] {\r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_variant_code}': item.variantCode || '',\r\n    '{line_product_name}': item.productName,\r\n    '{line_variant_name}': item.variantName || '',\r\n    '{line_variant}': item.variantName || '',\r\n    '{line_variant_barcode}': item.barcode || '',\r\n    '{line_variant_image}': item.imageUrl ? `<img src=\"${item.imageUrl}\" style=\"max-width:50px;max-height:50px\"/>` : '',\r\n    '{line_unit}': item.unit || 'Cái',\r\n    '{line_quantity}': item.quantity.toString(),\r\n    '{receipt_quantity}': item.receiptQuantity?.toString() || '',\r\n    '{change_quantity}': item.changeQuantity?.toString() || '',\r\n    '{line_price}': formatCurrency(item.price),\r\n    '{line_amount}': formatCurrency(item.amount),\r\n    '{line_amount_received}': formatCurrency(item.amountReceived),\r\n    '{line_weight_g}': item.weightG?.toString() || '',\r\n    '{line_weight_kg}': item.weightKg?.toString() || '',\r\n    '{line_brand}': item.brand || '',\r\n    '{line_category}': item.category || '',\r\n    '{line_variant_options}': item.variantOptions || '',\r\n    '{serials}': item.serial || '',\r\n    '{lots_number_code1}': item.lotNumber || '',\r\n    '{lots_number_code2}': item.lotInfoQty || '',\r\n    '{lots_number_code3}': item.lotInfo || '',\r\n    '{lots_number_code4}': item.lotInfoExpiry || '',\r\n  }));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4048, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/inventory-check.mapper.ts"],"sourcesContent":["/**\r\n * Inventory Check Mapper - Phiếu kiểm kho\r\n * Đồng bộ với variables/phieu-kiem-hang.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatDate,\r\n  formatTime,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface InventoryCheckForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  createdAt: string | Date;\r\n  modifiedAt?: string | Date;\r\n  adjustedOn?: string | Date;\r\n  createdBy?: string;\r\n  status?: string;\r\n  reason?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // Danh sách sản phẩm\r\n  items: Array<{\r\n    variantCode?: string;\r\n    productName: string;\r\n    variantName?: string;\r\n    barcode?: string;\r\n    unit?: string;\r\n    stockQuantity: number;\r\n    afterQuantity: number;\r\n    changeQuantity: number;\r\n    reason?: string;\r\n    brand?: string;\r\n    category?: string;\r\n    variantOptions?: string;\r\n    note?: string;\r\n  }>;\r\n  \r\n  // Tổng\r\n  totalQuantity?: number;\r\n  totalSurplus?: number;\r\n  totalShortage?: number;\r\n  \r\n  note?: string;\r\n}\r\n\r\nexport function mapInventoryCheckToPrintData(check: InventoryCheckForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': check.location?.name || storeSettings.name || '',\r\n    '{location_address}': check.location?.address || storeSettings.address || '',\r\n    '{location_province}': check.location?.province || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === THÔNG TIN PHIẾU KIỂM HÀNG ===\r\n    '{code}': check.code,\r\n    '{inventory_code}': check.code,\r\n    '{created_on}': formatDate(check.createdAt),\r\n    '{created_on_time}': formatTime(check.createdAt),\r\n    '{modified_on}': formatDate(check.modifiedAt),\r\n    '{modified_on_time}': formatTime(check.modifiedAt),\r\n    '{adjusted_on}': formatDate(check.adjustedOn),\r\n    '{adjusted_on_time}': formatTime(check.adjustedOn),\r\n    '{account_name}': check.createdBy || '',\r\n    '{status}': check.status || '',\r\n    '{inventory_status}': check.status || '',\r\n    '{reason}': check.reason || '',\r\n    \r\n    // === TỔNG ===\r\n    '{total}': check.totalQuantity?.toString() || '0',\r\n    '{total_items}': check.totalQuantity?.toString() || '0',\r\n    '{total_surplus}': check.totalSurplus?.toString() || '0',\r\n    '{total_shortage}': check.totalShortage?.toString() || '0',\r\n    \r\n    '{note}': check.note || '',\r\n  };\r\n}\r\n\r\nexport function mapInventoryCheckLineItems(items: InventoryCheckForPrint['items']): PrintLineItem[] {\r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_variant_code}': item.variantCode || '',\r\n    '{line_product_name}': item.productName,\r\n    '{line_variant_name}': item.variantName || '',\r\n    '{line_variant}': item.variantName || '',\r\n    '{line_variant_barcode}': item.barcode || '',\r\n    '{line_unit}': item.unit || 'Cái',\r\n    '{line_stock_quantity}': item.stockQuantity.toString(),\r\n    '{line_on_hand}': item.stockQuantity.toString(),\r\n    '{line_after_quantity}': item.afterQuantity.toString(),\r\n    '{line_real_quantity}': item.afterQuantity.toString(),\r\n    '{line_change_quantity}': item.changeQuantity.toString(),\r\n    '{line_difference}': item.changeQuantity.toString(),\r\n    '{line_reason}': item.reason || '',\r\n    '{line_brand}': item.brand || '',\r\n    '{line_category}': item.category || '',\r\n    '{line_variant_options}': item.variantOptions || '',\r\n    '{line_note}': item.note || '',\r\n  }));\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;CAGC,GAED;AAAA;;AAmDO,SAAS,6BAA6B,KAA6B,EAAE,aAA4B;IACtG,OAAO;QACL,GAAG,IAAA,uIAAY,EAAC,cAAc;QAE9B,8BAA8B;QAC9B,mBAAmB,MAAM,QAAQ,EAAE,QAAQ,cAAc,IAAI,IAAI;QACjE,sBAAsB,MAAM,QAAQ,EAAE,WAAW,cAAc,OAAO,IAAI;QAC1E,uBAAuB,MAAM,QAAQ,EAAE,YAAY;QACnD,oBAAoB,cAAc,QAAQ,IAAI;QAE9C,oCAAoC;QACpC,UAAU,MAAM,IAAI;QACpB,oBAAoB,MAAM,IAAI;QAC9B,gBAAgB,IAAA,qIAAU,EAAC,MAAM,SAAS;QAC1C,qBAAqB,IAAA,qIAAU,EAAC,MAAM,SAAS;QAC/C,iBAAiB,IAAA,qIAAU,EAAC,MAAM,UAAU;QAC5C,sBAAsB,IAAA,qIAAU,EAAC,MAAM,UAAU;QACjD,iBAAiB,IAAA,qIAAU,EAAC,MAAM,UAAU;QAC5C,sBAAsB,IAAA,qIAAU,EAAC,MAAM,UAAU;QACjD,kBAAkB,MAAM,SAAS,IAAI;QACrC,YAAY,MAAM,MAAM,IAAI;QAC5B,sBAAsB,MAAM,MAAM,IAAI;QACtC,YAAY,MAAM,MAAM,IAAI;QAE5B,eAAe;QACf,WAAW,MAAM,aAAa,EAAE,cAAc;QAC9C,iBAAiB,MAAM,aAAa,EAAE,cAAc;QACpD,mBAAmB,MAAM,YAAY,EAAE,cAAc;QACrD,oBAAoB,MAAM,aAAa,EAAE,cAAc;QAEvD,UAAU,MAAM,IAAI,IAAI;IAC1B;AACF;AAEO,SAAS,2BAA2B,KAAsC;IAC/E,OAAO,MAAM,GAAG,CAAC,CAAC,MAAM,QAAU,CAAC;YACjC,cAAc,CAAC,QAAQ,CAAC,EAAE,QAAQ;YAClC,uBAAuB,KAAK,WAAW,IAAI;YAC3C,uBAAuB,KAAK,WAAW;YACvC,uBAAuB,KAAK,WAAW,IAAI;YAC3C,kBAAkB,KAAK,WAAW,IAAI;YACtC,0BAA0B,KAAK,OAAO,IAAI;YAC1C,eAAe,KAAK,IAAI,IAAI;YAC5B,yBAAyB,KAAK,aAAa,CAAC,QAAQ;YACpD,kBAAkB,KAAK,aAAa,CAAC,QAAQ;YAC7C,yBAAyB,KAAK,aAAa,CAAC,QAAQ;YACpD,wBAAwB,KAAK,aAAa,CAAC,QAAQ;YACnD,0BAA0B,KAAK,cAAc,CAAC,QAAQ;YACtD,qBAAqB,KAAK,cAAc,CAAC,QAAQ;YACjD,iBAAiB,KAAK,MAAM,IAAI;YAChC,gBAAgB,KAAK,KAAK,IAAI;YAC9B,mBAAmB,KAAK,QAAQ,IAAI;YACpC,0BAA0B,KAAK,cAAc,IAAI;YACjD,eAAe,KAAK,IAAI,IAAI;QAC9B,CAAC;AACH"}},
    {"offset": {"line": 4115, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/warranty.mapper.ts"],"sourcesContent":["/**\r\n * Warranty Mapper - Phiếu bảo hành\r\n * Đồng bộ với variables/phieu-bao-hanh.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatDate,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface WarrantyForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  createdAt: string | Date;\r\n  modifiedAt?: string | Date;\r\n  createdBy?: string;\r\n  status?: string;\r\n  claimStatus?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // Thông tin khách hàng\r\n  customerName: string;\r\n  customerPhone?: string;\r\n  customerAddress?: string;\r\n  customerGroup?: string;\r\n  \r\n  // Thông tin đơn hàng liên quan\r\n  orderCode?: string;\r\n  \r\n  // Thông tin sản phẩm bảo hành (đơn lẻ - backward compatibility)\r\n  productName?: string;\r\n  variantName?: string;\r\n  variantSku?: string;\r\n  barcode?: string;\r\n  serialNumber?: string;\r\n  warrantyPolicyName?: string;\r\n  warrantyPeriod?: string;\r\n  warrantyPeriodDays?: number;\r\n  startDate?: string | Date;\r\n  endDate?: string | Date;\r\n  \r\n  // Danh sách sản phẩm (nhiều sản phẩm)\r\n  items?: Array<{\r\n    productName: string;\r\n    variantName?: string;\r\n    variantSku?: string;\r\n    barcode?: string;\r\n    serial?: string;\r\n    warrantyPolicyName?: string;\r\n    warrantyPeriod?: string;\r\n    warrantyPeriodDays?: number;\r\n    startDate?: string | Date;\r\n    endDate?: string | Date;\r\n  }>;\r\n  \r\n  issueDescription?: string;\r\n  note?: string;\r\n}\r\n\r\nexport function mapWarrantyToPrintData(warranty: WarrantyForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': warranty.location?.name || storeSettings.name || '',\r\n    '{location_address}': warranty.location?.address || storeSettings.address || '',\r\n    '{location_province}': warranty.location?.province || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === THÔNG TIN PHIẾU BẢO HÀNH ===\r\n    '{warranty_card_code}': warranty.code,\r\n    '{warranty_code}': warranty.code,\r\n    '{created_on}': formatDate(warranty.createdAt),\r\n    '{modified_on}': formatDate(warranty.modifiedAt),\r\n    '{account_name}': warranty.createdBy || '',\r\n    '{status}': warranty.status || '',\r\n    '{claim_status}': warranty.claimStatus || '',\r\n    \r\n    // === THÔNG TIN KHÁCH HÀNG ===\r\n    '{customer_name}': warranty.customerName,\r\n    '{customer_phone_number}': warranty.customerPhone || '',\r\n    '{customer_address1}': warranty.customerAddress || '',\r\n    '{customer_address}': warranty.customerAddress || '',\r\n    '{customer_group}': warranty.customerGroup || '',\r\n    \r\n    // === THÔNG TIN ĐƠN HÀNG ===\r\n    '{order_code}': warranty.orderCode || '',\r\n    \r\n    // === THÔNG TIN SẢN PHẨM (ĐƠN LẺ) ===\r\n    '{line_product_name}': warranty.productName || '',\r\n    '{product_name}': warranty.productName || '',\r\n    '{line_variant_name}': warranty.variantName || '',\r\n    '{line_variant_sku}': warranty.variantSku || '',\r\n    '{line_variant_barcode}': warranty.barcode || '',\r\n    '{serials}': warranty.serialNumber || '',\r\n    '{serial_number}': warranty.serialNumber || '',\r\n    '{term_name}': warranty.warrantyPolicyName || '',\r\n    '{term_number}': warranty.warrantyPeriod || '',\r\n    '{warranty_duration}': warranty.warrantyPeriod || '',\r\n    '{warranty_period_days}': warranty.warrantyPeriodDays?.toString() || '',\r\n    '{start_date}': formatDate(warranty.startDate),\r\n    '{end_date}': formatDate(warranty.endDate),\r\n    '{warranty_expired_on}': formatDate(warranty.endDate),\r\n    \r\n    '{issue_description}': warranty.issueDescription || '',\r\n    '{warranty_note}': warranty.note || '',\r\n  };\r\n}\r\n\r\nexport function mapWarrantyLineItems(items: WarrantyForPrint['items']): PrintLineItem[] {\r\n  if (!items) return [];\r\n  \r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_product_name}': item.productName,\r\n    '{line_variant_name}': item.variantName || '',\r\n    '{line_variant_sku}': item.variantSku || '',\r\n    '{line_variant_barcode}': item.barcode || '',\r\n    '{serials}': item.serial || '',\r\n    '{term_name}': item.warrantyPolicyName || '',\r\n    '{term_number}': item.warrantyPeriod || '',\r\n    '{warranty_period_days}': item.warrantyPeriodDays?.toString() || '',\r\n    '{start_date}': formatDate(item.startDate),\r\n    '{end_date}': formatDate(item.endDate),\r\n  }));\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;CAGC,GAED;AAAA;;AA+DO,SAAS,uBAAuB,QAA0B,EAAE,aAA4B;IAC7F,OAAO;QACL,GAAG,IAAA,uIAAY,EAAC,cAAc;QAE9B,8BAA8B;QAC9B,mBAAmB,SAAS,QAAQ,EAAE,QAAQ,cAAc,IAAI,IAAI;QACpE,sBAAsB,SAAS,QAAQ,EAAE,WAAW,cAAc,OAAO,IAAI;QAC7E,uBAAuB,SAAS,QAAQ,EAAE,YAAY;QACtD,oBAAoB,cAAc,QAAQ,IAAI;QAE9C,mCAAmC;QACnC,wBAAwB,SAAS,IAAI;QACrC,mBAAmB,SAAS,IAAI;QAChC,gBAAgB,IAAA,qIAAU,EAAC,SAAS,SAAS;QAC7C,iBAAiB,IAAA,qIAAU,EAAC,SAAS,UAAU;QAC/C,kBAAkB,SAAS,SAAS,IAAI;QACxC,YAAY,SAAS,MAAM,IAAI;QAC/B,kBAAkB,SAAS,WAAW,IAAI;QAE1C,+BAA+B;QAC/B,mBAAmB,SAAS,YAAY;QACxC,2BAA2B,SAAS,aAAa,IAAI;QACrD,uBAAuB,SAAS,eAAe,IAAI;QACnD,sBAAsB,SAAS,eAAe,IAAI;QAClD,oBAAoB,SAAS,aAAa,IAAI;QAE9C,6BAA6B;QAC7B,gBAAgB,SAAS,SAAS,IAAI;QAEtC,sCAAsC;QACtC,uBAAuB,SAAS,WAAW,IAAI;QAC/C,kBAAkB,SAAS,WAAW,IAAI;QAC1C,uBAAuB,SAAS,WAAW,IAAI;QAC/C,sBAAsB,SAAS,UAAU,IAAI;QAC7C,0BAA0B,SAAS,OAAO,IAAI;QAC9C,aAAa,SAAS,YAAY,IAAI;QACtC,mBAAmB,SAAS,YAAY,IAAI;QAC5C,eAAe,SAAS,kBAAkB,IAAI;QAC9C,iBAAiB,SAAS,cAAc,IAAI;QAC5C,uBAAuB,SAAS,cAAc,IAAI;QAClD,0BAA0B,SAAS,kBAAkB,EAAE,cAAc;QACrE,gBAAgB,IAAA,qIAAU,EAAC,SAAS,SAAS;QAC7C,cAAc,IAAA,qIAAU,EAAC,SAAS,OAAO;QACzC,yBAAyB,IAAA,qIAAU,EAAC,SAAS,OAAO;QAEpD,uBAAuB,SAAS,gBAAgB,IAAI;QACpD,mBAAmB,SAAS,IAAI,IAAI;IACtC;AACF;AAEO,SAAS,qBAAqB,KAAgC;IACnE,IAAI,CAAC,OAAO,OAAO,EAAE;IAErB,OAAO,MAAM,GAAG,CAAC,CAAC,MAAM,QAAU,CAAC;YACjC,cAAc,CAAC,QAAQ,CAAC,EAAE,QAAQ;YAClC,uBAAuB,KAAK,WAAW;YACvC,uBAAuB,KAAK,WAAW,IAAI;YAC3C,sBAAsB,KAAK,UAAU,IAAI;YACzC,0BAA0B,KAAK,OAAO,IAAI;YAC1C,aAAa,KAAK,MAAM,IAAI;YAC5B,eAAe,KAAK,kBAAkB,IAAI;YAC1C,iBAAiB,KAAK,cAAc,IAAI;YACxC,0BAA0B,KAAK,kBAAkB,EAAE,cAAc;YACjE,gBAAgB,IAAA,qIAAU,EAAC,KAAK,SAAS;YACzC,cAAc,IAAA,qIAAU,EAAC,KAAK,OAAO;QACvC,CAAC;AACH"}},
    {"offset": {"line": 4190, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/supplier-return.mapper.ts"],"sourcesContent":["/**\r\n * Supplier Return Mapper - Phiếu trả hàng NCC\r\n * Đồng bộ với variables/phieu-tra-hang-ncc.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatCurrency,\r\n  formatDate,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface SupplierReturnForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  createdAt: string | Date;\r\n  modifiedAt?: string | Date;\r\n  createdBy?: string;\r\n  purchaseOrderCode?: string;\r\n  reference?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // Thông tin NCC\r\n  supplierName: string;\r\n  supplierCode?: string;\r\n  supplierPhone?: string;\r\n  supplierAddress?: string;\r\n  supplierEmail?: string;\r\n  \r\n  // Danh sách sản phẩm\r\n  items: Array<{\r\n    variantCode?: string;\r\n    variantSku?: string;\r\n    productName: string;\r\n    variantName?: string;\r\n    barcode?: string;\r\n    unit?: string;\r\n    quantity: number;\r\n    price: number;\r\n    priceAfterDiscount?: number;\r\n    discountRate?: number;\r\n    discountAmount?: number;\r\n    taxRate?: number;\r\n    amount: number;\r\n    amountNoneDiscount?: number;\r\n    serial?: string;\r\n    lotNumber?: string;\r\n    lotInfo?: string;\r\n    lotInfoQty?: string;\r\n    lotInfoExpiry?: string;\r\n  }>;\r\n  \r\n  // Tổng giá trị\r\n  reason?: string;\r\n  totalQuantity: number;\r\n  totalAmount?: number;\r\n  totalTax?: number;\r\n  totalLandedCosts?: number;\r\n  totalDiscounts?: number;\r\n  totalPrice?: number;\r\n  discrepancyPrice?: number;\r\n  discrepancyReason?: string;\r\n  transactionRefundAmount?: number;\r\n  transactionRefundMethodName?: string;\r\n  transactionRefundMethodAmount?: number;\r\n  remaining?: number;\r\n}\r\n\r\nexport function mapSupplierReturnToPrintData(ret: SupplierReturnForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': ret.location?.name || storeSettings.name || '',\r\n    '{location_address}': ret.location?.address || storeSettings.address || '',\r\n    '{location_province}': ret.location?.province || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === THÔNG TIN PHIẾU HOÀN TRẢ ===\r\n    '{refund_code}': ret.code,\r\n    '{return_supplier_code}': ret.code,\r\n    '{created_on}': formatDate(ret.createdAt),\r\n    '{modified_on}': formatDate(ret.modifiedAt),\r\n    '{account_name}': ret.createdBy || '',\r\n    '{purchase_order_code}': ret.purchaseOrderCode || '',\r\n    '{reference}': ret.reference || '',\r\n    \r\n    // === THÔNG TIN NHÀ CUNG CẤP ===\r\n    '{supplier_name}': ret.supplierName,\r\n    '{supplier_code}': ret.supplierCode || '',\r\n    '{supplier_phone_number}': ret.supplierPhone || '',\r\n    '{supplier_email}': ret.supplierEmail || '',\r\n    '{supplier_address}': ret.supplierAddress || '',\r\n    '{supplier_address1}': ret.supplierAddress || '',\r\n    \r\n    // === TỔNG GIÁ TRỊ ===\r\n    '{note}': ret.reason || '',\r\n    '{reason_return}': ret.reason || '',\r\n    '{total_quantity}': ret.totalQuantity.toString(),\r\n    '{total_amount}': formatCurrency(ret.totalAmount),\r\n    '{total_order}': formatCurrency(ret.totalAmount),\r\n    '{total_tax}': formatCurrency(ret.totalTax),\r\n    '{total_landed_costs}': formatCurrency(ret.totalLandedCosts),\r\n    '{total_discounts}': formatCurrency(ret.totalDiscounts),\r\n    '{total_price}': formatCurrency(ret.totalPrice),\r\n    '{discrepancy_price}': formatCurrency(ret.discrepancyPrice),\r\n    '{discrepancy_reason}': ret.discrepancyReason || '',\r\n    '{transaction_refund_amount}': formatCurrency(ret.transactionRefundAmount),\r\n    '{refunded}': formatCurrency(ret.transactionRefundAmount),\r\n    '{transaction_refund_method_name}': ret.transactionRefundMethodName || '',\r\n    '{transaction_refund_method_amount}': formatCurrency(ret.transactionRefundMethodAmount),\r\n    '{remaining}': formatCurrency(ret.remaining),\r\n  };\r\n}\r\n\r\nexport function mapSupplierReturnLineItems(items: SupplierReturnForPrint['items']): PrintLineItem[] {\r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_variant_sku}': item.variantSku || item.variantCode || '',\r\n    '{line_variant_code}': item.variantCode || '',\r\n    '{line_product_name}': item.productName,\r\n    '{line_variant_name}': item.variantName || '',\r\n    '{line_variant}': item.variantName || '',\r\n    '{line_variant_barcode}': item.barcode || '',\r\n    '{line_unit}': item.unit || 'Cái',\r\n    '{line_quantity}': item.quantity.toString(),\r\n    '{line_price}': formatCurrency(item.price),\r\n    '{line_price_after_discount}': formatCurrency(item.priceAfterDiscount),\r\n    '{line_discount_rate}': item.discountRate ? `${item.discountRate}%` : '',\r\n    '{line_discount_amount}': formatCurrency(item.discountAmount),\r\n    '{tax_lines_rate}': item.taxRate ? `${item.taxRate}%` : '',\r\n    '{line_amount}': formatCurrency(item.amount),\r\n    '{line_total}': formatCurrency(item.amount),\r\n    '{line_amount_none_discount}': formatCurrency(item.amountNoneDiscount),\r\n    '{serials}': item.serial || '',\r\n    '{lots_number_code1}': item.lotNumber || '',\r\n    '{lots_number_code2}': item.lotInfoQty || '',\r\n    '{lots_number_code3}': item.lotInfo || '',\r\n    '{lots_number_code4}': item.lotInfoExpiry || '',\r\n  }));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4274, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/complaint.mapper.ts"],"sourcesContent":["/**\r\n * Complaint Mapper - Phiếu khiếu nại\r\n * Đồng bộ với variables/phieu-khieu-nai.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  formatCurrency,\r\n  formatDate,\r\n  formatTime,\r\n  numberToWords,\r\n  hidePhoneMiddle,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface ComplaintForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  createdAt: string | Date;\r\n  modifiedAt?: string | Date;\r\n  createdBy?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    province?: string;\r\n    phone?: string;\r\n  };\r\n  \r\n  // Thông tin khách hàng\r\n  customerName: string;\r\n  customerCode?: string;\r\n  customerPhone?: string;\r\n  customerPhoneHide?: boolean;\r\n  customerEmail?: string;\r\n  customerAddress?: string;\r\n  customerGroup?: string;\r\n  \r\n  // Thông tin đơn hàng liên quan\r\n  orderCode?: string;\r\n  orderCreatedAt?: string | Date;\r\n  orderTotal?: number;\r\n  \r\n  // Thông tin khiếu nại\r\n  complaintType?: string;\r\n  category?: string;\r\n  priority?: string;\r\n  source?: string;\r\n  subject: string;\r\n  description: string;\r\n  customerRequest?: string;\r\n  \r\n  // Sản phẩm (Single - Legacy support)\r\n  productName?: string;\r\n  variantName?: string;\r\n  variantCode?: string;\r\n\r\n  // Danh sách sản phẩm (Multiple)\r\n  items?: Array<{\r\n    productName: string;\r\n    variantCode?: string;\r\n    quantity?: number;\r\n    issue?: string;\r\n    resolution?: string;\r\n  }>;\r\n  \r\n  // Trạng thái & Xử lý\r\n  status?: string;\r\n  assignedTo?: string;\r\n  assigneeId?: string;\r\n  resolution?: string;\r\n  resolutionNote?: string;\r\n  resolvedAt?: string | Date;\r\n  responseDeadline?: string | Date;\r\n  \r\n  // Chi phí bồi thường (nếu có)\r\n  compensationAmount?: number;\r\n  \r\n  note?: string;\r\n}\r\n\r\nconst COMPLAINT_STATUS_MAP: Record<string, string> = {\r\n  'new': 'Mới',\r\n  'investigating': 'Đang xử lý',\r\n  'resolved': 'Đã giải quyết',\r\n  'closed': 'Đã đóng',\r\n  'cancelled': 'Đã hủy'\r\n};\r\n\r\nconst COMPLAINT_TYPE_MAP: Record<string, string> = {\r\n  'missing-items': 'Thiếu hàng',\r\n  'damaged-items': 'Hàng hư hỏng',\r\n  'wrong-items': 'Sai hàng',\r\n  'late-delivery': 'Giao hàng chậm',\r\n  'service-quality': 'Chất lượng dịch vụ',\r\n  'other': 'Khác'\r\n};\r\n\r\nexport function mapComplaintToPrintData(complaint: ComplaintForPrint, storeSettings: StoreSettings): PrintData {\r\n  const phone = complaint.customerPhoneHide \r\n    ? hidePhoneMiddle(complaint.customerPhone || '')\r\n    : (complaint.customerPhone || '');\r\n  \r\n  const statusVi = COMPLAINT_STATUS_MAP[complaint.status || ''] || complaint.status || '';\r\n  const typeVi = COMPLAINT_TYPE_MAP[complaint.complaintType || ''] || complaint.complaintType || '';\r\n  \r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': complaint.location?.name || storeSettings.name || '',\r\n    '{location_address}': complaint.location?.address || storeSettings.address || '',\r\n    '{location_province}': complaint.location?.province || '',\r\n    '{location_phone}': complaint.location?.phone || storeSettings.phone || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === THÔNG TIN PHIẾU KHIẾU NẠI ===\r\n    '{complaint_code}': complaint.code,\r\n    '{created_on}': formatDate(complaint.createdAt),\r\n    '{created_on_time}': formatTime(complaint.createdAt),\r\n    '{modified_on}': formatDate(complaint.modifiedAt),\r\n    '{account_name}': complaint.createdBy || '',\r\n    \r\n    // === THÔNG TIN KHÁCH HÀNG ===\r\n    '{customer_name}': complaint.customerName,\r\n    '{customer_code}': complaint.customerCode || '',\r\n    '{customer_phone}': phone,\r\n    '{customer_phone_number}': phone,\r\n    '{customer_phone_hide}': hidePhoneMiddle(complaint.customerPhone || ''),\r\n    '{customer_email}': complaint.customerEmail || '',\r\n    '{customer_address}': complaint.customerAddress || '',\r\n    '{customer_group}': complaint.customerGroup || '',\r\n    \r\n    // === THÔNG TIN ĐƠN HÀNG LIÊN QUAN ===\r\n    '{order_code}': complaint.orderCode || '',\r\n    '{order_date}': formatDate(complaint.orderCreatedAt),\r\n    '{order_created_on}': formatDate(complaint.orderCreatedAt),\r\n    '{order_total}': formatCurrency(complaint.orderTotal),\r\n    \r\n    // === THÔNG TIN KHIẾU NẠI ===\r\n    '{complaint_type}': typeVi,\r\n    '{complaint_category}': complaint.category || '',\r\n    '{complaint_priority}': complaint.priority || '',\r\n    '{complaint_source}': complaint.source || '',\r\n    '{complaint_subject}': complaint.subject,\r\n    '{complaint_description}': complaint.description,\r\n    '{customer_request}': complaint.customerRequest || '',\r\n    \r\n    // === SẢN PHẨM LIÊN QUAN ===\r\n    '{line_product_name}': complaint.productName || '',\r\n    '{line_variant}': complaint.variantName || '',\r\n    '{line_variant_code}': complaint.variantCode || '',\r\n    \r\n    // === TRẠNG THÁI & XỬ LÝ ===\r\n    '{complaint_status}': statusVi,\r\n    '{status}': statusVi,\r\n    '{assigned_to}': complaint.assignedTo || '',\r\n    '{assignee_name}': complaint.assignedTo || '',\r\n    '{resolution}': complaint.resolution || '',\r\n    '{resolution_note}': complaint.resolutionNote || '',\r\n    '{resolved_on}': formatDate(complaint.resolvedAt),\r\n    '{resolved_on_time}': formatTime(complaint.resolvedAt),\r\n    '{response_deadline}': formatDate(complaint.responseDeadline),\r\n    \r\n    // === CHI PHÍ BỒI THƯỜNG ===\r\n    '{compensation_amount}': formatCurrency(complaint.compensationAmount),\r\n    '{compensation_amount_text}': numberToWords(complaint.compensationAmount || 0),\r\n    \r\n    '{note}': complaint.note || '',\r\n    '{complaint_note}': complaint.note || '',\r\n  };\r\n}\r\n\r\nexport function mapComplaintLineItems(items: ComplaintForPrint['items']): import('./types').PrintLineItem[] {\r\n  if (!items) return [];\r\n  \r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_product_name}': item.productName,\r\n    '{line_variant_code}': item.variantCode || '',\r\n    '{line_quantity}': item.quantity?.toString() || '',\r\n    '{line_issue}': item.issue || '',\r\n    '{line_resolution}': item.resolution || '',\r\n  }));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4377, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/penalty.mapper.ts"],"sourcesContent":["/**\r\n * Penalty Mapper - Phiếu phạt\r\n * Đồng bộ với variables/phieu-phat.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  formatCurrency,\r\n  numberToWords,\r\n  formatDate,\r\n  formatTime,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface PenaltyForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  createdAt: string | Date;\r\n  modifiedAt?: string | Date;\r\n  createdBy?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    province?: string;\r\n    phone?: string;\r\n  };\r\n  \r\n  // Thông tin nhân viên\r\n  employeeName: string;\r\n  employeeCode?: string;\r\n  employeePhone?: string;\r\n  employeeEmail?: string;\r\n  employeePosition?: string;\r\n  department?: string;\r\n  \r\n  // Thông tin vi phạm\r\n  penaltyDate: string | Date;\r\n  violationType?: string;\r\n  violationDescription?: string;\r\n  violationEvidence?: string;\r\n  violationCount?: number;\r\n  \r\n  // Thông tin phạt\r\n  penaltyType: string;\r\n  penaltyLevel?: string;\r\n  reason: string;\r\n  amount: number;\r\n  deductionMethod?: string;\r\n  deductionPeriod?: string;\r\n  \r\n  // Phê duyệt\r\n  status?: string;\r\n  approvedBy?: string;\r\n  approvedAt?: string | Date;\r\n  rejectedBy?: string;\r\n  rejectedAt?: string | Date;\r\n  rejectionReason?: string;\r\n  \r\n  // Thông tin bổ sung\r\n  witnessName?: string;\r\n  witnessSignature?: string;\r\n  employeeAcknowledgement?: boolean;\r\n  employeeSignatureDate?: string | Date;\r\n  \r\n  note?: string;\r\n}\r\n\r\nexport function mapPenaltyToPrintData(penalty: PenaltyForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': penalty.location?.name || storeSettings.name || '',\r\n    '{location_address}': penalty.location?.address || storeSettings.address || '',\r\n    '{location_province}': penalty.location?.province || '',\r\n    '{location_phone}': penalty.location?.phone || storeSettings.phone || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === THÔNG TIN PHIẾU PHẠT ===\r\n    '{penalty_code}': penalty.code,\r\n    '{created_on}': formatDate(penalty.createdAt),\r\n    '{created_on_time}': formatTime(penalty.createdAt),\r\n    '{modified_on}': formatDate(penalty.modifiedAt),\r\n    '{account_name}': penalty.createdBy || '',\r\n    \r\n    // === THÔNG TIN NHÂN VIÊN ===\r\n    '{employee_name}': penalty.employeeName,\r\n    '{employee_code}': penalty.employeeCode || '',\r\n    '{employee_phone}': penalty.employeePhone || '',\r\n    '{employee_email}': penalty.employeeEmail || '',\r\n    '{employee_position}': penalty.employeePosition || '',\r\n    '{position_name}': penalty.employeePosition || '',\r\n    '{department_name}': penalty.department || '',\r\n    '{department}': penalty.department || '',\r\n    \r\n    // === THÔNG TIN VI PHẠM ===\r\n    '{penalty_date}': formatDate(penalty.penaltyDate),\r\n    '{penalty_date_time}': formatTime(penalty.penaltyDate),\r\n    '{violation_date}': formatDate(penalty.penaltyDate),\r\n    '{violation_type}': penalty.violationType || '',\r\n    '{violation_description}': penalty.violationDescription || '',\r\n    '{violation_evidence}': penalty.violationEvidence || '',\r\n    '{evidence}': penalty.violationEvidence || '',\r\n    '{violation_count}': penalty.violationCount?.toString() || '',\r\n    \r\n    // === THÔNG TIN PHẠT ===\r\n    '{penalty_type}': penalty.penaltyType,\r\n    '{penalty_level}': penalty.penaltyLevel || '',\r\n    '{penalty_reason}': penalty.reason,\r\n    '{reason}': penalty.reason,\r\n    '{penalty_amount}': formatCurrency(penalty.amount),\r\n    '{amount}': formatCurrency(penalty.amount),\r\n    '{penalty_amount_text}': numberToWords(penalty.amount),\r\n    '{deduction_method}': penalty.deductionMethod || 'Trừ lương',\r\n    '{deduction_period}': penalty.deductionPeriod || '',\r\n    \r\n    // === PHÊ DUYỆT ===\r\n    '{status}': penalty.status || '',\r\n    '{approved_by}': penalty.approvedBy || '',\r\n    '{approved_on}': formatDate(penalty.approvedAt),\r\n    '{approved_on_time}': formatTime(penalty.approvedAt),\r\n    '{rejected_by}': penalty.rejectedBy || '',\r\n    '{rejected_on}': formatDate(penalty.rejectedAt),\r\n    '{rejection_reason}': penalty.rejectionReason || '',\r\n    \r\n    // === THÔNG TIN BỔ SUNG ===\r\n    '{witness_name}': penalty.witnessName || '',\r\n    '{witness_signature}': penalty.witnessSignature || '',\r\n    '{employee_acknowledgement}': penalty.employeeAcknowledgement ? 'Đã xác nhận' : '',\r\n    '{employee_signature_date}': formatDate(penalty.employeeSignatureDate),\r\n    \r\n    '{penalty_note}': penalty.note || '',\r\n    '{note}': penalty.note || '',\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GAED;AAAA;;AAiEO,SAAS,sBAAsB,OAAwB,EAAE,aAA4B;IAC1F,OAAO;QACL,GAAG,IAAA,uIAAY,EAAC,cAAc;QAE9B,8BAA8B;QAC9B,mBAAmB,QAAQ,QAAQ,EAAE,QAAQ,cAAc,IAAI,IAAI;QACnE,sBAAsB,QAAQ,QAAQ,EAAE,WAAW,cAAc,OAAO,IAAI;QAC5E,uBAAuB,QAAQ,QAAQ,EAAE,YAAY;QACrD,oBAAoB,QAAQ,QAAQ,EAAE,SAAS,cAAc,KAAK,IAAI;QACtE,oBAAoB,cAAc,QAAQ,IAAI;QAE9C,+BAA+B;QAC/B,kBAAkB,QAAQ,IAAI;QAC9B,gBAAgB,IAAA,qIAAU,EAAC,QAAQ,SAAS;QAC5C,qBAAqB,IAAA,qIAAU,EAAC,QAAQ,SAAS;QACjD,iBAAiB,IAAA,qIAAU,EAAC,QAAQ,UAAU;QAC9C,kBAAkB,QAAQ,SAAS,IAAI;QAEvC,8BAA8B;QAC9B,mBAAmB,QAAQ,YAAY;QACvC,mBAAmB,QAAQ,YAAY,IAAI;QAC3C,oBAAoB,QAAQ,aAAa,IAAI;QAC7C,oBAAoB,QAAQ,aAAa,IAAI;QAC7C,uBAAuB,QAAQ,gBAAgB,IAAI;QACnD,mBAAmB,QAAQ,gBAAgB,IAAI;QAC/C,qBAAqB,QAAQ,UAAU,IAAI;QAC3C,gBAAgB,QAAQ,UAAU,IAAI;QAEtC,4BAA4B;QAC5B,kBAAkB,IAAA,qIAAU,EAAC,QAAQ,WAAW;QAChD,uBAAuB,IAAA,qIAAU,EAAC,QAAQ,WAAW;QACrD,oBAAoB,IAAA,qIAAU,EAAC,QAAQ,WAAW;QAClD,oBAAoB,QAAQ,aAAa,IAAI;QAC7C,2BAA2B,QAAQ,oBAAoB,IAAI;QAC3D,wBAAwB,QAAQ,iBAAiB,IAAI;QACrD,cAAc,QAAQ,iBAAiB,IAAI;QAC3C,qBAAqB,QAAQ,cAAc,EAAE,cAAc;QAE3D,yBAAyB;QACzB,kBAAkB,QAAQ,WAAW;QACrC,mBAAmB,QAAQ,YAAY,IAAI;QAC3C,oBAAoB,QAAQ,MAAM;QAClC,YAAY,QAAQ,MAAM;QAC1B,oBAAoB,IAAA,yIAAc,EAAC,QAAQ,MAAM;QACjD,YAAY,IAAA,yIAAc,EAAC,QAAQ,MAAM;QACzC,yBAAyB,IAAA,wIAAa,EAAC,QAAQ,MAAM;QACrD,sBAAsB,QAAQ,eAAe,IAAI;QACjD,sBAAsB,QAAQ,eAAe,IAAI;QAEjD,oBAAoB;QACpB,YAAY,QAAQ,MAAM,IAAI;QAC9B,iBAAiB,QAAQ,UAAU,IAAI;QACvC,iBAAiB,IAAA,qIAAU,EAAC,QAAQ,UAAU;QAC9C,sBAAsB,IAAA,qIAAU,EAAC,QAAQ,UAAU;QACnD,iBAAiB,QAAQ,UAAU,IAAI;QACvC,iBAAiB,IAAA,qIAAU,EAAC,QAAQ,UAAU;QAC9C,sBAAsB,QAAQ,eAAe,IAAI;QAEjD,4BAA4B;QAC5B,kBAAkB,QAAQ,WAAW,IAAI;QACzC,uBAAuB,QAAQ,gBAAgB,IAAI;QACnD,8BAA8B,QAAQ,uBAAuB,GAAG,gBAAgB;QAChF,6BAA6B,IAAA,qIAAU,EAAC,QAAQ,qBAAqB;QAErE,kBAAkB,QAAQ,IAAI,IAAI;QAClC,UAAU,QAAQ,IAAI,IAAI;IAC5B;AACF"}},
    {"offset": {"line": 4451, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/supplier-order.mapper.ts"],"sourcesContent":["/**\r\n * Supplier Order Mapper - Đơn đặt hàng nhập (don-dat-hang-nhap)\r\n * Đồng bộ với variables/don-dat-hang-nhap.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatCurrency,\r\n  formatDate,\r\n  formatTime,\r\n  numberToWords,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface SupplierOrderForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  createdAt: string | Date;\r\n  modifiedOn?: string | Date;\r\n  receivedOn?: string | Date;\r\n  dueOn?: string | Date;\r\n  completedOn?: string | Date;\r\n  endedOn?: string | Date;\r\n  cancelledOn?: string | Date;\r\n  \r\n  reference?: string;\r\n  billingAddress?: string;\r\n  \r\n  // Nhân viên\r\n  createdBy?: string;\r\n  assigneeName?: string;\r\n  \r\n  // Trạng thái\r\n  status?: string;\r\n  receivedStatus?: string;\r\n  financialStatus?: string;\r\n  refundStatus?: string;\r\n  refundTransactionStatus?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // Thông tin NCC\r\n  supplierName: string;\r\n  supplierCode?: string;\r\n  supplierPhone?: string;\r\n  supplierEmail?: string;\r\n  supplierAddress?: string;\r\n  \r\n  // Nợ NCC\r\n  supplierDebt?: number;\r\n  supplierDebtPrev?: number;\r\n  \r\n  // Khối lượng\r\n  totalWeightG?: number;\r\n  totalWeightKg?: number;\r\n  \r\n  // Tags\r\n  tags?: string[];\r\n  \r\n  // Danh sách sản phẩm\r\n  items: Array<{\r\n    variantCode?: string;\r\n    productName: string;\r\n    variantName?: string;\r\n    variantOptions?: string;\r\n    title?: string;\r\n    barcode?: string;\r\n    brand?: string;\r\n    unit?: string;\r\n    quantity: number;\r\n    receivedQuantity?: number;\r\n    price: number;\r\n    priceAfterDiscount?: number;\r\n    discountRate?: number;\r\n    discountAmount?: number;\r\n    taxRate?: number;\r\n    taxAmount?: number;\r\n    taxType?: string;\r\n    taxIncluded?: number;\r\n    taxExclude?: number;\r\n    amount: number;\r\n    category?: string;\r\n    weightG?: number;\r\n    weightKg?: number;\r\n    note?: string;\r\n    serials?: string[];\r\n    lots?: string[];\r\n  }>;\r\n  \r\n  // Tổng giá trị\r\n  totalQuantity: number;\r\n  totalPrice: number;\r\n  totalLineAmount?: number;\r\n  totalTax?: number;\r\n  totalExtraTax?: number;\r\n  totalDiscounts?: number;\r\n  totalDiscountsRate?: number;\r\n  totalDiscountsValue?: number;\r\n  totalTaxIncludedLine?: number;\r\n  totalAmountBeforeTax?: number;\r\n  totalAmountAfterTax?: number;\r\n  \r\n  totalTransactionAmount?: number;\r\n  totalRemain?: number;\r\n  totalAmountTransaction?: number;\r\n  totalLandedCosts?: number;\r\n  productDiscount?: number;\r\n  \r\n  payments?: Array<{\r\n    code: string;\r\n    amount: number;\r\n    method: string;\r\n    date: string | Date;\r\n  }>;\r\n  \r\n  note?: string;\r\n}\r\n\r\nexport function mapSupplierOrderToPrintData(order: SupplierOrderForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': order.location?.name || storeSettings.name || '',\r\n    '{location_address}': order.location?.address || storeSettings.address || '',\r\n    '{location_province}': order.location?.province || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    \r\n    // === THÔNG TIN ĐƠN ĐẶT HÀNG NHẬP ===\r\n    '{order_supplier_code}': order.code,\r\n    '{purchase_order_code}': order.code,\r\n    '{code}': order.code,\r\n    '{status}': order.status || '',\r\n    '{received_status}': order.receivedStatus || '',\r\n    '{financial_status}': order.financialStatus || '',\r\n    '{refund_status}': order.refundStatus || '',\r\n    '{refund_transaction_status}': order.refundTransactionStatus || '',\r\n    \r\n    '{created_on}': formatDate(order.createdAt),\r\n    '{created_on_time}': formatTime(order.createdAt),\r\n    '{modified_on}': formatDate(order.modifiedOn),\r\n    '{modified_on_time}': formatTime(order.modifiedOn),\r\n    '{received_on}': formatDate(order.receivedOn),\r\n    '{received_on_time}': formatTime(order.receivedOn),\r\n    '{due_on}': formatDate(order.dueOn),\r\n    '{due_on_time}': formatTime(order.dueOn),\r\n    '{completed_on}': formatDate(order.completedOn),\r\n    '{ended_on}': formatDate(order.endedOn),\r\n    '{cancelled_on}': formatDate(order.cancelledOn),\r\n    \r\n    '{activated_account_name}': order.createdBy || '',\r\n    '{account_name}': order.createdBy || '',\r\n    '{assignee_name}': order.assigneeName || '',\r\n    '{reference}': order.reference || '',\r\n    '{billing_address}': order.billingAddress || '',\r\n    \r\n    // === THÔNG TIN NHÀ CUNG CẤP ===\r\n    '{supplier_name}': order.supplierName,\r\n    '{supplier_code}': order.supplierCode || '',\r\n    '{supplier_phone}': order.supplierPhone || '',\r\n    '{supplier_phone_number}': order.supplierPhone || '',\r\n    '{supplier_email}': order.supplierEmail || '',\r\n    '{supplier_address}': order.supplierAddress || '',\r\n    \r\n    // === NỢ NCC ===\r\n    '{supplier_debt}': formatCurrency(order.supplierDebt),\r\n    '{supplier_debt_text}': numberToWords(order.supplierDebt || 0),\r\n    '{supplier_debt_prev}': formatCurrency(order.supplierDebtPrev),\r\n    '{supplier_debt_prev_text}': numberToWords(order.supplierDebtPrev || 0),\r\n    \r\n    // === KHỐI LƯỢNG ===\r\n    '{weight_g}': order.totalWeightG?.toString() || '0',\r\n    '{weight_kg}': order.totalWeightKg?.toString() || '0',\r\n    \r\n    // === TỔNG GIÁ TRỊ ===\r\n    '{total_quantity}': order.totalQuantity.toString(),\r\n    '{total_price}': formatCurrency(order.totalPrice),\r\n    '{total}': formatCurrency(order.totalPrice),\r\n    '{total_order}': formatCurrency(order.totalPrice),\r\n    '{total_line_amount}': formatCurrency(order.totalLineAmount),\r\n    '{total_line_amount_text}': numberToWords(order.totalLineAmount || 0),\r\n    '{total_tax}': formatCurrency(order.totalTax),\r\n    '{total_extra_tax}': formatCurrency(order.totalExtraTax),\r\n    '{tax_vat}': formatCurrency(order.totalTax),\r\n    '{total_discounts}': formatCurrency(order.totalDiscounts),\r\n    '{discount}': formatCurrency(order.totalDiscounts),\r\n    '{product_discount}': formatCurrency(order.productDiscount),\r\n    '{total_discounts_rate}': order.totalDiscountsRate ? `${order.totalDiscountsRate}%` : '',\r\n    '{total_discounts_value}': formatCurrency(order.totalDiscountsValue),\r\n    '{total_tax_included_line}': formatCurrency(order.totalTaxIncludedLine),\r\n    '{total_amount_before_tax}': formatCurrency(order.totalAmountBeforeTax),\r\n    '{total_amount_after_tax}': formatCurrency(order.totalAmountAfterTax),\r\n    '{total_amount_text}': numberToWords(order.totalPrice),\r\n    \r\n    '{total_transaction_amount}': formatCurrency(order.totalTransactionAmount),\r\n    '{total_remain}': formatCurrency(order.totalRemain),\r\n    '{total_amount_transaction}': formatCurrency(order.totalAmountTransaction),\r\n    '{total_landed_costs}': formatCurrency(order.totalLandedCosts),\r\n    \r\n    '{payments}': order.payments?.map(p => `${formatDate(p.date)}: ${formatCurrency(p.amount)} (${p.method})`).join(', ') || '',\r\n    \r\n    '{note}': order.note || '',\r\n    '{tags}': order.tags?.join(', ') || '',\r\n  };\r\n}\r\n\r\nexport function mapSupplierOrderLineItems(items: SupplierOrderForPrint['items']): PrintLineItem[] {\r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_title}': item.title || item.productName,\r\n    '{line_product_name}': item.productName,\r\n    '{line_unit}': item.unit || 'Cái',\r\n    '{line_note}': item.note || '',\r\n    '{line_quantity}': item.quantity.toString(),\r\n    '{line_ordered_quantity}': item.quantity.toString(),\r\n    '{line_received_quantity}': item.receivedQuantity?.toString() || '0',\r\n    '{line_variant_code}': item.variantCode || '',\r\n    '{line_variant_name}': item.variantName || '',\r\n    '{line_variant_options}': item.variantOptions || '',\r\n    '{line_variant_barcode}': item.barcode || '',\r\n    '{line_category}': item.category || '',\r\n    '{line_brand}': item.brand || '',\r\n    '{line_price}': formatCurrency(item.price),\r\n    '{line_price_after_discount}': formatCurrency(item.priceAfterDiscount),\r\n    '{line_discount_amount}': formatCurrency(item.discountAmount),\r\n    '{line_discount_rate}': item.discountRate ? `${item.discountRate}%` : '',\r\n    '{line_amount}': formatCurrency(item.amount),\r\n    '{line_total}': formatCurrency(item.amount),\r\n    '{line_tax_exclude}': formatCurrency(item.taxExclude),\r\n    '{line_tax_included}': formatCurrency(item.taxIncluded),\r\n    '{line_tax_amount}': formatCurrency(item.taxAmount),\r\n    '{line_tax_rate}': item.taxRate ? `${item.taxRate}%` : '',\r\n    '{line_tax}': item.taxType || '',\r\n    '{line_weight_g}': item.weightG?.toString() || '',\r\n    '{line_weight_kg}': item.weightKg?.toString() || '',\r\n    '{serials}': item.serials?.join(', ') || '',\r\n    '{lots_number_code1}': item.lots?.[0] || '',\r\n    '{lots_number_code2}': item.lots?.[1] || '',\r\n    '{lots_number_code3}': item.lots?.[2] || '',\r\n    '{lots_number_code4}': item.lots?.[3] || '',\r\n  }));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4579, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/return-order.mapper.ts"],"sourcesContent":["/**\r\n * Return Order Mapper - Đơn trả hàng (don-tra-hang)\r\n * Đồng bộ với variables/don-tra-hang.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatCurrency,\r\n  formatDate,\r\n  formatTime,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface ReturnOrderForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  orderCode?: string;\r\n  createdAt: string | Date;\r\n  modifiedAt?: string | Date;\r\n  receivedOn?: string | Date;\r\n  reference?: string;\r\n  createdBy?: string;\r\n  \r\n  // Trạng thái\r\n  status?: string;\r\n  refundStatus?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // Thông tin khách hàng\r\n  customerCode?: string;\r\n  customerName?: string;\r\n  customerPhone?: string;\r\n  customerEmail?: string;\r\n  customerGroup?: string;\r\n  billingAddress?: string;\r\n  \r\n  // Lý do\r\n  reasonReturn?: string;\r\n  \r\n  // Danh sách sản phẩm\r\n  items: Array<{\r\n    variantCode?: string;\r\n    productName: string;\r\n    variantName?: string;\r\n    variantOptions?: string;\r\n    barcode?: string;\r\n    unit?: string;\r\n    quantity: number;\r\n    price: number;\r\n    amount: number;\r\n    brand?: string;\r\n    serial?: string;\r\n    note?: string;\r\n  }>;\r\n  \r\n  // Tổng giá trị\r\n  totalQuantity: number;\r\n  totalAmount: number;\r\n  totalText?: string;\r\n  \r\n  note?: string;\r\n}\r\n\r\nexport function mapReturnOrderToPrintData(order: ReturnOrderForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': order.location?.name || storeSettings.name || '',\r\n    '{location_address}': order.location?.address || storeSettings.address || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    '{location_province}': order.location?.province || '',\r\n    \r\n    // === THÔNG TIN ĐƠN TRẢ ===\r\n    '{order_return_code}': order.code,\r\n    '{return_code}': order.code,\r\n    '{order_code}': order.orderCode || '',\r\n    '{created_on}': formatDate(order.createdAt),\r\n    '{created_on_time}': formatTime(order.createdAt),\r\n    '{modified_on}': formatDate(order.modifiedAt),\r\n    '{received_on}': formatDate(order.receivedOn),\r\n    '{reference}': order.reference || '',\r\n    '{account_name}': order.createdBy || '',\r\n    \r\n    // === TRẠNG THÁI ===\r\n    '{status}': order.status || '',\r\n    '{refund_status}': order.refundStatus || '',\r\n    \r\n    // === THÔNG TIN KHÁCH HÀNG ===\r\n    '{customer_name}': order.customerName || '',\r\n    '{customer_code}': order.customerCode || '',\r\n    '{customer_phone_number}': order.customerPhone || '',\r\n    '{customer_email}': order.customerEmail || '',\r\n    '{customer_group}': order.customerGroup || '',\r\n    '{billing_address}': order.billingAddress || '',\r\n    \r\n    // === LÝ DO ===\r\n    '{reason_return}': order.reasonReturn || '',\r\n    '{reason}': order.reasonReturn || '',\r\n    \r\n    // === TỔNG GIÁ TRỊ ===\r\n    '{total_quantity}': order.totalQuantity.toString(),\r\n    '{total_amount}': formatCurrency(order.totalAmount),\r\n    '{total_text}': order.totalText || '',\r\n    \r\n    '{note}': order.note || '',\r\n  };\r\n}\r\n\r\nexport function mapReturnOrderLineItems(items: ReturnOrderForPrint['items']): PrintLineItem[] {\r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_variant_code}': item.variantCode || '',\r\n    '{line_product_name}': item.productName,\r\n    '{line_variant}': item.variantName || '',\r\n    '{line_variant_options}': item.variantOptions || '',\r\n    '{line_unit}': item.unit || 'Cái',\r\n    '{line_quantity}': item.quantity.toString(),\r\n    '{line_price}': formatCurrency(item.price),\r\n    '{line_amount}': formatCurrency(item.amount),\r\n    '{line_brand}': item.brand || '',\r\n    '{serials}': item.serial || '',\r\n    '{line_note}': item.note || '',\r\n  }));\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;CAGC,GAED;AAAA;;AAkEO,SAAS,0BAA0B,KAA0B,EAAE,aAA4B;IAChG,OAAO;QACL,GAAG,IAAA,uIAAY,EAAC,cAAc;QAE9B,8BAA8B;QAC9B,mBAAmB,MAAM,QAAQ,EAAE,QAAQ,cAAc,IAAI,IAAI;QACjE,sBAAsB,MAAM,QAAQ,EAAE,WAAW,cAAc,OAAO,IAAI;QAC1E,oBAAoB,cAAc,QAAQ,IAAI;QAC9C,uBAAuB,MAAM,QAAQ,EAAE,YAAY;QAEnD,4BAA4B;QAC5B,uBAAuB,MAAM,IAAI;QACjC,iBAAiB,MAAM,IAAI;QAC3B,gBAAgB,MAAM,SAAS,IAAI;QACnC,gBAAgB,IAAA,qIAAU,EAAC,MAAM,SAAS;QAC1C,qBAAqB,IAAA,qIAAU,EAAC,MAAM,SAAS;QAC/C,iBAAiB,IAAA,qIAAU,EAAC,MAAM,UAAU;QAC5C,iBAAiB,IAAA,qIAAU,EAAC,MAAM,UAAU;QAC5C,eAAe,MAAM,SAAS,IAAI;QAClC,kBAAkB,MAAM,SAAS,IAAI;QAErC,qBAAqB;QACrB,YAAY,MAAM,MAAM,IAAI;QAC5B,mBAAmB,MAAM,YAAY,IAAI;QAEzC,+BAA+B;QAC/B,mBAAmB,MAAM,YAAY,IAAI;QACzC,mBAAmB,MAAM,YAAY,IAAI;QACzC,2BAA2B,MAAM,aAAa,IAAI;QAClD,oBAAoB,MAAM,aAAa,IAAI;QAC3C,oBAAoB,MAAM,aAAa,IAAI;QAC3C,qBAAqB,MAAM,cAAc,IAAI;QAE7C,gBAAgB;QAChB,mBAAmB,MAAM,YAAY,IAAI;QACzC,YAAY,MAAM,YAAY,IAAI;QAElC,uBAAuB;QACvB,oBAAoB,MAAM,aAAa,CAAC,QAAQ;QAChD,kBAAkB,IAAA,yIAAc,EAAC,MAAM,WAAW;QAClD,gBAAgB,MAAM,SAAS,IAAI;QAEnC,UAAU,MAAM,IAAI,IAAI;IAC1B;AACF;AAEO,SAAS,wBAAwB,KAAmC;IACzE,OAAO,MAAM,GAAG,CAAC,CAAC,MAAM,QAAU,CAAC;YACjC,cAAc,CAAC,QAAQ,CAAC,EAAE,QAAQ;YAClC,uBAAuB,KAAK,WAAW,IAAI;YAC3C,uBAAuB,KAAK,WAAW;YACvC,kBAAkB,KAAK,WAAW,IAAI;YACtC,0BAA0B,KAAK,cAAc,IAAI;YACjD,eAAe,KAAK,IAAI,IAAI;YAC5B,mBAAmB,KAAK,QAAQ,CAAC,QAAQ;YACzC,gBAAgB,IAAA,yIAAc,EAAC,KAAK,KAAK;YACzC,iBAAiB,IAAA,yIAAc,EAAC,KAAK,MAAM;YAC3C,gBAAgB,KAAK,KAAK,IAAI;YAC9B,aAAa,KAAK,MAAM,IAAI;YAC5B,eAAe,KAAK,IAAI,IAAI;QAC9B,CAAC;AACH"}},
    {"offset": {"line": 4649, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/handover.mapper.ts"],"sourcesContent":["/**\r\n * Handover Mapper - Phiếu bàn giao tài sản/thiết bị\r\n * Đồng bộ với variables/phieu-ban-giao.ts và templates/handover.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatCurrency,\r\n  formatDate,\r\n  formatTime,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\n/**\r\n * Interface cho Phiếu bàn giao tài sản\r\n */\r\nexport interface HandoverForPrint {\r\n  // === THÔNG TIN PHIẾU ===\r\n  code: string;\r\n  createdAt: string | Date;\r\n  handoverType?: string; // Bàn giao công việc, Bàn giao tài sản, Bàn giao thiết bị...\r\n  status?: string;\r\n  note?: string;\r\n  accountName?: string; // Người tạo phiếu\r\n\r\n  // === NGƯỜI BÀN GIAO ===\r\n  fromEmployee?: {\r\n    code?: string;\r\n    name?: string;\r\n    department?: string;\r\n    position?: string;\r\n  };\r\n\r\n  // === NGƯỜI NHẬN ===\r\n  toEmployee?: {\r\n    code?: string;\r\n    name?: string;\r\n    department?: string;\r\n    position?: string;\r\n  };\r\n\r\n  // === DANH SÁCH TÀI SẢN BÀN GIAO ===\r\n  items: Array<{\r\n    itemCode?: string;\r\n    itemName?: string;\r\n    description?: string;\r\n    serial?: string;\r\n    quantity?: number;\r\n    unit?: string;\r\n    condition?: string; // Tốt, Hư hỏng nhẹ, Cần sửa chữa...\r\n    value?: number;\r\n    note?: string;\r\n  }>;\r\n\r\n  // === TỔNG KẾT ===\r\n  totalItems?: number;\r\n  totalQuantity?: number;\r\n  totalValue?: number;\r\n}\r\n\r\n/**\r\n * Map HandoverForPrint sang PrintData\r\n */\r\nexport function mapHandoverToPrintData(handover: HandoverForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN PHIẾU ===\r\n    '{handover_code}': handover.code,\r\n    '{created_on}': formatDate(handover.createdAt),\r\n    '{created_on_time}': formatTime(handover.createdAt),\r\n    '{handover_type}': handover.handoverType || '',\r\n    '{status}': handover.status || '',\r\n    '{note}': handover.note || '',\r\n    '{account_name}': handover.accountName || '',\r\n\r\n    // === NGƯỜI BÀN GIAO ===\r\n    '{from_employee}': handover.fromEmployee?.name || '',\r\n    '{from_employee_code}': handover.fromEmployee?.code || '',\r\n    '{from_department}': handover.fromEmployee?.department || '',\r\n    '{from_position}': handover.fromEmployee?.position || '',\r\n\r\n    // === NGƯỜI NHẬN ===\r\n    '{to_employee}': handover.toEmployee?.name || '',\r\n    '{to_employee_code}': handover.toEmployee?.code || '',\r\n    '{to_department}': handover.toEmployee?.department || '',\r\n    '{to_position}': handover.toEmployee?.position || '',\r\n\r\n    // === TỔNG KẾT ===\r\n    '{total_items}': handover.totalItems?.toString() || handover.items.length.toString(),\r\n    '{total_quantity}': handover.totalQuantity?.toString() || \r\n      handover.items.reduce((sum, item) => sum + (item.quantity || 0), 0).toString(),\r\n    '{total_value}': formatCurrency(handover.totalValue || \r\n      handover.items.reduce((sum, item) => sum + (item.value || 0), 0)),\r\n  };\r\n}\r\n\r\n/**\r\n * Map line items cho bảng chi tiết bàn giao\r\n */\r\nexport function mapHandoverLineItems(items: HandoverForPrint['items']): PrintLineItem[] {\r\n  return items.map((item) => ({\r\n    '{line_item_code}': item.itemCode || '',\r\n    '{line_item_name}': item.itemName || '',\r\n    '{line_description}': item.description || '',\r\n    '{line_serial}': item.serial || '',\r\n    '{line_quantity}': item.quantity?.toString() || '1',\r\n    '{line_unit}': item.unit || 'Cái',\r\n    '{line_condition}': item.condition || 'Tốt',\r\n    '{line_value}': formatCurrency(item.value),\r\n    '{line_note}': item.note || '',\r\n  }));\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;CAGC,GAED;AAAA;;AA4DO,SAAS,uBAAuB,QAA0B,EAAE,aAA4B;IAC7F,OAAO;QACL,GAAG,IAAA,uIAAY,EAAC,cAAc;QAE9B,0BAA0B;QAC1B,mBAAmB,SAAS,IAAI;QAChC,gBAAgB,IAAA,qIAAU,EAAC,SAAS,SAAS;QAC7C,qBAAqB,IAAA,qIAAU,EAAC,SAAS,SAAS;QAClD,mBAAmB,SAAS,YAAY,IAAI;QAC5C,YAAY,SAAS,MAAM,IAAI;QAC/B,UAAU,SAAS,IAAI,IAAI;QAC3B,kBAAkB,SAAS,WAAW,IAAI;QAE1C,yBAAyB;QACzB,mBAAmB,SAAS,YAAY,EAAE,QAAQ;QAClD,wBAAwB,SAAS,YAAY,EAAE,QAAQ;QACvD,qBAAqB,SAAS,YAAY,EAAE,cAAc;QAC1D,mBAAmB,SAAS,YAAY,EAAE,YAAY;QAEtD,qBAAqB;QACrB,iBAAiB,SAAS,UAAU,EAAE,QAAQ;QAC9C,sBAAsB,SAAS,UAAU,EAAE,QAAQ;QACnD,mBAAmB,SAAS,UAAU,EAAE,cAAc;QACtD,iBAAiB,SAAS,UAAU,EAAE,YAAY;QAElD,mBAAmB;QACnB,iBAAiB,SAAS,UAAU,EAAE,cAAc,SAAS,KAAK,CAAC,MAAM,CAAC,QAAQ;QAClF,oBAAoB,SAAS,aAAa,EAAE,cAC1C,SAAS,KAAK,CAAC,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,CAAC,KAAK,QAAQ,IAAI,CAAC,GAAG,GAAG,QAAQ;QAC9E,iBAAiB,IAAA,yIAAc,EAAC,SAAS,UAAU,IACjD,SAAS,KAAK,CAAC,MAAM,CAAC,CAAC,KAAK,OAAS,MAAM,CAAC,KAAK,KAAK,IAAI,CAAC,GAAG;IAClE;AACF;AAKO,SAAS,qBAAqB,KAAgC;IACnE,OAAO,MAAM,GAAG,CAAC,CAAC,OAAS,CAAC;YAC1B,oBAAoB,KAAK,QAAQ,IAAI;YACrC,oBAAoB,KAAK,QAAQ,IAAI;YACrC,sBAAsB,KAAK,WAAW,IAAI;YAC1C,iBAAiB,KAAK,MAAM,IAAI;YAChC,mBAAmB,KAAK,QAAQ,EAAE,cAAc;YAChD,eAAe,KAAK,IAAI,IAAI;YAC5B,oBAAoB,KAAK,SAAS,IAAI;YACtC,gBAAgB,IAAA,yIAAc,EAAC,KAAK,KAAK;YACzC,eAAe,KAAK,IAAI,IAAI;QAC9B,CAAC;AACH"}},
    {"offset": {"line": 4705, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/refund-confirmation.mapper.ts"],"sourcesContent":["/**\r\n * Refund Confirmation Mapper - Phiếu xác nhận hoàn (phieu-xac-nhan-hoan)\r\n * Đồng bộ với variables/phieu-xac-nhan-hoan.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatCurrency,\r\n  formatDate,\r\n  hidePhoneMiddle,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface RefundConfirmationForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  printedOn: string | Date;\r\n  accountName?: string;\r\n  createdOn?: string | Date;\r\n  createdOnTime?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n  };\r\n  \r\n  // Thông tin vận chuyển\r\n  shippingProviderName?: string;\r\n  serviceName?: string;\r\n  \r\n  // Tổng COD\r\n  totalCod?: number;\r\n  \r\n  // Số lượng đơn\r\n  quantity?: number;\r\n  \r\n  // Thông tin khách hàng\r\n  customerName?: string;\r\n  customerPhoneNumber?: string;\r\n  \r\n  // Thông tin ngân hàng\r\n  bankName?: string;\r\n  bankBranch?: string;\r\n  bankAccount?: string;\r\n  bankAccountName?: string;\r\n  \r\n  // Thông tin hoàn tiền\r\n  refundCode?: string;\r\n  refundAmount?: number;\r\n  refundAmountText?: string;\r\n  refundMethod?: string;\r\n  refundReason?: string;\r\n  refundStatus?: string;\r\n  refundedOn?: string | Date;\r\n  \r\n  // Thông tin đơn trả hàng\r\n  returnCode?: string;\r\n  returnDate?: string | Date;\r\n  orderDate?: string | Date;\r\n  \r\n  // Danh sách đơn hàng hoàn\r\n  orders: Array<{\r\n    orderCode: string;\r\n    shipmentCode?: string;\r\n    shippingName?: string;\r\n    shippingPhone?: string;\r\n    shippingAddress?: string;\r\n    city?: string;\r\n    district?: string;\r\n    cod?: number;\r\n    note?: string;\r\n  }>;\r\n  \r\n  note?: string;\r\n}\r\n\r\nexport function mapRefundConfirmationToPrintData(refund: RefundConfirmationForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': refund.location?.name || storeSettings.name || '',\r\n    '{location_address}': refund.location?.address || storeSettings.address || '',\r\n    \r\n    // === THÔNG TIN PHIẾU XÁC NHẬN HOÀN ===\r\n    '{hand_over_code}': refund.code,\r\n    '{printed_on}': formatDate(refund.printedOn),\r\n    '{current_account_name}': refund.accountName || '',\r\n    '{account_name}': refund.accountName || '',\r\n    '{created_on}': formatDate(refund.createdOn || refund.printedOn),\r\n    '{created_on_time}': refund.createdOnTime || '',\r\n    \r\n    // === THÔNG TIN VẬN CHUYỂN ===\r\n    '{shipping_provider_name}': refund.shippingProviderName || '',\r\n    '{service_name}': refund.serviceName || '',\r\n    \r\n    // === THÔNG TIN KHÁCH HÀNG ===\r\n    '{customer_name}': refund.customerName || '',\r\n    '{customer_phone_number}': refund.customerPhoneNumber || '',\r\n    \r\n    // === THÔNG TIN NGÂN HÀNG ===\r\n    '{bank_name}': refund.bankName || '',\r\n    '{bank_branch}': refund.bankBranch || '',\r\n    '{bank_account}': refund.bankAccount || '',\r\n    '{bank_account_name}': refund.bankAccountName || '',\r\n    \r\n    // === THÔNG TIN HOÀN TIỀN ===\r\n    '{refund_code}': refund.refundCode || refund.code,\r\n    '{refund_amount}': formatCurrency(refund.refundAmount),\r\n    '{refund_amount_text}': refund.refundAmountText || '',\r\n    '{refund_method}': refund.refundMethod || '',\r\n    '{refund_reason}': refund.refundReason || '',\r\n    '{refund_status}': refund.refundStatus || '',\r\n    '{refunded_on}': formatDate(refund.refundedOn),\r\n    \r\n    // === THÔNG TIN ĐƠN TRẢ HÀNG ===\r\n    '{return_code}': refund.returnCode || '',\r\n    '{return_date}': formatDate(refund.returnDate),\r\n    '{order_date}': formatDate(refund.orderDate),\r\n    \r\n    // === TỔNG GIÁ TRỊ ===\r\n    '{total_cod}': formatCurrency(refund.totalCod),\r\n    '{quantity}': refund.quantity?.toString() || refund.orders.length.toString(),\r\n    \r\n    '{note}': refund.note || '',\r\n  };\r\n}\r\n\r\nexport function mapRefundConfirmationLineItems(orders: RefundConfirmationForPrint['orders']): PrintLineItem[] {\r\n  return orders.map((order) => ({\r\n    '{order_code}': order.orderCode,\r\n    '{shipment_code}': order.shipmentCode || '',\r\n    '{shipping_name}': order.shippingName || '',\r\n    '{shipping_phone}': order.shippingPhone || '',\r\n    '{shipping_phone_hide}': hidePhoneMiddle(order.shippingPhone || ''),\r\n    '{shipping_address}': order.shippingAddress || '',\r\n    '{city}': order.city || '',\r\n    '{district}': order.district || '',\r\n    '{cod}': formatCurrency(order.cod),\r\n    '{note}': order.note || '',\r\n  }));\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;CAGC,GAED;AAAA;;AA0EO,SAAS,iCAAiC,MAAkC,EAAE,aAA4B;IAC/G,OAAO;QACL,GAAG,IAAA,uIAAY,EAAC,cAAc;QAE9B,8BAA8B;QAC9B,mBAAmB,OAAO,QAAQ,EAAE,QAAQ,cAAc,IAAI,IAAI;QAClE,sBAAsB,OAAO,QAAQ,EAAE,WAAW,cAAc,OAAO,IAAI;QAE3E,wCAAwC;QACxC,oBAAoB,OAAO,IAAI;QAC/B,gBAAgB,IAAA,qIAAU,EAAC,OAAO,SAAS;QAC3C,0BAA0B,OAAO,WAAW,IAAI;QAChD,kBAAkB,OAAO,WAAW,IAAI;QACxC,gBAAgB,IAAA,qIAAU,EAAC,OAAO,SAAS,IAAI,OAAO,SAAS;QAC/D,qBAAqB,OAAO,aAAa,IAAI;QAE7C,+BAA+B;QAC/B,4BAA4B,OAAO,oBAAoB,IAAI;QAC3D,kBAAkB,OAAO,WAAW,IAAI;QAExC,+BAA+B;QAC/B,mBAAmB,OAAO,YAAY,IAAI;QAC1C,2BAA2B,OAAO,mBAAmB,IAAI;QAEzD,8BAA8B;QAC9B,eAAe,OAAO,QAAQ,IAAI;QAClC,iBAAiB,OAAO,UAAU,IAAI;QACtC,kBAAkB,OAAO,WAAW,IAAI;QACxC,uBAAuB,OAAO,eAAe,IAAI;QAEjD,8BAA8B;QAC9B,iBAAiB,OAAO,UAAU,IAAI,OAAO,IAAI;QACjD,mBAAmB,IAAA,yIAAc,EAAC,OAAO,YAAY;QACrD,wBAAwB,OAAO,gBAAgB,IAAI;QACnD,mBAAmB,OAAO,YAAY,IAAI;QAC1C,mBAAmB,OAAO,YAAY,IAAI;QAC1C,mBAAmB,OAAO,YAAY,IAAI;QAC1C,iBAAiB,IAAA,qIAAU,EAAC,OAAO,UAAU;QAE7C,iCAAiC;QACjC,iBAAiB,OAAO,UAAU,IAAI;QACtC,iBAAiB,IAAA,qIAAU,EAAC,OAAO,UAAU;QAC7C,gBAAgB,IAAA,qIAAU,EAAC,OAAO,SAAS;QAE3C,uBAAuB;QACvB,eAAe,IAAA,yIAAc,EAAC,OAAO,QAAQ;QAC7C,cAAc,OAAO,QAAQ,EAAE,cAAc,OAAO,MAAM,CAAC,MAAM,CAAC,QAAQ;QAE1E,UAAU,OAAO,IAAI,IAAI;IAC3B;AACF;AAEO,SAAS,+BAA+B,MAA4C;IACzF,OAAO,OAAO,GAAG,CAAC,CAAC,QAAU,CAAC;YAC5B,gBAAgB,MAAM,SAAS;YAC/B,mBAAmB,MAAM,YAAY,IAAI;YACzC,mBAAmB,MAAM,YAAY,IAAI;YACzC,oBAAoB,MAAM,aAAa,IAAI;YAC3C,yBAAyB,IAAA,mKAAe,EAAC,MAAM,aAAa,IAAI;YAChE,sBAAsB,MAAM,eAAe,IAAI;YAC/C,UAAU,MAAM,IAAI,IAAI;YACxB,cAAc,MAAM,QAAQ,IAAI;YAChC,SAAS,IAAA,yIAAc,EAAC,MAAM,GAAG;YACjC,UAAU,MAAM,IAAI,IAAI;QAC1B,CAAC;AACH"}},
    {"offset": {"line": 4777, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/packing-guide.mapper.ts"],"sourcesContent":["/**\r\n * Packing Guide Mapper - Phiếu hướng dẫn đóng gói (phieu-huong-dan-dong-goi)\r\n * Đồng bộ với variables/phieu-huong-dan-dong-goi.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatCurrency,\r\n  formatDate,\r\n  formatTime,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface PackingGuideForPrint {\r\n  // Thông tin cơ bản\r\n  createdAt: string | Date;\r\n  listOrderCode?: string[];\r\n  orderCode?: string;\r\n  \r\n  // Nhân viên\r\n  accountName?: string;\r\n  accountPhone?: string;\r\n  accountEmail?: string;\r\n  \r\n  // Chi nhánh\r\n  locationName?: string;\r\n  \r\n  // Thông tin khách hàng\r\n  customerName?: string;\r\n  customerPhoneNumber?: string;\r\n  \r\n  // Thông tin vận chuyển\r\n  shippingAddress?: string;\r\n  cod?: number;\r\n  \r\n  // Danh sách sản phẩm\r\n  items: Array<{\r\n    variantCode?: string;\r\n    variantBarcode?: string;\r\n    productName: string;\r\n    variantName?: string;\r\n    variantOptions?: string;\r\n    variant?: string;\r\n    unit?: string;\r\n    quantity: number;\r\n    brand?: string;\r\n    category?: string;\r\n    binLocation?: string;\r\n    image?: string;\r\n    variantQrCode?: string;\r\n    compositeDetails?: string;\r\n    productDescription?: string;\r\n    note?: string;\r\n    storeNote?: string;\r\n  }>;\r\n  \r\n  // Tổng giá trị\r\n  total?: number;\r\n  totalProductQuantity?: number;\r\n  totalQuantity?: number;\r\n  \r\n  orderNote?: string;\r\n  packingNote?: string;\r\n}\r\n\r\nexport function mapPackingGuideToPrintData(guide: PackingGuideForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN PHIẾU HƯỚNG DẪN ĐÓNG GÓI ===\r\n    '{created_on}': formatDate(guide.createdAt),\r\n    '{created_on_time}': formatTime(guide.createdAt),\r\n    '{list_order_code}': guide.listOrderCode?.join(', ') || '',\r\n    '{order_code}': guide.orderCode || guide.listOrderCode?.[0] || '',\r\n    \r\n    // === NHÂN VIÊN ===\r\n    '{account_name}': guide.accountName || '',\r\n    '{account_phone}': guide.accountPhone || '',\r\n    '{account_email}': guide.accountEmail || '',\r\n    \r\n    // === CHI NHÁNH ===\r\n    '{location_name}': guide.locationName || storeSettings.name || '',\r\n    \r\n    // === THÔNG TIN KHÁCH HÀNG ===\r\n    '{customer_name}': guide.customerName || '',\r\n    '{customer_phone_number}': guide.customerPhoneNumber || '',\r\n    \r\n    // === THÔNG TIN VẬN CHUYỂN ===\r\n    '{shipping_address}': guide.shippingAddress || '',\r\n    '{cod}': formatCurrency(guide.cod),\r\n    \r\n    // === TỔNG GIÁ TRỊ ===\r\n    '{total}': formatCurrency(guide.total),\r\n    '{total_product_quantity}': guide.totalProductQuantity?.toString() || '0',\r\n    '{total_quantity}': guide.totalQuantity?.toString() || guide.totalProductQuantity?.toString() || '0',\r\n    \r\n    '{order_note}': guide.orderNote || '',\r\n    '{packing_note}': guide.packingNote || '',\r\n  };\r\n}\r\n\r\nexport function mapPackingGuideLineItems(items: PackingGuideForPrint['items']): PrintLineItem[] {\r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_variant_sku}': item.variantCode || '',\r\n    '{line_variant_code}': item.variantCode || '',\r\n    '{line_variant_barcode}': item.variantBarcode || '',\r\n    '{line_product_name}': item.productName,\r\n    '{line_variant_name}': item.variantName || '',\r\n    '{line_variant}': item.variant || item.variantName || '',\r\n    '{line_variant_options}': item.variantOptions || '',\r\n    '{line_unit}': item.unit || 'Cái',\r\n    '{line_quantity}': item.quantity.toString(),\r\n    '{line_brand}': item.brand || '',\r\n    '{line_category}': item.category || '',\r\n    '{bin_location}': item.binLocation || '',\r\n    '{line_image}': item.image || '',\r\n    '{line_variant_qrcode}': item.variantQrCode \r\n      ? `https://quickchart.io/qr?text=${encodeURIComponent(item.variantQrCode)}&size=100`\r\n      : '',\r\n    '{composite_details}': item.compositeDetails || '',\r\n    '{line_product_description}': item.productDescription || '',\r\n    '{lineitem_note}': item.note || '',\r\n    '{note_of_store}': item.storeNote || '',\r\n    '{location_name}': '', // Will be set at item level if needed\r\n  }));\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;CAGC,GAED;AAAA;;AA8DO,SAAS,2BAA2B,KAA2B,EAAE,aAA4B;IAClG,OAAO;QACL,GAAG,IAAA,uIAAY,EAAC,cAAc;QAE9B,6CAA6C;QAC7C,gBAAgB,IAAA,qIAAU,EAAC,MAAM,SAAS;QAC1C,qBAAqB,IAAA,qIAAU,EAAC,MAAM,SAAS;QAC/C,qBAAqB,MAAM,aAAa,EAAE,KAAK,SAAS;QACxD,gBAAgB,MAAM,SAAS,IAAI,MAAM,aAAa,EAAE,CAAC,EAAE,IAAI;QAE/D,oBAAoB;QACpB,kBAAkB,MAAM,WAAW,IAAI;QACvC,mBAAmB,MAAM,YAAY,IAAI;QACzC,mBAAmB,MAAM,YAAY,IAAI;QAEzC,oBAAoB;QACpB,mBAAmB,MAAM,YAAY,IAAI,cAAc,IAAI,IAAI;QAE/D,+BAA+B;QAC/B,mBAAmB,MAAM,YAAY,IAAI;QACzC,2BAA2B,MAAM,mBAAmB,IAAI;QAExD,+BAA+B;QAC/B,sBAAsB,MAAM,eAAe,IAAI;QAC/C,SAAS,IAAA,yIAAc,EAAC,MAAM,GAAG;QAEjC,uBAAuB;QACvB,WAAW,IAAA,yIAAc,EAAC,MAAM,KAAK;QACrC,4BAA4B,MAAM,oBAAoB,EAAE,cAAc;QACtE,oBAAoB,MAAM,aAAa,EAAE,cAAc,MAAM,oBAAoB,EAAE,cAAc;QAEjG,gBAAgB,MAAM,SAAS,IAAI;QACnC,kBAAkB,MAAM,WAAW,IAAI;IACzC;AACF;AAEO,SAAS,yBAAyB,KAAoC;IAC3E,OAAO,MAAM,GAAG,CAAC,CAAC,MAAM,QAAU,CAAC;YACjC,cAAc,CAAC,QAAQ,CAAC,EAAE,QAAQ;YAClC,sBAAsB,KAAK,WAAW,IAAI;YAC1C,uBAAuB,KAAK,WAAW,IAAI;YAC3C,0BAA0B,KAAK,cAAc,IAAI;YACjD,uBAAuB,KAAK,WAAW;YACvC,uBAAuB,KAAK,WAAW,IAAI;YAC3C,kBAAkB,KAAK,OAAO,IAAI,KAAK,WAAW,IAAI;YACtD,0BAA0B,KAAK,cAAc,IAAI;YACjD,eAAe,KAAK,IAAI,IAAI;YAC5B,mBAAmB,KAAK,QAAQ,CAAC,QAAQ;YACzC,gBAAgB,KAAK,KAAK,IAAI;YAC9B,mBAAmB,KAAK,QAAQ,IAAI;YACpC,kBAAkB,KAAK,WAAW,IAAI;YACtC,gBAAgB,KAAK,KAAK,IAAI;YAC9B,yBAAyB,KAAK,aAAa,GACvC,CAAC,8BAA8B,EAAE,mBAAmB,KAAK,aAAa,EAAE,SAAS,CAAC,GAClF;YACJ,uBAAuB,KAAK,gBAAgB,IAAI;YAChD,8BAA8B,KAAK,kBAAkB,IAAI;YACzD,mBAAmB,KAAK,IAAI,IAAI;YAChC,mBAAmB,KAAK,SAAS,IAAI;YACrC,mBAAmB;QACrB,CAAC;AACH"}},
    {"offset": {"line": 4845, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/sales-summary.mapper.ts"],"sourcesContent":["/**\r\n * Sales Summary Mapper - Phiếu tổng kết bán hàng (phieu-tong-ket-ban-hang)\r\n * Đồng bộ với variables/phieu-tong-ket-ban-hang.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatCurrency,\r\n  formatDate,\r\n  formatTime,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface SalesSummaryForPrint {\r\n  // Thông tin cơ bản\r\n  datePrint: string | Date;\r\n  timePrint?: string | Date;\r\n  timeFilter?: string;\r\n  sourceName?: string;\r\n  createdOn?: string | Date;\r\n  fromDate?: string | Date;\r\n  toDate?: string | Date;\r\n  period?: string;\r\n  note?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  locationName?: string;\r\n  accountName?: string;\r\n  \r\n  // Tổng quan bán hàng\r\n  totalQuantityOrderFinished?: number;\r\n  totalQuantityLineItemFulfillment?: number;\r\n  totalQuantityLineItemReturn?: number;\r\n  totalLineAmount?: number;\r\n  totalOrderPayment?: number;\r\n  totalOrderReturnPayment?: number;\r\n  totalRealReceipt?: number;\r\n  \r\n  // Tổng kết\r\n  totalOrders?: number;\r\n  totalRevenue?: number;\r\n  salesRevenue?: number;\r\n  deliveryRevenue?: number;\r\n  totalDiscount?: number;\r\n  totalTax?: number;\r\n  totalReturns?: number;\r\n  totalCollected?: number;\r\n  \r\n  // Thực thu theo hình thức\r\n  realReceiptCash?: number;\r\n  realReceiptTransfer?: number;\r\n  realReceiptMpos?: number;\r\n  realReceiptCod?: number;\r\n  realReceiptOnline?: number;\r\n  \r\n  // Chi tiết thanh toán\r\n  cashAmount?: number;\r\n  cardAmount?: number;\r\n  bankTransferAmount?: number;\r\n  codAmount?: number;\r\n  ewalletAmount?: number;\r\n  \r\n  // Nợ còn lại\r\n  debt?: number;\r\n  \r\n  // Tổng thu\r\n  receiptInDay?: number;\r\n  receiptCash?: number;\r\n  receiptTransfer?: number;\r\n  receiptMpos?: number;\r\n  receiptCod?: number;\r\n  receiptOnline?: number;\r\n  \r\n  // Tổng chi\r\n  paymentInDay?: number;\r\n  paymentCash?: number;\r\n  paymentTransfer?: number;\r\n  paymentMpos?: number;\r\n  \r\n  // Chi tiết đơn hàng bán\r\n  ordersFinished?: Array<{\r\n    stt: number;\r\n    orderCode: string;\r\n    amount: number;\r\n    discount: number;\r\n    tax: number;\r\n    total: number;\r\n  }>;\r\n  \r\n  // Chi tiết hàng bán\r\n  itemsFulfillment?: Array<{\r\n    stt: number;\r\n    sku: string;\r\n    variantName: string;\r\n    quantity: number;\r\n    amount: number;\r\n  }>;\r\n  \r\n  // Chi tiết hàng trả\r\n  itemsReturn?: Array<{\r\n    stt: number;\r\n    sku: string;\r\n    variantName: string;\r\n    quantity: number;\r\n    amount: number;\r\n  }>;\r\n  \r\n  // Chi tiết thanh toán\r\n  paymentMethods?: Array<{\r\n    name: string;\r\n    amount: number;\r\n  }>;\r\n  \r\n  // Line items generic\r\n  lineItems?: Array<{\r\n    productName?: string;\r\n    quantity?: number;\r\n    amount?: number;\r\n  }>;\r\n}\r\n\r\nexport function mapSalesSummaryToPrintData(summary: SalesSummaryForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN ===\r\n    '{location_name}': summary.locationName || storeSettings.name || '',\r\n    '{account_name}': summary.accountName || '',\r\n    '{date_print}': formatDate(summary.datePrint),\r\n    '{time_print}': formatTime(summary.timePrint || summary.datePrint),\r\n    '{time_filter}': summary.timeFilter || '',\r\n    '{source_name}': summary.sourceName || '',\r\n    '{created_on}': formatDate(summary.createdOn || summary.datePrint),\r\n    '{from_date}': formatDate(summary.fromDate),\r\n    '{to_date}': formatDate(summary.toDate),\r\n    '{period}': summary.period || '',\r\n    '{note}': summary.note || '',\r\n    \r\n    // === TỔNG QUAN BÁN HÀNG ===\r\n    '{total_quantity_order_finished}': summary.totalQuantityOrderFinished?.toString() || '0',\r\n    '{total_quantity_line_item_fulfillment}': summary.totalQuantityLineItemFulfillment?.toString() || '0',\r\n    '{total_quantity_line_item_return}': summary.totalQuantityLineItemReturn?.toString() || '0',\r\n    '{total_line_amount}': formatCurrency(summary.totalLineAmount),\r\n    '{total_order_payment}': formatCurrency(summary.totalOrderPayment),\r\n    '{total_order_return_payment}': formatCurrency(summary.totalOrderReturnPayment),\r\n    '{total_real_receipt}': formatCurrency(summary.totalRealReceipt),\r\n    \r\n    // === TỔNG KẾT ===\r\n    '{total_orders}': summary.totalOrders?.toString() || summary.totalQuantityOrderFinished?.toString() || '0',\r\n    '{total_revenue}': formatCurrency(summary.totalRevenue || summary.totalLineAmount),\r\n    '{sales_revenue}': formatCurrency(summary.salesRevenue || summary.totalLineAmount),\r\n    '{delivery_revenue}': formatCurrency(summary.deliveryRevenue),\r\n    '{total_discount}': formatCurrency(summary.totalDiscount),\r\n    '{total_tax}': formatCurrency(summary.totalTax),\r\n    '{total_returns}': formatCurrency(summary.totalReturns || summary.totalOrderReturnPayment),\r\n    '{total_collected}': formatCurrency(summary.totalCollected || summary.totalRealReceipt),\r\n    \r\n    // === THỰC THU THEO HÌNH THỨC ===\r\n    '{real_receipt_cash}': formatCurrency(summary.realReceiptCash),\r\n    '{real_receipt_transfer}': formatCurrency(summary.realReceiptTransfer),\r\n    '{real_receipt_mpos}': formatCurrency(summary.realReceiptMpos),\r\n    '{real_receipt_cod}': formatCurrency(summary.realReceiptCod),\r\n    '{real_receipt_online}': formatCurrency(summary.realReceiptOnline),\r\n    \r\n    // === CHI TIẾT THANH TOÁN ===\r\n    '{cash_amount}': formatCurrency(summary.cashAmount || summary.realReceiptCash),\r\n    '{card_amount}': formatCurrency(summary.cardAmount || summary.realReceiptMpos),\r\n    '{bank_transfer_amount}': formatCurrency(summary.bankTransferAmount || summary.realReceiptTransfer),\r\n    '{cod_amount}': formatCurrency(summary.codAmount || summary.realReceiptCod),\r\n    '{ewallet_amount}': formatCurrency(summary.ewalletAmount || summary.realReceiptOnline),\r\n    \r\n    // === NỢ ===\r\n    '{debt}': formatCurrency(summary.debt),\r\n    \r\n    // === TỔNG THU ===\r\n    '{receipt_in_day}': formatCurrency(summary.receiptInDay),\r\n    '{receipt_cash}': formatCurrency(summary.receiptCash),\r\n    '{receipt_transfer}': formatCurrency(summary.receiptTransfer),\r\n    '{receipt_mpos}': formatCurrency(summary.receiptMpos),\r\n    '{receipt_cod}': formatCurrency(summary.receiptCod),\r\n    '{receipt_online}': formatCurrency(summary.receiptOnline),\r\n    \r\n    // === TỔNG CHI ===\r\n    '{payment_in_day}': formatCurrency(summary.paymentInDay),\r\n    '{payment_cash}': formatCurrency(summary.paymentCash),\r\n    '{payment_transfer}': formatCurrency(summary.paymentTransfer),\r\n    '{payment_mpos}': formatCurrency(summary.paymentMpos),\r\n  };\r\n}\r\n\r\n// Line items cho danh sách đơn hàng bán\r\nexport function mapSalesSummaryOrdersFinished(orders: SalesSummaryForPrint['ordersFinished']): PrintLineItem[] {\r\n  if (!orders) return [];\r\n  return orders.map((order) => ({\r\n    '{stt_order_finish}': order.stt.toString(),\r\n    '{order_code}': order.orderCode,\r\n    '{amount_order_finished}': formatCurrency(order.amount),\r\n    '{discount_order_finished}': formatCurrency(order.discount),\r\n    '{tax_order_finished}': formatCurrency(order.tax),\r\n    '{total_order_finished}': formatCurrency(order.total),\r\n  }));\r\n}\r\n\r\n// Line items cho danh sách hàng bán\r\nexport function mapSalesSummaryItemsFulfillment(items: SalesSummaryForPrint['itemsFulfillment']): PrintLineItem[] {\r\n  if (!items) return [];\r\n  return items.map((item) => ({\r\n    '{stt_item_fulfillment}': item.stt.toString(),\r\n    '{sku_fulfillment}': item.sku,\r\n    '{variant_name_fulfillment}': item.variantName,\r\n    '{quantity_item_fulfilment}': item.quantity.toString(),\r\n    '{amount_item_fulfilment}': formatCurrency(item.amount),\r\n  }));\r\n}\r\n\r\n// Line items cho danh sách hàng trả\r\nexport function mapSalesSummaryItemsReturn(items: SalesSummaryForPrint['itemsReturn']): PrintLineItem[] {\r\n  if (!items) return [];\r\n  return items.map((item) => ({\r\n    '{stt_item_return}': item.stt.toString(),\r\n    '{sku_return}': item.sku,\r\n    '{variant_name_return}': item.variantName,\r\n    '{quantity_item_return}': item.quantity.toString(),\r\n    '{amount_item_return}': formatCurrency(item.amount),\r\n  }));\r\n}\r\n\r\n// Line items cho danh sách thanh toán\r\nexport function mapSalesSummaryPaymentMethods(methods: SalesSummaryForPrint['paymentMethods']): PrintLineItem[] {\r\n  if (!methods) return [];\r\n  return methods.map((method) => ({\r\n    '{payment_method_name}': method.name,\r\n    '{payment_method_amount}': formatCurrency(method.amount),\r\n  }));\r\n}\r\n\r\n// Line items generic\r\nexport function mapSalesSummaryLineItems(items: SalesSummaryForPrint['lineItems']): PrintLineItem[] {\r\n  if (!items) return [];\r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_product_name}': item.productName || '',\r\n    '{line_quantity}': item.quantity?.toString() || '0',\r\n    '{line_amount}': formatCurrency(item.amount),\r\n  }));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4976, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/warranty-request.mapper.ts"],"sourcesContent":["/**\r\n * Warranty Request Mapper - Phiếu yêu cầu bảo hành (phieu-yeu-cau-bao-hanh)\r\n * Đồng bộ với variables/phieu-yeu-cau-bao-hanh.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatCurrency,\r\n  formatDate,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface WarrantyRequestForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  warrantyRequestCode?: string;\r\n  orderCode?: string;\r\n  createdAt: string | Date;\r\n  createdAtTime?: string;\r\n  modifiedAt?: string | Date;\r\n  createdBy?: string;\r\n  reference?: string;\r\n  status?: string;\r\n  priority?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // Thông tin khách hàng\r\n  customerCode?: string;\r\n  customerName?: string;\r\n  customerPhone?: string;\r\n  customerAddress?: string;\r\n  customerEmail?: string;\r\n  customerGroup?: string;\r\n  \r\n  // Thông tin sản phẩm\r\n  productCode?: string;\r\n  productName?: string;\r\n  serialNumber?: string;\r\n  purchaseDate?: string | Date;\r\n  warrantyExpiredOn?: string | Date;\r\n  warrantyDuration?: string;\r\n  \r\n  // Thông tin sự cố\r\n  issueType?: string;\r\n  issueDescription?: string;\r\n  deviceCondition?: string;\r\n  accessories?: string;\r\n  \r\n  // Xử lý\r\n  receivedBy?: string;\r\n  technicianName?: string;\r\n  expectedCompletionDate?: string | Date;\r\n  note?: string;\r\n  \r\n  // Tags\r\n  tag?: string;\r\n  \r\n  // Danh sách sản phẩm\r\n  items: Array<{\r\n    productName: string;\r\n    variantName?: string;\r\n    variantSku?: string;\r\n    variantBarcode?: string;\r\n    serial?: string;\r\n    warrantyCardCode?: string;\r\n    quantity: number;\r\n    requestType?: string;\r\n    receivedOn?: string | Date;\r\n    status?: string;\r\n    expenseTitle?: string;\r\n    expenseAmount?: number;\r\n    expenseTotalAmount?: number;\r\n  }>;\r\n  \r\n  // Tổng giá trị\r\n  totalQuantity: number;\r\n  totalAmount?: number;\r\n}\r\n\r\nexport function mapWarrantyRequestToPrintData(request: WarrantyRequestForPrint, storeSettings: StoreSettings): PrintData {\r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': request.location?.name || storeSettings.name || '',\r\n    '{location_address}': request.location?.address || storeSettings.address || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    '{location_province}': request.location?.province || '',\r\n    \r\n    // === THÔNG TIN PHIẾU YÊU CẦU BẢO HÀNH ===\r\n    '{warranty_claim_card_code}': request.code,\r\n    '{warranty_request_code}': request.warrantyRequestCode || request.code,\r\n    '{order_code}': request.orderCode || '',\r\n    '{created_on}': formatDate(request.createdAt),\r\n    '{created_on_time}': request.createdAtTime || '',\r\n    '{modified_on}': formatDate(request.modifiedAt),\r\n    '{account_name}': request.createdBy || '',\r\n    '{reference}': request.reference || '',\r\n    '{status}': request.status || '',\r\n    '{priority}': request.priority || '',\r\n    \r\n    // === THÔNG TIN KHÁCH HÀNG ===\r\n    '{customer_code}': request.customerCode || '',\r\n    '{customer_name}': request.customerName || '',\r\n    '{customer_phone_number}': request.customerPhone || '',\r\n    '{customer_address1}': request.customerAddress || '',\r\n    '{customer_address}': request.customerAddress || '',\r\n    '{customer_email}': request.customerEmail || '',\r\n    '{customer_group}': request.customerGroup || '',\r\n    \r\n    // === THÔNG TIN SẢN PHẨM ===\r\n    '{product_code}': request.productCode || '',\r\n    '{product_name}': request.productName || '',\r\n    '{serial_number}': request.serialNumber || '',\r\n    '{purchase_date}': formatDate(request.purchaseDate),\r\n    '{warranty_expired_on}': formatDate(request.warrantyExpiredOn),\r\n    '{warranty_duration}': request.warrantyDuration || '',\r\n    \r\n    // === THÔNG TIN SỰ CỐ ===\r\n    '{issue_type}': request.issueType || '',\r\n    '{issue_description}': request.issueDescription || '',\r\n    '{device_condition}': request.deviceCondition || '',\r\n    '{accessories}': request.accessories || '',\r\n    \r\n    // === XỬ LÝ ===\r\n    '{received_by}': request.receivedBy || '',\r\n    '{technician_name}': request.technicianName || '',\r\n    '{expected_completion_date}': formatDate(request.expectedCompletionDate),\r\n    '{note}': request.note || '',\r\n    \r\n    // === TAGS ===\r\n    '{tag}': request.tag || '',\r\n    \r\n    // === TỔNG GIÁ TRỊ ===\r\n    '{total_quantity}': request.totalQuantity.toString(),\r\n    '{total_amount}': formatCurrency(request.totalAmount),\r\n  };\r\n}\r\n\r\nexport function mapWarrantyRequestLineItems(items: WarrantyRequestForPrint['items']): PrintLineItem[] {\r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_product_name}': item.productName,\r\n    '{line_variant_name}': item.variantName || '',\r\n    '{line_variant_sku}': item.variantSku || '',\r\n    '{line_variant_barcode}': item.variantBarcode || '',\r\n    '{serials}': item.serial || '',\r\n    '{warranty_card_code}': item.warrantyCardCode || '',\r\n    '{line_quantity}': item.quantity.toString(),\r\n    '{line_type}': item.requestType || '',\r\n    '{line_received_on}': formatDate(item.receivedOn),\r\n    '{line_status}': item.status || '',\r\n    '{line_expense_title}': item.expenseTitle || '',\r\n    '{line_expense_amount}': formatCurrency(item.expenseAmount),\r\n    '{line_expense_total_amount}': formatCurrency(item.expenseTotalAmount),\r\n  }));\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;;CAGC,GAED;AAAA;;AAkFO,SAAS,8BAA8B,OAAgC,EAAE,aAA4B;IAC1G,OAAO;QACL,GAAG,IAAA,uIAAY,EAAC,cAAc;QAE9B,8BAA8B;QAC9B,mBAAmB,QAAQ,QAAQ,EAAE,QAAQ,cAAc,IAAI,IAAI;QACnE,sBAAsB,QAAQ,QAAQ,EAAE,WAAW,cAAc,OAAO,IAAI;QAC5E,oBAAoB,cAAc,QAAQ,IAAI;QAC9C,uBAAuB,QAAQ,QAAQ,EAAE,YAAY;QAErD,2CAA2C;QAC3C,8BAA8B,QAAQ,IAAI;QAC1C,2BAA2B,QAAQ,mBAAmB,IAAI,QAAQ,IAAI;QACtE,gBAAgB,QAAQ,SAAS,IAAI;QACrC,gBAAgB,IAAA,qIAAU,EAAC,QAAQ,SAAS;QAC5C,qBAAqB,QAAQ,aAAa,IAAI;QAC9C,iBAAiB,IAAA,qIAAU,EAAC,QAAQ,UAAU;QAC9C,kBAAkB,QAAQ,SAAS,IAAI;QACvC,eAAe,QAAQ,SAAS,IAAI;QACpC,YAAY,QAAQ,MAAM,IAAI;QAC9B,cAAc,QAAQ,QAAQ,IAAI;QAElC,+BAA+B;QAC/B,mBAAmB,QAAQ,YAAY,IAAI;QAC3C,mBAAmB,QAAQ,YAAY,IAAI;QAC3C,2BAA2B,QAAQ,aAAa,IAAI;QACpD,uBAAuB,QAAQ,eAAe,IAAI;QAClD,sBAAsB,QAAQ,eAAe,IAAI;QACjD,oBAAoB,QAAQ,aAAa,IAAI;QAC7C,oBAAoB,QAAQ,aAAa,IAAI;QAE7C,6BAA6B;QAC7B,kBAAkB,QAAQ,WAAW,IAAI;QACzC,kBAAkB,QAAQ,WAAW,IAAI;QACzC,mBAAmB,QAAQ,YAAY,IAAI;QAC3C,mBAAmB,IAAA,qIAAU,EAAC,QAAQ,YAAY;QAClD,yBAAyB,IAAA,qIAAU,EAAC,QAAQ,iBAAiB;QAC7D,uBAAuB,QAAQ,gBAAgB,IAAI;QAEnD,0BAA0B;QAC1B,gBAAgB,QAAQ,SAAS,IAAI;QACrC,uBAAuB,QAAQ,gBAAgB,IAAI;QACnD,sBAAsB,QAAQ,eAAe,IAAI;QACjD,iBAAiB,QAAQ,WAAW,IAAI;QAExC,gBAAgB;QAChB,iBAAiB,QAAQ,UAAU,IAAI;QACvC,qBAAqB,QAAQ,cAAc,IAAI;QAC/C,8BAA8B,IAAA,qIAAU,EAAC,QAAQ,sBAAsB;QACvE,UAAU,QAAQ,IAAI,IAAI;QAE1B,eAAe;QACf,SAAS,QAAQ,GAAG,IAAI;QAExB,uBAAuB;QACvB,oBAAoB,QAAQ,aAAa,CAAC,QAAQ;QAClD,kBAAkB,IAAA,yIAAc,EAAC,QAAQ,WAAW;IACtD;AACF;AAEO,SAAS,4BAA4B,KAAuC;IACjF,OAAO,MAAM,GAAG,CAAC,CAAC,MAAM,QAAU,CAAC;YACjC,cAAc,CAAC,QAAQ,CAAC,EAAE,QAAQ;YAClC,uBAAuB,KAAK,WAAW;YACvC,uBAAuB,KAAK,WAAW,IAAI;YAC3C,sBAAsB,KAAK,UAAU,IAAI;YACzC,0BAA0B,KAAK,cAAc,IAAI;YACjD,aAAa,KAAK,MAAM,IAAI;YAC5B,wBAAwB,KAAK,gBAAgB,IAAI;YACjD,mBAAmB,KAAK,QAAQ,CAAC,QAAQ;YACzC,eAAe,KAAK,WAAW,IAAI;YACnC,sBAAsB,IAAA,qIAAU,EAAC,KAAK,UAAU;YAChD,iBAAiB,KAAK,MAAM,IAAI;YAChC,wBAAwB,KAAK,YAAY,IAAI;YAC7C,yBAAyB,IAAA,yIAAc,EAAC,KAAK,aAAa;YAC1D,+BAA+B,IAAA,yIAAc,EAAC,KAAK,kBAAkB;QACvE,CAAC;AACH"}},
    {"offset": {"line": 5061, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/packing-request.mapper.ts"],"sourcesContent":["/**\r\n * Packing Request Mapper - Phiếu yêu cầu đóng gói (phieu-yeu-cau-dong-goi)\r\n * Đồng bộ với variables/phieu-yeu-cau-dong-goi.ts\r\n */\r\n\r\nimport { \r\n  PrintData, \r\n  PrintLineItem,\r\n  formatCurrency,\r\n  formatDate,\r\n  formatTime,\r\n  hidePhoneMiddle,\r\n  getStoreData,\r\n  StoreSettings\r\n} from './types';\r\n\r\nexport interface PackingRequestForPrint {\r\n  // Thông tin cơ bản\r\n  code: string;\r\n  orderCode?: string;\r\n  packingRequestCode?: string;\r\n  createdAt: string | Date;\r\n  packedOn?: string | Date;\r\n  cancelDate?: string | Date;\r\n  deadline?: string | Date;\r\n  priority?: string;\r\n  \r\n  // Nhân viên\r\n  accountName?: string;\r\n  packedProcessingAccountName?: string;\r\n  cancelAccountName?: string;\r\n  assigneeName?: string;\r\n  assignedEmployee?: string;\r\n  \r\n  // Trạng thái\r\n  status?: string;\r\n  \r\n  // Thông tin chi nhánh\r\n  location?: {\r\n    name?: string;\r\n    address?: string;\r\n    province?: string;\r\n  };\r\n  \r\n  // Thông tin khách hàng\r\n  customerName?: string;\r\n  customerPhone?: string;\r\n  customerEmail?: string;\r\n  shippingAddress?: string;\r\n  \r\n  // Thông tin vận chuyển\r\n  carrierName?: string;\r\n  serviceName?: string;\r\n  cod?: number;\r\n  \r\n  // Ngày hẹn giao\r\n  shipOnMin?: string | Date;\r\n  shipOnMax?: string | Date;\r\n  \r\n  // Ghi chú\r\n  orderNote?: string;\r\n  packingNote?: string;\r\n  specialRequest?: string;\r\n  \r\n  // Danh sách sản phẩm\r\n  items: Array<{\r\n    variantCode?: string;\r\n    productName: string;\r\n    variantName?: string;\r\n    unit?: string;\r\n    quantity: number;\r\n    price?: number;\r\n    discountRate?: number;\r\n    discountAmount?: number;\r\n    taxRate?: number;\r\n    taxType?: string;\r\n    amount?: number;\r\n    lotNumber?: string;\r\n    lotInfo?: string;\r\n    lotInfoQty?: string;\r\n    lotInfoExpiry?: string;\r\n    note?: string;\r\n    binLocation?: string;\r\n  }>;\r\n  \r\n  // Tổng giá trị\r\n  totalQuantity: number;\r\n  totalTax?: number;\r\n  fulfillmentDiscount?: number;\r\n  total?: number;\r\n  totalWeight?: number;\r\n}\r\n\r\nexport function mapPackingRequestToPrintData(request: PackingRequestForPrint, storeSettings: StoreSettings): PrintData {\r\n  const barcode = request.code \r\n    ? `https://barcodeapi.org/api/128/${encodeURIComponent(request.code)}`\r\n    : '';\r\n  const orderBarcode = request.orderCode \r\n    ? `https://barcodeapi.org/api/128/${encodeURIComponent(request.orderCode)}`\r\n    : '';\r\n    \r\n  return {\r\n    ...getStoreData(storeSettings),\r\n    \r\n    // === THÔNG TIN CHI NHÁNH ===\r\n    '{location_name}': request.location?.name || storeSettings.name || '',\r\n    '{location_address}': request.location?.address || storeSettings.address || '',\r\n    '{store_province}': storeSettings.province || '',\r\n    '{location_province}': request.location?.province || '',\r\n    \r\n    // === THÔNG TIN PHIẾU YÊU CẦU ĐÓNG GÓI ===\r\n    '{code}': request.code,\r\n    '{packing_request_code}': request.packingRequestCode || request.code,\r\n    '{bar_code(code)}': barcode,\r\n    '{order_code}': request.orderCode || '',\r\n    '{bar_code(order_code)}': orderBarcode,\r\n    '{created_on}': formatDate(request.createdAt),\r\n    '{created_on_time}': formatTime(request.createdAt),\r\n    '{packed_on}': formatDate(request.packedOn),\r\n    '{packed_on_time}': formatTime(request.packedOn),\r\n    '{cancel_date}': formatDate(request.cancelDate),\r\n    '{ship_on_min}': formatDate(request.shipOnMin),\r\n    '{ship_on_max}': formatDate(request.shipOnMax),\r\n    '{deadline}': formatDate(request.deadline),\r\n    '{priority}': request.priority || '',\r\n    \r\n    // === NHÂN VIÊN ===\r\n    '{account_name}': request.accountName || '',\r\n    '{packed_processing_account_name}': request.packedProcessingAccountName || '',\r\n    '{cancel_account_name}': request.cancelAccountName || '',\r\n    '{assignee_name}': request.assigneeName || '',\r\n    '{assigned_employee}': request.assignedEmployee || request.assigneeName || '',\r\n    \r\n    // === TRẠNG THÁI ===\r\n    '{status}': request.status || '',\r\n    \r\n    // === THÔNG TIN KHÁCH HÀNG ===\r\n    '{customer_name}': request.customerName || '',\r\n    '{customer_phone_number}': request.customerPhone || '',\r\n    '{customer_phone_number_hide}': hidePhoneMiddle(request.customerPhone || ''),\r\n    '{customer_email}': request.customerEmail || '',\r\n    '{shipping_address}': request.shippingAddress || '',\r\n    \r\n    // === THÔNG TIN VẬN CHUYỂN ===\r\n    '{carrier_name}': request.carrierName || '',\r\n    '{service_name}': request.serviceName || '',\r\n    '{cod}': formatCurrency(request.cod),\r\n    \r\n    // === GHI CHÚ ===\r\n    '{order_note}': request.orderNote || '',\r\n    '{packing_note}': request.packingNote || '',\r\n    '{special_request}': request.specialRequest || '',\r\n    \r\n    // === TỔNG GIÁ TRỊ ===\r\n    '{total_quantity}': request.totalQuantity.toString(),\r\n    '{total_tax}': formatCurrency(request.totalTax),\r\n    '{fulfillment_discount}': formatCurrency(request.fulfillmentDiscount),\r\n    '{total}': formatCurrency(request.total),\r\n    '{total_weight}': request.totalWeight?.toString() || '0',\r\n  };\r\n}\r\n\r\nexport function mapPackingRequestLineItems(items: PackingRequestForPrint['items']): PrintLineItem[] {\r\n  return items.map((item, index) => ({\r\n    '{line_stt}': (index + 1).toString(),\r\n    '{line_variant_code}': item.variantCode || '',\r\n    '{line_product_name}': item.productName,\r\n    '{line_variant}': item.variantName || '',\r\n    '{line_unit}': item.unit || 'Cái',\r\n    '{line_quantity}': item.quantity.toString(),\r\n    '{line_price}': formatCurrency(item.price),\r\n    '{line_discount_rate}': item.discountRate ? `${item.discountRate}%` : '',\r\n    '{line_discount_amount}': formatCurrency(item.discountAmount),\r\n    '{line_tax_rate}': item.taxRate ? `${item.taxRate}%` : '',\r\n    '{line_tax}': item.taxType || '',\r\n    '{line_amount}': formatCurrency(item.amount),\r\n    '{lots_number_code1}': item.lotNumber || '',\r\n    '{lots_number_code2}': item.lotInfoQty || '',\r\n    '{lots_number_code3}': item.lotInfo || '',\r\n    '{lots_number_code4}': item.lotInfoExpiry || '',\r\n    '{line_note}': item.note || '',\r\n    '{bin_location}': item.binLocation || '',\r\n  }));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5154, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-mappers/index.ts"],"sourcesContent":["/**\r\n * Print Mappers - Index\r\n * Export tất cả mappers từ một nơi\r\n */\r\n\r\n// Types & Utilities\r\nexport * from './types';\r\n\r\n// =============================================\r\n// MAIN TEMPLATE TYPES (16 loại chính)\r\n// =============================================\r\n\r\n// Order - Đơn bán hàng\r\nexport * from './order.mapper';\r\n\r\n// Quote - Báo giá / Đơn tạm tính\r\nexport * from './quote.mapper';\r\n\r\n// Sales Return - Đơn đổi trả hàng\r\nexport * from './sales-return.mapper';\r\n\r\n// Packing - Phiếu đóng gói\r\nexport * from './packing.mapper';\r\n\r\n// Delivery - Phiếu giao hàng\r\nexport * from './delivery.mapper';\r\n\r\n// Shipping Label - Nhãn giao hàng\r\nexport * from './shipping-label.mapper';\r\n\r\n// Product Label - Tem phụ sản phẩm\r\nexport * from './product-label.mapper';\r\n\r\n// Purchase Order - Đơn đặt hàng nhập\r\nexport * from './purchase-order.mapper';\r\n\r\n// Stock In - Phiếu nhập kho\r\nexport * from './stock-in.mapper';\r\n\r\n// Stock Transfer - Phiếu chuyển kho\r\nexport * from './stock-transfer.mapper';\r\n\r\n// Inventory Check - Phiếu kiểm kho\r\nexport * from './inventory-check.mapper';\r\n\r\n// Receipt - Phiếu thu\r\nexport * from './receipt.mapper';\r\n\r\n// Payment - Phiếu chi\r\nexport * from './payment.mapper';\r\n\r\n// Warranty - Phiếu bảo hành\r\nexport * from './warranty.mapper';\r\n\r\n// Supplier Return - Phiếu trả hàng NCC\r\nexport * from './supplier-return.mapper';\r\n\r\n// Complaint - Phiếu khiếu nại\r\nexport * from './complaint.mapper';\r\n\r\n// Penalty - Phiếu phạt\r\nexport * from './penalty.mapper';\r\n\r\n// =============================================\r\n// EXTENDED TEMPLATE TYPES (8 loại mở rộng)\r\n// =============================================\r\n\r\n// Supplier Order - Đơn đặt hàng nhập (don-dat-hang-nhap)\r\nexport * from './supplier-order.mapper';\r\n\r\n// Return Order - Đơn trả hàng (don-tra-hang)\r\nexport * from './return-order.mapper';\r\n\r\n// Handover - Phiếu bàn giao (phieu-ban-giao)\r\nexport * from './handover.mapper';\r\n\r\n// Refund Confirmation - Phiếu xác nhận hoàn (phieu-xac-nhan-hoan)\r\nexport * from './refund-confirmation.mapper';\r\n\r\n// Packing Guide - Phiếu hướng dẫn đóng gói (phieu-huong-dan-dong-goi)\r\nexport * from './packing-guide.mapper';\r\n\r\n// Sales Summary - Phiếu tổng kết bán hàng (phieu-tong-ket-ban-hang)\r\nexport * from './sales-summary.mapper';\r\n\r\n// Warranty Request - Phiếu yêu cầu bảo hành (phieu-yeu-cau-bao-hanh)\r\nexport * from './warranty-request.mapper';\r\n\r\n// Packing Request - Phiếu yêu cầu đóng gói (phieu-yeu-cau-dong-goi)\r\nexport * from './packing-request.mapper';\r\n"],"names":[],"mappings":";AAAA;;;CAGC,GAED,oBAAoB;AACpB;AAEA,gDAAgD;AAChD,sCAAsC;AACtC,gDAAgD;AAEhD,uBAAuB;AACvB;AAEA,iCAAiC;AACjC;AAEA,kCAAkC;AAClC;AAEA,2BAA2B;AAC3B;AAEA,6BAA6B;AAC7B;AAEA,kCAAkC;AAClC;AAEA,mCAAmC;AACnC;AAEA,qCAAqC;AACrC;AAEA,4BAA4B;AAC5B;AAEA,oCAAoC;AACpC;AAEA,mCAAmC;AACnC;AAEA,sBAAsB;AACtB;AAEA,sBAAsB;AACtB;AAEA,4BAA4B;AAC5B;AAEA,uCAAuC;AACvC;AAEA,8BAA8B;AAC9B;AAEA,uBAAuB;AACvB;AAEA,gDAAgD;AAChD,2CAA2C;AAC3C,gDAAgD;AAEhD,yDAAyD;AACzD;AAEA,6CAA6C;AAC7C;AAEA,6CAA6C;AAC7C;AAEA,kEAAkE;AAClE;AAEA,sEAAsE;AACtE;AAEA,oEAAoE;AACpE;AAEA,qEAAqE;AACrE;AAEA,oEAAoE;AACpE"}},
    {"offset": {"line": 5246, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print-data-mappers.ts"],"sourcesContent":["/**\r\n * Print Data Mappers\r\n * \r\n * @deprecated File này đã được tách thành thư mục `lib/print-mappers/`\r\n * Import từ `@/lib/print-mappers` thay vì file này\r\n * \r\n * File này chỉ re-export để đảm bảo backward compatibility\r\n */\r\n\r\nexport * from './print-mappers';\r\n"],"names":[],"mappings":";AAAA;;;;;;;CAOC,GAED"}},
    {"offset": {"line": 5260, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/lib/print/order-print-helper.ts"],"sourcesContent":["/**\r\n * Order Print Helper\r\n * Helpers để chuẩn bị dữ liệu in cho đơn hàng\r\n */\r\n\r\nimport type { Order, LineItem, Packaging } from '../../features/orders/types';\r\nimport type { Customer } from '../../features/customers/types';\r\nimport type { Branch } from '../../features/settings/branches/types';\r\nimport type { Employee } from '../../features/employees/types';\r\nimport { \r\n  OrderForPrint, \r\n  DeliveryForPrint, \r\n  ShippingLabelForPrint,\r\n  PackingForPrint,\r\n  mapOrderToPrintData, \r\n  mapOrderLineItems,\r\n  mapDeliveryToPrintData,\r\n  mapDeliveryLineItems,\r\n  mapShippingLabelToPrintData,\r\n  mapPackingToPrintData,\r\n  mapPackingLineItems,\r\n} from '../print-data-mappers';\r\nimport { StoreSettings, getStoreLogo } from '../print-service';\r\nimport { formatOrderAddress } from '../../features/orders/address-utils';\r\n\r\n/**\r\n * Chuyển đổi Order entity sang OrderForPrint\r\n */\r\nexport function convertOrderForPrint(\r\n  order: Order,\r\n  options: {\r\n    customer?: Customer | null;\r\n    createdByEmployee?: Employee | null;\r\n  } = {}\r\n): OrderForPrint {\r\n  const { customer, createdByEmployee } = options;\r\n\r\n  // Tính tổng số lượng\r\n  const totalQuantity = order.lineItems.reduce((sum, item) => sum + item.quantity, 0);\r\n\r\n  // Tính tổng giảm giá dòng\r\n  const lineDiscounts = order.lineItems.reduce((sum, item) => {\r\n    if (item.discountType === 'percentage') {\r\n      return sum + (item.unitPrice * item.quantity * item.discount / 100);\r\n    }\r\n    return sum + (item.discount * item.quantity);\r\n  }, 0);\r\n\r\n  // Tổng giảm giá (dòng + đơn)\r\n  const totalDiscount = lineDiscounts + (order.orderDiscount || 0) + (order.voucherAmount || 0);\r\n\r\n  // Format địa chỉ\r\n  const shippingAddr = typeof order.shippingAddress === 'string' \r\n    ? order.shippingAddress \r\n    : formatOrderAddress(order.shippingAddress);\r\n  \r\n  const billingAddr = typeof order.billingAddress === 'string'\r\n    ? order.billingAddress\r\n    : formatOrderAddress(order.billingAddress);\r\n\r\n  // Get customer first address for fallback\r\n  const customerFirstAddress = customer?.addresses?.[0];\r\n  const customerAddressString = customerFirstAddress \r\n    ? [customerFirstAddress.street, customerFirstAddress.ward, customerFirstAddress.district, customerFirstAddress.province].filter(Boolean).join(', ')\r\n    : '';\r\n\r\n  return {\r\n    code: order.id,\r\n    createdAt: order.orderDate,\r\n    createdBy: createdByEmployee?.fullName || order.salesperson,\r\n    // Trạng thái\r\n    status: order.status,\r\n    paymentStatus: order.paymentStatus,\r\n    fulfillmentStatus: order.deliveryStatus,\r\n    // Customer\r\n    customer: customer ? {\r\n      name: customer.name,\r\n      code: customer.id, // Customer business ID\r\n      phone: customer.phone,\r\n      email: customer.email,\r\n      group: customer.customerGroup || '',\r\n      address: customerAddressString,\r\n    } : {\r\n      name: order.customerName,\r\n    },\r\n    billingAddress: billingAddr,\r\n    shippingAddress: shippingAddr,\r\n    items: order.lineItems.map(item => {\r\n      const lineDiscount = item.discountType === 'percentage'\r\n        ? item.unitPrice * item.quantity * item.discount / 100\r\n        : item.discount * item.quantity;\r\n      const lineAmountBeforeTax = item.unitPrice * item.quantity - lineDiscount;\r\n      \r\n      // Tính thuế cho từng dòng\r\n      const taxRate = item.tax || 0; // % thuế (ví dụ: 10)\r\n      const lineTaxAmount = lineAmountBeforeTax * taxRate / 100;\r\n      const lineAmount = lineAmountBeforeTax + lineTaxAmount;\r\n      \r\n      return {\r\n        productName: item.productName,\r\n        variantName: '', // Could be extracted from productName if formatted as \"Product - Variant\"\r\n        variantCode: item.productId,\r\n        unit: 'Cái',\r\n        quantity: item.quantity,\r\n        price: item.unitPrice,\r\n        discountAmount: lineDiscount,\r\n        taxAmount: lineTaxAmount,\r\n        taxRate: taxRate,\r\n        amount: lineAmount,\r\n        note: item.note || '', // Ghi chú sản phẩm\r\n      };\r\n    }),\r\n    totalQuantity,\r\n    subtotal: order.subtotal,\r\n    totalDiscount,\r\n    totalTax: order.tax,\r\n    deliveryFee: order.shippingFee,\r\n    total: order.grandTotal,\r\n    paymentMethod: order.expectedPaymentMethod || (order.payments[0]?.method),\r\n    paidAmount: order.paidAmount,\r\n    changeAmount: order.paidAmount > order.grandTotal ? order.paidAmount - order.grandTotal : 0,\r\n    note: order.notes,\r\n  };\r\n}\r\n\r\n/**\r\n * Chuyển đổi Order + Packaging sang DeliveryForPrint\r\n */\r\nexport function convertPackagingToDeliveryForPrint(\r\n  order: Order,\r\n  packaging: Packaging,\r\n  options: {\r\n    customer?: Customer | null;\r\n  } = {}\r\n): DeliveryForPrint {\r\n  const { customer } = options;\r\n\r\n  // Format địa chỉ\r\n  const shippingAddr = typeof order.shippingAddress === 'string' \r\n    ? order.shippingAddress \r\n    : formatOrderAddress(order.shippingAddress);\r\n\r\n  // Lấy contact info từ shipping address nếu là object\r\n  let recipientName = customer?.name || order.customerName;\r\n  let recipientPhone = customer?.phone;\r\n\r\n  if (typeof order.shippingAddress === 'object' && order.shippingAddress) {\r\n    recipientName = order.shippingAddress.contactName || recipientName;\r\n    recipientPhone = order.shippingAddress.phone || order.shippingAddress.contactPhone || recipientPhone;\r\n  }\r\n\r\n  return {\r\n    code: packaging.id,\r\n    orderCode: order.id,\r\n    createdAt: packaging.requestDate,\r\n    createdBy: packaging.requestingEmployeeName,\r\n    trackingCode: packaging.trackingCode,\r\n    carrierName: packaging.carrier,\r\n    // Thông tin khách hàng\r\n    customerName: customer?.name || order.customerName,\r\n    customerCode: customer?.id,\r\n    customerPhone: customer?.phone,\r\n    customerEmail: customer?.email,\r\n    // Thông tin người nhận\r\n    receiverName: recipientName,\r\n    receiverPhone: recipientPhone,\r\n    shippingAddress: shippingAddr,\r\n    // Danh sách sản phẩm\r\n    items: order.lineItems.map(item => ({\r\n      variantCode: item.productId,\r\n      productName: item.productName,\r\n      variantName: '',\r\n      quantity: item.quantity,\r\n      price: item.unitPrice,\r\n      amount: item.unitPrice * item.quantity,\r\n      note: item.note,\r\n    })),\r\n    // Tổng giá trị\r\n    totalQuantity: order.lineItems.reduce((sum, item) => sum + item.quantity, 0),\r\n    subtotal: order.subtotal,\r\n    deliveryFee: order.shippingFee,\r\n    codAmount: packaging.codAmount || order.codAmount,\r\n    totalAmount: order.grandTotal,\r\n    note: packaging.noteToShipper,\r\n  };\r\n}\r\n\r\n/**\r\n * Chuyển đổi Order + Packaging sang ShippingLabelForPrint\r\n */\r\nexport function convertToShippingLabelForPrint(\r\n  order: Order,\r\n  packaging: Packaging,\r\n  options: {\r\n    customer?: Customer | null;\r\n  } = {}\r\n): ShippingLabelForPrint {\r\n  const { customer } = options;\r\n\r\n  const shippingAddr = typeof order.shippingAddress === 'string' \r\n    ? order.shippingAddress \r\n    : formatOrderAddress(order.shippingAddress);\r\n\r\n  let recipientName = customer?.name || order.customerName;\r\n  let recipientPhone = customer?.phone;\r\n\r\n  if (typeof order.shippingAddress === 'object' && order.shippingAddress) {\r\n    recipientName = order.shippingAddress.contactName || recipientName;\r\n    recipientPhone = order.shippingAddress.phone || order.shippingAddress.contactPhone || recipientPhone;\r\n  }\r\n\r\n  const totalItems = order.lineItems.reduce((sum, item) => sum + item.quantity, 0);\r\n\r\n  return {\r\n    orderCode: order.id,\r\n    trackingCode: packaging.trackingCode,\r\n    carrierName: packaging.carrier,\r\n    // Thông tin khách hàng\r\n    customerName: customer?.name || order.customerName,\r\n    customerPhone: customer?.phone,\r\n    shippingAddress: shippingAddr,\r\n    // Thông tin người nhận (nếu khác)\r\n    receiverName: recipientName,\r\n    receiverPhone: recipientPhone,\r\n    totalItems,\r\n    packingWeight: packaging.weight ? packaging.weight / 1000 : undefined, // Convert grams to kg\r\n    codAmount: packaging.codAmount || order.codAmount,\r\n    note: packaging.noteToShipper,\r\n  };\r\n}\r\n\r\n/**\r\n * Chuyển đổi Order + Packaging sang PackingForPrint (phiếu đóng gói)\r\n */\r\nexport function convertToPackingForPrint(\r\n  order: Order,\r\n  packaging: Packaging,\r\n  options: {\r\n    customer?: Customer | null;\r\n    productBinLocations?: Record<string, string>; // productSystemId -> bin location\r\n    assignedEmployee?: Employee | null;\r\n  } = {}\r\n): PackingForPrint {\r\n  const { customer, productBinLocations = {}, assignedEmployee } = options;\r\n\r\n  const shippingAddr = typeof order.shippingAddress === 'string' \r\n    ? order.shippingAddress \r\n    : formatOrderAddress(order.shippingAddress);\r\n\r\n  let recipientName = customer?.name || order.customerName;\r\n  let recipientPhone = customer?.phone;\r\n\r\n  if (typeof order.shippingAddress === 'object' && order.shippingAddress) {\r\n    recipientName = order.shippingAddress.contactName || recipientName;\r\n    recipientPhone = order.shippingAddress.phone || order.shippingAddress.contactPhone || recipientPhone;\r\n  }\r\n\r\n  // Extract ward/district from shippingAddress if it's an object\r\n  const shippingWard = typeof order.shippingAddress === 'object' && order.shippingAddress\r\n    ? order.shippingAddress.ward\r\n    : undefined;\r\n  const shippingDistrict = typeof order.shippingAddress === 'object' && order.shippingAddress\r\n    ? order.shippingAddress.district\r\n    : undefined;\r\n\r\n  return {\r\n    code: packaging.id,\r\n    createdAt: packaging.requestDate,\r\n    packedAt: packaging.confirmDate,\r\n    createdBy: packaging.requestingEmployeeName,\r\n    orderCode: order.id,\r\n    fulfillmentStatus: packaging.status,\r\n    assignedEmployee: assignedEmployee?.fullName || packaging.assignedEmployeeName,\r\n    customerName: recipientName,\r\n    customerCode: customer?.id,\r\n    customerPhone: recipientPhone,\r\n    customerEmail: customer?.email,\r\n    shippingAddress: shippingAddr,\r\n    shippingWard,\r\n    shippingDistrict,\r\n    items: order.lineItems.map(item => ({\r\n      variantCode: item.productId,\r\n      productName: item.productName,\r\n      variantName: '',\r\n      quantity: item.quantity,\r\n      binLocation: productBinLocations[item.productSystemId] || '',\r\n    })),\r\n    totalQuantity: order.lineItems.reduce((sum, item) => sum + item.quantity, 0),\r\n    codAmount: packaging.codAmount || order.codAmount,\r\n    note: packaging.notes,\r\n    orderNote: order.notes,\r\n  };\r\n}\r\n\r\n/**\r\n * Tạo StoreSettings từ Branch và branding info\r\n * Note: branch param accepts any object with name/address/phone for flexibility with API responses\r\n */\r\nexport function createStoreSettings(\r\n  branch?: { name?: string; address?: string; phone?: string } | null,\r\n  options?: { logo?: string | null }\r\n): StoreSettings {\r\n  if (!branch) {\r\n    return {\r\n      name: '',\r\n      address: '',\r\n      phone: '',\r\n      email: '',\r\n      logo: options?.logo || undefined,\r\n    };\r\n  }\r\n\r\n  return {\r\n    name: branch.name,\r\n    address: branch.address || '',\r\n    phone: branch.phone || '',\r\n    email: '', // Branch không có email, có thể lấy từ company settings sau\r\n    logo: options?.logo || undefined,\r\n  };\r\n}\r\n\r\n// Re-export mappers để dùng trực tiếp\r\nexport {\r\n  mapOrderToPrintData,\r\n  mapOrderLineItems,\r\n  mapDeliveryToPrintData,\r\n  mapDeliveryLineItems,\r\n  mapShippingLabelToPrintData,\r\n  mapPackingToPrintData,\r\n  mapPackingLineItems,\r\n};\r\n"],"names":[],"mappings":"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"}}]
}