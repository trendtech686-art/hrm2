{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/purchase-returns/api/purchase-returns-api.ts"],"sourcesContent":["/**\r\n * Purchase Returns (Phiếu Hoàn Trả NCC) API functions\r\n * \r\n * ⚠️ Direct import: import { fetchPurchaseReturns } from '@/features/purchase-returns/api/purchase-returns-api'\r\n */\r\n\r\nimport type { SystemId } from '@/lib/id-types';\r\nimport type { PurchaseReturn } from '../types';\r\n\r\nconst BASE_URL = '/api/purchase-returns';\r\n\r\nexport interface PurchaseReturnsParams {\r\n  page?: number;\r\n  limit?: number;\r\n  search?: string;\r\n  supplierId?: string;\r\n  purchaseOrderId?: string;\r\n  branchId?: string;\r\n  startDate?: string;\r\n  endDate?: string;\r\n  sortBy?: string;\r\n  sortOrder?: 'asc' | 'desc';\r\n}\r\n\r\nexport interface PurchaseReturnsResponse {\r\n  data: PurchaseReturn[];\r\n  total: number;\r\n  page: number;\r\n  pageSize: number;\r\n}\r\n\r\nexport async function fetchPurchaseReturns(params: PurchaseReturnsParams = {}): Promise<PurchaseReturnsResponse> {\r\n  const searchParams = new URLSearchParams();\r\n  \r\n  if (params.page) searchParams.set('page', String(params.page));\r\n  if (params.limit) searchParams.set('limit', String(params.limit));\r\n  if (params.search) searchParams.set('search', params.search);\r\n  if (params.supplierId) searchParams.set('supplierId', params.supplierId);\r\n  if (params.purchaseOrderId) searchParams.set('purchaseOrderId', params.purchaseOrderId);\r\n  if (params.branchId) searchParams.set('branchId', params.branchId);\r\n  if (params.startDate) searchParams.set('startDate', params.startDate);\r\n  if (params.endDate) searchParams.set('endDate', params.endDate);\r\n  if (params.sortBy) searchParams.set('sortBy', params.sortBy);\r\n  if (params.sortOrder) searchParams.set('sortOrder', params.sortOrder);\r\n  \r\n  const url = searchParams.toString() ? `${BASE_URL}?${searchParams}` : BASE_URL;\r\n  const response = await fetch(url);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch purchase returns: ${response.statusText}`);\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function fetchPurchaseReturn(systemId: SystemId): Promise<PurchaseReturn> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch purchase return: ${response.statusText}`);\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function createPurchaseReturn(data: Omit<PurchaseReturn, 'systemId' | 'id' | 'createdAt' | 'updatedAt'>): Promise<PurchaseReturn> {\r\n  const response = await fetch(BASE_URL, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to create purchase return');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function updatePurchaseReturn(systemId: SystemId, data: Partial<PurchaseReturn>): Promise<PurchaseReturn> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`, {\r\n    method: 'PUT',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to update purchase return');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function deletePurchaseReturn(systemId: SystemId): Promise<void> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`, {\r\n    method: 'DELETE',\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to delete purchase return: ${response.statusText}`);\r\n  }\r\n}\r\n\r\nexport async function fetchPurchaseReturnStats(): Promise<{\r\n  total: number;\r\n  totalValue: number;\r\n  totalRefund: number;\r\n}> {\r\n  const response = await fetch(`${BASE_URL}/stats`);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch purchase return stats: ${response.statusText}`);\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/purchase-returns/hooks/use-purchase-returns.ts"],"sourcesContent":["/**\r\n * usePurchaseReturns - React Query hooks (Phiếu Hoàn Trả NCC)\r\n * \r\n * ⚠️ Direct import: import { usePurchaseReturns } from '@/features/purchase-returns/hooks/use-purchase-returns'\r\n */\r\n\r\nimport { useQuery, useMutation, useQueryClient, keepPreviousData } from '@tanstack/react-query';\r\nimport { asSystemId } from '@/lib/id-types';\r\nimport {\r\n  fetchPurchaseReturns,\r\n  fetchPurchaseReturn,\r\n  createPurchaseReturn,\r\n  updatePurchaseReturn,\r\n  deletePurchaseReturn,\r\n  fetchPurchaseReturnStats,\r\n  type PurchaseReturnsParams,\r\n} from '../api/purchase-returns-api';\r\nimport type { PurchaseReturn } from '../types';\r\n\r\nexport const purchaseReturnKeys = {\r\n  all: ['purchase-returns'] as const,\r\n  lists: () => [...purchaseReturnKeys.all, 'list'] as const,\r\n  list: (params: PurchaseReturnsParams) => [...purchaseReturnKeys.lists(), params] as const,\r\n  details: () => [...purchaseReturnKeys.all, 'detail'] as const,\r\n  detail: (id: string) => [...purchaseReturnKeys.details(), id] as const,\r\n  stats: () => [...purchaseReturnKeys.all, 'stats'] as const,\r\n};\r\n\r\nexport function usePurchaseReturns(params: PurchaseReturnsParams = {}) {\r\n  return useQuery({\r\n    queryKey: purchaseReturnKeys.list(params),\r\n    queryFn: () => fetchPurchaseReturns(params),\r\n    staleTime: 30_000,\r\n    gcTime: 5 * 60 * 1000,\r\n    placeholderData: keepPreviousData,\r\n  });\r\n}\r\n\r\nexport function usePurchaseReturn(id: string | null | undefined) {\r\n  return useQuery({\r\n    queryKey: purchaseReturnKeys.detail(id!),\r\n    queryFn: () => fetchPurchaseReturn(asSystemId(id!)),\r\n    enabled: !!id,\r\n    staleTime: 60_000,\r\n  });\r\n}\r\n\r\nexport function usePurchaseReturnStats() {\r\n  return useQuery({\r\n    queryKey: purchaseReturnKeys.stats(),\r\n    queryFn: fetchPurchaseReturnStats,\r\n    staleTime: 60_000,\r\n  });\r\n}\r\n\r\ninterface UsePurchaseReturnMutationsOptions {\r\n  onCreateSuccess?: (purchaseReturn: PurchaseReturn) => void;\r\n  onUpdateSuccess?: (purchaseReturn: PurchaseReturn) => void;\r\n  onDeleteSuccess?: () => void;\r\n  onError?: (error: Error) => void;\r\n}\r\n\r\nexport function usePurchaseReturnMutations(options: UsePurchaseReturnMutationsOptions = {}) {\r\n  const queryClient = useQueryClient();\r\n  \r\n  const create = useMutation({\r\n    mutationFn: createPurchaseReturn,\r\n    onSuccess: (data) => {\r\n      queryClient.invalidateQueries({ queryKey: purchaseReturnKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: purchaseReturnKeys.stats() });\r\n      options.onCreateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const update = useMutation({\r\n    mutationFn: ({ systemId, data }: { systemId: string; data: Partial<PurchaseReturn> }) => \r\n      updatePurchaseReturn(asSystemId(systemId), data),\r\n    onSuccess: (data, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: purchaseReturnKeys.detail(variables.systemId) });\r\n      queryClient.invalidateQueries({ queryKey: purchaseReturnKeys.lists() });\r\n      queryClient.invalidateQueries({ queryKey: purchaseReturnKeys.stats() });\r\n      options.onUpdateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const remove = useMutation({\r\n    mutationFn: (systemId: string) => deletePurchaseReturn(asSystemId(systemId)),\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: purchaseReturnKeys.all });\r\n      options.onDeleteSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  return { create, update, remove };\r\n}\r\n\r\nexport function usePurchaseReturnsBySupplier(supplierId: string | null | undefined) {\r\n  return usePurchaseReturns({\r\n    supplierId: supplierId || undefined,\r\n    limit: 50,\r\n  });\r\n}\r\n\r\nexport function usePurchaseReturnsByPO(purchaseOrderId: string | null | undefined) {\r\n  return usePurchaseReturns({\r\n    purchaseOrderId: purchaseOrderId || undefined,\r\n    limit: 20,\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;;;CAIC,GAED;AAAA;AAAA;AAAA;AACA;AACA;;;;AAWO,MAAM,qBAAqB;IAChC,KAAK;QAAC;KAAmB;IACzB,OAAO,IAAM;eAAI,mBAAmB,GAAG;YAAE;SAAO;IAChD,MAAM,CAAC,SAAkC;eAAI,mBAAmB,KAAK;YAAI;SAAO;IAChF,SAAS,IAAM;eAAI,mBAAmB,GAAG;YAAE;SAAS;IACpD,QAAQ,CAAC,KAAe;eAAI,mBAAmB,OAAO;YAAI;SAAG;IAC7D,OAAO,IAAM;eAAI,mBAAmB,GAAG;YAAE;SAAQ;AACnD;AAEO,SAAS,mBAAmB,SAAgC,CAAC,CAAC;IACnE,OAAO,IAAA,uLAAQ,EAAC;QACd,UAAU,mBAAmB,IAAI,CAAC;QAClC,SAAS,IAAM,IAAA,4LAAoB,EAAC;QACpC,WAAW;QACX,QAAQ,IAAI,KAAK;QACjB,iBAAiB,2LAAgB;IACnC;AACF;AAEO,SAAS,kBAAkB,EAA6B;IAC7D,OAAO,IAAA,uLAAQ,EAAC;QACd,UAAU,mBAAmB,MAAM,CAAC;QACpC,SAAS,IAAM,IAAA,2LAAmB,EAAC,IAAA,gIAAU,EAAC;QAC9C,SAAS,CAAC,CAAC;QACX,WAAW;IACb;AACF;AAEO,SAAS;IACd,OAAO,IAAA,uLAAQ,EAAC;QACd,UAAU,mBAAmB,KAAK;QAClC,SAAS,gMAAwB;QACjC,WAAW;IACb;AACF;AASO,SAAS,2BAA2B,UAA6C,CAAC,CAAC;IACxF,MAAM,cAAc,IAAA,wMAAc;IAElC,MAAM,SAAS,IAAA,6LAAW,EAAC;QACzB,YAAY,4LAAoB;QAChC,WAAW,CAAC;YACV,YAAY,iBAAiB,CAAC;gBAAE,UAAU,mBAAmB,KAAK;YAAG;YACrE,YAAY,iBAAiB,CAAC;gBAAE,UAAU,mBAAmB,KAAK;YAAG;YACrE,QAAQ,eAAe,GAAG;QAC5B;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,SAAS,IAAA,6LAAW,EAAC;QACzB,YAAY,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAuD,GAClF,IAAA,4LAAoB,EAAC,IAAA,gIAAU,EAAC,WAAW;QAC7C,WAAW,CAAC,MAAM;YAChB,YAAY,iBAAiB,CAAC;gBAAE,UAAU,mBAAmB,MAAM,CAAC,UAAU,QAAQ;YAAE;YACxF,YAAY,iBAAiB,CAAC;gBAAE,UAAU,mBAAmB,KAAK;YAAG;YACrE,YAAY,iBAAiB,CAAC;gBAAE,UAAU,mBAAmB,KAAK;YAAG;YACrE,QAAQ,eAAe,GAAG;QAC5B;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,SAAS,IAAA,6LAAW,EAAC;QACzB,YAAY,CAAC,WAAqB,IAAA,4LAAoB,EAAC,IAAA,gIAAU,EAAC;QAClE,WAAW;YACT,YAAY,iBAAiB,CAAC;gBAAE,UAAU,mBAAmB,GAAG;YAAC;YACjE,QAAQ,eAAe;QACzB;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,OAAO;QAAE;QAAQ;QAAQ;IAAO;AAClC;AAEO,SAAS,6BAA6B,UAAqC;IAChF,OAAO,mBAAmB;QACxB,YAAY,cAAc;QAC1B,OAAO;IACT;AACF;AAEO,SAAS,uBAAuB,eAA0C;IAC/E,OAAO,mBAAmB;QACxB,iBAAiB,mBAAmB;QACpC,OAAO;IACT;AACF"}},
    {"offset": {"line": 237, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/purchase-returns/hooks/use-all-purchase-returns.ts"],"sourcesContent":["/**\r\n * useAllPurchaseReturns - Convenience hook for components needing all purchase returns as flat array\r\n * \r\n * Replaces legacy usePurchaseReturnStore().data pattern\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { usePurchaseReturns } from './use-purchase-returns';\r\nimport type { PurchaseReturn } from '../types';\r\nimport type { SystemId } from '@/lib/id-types';\r\n\r\n/**\r\n * Returns all purchase returns as a flat array\r\n * Compatible with legacy store pattern: { data: returns }\r\n */\r\nexport function useAllPurchaseReturns() {\r\n  const query = usePurchaseReturns({ limit: 500 });\r\n  \r\n  return {\r\n    data: query.data?.data || [],\r\n    isLoading: query.isLoading,\r\n    isError: query.isError,\r\n    error: query.error,\r\n  };\r\n}\r\n\r\n/**\r\n * Helper hook to find a purchase return by ID from cached data\r\n * Replaces legacy findById() method\r\n */\r\nexport function usePurchaseReturnFinder() {\r\n  const { data } = useAllPurchaseReturns();\r\n  \r\n  const findById = React.useCallback(\r\n    (systemId: SystemId | string | undefined): PurchaseReturn | undefined => {\r\n      if (!systemId) return undefined;\r\n      return data.find(pr => pr.systemId === systemId);\r\n    },\r\n    [data]\r\n  );\r\n  \r\n  return { findById };\r\n}\r\n\r\n/**\r\n * Returns purchase returns filtered by supplier\r\n */\r\nexport function usePurchaseReturnsBySupplier(supplierSystemId: SystemId | string | undefined) {\r\n  const { data, isLoading } = useAllPurchaseReturns();\r\n  \r\n  const filtered = React.useMemo(\r\n    () => supplierSystemId \r\n      ? data.filter(pr => pr.supplierSystemId === supplierSystemId)\r\n      : [],\r\n    [data, supplierSystemId]\r\n  );\r\n  \r\n  return { data: filtered, isLoading };\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;;;CAIC,GAED;AACA;;;AAQO,SAAS;IACd,MAAM,QAAQ,IAAA,4LAAkB,EAAC;QAAE,OAAO;IAAI;IAE9C,OAAO;QACL,MAAM,MAAM,IAAI,EAAE,QAAQ,EAAE;QAC5B,WAAW,MAAM,SAAS;QAC1B,SAAS,MAAM,OAAO;QACtB,OAAO,MAAM,KAAK;IACpB;AACF;AAMO,SAAS;IACd,MAAM,EAAE,IAAI,EAAE,GAAG;IAEjB,MAAM,WAAW,oNAAiB,CAChC,CAAC;QACC,IAAI,CAAC,UAAU,OAAO;QACtB,OAAO,KAAK,IAAI,CAAC,CAAA,KAAM,GAAG,QAAQ,KAAK;IACzC,GACA;QAAC;KAAK;IAGR,OAAO;QAAE;IAAS;AACpB;AAKO,SAAS,6BAA6B,gBAA+C;IAC1F,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG;IAE5B,MAAM,WAAW,gNAAa,CAC5B,IAAM,mBACF,KAAK,MAAM,CAAC,CAAA,KAAM,GAAG,gBAAgB,KAAK,oBAC1C,EAAE,EACN;QAAC;QAAM;KAAiB;IAG1B,OAAO;QAAE,MAAM;QAAU;IAAU;AACrC"}},
    {"offset": {"line": 291, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/purchase-returns/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport * as React from \"react\";\r\nimport { useRouter } from 'next/navigation';\r\nimport { ROUTES } from '../../lib/router';\r\nimport { formatDateCustom, parseDate, isDateAfter, isDateBefore } from '../../lib/date-utils';\r\nimport { useAllPurchaseReturns } from \"./hooks/use-all-purchase-returns\";\r\nimport { useAllPurchaseOrders } from \"../purchase-orders/hooks/use-all-purchase-orders\";\r\nimport { useAllBranches } from \"../settings/branches/hooks/use-all-branches\";\r\nimport { useStoreInfo } from \"../settings/store-info/hooks/use-store-info\";\r\nimport { usePageHeader } from \"../../contexts/page-header-context\";\r\nimport { usePrint } from \"../../lib/use-print\";\r\nimport { \r\n  convertSupplierReturnForPrint,\r\n  mapSupplierReturnToPrintData,\r\n  mapSupplierReturnLineItems,\r\n  createStoreSettings\r\n} from \"../../lib/print/supplier-return-print-helper\";\r\nimport { ResponsiveDataTable } from \"../../components/data-table/responsive-data-table\";\r\nimport { DataTableDateFilter } from \"../../components/data-table/data-table-date-filter\";\r\nimport { PageFilters } from \"../../components/layout/page-filters\";\r\nimport { PageToolbar } from \"../../components/layout/page-toolbar\";\r\nimport { Card, CardContent } from \"../../components/ui/card\";\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"../../components/ui/select\";\r\nimport { Button } from \"../../components/ui/button\";\r\nimport { Avatar, AvatarFallback } from \"../../components/ui/avatar\";\r\nimport { useMediaQuery } from \"../../lib/use-media-query\";\r\nimport { PackageX, Building2, User, Calendar, FileText, Plus, Printer, Download } from \"lucide-react\";\r\nimport Fuse from \"fuse.js\";\r\nimport type { ColumnDef } from \"../../components/data-table/types\";\r\nimport type { PurchaseReturn } from \"./types\";\r\nimport { Checkbox } from \"../../components/ui/checkbox\";\r\nimport { toast } from 'sonner';\r\nimport { SimplePrintOptionsDialog, SimplePrintOptionsResult } from \"../../components/shared/simple-print-options-dialog\";\r\nimport { GenericExportDialogV2 } from \"../../components/shared/generic-export-dialog-v2\";\r\nimport { purchaseReturnConfig } from \"../../lib/import-export/configs/purchase-return.config\";\r\nimport { useAuth } from \"../../contexts/auth-context\";\r\nimport { asSystemId } from \"../../lib/id-types\";\r\nimport { useColumnVisibility } from \"../../hooks/use-column-visibility\";\r\n\r\nconst formatCurrency = (value?: number) => {\r\n  if (typeof value !== 'number' || isNaN(value)) return '0 ₫';\r\n  return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(value);\r\n};\r\n\r\nconst getColumns = (onPrint: (purchaseReturn: PurchaseReturn) => void): ColumnDef<PurchaseReturn>[] => [\r\n  {\r\n    id: \"select\",\r\n    header: ({ isAllPageRowsSelected, isSomePageRowsSelected, onToggleAll }) => (\r\n      <div className=\"flex items-center justify-center\">\r\n        <Checkbox\r\n          checked={isAllPageRowsSelected ? true : isSomePageRowsSelected ? \"indeterminate\" : false}\r\n          onCheckedChange={(value) => onToggleAll?.(!!value)}\r\n          aria-label=\"Chọn tất cả\"\r\n        />\r\n      </div>\r\n    ),\r\n    cell: ({ isSelected, onToggleSelect }) => (\r\n      <div className=\"flex items-center justify-center\">\r\n        <Checkbox\r\n          checked={isSelected}\r\n          onCheckedChange={onToggleSelect}\r\n          aria-label=\"Chọn dòng\"\r\n        />\r\n      </div>\r\n    ),\r\n    size: 48,\r\n    meta: {\r\n      displayName: \"Chọn\",\r\n      sticky: \"left\",\r\n    },\r\n  },\r\n  {\r\n    id: 'id',\r\n    accessorKey: 'id',\r\n    header: 'Mã phiếu trả',\r\n    cell: ({ row }) => (\r\n      <button \r\n        className=\"text-body-sm font-medium text-primary hover:underline\"\r\n        onClick={(e) => {\r\n          e.stopPropagation();\r\n          // Navigate is handled by onRowClick\r\n        }}\r\n      >\r\n        {row.id}\r\n      </button>\r\n    ),\r\n    meta: { displayName: 'Mã phiếu trả' },\r\n    size: 120,\r\n  },\r\n  {\r\n    id: 'returnDate',\r\n    accessorKey: 'returnDate',\r\n    header: 'Ngày trả',\r\n    cell: ({ row }) => formatDateCustom(parseDate(row.returnDate)!, 'dd/MM/yyyy'),\r\n    meta: { displayName: 'Ngày trả' },\r\n    size: 120,\r\n  },\r\n  {\r\n    id: 'purchaseOrderId',\r\n    accessorKey: 'purchaseOrderId',\r\n    header: 'Đơn nhập hàng',\r\n    cell: ({ row }) => row.purchaseOrderId,\r\n    meta: { displayName: 'Đơn nhập hàng' },\r\n    size: 140,\r\n  },\r\n  {\r\n    id: 'supplierName',\r\n    accessorKey: 'supplierName',\r\n    header: 'Nhà cung cấp',\r\n    cell: ({ row }) => row.supplierName,\r\n    meta: { displayName: 'Nhà cung cấp' },\r\n  },\r\n  {\r\n    id: 'branchName',\r\n    accessorKey: 'branchName',\r\n    header: 'Chi nhánh',\r\n    cell: ({ row }) => row.branchName,\r\n    meta: { displayName: 'Chi nhánh' },\r\n    size: 150,\r\n  },\r\n  {\r\n    id: 'totalQuantity',\r\n    header: 'Tổng SL',\r\n    cell: ({ row }) => {\r\n      const total = row.items.reduce((sum, item) => sum + item.returnQuantity, 0);\r\n      return <span className=\"text-body-sm font-medium\">{total}</span>;\r\n    },\r\n    meta: { displayName: 'Tổng SL' },\r\n    size: 100,\r\n  },\r\n  {\r\n    id: 'totalReturnValue',\r\n    accessorKey: 'totalReturnValue',\r\n    header: 'Giá trị trả',\r\n    cell: ({ row }) => (\r\n      <span className=\"text-body-sm font-semibold text-orange-600\">\r\n        {formatCurrency(row.totalReturnValue)}\r\n      </span>\r\n    ),\r\n    meta: { displayName: 'Giá trị trả' },\r\n    size: 150,\r\n  },\r\n  {\r\n    id: 'refundAmount',\r\n    accessorKey: 'refundAmount',\r\n    header: 'Tiền hoàn',\r\n    cell: ({ row }) => (\r\n      <span className=\"text-body-sm font-semibold text-green-600\">\r\n        {formatCurrency(row.refundAmount)}\r\n      </span>\r\n    ),\r\n    meta: { displayName: 'Tiền hoàn' },\r\n    size: 150,\r\n  },\r\n  {\r\n    id: 'creatorName',\r\n    accessorKey: 'creatorName',\r\n    header: 'Người tạo',\r\n    cell: ({ row }) => row.creatorName,\r\n    meta: { displayName: 'Người tạo' },\r\n    size: 150,\r\n  },\r\n  {\r\n    id: 'reason',\r\n    accessorKey: 'reason',\r\n    header: 'Lý do',\r\n    cell: ({ row }) => (\r\n      <span className=\"text-body-xs max-w-xs line-clamp-2\">\r\n        {row.reason || '-'}\r\n      </span>\r\n    ),\r\n    meta: { displayName: 'Lý do' },\r\n    size: 200,\r\n  },\r\n  {\r\n    id: 'refundMethod',\r\n    accessorKey: 'refundMethod',\r\n    header: 'Hình thức hoàn',\r\n    cell: ({ row }) => row.refundMethod || '-',\r\n    meta: { displayName: 'Hình thức hoàn' },\r\n    size: 150,\r\n  },\r\n  {\r\n    id: 'itemsCount',\r\n    header: 'Số mặt hàng',\r\n    cell: ({ row }) => (\r\n      <span className=\"text-body-sm font-medium\">{row.items.length}</span>\r\n    ),\r\n    meta: { displayName: 'Số mặt hàng' },\r\n    size: 120,\r\n  },\r\n  {\r\n    id: 'productNames',\r\n    header: 'Sản phẩm',\r\n    cell: ({ row }) => {\r\n      const firstProduct = row.items[0]?.productName || '';\r\n      const remaining = row.items.length - 1;\r\n      return (\r\n        <span className=\"text-body-xs\">\r\n          {firstProduct}\r\n          {remaining > 0 && ` +${remaining}`}\r\n        </span>\r\n      );\r\n    },\r\n    meta: { displayName: 'Sản phẩm' },\r\n    size: 200,\r\n  },\r\n  {\r\n    id: 'accountSystemId',\r\n    accessorKey: 'accountSystemId',\r\n    header: 'Tài khoản',\r\n    cell: ({ row }) => row.accountSystemId || '-',\r\n    meta: { displayName: 'Tài khoản' },\r\n    size: 120,\r\n  },\r\n  {\r\n    id: 'actions',\r\n    header: 'Hành động',\r\n    cell: ({ row }) => (\r\n      <Button\r\n        variant=\"ghost\"\r\n        size=\"sm\"\r\n        className=\"h-9\"\r\n        onClick={(e) => {\r\n          e.stopPropagation();\r\n          onPrint(row);\r\n        }}\r\n      >\r\n        <Printer className=\"h-4 w-4 mr-1\" />\r\n        In\r\n      </Button>\r\n    ),\r\n    size: 120,\r\n    meta: {\r\n      displayName: 'Hành động',\r\n      sticky: 'right',\r\n    },\r\n  },\r\n];\r\n\r\nexport function PurchaseReturnsPage() {\r\n  const { data: purchaseReturns = [] } = useAllPurchaseReturns();\r\n  const { data: allPurchaseOrders = [] } = useAllPurchaseOrders();\r\n  const { data: branches = [] } = useAllBranches();\r\n  const { data: storeInfo } = useStoreInfo();\r\n  const { print, printMultiple } = usePrint();\r\n  const { employee: currentUser } = useAuth();\r\n  const router = useRouter();\r\n  const isMobile = useMediaQuery(\"(max-width: 768px)\");\r\n  \r\n  // Print dialog state - using SimplePrintOptionsDialog like Orders page\r\n  const [isPrintDialogOpen, setIsPrintDialogOpen] = React.useState(false);\r\n  const [pendingPrintReturns, setPendingPrintReturns] = React.useState<PurchaseReturn[]>([]);\r\n  \r\n  // Export dialog state\r\n  const [exportDialogOpen, setExportDialogOpen] = React.useState(false);\r\n\r\n  const handleRowPrint = React.useCallback((entry: PurchaseReturn) => {\r\n    // In ngay không cần xác nhận\r\n    const storeSettings = createStoreSettings(storeInfo);\r\n    const branch = branches.find(b => b.systemId === entry.branchSystemId);\r\n    const forPrint = convertSupplierReturnForPrint(entry, { branch });\r\n      \r\n    print('supplier-return', {\r\n      data: mapSupplierReturnToPrintData(forPrint, storeSettings),\r\n      lineItems: mapSupplierReturnLineItems(forPrint.items),\r\n    });\r\n    \r\n    toast.success('Đã gửi lệnh in', {\r\n      description: `Đang in phiếu trả ${entry.id}.`\r\n    });\r\n  }, [branches, storeInfo, print]);\r\n  \r\n  // Set page header\r\n  const headerActions = React.useMemo(() => [\r\n    <Button \r\n      key=\"create\" \r\n      size=\"sm\" \r\n      className=\"h-9\"\r\n      onClick={() => router.push(ROUTES.PROCUREMENT.PURCHASE_RETURN_NEW)}\r\n    >\r\n      <Plus className=\"mr-2 h-4 w-4\" />\r\n      Tạo phiếu trả hàng\r\n    </Button>\r\n  ], [router]);\r\n\r\n  usePageHeader({\r\n    title: 'Danh sách phiếu trả NCC',\r\n    actions: headerActions,\r\n    breadcrumb: [\r\n      { label: 'Trang chủ', href: '/', isCurrent: false },\r\n      { label: 'Trả hàng nhập', href: ROUTES.PROCUREMENT.PURCHASE_RETURNS, isCurrent: true }\r\n    ],\r\n    showBackButton: false\r\n  });\r\n\r\n  const [rowSelection, setRowSelection] = React.useState<Record<string, boolean>>({});\r\n  const [sorting, setSorting] = React.useState<{ id: string, desc: boolean }>({ id: 'createdAt', desc: true });\r\n  const [globalFilter, setGlobalFilter] = React.useState('');\r\n  const [debouncedGlobalFilter, setDebouncedGlobalFilter] = React.useState('');\r\n  const [supplierFilter, setSupplierFilter] = React.useState('all');\r\n  const [branchFilter, setBranchFilter] = React.useState('all');\r\n  const [dateRange, setDateRange] = React.useState<[string | undefined, string | undefined] | undefined>();\r\n  const [pagination, setPagination] = React.useState({ pageIndex: 0, pageSize: 20 });\r\n  \r\n  // Get initial column visibility from columns\r\n  const cols = React.useMemo(() => getColumns((_pr: PurchaseReturn) => undefined), []);\r\n  const defaultVisibility = React.useMemo(() => {\r\n    const initial: Record<string, boolean> = {};\r\n    cols.forEach(c => { if (c.id) initial[c.id] = true; });\r\n    return initial;\r\n  }, [cols]);\r\n  \r\n  // Use hook for column visibility (database-backed)\r\n  const [columnVisibility, setColumnVisibility] = useColumnVisibility('purchase-returns', defaultVisibility);\r\n  \r\n  const [columnOrder, setColumnOrder] = React.useState<string[]>([]);\r\n  const [pinnedColumns, setPinnedColumns] = React.useState<string[]>([]);\r\n  const [expanded, setExpanded] = React.useState<Record<string, boolean>>({});\r\n  const [mobileLoadedCount, setMobileLoadedCount] = React.useState(20);\r\n\r\n  // Debounce search\r\n  React.useEffect(() => {\r\n    const timer = setTimeout(() => {\r\n      setDebouncedGlobalFilter(globalFilter);\r\n    }, 300);\r\n    return () => clearTimeout(timer);\r\n  }, [globalFilter]);\r\n\r\n  const columns = React.useMemo(() => getColumns(handleRowPrint), [handleRowPrint]);\r\n  \r\n  React.useEffect(() => {\r\n    const initialVisibility: Record<string, boolean> = {};\r\n    columns.forEach(c => {\r\n      initialVisibility[c.id!] = true;\r\n    });\r\n    setColumnVisibility(initialVisibility);\r\n    setColumnOrder(columns.map(c => c.id).filter(Boolean) as string[]);\r\n  }, []);\r\n  \r\n  const fuse = React.useMemo(\r\n    () => new Fuse(purchaseReturns, { \r\n      keys: [\"id\", \"supplierName\", \"creatorName\", \"purchaseOrderId\", \"branchName\"],\r\n      threshold: 0.3,\r\n      ignoreLocation: true\r\n    }), \r\n    [purchaseReturns]\r\n  );\r\n  \r\n  // Reset mobile loaded count when filters change\r\n  React.useEffect(() => {\r\n    setMobileLoadedCount(20);\r\n  }, [debouncedGlobalFilter, supplierFilter, branchFilter, dateRange]);\r\n\r\n  // Mobile infinite scroll\r\n  React.useEffect(() => {\r\n    if (!isMobile) return;\r\n\r\n    const handleScroll = () => {\r\n      const scrollTop = window.scrollY || document.documentElement.scrollTop;\r\n      const scrollHeight = document.documentElement.scrollHeight;\r\n      const clientHeight = document.documentElement.clientHeight;\r\n\r\n      const filteredCount = filteredData.length;\r\n      if (scrollTop + clientHeight >= scrollHeight * 0.8 && mobileLoadedCount < filteredCount) {\r\n        setMobileLoadedCount(prev => Math.min(prev + 20, filteredCount));\r\n      }\r\n    };\r\n\r\n    window.addEventListener('scroll', handleScroll, { passive: true });\r\n    return () => window.removeEventListener('scroll', handleScroll);\r\n  }, [isMobile, mobileLoadedCount]);\r\n  \r\n  const filteredData = React.useMemo(() => {\r\n    let data = purchaseReturns;\r\n\r\n    // Apply supplier filter\r\n    if (supplierFilter !== 'all') {\r\n      data = data.filter(pr => pr.supplierSystemId === supplierFilter);\r\n    }\r\n\r\n    // Apply branch filter\r\n    if (branchFilter !== 'all') {\r\n      data = data.filter(pr => pr.branchSystemId === branchFilter);\r\n    }\r\n\r\n    // Apply date range filter\r\n    if (dateRange && (dateRange[0] || dateRange[1])) {\r\n      data = data.filter(pr => {\r\n        const returnDate = parseDate(pr.returnDate);\r\n        if (!returnDate) return false;\r\n        \r\n        const fromDate = dateRange[0] ? new Date(dateRange[0]) : null;\r\n        const toDate = dateRange[1] ? new Date(dateRange[1]) : null;\r\n        \r\n        if (fromDate && isDateBefore(returnDate, fromDate)) return false;\r\n        if (toDate && isDateAfter(returnDate, toDate)) return false;\r\n        return true;\r\n      });\r\n    }\r\n\r\n    // Apply search filter (debounced)\r\n    if (debouncedGlobalFilter) {\r\n      const searchResults = fuse.search(debouncedGlobalFilter);\r\n      return searchResults.map(r => r.item);\r\n    }\r\n\r\n    return data;\r\n  }, [purchaseReturns, supplierFilter, branchFilter, dateRange, debouncedGlobalFilter, fuse]);\r\n  \r\n  const sortedData = React.useMemo(() => {\r\n    const sorted = [...filteredData];\r\n    if (sorting.id) {\r\n      sorted.sort((a, b) => {\r\n        const aVal = (a as any)[sorting.id];\r\n        const bVal = (b as any)[sorting.id];\r\n        // Special handling for date columns\r\n        if (sorting.id === 'createdAt' || sorting.id === 'returnDate') {\r\n          const aTime = aVal ? new Date(aVal).getTime() : 0;\r\n          const bTime = bVal ? new Date(bVal).getTime() : 0;\r\n          return sorting.desc ? bTime - aTime : aTime - bTime;\r\n        }\r\n        if (aVal === bVal) return 0;\r\n        if (aVal < bVal) return sorting.desc ? 1 : -1;\r\n        if (aVal > bVal) return sorting.desc ? -1 : 1;\r\n        return 0;\r\n      });\r\n    }\r\n    return sorted;\r\n  }, [filteredData, sorting]);\r\n\r\n  const handleRowClick = (row: PurchaseReturn) => {\r\n    router.push(`${ROUTES.PROCUREMENT.PURCHASE_RETURNS}/${row.systemId}`);\r\n  };\r\n\r\n  const selectedRows = React.useMemo(() => {\r\n    return filteredData.filter(pr => rowSelection[pr.systemId]);\r\n  }, [filteredData, rowSelection]);\r\n\r\n  // Open print options dialog for bulk print\r\n  const handleBulkPrint = React.useCallback(() => {\r\n    if (selectedRows.length === 0) {\r\n      toast.error('Chưa chọn phiếu trả', {\r\n        description: 'Vui lòng chọn ít nhất một phiếu trước khi in.'\r\n      });\r\n      return;\r\n    }\r\n    setPendingPrintReturns(selectedRows);\r\n    setIsPrintDialogOpen(true);\r\n  }, [selectedRows]);\r\n\r\n  // Xử lý khi xác nhận tùy chọn in từ dialog\r\n  const handlePrintConfirm = React.useCallback((options: SimplePrintOptionsResult) => {\r\n    const { branchSystemId, paperSize } = options;\r\n    \r\n    // Chuẩn bị danh sách options cho printMultiple\r\n    const printOptionsList = pendingPrintReturns.map(entry => {\r\n      // Ưu tiên dùng chi nhánh user chọn, nếu không thì dùng chi nhánh của phiếu\r\n      const branch = branchSystemId \r\n        ? branches.find(b => b.systemId === branchSystemId)\r\n        : branches.find(b => b.systemId === entry.branchSystemId);\r\n      const storeSettings = branch \r\n        ? createStoreSettings(branch)\r\n        : createStoreSettings(storeInfo);\r\n      const forPrint = convertSupplierReturnForPrint(entry, { branch });\r\n      \r\n      return {\r\n        data: mapSupplierReturnToPrintData(forPrint, storeSettings),\r\n        lineItems: mapSupplierReturnLineItems(forPrint.items),\r\n        paperSize,\r\n      };\r\n    });\r\n    \r\n    // In tất cả trong 1 lần (1 popup) bằng printMultiple\r\n    printMultiple('supplier-return', printOptionsList);\r\n    \r\n    toast.success('Đã gửi lệnh in cho phiếu trả', {\r\n      description: pendingPrintReturns.map(r => r.id).join(', ')\r\n    });\r\n    setRowSelection({});\r\n    setPendingPrintReturns([]);\r\n  }, [pendingPrintReturns, branches, storeInfo, printMultiple]);\r\n\r\n  const bulkActions = [\r\n    {\r\n      label: \"In phiếu trả\",\r\n      icon: Printer,\r\n      onSelect: handleBulkPrint\r\n    }\r\n  ];\r\n\r\n  const pageCount = Math.ceil(sortedData.length / pagination.pageSize);\r\n  const paginatedData = React.useMemo(() => {\r\n    const start = pagination.pageIndex * pagination.pageSize;\r\n    const end = start + pagination.pageSize;\r\n    return sortedData.slice(start, end);\r\n  }, [sortedData, pagination]);\r\n\r\n  const { totalReturnValue, totalRefundAmount, totalQuantity } = React.useMemo(() => {\r\n    const totalReturnValue = filteredData.reduce((sum, pr) => sum + pr.totalReturnValue, 0);\r\n    const totalRefundAmount = filteredData.reduce((sum, pr) => sum + pr.refundAmount, 0);\r\n    const totalQuantity = filteredData.reduce((sum, pr) => {\r\n      return sum + pr.items.reduce((itemSum, item) => itemSum + item.returnQuantity, 0);\r\n    }, 0);\r\n    \r\n    return { totalReturnValue, totalRefundAmount, totalQuantity };\r\n  }, [filteredData]);\r\n\r\n  // Supplier options\r\n  const supplierOptions = React.useMemo(() => {\r\n    const uniqueSuppliers = new Map();\r\n    purchaseReturns.forEach(pr => {\r\n      if (!uniqueSuppliers.has(pr.supplierSystemId)) {\r\n        uniqueSuppliers.set(pr.supplierSystemId, pr.supplierName);\r\n      }\r\n    });\r\n    return Array.from(uniqueSuppliers.entries()).map(([id, name]) => ({ id, name }));\r\n  }, [purchaseReturns]);\r\n\r\n  // Mobile card component\r\n  const MobileReturnCard = ({ purchaseReturn }: { purchaseReturn: PurchaseReturn }) => {\r\n    const totalQty = purchaseReturn.items.reduce((sum, item) => sum + item.returnQuantity, 0);\r\n    \r\n    return (\r\n      <Card className=\"cursor-pointer hover:shadow-md transition-shadow\" onClick={() => handleRowClick(purchaseReturn)}>\r\n        <CardContent className=\"p-4\">\r\n          <div className=\"flex items-start gap-3\">\r\n            <Avatar className=\"h-12 w-12 flex-shrink-0\">\r\n              <AvatarFallback className=\"bg-orange-100 text-orange-600 font-semibold text-body-sm\">\r\n                <PackageX className=\"h-6 w-6\" />\r\n              </AvatarFallback>\r\n            </Avatar>\r\n\r\n            <div className=\"flex-1 min-w-0\">\r\n              <div className=\"flex items-start justify-between mb-1\">\r\n                <div className=\"flex-1\">\r\n                  <h3 className=\"text-body-sm font-semibold\">{purchaseReturn.id}</h3>\r\n                  <p className=\"text-body-xs text-muted-foreground\">\r\n                    {formatDateCustom(parseDate(purchaseReturn.returnDate)!, 'dd/MM/yyyy')}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"space-y-1.5 mt-2\">\r\n                <div className=\"flex items-center text-body-xs text-muted-foreground\">\r\n                  <User className=\"h-3 w-3 mr-1.5 flex-shrink-0\" />\r\n                  <span className=\"truncate\">{purchaseReturn.supplierName}</span>\r\n                </div>\r\n                <div className=\"flex items-center text-body-xs text-muted-foreground\">\r\n                  <Building2 className=\"h-3 w-3 mr-1.5 flex-shrink-0\" />\r\n                  <span className=\"truncate\">{purchaseReturn.branchName}</span>\r\n                </div>\r\n                <div className=\"flex items-center text-body-xs text-muted-foreground\">\r\n                  <FileText className=\"h-3 w-3 mr-1.5 flex-shrink-0\" />\r\n                  <span className=\"truncate\">ĐH: {purchaseReturn.purchaseOrderId}</span>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"flex items-center justify-between mt-3 pt-2 border-t\">\r\n                <div className=\"text-body-xs\">\r\n                  <span className=\"text-muted-foreground\">SL: </span>\r\n                  <span className=\"font-semibold\">{totalQty}</span>\r\n                </div>\r\n                <div className=\"text-body-xs\">\r\n                  <span className=\"text-orange-600 font-semibold\">\r\n                    {formatCurrency(purchaseReturn.totalReturnValue)}\r\n                  </span>\r\n                </div>\r\n                {purchaseReturn.refundAmount > 0 && (\r\n                  <div className=\"text-body-xs\">\r\n                    <span className=\"text-green-600 font-semibold\">\r\n                      Hoàn: {formatCurrency(purchaseReturn.refundAmount)}\r\n                    </span>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <>\r\n    <div className=\"space-y-4 flex flex-col h-full\">\r\n      {/* PageToolbar - Desktop only */}\r\n      {!isMobile && (\r\n        <PageToolbar\r\n          leftActions={\r\n            <Button variant=\"outline\" size=\"sm\" onClick={() => setExportDialogOpen(true)}>\r\n              <Download className=\"h-4 w-4 mr-2\" />\r\n              Xuất Excel\r\n            </Button>\r\n          }\r\n        />\r\n      )}\r\n\r\n      {/* Summary Cards */}\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n        <Card>\r\n          <CardContent className=\"p-4\">\r\n            <p className=\"text-body-sm text-muted-foreground\">Tổng phiếu trả</p>\r\n            <p className=\"text-h2 font-semibold\">{filteredData.length}</p>\r\n          </CardContent>\r\n        </Card>\r\n        <Card>\r\n          <CardContent className=\"p-4\">\r\n            <p className=\"text-body-sm text-muted-foreground\">Tổng SL trả</p>\r\n            <p className=\"text-h2 font-semibold text-orange-600\">{totalQuantity}</p>\r\n          </CardContent>\r\n        </Card>\r\n        <Card>\r\n          <CardContent className=\"p-4\">\r\n            <p className=\"text-body-sm text-muted-foreground\">Tổng giá trị hàng trả</p>\r\n            <p className=\"text-h2 font-semibold text-orange-600\">\r\n              {formatCurrency(totalReturnValue)}\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n        <Card>\r\n          <CardContent className=\"p-4\">\r\n            <p className=\"text-body-sm text-muted-foreground\">Tổng tiền đã hoàn</p>\r\n            <p className=\"text-h2 font-semibold text-green-600\">\r\n              {formatCurrency(totalRefundAmount)}\r\n            </p>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <PageFilters\r\n        searchValue={globalFilter}\r\n        onSearchChange={setGlobalFilter}\r\n        searchPlaceholder=\"Tìm theo mã phiếu, NCC, đơn hàng...\"\r\n      >\r\n        <Select value={branchFilter} onValueChange={setBranchFilter}>\r\n          <SelectTrigger className=\"h-9 w-full sm:w-[180px]\">\r\n            <SelectValue placeholder=\"Chi nhánh\" />\r\n          </SelectTrigger>\r\n          <SelectContent>\r\n            <SelectItem value=\"all\">Tất cả chi nhánh</SelectItem>\r\n            {branches.map(b => (\r\n              <SelectItem key={b.systemId} value={b.systemId}>{b.name}</SelectItem>\r\n            ))}\r\n          </SelectContent>\r\n        </Select>\r\n\r\n        <Select value={supplierFilter} onValueChange={setSupplierFilter}>\r\n          <SelectTrigger className=\"h-9 w-full sm:w-[200px]\">\r\n            <SelectValue placeholder=\"Nhà cung cấp\" />\r\n          </SelectTrigger>\r\n          <SelectContent>\r\n            <SelectItem value=\"all\">Tất cả NCC</SelectItem>\r\n            {supplierOptions.map(s => (\r\n              <SelectItem key={s.id} value={s.id}>{s.name}</SelectItem>\r\n            ))}\r\n          </SelectContent>\r\n        </Select>\r\n\r\n        <DataTableDateFilter\r\n          value={dateRange}\r\n          onChange={setDateRange}\r\n          title=\"Ngày trả hàng\"\r\n        />\r\n      </PageFilters>\r\n\r\n      {/* Mobile View - Cards with Infinite Scroll */}\r\n      {isMobile ? (\r\n        <div className=\"space-y-4\">\r\n          <div className=\"space-y-2\">\r\n            {sortedData.length === 0 ? (\r\n              <Card>\r\n                <CardContent className=\"p-8 text-center text-muted-foreground\">\r\n                  Không tìm thấy phiếu trả hàng nào.\r\n                </CardContent>\r\n              </Card>\r\n            ) : (\r\n              sortedData.slice(0, mobileLoadedCount).map((pr) => (\r\n                <MobileReturnCard key={pr.systemId} purchaseReturn={pr} />\r\n              ))\r\n            )}\r\n          </div>\r\n\r\n          {/* Loading indicator & End message */}\r\n          {sortedData.length > 0 && (\r\n            <div className=\"py-6 text-center\">\r\n              {mobileLoadedCount < sortedData.length ? (\r\n                <div className=\"flex items-center justify-center gap-2 text-muted-foreground\">\r\n                  <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent\" />\r\n                  <span className=\"text-sm\">Đang tải thêm...</span>\r\n                </div>\r\n              ) : sortedData.length > 20 ? (\r\n                <p className=\"text-sm text-muted-foreground\">\r\n                  Đã hiển thị tất cả {sortedData.length} phiếu trả hàng\r\n                </p>\r\n              ) : null}\r\n            </div>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        /* Desktop View - ResponsiveDataTable */\r\n        <ResponsiveDataTable\r\n          columns={columns}\r\n          data={paginatedData}\r\n          renderMobileCard={(row) => <MobileReturnCard purchaseReturn={row} />}\r\n          onRowClick={handleRowClick}\r\n          pageCount={pageCount}\r\n          pagination={pagination}\r\n          setPagination={setPagination}\r\n          rowCount={sortedData.length}\r\n          rowSelection={rowSelection}\r\n          setRowSelection={setRowSelection}\r\n          allSelectedRows={selectedRows}\r\n          bulkActions={bulkActions}\r\n          showBulkDeleteButton={false}\r\n          expanded={expanded}\r\n          setExpanded={setExpanded}\r\n          sorting={sorting}\r\n          setSorting={setSorting}\r\n          columnVisibility={columnVisibility}\r\n          setColumnVisibility={setColumnVisibility}\r\n          columnOrder={columnOrder}\r\n          setColumnOrder={setColumnOrder}\r\n          pinnedColumns={pinnedColumns}\r\n          setPinnedColumns={setPinnedColumns}\r\n        />\r\n      )}\r\n\r\n      {/* Print Options Dialog */}\r\n      <SimplePrintOptionsDialog\r\n        open={isPrintDialogOpen}\r\n        onOpenChange={setIsPrintDialogOpen}\r\n        onConfirm={handlePrintConfirm}\r\n        selectedCount={pendingPrintReturns.length}\r\n        title=\"In phiếu trả NCC\"\r\n      />\r\n\r\n      {/* Export Dialog */}\r\n      <GenericExportDialogV2<PurchaseReturn>\r\n        open={exportDialogOpen}\r\n        onOpenChange={setExportDialogOpen}\r\n        config={purchaseReturnConfig}\r\n        allData={purchaseReturns}\r\n        filteredData={filteredData}\r\n        currentPageData={paginatedData}\r\n        selectedData={selectedRows}\r\n        currentUser={{\r\n          name: currentUser?.fullName || 'Hệ thống',\r\n          systemId: currentUser?.systemId || asSystemId('SYSTEM'),\r\n        }}\r\n      />\r\n    </div>\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}