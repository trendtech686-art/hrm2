{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/types.ts"],"sourcesContent":["import type { SystemId } from '@/lib/id-types';\r\n\r\n// ========================================\r\n// PKGX Reference Data Types\r\n// ========================================\r\n\r\n/**\r\n * Danh mục PKGX (cat_id từ ECShop)\r\n */\r\nexport type PkgxCategory = {\r\n  id: number;         // cat_id trên PKGX\r\n  name: string;       // Tên danh mục\r\n  parentId?: number;  // Parent category (nếu có)\r\n  sortOrder?: number; // Thứ tự sắp xếp\r\n  isShow?: number;    // Hiển thị (1=hiện, 0=ẩn)\r\n  // SEO fields\r\n  cat_desc?: string;      // Mô tả danh mục ngắn\r\n  long_desc?: string;     // Mô tả danh mục dài (HTML)\r\n  keywords?: string;      // SEO keywords\r\n  meta_title?: string;    // Meta title\r\n  meta_desc?: string;     // Meta description\r\n  cat_alias?: string;     // Slug/alias\r\n  style?: string;         // Template style\r\n  grade?: number;         // Cấp độ danh mục\r\n  filter_attr?: string;   // Filter attributes\r\n};\r\n\r\n/**\r\n * Thương hiệu PKGX (brand_id từ ECShop)\r\n */\r\nexport type PkgxBrand = {\r\n  id: number;           // brand_id trên PKGX\r\n  name: string;         // Tên thương hiệu\r\n  // Basic fields\r\n  logo?: string;          // Logo URL\r\n  description?: string;   // Mô tả thương hiệu (brand_desc)\r\n  siteUrl?: string;       // Website URL\r\n  sortOrder?: number;     // Thứ tự sắp xếp\r\n  isShow?: number;        // Hiển thị (1=hiện, 0=ẩn)\r\n  // SEO fields\r\n  keywords?: string;      // Keywords\r\n  metaTitle?: string;     // Meta title\r\n  metaDesc?: string;      // Meta description\r\n  // Description fields\r\n  shortDescription?: string;  // Mô tả ngắn (short_desc)\r\n  longDescription?: string;   // Mô tả dài (long_desc)\r\n  // Legacy fields (backward compatibility)\r\n  brand_logo?: string;    // Logo URL (legacy)\r\n  brand_desc?: string;    // Mô tả thương hiệu (HTML) (legacy)\r\n  site_url?: string;      // Website URL (legacy)\r\n  sort_order?: number;    // Thứ tự sắp xếp (legacy)\r\n};\r\n\r\n/**\r\n * Ảnh trong gallery sản phẩm PKGX\r\n */\r\nexport type PkgxGalleryImage = {\r\n  img_id: number;           // ID ảnh trong gallery\r\n  goods_id: number;         // ID sản phẩm\r\n  img_url: string;          // Đường dẫn ảnh gốc\r\n  thumb_url: string;        // Đường dẫn thumbnail\r\n  img_desc?: string;        // Mô tả ảnh\r\n  img_original?: string;    // Ảnh gốc (nếu có)\r\n};\r\n\r\n// ========================================\r\n// Mapping Types\r\n// ========================================\r\n\r\n/**\r\n * Mapping danh mục HRM → PKGX\r\n */\r\nexport type PkgxCategoryMapping = {\r\n  id: string;                     // Unique mapping ID\r\n  hrmCategorySystemId: SystemId;  // Category systemId trong HRM\r\n  hrmCategoryName: string;        // Tên hiển thị HRM\r\n  pkgxCatId: number;              // cat_id trên PKGX\r\n  pkgxCatName: string;            // Tên danh mục PKGX\r\n};\r\n\r\n/**\r\n * Mapping thương hiệu HRM → PKGX\r\n */\r\nexport type PkgxBrandMapping = {\r\n  id: string;                     // Unique mapping ID\r\n  hrmBrandSystemId: SystemId;     // Brand systemId trong HRM\r\n  hrmBrandName: string;           // Tên hiển thị HRM\r\n  pkgxBrandId: number;            // brand_id trên PKGX\r\n  pkgxBrandName: string;          // Tên thương hiệu PKGX\r\n};\r\n\r\n/**\r\n * Mapping bảng giá HRM → các loại giá PKGX\r\n */\r\nexport type PkgxPriceMapping = {\r\n  shopPrice: SystemId | null;     // Bảng giá → shop_price (giá bán)\r\n  marketPrice: SystemId | null;   // Bảng giá → market_price (giá thị trường)\r\n  partnerPrice: SystemId | null;  // Bảng giá → partner_price (giá đối tác)\r\n  acePrice: SystemId | null;      // Bảng giá → ace_price\r\n  dealPrice: SystemId | null;     // Bảng giá → deal_price\r\n};\r\n\r\n// ========================================\r\n// Sync Settings Types\r\n// ========================================\r\n\r\n/**\r\n * Cài đặt đồng bộ tự động\r\n */\r\nexport type PkgxSyncSettings = {\r\n  autoSyncEnabled: boolean;       // Bật/tắt auto sync\r\n  intervalMinutes: number;        // Tần suất (15, 30, 60, 120, 240)\r\n  syncInventory: boolean;         // Đồng bộ tồn kho\r\n  syncPrice: boolean;             // Đồng bộ giá\r\n  syncSeo: boolean;               // Đồng bộ SEO (meta_title, meta_desc, keywords)\r\n  syncOnProductUpdate: boolean;   // Sync ngay khi update SP trong HRM\r\n  notifyOnError: boolean;         // Thông báo khi có lỗi\r\n};\r\n\r\n/**\r\n * Log đồng bộ PKGX - Ghi lại TẤT CẢ các API call\r\n */\r\nexport type PkgxSyncLog = {\r\n  id: string;                     // Unique log ID\r\n  timestamp: string;              // ISO timestamp\r\n  action: \r\n    | 'test_connection'           // Test kết nối API\r\n    | 'ping'                      // Ping server\r\n    | 'sync_all'                  // Đồng bộ toàn bộ\r\n    | 'sync_price'                // Đồng bộ giá\r\n    | 'sync_inventory'            // Đồng bộ tồn kho\r\n    | 'sync_seo'                  // Đồng bộ SEO\r\n    | 'sync_description'          // Đồng bộ mô tả\r\n    | 'sync_flags'                // Đồng bộ flags (isHot, isNew, etc.)\r\n    | 'sync_basic'                // Đồng bộ thông tin cơ bản (alias)\r\n    | 'sync_basic_info'           // Đồng bộ thông tin cơ bản\r\n    | 'sync_images'               // Đồng bộ ảnh sản phẩm\r\n    | 'create_product'            // Tạo sản phẩm mới trên PKGX\r\n    | 'update_product'            // Cập nhật sản phẩm\r\n    | 'link_product'              // Liên kết SP HRM với PKGX\r\n    | 'unlink_product'            // Hủy liên kết SP\r\n    | 'unlink_mapping'            // Hủy liên kết mapping (category/brand)\r\n    | 'batch_unlink'              // Hủy liên kết hàng loạt\r\n    | 'bulk_sync_all'             // Bulk: Đồng bộ toàn bộ\r\n    | 'bulk_sync_basic'           // Bulk: Đồng bộ thông tin cơ bản\r\n    | 'bulk_sync_price'           // Bulk: Đồng bộ giá\r\n    | 'bulk_sync_inventory'       // Bulk: Đồng bộ tồn kho\r\n    | 'bulk_sync_seo'             // Bulk: Đồng bộ SEO\r\n    | 'bulk_sync_description'     // Bulk: Đồng bộ mô tả\r\n    | 'bulk_sync_flags'           // Bulk: Đồng bộ flags\r\n    | 'bulk_sync_images'          // Bulk: Đồng bộ ảnh\r\n    | 'sync_categories'           // Đồng bộ danh mục\r\n    | 'sync_brands'               // Đồng bộ thương hiệu\r\n    | 'get_products'              // Lấy danh sách SP từ PKGX\r\n    | 'upload_image'              // Upload ảnh sản phẩm\r\n    | 'save_config'               // Lưu cấu hình\r\n    | 'save_mapping';             // Lưu mapping\r\n  status: 'success' | 'error' | 'partial' | 'info';\r\n  message: string;                // Log message\r\n  // User info - Ai thực hiện action\r\n  userId?: string;                // User systemId hoặc 'SYSTEM'\r\n  userName?: string;              // Tên người dùng\r\n  details?: {\r\n    // Request info\r\n    url?: string;\r\n    method?: string;\r\n    // Response info\r\n    responseTime?: number;        // ms\r\n    httpStatus?: number;\r\n    // Data info\r\n    total?: number;\r\n    success?: number;\r\n    failed?: number;\r\n    productId?: string;\r\n    productName?: string;\r\n    pkgxId?: number;\r\n    inventory?: number;\r\n    categoryId?: number;\r\n    brandId?: number;\r\n    // Error info\r\n    error?: string;\r\n    errorCode?: string;\r\n  };\r\n};\r\n\r\n/**\r\n * Kết quả sync gần nhất\r\n */\r\nexport type PkgxSyncResult = {\r\n  status: 'success' | 'partial' | 'error';\r\n  total: number;\r\n  success: number;\r\n  failed: number;\r\n  errors?: string[];\r\n};\r\n\r\n// ========================================\r\n// Main PKGX Settings Type\r\n// ========================================\r\n\r\n/**\r\n * Toàn bộ cài đặt PKGX\r\n */\r\nexport type PkgxSettings = {\r\n  // === General Config ===\r\n  apiUrl: string;\r\n  apiKey: string;\r\n  enabled: boolean;                // Bật/tắt tích hợp PKGX\r\n  \r\n  // === Reference Data ===\r\n  categories: PkgxCategory[];\r\n  brands: PkgxBrand[];\r\n  \r\n  // === Mappings ===\r\n  priceMapping: PkgxPriceMapping;\r\n  categoryMappings: PkgxCategoryMapping[];\r\n  brandMappings: PkgxBrandMapping[];\r\n  \r\n  // === Sync Settings ===\r\n  syncSettings: PkgxSyncSettings;\r\n  \r\n  // === Status ===\r\n  lastSyncAt?: string;\r\n  lastSyncResult?: PkgxSyncResult;\r\n  connectionStatus?: 'connected' | 'disconnected' | 'error';\r\n  connectionError?: string;\r\n  \r\n  // === Logs ===\r\n  logs: PkgxSyncLog[];\r\n  \r\n  // === Cached PKGX Products ===\r\n  pkgxProducts: PkgxProduct[];     // Sản phẩm từ PKGX - lưu cache để không mất khi chuyển tab\r\n  pkgxProductsLastFetch?: string;  // Thời gian fetch gần nhất\r\n};\r\n\r\n// ========================================\r\n// PKGX Product Response Types (từ API)\r\n// ========================================\r\n\r\n/**\r\n * Sản phẩm trả về từ PKGX API\r\n * \r\n * Lưu ý quan trọng:\r\n * - goods_id: Primary Key, dùng để update/link sản phẩm qua API\r\n * - goods_sn: Mã SKU của sản phẩm, có thể sync với HRM.sku\r\n */\r\nexport type PkgxProduct = {\r\n  goods_id: number;      // PRIMARY KEY - Dùng để update sản phẩm qua API\r\n  goods_name: string;\r\n  goods_sn: string;      // Mã SKU - map với HRM Product.sku\r\n  cat_id: number;\r\n  brand_id: number;\r\n  shop_price: number;\r\n  market_price: number;\r\n  partner_price: number;\r\n  ace_price?: number;\r\n  deal_price?: number;\r\n  goods_number: number;\r\n  goods_desc: string;\r\n  keywords: string;\r\n  goods_brief: string;\r\n  meta_title: string;\r\n  meta_desc: string;\r\n  goods_img: string;\r\n  goods_thumb: string;\r\n  original_img: string;\r\n  is_on_sale: number;\r\n  is_best: number;\r\n  is_hot: number;\r\n  is_new: number;\r\n  is_home: number;\r\n  slug: string;\r\n  seller_note?: string;\r\n  add_time?: number;\r\n  last_update?: number;\r\n};\r\n\r\n/**\r\n * Response phân trang từ get_products\r\n */\r\nexport type PkgxProductsResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  pagination: {\r\n    total_items: number;\r\n    total_pages: number;\r\n    current_page: number;\r\n    per_page: number;\r\n  };\r\n  data: PkgxProduct[];\r\n};\r\n\r\n/**\r\n * Response upload ảnh\r\n */\r\nexport type PkgxImageUploadResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  data: {\r\n    original_img: string;\r\n    goods_img: string;\r\n    goods_thumb: string;\r\n    full_urls: {\r\n      original: string;\r\n      goods: string;\r\n      thumb: string;\r\n    };\r\n  };\r\n  goods_id?: number;\r\n  product_updated?: boolean;\r\n};\r\n\r\n/**\r\n * Response lấy danh sách danh mục từ PKGX API\r\n */\r\nexport type PkgxCategoryFromApi = {\r\n  cat_id: number;\r\n  cat_name: string;\r\n  parent_id: number;\r\n  sort_order: number;\r\n  is_show?: number; // 0 or 1\r\n  // SEO fields\r\n  cat_desc?: string;\r\n  long_desc?: string;\r\n  keywords?: string;\r\n  meta_title?: string;\r\n  meta_desc?: string;\r\n  cat_alias?: string;\r\n  style?: string;\r\n  grade?: number;\r\n  filter_attr?: string;\r\n};\r\n\r\nexport type PkgxCategoriesResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  total: number;\r\n  data: PkgxCategoryFromApi[];\r\n};\r\n\r\n/**\r\n * Response lấy danh sách thương hiệu từ PKGX API\r\n */\r\nexport type PkgxBrandFromApi = {\r\n  brand_id: number;\r\n  brand_name: string;\r\n  brand_logo?: string;\r\n  brand_desc?: string;\r\n  short_desc?: string;\r\n  long_desc?: string;\r\n  keywords?: string;\r\n  meta_title?: string;\r\n  meta_desc?: string;\r\n  site_url?: string;\r\n  sort_order: number;\r\n  is_show?: number; // 0 or 1\r\n};\r\n\r\nexport type PkgxBrandsResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  total: number;\r\n  data: PkgxBrandFromApi[];\r\n};\r\n\r\n/**\r\n * Response lấy gallery ảnh sản phẩm từ PKGX API\r\n */\r\nexport type PkgxGalleryResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  goods_id: number;\r\n  total: number;\r\n  data: PkgxGalleryImage[];\r\n};\r\n\r\n/**\r\n * Payload tạo/cập nhật sản phẩm\r\n */\r\nexport type PkgxProductPayload = {\r\n  goods_name?: string;\r\n  goods_sn?: string;\r\n  cat_id?: number;\r\n  brand_id?: number;\r\n  shop_price?: number;\r\n  market_price?: number;\r\n  partner_price?: number;\r\n  ace_price?: number;\r\n  deal_price?: number;\r\n  goods_number?: number;\r\n  goods_desc?: string;\r\n  keywords?: string;\r\n  goods_brief?: string;\r\n  meta_title?: string;\r\n  meta_desc?: string;\r\n  original_img?: string;\r\n  gallery_images?: string[];  // Album ảnh sản phẩm\r\n  best?: boolean;\r\n  hot?: boolean;\r\n  new?: boolean;\r\n  ishome?: boolean;\r\n  is_on_sale?: boolean;  // Hiển thị đăng web (on/off trên website PKGX)\r\n  seller_note?: string;\r\n};\r\n\r\n// ========================================\r\n// UI State Types\r\n// ========================================\r\n\r\nexport type PkgxSettingsTab = \r\n  | 'general'\r\n  | 'categories'\r\n  | 'brands'\r\n  | 'category-mapping'\r\n  | 'brand-mapping'\r\n  | 'price-mapping'\r\n  | 'product-mapping'\r\n  | 'sync';\r\n\r\nexport type ConnectionTestResult = {\r\n  success: boolean;\r\n  message: string;\r\n  productCount?: number;\r\n};\r\n\r\n// ========================================\r\n// Default Values\r\n// ========================================\r\n\r\nexport const DEFAULT_PKGX_SETTINGS: PkgxSettings = {\r\n  apiUrl: 'https://phukiengiaxuong.com.vn/admin/api_product_pro.php',\r\n  apiKey: '',\r\n  enabled: false,\r\n  \r\n  categories: [],\r\n  brands: [],\r\n  \r\n  priceMapping: {\r\n    shopPrice: null,\r\n    marketPrice: null,\r\n    partnerPrice: null,\r\n    acePrice: null,\r\n    dealPrice: null,\r\n  },\r\n  categoryMappings: [],\r\n  brandMappings: [],\r\n  \r\n  syncSettings: {\r\n    autoSyncEnabled: false,\r\n    intervalMinutes: 30,\r\n    syncInventory: true,\r\n    syncPrice: true,\r\n    syncSeo: false,\r\n    syncOnProductUpdate: true,\r\n    notifyOnError: true,\r\n  },\r\n  \r\n  logs: [],\r\n  \r\n  // Cached PKGX Products\r\n  pkgxProducts: [],\r\n  pkgxProductsLastFetch: undefined,\r\n};\r\n\r\nexport const SYNC_INTERVAL_OPTIONS = [\r\n  { value: 15, label: '15 phút' },\r\n  { value: 30, label: '30 phút' },\r\n  { value: 60, label: '1 giờ' },\r\n  { value: 120, label: '2 giờ' },\r\n  { value: 240, label: '4 giờ' },\r\n];\r\n"],"names":[],"mappings":";;;;;;AA6aO,MAAM,wBAAsC;IACjD,QAAQ;IACR,QAAQ;IACR,SAAS;IAET,YAAY,EAAE;IACd,QAAQ,EAAE;IAEV,cAAc;QACZ,WAAW;QACX,aAAa;QACb,cAAc;QACd,UAAU;QACV,WAAW;IACb;IACA,kBAAkB,EAAE;IACpB,eAAe,EAAE;IAEjB,cAAc;QACZ,iBAAiB;QACjB,iBAAiB;QACjB,eAAe;QACf,WAAW;QACX,SAAS;QACT,qBAAqB;QACrB,eAAe;IACjB;IAEA,MAAM,EAAE;IAER,uBAAuB;IACvB,cAAc,EAAE;IAChB,uBAAuB;AACzB;AAEO,MAAM,wBAAwB;IACnC;QAAE,OAAO;QAAI,OAAO;IAAU;IAC9B;QAAE,OAAO;QAAI,OAAO;IAAU;IAC9B;QAAE,OAAO;QAAI,OAAO;IAAQ;IAC5B;QAAE,OAAO;QAAK,OAAO;IAAQ;IAC7B;QAAE,OAAO;QAAK,OAAO;IAAQ;CAC9B"}},
    {"offset": {"line": 65, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/constants.ts"],"sourcesContent":["import type { PkgxCategory, PkgxBrand } from './types';\r\n\r\n/**\r\n * Danh sách danh mục PKGX (cat_id từ ECShop)\r\n * Nguồn: idpkgx.xlsx\r\n */\r\nexport const PKGX_CATEGORIES: PkgxCategory[] = [\r\n  // === Danh mục chính - Hàng theo loại ===\r\n  { id: 382, name: 'Sản phẩm mới' },\r\n  { id: 302, name: 'Hàng Theo Loại Bán' },\r\n  { id: 413, name: 'Hàng Hot Trend' },\r\n  { id: 390, name: 'Hàng Bán Chạy' },\r\n  { id: 389, name: 'Hàng Thanh Lý' },\r\n  { id: 387, name: 'Hàng Độc Quyền' },\r\n  { id: 391, name: 'Hàng bán Sàn TMĐT' },\r\n  { id: 388, name: 'Hàng Tặng Kèm' },\r\n  { id: 386, name: 'Hàng Chợ' },\r\n  \r\n  // === Tai nghe ===\r\n  { id: 37, name: 'Sỉ tai nghe' },\r\n  { id: 315, name: 'Tai nghe Bluetooth TWS' },\r\n  { id: 314, name: 'Tai nghe có dây' },\r\n  { id: 316, name: 'Tai nghe chụp tai bluetooth' },\r\n  { id: 375, name: 'Tai nghe bluetooth 1 bên' },\r\n  { id: 376, name: 'Tai nghe bluetooth thể thao' },\r\n  { id: 377, name: 'Tai nghe chụp tai Gaming' },\r\n  { id: 384, name: 'Case Tai Nghe Bluetooth' },\r\n  \r\n  // === Cáp sạc ===\r\n  { id: 38, name: 'Sỉ cáp sạc' },\r\n  { id: 317, name: 'Cáp sạc Type-C' },\r\n  { id: 318, name: 'Cáp sạc Lightning' },\r\n  { id: 319, name: 'Cáp sạc Micro USB' },\r\n  { id: 320, name: 'Cáp sạc đa năng' },\r\n  { id: 378, name: 'Cáp sạc nhanh' },\r\n  \r\n  // === Củ sạc ===\r\n  { id: 39, name: 'Sỉ củ sạc' },\r\n  { id: 321, name: 'Củ sạc nhanh' },\r\n  { id: 322, name: 'Củ sạc thường' },\r\n  { id: 323, name: 'Củ sạc không dây' },\r\n  { id: 379, name: 'Củ sạc Magsafe' },\r\n  \r\n  // === Sạc dự phòng ===\r\n  { id: 40, name: 'Sỉ sạc dự phòng' },\r\n  { id: 324, name: 'Sạc dự phòng 10000mAh' },\r\n  { id: 325, name: 'Sạc dự phòng 20000mAh' },\r\n  { id: 326, name: 'Sạc dự phòng 30000mAh+' },\r\n  { id: 380, name: 'Sạc dự phòng mini' },\r\n  \r\n  // === Loa ===\r\n  { id: 41, name: 'Sỉ loa bluetooth' },\r\n  { id: 327, name: 'Loa bluetooth mini' },\r\n  { id: 328, name: 'Loa bluetooth karaoke' },\r\n  { id: 329, name: 'Loa bluetooth chống nước' },\r\n  { id: 381, name: 'Loa kéo' },\r\n  \r\n  // === Phụ kiện điện thoại ===\r\n  { id: 42, name: 'Phụ kiện điện thoại' },\r\n  { id: 330, name: 'Ốp lưng điện thoại' },\r\n  { id: 331, name: 'Kính cường lực' },\r\n  { id: 332, name: 'Giá đỡ điện thoại' },\r\n  { id: 333, name: 'Gậy selfie/tripod' },\r\n  { id: 383, name: 'Ring holder' },\r\n  \r\n  // === Phụ kiện máy tính ===\r\n  { id: 43, name: 'Phụ kiện máy tính' },\r\n  { id: 334, name: 'Chuột máy tính' },\r\n  { id: 335, name: 'Bàn phím' },\r\n  { id: 336, name: 'Hub USB' },\r\n  { id: 337, name: 'Webcam' },\r\n  \r\n  // === Đồng hồ thông minh ===\r\n  { id: 44, name: 'Sỉ đồng hồ thông minh' },\r\n  { id: 338, name: 'Smartwatch' },\r\n  { id: 339, name: 'Smartband' },\r\n  { id: 340, name: 'Dây đeo smartwatch' },\r\n  \r\n  // === Gaming ===\r\n  { id: 45, name: 'Phụ kiện gaming' },\r\n  { id: 341, name: 'Tay cầm chơi game' },\r\n  { id: 342, name: 'Quạt tản nhiệt điện thoại' },\r\n  { id: 343, name: 'Nút bấm chơi game' },\r\n  \r\n  // === Ô tô ===\r\n  { id: 46, name: 'Phụ kiện ô tô' },\r\n  { id: 344, name: 'Sạc xe hơi' },\r\n  { id: 345, name: 'Giá đỡ điện thoại xe hơi' },\r\n  { id: 346, name: 'Camera hành trình' },\r\n  \r\n  // === Gia dụng ===\r\n  { id: 47, name: 'Đồ gia dụng' },\r\n  { id: 347, name: 'Đèn LED' },\r\n  { id: 348, name: 'Quạt mini' },\r\n  { id: 349, name: 'Cân điện tử' },\r\n];\r\n\r\n/**\r\n * Danh sách thương hiệu PKGX (brand_id từ ECShop)\r\n * Nguồn: idpkgx.xlsx\r\n */\r\nexport const PKGX_BRANDS: PkgxBrand[] = [\r\n  // === Thương hiệu chính ===\r\n  { id: 15, name: 'Hoco' },\r\n  { id: 141, name: 'Borofone' },\r\n  { id: 138, name: 'Baseus' },\r\n  { id: 12, name: 'Wekome' },\r\n  { id: 157, name: 'Maxitech' },\r\n  \r\n  // === Thương hiệu phụ ===\r\n  { id: 10, name: 'Anker' },\r\n  { id: 11, name: 'Xiaomi' },\r\n  { id: 13, name: 'Samsung' },\r\n  { id: 14, name: 'Apple' },\r\n  { id: 16, name: 'Remax' },\r\n  { id: 17, name: 'Ugreen' },\r\n  { id: 18, name: 'Vivan' },\r\n  { id: 19, name: 'Energizer' },\r\n  { id: 20, name: 'Sony' },\r\n  { id: 21, name: 'JBL' },\r\n  { id: 22, name: 'Logitech' },\r\n  { id: 23, name: 'Rapoo' },\r\n  { id: 24, name: 'Orico' },\r\n  { id: 25, name: 'Havit' },\r\n  { id: 26, name: 'Edifier' },\r\n  { id: 27, name: 'Aukey' },\r\n  { id: 28, name: 'Belkin' },\r\n  { id: 29, name: 'Mophie' },\r\n  { id: 30, name: 'Spigen' },\r\n  { id: 31, name: 'Nillkin' },\r\n  { id: 32, name: 'ESR' },\r\n  { id: 33, name: 'Mazer' },\r\n  { id: 34, name: 'Hyphen' },\r\n  { id: 35, name: 'WiWU' },\r\n  { id: 36, name: 'Pisen' },\r\n  { id: 37, name: 'Yoobao' },\r\n  { id: 38, name: 'iWalk' },\r\n  { id: 39, name: 'Romoss' },\r\n  { id: 40, name: 'Tronsmart' },\r\n  { id: 41, name: 'QCY' },\r\n  { id: 42, name: 'Lenovo' },\r\n  { id: 43, name: 'Huawei' },\r\n  { id: 44, name: 'Oppo' },\r\n  { id: 45, name: 'Vivo' },\r\n  { id: 46, name: 'Realme' },\r\n  { id: 47, name: 'Nothing' },\r\n  { id: 100, name: 'Không thương hiệu' },\r\n  { id: 101, name: 'OEM' },\r\n  { id: 102, name: 'Noname' },\r\n];\r\n\r\n/**\r\n * API Configuration\r\n */\r\nexport const PKGX_API_CONFIG = {\r\n  baseUrl: 'https://phukiengiaxuong.com.vn/admin/api_product_hrm.php',\r\n  cdnUrl: 'https://phukiengiaxuong.com.vn/cdn/',\r\n  defaultApiKey: 'a91f2c47e5d8b6f03a7c4e9d12f0b8a6',\r\n  \r\n  // Rate limiting\r\n  maxRequestsPerMinute: 60,\r\n  requestTimeout: 30000, // 30 seconds\r\n  \r\n  // Pagination\r\n  defaultPageSize: 50,\r\n  maxPageSize: 100,\r\n};\r\n\r\n/**\r\n * Field mapping reference\r\n */\r\nexport const FIELD_MAPPING_REFERENCE = {\r\n  // HRM Field → PKGX Field\r\n  'pkgxId': 'goods_id',\r\n  'id': 'goods_sn',\r\n  'name': 'goods_name',\r\n  'categorySystemId': 'cat_id',\r\n  'brandSystemId': 'brand_id',\r\n  'description': 'goods_desc',\r\n  'shortDescription': 'goods_brief',\r\n  'ktitle': 'meta_title',\r\n  'seoDescription': 'meta_desc',\r\n  'tags': 'keywords',\r\n  'thumbnailImage': 'original_img',\r\n  'isFeatured': 'is_best',\r\n  'isNewArrival': 'is_new',\r\n  'isPublished': 'is_on_sale',\r\n  'slug': 'slug',\r\n} as const;\r\n\r\n/**\r\n * PKGX Price field descriptions\r\n */\r\nexport const PKGX_PRICE_FIELDS = [\r\n  { key: 'shopPrice', field: 'shop_price', label: 'Giá bán (shop_price)', description: 'Giá bán chính trên website' },\r\n  { key: 'marketPrice', field: 'market_price', label: 'Giá thị trường (market_price)', description: 'Giá niêm yết / giá gốc' },\r\n  { key: 'partnerPrice', field: 'partner_price', label: 'Giá đối tác (partner_price)', description: 'Giá dành cho đối tác' },\r\n  { key: 'acePrice', field: 'ace_price', label: 'Giá ACE (ace_price)', description: 'Giá đặc biệt ACE' },\r\n  { key: 'dealPrice', field: 'deal_price', label: 'Giá deal (deal_price)', description: 'Giá khuyến mãi' },\r\n] as const;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 596, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/store.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport type { SystemId } from '@/lib/id-types';\r\nimport type {\r\n  PkgxSettings,\r\n  PkgxCategory,\r\n  PkgxBrand,\r\n  PkgxCategoryMapping,\r\n  PkgxBrandMapping,\r\n  PkgxPriceMapping,\r\n  PkgxSyncSettings,\r\n  PkgxSyncResult,\r\n  PkgxSyncLog,\r\n  PkgxProduct,\r\n} from './types';\r\nimport { DEFAULT_PKGX_SETTINGS } from './types';\r\nimport { PKGX_CATEGORIES, PKGX_BRANDS } from './constants';\r\nimport { getCategories as fetchPkgxCategories, getBrands as fetchPkgxBrands } from '@/lib/pkgx/api-service';\r\nimport { getCurrentUserInfo } from '@/contexts/auth-context';\r\n\r\n// ========================================\r\n// Store Interface\r\n// ========================================\r\n\r\ninterface PkgxSettingsStore {\r\n  // === State ===\r\n  settings: PkgxSettings;\r\n  isLoading: boolean;\r\n  isSaving: boolean;\r\n  \r\n  // === General Config Actions ===\r\n  setApiUrl: (url: string) => void;\r\n  setApiKey: (key: string) => void;\r\n  setEnabled: (enabled: boolean) => void;\r\n  \r\n  // === Reference Data Actions ===\r\n  setCategories: (categories: PkgxCategory[]) => void;\r\n  addCategory: (category: PkgxCategory) => void;\r\n  updateCategory: (id: number, updates: Partial<PkgxCategory>) => void;\r\n  deleteCategory: (id: number) => void;\r\n  \r\n  setBrands: (brands: PkgxBrand[]) => void;\r\n  addBrand: (brand: PkgxBrand) => void;\r\n  updateBrand: (id: number, updates: Partial<PkgxBrand>) => void;\r\n  deleteBrand: (id: number) => void;\r\n  \r\n  // === Mapping Actions ===\r\n  setPriceMapping: (mapping: PkgxPriceMapping) => void;\r\n  updatePriceMapping: (field: keyof PkgxPriceMapping, policyId: SystemId | null) => void;\r\n  \r\n  setCategoryMappings: (mappings: PkgxCategoryMapping[]) => void;\r\n  addCategoryMapping: (mapping: PkgxCategoryMapping) => void;\r\n  updateCategoryMapping: (id: string, updates: Partial<PkgxCategoryMapping>) => void;\r\n  deleteCategoryMapping: (id: string) => void;\r\n  \r\n  setBrandMappings: (mappings: PkgxBrandMapping[]) => void;\r\n  addBrandMapping: (mapping: PkgxBrandMapping) => void;\r\n  updateBrandMapping: (id: string, updates: Partial<PkgxBrandMapping>) => void;\r\n  deleteBrandMapping: (id: string) => void;\r\n  \r\n  // === Sync Settings Actions ===\r\n  setSyncSettings: (settings: PkgxSyncSettings) => void;\r\n  updateSyncSetting: <K extends keyof PkgxSyncSettings>(key: K, value: PkgxSyncSettings[K]) => void;\r\n  \r\n  // === Log Actions ===\r\n  addLog: (log: Omit<PkgxSyncLog, 'id' | 'timestamp'>) => void;\r\n  clearLogs: () => void;\r\n  \r\n  // === Sync Actions ===\r\n  syncCategoriesFromPkgx: () => Promise<void>;\r\n  syncBrandsFromPkgx: () => Promise<void>;\r\n  \r\n  // === PKGX Products Cache Actions ===\r\n  setPkgxProducts: (products: PkgxProduct[]) => void;\r\n  clearPkgxProducts: () => void;\r\n  \r\n  // === Status Actions ===\r\n  setLastSyncAt: (timestamp: string) => void;\r\n  setLastSyncResult: (result: PkgxSyncResult) => void;\r\n  setConnectionStatus: (status: 'connected' | 'disconnected' | 'error', error?: string) => void;\r\n  \r\n  // === Utility Actions ===\r\n  loadDefaultData: () => void;\r\n  resetSettings: () => void;\r\n  setLoading: (loading: boolean) => void;\r\n  setSaving: (saving: boolean) => void;\r\n  \r\n  // === Getters ===\r\n  getCategoryById: (id: number) => PkgxCategory | undefined;\r\n  getBrandById: (id: number) => PkgxBrand | undefined;\r\n  getCategoryMappingByHrmId: (hrmCategoryId: SystemId) => PkgxCategoryMapping | undefined;\r\n  getBrandMappingByHrmId: (hrmBrandId: SystemId) => PkgxBrandMapping | undefined;\r\n  getPkgxCatIdByHrmCategory: (hrmCategoryId: SystemId) => number | null;\r\n  getPkgxBrandIdByHrmBrand: (hrmBrandId: SystemId) => number | null;\r\n  \r\n  // === API Sync ===\r\n  initialized: boolean;\r\n  loadFromAPI: () => Promise<void>;\r\n}\r\n\r\n// ========================================\r\n// API Sync Helper\r\n// ========================================\r\nasync function syncPkgxSettingsToAPI(settings: Partial<PkgxSettings>): Promise<boolean> {\r\n  try {\r\n    const response = await fetch('/api/settings/pkgx', {\r\n      method: 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      credentials: 'include',\r\n      body: JSON.stringify(settings),\r\n    });\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error('[PKGX Settings API] sync error:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// ========================================\r\n// Store Implementation\r\n// ========================================\r\n\r\nexport const usePkgxSettingsStore = create<PkgxSettingsStore>()(\r\n  (set, get) => ({\r\n      // === Initial State ===\r\n      settings: {\r\n        ...DEFAULT_PKGX_SETTINGS,\r\n        categories: PKGX_CATEGORIES,\r\n        brands: PKGX_BRANDS,\r\n      },\r\n      isLoading: false,\r\n      isSaving: false,\r\n      initialized: false,\r\n      \r\n      // === General Config Actions ===\r\n      setApiUrl: (url) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, apiUrl: url },\r\n        })),\r\n        \r\n      setApiKey: (key) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, apiKey: key },\r\n        })),\r\n        \r\n      setEnabled: (enabled) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, enabled },\r\n        })),\r\n      \r\n      // === Reference Data Actions ===\r\n      setCategories: (categories) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, categories },\r\n        })),\r\n        \r\n      addCategory: (category) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categories: [...state.settings.categories, category],\r\n          },\r\n        })),\r\n        \r\n      updateCategory: (id, updates) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categories: state.settings.categories.map((c) =>\r\n              c.id === id ? { ...c, ...updates } : c\r\n            ),\r\n          },\r\n        })),\r\n        \r\n      deleteCategory: (id) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categories: state.settings.categories.filter((c) => c.id !== id),\r\n            // Also remove related mappings\r\n            categoryMappings: state.settings.categoryMappings.filter(\r\n              (m) => m.pkgxCatId !== id\r\n            ),\r\n          },\r\n        })),\r\n      \r\n      setBrands: (brands) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, brands },\r\n        })),\r\n        \r\n      addBrand: (brand) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brands: [...state.settings.brands, brand],\r\n          },\r\n        })),\r\n        \r\n      updateBrand: (id, updates) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brands: state.settings.brands.map((b) =>\r\n              b.id === id ? { ...b, ...updates } : b\r\n            ),\r\n          },\r\n        })),\r\n        \r\n      deleteBrand: (id) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brands: state.settings.brands.filter((b) => b.id !== id),\r\n            // Also remove related mappings\r\n            brandMappings: state.settings.brandMappings.filter(\r\n              (m) => m.pkgxBrandId !== id\r\n            ),\r\n          },\r\n        })),\r\n      \r\n      // === Mapping Actions ===\r\n      setPriceMapping: (mapping) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, priceMapping: mapping },\r\n        })),\r\n        \r\n      updatePriceMapping: (field, policyId) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            priceMapping: {\r\n              ...state.settings.priceMapping,\r\n              [field]: policyId,\r\n            },\r\n          },\r\n        })),\r\n      \r\n      setCategoryMappings: (mappings) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, categoryMappings: mappings },\r\n        })),\r\n        \r\n      addCategoryMapping: (mapping) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categoryMappings: [...state.settings.categoryMappings, mapping],\r\n          },\r\n        })),\r\n        \r\n      updateCategoryMapping: (id, updates) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categoryMappings: state.settings.categoryMappings.map((m) =>\r\n              m.id === id ? { ...m, ...updates } : m\r\n            ),\r\n          },\r\n        })),\r\n        \r\n      deleteCategoryMapping: (id) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categoryMappings: state.settings.categoryMappings.filter(\r\n              (m) => m.id !== id\r\n            ),\r\n          },\r\n        })),\r\n      \r\n      setBrandMappings: (mappings) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, brandMappings: mappings },\r\n        })),\r\n        \r\n      addBrandMapping: (mapping) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brandMappings: [...state.settings.brandMappings, mapping],\r\n          },\r\n        })),\r\n        \r\n      updateBrandMapping: (id, updates) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brandMappings: state.settings.brandMappings.map((m) =>\r\n              m.id === id ? { ...m, ...updates } : m\r\n            ),\r\n          },\r\n        })),\r\n        \r\n      deleteBrandMapping: (id) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brandMappings: state.settings.brandMappings.filter(\r\n              (m) => m.id !== id\r\n            ),\r\n          },\r\n        })),\r\n      \r\n      // === Sync Settings Actions ===\r\n      setSyncSettings: (syncSettings) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, syncSettings },\r\n        })),\r\n        \r\n      updateSyncSetting: (key, value) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            syncSettings: {\r\n              ...state.settings.syncSettings,\r\n              [key]: value,\r\n            },\r\n          },\r\n        })),\r\n      \r\n      // === Log Actions ===\r\n      addLog: (log) => {\r\n        // Lấy thông tin user hiện tại\r\n        const userInfo = getCurrentUserInfo();\r\n        \r\n        const newLog: PkgxSyncLog = {\r\n          ...log,\r\n          id: `log-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,\r\n          timestamp: new Date().toISOString(),\r\n          userId: userInfo.systemId,\r\n          userName: userInfo.name,\r\n        };\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            logs: [newLog, ...state.settings.logs].slice(0, 100), // Keep last 100 logs\r\n          },\r\n        }));\r\n      },\r\n      \r\n      clearLogs: () =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, logs: [] },\r\n        })),\r\n      \r\n      // === Sync Actions ===\r\n      syncCategoriesFromPkgx: async () => {\r\n        const { addLog, setCategories } = get();\r\n        try {\r\n          const response = await fetchPkgxCategories();\r\n          if (response.success && response.data && !response.data.error) {\r\n            // Map API response to PkgxCategory format\r\n            const categories: PkgxCategory[] = response.data.data.map((cat) => ({\r\n              id: cat.cat_id,\r\n              name: cat.cat_name,\r\n              parentId: cat.parent_id > 0 ? cat.parent_id : undefined,\r\n            }));\r\n            \r\n            // Replace all categories with fresh data from server\r\n            setCategories(categories);\r\n            addLog({\r\n              action: 'sync_categories',\r\n              status: 'success',\r\n              message: `Đã đồng bộ ${categories.length} danh mục từ PKGX`,\r\n              details: { total: categories.length, success: categories.length, failed: 0 },\r\n            });\r\n          } else {\r\n            throw new Error(response.error || response.data?.message || 'Không thể lấy danh sách danh mục');\r\n          }\r\n        } catch (error) {\r\n          addLog({\r\n            action: 'sync_categories',\r\n            status: 'error',\r\n            message: 'Lỗi khi đồng bộ danh mục từ PKGX',\r\n            details: { error: error instanceof Error ? error.message : String(error) },\r\n          });\r\n          throw error; // Re-throw to let UI handle\r\n        }\r\n      },\r\n      \r\n      syncBrandsFromPkgx: async () => {\r\n        const { addLog, setBrands } = get();\r\n        try {\r\n          const response = await fetchPkgxBrands();\r\n          if (response.success && response.data && !response.data.error) {\r\n            // Map API response to PkgxBrand format\r\n            const brands: PkgxBrand[] = response.data.data.map((brand) => ({\r\n              id: brand.brand_id,\r\n              name: brand.brand_name,\r\n            }));\r\n            \r\n            // Replace all brands with fresh data from server\r\n            setBrands(brands);\r\n            addLog({\r\n              action: 'sync_brands',\r\n              status: 'success',\r\n              message: `Đã đồng bộ ${brands.length} thương hiệu từ PKGX`,\r\n              details: { total: brands.length, success: brands.length, failed: 0 },\r\n            });\r\n          } else {\r\n            throw new Error(response.error || response.data?.message || 'Không thể lấy danh sách thương hiệu');\r\n          }\r\n        } catch (error) {\r\n          addLog({\r\n            action: 'sync_brands',\r\n            status: 'error',\r\n            message: 'Lỗi khi đồng bộ thương hiệu từ PKGX',\r\n            details: { error: error instanceof Error ? error.message : String(error) },\r\n          });\r\n          throw error; // Re-throw to let UI handle\r\n        }\r\n      },\r\n      \r\n      // === PKGX Products Cache Actions ===\r\n      setPkgxProducts: (products) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            pkgxProducts: products,\r\n            pkgxProductsLastFetch: new Date().toISOString(),\r\n          },\r\n        })),\r\n        \r\n      clearPkgxProducts: () =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            pkgxProducts: [],\r\n            pkgxProductsLastFetch: undefined,\r\n          },\r\n        })),\r\n      \r\n      // === Status Actions ===\r\n      setLastSyncAt: (timestamp) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, lastSyncAt: timestamp },\r\n        })),\r\n        \r\n      setLastSyncResult: (result) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, lastSyncResult: result },\r\n        })),\r\n        \r\n      setConnectionStatus: (status, error) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            connectionStatus: status,\r\n            connectionError: error,\r\n          },\r\n        })),\r\n      \r\n      // === Utility Actions ===\r\n      loadDefaultData: () =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categories: PKGX_CATEGORIES,\r\n            brands: PKGX_BRANDS,\r\n          },\r\n        })),\r\n        \r\n      resetSettings: () =>\r\n        set({\r\n          settings: {\r\n            ...DEFAULT_PKGX_SETTINGS,\r\n            categories: PKGX_CATEGORIES,\r\n            brands: PKGX_BRANDS,\r\n          },\r\n        }),\r\n        \r\n      setLoading: (isLoading) => set({ isLoading }),\r\n      setSaving: (isSaving) => set({ isSaving }),\r\n      \r\n      // === Getters ===\r\n      getCategoryById: (id) =>\r\n        get().settings.categories.find((c) => c.id === id),\r\n        \r\n      getBrandById: (id) =>\r\n        get().settings.brands.find((b) => b.id === id),\r\n        \r\n      getCategoryMappingByHrmId: (hrmCategoryId) =>\r\n        get().settings.categoryMappings.find(\r\n          (m) => m.hrmCategorySystemId === hrmCategoryId\r\n        ),\r\n        \r\n      getBrandMappingByHrmId: (hrmBrandId) =>\r\n        get().settings.brandMappings.find(\r\n          (m) => m.hrmBrandSystemId === hrmBrandId\r\n        ),\r\n        \r\n      getPkgxCatIdByHrmCategory: (hrmCategoryId) => {\r\n        const mapping = get().settings.categoryMappings.find(\r\n          (m) => m.hrmCategorySystemId === hrmCategoryId\r\n        );\r\n        return mapping?.pkgxCatId ?? null;\r\n      },\r\n      \r\n      getPkgxBrandIdByHrmBrand: (hrmBrandId) => {\r\n        const mapping = get().settings.brandMappings.find(\r\n          (m) => m.hrmBrandSystemId === hrmBrandId\r\n        );\r\n        return mapping?.pkgxBrandId ?? null;\r\n      },\r\n      \r\n      loadFromAPI: async () => {\r\n        if (get().initialized) return;\r\n        \r\n        try {\r\n          const response = await fetch('/api/settings/pkgx', {\r\n            credentials: 'include',\r\n          });\r\n          if (response.ok) {\r\n            const json = await response.json();\r\n            const data = json.data || json.settings;\r\n            if (data) {\r\n              set({ \r\n                settings: { \r\n                  ...DEFAULT_PKGX_SETTINGS, \r\n                  categories: PKGX_CATEGORIES,\r\n                  brands: PKGX_BRANDS,\r\n                  ...data \r\n                },\r\n                initialized: true \r\n              });\r\n            } else {\r\n              set({ initialized: true });\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('[PKGX Settings Store] loadFromAPI error:', error);\r\n        }\r\n      },\r\n    })\r\n);\r\n\r\n// ========================================\r\n// Selector Hooks\r\n// ========================================\r\n\r\nexport function usePkgxEnabled() {\r\n  return usePkgxSettingsStore((state) => state.settings.enabled);\r\n}\r\n\r\nexport function usePkgxApiConfig() {\r\n  return usePkgxSettingsStore((state) => ({\r\n    apiUrl: state.settings.apiUrl,\r\n    apiKey: state.settings.apiKey,\r\n    enabled: state.settings.enabled,\r\n  }));\r\n}\r\n\r\nexport function usePkgxCategories() {\r\n  return usePkgxSettingsStore((state) => state.settings.categories);\r\n}\r\n\r\nexport function usePkgxBrands() {\r\n  return usePkgxSettingsStore((state) => state.settings.brands);\r\n}\r\n\r\nexport function usePkgxPriceMapping() {\r\n  return usePkgxSettingsStore((state) => state.settings.priceMapping);\r\n}\r\n\r\nexport function usePkgxCategoryMappings() {\r\n  return usePkgxSettingsStore((state) => state.settings.categoryMappings);\r\n}\r\n\r\nexport function usePkgxBrandMappings() {\r\n  return usePkgxSettingsStore((state) => state.settings.brandMappings);\r\n}\r\n\r\nexport function usePkgxSyncSettings() {\r\n  return usePkgxSettingsStore((state) => state.settings.syncSettings);\r\n}\r\n\r\nexport function usePkgxSyncStatus() {\r\n  return usePkgxSettingsStore((state) => ({\r\n    lastSyncAt: state.settings.lastSyncAt,\r\n    lastSyncResult: state.settings.lastSyncResult,\r\n    connectionStatus: state.settings.connectionStatus,\r\n    connectionError: state.settings.connectionError,\r\n  }));\r\n}\r\n\r\nexport function usePkgxProducts() {\r\n  return usePkgxSettingsStore((state) => ({\r\n    products: state.settings.pkgxProducts,\r\n    lastFetch: state.settings.pkgxProductsLastFetch,\r\n  }));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1083, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/validation/category-mapping-validation.ts"],"sourcesContent":["import type { SystemId } from '@/lib/id-types';\r\nimport type { PkgxCategoryMapping, PkgxCategory } from '../types';\r\n\r\n// ========================================\r\n// Validation Types\r\n// ========================================\r\n\r\nexport interface ValidationResult {\r\n  isValid: boolean;\r\n  errors: ValidationError[];\r\n  warnings: ValidationWarning[];\r\n}\r\n\r\nexport interface ValidationError {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface ValidationWarning {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface CategoryMappingInput {\r\n  hrmCategorySystemId: SystemId | string;\r\n  hrmCategoryName: string;\r\n  pkgxCatId: number | string;\r\n  pkgxCatName: string;\r\n}\r\n\r\n// ========================================\r\n// Error Codes\r\n// ========================================\r\n\r\nexport const CATEGORY_MAPPING_ERROR_CODES = {\r\n  // Required field errors\r\n  HRM_CATEGORY_REQUIRED: 'HRM_CATEGORY_REQUIRED',\r\n  PKGX_CATEGORY_REQUIRED: 'PKGX_CATEGORY_REQUIRED',\r\n  \r\n  // Duplicate/conflict errors\r\n  HRM_CATEGORY_ALREADY_MAPPED: 'HRM_CATEGORY_ALREADY_MAPPED',\r\n  PKGX_CATEGORY_ALREADY_MAPPED: 'PKGX_CATEGORY_ALREADY_MAPPED',\r\n  \r\n  // Not found errors\r\n  HRM_CATEGORY_NOT_FOUND: 'HRM_CATEGORY_NOT_FOUND',\r\n  PKGX_CATEGORY_NOT_FOUND: 'PKGX_CATEGORY_NOT_FOUND',\r\n  \r\n  // Inactive/deleted errors\r\n  HRM_CATEGORY_INACTIVE: 'HRM_CATEGORY_INACTIVE',\r\n  PKGX_CATEGORY_INACTIVE: 'PKGX_CATEGORY_INACTIVE',\r\n  \r\n  // Structure errors\r\n  MAPPING_TO_PARENT_CATEGORY: 'MAPPING_TO_PARENT_CATEGORY',\r\n  HIERARCHY_MISMATCH: 'HIERARCHY_MISMATCH',\r\n} as const;\r\n\r\nexport const CATEGORY_MAPPING_WARNING_CODES = {\r\n  // Suggestions\r\n  SAME_NAME_AVAILABLE: 'SAME_NAME_AVAILABLE',\r\n  PARENT_NOT_MAPPED: 'PARENT_NOT_MAPPED',\r\n  CHILD_ALREADY_MAPPED: 'CHILD_ALREADY_MAPPED',\r\n  NAME_MISMATCH: 'NAME_MISMATCH',\r\n  MANY_TO_ONE_MAPPING: 'MANY_TO_ONE_MAPPING',\r\n} as const;\r\n\r\n// ========================================\r\n// Error Messages (Vietnamese)\r\n// ========================================\r\n\r\nexport const CATEGORY_MAPPING_ERROR_MESSAGES: Record<string, string> = {\r\n  [CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_REQUIRED]: 'Vui lòng chọn danh mục HRM',\r\n  [CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_REQUIRED]: 'Vui lòng chọn danh mục PKGX',\r\n  [CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_ALREADY_MAPPED]: 'Danh mục HRM này đã được mapping với danh mục PKGX khác',\r\n  [CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_ALREADY_MAPPED]: 'Danh mục PKGX này đã được mapping với danh mục HRM khác',\r\n  [CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_NOT_FOUND]: 'Không tìm thấy danh mục HRM trong hệ thống',\r\n  [CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_NOT_FOUND]: 'Không tìm thấy danh mục PKGX (có thể đã bị xóa trên PKGX)',\r\n  [CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_INACTIVE]: 'Danh mục HRM đã bị vô hiệu hóa hoặc xóa',\r\n  [CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_INACTIVE]: 'Danh mục PKGX không hoạt động',\r\n  [CATEGORY_MAPPING_ERROR_CODES.MAPPING_TO_PARENT_CATEGORY]: 'Không nên mapping với danh mục cha. Hãy chọn danh mục con cụ thể',\r\n  [CATEGORY_MAPPING_ERROR_CODES.HIERARCHY_MISMATCH]: 'Cấp danh mục không khớp (cha/con)',\r\n};\r\n\r\nexport const CATEGORY_MAPPING_WARNING_MESSAGES: Record<string, string> = {\r\n  [CATEGORY_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE]: 'Có danh mục PKGX trùng tên, có thể bạn muốn chọn danh mục đó',\r\n  [CATEGORY_MAPPING_WARNING_CODES.PARENT_NOT_MAPPED]: 'Danh mục cha chưa được mapping. Nên mapping danh mục cha trước',\r\n  [CATEGORY_MAPPING_WARNING_CODES.CHILD_ALREADY_MAPPED]: 'Đã có danh mục con được mapping. Kiểm tra lại cấu trúc',\r\n  [CATEGORY_MAPPING_WARNING_CODES.NAME_MISMATCH]: 'Tên danh mục HRM và PKGX khác nhau đáng kể',\r\n  [CATEGORY_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING]: 'Nhiều danh mục HRM đang mapping tới cùng một danh mục PKGX',\r\n};\r\n\r\n// ========================================\r\n// Validation Context\r\n// ========================================\r\n\r\nexport interface ValidationContext {\r\n  existingMappings: PkgxCategoryMapping[];\r\n  hrmCategories: Array<{\r\n    systemId: SystemId;\r\n    name: string;\r\n    parentId?: SystemId;\r\n    status?: string;\r\n    isActive?: boolean;\r\n    path?: string;\r\n  }>;\r\n  pkgxCategories: PkgxCategory[];\r\n  editingMappingId?: string; // ID của mapping đang edit (để exclude khỏi duplicate check)\r\n}\r\n\r\n// ========================================\r\n// Validation Functions\r\n// ========================================\r\n\r\n/**\r\n * Validate required fields\r\n */\r\nexport function validateRequiredFields(input: CategoryMappingInput): ValidationError[] {\r\n  const errors: ValidationError[] = [];\r\n\r\n  if (!input.hrmCategorySystemId) {\r\n    errors.push({\r\n      code: CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_REQUIRED,\r\n      field: 'hrmCategorySystemId',\r\n      message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_REQUIRED],\r\n    });\r\n  }\r\n\r\n  if (!input.pkgxCatId) {\r\n    errors.push({\r\n      code: CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_REQUIRED,\r\n      field: 'pkgxCatId',\r\n      message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_REQUIRED],\r\n    });\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate category exists\r\n */\r\nexport function validateCategoryExists(\r\n  input: CategoryMappingInput,\r\n  context: ValidationContext\r\n): ValidationError[] {\r\n  const errors: ValidationError[] = [];\r\n\r\n  if (input.hrmCategorySystemId) {\r\n    const hrmCat = context.hrmCategories.find(c => c.systemId === input.hrmCategorySystemId);\r\n    if (!hrmCat) {\r\n      errors.push({\r\n        code: CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_NOT_FOUND,\r\n        field: 'hrmCategorySystemId',\r\n        message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_NOT_FOUND],\r\n        details: { systemId: input.hrmCategorySystemId },\r\n      });\r\n    } else if (hrmCat.status === 'inactive' || hrmCat.isActive === false) {\r\n      errors.push({\r\n        code: CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_INACTIVE,\r\n        field: 'hrmCategorySystemId',\r\n        message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_INACTIVE],\r\n        details: { systemId: input.hrmCategorySystemId, name: hrmCat.name },\r\n      });\r\n    }\r\n  }\r\n\r\n  if (input.pkgxCatId) {\r\n    const pkgxCat = context.pkgxCategories.find(c => c.id === input.pkgxCatId);\r\n    if (!pkgxCat) {\r\n      errors.push({\r\n        code: CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_NOT_FOUND,\r\n        field: 'pkgxCatId',\r\n        message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_NOT_FOUND],\r\n        details: { pkgxCatId: input.pkgxCatId },\r\n      });\r\n    }\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate duplicate mappings\r\n */\r\nexport function validateDuplicateMappings(\r\n  input: CategoryMappingInput,\r\n  context: ValidationContext\r\n): ValidationError[] {\r\n  const errors: ValidationError[] = [];\r\n\r\n  if (input.hrmCategorySystemId) {\r\n    const existingHrmMapping = context.existingMappings.find(\r\n      m => m.hrmCategorySystemId === input.hrmCategorySystemId && m.id !== context.editingMappingId\r\n    );\r\n    if (existingHrmMapping) {\r\n      errors.push({\r\n        code: CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_ALREADY_MAPPED,\r\n        field: 'hrmCategorySystemId',\r\n        message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_ALREADY_MAPPED],\r\n        details: {\r\n          existingMapping: existingHrmMapping,\r\n          mappedTo: existingHrmMapping.pkgxCatName,\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // Note: PKGX category có thể mapping với nhiều HRM category (one-to-many)\r\n  // Nhưng vẫn cảnh báo nếu đã có mapping khác\r\n  \r\n  return errors;\r\n}\r\n\r\n/**\r\n * Check for warnings (không block nhưng cảnh báo)\r\n */\r\nexport function checkWarnings(\r\n  input: CategoryMappingInput,\r\n  context: ValidationContext\r\n): ValidationWarning[] {\r\n  const warnings: ValidationWarning[] = [];\r\n\r\n  if (!input.hrmCategorySystemId || !input.pkgxCatId) {\r\n    return warnings;\r\n  }\r\n\r\n  const hrmCat = context.hrmCategories.find(c => c.systemId === input.hrmCategorySystemId);\r\n  const pkgxCat = context.pkgxCategories.find(c => c.id === input.pkgxCatId);\r\n\r\n  if (!hrmCat || !pkgxCat) return warnings;\r\n\r\n  // 1. Check name mismatch\r\n  const normalizedHrmName = normalizeString(hrmCat.name);\r\n  const normalizedPkgxName = normalizeString(pkgxCat.name);\r\n  const similarity = calculateSimilarity(normalizedHrmName, normalizedPkgxName);\r\n  \r\n  if (similarity < 0.5) {\r\n    warnings.push({\r\n      code: CATEGORY_MAPPING_WARNING_CODES.NAME_MISMATCH,\r\n      message: CATEGORY_MAPPING_WARNING_MESSAGES[CATEGORY_MAPPING_WARNING_CODES.NAME_MISMATCH],\r\n      details: { \r\n        hrmName: hrmCat.name, \r\n        pkgxName: pkgxCat.name,\r\n        similarity: Math.round(similarity * 100) + '%',\r\n      },\r\n    });\r\n  }\r\n\r\n  // 2. Check if same name exists in PKGX\r\n  const sameNamePkgx = context.pkgxCategories.find(\r\n    c => c.id !== input.pkgxCatId && normalizeString(c.name) === normalizedHrmName\r\n  );\r\n  if (sameNamePkgx) {\r\n    warnings.push({\r\n      code: CATEGORY_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE,\r\n      message: CATEGORY_MAPPING_WARNING_MESSAGES[CATEGORY_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE],\r\n      details: {\r\n        suggestedCategory: sameNamePkgx,\r\n      },\r\n    });\r\n  }\r\n\r\n  // 3. Check if parent category is not mapped (for HRM categories with parent)\r\n  if (hrmCat.parentId) {\r\n    const parentMapping = context.existingMappings.find(\r\n      m => m.hrmCategorySystemId === hrmCat.parentId\r\n    );\r\n    if (!parentMapping) {\r\n      const parentCat = context.hrmCategories.find(c => c.systemId === hrmCat.parentId);\r\n      if (parentCat) {\r\n        warnings.push({\r\n          code: CATEGORY_MAPPING_WARNING_CODES.PARENT_NOT_MAPPED,\r\n          message: CATEGORY_MAPPING_WARNING_MESSAGES[CATEGORY_MAPPING_WARNING_CODES.PARENT_NOT_MAPPED],\r\n          details: {\r\n            parentName: parentCat.name,\r\n            parentId: hrmCat.parentId,\r\n          },\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  // 4. Check many-to-one mapping\r\n  const otherMappingsToSamePkgx = context.existingMappings.filter(\r\n    m => m.pkgxCatId === input.pkgxCatId && m.id !== context.editingMappingId\r\n  );\r\n  if (otherMappingsToSamePkgx.length > 0) {\r\n    warnings.push({\r\n      code: CATEGORY_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING,\r\n      message: CATEGORY_MAPPING_WARNING_MESSAGES[CATEGORY_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING],\r\n      details: {\r\n        count: otherMappingsToSamePkgx.length + 1,\r\n        existingMappings: otherMappingsToSamePkgx.map(m => m.hrmCategoryName),\r\n      },\r\n    });\r\n  }\r\n\r\n  // 5. Check if mapping to parent category when children exist\r\n  const pkgxChildren = context.pkgxCategories.filter(c => c.parentId === pkgxCat.id);\r\n  if (pkgxChildren.length > 0) {\r\n    warnings.push({\r\n      code: CATEGORY_MAPPING_WARNING_CODES.CHILD_ALREADY_MAPPED,\r\n      message: 'Danh mục PKGX này có danh mục con. Cân nhắc mapping với danh mục con cụ thể',\r\n      details: {\r\n        childCount: pkgxChildren.length,\r\n        children: pkgxChildren.slice(0, 5).map(c => c.name),\r\n      },\r\n    });\r\n  }\r\n\r\n  return warnings;\r\n}\r\n\r\n/**\r\n * Main validation function\r\n */\r\nexport function validateCategoryMapping(\r\n  input: CategoryMappingInput,\r\n  context: ValidationContext\r\n): ValidationResult {\r\n  const errors: ValidationError[] = [];\r\n  const warnings: ValidationWarning[] = [];\r\n\r\n  // 1. Required fields\r\n  errors.push(...validateRequiredFields(input));\r\n\r\n  // If required fields are missing, stop here\r\n  if (errors.length > 0) {\r\n    return { isValid: false, errors, warnings };\r\n  }\r\n\r\n  // 2. Category exists\r\n  errors.push(...validateCategoryExists(input, context));\r\n\r\n  // 3. Duplicate mappings\r\n  errors.push(...validateDuplicateMappings(input, context));\r\n\r\n  // 4. Warnings (non-blocking)\r\n  warnings.push(...checkWarnings(input, context));\r\n\r\n  return {\r\n    isValid: errors.length === 0,\r\n    errors,\r\n    warnings,\r\n  };\r\n}\r\n\r\n// ========================================\r\n// Utility Functions\r\n// ========================================\r\n\r\n/**\r\n * Normalize string for comparison\r\n */\r\nfunction normalizeString(str: string): string {\r\n  return str\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '') // Remove diacritics\r\n    .replace(/đ/g, 'd')\r\n    .replace(/[^a-z0-9\\s]/g, '')\r\n    .trim();\r\n}\r\n\r\n/**\r\n * Calculate string similarity (Jaccard index)\r\n */\r\nfunction calculateSimilarity(str1: string, str2: string): number {\r\n  const words1 = new Set(str1.split(/\\s+/).filter(w => w.length > 0));\r\n  const words2 = new Set(str2.split(/\\s+/).filter(w => w.length > 0));\r\n  \r\n  if (words1.size === 0 && words2.size === 0) return 1;\r\n  if (words1.size === 0 || words2.size === 0) return 0;\r\n  \r\n  const intersection = new Set([...words1].filter(x => words2.has(x)));\r\n  const union = new Set([...words1, ...words2]);\r\n  \r\n  return intersection.size / union.size;\r\n}\r\n\r\n/**\r\n * Suggest matching categories based on name\r\n */\r\nexport function suggestMatchingCategories(\r\n  hrmCategoryName: string,\r\n  pkgxCategories: PkgxCategory[],\r\n  limit = 5\r\n): Array<{ category: PkgxCategory; score: number }> {\r\n  const normalizedInput = normalizeString(hrmCategoryName);\r\n  \r\n  const scored = pkgxCategories.map(cat => ({\r\n    category: cat,\r\n    score: calculateSimilarity(normalizedInput, normalizeString(cat.name)),\r\n  }));\r\n  \r\n  return scored\r\n    .filter(s => s.score > 0.2)\r\n    .sort((a, b) => b.score - a.score)\r\n    .slice(0, limit);\r\n}\r\n\r\n/**\r\n * Find potential duplicate mappings\r\n */\r\nexport function findPotentialDuplicates(\r\n  mappings: PkgxCategoryMapping[]\r\n): Array<{ pkgxCatId: number; mappings: PkgxCategoryMapping[] }> {\r\n  const grouped = new Map<number, PkgxCategoryMapping[]>();\r\n  \r\n  for (const mapping of mappings) {\r\n    const existing = grouped.get(mapping.pkgxCatId) || [];\r\n    existing.push(mapping);\r\n    grouped.set(mapping.pkgxCatId, existing);\r\n  }\r\n  \r\n  return Array.from(grouped.entries())\r\n    .filter(([, mappings]) => mappings.length > 1)\r\n    .map(([pkgxCatId, mappings]) => ({ pkgxCatId, mappings }));\r\n}\r\n\r\n// ========================================\r\n// Batch Validation\r\n// ========================================\r\n\r\nexport interface BatchValidationResult {\r\n  valid: CategoryMappingInput[];\r\n  invalid: Array<{ input: CategoryMappingInput; errors: ValidationError[] }>;\r\n  withWarnings: Array<{ input: CategoryMappingInput; warnings: ValidationWarning[] }>;\r\n  summary: {\r\n    total: number;\r\n    validCount: number;\r\n    invalidCount: number;\r\n    warningCount: number;\r\n  };\r\n}\r\n\r\n/**\r\n * Validate multiple mappings at once\r\n */\r\nexport function validateBatchMappings(\r\n  inputs: CategoryMappingInput[],\r\n  context: ValidationContext\r\n): BatchValidationResult {\r\n  const valid: CategoryMappingInput[] = [];\r\n  const invalid: Array<{ input: CategoryMappingInput; errors: ValidationError[] }> = [];\r\n  const withWarnings: Array<{ input: CategoryMappingInput; warnings: ValidationWarning[] }> = [];\r\n\r\n  // Check for duplicates within the batch itself\r\n  const hrmIdsSeen = new Set<string>();\r\n  \r\n  for (const input of inputs) {\r\n    // Check batch internal duplicates\r\n    if (input.hrmCategorySystemId && hrmIdsSeen.has(input.hrmCategorySystemId)) {\r\n      invalid.push({\r\n        input,\r\n        errors: [{\r\n          code: CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_ALREADY_MAPPED,\r\n          field: 'hrmCategorySystemId',\r\n          message: 'Danh mục HRM này xuất hiện nhiều lần trong danh sách import',\r\n        }],\r\n      });\r\n      continue;\r\n    }\r\n    \r\n    if (input.hrmCategorySystemId) {\r\n      hrmIdsSeen.add(input.hrmCategorySystemId);\r\n    }\r\n    \r\n    const result = validateCategoryMapping(input, context);\r\n    \r\n    if (!result.isValid) {\r\n      invalid.push({ input, errors: result.errors });\r\n    } else {\r\n      valid.push(input);\r\n      if (result.warnings.length > 0) {\r\n        withWarnings.push({ input, warnings: result.warnings });\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    valid,\r\n    invalid,\r\n    withWarnings,\r\n    summary: {\r\n      total: inputs.length,\r\n      validCount: valid.length,\r\n      invalidCount: invalid.length,\r\n      warningCount: withWarnings.length,\r\n    },\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAsCO,MAAM,+BAA+B;IAC1C,wBAAwB;IACxB,uBAAuB;IACvB,wBAAwB;IAExB,4BAA4B;IAC5B,6BAA6B;IAC7B,8BAA8B;IAE9B,mBAAmB;IACnB,wBAAwB;IACxB,yBAAyB;IAEzB,0BAA0B;IAC1B,uBAAuB;IACvB,wBAAwB;IAExB,mBAAmB;IACnB,4BAA4B;IAC5B,oBAAoB;AACtB;AAEO,MAAM,iCAAiC;IAC5C,cAAc;IACd,qBAAqB;IACrB,mBAAmB;IACnB,sBAAsB;IACtB,eAAe;IACf,qBAAqB;AACvB;AAMO,MAAM,kCAA0D;IACrE,CAAC,6BAA6B,qBAAqB,CAAC,EAAE;IACtD,CAAC,6BAA6B,sBAAsB,CAAC,EAAE;IACvD,CAAC,6BAA6B,2BAA2B,CAAC,EAAE;IAC5D,CAAC,6BAA6B,4BAA4B,CAAC,EAAE;IAC7D,CAAC,6BAA6B,sBAAsB,CAAC,EAAE;IACvD,CAAC,6BAA6B,uBAAuB,CAAC,EAAE;IACxD,CAAC,6BAA6B,qBAAqB,CAAC,EAAE;IACtD,CAAC,6BAA6B,sBAAsB,CAAC,EAAE;IACvD,CAAC,6BAA6B,0BAA0B,CAAC,EAAE;IAC3D,CAAC,6BAA6B,kBAAkB,CAAC,EAAE;AACrD;AAEO,MAAM,oCAA4D;IACvE,CAAC,+BAA+B,mBAAmB,CAAC,EAAE;IACtD,CAAC,+BAA+B,iBAAiB,CAAC,EAAE;IACpD,CAAC,+BAA+B,oBAAoB,CAAC,EAAE;IACvD,CAAC,+BAA+B,aAAa,CAAC,EAAE;IAChD,CAAC,+BAA+B,mBAAmB,CAAC,EAAE;AACxD;AA2BO,SAAS,uBAAuB,KAA2B;IAChE,MAAM,SAA4B,EAAE;IAEpC,IAAI,CAAC,MAAM,mBAAmB,EAAE;QAC9B,OAAO,IAAI,CAAC;YACV,MAAM,6BAA6B,qBAAqB;YACxD,OAAO;YACP,SAAS,+BAA+B,CAAC,6BAA6B,qBAAqB,CAAC;QAC9F;IACF;IAEA,IAAI,CAAC,MAAM,SAAS,EAAE;QACpB,OAAO,IAAI,CAAC;YACV,MAAM,6BAA6B,sBAAsB;YACzD,OAAO;YACP,SAAS,+BAA+B,CAAC,6BAA6B,sBAAsB,CAAC;QAC/F;IACF;IAEA,OAAO;AACT;AAKO,SAAS,uBACd,KAA2B,EAC3B,OAA0B;IAE1B,MAAM,SAA4B,EAAE;IAEpC,IAAI,MAAM,mBAAmB,EAAE;QAC7B,MAAM,SAAS,QAAQ,aAAa,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK,MAAM,mBAAmB;QACvF,IAAI,CAAC,QAAQ;YACX,OAAO,IAAI,CAAC;gBACV,MAAM,6BAA6B,sBAAsB;gBACzD,OAAO;gBACP,SAAS,+BAA+B,CAAC,6BAA6B,sBAAsB,CAAC;gBAC7F,SAAS;oBAAE,UAAU,MAAM,mBAAmB;gBAAC;YACjD;QACF,OAAO,IAAI,OAAO,MAAM,KAAK,cAAc,OAAO,QAAQ,KAAK,OAAO;YACpE,OAAO,IAAI,CAAC;gBACV,MAAM,6BAA6B,qBAAqB;gBACxD,OAAO;gBACP,SAAS,+BAA+B,CAAC,6BAA6B,qBAAqB,CAAC;gBAC5F,SAAS;oBAAE,UAAU,MAAM,mBAAmB;oBAAE,MAAM,OAAO,IAAI;gBAAC;YACpE;QACF;IACF;IAEA,IAAI,MAAM,SAAS,EAAE;QACnB,MAAM,UAAU,QAAQ,cAAc,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,MAAM,SAAS;QACzE,IAAI,CAAC,SAAS;YACZ,OAAO,IAAI,CAAC;gBACV,MAAM,6BAA6B,uBAAuB;gBAC1D,OAAO;gBACP,SAAS,+BAA+B,CAAC,6BAA6B,uBAAuB,CAAC;gBAC9F,SAAS;oBAAE,WAAW,MAAM,SAAS;gBAAC;YACxC;QACF;IACF;IAEA,OAAO;AACT;AAKO,SAAS,0BACd,KAA2B,EAC3B,OAA0B;IAE1B,MAAM,SAA4B,EAAE;IAEpC,IAAI,MAAM,mBAAmB,EAAE;QAC7B,MAAM,qBAAqB,QAAQ,gBAAgB,CAAC,IAAI,CACtD,CAAA,IAAK,EAAE,mBAAmB,KAAK,MAAM,mBAAmB,IAAI,EAAE,EAAE,KAAK,QAAQ,gBAAgB;QAE/F,IAAI,oBAAoB;YACtB,OAAO,IAAI,CAAC;gBACV,MAAM,6BAA6B,2BAA2B;gBAC9D,OAAO;gBACP,SAAS,+BAA+B,CAAC,6BAA6B,2BAA2B,CAAC;gBAClG,SAAS;oBACP,iBAAiB;oBACjB,UAAU,mBAAmB,WAAW;gBAC1C;YACF;QACF;IACF;IAEA,0EAA0E;IAC1E,4CAA4C;IAE5C,OAAO;AACT;AAKO,SAAS,cACd,KAA2B,EAC3B,OAA0B;IAE1B,MAAM,WAAgC,EAAE;IAExC,IAAI,CAAC,MAAM,mBAAmB,IAAI,CAAC,MAAM,SAAS,EAAE;QAClD,OAAO;IACT;IAEA,MAAM,SAAS,QAAQ,aAAa,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK,MAAM,mBAAmB;IACvF,MAAM,UAAU,QAAQ,cAAc,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK,MAAM,SAAS;IAEzE,IAAI,CAAC,UAAU,CAAC,SAAS,OAAO;IAEhC,yBAAyB;IACzB,MAAM,oBAAoB,gBAAgB,OAAO,IAAI;IACrD,MAAM,qBAAqB,gBAAgB,QAAQ,IAAI;IACvD,MAAM,aAAa,oBAAoB,mBAAmB;IAE1D,IAAI,aAAa,KAAK;QACpB,SAAS,IAAI,CAAC;YACZ,MAAM,+BAA+B,aAAa;YAClD,SAAS,iCAAiC,CAAC,+BAA+B,aAAa,CAAC;YACxF,SAAS;gBACP,SAAS,OAAO,IAAI;gBACpB,UAAU,QAAQ,IAAI;gBACtB,YAAY,KAAK,KAAK,CAAC,aAAa,OAAO;YAC7C;QACF;IACF;IAEA,uCAAuC;IACvC,MAAM,eAAe,QAAQ,cAAc,CAAC,IAAI,CAC9C,CAAA,IAAK,EAAE,EAAE,KAAK,MAAM,SAAS,IAAI,gBAAgB,EAAE,IAAI,MAAM;IAE/D,IAAI,cAAc;QAChB,SAAS,IAAI,CAAC;YACZ,MAAM,+BAA+B,mBAAmB;YACxD,SAAS,iCAAiC,CAAC,+BAA+B,mBAAmB,CAAC;YAC9F,SAAS;gBACP,mBAAmB;YACrB;QACF;IACF;IAEA,6EAA6E;IAC7E,IAAI,OAAO,QAAQ,EAAE;QACnB,MAAM,gBAAgB,QAAQ,gBAAgB,CAAC,IAAI,CACjD,CAAA,IAAK,EAAE,mBAAmB,KAAK,OAAO,QAAQ;QAEhD,IAAI,CAAC,eAAe;YAClB,MAAM,YAAY,QAAQ,aAAa,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK,OAAO,QAAQ;YAChF,IAAI,WAAW;gBACb,SAAS,IAAI,CAAC;oBACZ,MAAM,+BAA+B,iBAAiB;oBACtD,SAAS,iCAAiC,CAAC,+BAA+B,iBAAiB,CAAC;oBAC5F,SAAS;wBACP,YAAY,UAAU,IAAI;wBAC1B,UAAU,OAAO,QAAQ;oBAC3B;gBACF;YACF;QACF;IACF;IAEA,+BAA+B;IAC/B,MAAM,0BAA0B,QAAQ,gBAAgB,CAAC,MAAM,CAC7D,CAAA,IAAK,EAAE,SAAS,KAAK,MAAM,SAAS,IAAI,EAAE,EAAE,KAAK,QAAQ,gBAAgB;IAE3E,IAAI,wBAAwB,MAAM,GAAG,GAAG;QACtC,SAAS,IAAI,CAAC;YACZ,MAAM,+BAA+B,mBAAmB;YACxD,SAAS,iCAAiC,CAAC,+BAA+B,mBAAmB,CAAC;YAC9F,SAAS;gBACP,OAAO,wBAAwB,MAAM,GAAG;gBACxC,kBAAkB,wBAAwB,GAAG,CAAC,CAAA,IAAK,EAAE,eAAe;YACtE;QACF;IACF;IAEA,6DAA6D;IAC7D,MAAM,eAAe,QAAQ,cAAc,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK,QAAQ,EAAE;IACjF,IAAI,aAAa,MAAM,GAAG,GAAG;QAC3B,SAAS,IAAI,CAAC;YACZ,MAAM,+BAA+B,oBAAoB;YACzD,SAAS;YACT,SAAS;gBACP,YAAY,aAAa,MAAM;gBAC/B,UAAU,aAAa,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI;YACpD;QACF;IACF;IAEA,OAAO;AACT;AAKO,SAAS,wBACd,KAA2B,EAC3B,OAA0B;IAE1B,MAAM,SAA4B,EAAE;IACpC,MAAM,WAAgC,EAAE;IAExC,qBAAqB;IACrB,OAAO,IAAI,IAAI,uBAAuB;IAEtC,4CAA4C;IAC5C,IAAI,OAAO,MAAM,GAAG,GAAG;QACrB,OAAO;YAAE,SAAS;YAAO;YAAQ;QAAS;IAC5C;IAEA,qBAAqB;IACrB,OAAO,IAAI,IAAI,uBAAuB,OAAO;IAE7C,wBAAwB;IACxB,OAAO,IAAI,IAAI,0BAA0B,OAAO;IAEhD,6BAA6B;IAC7B,SAAS,IAAI,IAAI,cAAc,OAAO;IAEtC,OAAO;QACL,SAAS,OAAO,MAAM,KAAK;QAC3B;QACA;IACF;AACF;AAEA,2CAA2C;AAC3C,oBAAoB;AACpB,2CAA2C;AAE3C;;CAEC,GACD,SAAS,gBAAgB,GAAW;IAClC,OAAO,IACJ,WAAW,GACX,SAAS,CAAC,OACV,OAAO,CAAC,oBAAoB,IAAI,oBAAoB;KACpD,OAAO,CAAC,MAAM,KACd,OAAO,CAAC,gBAAgB,IACxB,IAAI;AACT;AAEA;;CAEC,GACD,SAAS,oBAAoB,IAAY,EAAE,IAAY;IACrD,MAAM,SAAS,IAAI,IAAI,KAAK,KAAK,CAAC,OAAO,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,GAAG;IAChE,MAAM,SAAS,IAAI,IAAI,KAAK,KAAK,CAAC,OAAO,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,GAAG;IAEhE,IAAI,OAAO,IAAI,KAAK,KAAK,OAAO,IAAI,KAAK,GAAG,OAAO;IACnD,IAAI,OAAO,IAAI,KAAK,KAAK,OAAO,IAAI,KAAK,GAAG,OAAO;IAEnD,MAAM,eAAe,IAAI,IAAI;WAAI;KAAO,CAAC,MAAM,CAAC,CAAA,IAAK,OAAO,GAAG,CAAC;IAChE,MAAM,QAAQ,IAAI,IAAI;WAAI;WAAW;KAAO;IAE5C,OAAO,aAAa,IAAI,GAAG,MAAM,IAAI;AACvC;AAKO,SAAS,0BACd,eAAuB,EACvB,cAA8B,EAC9B,QAAQ,CAAC;IAET,MAAM,kBAAkB,gBAAgB;IAExC,MAAM,SAAS,eAAe,GAAG,CAAC,CAAA,MAAO,CAAC;YACxC,UAAU;YACV,OAAO,oBAAoB,iBAAiB,gBAAgB,IAAI,IAAI;QACtE,CAAC;IAED,OAAO,OACJ,MAAM,CAAC,CAAA,IAAK,EAAE,KAAK,GAAG,KACtB,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,KAAK,GAAG,EAAE,KAAK,EAChC,KAAK,CAAC,GAAG;AACd;AAKO,SAAS,wBACd,QAA+B;IAE/B,MAAM,UAAU,IAAI;IAEpB,KAAK,MAAM,WAAW,SAAU;QAC9B,MAAM,WAAW,QAAQ,GAAG,CAAC,QAAQ,SAAS,KAAK,EAAE;QACrD,SAAS,IAAI,CAAC;QACd,QAAQ,GAAG,CAAC,QAAQ,SAAS,EAAE;IACjC;IAEA,OAAO,MAAM,IAAI,CAAC,QAAQ,OAAO,IAC9B,MAAM,CAAC,CAAC,GAAG,SAAS,GAAK,SAAS,MAAM,GAAG,GAC3C,GAAG,CAAC,CAAC,CAAC,WAAW,SAAS,GAAK,CAAC;YAAE;YAAW;QAAS,CAAC;AAC5D;AAqBO,SAAS,sBACd,MAA8B,EAC9B,OAA0B;IAE1B,MAAM,QAAgC,EAAE;IACxC,MAAM,UAA6E,EAAE;IACrF,MAAM,eAAsF,EAAE;IAE9F,+CAA+C;IAC/C,MAAM,aAAa,IAAI;IAEvB,KAAK,MAAM,SAAS,OAAQ;QAC1B,kCAAkC;QAClC,IAAI,MAAM,mBAAmB,IAAI,WAAW,GAAG,CAAC,MAAM,mBAAmB,GAAG;YAC1E,QAAQ,IAAI,CAAC;gBACX;gBACA,QAAQ;oBAAC;wBACP,MAAM,6BAA6B,2BAA2B;wBAC9D,OAAO;wBACP,SAAS;oBACX;iBAAE;YACJ;YACA;QACF;QAEA,IAAI,MAAM,mBAAmB,EAAE;YAC7B,WAAW,GAAG,CAAC,MAAM,mBAAmB;QAC1C;QAEA,MAAM,SAAS,wBAAwB,OAAO;QAE9C,IAAI,CAAC,OAAO,OAAO,EAAE;YACnB,QAAQ,IAAI,CAAC;gBAAE;gBAAO,QAAQ,OAAO,MAAM;YAAC;QAC9C,OAAO;YACL,MAAM,IAAI,CAAC;YACX,IAAI,OAAO,QAAQ,CAAC,MAAM,GAAG,GAAG;gBAC9B,aAAa,IAAI,CAAC;oBAAE;oBAAO,UAAU,OAAO,QAAQ;gBAAC;YACvD;QACF;IACF;IAEA,OAAO;QACL;QACA;QACA;QACA,SAAS;YACP,OAAO,OAAO,MAAM;YACpB,YAAY,MAAM,MAAM;YACxB,cAAc,QAAQ,MAAM;YAC5B,cAAc,aAAa,MAAM;QACnC;IACF;AACF"}},
    {"offset": {"line": 1434, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/validation/brand-mapping-validation.ts"],"sourcesContent":["import type { SystemId } from '@/lib/id-types';\r\nimport type { PkgxBrandMapping, PkgxBrand } from '../types';\r\n\r\n// ========================================\r\n// Validation Types\r\n// ========================================\r\n\r\nexport interface BrandValidationResult {\r\n  isValid: boolean;\r\n  errors: BrandValidationError[];\r\n  warnings: BrandValidationWarning[];\r\n}\r\n\r\nexport interface BrandValidationError {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface BrandValidationWarning {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface BrandMappingInput {\r\n  hrmBrandSystemId: SystemId | string;\r\n  hrmBrandName: string;\r\n  pkgxBrandId: number | string;\r\n  pkgxBrandName: string;\r\n}\r\n\r\n// ========================================\r\n// Error Codes\r\n// ========================================\r\n\r\nexport const BRAND_MAPPING_ERROR_CODES = {\r\n  // Required field errors\r\n  HRM_BRAND_REQUIRED: 'HRM_BRAND_REQUIRED',\r\n  PKGX_BRAND_REQUIRED: 'PKGX_BRAND_REQUIRED',\r\n  \r\n  // Duplicate/conflict errors\r\n  HRM_BRAND_ALREADY_MAPPED: 'HRM_BRAND_ALREADY_MAPPED',\r\n  PKGX_BRAND_ALREADY_MAPPED: 'PKGX_BRAND_ALREADY_MAPPED',\r\n  \r\n  // Not found errors\r\n  HRM_BRAND_NOT_FOUND: 'HRM_BRAND_NOT_FOUND',\r\n  PKGX_BRAND_NOT_FOUND: 'PKGX_BRAND_NOT_FOUND',\r\n  \r\n  // Inactive/deleted errors\r\n  HRM_BRAND_INACTIVE: 'HRM_BRAND_INACTIVE',\r\n} as const;\r\n\r\nexport const BRAND_MAPPING_WARNING_CODES = {\r\n  // Suggestions\r\n  SAME_NAME_AVAILABLE: 'SAME_NAME_AVAILABLE',\r\n  NAME_MISMATCH: 'NAME_MISMATCH',\r\n  MANY_TO_ONE_MAPPING: 'MANY_TO_ONE_MAPPING',\r\n} as const;\r\n\r\n// ========================================\r\n// Error Messages (Vietnamese)\r\n// ========================================\r\n\r\nexport const BRAND_MAPPING_ERROR_MESSAGES: Record<string, string> = {\r\n  [BRAND_MAPPING_ERROR_CODES.HRM_BRAND_REQUIRED]: 'Vui lòng chọn thương hiệu HRM',\r\n  [BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_REQUIRED]: 'Vui lòng chọn thương hiệu PKGX',\r\n  [BRAND_MAPPING_ERROR_CODES.HRM_BRAND_ALREADY_MAPPED]: 'Thương hiệu HRM này đã được mapping với thương hiệu PKGX khác',\r\n  [BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_ALREADY_MAPPED]: 'Thương hiệu PKGX này đã được mapping với thương hiệu HRM khác',\r\n  [BRAND_MAPPING_ERROR_CODES.HRM_BRAND_NOT_FOUND]: 'Không tìm thấy thương hiệu HRM trong hệ thống',\r\n  [BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_NOT_FOUND]: 'Không tìm thấy thương hiệu PKGX (có thể đã bị xóa trên PKGX)',\r\n  [BRAND_MAPPING_ERROR_CODES.HRM_BRAND_INACTIVE]: 'Thương hiệu HRM đã bị vô hiệu hóa hoặc xóa',\r\n};\r\n\r\nexport const BRAND_MAPPING_WARNING_MESSAGES: Record<string, string> = {\r\n  [BRAND_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE]: 'Có thương hiệu PKGX trùng tên, có thể bạn muốn chọn thương hiệu đó',\r\n  [BRAND_MAPPING_WARNING_CODES.NAME_MISMATCH]: 'Tên thương hiệu HRM và PKGX khác nhau đáng kể',\r\n  [BRAND_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING]: 'Nhiều thương hiệu HRM đang mapping tới cùng một thương hiệu PKGX',\r\n};\r\n\r\n// ========================================\r\n// Validation Context\r\n// ========================================\r\n\r\nexport interface BrandValidationContext {\r\n  existingMappings: PkgxBrandMapping[];\r\n  hrmBrands: Array<{\r\n    systemId: SystemId;\r\n    name: string;\r\n    status?: string;\r\n    isActive?: boolean;\r\n  }>;\r\n  pkgxBrands: PkgxBrand[];\r\n  editingMappingId?: string;\r\n}\r\n\r\n// ========================================\r\n// Validation Functions\r\n// ========================================\r\n\r\n/**\r\n * Validate required fields\r\n */\r\nexport function validateRequiredFields(input: BrandMappingInput): BrandValidationError[] {\r\n  const errors: BrandValidationError[] = [];\r\n\r\n  if (!input.hrmBrandSystemId) {\r\n    errors.push({\r\n      code: BRAND_MAPPING_ERROR_CODES.HRM_BRAND_REQUIRED,\r\n      field: 'hrmBrandSystemId',\r\n      message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.HRM_BRAND_REQUIRED],\r\n    });\r\n  }\r\n\r\n  if (!input.pkgxBrandId) {\r\n    errors.push({\r\n      code: BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_REQUIRED,\r\n      field: 'pkgxBrandId',\r\n      message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_REQUIRED],\r\n    });\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate brand exists\r\n */\r\nexport function validateBrandExists(\r\n  input: BrandMappingInput,\r\n  context: BrandValidationContext\r\n): BrandValidationError[] {\r\n  const errors: BrandValidationError[] = [];\r\n\r\n  if (input.hrmBrandSystemId) {\r\n    const hrmBrand = context.hrmBrands.find(b => b.systemId === input.hrmBrandSystemId);\r\n    if (!hrmBrand) {\r\n      errors.push({\r\n        code: BRAND_MAPPING_ERROR_CODES.HRM_BRAND_NOT_FOUND,\r\n        field: 'hrmBrandSystemId',\r\n        message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.HRM_BRAND_NOT_FOUND],\r\n        details: { systemId: input.hrmBrandSystemId },\r\n      });\r\n    } else if (hrmBrand.status === 'inactive' || hrmBrand.isActive === false) {\r\n      errors.push({\r\n        code: BRAND_MAPPING_ERROR_CODES.HRM_BRAND_INACTIVE,\r\n        field: 'hrmBrandSystemId',\r\n        message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.HRM_BRAND_INACTIVE],\r\n        details: { systemId: input.hrmBrandSystemId, name: hrmBrand.name },\r\n      });\r\n    }\r\n  }\r\n\r\n  if (input.pkgxBrandId) {\r\n    const pkgxBrand = context.pkgxBrands.find(b => b.id === input.pkgxBrandId);\r\n    if (!pkgxBrand) {\r\n      errors.push({\r\n        code: BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_NOT_FOUND,\r\n        field: 'pkgxBrandId',\r\n        message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_NOT_FOUND],\r\n        details: { pkgxBrandId: input.pkgxBrandId },\r\n      });\r\n    }\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate duplicate mappings\r\n */\r\nexport function validateDuplicateMappings(\r\n  input: BrandMappingInput,\r\n  context: BrandValidationContext\r\n): BrandValidationError[] {\r\n  const errors: BrandValidationError[] = [];\r\n\r\n  if (input.hrmBrandSystemId) {\r\n    const existingHrmMapping = context.existingMappings.find(\r\n      m => m.hrmBrandSystemId === input.hrmBrandSystemId && m.id !== context.editingMappingId\r\n    );\r\n    if (existingHrmMapping) {\r\n      errors.push({\r\n        code: BRAND_MAPPING_ERROR_CODES.HRM_BRAND_ALREADY_MAPPED,\r\n        field: 'hrmBrandSystemId',\r\n        message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.HRM_BRAND_ALREADY_MAPPED],\r\n        details: {\r\n          existingMapping: existingHrmMapping,\r\n          mappedTo: existingHrmMapping.pkgxBrandName,\r\n        },\r\n      });\r\n    }\r\n  }\r\n  \r\n  return errors;\r\n}\r\n\r\n/**\r\n * Check for warnings (không block nhưng cảnh báo)\r\n */\r\nexport function checkWarnings(\r\n  input: BrandMappingInput,\r\n  context: BrandValidationContext\r\n): BrandValidationWarning[] {\r\n  const warnings: BrandValidationWarning[] = [];\r\n\r\n  if (!input.hrmBrandSystemId || !input.pkgxBrandId) {\r\n    return warnings;\r\n  }\r\n\r\n  const hrmBrand = context.hrmBrands.find(b => b.systemId === input.hrmBrandSystemId);\r\n  const pkgxBrand = context.pkgxBrands.find(b => b.id === input.pkgxBrandId);\r\n\r\n  if (!hrmBrand || !pkgxBrand) return warnings;\r\n\r\n  // 1. Check name mismatch\r\n  const normalizedHrmName = normalizeString(hrmBrand.name);\r\n  const normalizedPkgxName = normalizeString(pkgxBrand.name);\r\n  const similarity = calculateSimilarity(normalizedHrmName, normalizedPkgxName);\r\n  \r\n  if (similarity < 0.5) {\r\n    warnings.push({\r\n      code: BRAND_MAPPING_WARNING_CODES.NAME_MISMATCH,\r\n      message: BRAND_MAPPING_WARNING_MESSAGES[BRAND_MAPPING_WARNING_CODES.NAME_MISMATCH],\r\n      details: { \r\n        hrmName: hrmBrand.name, \r\n        pkgxName: pkgxBrand.name,\r\n        similarity: Math.round(similarity * 100) + '%',\r\n      },\r\n    });\r\n  }\r\n\r\n  // 2. Check if same name exists in PKGX\r\n  const sameNamePkgx = context.pkgxBrands.find(\r\n    b => b.id !== input.pkgxBrandId && normalizeString(b.name) === normalizedHrmName\r\n  );\r\n  if (sameNamePkgx) {\r\n    warnings.push({\r\n      code: BRAND_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE,\r\n      message: BRAND_MAPPING_WARNING_MESSAGES[BRAND_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE],\r\n      details: {\r\n        suggestedBrand: sameNamePkgx,\r\n      },\r\n    });\r\n  }\r\n\r\n  // 3. Check many-to-one mapping\r\n  const otherMappingsToSamePkgx = context.existingMappings.filter(\r\n    m => m.pkgxBrandId === input.pkgxBrandId && m.id !== context.editingMappingId\r\n  );\r\n  if (otherMappingsToSamePkgx.length > 0) {\r\n    warnings.push({\r\n      code: BRAND_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING,\r\n      message: BRAND_MAPPING_WARNING_MESSAGES[BRAND_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING],\r\n      details: {\r\n        count: otherMappingsToSamePkgx.length + 1,\r\n        existingMappings: otherMappingsToSamePkgx.map(m => m.hrmBrandName),\r\n      },\r\n    });\r\n  }\r\n\r\n  return warnings;\r\n}\r\n\r\n/**\r\n * Main validation function\r\n */\r\nexport function validateBrandMapping(\r\n  input: BrandMappingInput,\r\n  context: BrandValidationContext\r\n): BrandValidationResult {\r\n  const errors: BrandValidationError[] = [];\r\n  const warnings: BrandValidationWarning[] = [];\r\n\r\n  // 1. Required fields\r\n  errors.push(...validateRequiredFields(input));\r\n\r\n  // If required fields are missing, stop here\r\n  if (errors.length > 0) {\r\n    return { isValid: false, errors, warnings };\r\n  }\r\n\r\n  // 2. Brand exists\r\n  errors.push(...validateBrandExists(input, context));\r\n\r\n  // 3. Duplicate mappings\r\n  errors.push(...validateDuplicateMappings(input, context));\r\n\r\n  // 4. Warnings (non-blocking)\r\n  warnings.push(...checkWarnings(input, context));\r\n\r\n  return {\r\n    isValid: errors.length === 0,\r\n    errors,\r\n    warnings,\r\n  };\r\n}\r\n\r\n// ========================================\r\n// Utility Functions\r\n// ========================================\r\n\r\n/**\r\n * Normalize string for comparison\r\n */\r\nfunction normalizeString(str: string): string {\r\n  return str\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '')\r\n    .replace(/đ/g, 'd')\r\n    .replace(/[^a-z0-9\\s]/g, '')\r\n    .trim();\r\n}\r\n\r\n/**\r\n * Calculate string similarity (Jaccard index)\r\n */\r\nfunction calculateSimilarity(str1: string, str2: string): number {\r\n  const words1 = new Set(str1.split(/\\s+/).filter(w => w.length > 0));\r\n  const words2 = new Set(str2.split(/\\s+/).filter(w => w.length > 0));\r\n  \r\n  if (words1.size === 0 && words2.size === 0) return 1;\r\n  if (words1.size === 0 || words2.size === 0) return 0;\r\n  \r\n  const intersection = new Set([...words1].filter(x => words2.has(x)));\r\n  const union = new Set([...words1, ...words2]);\r\n  \r\n  return intersection.size / union.size;\r\n}\r\n\r\n/**\r\n * Suggest matching brands based on name\r\n */\r\nexport function suggestMatchingBrands(\r\n  hrmBrandName: string,\r\n  pkgxBrands: PkgxBrand[],\r\n  limit = 5\r\n): Array<{ brand: PkgxBrand; score: number }> {\r\n  const normalizedInput = normalizeString(hrmBrandName);\r\n  \r\n  const scored = pkgxBrands.map(brand => ({\r\n    brand,\r\n    score: calculateSimilarity(normalizedInput, normalizeString(brand.name)),\r\n  }));\r\n  \r\n  return scored\r\n    .filter(s => s.score > 0.2)\r\n    .sort((a, b) => b.score - a.score)\r\n    .slice(0, limit);\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1674, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/validation/product-mapping-validation.ts"],"sourcesContent":["import type { SystemId } from '@/lib/id-types';\r\nimport type { PkgxProduct } from '../types';\r\n\r\n// ========================================\r\n// Validation Types\r\n// ========================================\r\n\r\nexport interface ProductValidationResult {\r\n  isValid: boolean;\r\n  errors: ProductValidationError[];\r\n  warnings: ProductValidationWarning[];\r\n}\r\n\r\nexport interface ProductValidationError {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface ProductValidationWarning {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface ProductMappingInput {\r\n  hrmProductSystemId: SystemId | string;\r\n  hrmProductName: string;\r\n  hrmProductSku?: string;\r\n  pkgxProductId: number | string;\r\n  pkgxProductName: string;\r\n  pkgxProductSku?: string;\r\n}\r\n\r\n// ========================================\r\n// Error Codes\r\n// ========================================\r\n\r\nexport const PRODUCT_MAPPING_ERROR_CODES = {\r\n  // Required field errors\r\n  HRM_PRODUCT_REQUIRED: 'HRM_PRODUCT_REQUIRED',\r\n  PKGX_PRODUCT_REQUIRED: 'PKGX_PRODUCT_REQUIRED',\r\n  \r\n  // Duplicate/conflict errors\r\n  HRM_PRODUCT_ALREADY_LINKED: 'HRM_PRODUCT_ALREADY_LINKED',\r\n  PKGX_PRODUCT_ALREADY_LINKED: 'PKGX_PRODUCT_ALREADY_LINKED',\r\n  \r\n  // Not found errors\r\n  HRM_PRODUCT_NOT_FOUND: 'HRM_PRODUCT_NOT_FOUND',\r\n  PKGX_PRODUCT_NOT_FOUND: 'PKGX_PRODUCT_NOT_FOUND',\r\n  \r\n  // Inactive/deleted errors\r\n  HRM_PRODUCT_INACTIVE: 'HRM_PRODUCT_INACTIVE',\r\n} as const;\r\n\r\nexport const PRODUCT_MAPPING_WARNING_CODES = {\r\n  // Suggestions\r\n  SKU_MATCH_AVAILABLE: 'SKU_MATCH_AVAILABLE',\r\n  NAME_MISMATCH: 'NAME_MISMATCH',\r\n  SKU_MISMATCH: 'SKU_MISMATCH',\r\n} as const;\r\n\r\n// ========================================\r\n// Error Messages (Vietnamese)\r\n// ========================================\r\n\r\nexport const PRODUCT_MAPPING_ERROR_MESSAGES: Record<string, string> = {\r\n  [PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_REQUIRED]: 'Vui lòng chọn sản phẩm HRM',\r\n  [PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_REQUIRED]: 'Vui lòng chọn sản phẩm PKGX',\r\n  [PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_ALREADY_LINKED]: 'Sản phẩm HRM này đã được liên kết với sản phẩm PKGX khác',\r\n  [PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_ALREADY_LINKED]: 'Sản phẩm PKGX này đã được liên kết với sản phẩm HRM khác',\r\n  [PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_NOT_FOUND]: 'Không tìm thấy sản phẩm HRM trong hệ thống',\r\n  [PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_NOT_FOUND]: 'Không tìm thấy sản phẩm PKGX (có thể đã bị xóa trên PKGX)',\r\n  [PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_INACTIVE]: 'Sản phẩm HRM đã bị vô hiệu hóa hoặc xóa',\r\n};\r\n\r\nexport const PRODUCT_MAPPING_WARNING_MESSAGES: Record<string, string> = {\r\n  [PRODUCT_MAPPING_WARNING_CODES.SKU_MATCH_AVAILABLE]: 'Có sản phẩm HRM có SKU trùng khớp, có thể bạn muốn chọn sản phẩm đó',\r\n  [PRODUCT_MAPPING_WARNING_CODES.NAME_MISMATCH]: 'Tên sản phẩm HRM và PKGX khác nhau đáng kể',\r\n  [PRODUCT_MAPPING_WARNING_CODES.SKU_MISMATCH]: 'Mã SKU của sản phẩm HRM và PKGX không khớp',\r\n};\r\n\r\n// ========================================\r\n// Validation Context\r\n// ========================================\r\n\r\nexport interface ProductValidationContext {\r\n  hrmProducts: Array<{\r\n    systemId: SystemId;\r\n    name: string;\r\n    id: string; // SKU\r\n    pkgxId?: number;\r\n    status?: string;\r\n    isActive?: boolean;\r\n  }>;\r\n  pkgxProducts: PkgxProduct[];\r\n  editingProductId?: string; // HRM systemId đang edit\r\n}\r\n\r\n// ========================================\r\n// Validation Functions\r\n// ========================================\r\n\r\n/**\r\n * Validate required fields\r\n */\r\nexport function validateRequiredFields(input: ProductMappingInput): ProductValidationError[] {\r\n  const errors: ProductValidationError[] = [];\r\n\r\n  if (!input.hrmProductSystemId) {\r\n    errors.push({\r\n      code: PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_REQUIRED,\r\n      field: 'hrmProductSystemId',\r\n      message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_REQUIRED],\r\n    });\r\n  }\r\n\r\n  if (!input.pkgxProductId) {\r\n    errors.push({\r\n      code: PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_REQUIRED,\r\n      field: 'pkgxProductId',\r\n      message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_REQUIRED],\r\n    });\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate product exists\r\n */\r\nexport function validateProductExists(\r\n  input: ProductMappingInput,\r\n  context: ProductValidationContext\r\n): ProductValidationError[] {\r\n  const errors: ProductValidationError[] = [];\r\n\r\n  if (input.hrmProductSystemId) {\r\n    const hrmProduct = context.hrmProducts.find(p => p.systemId === input.hrmProductSystemId);\r\n    if (!hrmProduct) {\r\n      errors.push({\r\n        code: PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_NOT_FOUND,\r\n        field: 'hrmProductSystemId',\r\n        message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_NOT_FOUND],\r\n        details: { systemId: input.hrmProductSystemId },\r\n      });\r\n    } else if (hrmProduct.status === 'inactive' || hrmProduct.isActive === false) {\r\n      errors.push({\r\n        code: PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_INACTIVE,\r\n        field: 'hrmProductSystemId',\r\n        message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_INACTIVE],\r\n        details: { systemId: input.hrmProductSystemId, name: hrmProduct.name },\r\n      });\r\n    }\r\n  }\r\n\r\n  if (input.pkgxProductId) {\r\n    const pkgxProduct = context.pkgxProducts.find(p => p.goods_id === input.pkgxProductId);\r\n    if (!pkgxProduct) {\r\n      errors.push({\r\n        code: PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_NOT_FOUND,\r\n        field: 'pkgxProductId',\r\n        message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_NOT_FOUND],\r\n        details: { pkgxProductId: input.pkgxProductId },\r\n      });\r\n    }\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate duplicate links\r\n */\r\nexport function validateDuplicateLinks(\r\n  input: ProductMappingInput,\r\n  context: ProductValidationContext\r\n): ProductValidationError[] {\r\n  const errors: ProductValidationError[] = [];\r\n\r\n  if (input.hrmProductSystemId) {\r\n    const hrmProduct = context.hrmProducts.find(p => p.systemId === input.hrmProductSystemId);\r\n    // Check if HRM product already linked to another PKGX product\r\n    if (hrmProduct?.pkgxId && hrmProduct.pkgxId !== input.pkgxProductId && hrmProduct.systemId !== context.editingProductId) {\r\n      errors.push({\r\n        code: PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_ALREADY_LINKED,\r\n        field: 'hrmProductSystemId',\r\n        message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_ALREADY_LINKED],\r\n        details: {\r\n          linkedTo: hrmProduct.pkgxId,\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  if (input.pkgxProductId) {\r\n    // Check if PKGX product already linked to another HRM product\r\n    const linkedHrmProduct = context.hrmProducts.find(\r\n      p => p.pkgxId === input.pkgxProductId && p.systemId !== input.hrmProductSystemId\r\n    );\r\n    if (linkedHrmProduct) {\r\n      errors.push({\r\n        code: PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_ALREADY_LINKED,\r\n        field: 'pkgxProductId',\r\n        message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_ALREADY_LINKED],\r\n        details: {\r\n          linkedTo: linkedHrmProduct.name,\r\n          linkedSystemId: linkedHrmProduct.systemId,\r\n        },\r\n      });\r\n    }\r\n  }\r\n  \r\n  return errors;\r\n}\r\n\r\n/**\r\n * Check for warnings (không block nhưng cảnh báo)\r\n */\r\nexport function checkWarnings(\r\n  input: ProductMappingInput,\r\n  context: ProductValidationContext\r\n): ProductValidationWarning[] {\r\n  const warnings: ProductValidationWarning[] = [];\r\n\r\n  if (!input.hrmProductSystemId || !input.pkgxProductId) {\r\n    return warnings;\r\n  }\r\n\r\n  const hrmProduct = context.hrmProducts.find(p => p.systemId === input.hrmProductSystemId);\r\n  const pkgxProduct = context.pkgxProducts.find(p => p.goods_id === input.pkgxProductId);\r\n\r\n  if (!hrmProduct || !pkgxProduct) return warnings;\r\n\r\n  // 1. Check name mismatch\r\n  const normalizedHrmName = normalizeString(hrmProduct.name);\r\n  const normalizedPkgxName = normalizeString(pkgxProduct.goods_name);\r\n  const similarity = calculateSimilarity(normalizedHrmName, normalizedPkgxName);\r\n  \r\n  if (similarity < 0.3) {\r\n    warnings.push({\r\n      code: PRODUCT_MAPPING_WARNING_CODES.NAME_MISMATCH,\r\n      message: PRODUCT_MAPPING_WARNING_MESSAGES[PRODUCT_MAPPING_WARNING_CODES.NAME_MISMATCH],\r\n      details: { \r\n        hrmName: hrmProduct.name, \r\n        pkgxName: pkgxProduct.goods_name,\r\n        similarity: Math.round(similarity * 100) + '%',\r\n      },\r\n    });\r\n  }\r\n\r\n  // 2. Check SKU mismatch\r\n  if (hrmProduct.id && pkgxProduct.goods_sn && hrmProduct.id !== pkgxProduct.goods_sn) {\r\n    warnings.push({\r\n      code: PRODUCT_MAPPING_WARNING_CODES.SKU_MISMATCH,\r\n      message: PRODUCT_MAPPING_WARNING_MESSAGES[PRODUCT_MAPPING_WARNING_CODES.SKU_MISMATCH],\r\n      details: {\r\n        hrmSku: hrmProduct.id,\r\n        pkgxSku: pkgxProduct.goods_sn,\r\n      },\r\n    });\r\n  }\r\n\r\n  return warnings;\r\n}\r\n\r\n/**\r\n * Main validation function\r\n */\r\nexport function validateProductMapping(\r\n  input: ProductMappingInput,\r\n  context: ProductValidationContext\r\n): ProductValidationResult {\r\n  const errors: ProductValidationError[] = [];\r\n  const warnings: ProductValidationWarning[] = [];\r\n\r\n  // 1. Required fields\r\n  errors.push(...validateRequiredFields(input));\r\n\r\n  // If required fields are missing, stop here\r\n  if (errors.length > 0) {\r\n    return { isValid: false, errors, warnings };\r\n  }\r\n\r\n  // 2. Product exists\r\n  errors.push(...validateProductExists(input, context));\r\n\r\n  // 3. Duplicate links\r\n  errors.push(...validateDuplicateLinks(input, context));\r\n\r\n  // 4. Warnings (non-blocking)\r\n  warnings.push(...checkWarnings(input, context));\r\n\r\n  return {\r\n    isValid: errors.length === 0,\r\n    errors,\r\n    warnings,\r\n  };\r\n}\r\n\r\n// ========================================\r\n// Utility Functions\r\n// ========================================\r\n\r\n/**\r\n * Normalize string for comparison\r\n */\r\nfunction normalizeString(str: string): string {\r\n  return str\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '')\r\n    .replace(/đ/g, 'd')\r\n    .replace(/[^a-z0-9\\s]/g, '')\r\n    .trim();\r\n}\r\n\r\n/**\r\n * Calculate string similarity (Jaccard index)\r\n */\r\nfunction calculateSimilarity(str1: string, str2: string): number {\r\n  const words1 = new Set(str1.split(/\\s+/).filter(w => w.length > 0));\r\n  const words2 = new Set(str2.split(/\\s+/).filter(w => w.length > 0));\r\n  \r\n  if (words1.size === 0 && words2.size === 0) return 1;\r\n  if (words1.size === 0 || words2.size === 0) return 0;\r\n  \r\n  const intersection = new Set([...words1].filter(x => words2.has(x)));\r\n  const union = new Set([...words1, ...words2]);\r\n  \r\n  return intersection.size / union.size;\r\n}\r\n\r\n/**\r\n * Suggest matching HRM products based on PKGX product name/SKU\r\n */\r\nexport function suggestMatchingProducts(\r\n  pkgxProduct: { goods_name: string; goods_sn?: string },\r\n  hrmProducts: Array<{ systemId: SystemId; name: string; id: string; pkgxId?: number }>,\r\n  limit = 5\r\n): Array<{ product: typeof hrmProducts[0]; score: number; matchType: 'sku' | 'name' }> {\r\n  const results: Array<{ product: typeof hrmProducts[0]; score: number; matchType: 'sku' | 'name' }> = [];\r\n  \r\n  // Filter out already linked products\r\n  const availableProducts = hrmProducts.filter(p => !p.pkgxId);\r\n  \r\n  // 1. SKU exact match (highest priority)\r\n  if (pkgxProduct.goods_sn) {\r\n    const skuMatch = availableProducts.find(p => p.id === pkgxProduct.goods_sn);\r\n    if (skuMatch) {\r\n      results.push({ product: skuMatch, score: 1, matchType: 'sku' });\r\n    }\r\n  }\r\n  \r\n  // 2. Name similarity\r\n  const normalizedPkgxName = normalizeString(pkgxProduct.goods_name);\r\n  \r\n  const scored = availableProducts\r\n    .filter(p => !results.some(r => r.product.systemId === p.systemId))\r\n    .map(product => ({\r\n      product,\r\n      score: calculateSimilarity(normalizedPkgxName, normalizeString(product.name)),\r\n      matchType: 'name' as const,\r\n    }))\r\n    .filter(s => s.score > 0.2);\r\n  \r\n  results.push(...scored);\r\n  \r\n  return results\r\n    .sort((a, b) => b.score - a.score)\r\n    .slice(0, limit);\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1934, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/validation/index.ts"],"sourcesContent":["// Category Mapping Validation\r\nexport {\r\n  // Types\r\n  type ValidationResult,\r\n  type ValidationError,\r\n  type ValidationWarning,\r\n  type CategoryMappingInput,\r\n  type ValidationContext,\r\n  type BatchValidationResult,\r\n  \r\n  // Error/Warning codes\r\n  CATEGORY_MAPPING_ERROR_CODES,\r\n  CATEGORY_MAPPING_WARNING_CODES,\r\n  CATEGORY_MAPPING_ERROR_MESSAGES,\r\n  CATEGORY_MAPPING_WARNING_MESSAGES,\r\n  \r\n  // Validation functions\r\n  validateCategoryMapping,\r\n  validateRequiredFields,\r\n  validateCategoryExists,\r\n  validateDuplicateMappings,\r\n  checkWarnings,\r\n  validateBatchMappings,\r\n  \r\n  // Utilities\r\n  suggestMatchingCategories,\r\n  findPotentialDuplicates,\r\n} from './category-mapping-validation';\r\n\r\n// Brand Mapping Validation\r\nexport {\r\n  // Types\r\n  type BrandValidationResult,\r\n  type BrandValidationError,\r\n  type BrandValidationWarning,\r\n  type BrandMappingInput,\r\n  type BrandValidationContext,\r\n  \r\n  // Error/Warning codes\r\n  BRAND_MAPPING_ERROR_CODES,\r\n  BRAND_MAPPING_WARNING_CODES,\r\n  BRAND_MAPPING_ERROR_MESSAGES,\r\n  BRAND_MAPPING_WARNING_MESSAGES,\r\n  \r\n  // Validation functions\r\n  validateBrandMapping,\r\n  validateRequiredFields as validateBrandRequiredFields,\r\n  validateBrandExists,\r\n  validateDuplicateMappings as validateBrandDuplicateMappings,\r\n  checkWarnings as checkBrandWarnings,\r\n  \r\n  // Utilities\r\n  suggestMatchingBrands,\r\n} from './brand-mapping-validation';\r\n\r\n// Product Mapping Validation\r\nexport {\r\n  // Types\r\n  type ProductValidationResult,\r\n  type ProductValidationError,\r\n  type ProductValidationWarning,\r\n  type ProductMappingInput,\r\n  type ProductValidationContext,\r\n  \r\n  // Error/Warning codes\r\n  PRODUCT_MAPPING_ERROR_CODES,\r\n  PRODUCT_MAPPING_WARNING_CODES,\r\n  PRODUCT_MAPPING_ERROR_MESSAGES,\r\n  PRODUCT_MAPPING_WARNING_MESSAGES,\r\n  \r\n  // Validation functions\r\n  validateProductMapping,\r\n  validateRequiredFields as validateProductRequiredFields,\r\n  validateProductExists,\r\n  validateDuplicateLinks,\r\n  checkWarnings as checkProductWarnings,\r\n  \r\n  // Utilities\r\n  suggestMatchingProducts,\r\n} from './product-mapping-validation';\r\n"],"names":[],"mappings":";AAAA,8BAA8B;AAC9B;AA4BA,2BAA2B;AAC3B;AAyBA,6BAA6B;AAC7B"}},
    {"offset": {"line": 1948, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/hooks/use-category-mapping-validation.ts"],"sourcesContent":["import * as React from 'react';\r\nimport type { SystemId } from '@/lib/id-types';\r\nimport type { PkgxCategoryMapping, PkgxCategory } from '../types';\r\nimport {\r\n  validateCategoryMapping,\r\n  suggestMatchingCategories,\r\n  type ValidationResult,\r\n  type ValidationContext,\r\n  type CategoryMappingInput,\r\n} from '../validation';\r\n\r\ninterface UseCategoryMappingValidationOptions {\r\n  existingMappings: PkgxCategoryMapping[];\r\n  hrmCategories: Array<{\r\n    systemId: SystemId;\r\n    name: string;\r\n    parentId?: SystemId;\r\n    status?: string;\r\n    isActive?: boolean;\r\n    path?: string;\r\n  }>;\r\n  pkgxCategories: PkgxCategory[];\r\n  editingMappingId?: string;\r\n  debounceMs?: number;\r\n}\r\n\r\ninterface UseCategoryMappingValidationReturn {\r\n  // Validation state\r\n  validationResult: ValidationResult | null;\r\n  isValidating: boolean;\r\n  \r\n  // Suggestions\r\n  suggestions: Array<{ category: PkgxCategory; score: number }>;\r\n  \r\n  // Actions\r\n  validate: (input: CategoryMappingInput) => ValidationResult;\r\n  validateAsync: (input: CategoryMappingInput) => Promise<ValidationResult>;\r\n  clearValidation: () => void;\r\n  \r\n  // Helpers\r\n  hasErrors: boolean;\r\n  hasWarnings: boolean;\r\n  getFieldError: (field: string) => string | undefined;\r\n  getFieldWarning: (field: string) => string | undefined;\r\n}\r\n\r\n/**\r\n * Hook để quản lý validation cho category mapping\r\n */\r\nexport function useCategoryMappingValidation(\r\n  options: UseCategoryMappingValidationOptions\r\n): UseCategoryMappingValidationReturn {\r\n  const {\r\n    existingMappings,\r\n    hrmCategories,\r\n    pkgxCategories,\r\n    editingMappingId,\r\n    debounceMs = 300,\r\n  } = options;\r\n\r\n  const [validationResult, setValidationResult] = React.useState<ValidationResult | null>(null);\r\n  const [isValidating, setIsValidating] = React.useState(false);\r\n  const [suggestions, setSuggestions] = React.useState<Array<{ category: PkgxCategory; score: number }>>([]);\r\n  \r\n  const debounceTimerRef = React.useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Create validation context\r\n  const context = React.useMemo((): ValidationContext => ({\r\n    existingMappings,\r\n    hrmCategories,\r\n    pkgxCategories,\r\n    editingMappingId,\r\n  }), [existingMappings, hrmCategories, pkgxCategories, editingMappingId]);\r\n\r\n  // Sync validation\r\n  const validate = React.useCallback((input: CategoryMappingInput): ValidationResult => {\r\n    const result = validateCategoryMapping(input, context);\r\n    setValidationResult(result);\r\n    \r\n    // Update suggestions based on HRM category name\r\n    if (input.hrmCategorySystemId) {\r\n      const hrmCat = hrmCategories.find(c => c.systemId === input.hrmCategorySystemId);\r\n      if (hrmCat) {\r\n        const newSuggestions = suggestMatchingCategories(hrmCat.name, pkgxCategories);\r\n        setSuggestions(newSuggestions);\r\n      }\r\n    }\r\n    \r\n    return result;\r\n  }, [context, hrmCategories, pkgxCategories]);\r\n\r\n  // Async validation with debounce\r\n  const validateAsync = React.useCallback(async (input: CategoryMappingInput): Promise<ValidationResult> => {\r\n    return new Promise((resolve) => {\r\n      setIsValidating(true);\r\n      \r\n      if (debounceTimerRef.current) {\r\n        clearTimeout(debounceTimerRef.current);\r\n      }\r\n      \r\n      debounceTimerRef.current = setTimeout(() => {\r\n        const result = validate(input);\r\n        setIsValidating(false);\r\n        resolve(result);\r\n      }, debounceMs);\r\n    });\r\n  }, [validate, debounceMs]);\r\n\r\n  // Clear validation\r\n  const clearValidation = React.useCallback(() => {\r\n    setValidationResult(null);\r\n    setSuggestions([]);\r\n    if (debounceTimerRef.current) {\r\n      clearTimeout(debounceTimerRef.current);\r\n    }\r\n  }, []);\r\n\r\n  // Cleanup on unmount\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (debounceTimerRef.current) {\r\n        clearTimeout(debounceTimerRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Computed values\r\n  const hasErrors = validationResult ? validationResult.errors.length > 0 : false;\r\n  const hasWarnings = validationResult ? validationResult.warnings.length > 0 : false;\r\n\r\n  const getFieldError = React.useCallback((field: string): string | undefined => {\r\n    if (!validationResult) return undefined;\r\n    const error = validationResult.errors.find(e => e.field === field);\r\n    return error?.message;\r\n  }, [validationResult]);\r\n\r\n  const getFieldWarning = React.useCallback((field: string): string | undefined => {\r\n    if (!validationResult) return undefined;\r\n    const warning = validationResult.warnings.find(w => w.field === field);\r\n    return warning?.message;\r\n  }, [validationResult]);\r\n\r\n  return {\r\n    validationResult,\r\n    isValidating,\r\n    suggestions,\r\n    validate,\r\n    validateAsync,\r\n    clearValidation,\r\n    hasErrors,\r\n    hasWarnings,\r\n    getFieldError,\r\n    getFieldWarning,\r\n  };\r\n}\r\n\r\n/**\r\n * Hook đơn giản để validate một field\r\n */\r\nexport function useFieldValidation<T>(\r\n  validator: (value: T) => string | undefined,\r\n  initialValue?: T\r\n) {\r\n  const [error, setError] = React.useState<string | undefined>();\r\n  const [touched, setTouched] = React.useState(false);\r\n\r\n  const validate = React.useCallback((value: T) => {\r\n    const errorMessage = validator(value);\r\n    setError(errorMessage);\r\n    return !errorMessage;\r\n  }, [validator]);\r\n\r\n  const handleBlur = React.useCallback(() => {\r\n    setTouched(true);\r\n  }, []);\r\n\r\n  const reset = React.useCallback(() => {\r\n    setError(undefined);\r\n    setTouched(false);\r\n  }, []);\r\n\r\n  // Validate initial value\r\n  React.useEffect(() => {\r\n    if (initialValue !== undefined) {\r\n      validate(initialValue);\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    error: touched ? error : undefined,\r\n    touched,\r\n    validate,\r\n    handleBlur,\r\n    reset,\r\n    isValid: !error,\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2094, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/hooks/use-brand-mapping-validation.ts"],"sourcesContent":["import * as React from 'react';\r\nimport type { SystemId } from '@/lib/id-types';\r\nimport type { PkgxBrandMapping, PkgxBrand } from '../types';\r\nimport {\r\n  validateBrandMapping,\r\n  suggestMatchingBrands,\r\n  type BrandValidationResult,\r\n  type BrandValidationContext,\r\n  type BrandMappingInput,\r\n} from '../validation';\r\n\r\ninterface UseBrandMappingValidationOptions {\r\n  existingMappings: PkgxBrandMapping[];\r\n  hrmBrands: Array<{\r\n    systemId: SystemId;\r\n    name: string;\r\n    status?: string;\r\n    isActive?: boolean;\r\n  }>;\r\n  pkgxBrands: PkgxBrand[];\r\n  editingMappingId?: string;\r\n  debounceMs?: number;\r\n}\r\n\r\ninterface UseBrandMappingValidationReturn {\r\n  // Validation state\r\n  validationResult: BrandValidationResult | null;\r\n  isValidating: boolean;\r\n  \r\n  // Suggestions\r\n  suggestions: Array<{ brand: PkgxBrand; score: number }>;\r\n  \r\n  // Actions\r\n  validate: (input: BrandMappingInput) => BrandValidationResult;\r\n  validateAsync: (input: BrandMappingInput) => Promise<BrandValidationResult>;\r\n  clearValidation: () => void;\r\n  \r\n  // Helpers\r\n  hasErrors: boolean;\r\n  hasWarnings: boolean;\r\n  getFieldError: (field: string) => string | undefined;\r\n  getFieldWarning: (field: string) => string | undefined;\r\n}\r\n\r\n/**\r\n * Hook để quản lý validation cho brand mapping\r\n */\r\nexport function useBrandMappingValidation(\r\n  options: UseBrandMappingValidationOptions\r\n): UseBrandMappingValidationReturn {\r\n  const {\r\n    existingMappings,\r\n    hrmBrands,\r\n    pkgxBrands,\r\n    editingMappingId,\r\n    debounceMs = 300,\r\n  } = options;\r\n\r\n  const [validationResult, setValidationResult] = React.useState<BrandValidationResult | null>(null);\r\n  const [isValidating, setIsValidating] = React.useState(false);\r\n  const [suggestions, setSuggestions] = React.useState<Array<{ brand: PkgxBrand; score: number }>>([]);\r\n  \r\n  const debounceTimerRef = React.useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Create validation context\r\n  const context = React.useMemo((): BrandValidationContext => ({\r\n    existingMappings,\r\n    hrmBrands,\r\n    pkgxBrands,\r\n    editingMappingId,\r\n  }), [existingMappings, hrmBrands, pkgxBrands, editingMappingId]);\r\n\r\n  // Sync validation\r\n  const validate = React.useCallback((input: BrandMappingInput): BrandValidationResult => {\r\n    const result = validateBrandMapping(input, context);\r\n    setValidationResult(result);\r\n    \r\n    // Update suggestions based on HRM brand name\r\n    if (input.hrmBrandSystemId) {\r\n      const hrmBrand = hrmBrands.find(b => b.systemId === input.hrmBrandSystemId);\r\n      if (hrmBrand) {\r\n        const newSuggestions = suggestMatchingBrands(hrmBrand.name, pkgxBrands);\r\n        setSuggestions(newSuggestions);\r\n      }\r\n    }\r\n    \r\n    return result;\r\n  }, [context, hrmBrands, pkgxBrands]);\r\n\r\n  // Async validation with debounce\r\n  const validateAsync = React.useCallback(async (input: BrandMappingInput): Promise<BrandValidationResult> => {\r\n    return new Promise((resolve) => {\r\n      setIsValidating(true);\r\n      \r\n      if (debounceTimerRef.current) {\r\n        clearTimeout(debounceTimerRef.current);\r\n      }\r\n      \r\n      debounceTimerRef.current = setTimeout(() => {\r\n        const result = validate(input);\r\n        setIsValidating(false);\r\n        resolve(result);\r\n      }, debounceMs);\r\n    });\r\n  }, [validate, debounceMs]);\r\n\r\n  // Clear validation\r\n  const clearValidation = React.useCallback(() => {\r\n    setValidationResult(null);\r\n    setSuggestions([]);\r\n    if (debounceTimerRef.current) {\r\n      clearTimeout(debounceTimerRef.current);\r\n    }\r\n  }, []);\r\n\r\n  // Cleanup on unmount\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (debounceTimerRef.current) {\r\n        clearTimeout(debounceTimerRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Computed values\r\n  const hasErrors = validationResult ? validationResult.errors.length > 0 : false;\r\n  const hasWarnings = validationResult ? validationResult.warnings.length > 0 : false;\r\n\r\n  const getFieldError = React.useCallback((field: string): string | undefined => {\r\n    if (!validationResult) return undefined;\r\n    const error = validationResult.errors.find(e => e.field === field);\r\n    return error?.message;\r\n  }, [validationResult]);\r\n\r\n  const getFieldWarning = React.useCallback((field: string): string | undefined => {\r\n    if (!validationResult) return undefined;\r\n    const warning = validationResult.warnings.find(w => w.field === field);\r\n    return warning?.message;\r\n  }, [validationResult]);\r\n\r\n  return {\r\n    validationResult,\r\n    isValidating,\r\n    suggestions,\r\n    validate,\r\n    validateAsync,\r\n    clearValidation,\r\n    hasErrors,\r\n    hasWarnings,\r\n    getFieldError,\r\n    getFieldWarning,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAGA;AAAA;;;AA4CO,SAAS,0BACd,OAAyC;IAEzC,MAAM,EACJ,gBAAgB,EAChB,SAAS,EACT,UAAU,EACV,gBAAgB,EAChB,aAAa,GAAG,EACjB,GAAG;IAEJ,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,iNAAc,CAA+B;IAC7F,MAAM,CAAC,cAAc,gBAAgB,GAAG,iNAAc,CAAC;IACvD,MAAM,CAAC,aAAa,eAAe,GAAG,iNAAc,CAA6C,EAAE;IAEnG,MAAM,mBAAmB,+MAAY,CAAwB;IAE7D,4BAA4B;IAC5B,MAAM,UAAU,gNAAa,CAAC,IAA8B,CAAC;YAC3D;YACA;YACA;YACA;QACF,CAAC,GAAG;QAAC;QAAkB;QAAW;QAAY;KAAiB;IAE/D,kBAAkB;IAClB,MAAM,WAAW,oNAAiB,CAAC,CAAC;QAClC,MAAM,SAAS,IAAA,oMAAoB,EAAC,OAAO;QAC3C,oBAAoB;QAEpB,6CAA6C;QAC7C,IAAI,MAAM,gBAAgB,EAAE;YAC1B,MAAM,WAAW,UAAU,IAAI,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK,MAAM,gBAAgB;YAC1E,IAAI,UAAU;gBACZ,MAAM,iBAAiB,IAAA,qMAAqB,EAAC,SAAS,IAAI,EAAE;gBAC5D,eAAe;YACjB;QACF;QAEA,OAAO;IACT,GAAG;QAAC;QAAS;QAAW;KAAW;IAEnC,iCAAiC;IACjC,MAAM,gBAAgB,oNAAiB,CAAC,OAAO;QAC7C,OAAO,IAAI,QAAQ,CAAC;YAClB,gBAAgB;YAEhB,IAAI,iBAAiB,OAAO,EAAE;gBAC5B,aAAa,iBAAiB,OAAO;YACvC;YAEA,iBAAiB,OAAO,GAAG,WAAW;gBACpC,MAAM,SAAS,SAAS;gBACxB,gBAAgB;gBAChB,QAAQ;YACV,GAAG;QACL;IACF,GAAG;QAAC;QAAU;KAAW;IAEzB,mBAAmB;IACnB,MAAM,kBAAkB,oNAAiB,CAAC;QACxC,oBAAoB;QACpB,eAAe,EAAE;QACjB,IAAI,iBAAiB,OAAO,EAAE;YAC5B,aAAa,iBAAiB,OAAO;QACvC;IACF,GAAG,EAAE;IAEL,qBAAqB;IACrB,kNAAe,CAAC;QACd,OAAO;YACL,IAAI,iBAAiB,OAAO,EAAE;gBAC5B,aAAa,iBAAiB,OAAO;YACvC;QACF;IACF,GAAG,EAAE;IAEL,kBAAkB;IAClB,MAAM,YAAY,mBAAmB,iBAAiB,MAAM,CAAC,MAAM,GAAG,IAAI;IAC1E,MAAM,cAAc,mBAAmB,iBAAiB,QAAQ,CAAC,MAAM,GAAG,IAAI;IAE9E,MAAM,gBAAgB,oNAAiB,CAAC,CAAC;QACvC,IAAI,CAAC,kBAAkB,OAAO;QAC9B,MAAM,QAAQ,iBAAiB,MAAM,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK;QAC5D,OAAO,OAAO;IAChB,GAAG;QAAC;KAAiB;IAErB,MAAM,kBAAkB,oNAAiB,CAAC,CAAC;QACzC,IAAI,CAAC,kBAAkB,OAAO;QAC9B,MAAM,UAAU,iBAAiB,QAAQ,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK;QAChE,OAAO,SAAS;IAClB,GAAG;QAAC;KAAiB;IAErB,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACF;AACF"}},
    {"offset": {"line": 2206, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/hooks/use-pkgx-entity-sync.ts"],"sourcesContent":["import * as React from 'react';\r\nimport { toast } from 'sonner';\r\nimport { RefreshCw, Search, AlignLeft, Globe, FolderEdit, DollarSign, Package, Tag, FileText } from 'lucide-react';\r\nimport { updateCategory, updateCategoryBasic, updateBrand, updateProduct as updatePkgxProduct } from '../../../../lib/pkgx/api-service';\r\nimport type { LucideIcon } from 'lucide-react';\r\n\r\n// ========================================\r\n// Types\r\n// ========================================\r\n\r\nexport type PkgxEntityType = 'category' | 'brand' | 'product';\r\n\r\nexport type SyncActionKey = \r\n  | 'sync_all' \r\n  | 'sync_basic' \r\n  | 'sync_seo' \r\n  | 'sync_description'\r\n  | 'sync_price'\r\n  | 'sync_inventory'\r\n  | 'sync_flags';\r\n\r\nexport interface SyncAction {\r\n  key: SyncActionKey;\r\n  label: string;\r\n  icon: LucideIcon;\r\n  title: string;\r\n  description: (name: string) => string;\r\n  confirmTitle: string;\r\n  confirmDescription: (name: string) => string;\r\n  /** Which entity types support this action */\r\n  supportedEntities: PkgxEntityType[];\r\n  /** Is this the primary action (shown with separator and bold) */\r\n  isPrimary?: boolean;\r\n}\r\n\r\nexport interface HrmCategoryData {\r\n  systemId: string;\r\n  name: string;\r\n  isActive?: boolean;\r\n  seoKeywords?: string;\r\n  seoTitle?: string;\r\n  metaDescription?: string;\r\n  shortDescription?: string;\r\n  longDescription?: string;\r\n  websiteSeo?: {\r\n    pkgx?: {\r\n      seoKeywords?: string;\r\n      seoTitle?: string;\r\n      metaDescription?: string;\r\n      shortDescription?: string;\r\n      longDescription?: string;\r\n    };\r\n  };\r\n}\r\n\r\nexport interface HrmBrandData {\r\n  systemId: string;\r\n  name: string;\r\n  website?: string;\r\n  seoKeywords?: string;\r\n  seoTitle?: string;\r\n  metaDescription?: string;\r\n  shortDescription?: string;\r\n  longDescription?: string;\r\n  websiteSeo?: {\r\n    pkgx?: {\r\n      seoKeywords?: string;\r\n      seoTitle?: string;\r\n      metaDescription?: string;\r\n      shortDescription?: string;\r\n      longDescription?: string;\r\n    };\r\n  };\r\n}\r\n\r\nexport interface HrmProductData {\r\n  systemId: string;\r\n  name: string;\r\n  sku?: string;\r\n  sellingPrice?: number;\r\n  costPrice?: number;\r\n  dealPrice?: number;\r\n  quantity?: number;\r\n  seoKeywords?: string;\r\n  ktitle?: string;\r\n  seoDescription?: string;\r\n  shortDescription?: string;\r\n  description?: string;\r\n  isBest?: boolean;\r\n  isNew?: boolean;\r\n  isHot?: boolean;\r\n  isHome?: boolean;\r\n  categorySystemId?: string;\r\n  brandSystemId?: string;\r\n}\r\n\r\nexport interface ConfirmActionState {\r\n  open: boolean;\r\n  title: string;\r\n  description: string;\r\n  action: (() => void) | null;\r\n}\r\n\r\nexport type PkgxSyncLogAction = \r\n  | 'test_connection'\r\n  | 'ping'\r\n  | 'sync_all'\r\n  | 'sync_price'\r\n  | 'sync_inventory'\r\n  | 'sync_seo'\r\n  | 'create_product'\r\n  | 'update_product'\r\n  | 'link_product'\r\n  | 'unlink_product'\r\n  | 'unlink_mapping'\r\n  | 'sync_categories'\r\n  | 'sync_brands'\r\n  | 'get_products'\r\n  | 'upload_image'\r\n  | 'save_config'\r\n  | 'save_mapping';\r\n\r\n// Helper to map SyncActionKey to PkgxSyncLogAction\r\nconst mapActionKeyToLogAction = (actionKey: SyncActionKey): PkgxSyncLogAction => {\r\n  switch (actionKey) {\r\n    case 'sync_all': return 'sync_all';\r\n    case 'sync_seo': return 'sync_seo';\r\n    case 'sync_price': return 'sync_price';\r\n    case 'sync_inventory': return 'sync_inventory';\r\n    case 'sync_basic':\r\n    case 'sync_description':\r\n    case 'sync_flags':\r\n    default:\r\n      return 'update_product'; // Map other actions to generic update\r\n  }\r\n};\r\n\r\nexport interface UsePkgxEntitySyncOptions {\r\n  entityType: PkgxEntityType;\r\n  onLog?: (log: {\r\n    action: PkgxSyncLogAction;\r\n    status: 'success' | 'error' | 'info';\r\n    message: string;\r\n    details?: Record<string, any>;\r\n  }) => void;\r\n  /** For products - get PKGX category ID from HRM category */\r\n  getPkgxCatIdByHrmCategory?: (hrmCategoryId: string) => number | undefined;\r\n  /** For products - get PKGX brand ID from HRM brand */\r\n  getPkgxBrandIdByHrmBrand?: (hrmBrandId: string) => number | undefined;\r\n}\r\n\r\n// ========================================\r\n// Action Definitions\r\n// ========================================\r\n\r\nexport const SYNC_ACTIONS: SyncAction[] = [\r\n  {\r\n    key: 'sync_all',\r\n    label: 'Đồng bộ tất cả',\r\n    icon: RefreshCw,\r\n    title: 'Đồng bộ tất cả',\r\n    description: (name) => `Đồng bộ TẤT CẢ thông tin của \"${name}\" lên PKGX`,\r\n    confirmTitle: 'Đồng bộ tất cả',\r\n    confirmDescription: (name) => `Bạn có chắc muốn đồng bộ TẤT CẢ thông tin \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['category', 'brand', 'product'],\r\n    isPrimary: true,\r\n  },\r\n  {\r\n    key: 'sync_basic',\r\n    label: 'Thông tin cơ bản',\r\n    icon: FolderEdit,\r\n    title: 'Đồng bộ thông tin cơ bản',\r\n    description: (name) => `Đồng bộ thông tin cơ bản của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ thông tin cơ bản',\r\n    confirmDescription: (name) => `Đồng bộ thông tin cơ bản của \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['category', 'brand', 'product'],\r\n  },\r\n  {\r\n    key: 'sync_seo',\r\n    label: 'SEO',\r\n    icon: Search,\r\n    title: 'Đồng bộ SEO',\r\n    description: (name) => `Đồng bộ SEO (keywords, meta title, meta description) của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ SEO',\r\n    confirmDescription: (name) => `Đồng bộ SEO của \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['category', 'brand', 'product'],\r\n  },\r\n  {\r\n    key: 'sync_description',\r\n    label: 'Mô tả',\r\n    icon: AlignLeft,\r\n    title: 'Đồng bộ mô tả',\r\n    description: (name) => `Đồng bộ mô tả (short desc, long desc) của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ mô tả',\r\n    confirmDescription: (name) => `Đồng bộ mô tả của \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['category', 'brand', 'product'],\r\n  },\r\n  {\r\n    key: 'sync_price',\r\n    label: 'Giá',\r\n    icon: DollarSign,\r\n    title: 'Đồng bộ giá',\r\n    description: (name) => `Đồng bộ giá bán, giá thị trường, giá khuyến mãi của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ giá',\r\n    confirmDescription: (name) => `Đồng bộ giá sản phẩm \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['product'],\r\n  },\r\n  {\r\n    key: 'sync_inventory',\r\n    label: 'Tồn kho',\r\n    icon: Package,\r\n    title: 'Đồng bộ tồn kho',\r\n    description: (name) => `Đồng bộ tổng số lượng tồn kho của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ tồn kho',\r\n    confirmDescription: (name) => `Đồng bộ tồn kho sản phẩm \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['product'],\r\n  },\r\n  {\r\n    key: 'sync_flags',\r\n    label: 'Flags',\r\n    icon: Tag,\r\n    title: 'Đồng bộ flags',\r\n    description: (name) => `Đồng bộ flags (nổi bật, mới, hot, trang chủ) của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ flags',\r\n    confirmDescription: (name) => `Đồng bộ flags của \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['product'],\r\n  },\r\n];\r\n\r\n// ========================================\r\n// Hook\r\n// ========================================\r\n\r\nexport function usePkgxEntitySync(options: UsePkgxEntitySyncOptions) {\r\n  const { entityType, onLog, getPkgxCatIdByHrmCategory, getPkgxBrandIdByHrmBrand } = options;\r\n  \r\n  const [isSyncing, setIsSyncing] = React.useState(false);\r\n  const [confirmAction, setConfirmAction] = React.useState<ConfirmActionState>({\r\n    open: false,\r\n    title: '',\r\n    description: '',\r\n    action: null,\r\n  });\r\n  \r\n  // Get available actions for this entity type\r\n  const availableActions = React.useMemo(() => \r\n    SYNC_ACTIONS.filter(action => action.supportedEntities.includes(entityType)),\r\n  [entityType]);\r\n  \r\n  // Primary action (sync all)\r\n  const primaryAction = React.useMemo(() => \r\n    availableActions.find(a => a.isPrimary),\r\n  [availableActions]);\r\n  \r\n  // Secondary actions (non-primary)\r\n  const secondaryActions = React.useMemo(() => \r\n    availableActions.filter(a => !a.isPrimary),\r\n  [availableActions]);\r\n  \r\n  // Confirm handler\r\n  const handleConfirm = React.useCallback((title: string, description: string, action: () => void) => {\r\n    setConfirmAction({ open: true, title, description, action });\r\n  }, []);\r\n  \r\n  // Execute confirmed action\r\n  const executeAction = React.useCallback(() => {\r\n    if (confirmAction.action) {\r\n      confirmAction.action();\r\n    }\r\n    setConfirmAction({ open: false, title: '', description: '', action: null });\r\n  }, [confirmAction.action]);\r\n  \r\n  // Cancel confirm dialog\r\n  const cancelConfirm = React.useCallback(() => {\r\n    setConfirmAction({ open: false, title: '', description: '', action: null });\r\n  }, []);\r\n  \r\n  // ========================================\r\n  // Category Sync Handlers\r\n  // ========================================\r\n  \r\n  const syncCategory = React.useCallback(async (\r\n    pkgxCatId: number,\r\n    hrmCategory: HrmCategoryData,\r\n    actionKey: SyncActionKey\r\n  ) => {\r\n    setIsSyncing(true);\r\n    try {\r\n      const pkgxSeo = hrmCategory.websiteSeo?.pkgx;\r\n      let payload: Record<string, any> = {};\r\n      let successMessage = '';\r\n      \r\n      switch (actionKey) {\r\n        case 'sync_all':\r\n          payload = {\r\n            cat_name: hrmCategory.name,\r\n            keywords: pkgxSeo?.seoKeywords || hrmCategory.seoKeywords || hrmCategory.name,\r\n            meta_title: pkgxSeo?.seoTitle || hrmCategory.seoTitle || hrmCategory.name,\r\n            meta_desc: pkgxSeo?.metaDescription || hrmCategory.metaDescription || '',\r\n            cat_desc: pkgxSeo?.shortDescription || hrmCategory.shortDescription || '',\r\n            long_desc: pkgxSeo?.longDescription || hrmCategory.longDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ tất cả cho danh mục: ${hrmCategory.name}`;\r\n          break;\r\n          \r\n        case 'sync_basic':\r\n          payload = {\r\n            cat_name: hrmCategory.name,\r\n            is_show: hrmCategory.isActive !== false ? 1 : 0,\r\n          };\r\n          successMessage = `Đã đồng bộ thông tin cơ bản cho danh mục: ${hrmCategory.name}`;\r\n          // Use updateCategoryBasic for basic info\r\n          const basicResponse = await updateCategoryBasic(pkgxCatId, payload);\r\n          if (basicResponse.success) {\r\n            toast.success(successMessage);\r\n            onLog?.({\r\n              action: 'update_product', // Map to valid log action\r\n              status: 'success',\r\n              message: successMessage,\r\n              details: { categoryId: pkgxCatId },\r\n            });\r\n          } else {\r\n            toast.error(basicResponse.error || 'Không thể đồng bộ');\r\n          }\r\n          setIsSyncing(false);\r\n          return basicResponse.success;\r\n          \r\n        case 'sync_seo':\r\n          payload = {\r\n            keywords: pkgxSeo?.seoKeywords || hrmCategory.seoKeywords || hrmCategory.name,\r\n            meta_title: pkgxSeo?.seoTitle || hrmCategory.seoTitle || hrmCategory.name,\r\n            meta_desc: pkgxSeo?.metaDescription || hrmCategory.metaDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ SEO cho danh mục: ${hrmCategory.name}`;\r\n          break;\r\n          \r\n        case 'sync_description':\r\n          payload = {\r\n            cat_desc: pkgxSeo?.shortDescription || hrmCategory.shortDescription || '',\r\n            long_desc: pkgxSeo?.longDescription || hrmCategory.longDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ mô tả cho danh mục: ${hrmCategory.name}`;\r\n          break;\r\n          \r\n        default:\r\n          setIsSyncing(false);\r\n          return false;\r\n      }\r\n      \r\n      const response = await updateCategory(pkgxCatId, payload);\r\n      if (response.success) {\r\n        toast.success(successMessage);\r\n        onLog?.({\r\n          action: mapActionKeyToLogAction(actionKey),\r\n          status: 'success',\r\n          message: successMessage,\r\n          details: { categoryId: pkgxCatId },\r\n        });\r\n      } else {\r\n        toast.error(response.error || 'Không thể đồng bộ');\r\n      }\r\n      \r\n      return response.success;\r\n    } catch (error) {\r\n      toast.error('Lỗi khi đồng bộ danh mục');\r\n      return false;\r\n    } finally {\r\n      setIsSyncing(false);\r\n    }\r\n  }, [onLog]);\r\n  \r\n  // ========================================\r\n  // Brand Sync Handlers\r\n  // ========================================\r\n  \r\n  const syncBrand = React.useCallback(async (\r\n    pkgxBrandId: number,\r\n    hrmBrand: HrmBrandData,\r\n    actionKey: SyncActionKey\r\n  ) => {\r\n    setIsSyncing(true);\r\n    try {\r\n      const pkgxSeo = hrmBrand.websiteSeo?.pkgx;\r\n      let payload: Record<string, any> = {};\r\n      let successMessage = '';\r\n      \r\n      switch (actionKey) {\r\n        case 'sync_all':\r\n          payload = {\r\n            brand_name: hrmBrand.name,\r\n            site_url: hrmBrand.website || '',\r\n            keywords: pkgxSeo?.seoKeywords || hrmBrand.seoKeywords || hrmBrand.name,\r\n            meta_title: pkgxSeo?.seoTitle || hrmBrand.seoTitle || hrmBrand.name,\r\n            meta_desc: pkgxSeo?.metaDescription || hrmBrand.metaDescription || '',\r\n            short_desc: pkgxSeo?.shortDescription || hrmBrand.shortDescription || '',\r\n            long_desc: pkgxSeo?.longDescription || hrmBrand.longDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ tất cả cho thương hiệu: ${hrmBrand.name}`;\r\n          break;\r\n          \r\n        case 'sync_basic':\r\n          payload = {\r\n            brand_name: hrmBrand.name,\r\n            site_url: hrmBrand.website || '',\r\n          };\r\n          successMessage = `Đã đồng bộ thông tin cơ bản cho thương hiệu: ${hrmBrand.name}`;\r\n          break;\r\n          \r\n        case 'sync_seo':\r\n          payload = {\r\n            keywords: pkgxSeo?.seoKeywords || hrmBrand.seoKeywords || hrmBrand.name,\r\n            meta_title: pkgxSeo?.seoTitle || hrmBrand.seoTitle || hrmBrand.name,\r\n            meta_desc: pkgxSeo?.metaDescription || hrmBrand.metaDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ SEO cho thương hiệu: ${hrmBrand.name}`;\r\n          break;\r\n          \r\n        case 'sync_description':\r\n          payload = {\r\n            short_desc: pkgxSeo?.shortDescription || hrmBrand.shortDescription || '',\r\n            long_desc: pkgxSeo?.longDescription || hrmBrand.longDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ mô tả cho thương hiệu: ${hrmBrand.name}`;\r\n          break;\r\n          \r\n        default:\r\n          setIsSyncing(false);\r\n          return false;\r\n      }\r\n      \r\n      const response = await updateBrand(pkgxBrandId, payload);\r\n      if (response.success) {\r\n        toast.success(successMessage);\r\n        onLog?.({\r\n          action: mapActionKeyToLogAction(actionKey),\r\n          status: 'success',\r\n          message: successMessage,\r\n          details: { brandId: pkgxBrandId },\r\n        });\r\n      } else {\r\n        toast.error(response.error || 'Không thể đồng bộ');\r\n      }\r\n      \r\n      return response.success;\r\n    } catch (error) {\r\n      toast.error('Lỗi khi đồng bộ thương hiệu');\r\n      return false;\r\n    } finally {\r\n      setIsSyncing(false);\r\n    }\r\n  }, [onLog]);\r\n  \r\n  // ========================================\r\n  // Product Sync Handlers\r\n  // ========================================\r\n  \r\n  const syncProduct = React.useCallback(async (\r\n    pkgxProductId: number,\r\n    hrmProduct: HrmProductData,\r\n    actionKey: SyncActionKey\r\n  ) => {\r\n    setIsSyncing(true);\r\n    try {\r\n      let payload: Record<string, any> = {};\r\n      let successMessage = '';\r\n      \r\n      switch (actionKey) {\r\n        case 'sync_all':\r\n          payload = {\r\n            goods_name: hrmProduct.name,\r\n            goods_sn: hrmProduct.sku || '',\r\n            shop_price: hrmProduct.sellingPrice || 0,\r\n            market_price: hrmProduct.costPrice || hrmProduct.sellingPrice || 0,\r\n            promote_price: hrmProduct.dealPrice || 0,\r\n            goods_number: hrmProduct.quantity || 0,\r\n            keywords: hrmProduct.seoKeywords || hrmProduct.name,\r\n            meta_title: hrmProduct.ktitle || hrmProduct.name,\r\n            meta_desc: hrmProduct.seoDescription || '',\r\n            goods_brief: hrmProduct.shortDescription || '',\r\n            goods_desc: hrmProduct.description || '',\r\n            is_best: hrmProduct.isBest ? 1 : 0,\r\n            is_new: hrmProduct.isNew ? 1 : 0,\r\n            is_hot: hrmProduct.isHot ? 1 : 0,\r\n            is_home: hrmProduct.isHome ? 1 : 0,\r\n          };\r\n          // Add category/brand if mapped\r\n          if (hrmProduct.categorySystemId && getPkgxCatIdByHrmCategory) {\r\n            const catId = getPkgxCatIdByHrmCategory(hrmProduct.categorySystemId);\r\n            if (catId) payload.cat_id = catId;\r\n          }\r\n          if (hrmProduct.brandSystemId && getPkgxBrandIdByHrmBrand) {\r\n            const brandId = getPkgxBrandIdByHrmBrand(hrmProduct.brandSystemId);\r\n            if (brandId) payload.brand_id = brandId;\r\n          }\r\n          successMessage = `Đã đồng bộ tất cả cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_basic':\r\n          payload = {\r\n            goods_name: hrmProduct.name,\r\n            goods_sn: hrmProduct.sku || '',\r\n          };\r\n          // Add category/brand if mapped\r\n          if (hrmProduct.categorySystemId && getPkgxCatIdByHrmCategory) {\r\n            const catId = getPkgxCatIdByHrmCategory(hrmProduct.categorySystemId);\r\n            if (catId) payload.cat_id = catId;\r\n          }\r\n          if (hrmProduct.brandSystemId && getPkgxBrandIdByHrmBrand) {\r\n            const brandId = getPkgxBrandIdByHrmBrand(hrmProduct.brandSystemId);\r\n            if (brandId) payload.brand_id = brandId;\r\n          }\r\n          successMessage = `Đã đồng bộ thông tin cơ bản cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_seo':\r\n          payload = {\r\n            keywords: hrmProduct.seoKeywords || hrmProduct.name,\r\n            meta_title: hrmProduct.ktitle || hrmProduct.name,\r\n            meta_desc: hrmProduct.seoDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ SEO cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_description':\r\n          payload = {\r\n            goods_brief: hrmProduct.shortDescription || '',\r\n            goods_desc: hrmProduct.description || '',\r\n          };\r\n          successMessage = `Đã đồng bộ mô tả cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_price':\r\n          payload = {\r\n            shop_price: hrmProduct.sellingPrice || 0,\r\n            market_price: hrmProduct.costPrice || hrmProduct.sellingPrice || 0,\r\n            promote_price: hrmProduct.dealPrice || 0,\r\n          };\r\n          successMessage = `Đã đồng bộ giá cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_inventory':\r\n          payload = {\r\n            goods_number: hrmProduct.quantity || 0,\r\n          };\r\n          successMessage = `Đã đồng bộ tồn kho cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_flags':\r\n          payload = {\r\n            is_best: hrmProduct.isBest ? 1 : 0,\r\n            is_new: hrmProduct.isNew ? 1 : 0,\r\n            is_hot: hrmProduct.isHot ? 1 : 0,\r\n            is_home: hrmProduct.isHome ? 1 : 0,\r\n          };\r\n          successMessage = `Đã đồng bộ flags cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        default:\r\n          setIsSyncing(false);\r\n          return false;\r\n      }\r\n      \r\n      const response = await updatePkgxProduct(pkgxProductId, payload);\r\n      if (response.success) {\r\n        toast.success(successMessage);\r\n        onLog?.({\r\n          action: mapActionKeyToLogAction(actionKey),\r\n          status: 'success',\r\n          message: successMessage,\r\n          details: { pkgxId: pkgxProductId },\r\n        });\r\n      } else {\r\n        toast.error(response.error || 'Không thể đồng bộ');\r\n      }\r\n      \r\n      return response.success;\r\n    } catch (error) {\r\n      toast.error('Lỗi khi đồng bộ sản phẩm');\r\n      return false;\r\n    } finally {\r\n      setIsSyncing(false);\r\n    }\r\n  }, [onLog, getPkgxCatIdByHrmCategory, getPkgxBrandIdByHrmBrand]);\r\n  \r\n  // ========================================\r\n  // Generic sync handler based on entity type\r\n  // ========================================\r\n  \r\n  const sync = React.useCallback(async (\r\n    pkgxId: number,\r\n    hrmData: HrmCategoryData | HrmBrandData | HrmProductData,\r\n    actionKey: SyncActionKey\r\n  ) => {\r\n    switch (entityType) {\r\n      case 'category':\r\n        return syncCategory(pkgxId, hrmData as HrmCategoryData, actionKey);\r\n      case 'brand':\r\n        return syncBrand(pkgxId, hrmData as HrmBrandData, actionKey);\r\n      case 'product':\r\n        return syncProduct(pkgxId, hrmData as HrmProductData, actionKey);\r\n      default:\r\n        return false;\r\n    }\r\n  }, [entityType, syncCategory, syncBrand, syncProduct]);\r\n  \r\n  // ========================================\r\n  // Action trigger with confirmation\r\n  // ========================================\r\n  \r\n  const triggerSyncAction = React.useCallback((\r\n    actionKey: SyncActionKey,\r\n    pkgxId: number,\r\n    hrmData: HrmCategoryData | HrmBrandData | HrmProductData,\r\n    entityName: string\r\n  ) => {\r\n    const action = SYNC_ACTIONS.find(a => a.key === actionKey);\r\n    if (!action) return;\r\n    \r\n    handleConfirm(\r\n      action.confirmTitle,\r\n      action.confirmDescription(entityName),\r\n      () => sync(pkgxId, hrmData, actionKey)\r\n    );\r\n  }, [handleConfirm, sync]);\r\n  \r\n  return {\r\n    // State\r\n    isSyncing,\r\n    confirmAction,\r\n    \r\n    // Actions config\r\n    availableActions,\r\n    primaryAction,\r\n    secondaryActions,\r\n    \r\n    // Handlers\r\n    handleConfirm,\r\n    executeAction,\r\n    cancelConfirm,\r\n    \r\n    // Sync methods\r\n    sync,\r\n    syncCategory,\r\n    syncBrand,\r\n    syncProduct,\r\n    triggerSyncAction,\r\n  };\r\n}\r\n\r\nexport type UsePkgxEntitySyncReturn = ReturnType<typeof usePkgxEntitySync>;\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;AAuHA,mDAAmD;AACnD,MAAM,0BAA0B,CAAC;IAC/B,OAAQ;QACN,KAAK;YAAY,OAAO;QACxB,KAAK;YAAY,OAAO;QACxB,KAAK;YAAc,OAAO;QAC1B,KAAK;YAAkB,OAAO;QAC9B,KAAK;QACL,KAAK;QACL,KAAK;QACL;YACE,OAAO,kBAAkB,sCAAsC;IACnE;AACF;AAoBO,MAAM,eAA6B;IACxC;QACE,KAAK;QACL,OAAO;QACP,MAAM,6NAAS;QACf,OAAO;QACP,aAAa,CAAC,OAAS,CAAC,8BAA8B,EAAE,KAAK,UAAU,CAAC;QACxE,cAAc;QACd,oBAAoB,CAAC,OAAS,CAAC,2CAA2C,EAAE,KAAK,WAAW,CAAC;QAC7F,mBAAmB;YAAC;YAAY;YAAS;SAAU;QACnD,WAAW;IACb;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM,+NAAU;QAChB,OAAO;QACP,aAAa,CAAC,OAAS,CAAC,8BAA8B,EAAE,KAAK,CAAC,CAAC;QAC/D,cAAc;QACd,oBAAoB,CAAC,OAAS,CAAC,8BAA8B,EAAE,KAAK,WAAW,CAAC;QAChF,mBAAmB;YAAC;YAAY;YAAS;SAAU;IACrD;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM,gNAAM;QACZ,OAAO;QACP,aAAa,CAAC,OAAS,CAAC,0DAA0D,EAAE,KAAK,CAAC,CAAC;QAC3F,cAAc;QACd,oBAAoB,CAAC,OAAS,CAAC,iBAAiB,EAAE,KAAK,WAAW,CAAC;QACnE,mBAAmB;YAAC;YAAY;YAAS;SAAU;IACrD;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM,sOAAS;QACf,OAAO;QACP,aAAa,CAAC,OAAS,CAAC,2CAA2C,EAAE,KAAK,CAAC,CAAC;QAC5E,cAAc;QACd,oBAAoB,CAAC,OAAS,CAAC,mBAAmB,EAAE,KAAK,WAAW,CAAC;QACrE,mBAAmB;YAAC;YAAY;YAAS;SAAU;IACrD;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM,gOAAU;QAChB,OAAO;QACP,aAAa,CAAC,OAAS,CAAC,qDAAqD,EAAE,KAAK,CAAC,CAAC;QACtF,cAAc;QACd,oBAAoB,CAAC,OAAS,CAAC,sBAAsB,EAAE,KAAK,WAAW,CAAC;QACxE,mBAAmB;YAAC;SAAU;IAChC;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM,mNAAO;QACb,OAAO;QACP,aAAa,CAAC,OAAS,CAAC,mCAAmC,EAAE,KAAK,CAAC,CAAC;QACpE,cAAc;QACd,oBAAoB,CAAC,OAAS,CAAC,0BAA0B,EAAE,KAAK,WAAW,CAAC;QAC5E,mBAAmB;YAAC;SAAU;IAChC;IACA;QACE,KAAK;QACL,OAAO;QACP,MAAM,uMAAG;QACT,OAAO;QACP,aAAa,CAAC,OAAS,CAAC,kDAAkD,EAAE,KAAK,CAAC,CAAC;QACnF,cAAc;QACd,oBAAoB,CAAC,OAAS,CAAC,mBAAmB,EAAE,KAAK,WAAW,CAAC;QACrE,mBAAmB;YAAC;SAAU;IAChC;CACD;AAMM,SAAS,kBAAkB,OAAiC;IACjE,MAAM,EAAE,UAAU,EAAE,KAAK,EAAE,yBAAyB,EAAE,wBAAwB,EAAE,GAAG;IAEnF,MAAM,CAAC,WAAW,aAAa,GAAG,iNAAc,CAAC;IACjD,MAAM,CAAC,eAAe,iBAAiB,GAAG,iNAAc,CAAqB;QAC3E,MAAM;QACN,OAAO;QACP,aAAa;QACb,QAAQ;IACV;IAEA,6CAA6C;IAC7C,MAAM,mBAAmB,gNAAa,CAAC,IACrC,aAAa,MAAM,CAAC,CAAA,SAAU,OAAO,iBAAiB,CAAC,QAAQ,CAAC,cAClE;QAAC;KAAW;IAEZ,4BAA4B;IAC5B,MAAM,gBAAgB,gNAAa,CAAC,IAClC,iBAAiB,IAAI,CAAC,CAAA,IAAK,EAAE,SAAS,GACxC;QAAC;KAAiB;IAElB,kCAAkC;IAClC,MAAM,mBAAmB,gNAAa,CAAC,IACrC,iBAAiB,MAAM,CAAC,CAAA,IAAK,CAAC,EAAE,SAAS,GAC3C;QAAC;KAAiB;IAElB,kBAAkB;IAClB,MAAM,gBAAgB,oNAAiB,CAAC,CAAC,OAAe,aAAqB;QAC3E,iBAAiB;YAAE,MAAM;YAAM;YAAO;YAAa;QAAO;IAC5D,GAAG,EAAE;IAEL,2BAA2B;IAC3B,MAAM,gBAAgB,oNAAiB,CAAC;QACtC,IAAI,cAAc,MAAM,EAAE;YACxB,cAAc,MAAM;QACtB;QACA,iBAAiB;YAAE,MAAM;YAAO,OAAO;YAAI,aAAa;YAAI,QAAQ;QAAK;IAC3E,GAAG;QAAC,cAAc,MAAM;KAAC;IAEzB,wBAAwB;IACxB,MAAM,gBAAgB,oNAAiB,CAAC;QACtC,iBAAiB;YAAE,MAAM;YAAO,OAAO;YAAI,aAAa;YAAI,QAAQ;QAAK;IAC3E,GAAG,EAAE;IAEL,2CAA2C;IAC3C,yBAAyB;IACzB,2CAA2C;IAE3C,MAAM,eAAe,oNAAiB,CAAC,OACrC,WACA,aACA;QAEA,aAAa;QACb,IAAI;YACF,MAAM,UAAU,YAAY,UAAU,EAAE;YACxC,IAAI,UAA+B,CAAC;YACpC,IAAI,iBAAiB;YAErB,OAAQ;gBACN,KAAK;oBACH,UAAU;wBACR,UAAU,YAAY,IAAI;wBAC1B,UAAU,SAAS,eAAe,YAAY,WAAW,IAAI,YAAY,IAAI;wBAC7E,YAAY,SAAS,YAAY,YAAY,QAAQ,IAAI,YAAY,IAAI;wBACzE,WAAW,SAAS,mBAAmB,YAAY,eAAe,IAAI;wBACtE,UAAU,SAAS,oBAAoB,YAAY,gBAAgB,IAAI;wBACvE,WAAW,SAAS,mBAAmB,YAAY,eAAe,IAAI;oBACxE;oBACA,iBAAiB,CAAC,gCAAgC,EAAE,YAAY,IAAI,EAAE;oBACtE;gBAEF,KAAK;oBACH,UAAU;wBACR,UAAU,YAAY,IAAI;wBAC1B,SAAS,YAAY,QAAQ,KAAK,QAAQ,IAAI;oBAChD;oBACA,iBAAiB,CAAC,0CAA0C,EAAE,YAAY,IAAI,EAAE;oBAChF,yCAAyC;oBACzC,MAAM,gBAAgB,MAAM,IAAA,oJAAmB,EAAC,WAAW;oBAC3D,IAAI,cAAc,OAAO,EAAE;wBACzB,iJAAK,CAAC,OAAO,CAAC;wBACd,QAAQ;4BACN,QAAQ;4BACR,QAAQ;4BACR,SAAS;4BACT,SAAS;gCAAE,YAAY;4BAAU;wBACnC;oBACF,OAAO;wBACL,iJAAK,CAAC,KAAK,CAAC,cAAc,KAAK,IAAI;oBACrC;oBACA,aAAa;oBACb,OAAO,cAAc,OAAO;gBAE9B,KAAK;oBACH,UAAU;wBACR,UAAU,SAAS,eAAe,YAAY,WAAW,IAAI,YAAY,IAAI;wBAC7E,YAAY,SAAS,YAAY,YAAY,QAAQ,IAAI,YAAY,IAAI;wBACzE,WAAW,SAAS,mBAAmB,YAAY,eAAe,IAAI;oBACxE;oBACA,iBAAiB,CAAC,6BAA6B,EAAE,YAAY,IAAI,EAAE;oBACnE;gBAEF,KAAK;oBACH,UAAU;wBACR,UAAU,SAAS,oBAAoB,YAAY,gBAAgB,IAAI;wBACvE,WAAW,SAAS,mBAAmB,YAAY,eAAe,IAAI;oBACxE;oBACA,iBAAiB,CAAC,+BAA+B,EAAE,YAAY,IAAI,EAAE;oBACrE;gBAEF;oBACE,aAAa;oBACb,OAAO;YACX;YAEA,MAAM,WAAW,MAAM,IAAA,+IAAc,EAAC,WAAW;YACjD,IAAI,SAAS,OAAO,EAAE;gBACpB,iJAAK,CAAC,OAAO,CAAC;gBACd,QAAQ;oBACN,QAAQ,wBAAwB;oBAChC,QAAQ;oBACR,SAAS;oBACT,SAAS;wBAAE,YAAY;oBAAU;gBACnC;YACF,OAAO;gBACL,iJAAK,CAAC,KAAK,CAAC,SAAS,KAAK,IAAI;YAChC;YAEA,OAAO,SAAS,OAAO;QACzB,EAAE,OAAO,OAAO;YACd,iJAAK,CAAC,KAAK,CAAC;YACZ,OAAO;QACT,SAAU;YACR,aAAa;QACf;IACF,GAAG;QAAC;KAAM;IAEV,2CAA2C;IAC3C,sBAAsB;IACtB,2CAA2C;IAE3C,MAAM,YAAY,oNAAiB,CAAC,OAClC,aACA,UACA;QAEA,aAAa;QACb,IAAI;YACF,MAAM,UAAU,SAAS,UAAU,EAAE;YACrC,IAAI,UAA+B,CAAC;YACpC,IAAI,iBAAiB;YAErB,OAAQ;gBACN,KAAK;oBACH,UAAU;wBACR,YAAY,SAAS,IAAI;wBACzB,UAAU,SAAS,OAAO,IAAI;wBAC9B,UAAU,SAAS,eAAe,SAAS,WAAW,IAAI,SAAS,IAAI;wBACvE,YAAY,SAAS,YAAY,SAAS,QAAQ,IAAI,SAAS,IAAI;wBACnE,WAAW,SAAS,mBAAmB,SAAS,eAAe,IAAI;wBACnE,YAAY,SAAS,oBAAoB,SAAS,gBAAgB,IAAI;wBACtE,WAAW,SAAS,mBAAmB,SAAS,eAAe,IAAI;oBACrE;oBACA,iBAAiB,CAAC,mCAAmC,EAAE,SAAS,IAAI,EAAE;oBACtE;gBAEF,KAAK;oBACH,UAAU;wBACR,YAAY,SAAS,IAAI;wBACzB,UAAU,SAAS,OAAO,IAAI;oBAChC;oBACA,iBAAiB,CAAC,6CAA6C,EAAE,SAAS,IAAI,EAAE;oBAChF;gBAEF,KAAK;oBACH,UAAU;wBACR,UAAU,SAAS,eAAe,SAAS,WAAW,IAAI,SAAS,IAAI;wBACvE,YAAY,SAAS,YAAY,SAAS,QAAQ,IAAI,SAAS,IAAI;wBACnE,WAAW,SAAS,mBAAmB,SAAS,eAAe,IAAI;oBACrE;oBACA,iBAAiB,CAAC,gCAAgC,EAAE,SAAS,IAAI,EAAE;oBACnE;gBAEF,KAAK;oBACH,UAAU;wBACR,YAAY,SAAS,oBAAoB,SAAS,gBAAgB,IAAI;wBACtE,WAAW,SAAS,mBAAmB,SAAS,eAAe,IAAI;oBACrE;oBACA,iBAAiB,CAAC,kCAAkC,EAAE,SAAS,IAAI,EAAE;oBACrE;gBAEF;oBACE,aAAa;oBACb,OAAO;YACX;YAEA,MAAM,WAAW,MAAM,IAAA,4IAAW,EAAC,aAAa;YAChD,IAAI,SAAS,OAAO,EAAE;gBACpB,iJAAK,CAAC,OAAO,CAAC;gBACd,QAAQ;oBACN,QAAQ,wBAAwB;oBAChC,QAAQ;oBACR,SAAS;oBACT,SAAS;wBAAE,SAAS;oBAAY;gBAClC;YACF,OAAO;gBACL,iJAAK,CAAC,KAAK,CAAC,SAAS,KAAK,IAAI;YAChC;YAEA,OAAO,SAAS,OAAO;QACzB,EAAE,OAAO,OAAO;YACd,iJAAK,CAAC,KAAK,CAAC;YACZ,OAAO;QACT,SAAU;YACR,aAAa;QACf;IACF,GAAG;QAAC;KAAM;IAEV,2CAA2C;IAC3C,wBAAwB;IACxB,2CAA2C;IAE3C,MAAM,cAAc,oNAAiB,CAAC,OACpC,eACA,YACA;QAEA,aAAa;QACb,IAAI;YACF,IAAI,UAA+B,CAAC;YACpC,IAAI,iBAAiB;YAErB,OAAQ;gBACN,KAAK;oBACH,UAAU;wBACR,YAAY,WAAW,IAAI;wBAC3B,UAAU,WAAW,GAAG,IAAI;wBAC5B,YAAY,WAAW,YAAY,IAAI;wBACvC,cAAc,WAAW,SAAS,IAAI,WAAW,YAAY,IAAI;wBACjE,eAAe,WAAW,SAAS,IAAI;wBACvC,cAAc,WAAW,QAAQ,IAAI;wBACrC,UAAU,WAAW,WAAW,IAAI,WAAW,IAAI;wBACnD,YAAY,WAAW,MAAM,IAAI,WAAW,IAAI;wBAChD,WAAW,WAAW,cAAc,IAAI;wBACxC,aAAa,WAAW,gBAAgB,IAAI;wBAC5C,YAAY,WAAW,WAAW,IAAI;wBACtC,SAAS,WAAW,MAAM,GAAG,IAAI;wBACjC,QAAQ,WAAW,KAAK,GAAG,IAAI;wBAC/B,QAAQ,WAAW,KAAK,GAAG,IAAI;wBAC/B,SAAS,WAAW,MAAM,GAAG,IAAI;oBACnC;oBACA,+BAA+B;oBAC/B,IAAI,WAAW,gBAAgB,IAAI,2BAA2B;wBAC5D,MAAM,QAAQ,0BAA0B,WAAW,gBAAgB;wBACnE,IAAI,OAAO,QAAQ,MAAM,GAAG;oBAC9B;oBACA,IAAI,WAAW,aAAa,IAAI,0BAA0B;wBACxD,MAAM,UAAU,yBAAyB,WAAW,aAAa;wBACjE,IAAI,SAAS,QAAQ,QAAQ,GAAG;oBAClC;oBACA,iBAAiB,CAAC,gCAAgC,EAAE,WAAW,IAAI,EAAE;oBACrE;gBAEF,KAAK;oBACH,UAAU;wBACR,YAAY,WAAW,IAAI;wBAC3B,UAAU,WAAW,GAAG,IAAI;oBAC9B;oBACA,+BAA+B;oBAC/B,IAAI,WAAW,gBAAgB,IAAI,2BAA2B;wBAC5D,MAAM,QAAQ,0BAA0B,WAAW,gBAAgB;wBACnE,IAAI,OAAO,QAAQ,MAAM,GAAG;oBAC9B;oBACA,IAAI,WAAW,aAAa,IAAI,0BAA0B;wBACxD,MAAM,UAAU,yBAAyB,WAAW,aAAa;wBACjE,IAAI,SAAS,QAAQ,QAAQ,GAAG;oBAClC;oBACA,iBAAiB,CAAC,0CAA0C,EAAE,WAAW,IAAI,EAAE;oBAC/E;gBAEF,KAAK;oBACH,UAAU;wBACR,UAAU,WAAW,WAAW,IAAI,WAAW,IAAI;wBACnD,YAAY,WAAW,MAAM,IAAI,WAAW,IAAI;wBAChD,WAAW,WAAW,cAAc,IAAI;oBAC1C;oBACA,iBAAiB,CAAC,6BAA6B,EAAE,WAAW,IAAI,EAAE;oBAClE;gBAEF,KAAK;oBACH,UAAU;wBACR,aAAa,WAAW,gBAAgB,IAAI;wBAC5C,YAAY,WAAW,WAAW,IAAI;oBACxC;oBACA,iBAAiB,CAAC,+BAA+B,EAAE,WAAW,IAAI,EAAE;oBACpE;gBAEF,KAAK;oBACH,UAAU;wBACR,YAAY,WAAW,YAAY,IAAI;wBACvC,cAAc,WAAW,SAAS,IAAI,WAAW,YAAY,IAAI;wBACjE,eAAe,WAAW,SAAS,IAAI;oBACzC;oBACA,iBAAiB,CAAC,6BAA6B,EAAE,WAAW,IAAI,EAAE;oBAClE;gBAEF,KAAK;oBACH,UAAU;wBACR,cAAc,WAAW,QAAQ,IAAI;oBACvC;oBACA,iBAAiB,CAAC,iCAAiC,EAAE,WAAW,IAAI,EAAE;oBACtE;gBAEF,KAAK;oBACH,UAAU;wBACR,SAAS,WAAW,MAAM,GAAG,IAAI;wBACjC,QAAQ,WAAW,KAAK,GAAG,IAAI;wBAC/B,QAAQ,WAAW,KAAK,GAAG,IAAI;wBAC/B,SAAS,WAAW,MAAM,GAAG,IAAI;oBACnC;oBACA,iBAAiB,CAAC,+BAA+B,EAAE,WAAW,IAAI,EAAE;oBACpE;gBAEF;oBACE,aAAa;oBACb,OAAO;YACX;YAEA,MAAM,WAAW,MAAM,IAAA,8IAAiB,EAAC,eAAe;YACxD,IAAI,SAAS,OAAO,EAAE;gBACpB,iJAAK,CAAC,OAAO,CAAC;gBACd,QAAQ;oBACN,QAAQ,wBAAwB;oBAChC,QAAQ;oBACR,SAAS;oBACT,SAAS;wBAAE,QAAQ;oBAAc;gBACnC;YACF,OAAO;gBACL,iJAAK,CAAC,KAAK,CAAC,SAAS,KAAK,IAAI;YAChC;YAEA,OAAO,SAAS,OAAO;QACzB,EAAE,OAAO,OAAO;YACd,iJAAK,CAAC,KAAK,CAAC;YACZ,OAAO;QACT,SAAU;YACR,aAAa;QACf;IACF,GAAG;QAAC;QAAO;QAA2B;KAAyB;IAE/D,2CAA2C;IAC3C,4CAA4C;IAC5C,2CAA2C;IAE3C,MAAM,OAAO,oNAAiB,CAAC,OAC7B,QACA,SACA;QAEA,OAAQ;YACN,KAAK;gBACH,OAAO,aAAa,QAAQ,SAA4B;YAC1D,KAAK;gBACH,OAAO,UAAU,QAAQ,SAAyB;YACpD,KAAK;gBACH,OAAO,YAAY,QAAQ,SAA2B;YACxD;gBACE,OAAO;QACX;IACF,GAAG;QAAC;QAAY;QAAc;QAAW;KAAY;IAErD,2CAA2C;IAC3C,mCAAmC;IACnC,2CAA2C;IAE3C,MAAM,oBAAoB,oNAAiB,CAAC,CAC1C,WACA,QACA,SACA;QAEA,MAAM,SAAS,aAAa,IAAI,CAAC,CAAA,IAAK,EAAE,GAAG,KAAK;QAChD,IAAI,CAAC,QAAQ;QAEb,cACE,OAAO,YAAY,EACnB,OAAO,kBAAkB,CAAC,aAC1B,IAAM,KAAK,QAAQ,SAAS;IAEhC,GAAG;QAAC;QAAe;KAAK;IAExB,OAAO;QACL,QAAQ;QACR;QACA;QAEA,iBAAiB;QACjB;QACA;QACA;QAEA,WAAW;QACX;QACA;QACA;QAEA,eAAe;QACf;QACA;QACA;QACA;QACA;IACF;AACF"}},
    {"offset": {"line": 2728, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/hooks/use-pkgx-bulk-sync.ts"],"sourcesContent":["/**\r\n * usePkgxBulkSync - Shared hook for bulk PKGX sync operations\r\n * \r\n * Supports bulk sync for products and brands with:\r\n * - Progress tracking\r\n * - Confirmation dialog\r\n * - Error handling\r\n * - Logging\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { toast } from 'sonner';\r\nimport { updateProduct, updateBrand } from '../../../../lib/pkgx/api-service';\r\nimport { usePkgxSettingsStore } from '../store';\r\nimport type { Product } from '../../../products/types';\r\nimport type { Brand } from '../../../settings/inventory/types';\r\n\r\n// ========================================\r\n// Types\r\n// ========================================\r\n\r\nexport type BulkSyncEntityType = 'product' | 'brand';\r\n\r\nexport type BulkSyncActionKey = \r\n  | 'sync_all'\r\n  | 'sync_basic'\r\n  | 'sync_seo'\r\n  | 'sync_description'\r\n  | 'sync_price'\r\n  | 'sync_inventory'\r\n  | 'sync_flags'\r\n  | 'sync_images';\r\n\r\nexport interface BulkConfirmState {\r\n  open: boolean;\r\n  title: string;\r\n  description: string;\r\n  action: (() => Promise<void>) | null;\r\n  itemCount: number;\r\n}\r\n\r\nexport interface BulkSyncProgress {\r\n  total: number;\r\n  completed: number;\r\n  success: number;\r\n  error: number;\r\n  isRunning: boolean;\r\n}\r\n\r\nexport interface UsePkgxBulkSyncOptions {\r\n  entityType: BulkSyncEntityType;\r\n  onLog?: (log: {\r\n    action: `bulk_${BulkSyncActionKey}`;\r\n    status: 'success' | 'error' | 'info';\r\n    message: string;\r\n    details?: Record<string, unknown>;\r\n  }) => void;\r\n}\r\n\r\n// ========================================\r\n// Bulk Action Configs\r\n// ========================================\r\n\r\nconst BULK_ACTION_LABELS: Record<BulkSyncActionKey, { title: string; description: string }> = {\r\n  sync_all: {\r\n    title: 'Đồng bộ tất cả',\r\n    description: 'Đồng bộ toàn bộ thông tin (tên, SKU, giá, tồn kho, SEO, mô tả, flags)',\r\n  },\r\n  sync_basic: {\r\n    title: 'Đồng bộ thông tin cơ bản',\r\n    description: 'Đồng bộ tên, SKU, danh mục, thương hiệu',\r\n  },\r\n  sync_seo: {\r\n    title: 'Đồng bộ SEO',\r\n    description: 'Đồng bộ keywords, meta title, meta description',\r\n  },\r\n  sync_description: {\r\n    title: 'Đồng bộ mô tả',\r\n    description: 'Đồng bộ mô tả ngắn và mô tả chi tiết',\r\n  },\r\n  sync_price: {\r\n    title: 'Đồng bộ giá',\r\n    description: 'Đồng bộ giá bán, giá thị trường, giá khuyến mãi',\r\n  },\r\n  sync_inventory: {\r\n    title: 'Đồng bộ tồn kho',\r\n    description: 'Đồng bộ số lượng tồn kho',\r\n  },\r\n  sync_flags: {\r\n    title: 'Đồng bộ flags',\r\n    description: 'Đồng bộ trạng thái nổi bật, mới, hot, hiển thị',\r\n  },\r\n  sync_images: {\r\n    title: 'Đồng bộ hình ảnh',\r\n    description: 'Đồng bộ hình ảnh đại diện và album',\r\n  },\r\n};\r\n\r\n// ========================================\r\n// Payload Builders\r\n// ========================================\r\n\r\nfunction buildProductPayload(product: Product, actionKey: BulkSyncActionKey): Record<string, unknown> {\r\n  const pkgxSettings = usePkgxSettingsStore.getState();\r\n  const { categoryMappings, brandMappings } = pkgxSettings.settings;\r\n  \r\n  // Get PKGX category/brand IDs\r\n  const catMapping = categoryMappings.find(m => m.hrmCategorySystemId === product.categorySystemId);\r\n  const brandMapping = brandMappings.find(m => m.hrmBrandSystemId === product.brandSystemId);\r\n  \r\n  // Get website-specific SEO data\r\n  const pkgxSeo = product.seoPkgx;\r\n  \r\n  // Calculate total inventory\r\n  const totalInventory = Object.values(product.inventoryByBranch || {}).reduce((sum, qty) => sum + qty, 0);\r\n  \r\n  switch (actionKey) {\r\n    case 'sync_all':\r\n      return {\r\n        goods_name: product.name,\r\n        goods_sn: product.id,\r\n        shop_price: product.sellingPrice || 0,\r\n        market_price: product.costPrice || product.sellingPrice || 0,\r\n        promote_price: 0, // dealPrice not in Product type\r\n        goods_number: totalInventory,\r\n        keywords: pkgxSeo?.seoKeywords || product.seoKeywords || product.name,\r\n        meta_title: pkgxSeo?.seoTitle || product.ktitle || product.name,\r\n        meta_desc: pkgxSeo?.metaDescription || product.seoDescription || '',\r\n        goods_brief: pkgxSeo?.shortDescription || product.shortDescription || '',\r\n        goods_desc: pkgxSeo?.longDescription || product.description || '',\r\n        is_best: product.isFeatured ? 1 : 0,\r\n        is_new: product.isNewArrival ? 1 : 0,\r\n        is_hot: product.isBestSeller ? 1 : 0,\r\n        is_home: product.isPublished ? 1 : 0,\r\n        is_on_sale: product.isPublished ?? (product.status === 'active') ? 1 : 0,\r\n        ...(catMapping && { cat_id: catMapping.pkgxCatId }),\r\n        ...(brandMapping && { brand_id: brandMapping.pkgxBrandId }),\r\n      };\r\n      \r\n    case 'sync_basic':\r\n      return {\r\n        goods_name: product.name,\r\n        goods_sn: product.id,\r\n        ...(catMapping && { cat_id: catMapping.pkgxCatId }),\r\n        ...(brandMapping && { brand_id: brandMapping.pkgxBrandId }),\r\n      };\r\n      \r\n    case 'sync_price':\r\n      return {\r\n        shop_price: product.sellingPrice || 0,\r\n        market_price: product.costPrice || product.sellingPrice || 0,\r\n        promote_price: 0,\r\n      };\r\n      \r\n    case 'sync_inventory':\r\n      return {\r\n        goods_number: totalInventory,\r\n      };\r\n      \r\n    case 'sync_seo':\r\n      return {\r\n        keywords: pkgxSeo?.seoKeywords || product.seoKeywords || product.name,\r\n        meta_title: pkgxSeo?.seoTitle || product.ktitle || product.name,\r\n        meta_desc: pkgxSeo?.metaDescription || product.seoDescription || '',\r\n      };\r\n      \r\n    case 'sync_description':\r\n      return {\r\n        goods_brief: pkgxSeo?.shortDescription || product.shortDescription || '',\r\n        goods_desc: pkgxSeo?.longDescription || product.description || '',\r\n      };\r\n      \r\n    case 'sync_flags':\r\n      return {\r\n        is_best: product.isFeatured ? 1 : 0,\r\n        is_new: product.isNewArrival ? 1 : 0,\r\n        is_hot: product.isBestSeller ? 1 : 0,\r\n        is_home: product.isPublished ? 1 : 0,\r\n        is_on_sale: product.isPublished ?? (product.status === 'active') ? 1 : 0,\r\n      };\r\n      \r\n    default:\r\n      return {};\r\n  }\r\n}\r\n\r\nfunction buildBrandPayload(brand: Brand, actionKey: BulkSyncActionKey): Record<string, unknown> {\r\n  const pkgxSeo = brand.websiteSeo?.pkgx;\r\n  \r\n  switch (actionKey) {\r\n    case 'sync_all':\r\n      return {\r\n        brand_name: brand.name,\r\n        site_url: brand.website || '',\r\n        keywords: pkgxSeo?.seoKeywords || brand.seoKeywords || brand.name,\r\n        meta_title: pkgxSeo?.seoTitle || brand.seoTitle || brand.name,\r\n        meta_desc: pkgxSeo?.metaDescription || brand.metaDescription || '',\r\n        short_desc: pkgxSeo?.shortDescription || brand.shortDescription || '',\r\n        brand_desc: pkgxSeo?.longDescription || brand.longDescription || brand.description || '',\r\n      };\r\n      \r\n    case 'sync_basic':\r\n      return {\r\n        brand_name: brand.name,\r\n        site_url: brand.website || '',\r\n      };\r\n      \r\n    case 'sync_seo':\r\n      return {\r\n        keywords: pkgxSeo?.seoKeywords || brand.seoKeywords || brand.name,\r\n        meta_title: pkgxSeo?.seoTitle || brand.seoTitle || brand.name,\r\n        meta_desc: pkgxSeo?.metaDescription || brand.metaDescription || '',\r\n        short_desc: pkgxSeo?.shortDescription || brand.shortDescription || '',\r\n      };\r\n      \r\n    case 'sync_description':\r\n      return {\r\n        short_desc: pkgxSeo?.shortDescription || brand.shortDescription || '',\r\n        brand_desc: pkgxSeo?.longDescription || brand.longDescription || brand.description || '',\r\n      };\r\n      \r\n    default:\r\n      return {};\r\n  }\r\n}\r\n\r\n// ========================================\r\n// Main Hook\r\n// ========================================\r\n\r\nexport function usePkgxBulkSync(options: UsePkgxBulkSyncOptions) {\r\n  const { entityType, onLog } = options;\r\n  \r\n  // Confirmation dialog state\r\n  const [confirmAction, setConfirmAction] = React.useState<BulkConfirmState>({\r\n    open: false,\r\n    title: '',\r\n    description: '',\r\n    action: null,\r\n    itemCount: 0,\r\n  });\r\n  \r\n  // Progress state\r\n  const [progress, setProgress] = React.useState<BulkSyncProgress>({\r\n    total: 0,\r\n    completed: 0,\r\n    success: 0,\r\n    error: 0,\r\n    isRunning: false,\r\n  });\r\n  \r\n  // Check if PKGX is enabled\r\n  const checkPkgxEnabled = React.useCallback(() => {\r\n    const pkgxSettings = usePkgxSettingsStore.getState();\r\n    if (!pkgxSettings.settings.enabled) {\r\n      toast.error('PKGX chưa được bật');\r\n      return false;\r\n    }\r\n    return true;\r\n  }, []);\r\n  \r\n  // Helper to get PKGX brand ID from brand mappings\r\n  const getPkgxBrandId = React.useCallback((brand: Brand): number | undefined => {\r\n    const pkgxSettings = usePkgxSettingsStore.getState();\r\n    const mapping = pkgxSettings.settings.brandMappings.find(\r\n      m => m.hrmBrandSystemId === brand.systemId\r\n    );\r\n    return mapping?.pkgxBrandId;\r\n  }, []);\r\n  \r\n  // Execute bulk sync for products\r\n  const executeBulkSyncProducts = React.useCallback(async (\r\n    products: Product[],\r\n    actionKey: BulkSyncActionKey\r\n  ) => {\r\n    const linkedProducts = products.filter(p => p.pkgxId);\r\n    \r\n    if (linkedProducts.length === 0) {\r\n      toast.error('Không có sản phẩm nào đã liên kết PKGX');\r\n      return;\r\n    }\r\n    \r\n    setProgress({\r\n      total: linkedProducts.length,\r\n      completed: 0,\r\n      success: 0,\r\n      error: 0,\r\n      isRunning: true,\r\n    });\r\n    \r\n    const actionLabel = BULK_ACTION_LABELS[actionKey].title.toLowerCase();\r\n    toast.info(`Đang ${actionLabel} ${linkedProducts.length} sản phẩm...`);\r\n    \r\n    let successCount = 0;\r\n    let errorCount = 0;\r\n    \r\n    for (let i = 0; i < linkedProducts.length; i++) {\r\n      const product = linkedProducts[i];\r\n      try {\r\n        const payload = buildProductPayload(product, actionKey);\r\n        const response = await updateProduct(product.pkgxId!, payload);\r\n        \r\n        if (response.success) {\r\n          successCount++;\r\n        } else {\r\n          errorCount++;\r\n        }\r\n      } catch {\r\n        errorCount++;\r\n      }\r\n      \r\n      setProgress(prev => ({\r\n        ...prev,\r\n        completed: i + 1,\r\n        success: successCount,\r\n        error: errorCount,\r\n      }));\r\n    }\r\n    \r\n    setProgress(prev => ({ ...prev, isRunning: false }));\r\n    \r\n    // Show results\r\n    if (successCount > 0) {\r\n      toast.success(`Đã ${actionLabel} ${successCount} sản phẩm`);\r\n      onLog?.({\r\n        action: `bulk_${actionKey}`,\r\n        status: 'success',\r\n        message: `Đã ${actionLabel} ${successCount} sản phẩm`,\r\n        details: { successCount, errorCount },\r\n      });\r\n    }\r\n    if (errorCount > 0) {\r\n      toast.error(`Lỗi ${errorCount} sản phẩm`);\r\n    }\r\n  }, [onLog]);\r\n  \r\n  // Execute bulk sync for brands\r\n  const executeBulkSyncBrands = React.useCallback(async (\r\n    brands: Brand[],\r\n    actionKey: BulkSyncActionKey\r\n  ) => {\r\n    const linkedBrands = brands.filter(b => getPkgxBrandId(b));\r\n    \r\n    if (linkedBrands.length === 0) {\r\n      toast.error('Không có thương hiệu nào đã liên kết PKGX');\r\n      return;\r\n    }\r\n    \r\n    setProgress({\r\n      total: linkedBrands.length,\r\n      completed: 0,\r\n      success: 0,\r\n      error: 0,\r\n      isRunning: true,\r\n    });\r\n    \r\n    const actionLabel = BULK_ACTION_LABELS[actionKey].title.toLowerCase();\r\n    toast.info(`Đang ${actionLabel} ${linkedBrands.length} thương hiệu...`);\r\n    \r\n    let successCount = 0;\r\n    let errorCount = 0;\r\n    \r\n    for (let i = 0; i < linkedBrands.length; i++) {\r\n      const brand = linkedBrands[i];\r\n      const pkgxBrandId = getPkgxBrandId(brand);\r\n      \r\n      if (!pkgxBrandId) {\r\n        errorCount++;\r\n        continue;\r\n      }\r\n      \r\n      try {\r\n        const payload = buildBrandPayload(brand, actionKey);\r\n        const response = await updateBrand(pkgxBrandId, payload);\r\n        \r\n        if (response.success) {\r\n          successCount++;\r\n        } else {\r\n          errorCount++;\r\n        }\r\n      } catch {\r\n        errorCount++;\r\n      }\r\n      \r\n      setProgress(prev => ({\r\n        ...prev,\r\n        completed: i + 1,\r\n        success: successCount,\r\n        error: errorCount,\r\n      }));\r\n    }\r\n    \r\n    setProgress(prev => ({ ...prev, isRunning: false }));\r\n    \r\n    // Show results\r\n    if (successCount > 0) {\r\n      toast.success(`Đã ${actionLabel} ${successCount} thương hiệu`);\r\n      onLog?.({\r\n        action: `bulk_${actionKey}`,\r\n        status: 'success',\r\n        message: `Đã ${actionLabel} ${successCount} thương hiệu`,\r\n        details: { successCount, errorCount },\r\n      });\r\n    }\r\n    if (errorCount > 0) {\r\n      toast.error(`Lỗi ${errorCount} thương hiệu`);\r\n    }\r\n  }, [getPkgxBrandId, onLog]);\r\n  \r\n  // Trigger bulk sync with confirmation\r\n  const triggerBulkSync = React.useCallback(<T extends Product | Brand>(\r\n    items: T[],\r\n    actionKey: BulkSyncActionKey\r\n  ) => {\r\n    if (!checkPkgxEnabled()) return;\r\n    \r\n    // Filter linked items\r\n    let linkedCount = 0;\r\n    let unlinkedCount = 0;\r\n    \r\n    if (entityType === 'product') {\r\n      const products = items as Product[];\r\n      linkedCount = products.filter(p => p.pkgxId).length;\r\n      unlinkedCount = products.length - linkedCount;\r\n    } else {\r\n      const brands = items as Brand[];\r\n      linkedCount = brands.filter(b => getPkgxBrandId(b)).length;\r\n      unlinkedCount = brands.length - linkedCount;\r\n    }\r\n    \r\n    if (linkedCount === 0) {\r\n      toast.error(`Không có ${entityType === 'product' ? 'sản phẩm' : 'thương hiệu'} nào đã liên kết PKGX`);\r\n      return;\r\n    }\r\n    \r\n    const actionConfig = BULK_ACTION_LABELS[actionKey];\r\n    const entityLabel = entityType === 'product' ? 'sản phẩm' : 'thương hiệu';\r\n    \r\n    let description = `Bạn có chắc muốn ${actionConfig.title.toLowerCase()} cho ${linkedCount} ${entityLabel}?`;\r\n    if (unlinkedCount > 0) {\r\n      description += `\\n(${unlinkedCount} ${entityLabel} chưa liên kết sẽ bị bỏ qua)`;\r\n    }\r\n    \r\n    setConfirmAction({\r\n      open: true,\r\n      title: actionConfig.title,\r\n      description,\r\n      itemCount: linkedCount,\r\n      action: async () => {\r\n        if (entityType === 'product') {\r\n          await executeBulkSyncProducts(items as Product[], actionKey);\r\n        } else {\r\n          await executeBulkSyncBrands(items as Brand[], actionKey);\r\n        }\r\n      },\r\n    });\r\n  }, [entityType, checkPkgxEnabled, getPkgxBrandId, executeBulkSyncProducts, executeBulkSyncBrands]);\r\n  \r\n  // Execute confirmed action\r\n  const executeAction = React.useCallback(async () => {\r\n    if (confirmAction.action) {\r\n      await confirmAction.action();\r\n    }\r\n    setConfirmAction({\r\n      open: false,\r\n      title: '',\r\n      description: '',\r\n      action: null,\r\n      itemCount: 0,\r\n    });\r\n  }, [confirmAction.action]);\r\n  \r\n  // Cancel confirmation\r\n  const cancelConfirm = React.useCallback(() => {\r\n    setConfirmAction({\r\n      open: false,\r\n      title: '',\r\n      description: '',\r\n      action: null,\r\n      itemCount: 0,\r\n    });\r\n  }, []);\r\n  \r\n  return {\r\n    // Confirmation dialog state\r\n    confirmAction,\r\n    \r\n    // Progress state\r\n    progress,\r\n    \r\n    // Actions\r\n    triggerBulkSync,\r\n    executeAction,\r\n    cancelConfirm,\r\n    \r\n    // Helpers\r\n    checkPkgxEnabled,\r\n    getPkgxBrandId,\r\n    \r\n    // Direct execute (without confirm)\r\n    executeBulkSyncProducts,\r\n    executeBulkSyncBrands,\r\n  };\r\n}\r\n\r\n// Export types\r\nexport type UsePkgxBulkSyncReturn = ReturnType<typeof usePkgxBulkSync>;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3154, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/hooks/index.ts"],"sourcesContent":["export { useCategoryMappingValidation, useFieldValidation } from './use-category-mapping-validation';\r\nexport { useBrandMappingValidation } from './use-brand-mapping-validation';\r\nexport { usePkgxEntitySync, SYNC_ACTIONS } from './use-pkgx-entity-sync';\r\nexport { usePkgxBulkSync } from './use-pkgx-bulk-sync';\r\nexport type { \r\n  PkgxEntityType, \r\n  SyncActionKey, \r\n  SyncAction,\r\n  HrmCategoryData,\r\n  HrmBrandData,\r\n  HrmProductData,\r\n  ConfirmActionState,\r\n  UsePkgxEntitySyncOptions,\r\n  UsePkgxEntitySyncReturn,\r\n} from './use-pkgx-entity-sync';\r\nexport type {\r\n  BulkSyncEntityType,\r\n  BulkSyncActionKey,\r\n  BulkConfirmState,\r\n  BulkSyncProgress,\r\n  UsePkgxBulkSyncOptions,\r\n  UsePkgxBulkSyncReturn,\r\n} from './use-pkgx-bulk-sync';\r\n"],"names":[],"mappings":";AAAA;AACA;AACA;AACA"}},
    {"offset": {"line": 3167, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/hooks/use-product-mapping-validation.ts"],"sourcesContent":["import * as React from 'react';\r\nimport type { SystemId } from '@/lib/id-types';\r\nimport type { PkgxProduct } from '../types';\r\nimport {\r\n  validateProductMapping,\r\n  suggestMatchingProducts,\r\n  type ProductValidationResult,\r\n  type ProductValidationContext,\r\n  type ProductMappingInput,\r\n} from '../validation/product-mapping-validation';\r\n\r\ninterface UseProductMappingValidationOptions {\r\n  hrmProducts: Array<{\r\n    systemId: SystemId;\r\n    name: string;\r\n    id: string;\r\n    pkgxId?: number;\r\n    status?: string;\r\n    isActive?: boolean;\r\n  }>;\r\n  pkgxProducts: PkgxProduct[];\r\n  editingProductId?: string;\r\n  debounceMs?: number;\r\n}\r\n\r\ninterface UseProductMappingValidationReturn {\r\n  // Validation state\r\n  validationResult: ProductValidationResult | null;\r\n  isValidating: boolean;\r\n  \r\n  // Suggestions\r\n  suggestions: Array<{ product: UseProductMappingValidationOptions['hrmProducts'][0]; score: number; matchType: 'sku' | 'name' }>;\r\n  \r\n  // Actions\r\n  validate: (input: ProductMappingInput) => ProductValidationResult;\r\n  validateAsync: (input: ProductMappingInput) => Promise<ProductValidationResult>;\r\n  clearValidation: () => void;\r\n  updateSuggestions: (pkgxProduct: PkgxProduct) => void;\r\n  \r\n  // Helpers\r\n  hasErrors: boolean;\r\n  hasWarnings: boolean;\r\n  getFieldError: (field: string) => string | undefined;\r\n  getFieldWarning: (field: string) => string | undefined;\r\n}\r\n\r\n/**\r\n * Hook để quản lý validation cho product mapping/linking\r\n */\r\nexport function useProductMappingValidation(\r\n  options: UseProductMappingValidationOptions\r\n): UseProductMappingValidationReturn {\r\n  const {\r\n    hrmProducts,\r\n    pkgxProducts,\r\n    editingProductId,\r\n    debounceMs = 300,\r\n  } = options;\r\n\r\n  const [validationResult, setValidationResult] = React.useState<ProductValidationResult | null>(null);\r\n  const [isValidating, setIsValidating] = React.useState(false);\r\n  const [suggestions, setSuggestions] = React.useState<Array<{ product: typeof hrmProducts[0]; score: number; matchType: 'sku' | 'name' }>>([]);\r\n  \r\n  const debounceTimerRef = React.useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Create validation context\r\n  const context = React.useMemo((): ProductValidationContext => ({\r\n    hrmProducts,\r\n    pkgxProducts,\r\n    editingProductId,\r\n  }), [hrmProducts, pkgxProducts, editingProductId]);\r\n\r\n  // Update suggestions based on PKGX product\r\n  const updateSuggestions = React.useCallback((pkgxProduct: PkgxProduct) => {\r\n    const newSuggestions = suggestMatchingProducts(\r\n      { goods_name: pkgxProduct.goods_name, goods_sn: pkgxProduct.goods_sn },\r\n      hrmProducts\r\n    );\r\n    setSuggestions(newSuggestions);\r\n  }, [hrmProducts]);\r\n\r\n  // Sync validation\r\n  const validate = React.useCallback((input: ProductMappingInput): ProductValidationResult => {\r\n    const result = validateProductMapping(input, context);\r\n    setValidationResult(result);\r\n    return result;\r\n  }, [context]);\r\n\r\n  // Async validation with debounce\r\n  const validateAsync = React.useCallback(async (input: ProductMappingInput): Promise<ProductValidationResult> => {\r\n    return new Promise((resolve) => {\r\n      setIsValidating(true);\r\n      \r\n      if (debounceTimerRef.current) {\r\n        clearTimeout(debounceTimerRef.current);\r\n      }\r\n      \r\n      debounceTimerRef.current = setTimeout(() => {\r\n        const result = validate(input);\r\n        setIsValidating(false);\r\n        resolve(result);\r\n      }, debounceMs);\r\n    });\r\n  }, [validate, debounceMs]);\r\n\r\n  // Clear validation\r\n  const clearValidation = React.useCallback(() => {\r\n    setValidationResult(null);\r\n    setSuggestions([]);\r\n    if (debounceTimerRef.current) {\r\n      clearTimeout(debounceTimerRef.current);\r\n    }\r\n  }, []);\r\n\r\n  // Cleanup on unmount\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (debounceTimerRef.current) {\r\n        clearTimeout(debounceTimerRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Computed values\r\n  const hasErrors = validationResult ? validationResult.errors.length > 0 : false;\r\n  const hasWarnings = validationResult ? validationResult.warnings.length > 0 : false;\r\n\r\n  const getFieldError = React.useCallback((field: string): string | undefined => {\r\n    if (!validationResult) return undefined;\r\n    const error = validationResult.errors.find(e => e.field === field);\r\n    return error?.message;\r\n  }, [validationResult]);\r\n\r\n  const getFieldWarning = React.useCallback((field: string): string | undefined => {\r\n    if (!validationResult) return undefined;\r\n    const warning = validationResult.warnings.find(w => w.field === field);\r\n    return warning?.message;\r\n  }, [validationResult]);\r\n\r\n  return {\r\n    validationResult,\r\n    isValidating,\r\n    suggestions,\r\n    validate,\r\n    validateAsync,\r\n    clearValidation,\r\n    updateSuggestions,\r\n    hasErrors,\r\n    hasWarnings,\r\n    getFieldError,\r\n    getFieldWarning,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAGA;;;AA8CO,SAAS,4BACd,OAA2C;IAE3C,MAAM,EACJ,WAAW,EACX,YAAY,EACZ,gBAAgB,EAChB,aAAa,GAAG,EACjB,GAAG;IAEJ,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,iNAAc,CAAiC;IAC/F,MAAM,CAAC,cAAc,gBAAgB,GAAG,iNAAc,CAAC;IACvD,MAAM,CAAC,aAAa,eAAe,GAAG,iNAAc,CAAsF,EAAE;IAE5I,MAAM,mBAAmB,+MAAY,CAAwB;IAE7D,4BAA4B;IAC5B,MAAM,UAAU,gNAAa,CAAC,IAAgC,CAAC;YAC7D;YACA;YACA;QACF,CAAC,GAAG;QAAC;QAAa;QAAc;KAAiB;IAEjD,2CAA2C;IAC3C,MAAM,oBAAoB,oNAAiB,CAAC,CAAC;QAC3C,MAAM,iBAAiB,IAAA,yMAAuB,EAC5C;YAAE,YAAY,YAAY,UAAU;YAAE,UAAU,YAAY,QAAQ;QAAC,GACrE;QAEF,eAAe;IACjB,GAAG;QAAC;KAAY;IAEhB,kBAAkB;IAClB,MAAM,WAAW,oNAAiB,CAAC,CAAC;QAClC,MAAM,SAAS,IAAA,wMAAsB,EAAC,OAAO;QAC7C,oBAAoB;QACpB,OAAO;IACT,GAAG;QAAC;KAAQ;IAEZ,iCAAiC;IACjC,MAAM,gBAAgB,oNAAiB,CAAC,OAAO;QAC7C,OAAO,IAAI,QAAQ,CAAC;YAClB,gBAAgB;YAEhB,IAAI,iBAAiB,OAAO,EAAE;gBAC5B,aAAa,iBAAiB,OAAO;YACvC;YAEA,iBAAiB,OAAO,GAAG,WAAW;gBACpC,MAAM,SAAS,SAAS;gBACxB,gBAAgB;gBAChB,QAAQ;YACV,GAAG;QACL;IACF,GAAG;QAAC;QAAU;KAAW;IAEzB,mBAAmB;IACnB,MAAM,kBAAkB,oNAAiB,CAAC;QACxC,oBAAoB;QACpB,eAAe,EAAE;QACjB,IAAI,iBAAiB,OAAO,EAAE;YAC5B,aAAa,iBAAiB,OAAO;QACvC;IACF,GAAG,EAAE;IAEL,qBAAqB;IACrB,kNAAe,CAAC;QACd,OAAO;YACL,IAAI,iBAAiB,OAAO,EAAE;gBAC5B,aAAa,iBAAiB,OAAO;YACvC;QACF;IACF,GAAG,EAAE;IAEL,kBAAkB;IAClB,MAAM,YAAY,mBAAmB,iBAAiB,MAAM,CAAC,MAAM,GAAG,IAAI;IAC1E,MAAM,cAAc,mBAAmB,iBAAiB,QAAQ,CAAC,MAAM,GAAG,IAAI;IAE9E,MAAM,gBAAgB,oNAAiB,CAAC,CAAC;QACvC,IAAI,CAAC,kBAAkB,OAAO;QAC9B,MAAM,QAAQ,iBAAiB,MAAM,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK;QAC5D,OAAO,OAAO;IAChB,GAAG;QAAC;KAAiB;IAErB,MAAM,kBAAkB,oNAAiB,CAAC,CAAC;QACzC,IAAI,CAAC,kBAAkB,OAAO;QAC9B,MAAM,UAAU,iBAAiB,QAAQ,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK;QAChE,OAAO,SAAS;IAClB,GAAG;QAAC;KAAiB;IAErB,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACF;AACF"}},
    {"offset": {"line": 3277, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/pkgx-settings-page.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { TabsContent } from '../../../components/ui/tabs';\r\nimport { Globe } from 'lucide-react';\r\nimport { SettingsVerticalTabs } from '../../../components/settings/SettingsVerticalTabs';\r\nimport { useSettingsPageHeader } from '../use-settings-page-header';\r\nimport {\r\n  GeneralConfigTab,\r\n  CategoryMappingTab,\r\n  BrandMappingTab,\r\n  PriceMappingTab,\r\n  ProductMappingTab,\r\n  SyncSettingsTab,\r\n  LogTab,\r\n} from './components';\r\n\r\nconst PKGX_TABS = [\r\n  { value: 'general', label: 'Cấu hình chung' },\r\n  { value: 'category-mapping', label: 'Mapping danh mục' },\r\n  { value: 'brand-mapping', label: 'Mapping thương hiệu' },\r\n  { value: 'price-mapping', label: 'Mapping giá' },\r\n  { value: 'product-mapping', label: 'Sản phẩm đã liên kết' },\r\n  { value: 'sync', label: 'Auto Sync' },\r\n  { value: 'logs', label: 'Logs' },\r\n];\r\n\r\nexport function PkgxSettingsPage() {\r\n  const [activeTab, setActiveTab] = React.useState('general');\r\n\r\n  useSettingsPageHeader({\r\n    title: 'Website phukiengiaxuong.com.vn',\r\n    icon: <Globe className=\"h-5 w-5 text-rose-600\" />,\r\n    breadcrumb: [\r\n      { label: 'Tích hợp PKGX', href: '/settings/pkgx', isCurrent: true },\r\n    ],\r\n  });\r\n\r\n  return (\r\n    <SettingsVerticalTabs\r\n      value={activeTab}\r\n      onValueChange={setActiveTab}\r\n      tabs={PKGX_TABS}\r\n    >\r\n      <TabsContent value=\"general\" className=\"mt-0\">\r\n        <GeneralConfigTab />\r\n      </TabsContent>\r\n\r\n      <TabsContent value=\"category-mapping\" className=\"mt-0\">\r\n        <CategoryMappingTab />\r\n      </TabsContent>\r\n\r\n      <TabsContent value=\"brand-mapping\" className=\"mt-0\">\r\n        <BrandMappingTab />\r\n      </TabsContent>\r\n\r\n      <TabsContent value=\"price-mapping\" className=\"mt-0\">\r\n        <PriceMappingTab />\r\n      </TabsContent>\r\n\r\n      <TabsContent value=\"product-mapping\" className=\"mt-0\">\r\n        <ProductMappingTab />\r\n      </TabsContent>\r\n\r\n      <TabsContent value=\"sync\" className=\"mt-0\">\r\n        <SyncSettingsTab />\r\n      </TabsContent>\r\n\r\n      <TabsContent value=\"logs\" className=\"mt-0\">\r\n        <LogTab />\r\n      </TabsContent>\r\n    </SettingsVerticalTabs>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;AAUA,MAAM,YAAY;IAChB;QAAE,OAAO;QAAW,OAAO;IAAiB;IAC5C;QAAE,OAAO;QAAoB,OAAO;IAAmB;IACvD;QAAE,OAAO;QAAiB,OAAO;IAAsB;IACvD;QAAE,OAAO;QAAiB,OAAO;IAAc;IAC/C;QAAE,OAAO;QAAmB,OAAO;IAAuB;IAC1D;QAAE,OAAO;QAAQ,OAAO;IAAY;IACpC;QAAE,OAAO;QAAQ,OAAO;IAAO;CAChC;AAEM,SAAS;IACd,MAAM,CAAC,WAAW,aAAa,GAAG,iNAAc,CAAC;IAEjD,IAAA,mLAAqB,EAAC;QACpB,OAAO;QACP,oBAAM,8OAAC,6MAAK;YAAC,WAAU;;;;;;QACvB,YAAY;YACV;gBAAE,OAAO;gBAAiB,MAAM;gBAAkB,WAAW;YAAK;SACnE;IACH;IAEA,qBACE,8OAAC,uKAAoB;QACnB,OAAO;QACP,eAAe;QACf,MAAM;;0BAEN,8OAAC,wIAAW;gBAAC,OAAM;gBAAU,WAAU;0BACrC,cAAA,8OAAC,2LAAgB;;;;;;;;;;0BAGnB,8OAAC,wIAAW;gBAAC,OAAM;gBAAmB,WAAU;0BAC9C,cAAA,8OAAC,+LAAkB;;;;;;;;;;0BAGrB,8OAAC,wIAAW;gBAAC,OAAM;gBAAgB,WAAU;0BAC3C,cAAA,8OAAC,yLAAe;;;;;;;;;;0BAGlB,8OAAC,wIAAW;gBAAC,OAAM;gBAAgB,WAAU;0BAC3C,cAAA,8OAAC,yLAAe;;;;;;;;;;0BAGlB,8OAAC,wIAAW;gBAAC,OAAM;gBAAkB,WAAU;0BAC7C,cAAA,8OAAC,6LAAiB;;;;;;;;;;0BAGpB,8OAAC,wIAAW;gBAAC,OAAM;gBAAO,WAAU;0BAClC,cAAA,8OAAC,yLAAe;;;;;;;;;;0BAGlB,8OAAC,wIAAW;gBAAC,OAAM;gBAAO,WAAU;0BAClC,cAAA,8OAAC,mKAAM;;;;;;;;;;;;;;;;AAIf"}}]
}