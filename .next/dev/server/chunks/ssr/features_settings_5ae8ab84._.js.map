{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/inventory/product-category-store.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { asSystemId, asBusinessId, type SystemId, type BusinessId } from '@/lib/id-types';\r\nimport type { ProductCategory } from './types';\r\n\r\nconst generateSystemId = (counter: number): SystemId => {\r\n  return asSystemId(`CATEGORY${String(counter + 1).padStart(6, '0')}`);\r\n};\r\n\r\nconst generateBusinessId = (counter: number): BusinessId => {\r\n  return asBusinessId(`DM${String(counter + 1).padStart(6, '0')}`);\r\n};\r\n\r\n// Helper to calculate path and level\r\nconst calculatePathAndLevel = (category: ProductCategory, allCategories: ProductCategory[]): { path: string; level: number } => {\r\n  if (!category.parentId) {\r\n    return { path: category.name, level: 0 };\r\n  }\r\n  \r\n  const parent = allCategories.find(c => c.systemId === category.parentId);\r\n  if (!parent) {\r\n    return { path: category.name, level: 0 };\r\n  }\r\n  \r\n  const parentInfo = calculatePathAndLevel(parent, allCategories);\r\n  return {\r\n    path: `${parentInfo.path} > ${category.name}`,\r\n    level: parentInfo.level + 1\r\n  };\r\n};\r\n\r\ninterface ProductCategoryState {\r\n  data: ProductCategory[];\r\n  counter: number;\r\n  initialized: boolean;\r\n  add: (category: Omit<ProductCategory, 'systemId' | 'id' | 'path' | 'level'> & { id?: string }) => ProductCategory;\r\n  update: (systemId: SystemId, updates: Partial<ProductCategory>) => void;\r\n  remove: (systemId: SystemId) => void;\r\n  findById: (systemId: SystemId) => ProductCategory | undefined;\r\n  findByBusinessId: (id: BusinessId) => ProductCategory | undefined;\r\n  getActive: () => ProductCategory[];\r\n  getByParent: (parentId?: SystemId) => ProductCategory[];\r\n  updateSortOrder: (systemId: SystemId, newSortOrder: number) => void;\r\n  moveCategory: (systemId: SystemId, newParentId: SystemId | undefined, newSortOrder: number) => void;\r\n  recalculatePaths: () => void;\r\n  getNextId: () => BusinessId;\r\n  isBusinessIdExists: (id: string) => boolean;\r\n  loadFromAPI: () => Promise<void>;\r\n}\r\n\r\n// API sync helper\r\nasync function syncCategoryToAPI(category: ProductCategory, action: 'create' | 'update' | 'delete'): Promise<boolean> {\r\n  try {\r\n    const endpoint = action === 'create' ? '/api/categories' : `/api/categories/${category.systemId}`;\r\n    const response = await fetch(endpoint, {\r\n      method: action === 'create' ? 'POST' : action === 'delete' ? 'DELETE' : 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify(category),\r\n    });\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error('syncCategoryToAPI error:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const useProductCategoryStore = create<ProductCategoryState>()(\r\n  (set, get) => ({\r\n    data: [],\r\n    counter: 0,\r\n    initialized: false,\r\n      \r\n    add: (category) => {\r\n        const currentCounter = get().counter;\r\n        const allData = get().data;\r\n        const { id, ...rest } = category;\r\n        \r\n        const businessId = id && id.trim() \r\n          ? asBusinessId(id.trim())\r\n          : generateBusinessId(currentCounter);\r\n        \r\n        const { path, level } = calculatePathAndLevel(\r\n          { ...rest, systemId: 'temp' as SystemId, id: businessId, path: '', level: 0 } as ProductCategory,\r\n          allData\r\n        );\r\n        \r\n        const newCategory: ProductCategory = {\r\n          ...rest,\r\n          systemId: generateSystemId(currentCounter),\r\n          id: businessId,\r\n          path,\r\n          level,\r\n          createdAt: new Date().toISOString(),\r\n          isDeleted: false,\r\n          isActive: category.isActive !== undefined ? category.isActive : true,\r\n        };\r\n        set((state) => ({ \r\n          data: [...state.data, newCategory],\r\n          counter: state.counter + 1,\r\n        }));\r\n        get().recalculatePaths();\r\n        return newCategory;\r\n      },\r\n      \r\n      update: (systemId, updates) => {\r\n        set((state) => ({\r\n          data: state.data.map((item) =>\r\n            item.systemId === systemId\r\n              ? { ...item, ...updates, updatedAt: new Date().toISOString() }\r\n              : item\r\n          ),\r\n        }));\r\n        get().recalculatePaths();\r\n      },\r\n      \r\n      remove: (systemId) => {\r\n        set((state) => ({\r\n          data: state.data.map((item) =>\r\n            item.systemId === systemId\r\n              ? { ...item, isDeleted: true, updatedAt: new Date().toISOString() }\r\n              : item\r\n          ),\r\n        }));\r\n      },\r\n      \r\n      findById: (systemId) => {\r\n        return get().data.find((item) => item.systemId === systemId && !item.isDeleted);\r\n      },\r\n      \r\n      findByBusinessId: (id) => {\r\n        return get().data.find((item) => item.id === id && !item.isDeleted);\r\n      },\r\n      \r\n      getActive: () => {\r\n        return get().data.filter((item) => !item.isDeleted && item.isActive);\r\n      },\r\n      \r\n      getByParent: (parentId) => {\r\n        return get().data.filter(\r\n          (item) => !item.isDeleted && item.isActive && item.parentId === parentId\r\n        ).sort((a, b) => (a.sortOrder ?? 0) - (b.sortOrder ?? 0));\r\n      },\r\n\r\n      updateSortOrder: (systemId, newSortOrder) => {\r\n        set((state) => ({\r\n          data: state.data.map((item) =>\r\n            item.systemId === systemId\r\n              ? { ...item, sortOrder: newSortOrder, updatedAt: new Date().toISOString() }\r\n              : item\r\n          ),\r\n        }));\r\n      },\r\n\r\n      moveCategory: (systemId, newParentId, newSortOrder) => {\r\n        set((state) => ({\r\n          data: state.data.map((item) =>\r\n            item.systemId === systemId\r\n              ? { \r\n                  ...item, \r\n                  parentId: newParentId, \r\n                  sortOrder: newSortOrder,\r\n                  updatedAt: new Date().toISOString() \r\n                }\r\n              : item\r\n          ),\r\n        }));\r\n        get().recalculatePaths();\r\n      },\r\n\r\n      recalculatePaths: () => {\r\n        set((state) => {\r\n          const allData = [...state.data];\r\n          const updated = allData.map(cat => {\r\n            if (cat.isDeleted) return cat;\r\n            const { path, level } = calculatePathAndLevel(cat, allData);\r\n            return { ...cat, path, level };\r\n          });\r\n          return { data: updated };\r\n        });\r\n      },\r\n      \r\n      getNextId: () => generateBusinessId(get().counter),\r\n      \r\n      isBusinessIdExists: (id: string) => get().data.some((item) => String(item.id) === id),\r\n\r\n      loadFromAPI: async () => {\r\n        if (get().initialized) return;\r\n        try {\r\n          const response = await fetch('/api/categories?all=true');\r\n          if (response.ok) {\r\n            const json = await response.json();\r\n            if (json.data && Array.isArray(json.data)) {\r\n              const categories: ProductCategory[] = json.data.map((item: Record<string, unknown>) => ({\r\n                ...item,\r\n                systemId: asSystemId(item.systemId as string),\r\n                id: asBusinessId(item.id as string),\r\n                parentId: item.parentId ? asSystemId(item.parentId as string) : undefined,\r\n                // Add default values for fields not in database\r\n                isActive: item.isDeleted !== true,\r\n                color: item.color as string || '#6366f1',\r\n                path: '',\r\n                level: 0,\r\n              }));\r\n              set({ \r\n                data: categories, \r\n                counter: categories.length,\r\n                initialized: true,\r\n              });\r\n              get().recalculatePaths();\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('loadFromAPI error:', error);\r\n        }\r\n        set({ initialized: true });\r\n      },\r\n    })\r\n);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 202, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/inventory/product-type-store.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { asSystemId, asBusinessId, type SystemId } from '@/lib/id-types';\r\nimport type { ProductType } from './types';\r\n\r\nconst generateId = () => crypto.randomUUID();\r\n\r\n// API sync helper\r\nasync function syncToAPI(action: 'create' | 'update' | 'delete', data: Partial<ProductType>): Promise<boolean> {\r\n  try {\r\n    const endpoint = action === 'create' ? '/api/settings/product-types' : `/api/settings/product-types/${data.systemId}`;\r\n    const method = action === 'create' ? 'POST' : action === 'update' ? 'PATCH' : 'DELETE';\r\n    const response = await fetch(endpoint, {\r\n      method,\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: action !== 'delete' ? JSON.stringify(data) : undefined,\r\n    });\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error(`[Product Type API] ${action} error:`, error);\r\n    return false;\r\n  }\r\n}\r\n\r\ninterface ProductTypeState {\r\n  data: ProductType[];\r\n  initialized: boolean;\r\n  add: (productType: Omit<ProductType, 'systemId'>) => ProductType;\r\n  update: (systemId: SystemId, updates: Partial<ProductType>) => void;\r\n  remove: (systemId: SystemId) => void;\r\n  findById: (systemId: SystemId) => ProductType | undefined;\r\n  getActive: () => ProductType[];\r\n  loadFromAPI: () => Promise<void>;\r\n}\r\n\r\nconst rawData = [\r\n  {\r\n    systemId: generateId(),\r\n    id: 'PT001',\r\n    name: 'Hàng hóa',\r\n    description: 'Sản phẩm vật lý có tồn kho',\r\n    isDefault: true,\r\n    isActive: true,\r\n    createdAt: new Date().toISOString(),\r\n  },\r\n  {\r\n    systemId: generateId(),\r\n    id: 'PT002',\r\n    name: 'Dịch vụ',\r\n    description: 'Dịch vụ không có tồn kho',\r\n    isActive: true,\r\n    createdAt: new Date().toISOString(),\r\n  },\r\n  {\r\n    systemId: generateId(),\r\n    id: 'PT003',\r\n    name: 'Digital',\r\n    description: 'Sản phẩm số (ebook, khóa học online...)',\r\n    isActive: true,\r\n    createdAt: new Date().toISOString(),\r\n  },\r\n] as const;\r\n\r\nconst initialData: ProductType[] = rawData.map((item) => ({\r\n  ...item,\r\n  systemId: asSystemId(item.systemId),\r\n  id: asBusinessId(item.id),\r\n}));\r\n\r\nexport const useProductTypeStore = create<ProductTypeState>()(\r\n  (set, get) => ({\r\n    data: initialData,\r\n    initialized: false,\r\n    \r\n    add: (productType) => {\r\n      const newProductType: ProductType = {\r\n        ...productType,\r\n        systemId: asSystemId(generateId()),\r\n        createdAt: new Date().toISOString(),\r\n        isDeleted: false,\r\n      };\r\n      set((state) => ({ data: [...state.data, newProductType] }));\r\n      syncToAPI('create', newProductType).catch(console.error);\r\n      return newProductType;\r\n    },\r\n    \r\n    update: (systemId, updates) => {\r\n      set((state) => ({\r\n        data: state.data.map((item) =>\r\n          item.systemId === systemId\r\n            ? { ...item, ...updates, updatedAt: new Date().toISOString() }\r\n            : item\r\n        ),\r\n      }));\r\n      const updated = get().data.find(i => i.systemId === systemId);\r\n      if (updated) syncToAPI('update', updated).catch(console.error);\r\n    },\r\n    \r\n    remove: (systemId) => {\r\n      set((state) => ({\r\n        data: state.data.map((item) =>\r\n          item.systemId === systemId\r\n            ? { ...item, isDeleted: true, updatedAt: new Date().toISOString() }\r\n            : item\r\n        ),\r\n      }));\r\n      syncToAPI('delete', { systemId }).catch(console.error);\r\n    },\r\n    \r\n    findById: (systemId) => {\r\n      return get().data.find((item) => item.systemId === systemId && !item.isDeleted);\r\n    },\r\n    \r\n    getActive: () => {\r\n      return get().data.filter((item) => !item.isDeleted && item.isActive !== false);\r\n    },\r\n    \r\n    loadFromAPI: async () => {\r\n      if (get().initialized) return;\r\n      try {\r\n        // NOTE: Settings data is typically small, but using limit for consistency\r\n        const response = await fetch('/api/settings/product-types?limit=50');\r\n        if (response.ok) {\r\n          const json = await response.json();\r\n          const data = json.data || [];\r\n          if (data.length > 0) {\r\n            set({ data: data.map((item: any) => ({\r\n              ...item,\r\n              systemId: asSystemId(item.systemId),\r\n              id: asBusinessId(item.id),\r\n            })), initialized: true });\r\n          } else {\r\n            set({ initialized: true });\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('[Product Type Store] loadFromAPI error:', error);\r\n      }\r\n    },\r\n  })\r\n);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 341, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/types.ts"],"sourcesContent":["import type { SystemId } from '@/lib/id-types';\r\n\r\n// ========================================\r\n// PKGX Reference Data Types\r\n// ========================================\r\n\r\n/**\r\n * Danh mục PKGX (cat_id từ ECShop)\r\n */\r\nexport type PkgxCategory = {\r\n  id: number;         // cat_id trên PKGX\r\n  name: string;       // Tên danh mục\r\n  parentId?: number;  // Parent category (nếu có)\r\n  sortOrder?: number; // Thứ tự sắp xếp\r\n  isShow?: number;    // Hiển thị (1=hiện, 0=ẩn)\r\n  // SEO fields\r\n  cat_desc?: string;      // Mô tả danh mục ngắn\r\n  long_desc?: string;     // Mô tả danh mục dài (HTML)\r\n  keywords?: string;      // SEO keywords\r\n  meta_title?: string;    // Meta title\r\n  meta_desc?: string;     // Meta description\r\n  cat_alias?: string;     // Slug/alias\r\n  style?: string;         // Template style\r\n  grade?: number;         // Cấp độ danh mục\r\n  filter_attr?: string;   // Filter attributes\r\n};\r\n\r\n/**\r\n * Thương hiệu PKGX (brand_id từ ECShop)\r\n */\r\nexport type PkgxBrand = {\r\n  id: number;           // brand_id trên PKGX\r\n  name: string;         // Tên thương hiệu\r\n  // Basic fields\r\n  logo?: string;          // Logo URL\r\n  description?: string;   // Mô tả thương hiệu (brand_desc)\r\n  siteUrl?: string;       // Website URL\r\n  sortOrder?: number;     // Thứ tự sắp xếp\r\n  isShow?: number;        // Hiển thị (1=hiện, 0=ẩn)\r\n  // SEO fields\r\n  keywords?: string;      // Keywords\r\n  metaTitle?: string;     // Meta title\r\n  metaDesc?: string;      // Meta description\r\n  // Description fields\r\n  shortDescription?: string;  // Mô tả ngắn (short_desc)\r\n  longDescription?: string;   // Mô tả dài (long_desc)\r\n  // Legacy fields (backward compatibility)\r\n  brand_logo?: string;    // Logo URL (legacy)\r\n  brand_desc?: string;    // Mô tả thương hiệu (HTML) (legacy)\r\n  site_url?: string;      // Website URL (legacy)\r\n  sort_order?: number;    // Thứ tự sắp xếp (legacy)\r\n};\r\n\r\n/**\r\n * Ảnh trong gallery sản phẩm PKGX\r\n */\r\nexport type PkgxGalleryImage = {\r\n  img_id: number;           // ID ảnh trong gallery\r\n  goods_id: number;         // ID sản phẩm\r\n  img_url: string;          // Đường dẫn ảnh gốc\r\n  thumb_url: string;        // Đường dẫn thumbnail\r\n  img_desc?: string;        // Mô tả ảnh\r\n  img_original?: string;    // Ảnh gốc (nếu có)\r\n};\r\n\r\n// ========================================\r\n// Mapping Types\r\n// ========================================\r\n\r\n/**\r\n * Mapping danh mục HRM → PKGX\r\n */\r\nexport type PkgxCategoryMapping = {\r\n  id: string;                     // Unique mapping ID\r\n  hrmCategorySystemId: SystemId;  // Category systemId trong HRM\r\n  hrmCategoryName: string;        // Tên hiển thị HRM\r\n  pkgxCatId: number;              // cat_id trên PKGX\r\n  pkgxCatName: string;            // Tên danh mục PKGX\r\n};\r\n\r\n/**\r\n * Mapping thương hiệu HRM → PKGX\r\n */\r\nexport type PkgxBrandMapping = {\r\n  id: string;                     // Unique mapping ID\r\n  hrmBrandSystemId: SystemId;     // Brand systemId trong HRM\r\n  hrmBrandName: string;           // Tên hiển thị HRM\r\n  pkgxBrandId: number;            // brand_id trên PKGX\r\n  pkgxBrandName: string;          // Tên thương hiệu PKGX\r\n};\r\n\r\n/**\r\n * Mapping bảng giá HRM → các loại giá PKGX\r\n */\r\nexport type PkgxPriceMapping = {\r\n  shopPrice: SystemId | null;     // Bảng giá → shop_price (giá bán)\r\n  marketPrice: SystemId | null;   // Bảng giá → market_price (giá thị trường)\r\n  partnerPrice: SystemId | null;  // Bảng giá → partner_price (giá đối tác)\r\n  acePrice: SystemId | null;      // Bảng giá → ace_price\r\n  dealPrice: SystemId | null;     // Bảng giá → deal_price\r\n};\r\n\r\n// ========================================\r\n// Sync Settings Types\r\n// ========================================\r\n\r\n/**\r\n * Cài đặt đồng bộ tự động\r\n */\r\nexport type PkgxSyncSettings = {\r\n  autoSyncEnabled: boolean;       // Bật/tắt auto sync\r\n  intervalMinutes: number;        // Tần suất (15, 30, 60, 120, 240)\r\n  syncInventory: boolean;         // Đồng bộ tồn kho\r\n  syncPrice: boolean;             // Đồng bộ giá\r\n  syncSeo: boolean;               // Đồng bộ SEO (meta_title, meta_desc, keywords)\r\n  syncOnProductUpdate: boolean;   // Sync ngay khi update SP trong HRM\r\n  notifyOnError: boolean;         // Thông báo khi có lỗi\r\n};\r\n\r\n/**\r\n * Log đồng bộ PKGX - Ghi lại TẤT CẢ các API call\r\n */\r\nexport type PkgxSyncLog = {\r\n  id: string;                     // Unique log ID\r\n  timestamp: string;              // ISO timestamp\r\n  action: \r\n    | 'test_connection'           // Test kết nối API\r\n    | 'ping'                      // Ping server\r\n    | 'sync_all'                  // Đồng bộ toàn bộ\r\n    | 'sync_price'                // Đồng bộ giá\r\n    | 'sync_inventory'            // Đồng bộ tồn kho\r\n    | 'sync_seo'                  // Đồng bộ SEO\r\n    | 'sync_description'          // Đồng bộ mô tả\r\n    | 'sync_flags'                // Đồng bộ flags (isHot, isNew, etc.)\r\n    | 'sync_basic'                // Đồng bộ thông tin cơ bản (alias)\r\n    | 'sync_basic_info'           // Đồng bộ thông tin cơ bản\r\n    | 'sync_images'               // Đồng bộ ảnh sản phẩm\r\n    | 'create_product'            // Tạo sản phẩm mới trên PKGX\r\n    | 'update_product'            // Cập nhật sản phẩm\r\n    | 'link_product'              // Liên kết SP HRM với PKGX\r\n    | 'unlink_product'            // Hủy liên kết SP\r\n    | 'unlink_mapping'            // Hủy liên kết mapping (category/brand)\r\n    | 'batch_unlink'              // Hủy liên kết hàng loạt\r\n    | 'bulk_sync_all'             // Bulk: Đồng bộ toàn bộ\r\n    | 'bulk_sync_basic'           // Bulk: Đồng bộ thông tin cơ bản\r\n    | 'bulk_sync_price'           // Bulk: Đồng bộ giá\r\n    | 'bulk_sync_inventory'       // Bulk: Đồng bộ tồn kho\r\n    | 'bulk_sync_seo'             // Bulk: Đồng bộ SEO\r\n    | 'bulk_sync_description'     // Bulk: Đồng bộ mô tả\r\n    | 'bulk_sync_flags'           // Bulk: Đồng bộ flags\r\n    | 'bulk_sync_images'          // Bulk: Đồng bộ ảnh\r\n    | 'sync_categories'           // Đồng bộ danh mục\r\n    | 'sync_brands'               // Đồng bộ thương hiệu\r\n    | 'get_products'              // Lấy danh sách SP từ PKGX\r\n    | 'upload_image'              // Upload ảnh sản phẩm\r\n    | 'save_config'               // Lưu cấu hình\r\n    | 'save_mapping';             // Lưu mapping\r\n  status: 'success' | 'error' | 'partial' | 'info';\r\n  message: string;                // Log message\r\n  // User info - Ai thực hiện action\r\n  userId?: string;                // User systemId hoặc 'SYSTEM'\r\n  userName?: string;              // Tên người dùng\r\n  details?: {\r\n    // Request info\r\n    url?: string;\r\n    method?: string;\r\n    // Response info\r\n    responseTime?: number;        // ms\r\n    httpStatus?: number;\r\n    // Data info\r\n    total?: number;\r\n    success?: number;\r\n    failed?: number;\r\n    productId?: string;\r\n    productName?: string;\r\n    pkgxId?: number;\r\n    inventory?: number;\r\n    categoryId?: number;\r\n    brandId?: number;\r\n    // Error info\r\n    error?: string;\r\n    errorCode?: string;\r\n  };\r\n};\r\n\r\n/**\r\n * Kết quả sync gần nhất\r\n */\r\nexport type PkgxSyncResult = {\r\n  status: 'success' | 'partial' | 'error';\r\n  total: number;\r\n  success: number;\r\n  failed: number;\r\n  errors?: string[];\r\n};\r\n\r\n// ========================================\r\n// Main PKGX Settings Type\r\n// ========================================\r\n\r\n/**\r\n * Toàn bộ cài đặt PKGX\r\n */\r\nexport type PkgxSettings = {\r\n  // === General Config ===\r\n  apiUrl: string;\r\n  apiKey: string;\r\n  enabled: boolean;                // Bật/tắt tích hợp PKGX\r\n  \r\n  // === Reference Data ===\r\n  categories: PkgxCategory[];\r\n  brands: PkgxBrand[];\r\n  \r\n  // === Mappings ===\r\n  priceMapping: PkgxPriceMapping;\r\n  categoryMappings: PkgxCategoryMapping[];\r\n  brandMappings: PkgxBrandMapping[];\r\n  \r\n  // === Sync Settings ===\r\n  syncSettings: PkgxSyncSettings;\r\n  \r\n  // === Status ===\r\n  lastSyncAt?: string;\r\n  lastSyncResult?: PkgxSyncResult;\r\n  connectionStatus?: 'connected' | 'disconnected' | 'error';\r\n  connectionError?: string;\r\n  \r\n  // === Logs ===\r\n  logs: PkgxSyncLog[];\r\n  \r\n  // === Cached PKGX Products ===\r\n  pkgxProducts: PkgxProduct[];     // Sản phẩm từ PKGX - lưu cache để không mất khi chuyển tab\r\n  pkgxProductsLastFetch?: string;  // Thời gian fetch gần nhất\r\n};\r\n\r\n// ========================================\r\n// PKGX Product Response Types (từ API)\r\n// ========================================\r\n\r\n/**\r\n * Sản phẩm trả về từ PKGX API\r\n * \r\n * Lưu ý quan trọng:\r\n * - goods_id: Primary Key, dùng để update/link sản phẩm qua API\r\n * - goods_sn: Mã SKU của sản phẩm, có thể sync với HRM.sku\r\n */\r\nexport type PkgxProduct = {\r\n  goods_id: number;      // PRIMARY KEY - Dùng để update sản phẩm qua API\r\n  goods_name: string;\r\n  goods_sn: string;      // Mã SKU - map với HRM Product.sku\r\n  cat_id: number;\r\n  brand_id: number;\r\n  shop_price: number;\r\n  market_price: number;\r\n  partner_price: number;\r\n  ace_price?: number;\r\n  deal_price?: number;\r\n  goods_number: number;\r\n  goods_desc: string;\r\n  keywords: string;\r\n  goods_brief: string;\r\n  meta_title: string;\r\n  meta_desc: string;\r\n  goods_img: string;\r\n  goods_thumb: string;\r\n  original_img: string;\r\n  is_on_sale: number;\r\n  is_best: number;\r\n  is_hot: number;\r\n  is_new: number;\r\n  is_home: number;\r\n  slug: string;\r\n  seller_note?: string;\r\n  add_time?: number;\r\n  last_update?: number;\r\n};\r\n\r\n/**\r\n * Response phân trang từ get_products\r\n */\r\nexport type PkgxProductsResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  pagination: {\r\n    total_items: number;\r\n    total_pages: number;\r\n    current_page: number;\r\n    per_page: number;\r\n  };\r\n  data: PkgxProduct[];\r\n};\r\n\r\n/**\r\n * Response upload ảnh\r\n */\r\nexport type PkgxImageUploadResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  data: {\r\n    original_img: string;\r\n    goods_img: string;\r\n    goods_thumb: string;\r\n    full_urls: {\r\n      original: string;\r\n      goods: string;\r\n      thumb: string;\r\n    };\r\n  };\r\n  goods_id?: number;\r\n  product_updated?: boolean;\r\n};\r\n\r\n/**\r\n * Response lấy danh sách danh mục từ PKGX API\r\n */\r\nexport type PkgxCategoryFromApi = {\r\n  cat_id: number;\r\n  cat_name: string;\r\n  parent_id: number;\r\n  sort_order: number;\r\n  is_show?: number; // 0 or 1\r\n  // SEO fields\r\n  cat_desc?: string;\r\n  long_desc?: string;\r\n  keywords?: string;\r\n  meta_title?: string;\r\n  meta_desc?: string;\r\n  cat_alias?: string;\r\n  style?: string;\r\n  grade?: number;\r\n  filter_attr?: string;\r\n};\r\n\r\nexport type PkgxCategoriesResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  total: number;\r\n  data: PkgxCategoryFromApi[];\r\n};\r\n\r\n/**\r\n * Response lấy danh sách thương hiệu từ PKGX API\r\n */\r\nexport type PkgxBrandFromApi = {\r\n  brand_id: number;\r\n  brand_name: string;\r\n  brand_logo?: string;\r\n  brand_desc?: string;\r\n  short_desc?: string;\r\n  long_desc?: string;\r\n  keywords?: string;\r\n  meta_title?: string;\r\n  meta_desc?: string;\r\n  site_url?: string;\r\n  sort_order: number;\r\n  is_show?: number; // 0 or 1\r\n};\r\n\r\nexport type PkgxBrandsResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  total: number;\r\n  data: PkgxBrandFromApi[];\r\n};\r\n\r\n/**\r\n * Response lấy gallery ảnh sản phẩm từ PKGX API\r\n */\r\nexport type PkgxGalleryResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  goods_id: number;\r\n  total: number;\r\n  data: PkgxGalleryImage[];\r\n};\r\n\r\n/**\r\n * Payload tạo/cập nhật sản phẩm\r\n */\r\nexport type PkgxProductPayload = {\r\n  goods_name?: string;\r\n  goods_sn?: string;\r\n  cat_id?: number;\r\n  brand_id?: number;\r\n  shop_price?: number;\r\n  market_price?: number;\r\n  partner_price?: number;\r\n  ace_price?: number;\r\n  deal_price?: number;\r\n  goods_number?: number;\r\n  goods_desc?: string;\r\n  keywords?: string;\r\n  goods_brief?: string;\r\n  meta_title?: string;\r\n  meta_desc?: string;\r\n  original_img?: string;\r\n  gallery_images?: string[];  // Album ảnh sản phẩm\r\n  best?: boolean;\r\n  hot?: boolean;\r\n  new?: boolean;\r\n  ishome?: boolean;\r\n  is_on_sale?: boolean;  // Hiển thị đăng web (on/off trên website PKGX)\r\n  seller_note?: string;\r\n};\r\n\r\n// ========================================\r\n// UI State Types\r\n// ========================================\r\n\r\nexport type PkgxSettingsTab = \r\n  | 'general'\r\n  | 'categories'\r\n  | 'brands'\r\n  | 'category-mapping'\r\n  | 'brand-mapping'\r\n  | 'price-mapping'\r\n  | 'product-mapping'\r\n  | 'sync';\r\n\r\nexport type ConnectionTestResult = {\r\n  success: boolean;\r\n  message: string;\r\n  productCount?: number;\r\n};\r\n\r\n// ========================================\r\n// Default Values\r\n// ========================================\r\n\r\nexport const DEFAULT_PKGX_SETTINGS: PkgxSettings = {\r\n  apiUrl: 'https://phukiengiaxuong.com.vn/admin/api_product_pro.php',\r\n  apiKey: '',\r\n  enabled: false,\r\n  \r\n  categories: [],\r\n  brands: [],\r\n  \r\n  priceMapping: {\r\n    shopPrice: null,\r\n    marketPrice: null,\r\n    partnerPrice: null,\r\n    acePrice: null,\r\n    dealPrice: null,\r\n  },\r\n  categoryMappings: [],\r\n  brandMappings: [],\r\n  \r\n  syncSettings: {\r\n    autoSyncEnabled: false,\r\n    intervalMinutes: 30,\r\n    syncInventory: true,\r\n    syncPrice: true,\r\n    syncSeo: false,\r\n    syncOnProductUpdate: true,\r\n    notifyOnError: true,\r\n  },\r\n  \r\n  logs: [],\r\n  \r\n  // Cached PKGX Products\r\n  pkgxProducts: [],\r\n  pkgxProductsLastFetch: undefined,\r\n};\r\n\r\nexport const SYNC_INTERVAL_OPTIONS = [\r\n  { value: 15, label: '15 phút' },\r\n  { value: 30, label: '30 phút' },\r\n  { value: 60, label: '1 giờ' },\r\n  { value: 120, label: '2 giờ' },\r\n  { value: 240, label: '4 giờ' },\r\n];\r\n"],"names":[],"mappings":";;;;;;AA6aO,MAAM,wBAAsC;IACjD,QAAQ;IACR,QAAQ;IACR,SAAS;IAET,YAAY,EAAE;IACd,QAAQ,EAAE;IAEV,cAAc;QACZ,WAAW;QACX,aAAa;QACb,cAAc;QACd,UAAU;QACV,WAAW;IACb;IACA,kBAAkB,EAAE;IACpB,eAAe,EAAE;IAEjB,cAAc;QACZ,iBAAiB;QACjB,iBAAiB;QACjB,eAAe;QACf,WAAW;QACX,SAAS;QACT,qBAAqB;QACrB,eAAe;IACjB;IAEA,MAAM,EAAE;IAER,uBAAuB;IACvB,cAAc,EAAE;IAChB,uBAAuB;AACzB;AAEO,MAAM,wBAAwB;IACnC;QAAE,OAAO;QAAI,OAAO;IAAU;IAC9B;QAAE,OAAO;QAAI,OAAO;IAAU;IAC9B;QAAE,OAAO;QAAI,OAAO;IAAQ;IAC5B;QAAE,OAAO;QAAK,OAAO;IAAQ;IAC7B;QAAE,OAAO;QAAK,OAAO;IAAQ;CAC9B"}},
    {"offset": {"line": 402, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/constants.ts"],"sourcesContent":["import type { PkgxCategory, PkgxBrand } from './types';\r\n\r\n/**\r\n * Danh sách danh mục PKGX (cat_id từ ECShop)\r\n * Nguồn: idpkgx.xlsx\r\n */\r\nexport const PKGX_CATEGORIES: PkgxCategory[] = [\r\n  // === Danh mục chính - Hàng theo loại ===\r\n  { id: 382, name: 'Sản phẩm mới' },\r\n  { id: 302, name: 'Hàng Theo Loại Bán' },\r\n  { id: 413, name: 'Hàng Hot Trend' },\r\n  { id: 390, name: 'Hàng Bán Chạy' },\r\n  { id: 389, name: 'Hàng Thanh Lý' },\r\n  { id: 387, name: 'Hàng Độc Quyền' },\r\n  { id: 391, name: 'Hàng bán Sàn TMĐT' },\r\n  { id: 388, name: 'Hàng Tặng Kèm' },\r\n  { id: 386, name: 'Hàng Chợ' },\r\n  \r\n  // === Tai nghe ===\r\n  { id: 37, name: 'Sỉ tai nghe' },\r\n  { id: 315, name: 'Tai nghe Bluetooth TWS' },\r\n  { id: 314, name: 'Tai nghe có dây' },\r\n  { id: 316, name: 'Tai nghe chụp tai bluetooth' },\r\n  { id: 375, name: 'Tai nghe bluetooth 1 bên' },\r\n  { id: 376, name: 'Tai nghe bluetooth thể thao' },\r\n  { id: 377, name: 'Tai nghe chụp tai Gaming' },\r\n  { id: 384, name: 'Case Tai Nghe Bluetooth' },\r\n  \r\n  // === Cáp sạc ===\r\n  { id: 38, name: 'Sỉ cáp sạc' },\r\n  { id: 317, name: 'Cáp sạc Type-C' },\r\n  { id: 318, name: 'Cáp sạc Lightning' },\r\n  { id: 319, name: 'Cáp sạc Micro USB' },\r\n  { id: 320, name: 'Cáp sạc đa năng' },\r\n  { id: 378, name: 'Cáp sạc nhanh' },\r\n  \r\n  // === Củ sạc ===\r\n  { id: 39, name: 'Sỉ củ sạc' },\r\n  { id: 321, name: 'Củ sạc nhanh' },\r\n  { id: 322, name: 'Củ sạc thường' },\r\n  { id: 323, name: 'Củ sạc không dây' },\r\n  { id: 379, name: 'Củ sạc Magsafe' },\r\n  \r\n  // === Sạc dự phòng ===\r\n  { id: 40, name: 'Sỉ sạc dự phòng' },\r\n  { id: 324, name: 'Sạc dự phòng 10000mAh' },\r\n  { id: 325, name: 'Sạc dự phòng 20000mAh' },\r\n  { id: 326, name: 'Sạc dự phòng 30000mAh+' },\r\n  { id: 380, name: 'Sạc dự phòng mini' },\r\n  \r\n  // === Loa ===\r\n  { id: 41, name: 'Sỉ loa bluetooth' },\r\n  { id: 327, name: 'Loa bluetooth mini' },\r\n  { id: 328, name: 'Loa bluetooth karaoke' },\r\n  { id: 329, name: 'Loa bluetooth chống nước' },\r\n  { id: 381, name: 'Loa kéo' },\r\n  \r\n  // === Phụ kiện điện thoại ===\r\n  { id: 42, name: 'Phụ kiện điện thoại' },\r\n  { id: 330, name: 'Ốp lưng điện thoại' },\r\n  { id: 331, name: 'Kính cường lực' },\r\n  { id: 332, name: 'Giá đỡ điện thoại' },\r\n  { id: 333, name: 'Gậy selfie/tripod' },\r\n  { id: 383, name: 'Ring holder' },\r\n  \r\n  // === Phụ kiện máy tính ===\r\n  { id: 43, name: 'Phụ kiện máy tính' },\r\n  { id: 334, name: 'Chuột máy tính' },\r\n  { id: 335, name: 'Bàn phím' },\r\n  { id: 336, name: 'Hub USB' },\r\n  { id: 337, name: 'Webcam' },\r\n  \r\n  // === Đồng hồ thông minh ===\r\n  { id: 44, name: 'Sỉ đồng hồ thông minh' },\r\n  { id: 338, name: 'Smartwatch' },\r\n  { id: 339, name: 'Smartband' },\r\n  { id: 340, name: 'Dây đeo smartwatch' },\r\n  \r\n  // === Gaming ===\r\n  { id: 45, name: 'Phụ kiện gaming' },\r\n  { id: 341, name: 'Tay cầm chơi game' },\r\n  { id: 342, name: 'Quạt tản nhiệt điện thoại' },\r\n  { id: 343, name: 'Nút bấm chơi game' },\r\n  \r\n  // === Ô tô ===\r\n  { id: 46, name: 'Phụ kiện ô tô' },\r\n  { id: 344, name: 'Sạc xe hơi' },\r\n  { id: 345, name: 'Giá đỡ điện thoại xe hơi' },\r\n  { id: 346, name: 'Camera hành trình' },\r\n  \r\n  // === Gia dụng ===\r\n  { id: 47, name: 'Đồ gia dụng' },\r\n  { id: 347, name: 'Đèn LED' },\r\n  { id: 348, name: 'Quạt mini' },\r\n  { id: 349, name: 'Cân điện tử' },\r\n];\r\n\r\n/**\r\n * Danh sách thương hiệu PKGX (brand_id từ ECShop)\r\n * Nguồn: idpkgx.xlsx\r\n */\r\nexport const PKGX_BRANDS: PkgxBrand[] = [\r\n  // === Thương hiệu chính ===\r\n  { id: 15, name: 'Hoco' },\r\n  { id: 141, name: 'Borofone' },\r\n  { id: 138, name: 'Baseus' },\r\n  { id: 12, name: 'Wekome' },\r\n  { id: 157, name: 'Maxitech' },\r\n  \r\n  // === Thương hiệu phụ ===\r\n  { id: 10, name: 'Anker' },\r\n  { id: 11, name: 'Xiaomi' },\r\n  { id: 13, name: 'Samsung' },\r\n  { id: 14, name: 'Apple' },\r\n  { id: 16, name: 'Remax' },\r\n  { id: 17, name: 'Ugreen' },\r\n  { id: 18, name: 'Vivan' },\r\n  { id: 19, name: 'Energizer' },\r\n  { id: 20, name: 'Sony' },\r\n  { id: 21, name: 'JBL' },\r\n  { id: 22, name: 'Logitech' },\r\n  { id: 23, name: 'Rapoo' },\r\n  { id: 24, name: 'Orico' },\r\n  { id: 25, name: 'Havit' },\r\n  { id: 26, name: 'Edifier' },\r\n  { id: 27, name: 'Aukey' },\r\n  { id: 28, name: 'Belkin' },\r\n  { id: 29, name: 'Mophie' },\r\n  { id: 30, name: 'Spigen' },\r\n  { id: 31, name: 'Nillkin' },\r\n  { id: 32, name: 'ESR' },\r\n  { id: 33, name: 'Mazer' },\r\n  { id: 34, name: 'Hyphen' },\r\n  { id: 35, name: 'WiWU' },\r\n  { id: 36, name: 'Pisen' },\r\n  { id: 37, name: 'Yoobao' },\r\n  { id: 38, name: 'iWalk' },\r\n  { id: 39, name: 'Romoss' },\r\n  { id: 40, name: 'Tronsmart' },\r\n  { id: 41, name: 'QCY' },\r\n  { id: 42, name: 'Lenovo' },\r\n  { id: 43, name: 'Huawei' },\r\n  { id: 44, name: 'Oppo' },\r\n  { id: 45, name: 'Vivo' },\r\n  { id: 46, name: 'Realme' },\r\n  { id: 47, name: 'Nothing' },\r\n  { id: 100, name: 'Không thương hiệu' },\r\n  { id: 101, name: 'OEM' },\r\n  { id: 102, name: 'Noname' },\r\n];\r\n\r\n/**\r\n * API Configuration\r\n */\r\nexport const PKGX_API_CONFIG = {\r\n  baseUrl: 'https://phukiengiaxuong.com.vn/admin/api_product_hrm.php',\r\n  cdnUrl: 'https://phukiengiaxuong.com.vn/cdn/',\r\n  defaultApiKey: 'a91f2c47e5d8b6f03a7c4e9d12f0b8a6',\r\n  \r\n  // Rate limiting\r\n  maxRequestsPerMinute: 60,\r\n  requestTimeout: 30000, // 30 seconds\r\n  \r\n  // Pagination\r\n  defaultPageSize: 50,\r\n  maxPageSize: 100,\r\n};\r\n\r\n/**\r\n * Field mapping reference\r\n */\r\nexport const FIELD_MAPPING_REFERENCE = {\r\n  // HRM Field → PKGX Field\r\n  'pkgxId': 'goods_id',\r\n  'id': 'goods_sn',\r\n  'name': 'goods_name',\r\n  'categorySystemId': 'cat_id',\r\n  'brandSystemId': 'brand_id',\r\n  'description': 'goods_desc',\r\n  'shortDescription': 'goods_brief',\r\n  'ktitle': 'meta_title',\r\n  'seoDescription': 'meta_desc',\r\n  'tags': 'keywords',\r\n  'thumbnailImage': 'original_img',\r\n  'isFeatured': 'is_best',\r\n  'isNewArrival': 'is_new',\r\n  'isPublished': 'is_on_sale',\r\n  'slug': 'slug',\r\n} as const;\r\n\r\n/**\r\n * PKGX Price field descriptions\r\n */\r\nexport const PKGX_PRICE_FIELDS = [\r\n  { key: 'shopPrice', field: 'shop_price', label: 'Giá bán (shop_price)', description: 'Giá bán chính trên website' },\r\n  { key: 'marketPrice', field: 'market_price', label: 'Giá thị trường (market_price)', description: 'Giá niêm yết / giá gốc' },\r\n  { key: 'partnerPrice', field: 'partner_price', label: 'Giá đối tác (partner_price)', description: 'Giá dành cho đối tác' },\r\n  { key: 'acePrice', field: 'ace_price', label: 'Giá ACE (ace_price)', description: 'Giá đặc biệt ACE' },\r\n  { key: 'dealPrice', field: 'deal_price', label: 'Giá deal (deal_price)', description: 'Giá khuyến mãi' },\r\n] as const;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 933, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/store.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport type { SystemId } from '@/lib/id-types';\r\nimport type {\r\n  PkgxSettings,\r\n  PkgxCategory,\r\n  PkgxBrand,\r\n  PkgxCategoryMapping,\r\n  PkgxBrandMapping,\r\n  PkgxPriceMapping,\r\n  PkgxSyncSettings,\r\n  PkgxSyncResult,\r\n  PkgxSyncLog,\r\n  PkgxProduct,\r\n} from './types';\r\nimport { DEFAULT_PKGX_SETTINGS } from './types';\r\nimport { PKGX_CATEGORIES, PKGX_BRANDS } from './constants';\r\nimport { getCategories as fetchPkgxCategories, getBrands as fetchPkgxBrands } from '@/lib/pkgx/api-service';\r\nimport { getCurrentUserInfo } from '@/contexts/auth-context';\r\n\r\n// ========================================\r\n// Store Interface\r\n// ========================================\r\n\r\ninterface PkgxSettingsStore {\r\n  // === State ===\r\n  settings: PkgxSettings;\r\n  isLoading: boolean;\r\n  isSaving: boolean;\r\n  \r\n  // === General Config Actions ===\r\n  setApiUrl: (url: string) => void;\r\n  setApiKey: (key: string) => void;\r\n  setEnabled: (enabled: boolean) => void;\r\n  \r\n  // === Reference Data Actions ===\r\n  setCategories: (categories: PkgxCategory[]) => void;\r\n  addCategory: (category: PkgxCategory) => void;\r\n  updateCategory: (id: number, updates: Partial<PkgxCategory>) => void;\r\n  deleteCategory: (id: number) => void;\r\n  \r\n  setBrands: (brands: PkgxBrand[]) => void;\r\n  addBrand: (brand: PkgxBrand) => void;\r\n  updateBrand: (id: number, updates: Partial<PkgxBrand>) => void;\r\n  deleteBrand: (id: number) => void;\r\n  \r\n  // === Mapping Actions ===\r\n  setPriceMapping: (mapping: PkgxPriceMapping) => void;\r\n  updatePriceMapping: (field: keyof PkgxPriceMapping, policyId: SystemId | null) => void;\r\n  \r\n  setCategoryMappings: (mappings: PkgxCategoryMapping[]) => void;\r\n  addCategoryMapping: (mapping: PkgxCategoryMapping) => void;\r\n  updateCategoryMapping: (id: string, updates: Partial<PkgxCategoryMapping>) => void;\r\n  deleteCategoryMapping: (id: string) => void;\r\n  \r\n  setBrandMappings: (mappings: PkgxBrandMapping[]) => void;\r\n  addBrandMapping: (mapping: PkgxBrandMapping) => void;\r\n  updateBrandMapping: (id: string, updates: Partial<PkgxBrandMapping>) => void;\r\n  deleteBrandMapping: (id: string) => void;\r\n  \r\n  // === Sync Settings Actions ===\r\n  setSyncSettings: (settings: PkgxSyncSettings) => void;\r\n  updateSyncSetting: <K extends keyof PkgxSyncSettings>(key: K, value: PkgxSyncSettings[K]) => void;\r\n  \r\n  // === Log Actions ===\r\n  addLog: (log: Omit<PkgxSyncLog, 'id' | 'timestamp'>) => void;\r\n  clearLogs: () => void;\r\n  \r\n  // === Sync Actions ===\r\n  syncCategoriesFromPkgx: () => Promise<void>;\r\n  syncBrandsFromPkgx: () => Promise<void>;\r\n  \r\n  // === PKGX Products Cache Actions ===\r\n  setPkgxProducts: (products: PkgxProduct[]) => void;\r\n  clearPkgxProducts: () => void;\r\n  \r\n  // === Status Actions ===\r\n  setLastSyncAt: (timestamp: string) => void;\r\n  setLastSyncResult: (result: PkgxSyncResult) => void;\r\n  setConnectionStatus: (status: 'connected' | 'disconnected' | 'error', error?: string) => void;\r\n  \r\n  // === Utility Actions ===\r\n  loadDefaultData: () => void;\r\n  resetSettings: () => void;\r\n  setLoading: (loading: boolean) => void;\r\n  setSaving: (saving: boolean) => void;\r\n  \r\n  // === Getters ===\r\n  getCategoryById: (id: number) => PkgxCategory | undefined;\r\n  getBrandById: (id: number) => PkgxBrand | undefined;\r\n  getCategoryMappingByHrmId: (hrmCategoryId: SystemId) => PkgxCategoryMapping | undefined;\r\n  getBrandMappingByHrmId: (hrmBrandId: SystemId) => PkgxBrandMapping | undefined;\r\n  getPkgxCatIdByHrmCategory: (hrmCategoryId: SystemId) => number | null;\r\n  getPkgxBrandIdByHrmBrand: (hrmBrandId: SystemId) => number | null;\r\n  \r\n  // === API Sync ===\r\n  initialized: boolean;\r\n  loadFromAPI: () => Promise<void>;\r\n}\r\n\r\n// ========================================\r\n// API Sync Helper\r\n// ========================================\r\nasync function syncPkgxSettingsToAPI(settings: Partial<PkgxSettings>): Promise<boolean> {\r\n  try {\r\n    const response = await fetch('/api/settings/pkgx', {\r\n      method: 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      credentials: 'include',\r\n      body: JSON.stringify(settings),\r\n    });\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error('[PKGX Settings API] sync error:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// ========================================\r\n// Store Implementation\r\n// ========================================\r\n\r\nexport const usePkgxSettingsStore = create<PkgxSettingsStore>()(\r\n  (set, get) => ({\r\n      // === Initial State ===\r\n      settings: {\r\n        ...DEFAULT_PKGX_SETTINGS,\r\n        categories: PKGX_CATEGORIES,\r\n        brands: PKGX_BRANDS,\r\n      },\r\n      isLoading: false,\r\n      isSaving: false,\r\n      initialized: false,\r\n      \r\n      // === General Config Actions ===\r\n      setApiUrl: (url) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, apiUrl: url },\r\n        })),\r\n        \r\n      setApiKey: (key) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, apiKey: key },\r\n        })),\r\n        \r\n      setEnabled: (enabled) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, enabled },\r\n        })),\r\n      \r\n      // === Reference Data Actions ===\r\n      setCategories: (categories) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, categories },\r\n        })),\r\n        \r\n      addCategory: (category) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categories: [...state.settings.categories, category],\r\n          },\r\n        })),\r\n        \r\n      updateCategory: (id, updates) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categories: state.settings.categories.map((c) =>\r\n              c.id === id ? { ...c, ...updates } : c\r\n            ),\r\n          },\r\n        })),\r\n        \r\n      deleteCategory: (id) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categories: state.settings.categories.filter((c) => c.id !== id),\r\n            // Also remove related mappings\r\n            categoryMappings: state.settings.categoryMappings.filter(\r\n              (m) => m.pkgxCatId !== id\r\n            ),\r\n          },\r\n        })),\r\n      \r\n      setBrands: (brands) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, brands },\r\n        })),\r\n        \r\n      addBrand: (brand) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brands: [...state.settings.brands, brand],\r\n          },\r\n        })),\r\n        \r\n      updateBrand: (id, updates) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brands: state.settings.brands.map((b) =>\r\n              b.id === id ? { ...b, ...updates } : b\r\n            ),\r\n          },\r\n        })),\r\n        \r\n      deleteBrand: (id) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brands: state.settings.brands.filter((b) => b.id !== id),\r\n            // Also remove related mappings\r\n            brandMappings: state.settings.brandMappings.filter(\r\n              (m) => m.pkgxBrandId !== id\r\n            ),\r\n          },\r\n        })),\r\n      \r\n      // === Mapping Actions ===\r\n      setPriceMapping: (mapping) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, priceMapping: mapping },\r\n        })),\r\n        \r\n      updatePriceMapping: (field, policyId) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            priceMapping: {\r\n              ...state.settings.priceMapping,\r\n              [field]: policyId,\r\n            },\r\n          },\r\n        })),\r\n      \r\n      setCategoryMappings: (mappings) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, categoryMappings: mappings },\r\n        })),\r\n        \r\n      addCategoryMapping: (mapping) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categoryMappings: [...state.settings.categoryMappings, mapping],\r\n          },\r\n        })),\r\n        \r\n      updateCategoryMapping: (id, updates) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categoryMappings: state.settings.categoryMappings.map((m) =>\r\n              m.id === id ? { ...m, ...updates } : m\r\n            ),\r\n          },\r\n        })),\r\n        \r\n      deleteCategoryMapping: (id) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categoryMappings: state.settings.categoryMappings.filter(\r\n              (m) => m.id !== id\r\n            ),\r\n          },\r\n        })),\r\n      \r\n      setBrandMappings: (mappings) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, brandMappings: mappings },\r\n        })),\r\n        \r\n      addBrandMapping: (mapping) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brandMappings: [...state.settings.brandMappings, mapping],\r\n          },\r\n        })),\r\n        \r\n      updateBrandMapping: (id, updates) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brandMappings: state.settings.brandMappings.map((m) =>\r\n              m.id === id ? { ...m, ...updates } : m\r\n            ),\r\n          },\r\n        })),\r\n        \r\n      deleteBrandMapping: (id) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brandMappings: state.settings.brandMappings.filter(\r\n              (m) => m.id !== id\r\n            ),\r\n          },\r\n        })),\r\n      \r\n      // === Sync Settings Actions ===\r\n      setSyncSettings: (syncSettings) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, syncSettings },\r\n        })),\r\n        \r\n      updateSyncSetting: (key, value) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            syncSettings: {\r\n              ...state.settings.syncSettings,\r\n              [key]: value,\r\n            },\r\n          },\r\n        })),\r\n      \r\n      // === Log Actions ===\r\n      addLog: (log) => {\r\n        // Lấy thông tin user hiện tại\r\n        const userInfo = getCurrentUserInfo();\r\n        \r\n        const newLog: PkgxSyncLog = {\r\n          ...log,\r\n          id: `log-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,\r\n          timestamp: new Date().toISOString(),\r\n          userId: userInfo.systemId,\r\n          userName: userInfo.name,\r\n        };\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            logs: [newLog, ...state.settings.logs].slice(0, 100), // Keep last 100 logs\r\n          },\r\n        }));\r\n      },\r\n      \r\n      clearLogs: () =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, logs: [] },\r\n        })),\r\n      \r\n      // === Sync Actions ===\r\n      syncCategoriesFromPkgx: async () => {\r\n        const { addLog, setCategories } = get();\r\n        try {\r\n          const response = await fetchPkgxCategories();\r\n          if (response.success && response.data && !response.data.error) {\r\n            // Map API response to PkgxCategory format\r\n            const categories: PkgxCategory[] = response.data.data.map((cat) => ({\r\n              id: cat.cat_id,\r\n              name: cat.cat_name,\r\n              parentId: cat.parent_id > 0 ? cat.parent_id : undefined,\r\n            }));\r\n            \r\n            // Replace all categories with fresh data from server\r\n            setCategories(categories);\r\n            addLog({\r\n              action: 'sync_categories',\r\n              status: 'success',\r\n              message: `Đã đồng bộ ${categories.length} danh mục từ PKGX`,\r\n              details: { total: categories.length, success: categories.length, failed: 0 },\r\n            });\r\n          } else {\r\n            throw new Error(response.error || response.data?.message || 'Không thể lấy danh sách danh mục');\r\n          }\r\n        } catch (error) {\r\n          addLog({\r\n            action: 'sync_categories',\r\n            status: 'error',\r\n            message: 'Lỗi khi đồng bộ danh mục từ PKGX',\r\n            details: { error: error instanceof Error ? error.message : String(error) },\r\n          });\r\n          throw error; // Re-throw to let UI handle\r\n        }\r\n      },\r\n      \r\n      syncBrandsFromPkgx: async () => {\r\n        const { addLog, setBrands } = get();\r\n        try {\r\n          const response = await fetchPkgxBrands();\r\n          if (response.success && response.data && !response.data.error) {\r\n            // Map API response to PkgxBrand format\r\n            const brands: PkgxBrand[] = response.data.data.map((brand) => ({\r\n              id: brand.brand_id,\r\n              name: brand.brand_name,\r\n            }));\r\n            \r\n            // Replace all brands with fresh data from server\r\n            setBrands(brands);\r\n            addLog({\r\n              action: 'sync_brands',\r\n              status: 'success',\r\n              message: `Đã đồng bộ ${brands.length} thương hiệu từ PKGX`,\r\n              details: { total: brands.length, success: brands.length, failed: 0 },\r\n            });\r\n          } else {\r\n            throw new Error(response.error || response.data?.message || 'Không thể lấy danh sách thương hiệu');\r\n          }\r\n        } catch (error) {\r\n          addLog({\r\n            action: 'sync_brands',\r\n            status: 'error',\r\n            message: 'Lỗi khi đồng bộ thương hiệu từ PKGX',\r\n            details: { error: error instanceof Error ? error.message : String(error) },\r\n          });\r\n          throw error; // Re-throw to let UI handle\r\n        }\r\n      },\r\n      \r\n      // === PKGX Products Cache Actions ===\r\n      setPkgxProducts: (products) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            pkgxProducts: products,\r\n            pkgxProductsLastFetch: new Date().toISOString(),\r\n          },\r\n        })),\r\n        \r\n      clearPkgxProducts: () =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            pkgxProducts: [],\r\n            pkgxProductsLastFetch: undefined,\r\n          },\r\n        })),\r\n      \r\n      // === Status Actions ===\r\n      setLastSyncAt: (timestamp) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, lastSyncAt: timestamp },\r\n        })),\r\n        \r\n      setLastSyncResult: (result) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, lastSyncResult: result },\r\n        })),\r\n        \r\n      setConnectionStatus: (status, error) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            connectionStatus: status,\r\n            connectionError: error,\r\n          },\r\n        })),\r\n      \r\n      // === Utility Actions ===\r\n      loadDefaultData: () =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categories: PKGX_CATEGORIES,\r\n            brands: PKGX_BRANDS,\r\n          },\r\n        })),\r\n        \r\n      resetSettings: () =>\r\n        set({\r\n          settings: {\r\n            ...DEFAULT_PKGX_SETTINGS,\r\n            categories: PKGX_CATEGORIES,\r\n            brands: PKGX_BRANDS,\r\n          },\r\n        }),\r\n        \r\n      setLoading: (isLoading) => set({ isLoading }),\r\n      setSaving: (isSaving) => set({ isSaving }),\r\n      \r\n      // === Getters ===\r\n      getCategoryById: (id) =>\r\n        get().settings.categories.find((c) => c.id === id),\r\n        \r\n      getBrandById: (id) =>\r\n        get().settings.brands.find((b) => b.id === id),\r\n        \r\n      getCategoryMappingByHrmId: (hrmCategoryId) =>\r\n        get().settings.categoryMappings.find(\r\n          (m) => m.hrmCategorySystemId === hrmCategoryId\r\n        ),\r\n        \r\n      getBrandMappingByHrmId: (hrmBrandId) =>\r\n        get().settings.brandMappings.find(\r\n          (m) => m.hrmBrandSystemId === hrmBrandId\r\n        ),\r\n        \r\n      getPkgxCatIdByHrmCategory: (hrmCategoryId) => {\r\n        const mapping = get().settings.categoryMappings.find(\r\n          (m) => m.hrmCategorySystemId === hrmCategoryId\r\n        );\r\n        return mapping?.pkgxCatId ?? null;\r\n      },\r\n      \r\n      getPkgxBrandIdByHrmBrand: (hrmBrandId) => {\r\n        const mapping = get().settings.brandMappings.find(\r\n          (m) => m.hrmBrandSystemId === hrmBrandId\r\n        );\r\n        return mapping?.pkgxBrandId ?? null;\r\n      },\r\n      \r\n      loadFromAPI: async () => {\r\n        if (get().initialized) return;\r\n        \r\n        try {\r\n          const response = await fetch('/api/settings/pkgx', {\r\n            credentials: 'include',\r\n          });\r\n          if (response.ok) {\r\n            const json = await response.json();\r\n            const data = json.data || json.settings;\r\n            if (data) {\r\n              set({ \r\n                settings: { \r\n                  ...DEFAULT_PKGX_SETTINGS, \r\n                  categories: PKGX_CATEGORIES,\r\n                  brands: PKGX_BRANDS,\r\n                  ...data \r\n                },\r\n                initialized: true \r\n              });\r\n            } else {\r\n              set({ initialized: true });\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('[PKGX Settings Store] loadFromAPI error:', error);\r\n        }\r\n      },\r\n    })\r\n);\r\n\r\n// ========================================\r\n// Selector Hooks\r\n// ========================================\r\n\r\nexport function usePkgxEnabled() {\r\n  return usePkgxSettingsStore((state) => state.settings.enabled);\r\n}\r\n\r\nexport function usePkgxApiConfig() {\r\n  return usePkgxSettingsStore((state) => ({\r\n    apiUrl: state.settings.apiUrl,\r\n    apiKey: state.settings.apiKey,\r\n    enabled: state.settings.enabled,\r\n  }));\r\n}\r\n\r\nexport function usePkgxCategories() {\r\n  return usePkgxSettingsStore((state) => state.settings.categories);\r\n}\r\n\r\nexport function usePkgxBrands() {\r\n  return usePkgxSettingsStore((state) => state.settings.brands);\r\n}\r\n\r\nexport function usePkgxPriceMapping() {\r\n  return usePkgxSettingsStore((state) => state.settings.priceMapping);\r\n}\r\n\r\nexport function usePkgxCategoryMappings() {\r\n  return usePkgxSettingsStore((state) => state.settings.categoryMappings);\r\n}\r\n\r\nexport function usePkgxBrandMappings() {\r\n  return usePkgxSettingsStore((state) => state.settings.brandMappings);\r\n}\r\n\r\nexport function usePkgxSyncSettings() {\r\n  return usePkgxSettingsStore((state) => state.settings.syncSettings);\r\n}\r\n\r\nexport function usePkgxSyncStatus() {\r\n  return usePkgxSettingsStore((state) => ({\r\n    lastSyncAt: state.settings.lastSyncAt,\r\n    lastSyncResult: state.settings.lastSyncResult,\r\n    connectionStatus: state.settings.connectionStatus,\r\n    connectionError: state.settings.connectionError,\r\n  }));\r\n}\r\n\r\nexport function usePkgxProducts() {\r\n  return usePkgxSettingsStore((state) => ({\r\n    products: state.settings.pkgxProducts,\r\n    lastFetch: state.settings.pkgxProductsLastFetch,\r\n  }));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1420, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pricing/store.ts"],"sourcesContent":["import type { SystemId } from '@/lib/id-types';\r\nimport type { UseBoundStore, StoreApi } from 'zustand';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { PricingPolicy } from './types';\r\nimport { createCrudStore, type CrudState } from '../../../lib/store-factory';\r\nimport { getCurrentUserSystemId } from '../../../contexts/auth-context';\r\n\r\ntype PricingPolicyStore = CrudState<PricingPolicy> & {\r\n  setDefault: (systemId: SystemId) => void;\r\n  getActive: () => PricingPolicy[];\r\n  getInactive: () => PricingPolicy[];\r\n};\r\n\r\nconst baseStore = createCrudStore<PricingPolicy>([], 'pricing-settings', {\r\n  businessIdField: 'id',\r\n  getCurrentUser: getCurrentUserSystemId,\r\n  apiEndpoint: '/api/settings/data?type=pricing-policy',\r\n}) as UseBoundStore<StoreApi<PricingPolicyStore>>;\r\n\r\nconst originalAdd = baseStore.getState().add;\r\n\r\nconst setDefaultAction = (systemId: SystemId) => {\r\n  baseStore.setState((current) => {\r\n    const target = current.data.find((policy) => policy.systemId === systemId);\r\n    if (!target) return current;\r\n\r\n    const updatedData = current.data.map((policy) => (\r\n      policy.type === target.type\r\n        ? { ...policy, isDefault: policy.systemId === systemId }\r\n        : policy\r\n    ));\r\n\r\n    return { ...current, data: updatedData };\r\n  });\r\n};\r\n\r\nconst enhancedAdd: typeof originalAdd = (item) => {\r\n  const newItem = originalAdd(item);\r\n  const storeData = baseStore.getState().data;\r\n  const hasDefaultForType = storeData\r\n    .filter((policy) => policy.type === newItem.type)\r\n    .some((policy) => policy.isDefault);\r\n\r\n  if (item.isDefault) {\r\n    setDefaultAction(newItem.systemId);\r\n  } else if (!hasDefaultForType) {\r\n    setDefaultAction(newItem.systemId);\r\n  }\r\n\r\n  return newItem;\r\n};\r\n\r\nbaseStore.setState((state) => ({\r\n  ...state,\r\n  add: enhancedAdd,\r\n  setDefault: setDefaultAction,\r\n  getActive: () => baseStore.getState().data.filter((policy) => policy.isActive),\r\n  getInactive: () => baseStore.getState().data.filter((policy) => !policy.isActive),\r\n}));\r\n\r\nexport const usePricingPolicyStore = baseStore;\r\n"],"names":[],"mappings":";;;;AAIA;AACA;;;AAQA,MAAM,YAAY,IAAA,0IAAe,EAAgB,EAAE,EAAE,oBAAoB;IACvE,iBAAiB;IACjB,gBAAgB,sJAAsB;IACtC,aAAa;AACf;AAEA,MAAM,cAAc,UAAU,QAAQ,GAAG,GAAG;AAE5C,MAAM,mBAAmB,CAAC;IACxB,UAAU,QAAQ,CAAC,CAAC;QAClB,MAAM,SAAS,QAAQ,IAAI,CAAC,IAAI,CAAC,CAAC,SAAW,OAAO,QAAQ,KAAK;QACjE,IAAI,CAAC,QAAQ,OAAO;QAEpB,MAAM,cAAc,QAAQ,IAAI,CAAC,GAAG,CAAC,CAAC,SACpC,OAAO,IAAI,KAAK,OAAO,IAAI,GACvB;gBAAE,GAAG,MAAM;gBAAE,WAAW,OAAO,QAAQ,KAAK;YAAS,IACrD;QAGN,OAAO;YAAE,GAAG,OAAO;YAAE,MAAM;QAAY;IACzC;AACF;AAEA,MAAM,cAAkC,CAAC;IACvC,MAAM,UAAU,YAAY;IAC5B,MAAM,YAAY,UAAU,QAAQ,GAAG,IAAI;IAC3C,MAAM,oBAAoB,UACvB,MAAM,CAAC,CAAC,SAAW,OAAO,IAAI,KAAK,QAAQ,IAAI,EAC/C,IAAI,CAAC,CAAC,SAAW,OAAO,SAAS;IAEpC,IAAI,KAAK,SAAS,EAAE;QAClB,iBAAiB,QAAQ,QAAQ;IACnC,OAAO,IAAI,CAAC,mBAAmB;QAC7B,iBAAiB,QAAQ,QAAQ;IACnC;IAEA,OAAO;AACT;AAEA,UAAU,QAAQ,CAAC,CAAC,QAAU,CAAC;QAC7B,GAAG,KAAK;QACR,KAAK;QACL,YAAY;QACZ,WAAW,IAAM,UAAU,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,SAAW,OAAO,QAAQ;QAC7E,aAAa,IAAM,UAAU,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,SAAW,CAAC,OAAO,QAAQ;IAClF,CAAC;AAEM,MAAM,wBAAwB"}},
    {"offset": {"line": 1471, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/branches/store.ts"],"sourcesContent":["import { createCrudStore, CrudState } from '../../../lib/store-factory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { Branch } from './types';\r\nimport { SystemId } from '../../../lib/id-types';\r\n\r\nexport interface BranchStoreState extends CrudState<Branch> {\r\n  setDefault: (systemId: SystemId) => void;\r\n}\r\n\r\nconst baseStore = createCrudStore<Branch>([], 'branches', {\r\n  apiEndpoint: '/api/branches',\r\n});\r\n\r\nconst setDefault = (systemId: SystemId) => {\r\n  baseStore.setState(state => ({\r\n    data: state.data.map(branch => ({\r\n      ...branch,\r\n      isDefault: branch.systemId === systemId,\r\n    })),\r\n  }));\r\n};\r\n\r\nconst originalAdd = baseStore.getState().add;\r\nconst originalUpdate = baseStore.getState().update;\r\n\r\nbaseStore.setState({\r\n  add: (item: Omit<Branch, 'systemId'>) => {\r\n    const result = originalAdd(item);\r\n    if ((item as Branch).isDefault) {\r\n      setDefault(result.systemId);\r\n    }\r\n    return result;\r\n  },\r\n  update: (systemId: SystemId, updatedItem: Branch) => {\r\n    originalUpdate(systemId, updatedItem);\r\n    if (updatedItem.isDefault) {\r\n      setDefault(systemId);\r\n    }\r\n  },\r\n} as Partial<BranchStoreState>);\r\n\r\nconst enhanceState = (state: CrudState<Branch>): BranchStoreState => ({\r\n  ...state,\r\n  setDefault,\r\n});\r\n\r\ntype BranchStoreHook = (() => BranchStoreState) & {\r\n  getState: () => BranchStoreState;\r\n};\r\n\r\nconst useBranchStoreBase = (() => enhanceState(baseStore())) as BranchStoreHook;\r\n\r\nuseBranchStoreBase.getState = () => enhanceState(baseStore.getState());\r\n\r\nexport const useBranchStore = useBranchStoreBase;\r\n"],"names":[],"mappings":";;;;AAAA;;AASA,MAAM,YAAY,IAAA,0IAAe,EAAS,EAAE,EAAE,YAAY;IACxD,aAAa;AACf;AAEA,MAAM,aAAa,CAAC;IAClB,UAAU,QAAQ,CAAC,CAAA,QAAS,CAAC;YAC3B,MAAM,MAAM,IAAI,CAAC,GAAG,CAAC,CAAA,SAAU,CAAC;oBAC9B,GAAG,MAAM;oBACT,WAAW,OAAO,QAAQ,KAAK;gBACjC,CAAC;QACH,CAAC;AACH;AAEA,MAAM,cAAc,UAAU,QAAQ,GAAG,GAAG;AAC5C,MAAM,iBAAiB,UAAU,QAAQ,GAAG,MAAM;AAElD,UAAU,QAAQ,CAAC;IACjB,KAAK,CAAC;QACJ,MAAM,SAAS,YAAY;QAC3B,IAAI,AAAC,KAAgB,SAAS,EAAE;YAC9B,WAAW,OAAO,QAAQ;QAC5B;QACA,OAAO;IACT;IACA,QAAQ,CAAC,UAAoB;QAC3B,eAAe,UAAU;QACzB,IAAI,YAAY,SAAS,EAAE;YACzB,WAAW;QACb;IACF;AACF;AAEA,MAAM,eAAe,CAAC,QAA+C,CAAC;QACpE,GAAG,KAAK;QACR;IACF,CAAC;AAMD,MAAM,qBAAsB,IAAM,aAAa;AAE/C,mBAAmB,QAAQ,GAAG,IAAM,aAAa,UAAU,QAAQ;AAE5D,MAAM,iBAAiB"}},
    {"offset": {"line": 1516, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/branches/api/branches-api.ts"],"sourcesContent":["/**\r\n * Branches API functions\r\n * \r\n * ⚠️ Direct import: import { fetchBranches } from '@/features/settings/branches/api/branches-api'\r\n */\r\n\r\nimport type { BranchModel as Branch } from '@/generated/prisma/models/Branch';\r\n\r\nconst BASE_URL = '/api/branches';\r\n\r\nexport interface BranchesParams {\r\n  page?: number;\r\n  limit?: number;\r\n  search?: string;\r\n  isDefault?: boolean;\r\n  sortBy?: string;\r\n  sortOrder?: 'asc' | 'desc';\r\n}\r\n\r\nexport interface BranchesResponse {\r\n  data: Branch[];\r\n  total: number;\r\n  page: number;\r\n  pageSize: number;\r\n}\r\n\r\nexport async function fetchBranches(params: BranchesParams = {}): Promise<BranchesResponse> {\r\n  const searchParams = new URLSearchParams();\r\n  \r\n  if (params.page) searchParams.set('page', String(params.page));\r\n  if (params.limit) searchParams.set('limit', String(params.limit));\r\n  if (params.search) searchParams.set('search', params.search);\r\n  if (params.isDefault !== undefined) searchParams.set('isDefault', String(params.isDefault));\r\n  if (params.sortBy) searchParams.set('sortBy', params.sortBy);\r\n  if (params.sortOrder) searchParams.set('sortOrder', params.sortOrder);\r\n  \r\n  const url = searchParams.toString() ? `${BASE_URL}?${searchParams}` : BASE_URL;\r\n  const response = await fetch(url);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch branches: ${response.statusText}`);\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function fetchBranch(systemId: string): Promise<Branch> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`);\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to fetch branch: ${response.statusText}`);\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function createBranch(data: Omit<Branch, 'systemId' | 'createdAt' | 'updatedAt'>): Promise<Branch> {\r\n  const response = await fetch(BASE_URL, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to create branch');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function updateBranch(systemId: string, data: Partial<Branch>): Promise<Branch> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`, {\r\n    method: 'PUT',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify(data),\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to update branch');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport async function deleteBranch(systemId: string): Promise<void> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}`, {\r\n    method: 'DELETE',\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(`Failed to delete branch: ${response.statusText}`);\r\n  }\r\n}\r\n\r\nexport async function setDefaultBranch(systemId: string): Promise<Branch> {\r\n  const response = await fetch(`${BASE_URL}/${systemId}/set-default`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n  \r\n  if (!response.ok) {\r\n    const error = await response.json().catch(() => ({}));\r\n    throw new Error(error.message || 'Failed to set default branch');\r\n  }\r\n  \r\n  return response.json();\r\n}\r\n\r\nexport type { Branch };\r\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;;;;;;;;;;;AAID,MAAM,WAAW;AAkBV,eAAe,cAAc,SAAyB,CAAC,CAAC;IAC7D,MAAM,eAAe,IAAI;IAEzB,IAAI,OAAO,IAAI,EAAE,aAAa,GAAG,CAAC,QAAQ,OAAO,OAAO,IAAI;IAC5D,IAAI,OAAO,KAAK,EAAE,aAAa,GAAG,CAAC,SAAS,OAAO,OAAO,KAAK;IAC/D,IAAI,OAAO,MAAM,EAAE,aAAa,GAAG,CAAC,UAAU,OAAO,MAAM;IAC3D,IAAI,OAAO,SAAS,KAAK,WAAW,aAAa,GAAG,CAAC,aAAa,OAAO,OAAO,SAAS;IACzF,IAAI,OAAO,MAAM,EAAE,aAAa,GAAG,CAAC,UAAU,OAAO,MAAM;IAC3D,IAAI,OAAO,SAAS,EAAE,aAAa,GAAG,CAAC,aAAa,OAAO,SAAS;IAEpE,MAAM,MAAM,aAAa,QAAQ,KAAK,GAAG,SAAS,CAAC,EAAE,cAAc,GAAG;IACtE,MAAM,WAAW,MAAM,MAAM;IAE7B,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM,CAAC,0BAA0B,EAAE,SAAS,UAAU,EAAE;IACpE;IAEA,OAAO,SAAS,IAAI;AACtB;AAEO,eAAe,YAAY,QAAgB;IAChD,MAAM,WAAW,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,UAAU;IAEtD,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM,CAAC,wBAAwB,EAAE,SAAS,UAAU,EAAE;IAClE;IAEA,OAAO,SAAS,IAAI;AACtB;AAEO,eAAe,aAAa,IAA0D;IAC3F,MAAM,WAAW,MAAM,MAAM,UAAU;QACrC,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,QAAQ,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QACnD,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI;IACnC;IAEA,OAAO,SAAS,IAAI;AACtB;AAEO,eAAe,aAAa,QAAgB,EAAE,IAAqB;IACxE,MAAM,WAAW,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,UAAU,EAAE;QACtD,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;IACvB;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,QAAQ,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QACnD,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI;IACnC;IAEA,OAAO,SAAS,IAAI;AACtB;AAEO,eAAe,aAAa,QAAgB;IACjD,MAAM,WAAW,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,UAAU,EAAE;QACtD,QAAQ;IACV;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM,CAAC,yBAAyB,EAAE,SAAS,UAAU,EAAE;IACnE;AACF;AAEO,eAAe,iBAAiB,QAAgB;IACrD,MAAM,WAAW,MAAM,MAAM,GAAG,SAAS,CAAC,EAAE,SAAS,YAAY,CAAC,EAAE;QAClE,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;IAChD;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,QAAQ,MAAM,SAAS,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QACnD,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI;IACnC;IAEA,OAAO,SAAS,IAAI;AACtB"}},
    {"offset": {"line": 1610, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/branches/hooks/use-branches.ts"],"sourcesContent":["/**\r\n * useBranches - React Query hooks\r\n * \r\n * ⚠️ Direct import: import { useBranches } from '@/features/settings/branches/hooks/use-branches'\r\n */\r\n\r\nimport { useQuery, useMutation, useQueryClient, keepPreviousData } from '@tanstack/react-query';\r\nimport {\r\n  fetchBranches,\r\n  fetchBranch,\r\n  createBranch,\r\n  updateBranch,\r\n  deleteBranch,\r\n  setDefaultBranch,\r\n  type BranchesParams,\r\n  type Branch,\r\n} from '../api/branches-api';\r\n\r\nexport const branchKeys = {\r\n  all: ['branches'] as const,\r\n  lists: () => [...branchKeys.all, 'list'] as const,\r\n  list: (params: BranchesParams) => [...branchKeys.lists(), params] as const,\r\n  details: () => [...branchKeys.all, 'detail'] as const,\r\n  detail: (id: string) => [...branchKeys.details(), id] as const,\r\n};\r\n\r\nexport function useBranches(params: BranchesParams = {}) {\r\n  return useQuery({\r\n    queryKey: branchKeys.list(params),\r\n    queryFn: () => fetchBranches(params),\r\n    staleTime: 10 * 60 * 1000, // Branches rarely change\r\n    gcTime: 60 * 60 * 1000,\r\n    placeholderData: keepPreviousData,\r\n  });\r\n}\r\n\r\nexport function useBranch(id: string | null | undefined) {\r\n  return useQuery({\r\n    queryKey: branchKeys.detail(id!),\r\n    queryFn: () => fetchBranch(id!),\r\n    enabled: !!id,\r\n    staleTime: 10 * 60 * 1000,\r\n  });\r\n}\r\n\r\ninterface UseBranchMutationsOptions {\r\n  onCreateSuccess?: (branch: Branch) => void;\r\n  onUpdateSuccess?: (branch: Branch) => void;\r\n  onDeleteSuccess?: () => void;\r\n  onSetDefaultSuccess?: (branch: Branch) => void;\r\n  onError?: (error: Error) => void;\r\n}\r\n\r\nexport function useBranchMutations(options: UseBranchMutationsOptions = {}) {\r\n  const queryClient = useQueryClient();\r\n  \r\n  const create = useMutation({\r\n    mutationFn: createBranch,\r\n    onSuccess: (data) => {\r\n      queryClient.invalidateQueries({ queryKey: branchKeys.all });\r\n      options.onCreateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const update = useMutation({\r\n    mutationFn: ({ systemId, data }: { systemId: string; data: Partial<Branch> }) => \r\n      updateBranch(systemId, data),\r\n    onSuccess: (data, variables) => {\r\n      queryClient.invalidateQueries({ queryKey: branchKeys.detail(variables.systemId) });\r\n      queryClient.invalidateQueries({ queryKey: branchKeys.lists() });\r\n      options.onUpdateSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const remove = useMutation({\r\n    mutationFn: deleteBranch,\r\n    onSuccess: () => {\r\n      queryClient.invalidateQueries({ queryKey: branchKeys.all });\r\n      options.onDeleteSuccess?.();\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  const makeDefault = useMutation({\r\n    mutationFn: setDefaultBranch,\r\n    onSuccess: (data) => {\r\n      queryClient.invalidateQueries({ queryKey: branchKeys.all });\r\n      options.onSetDefaultSuccess?.(data);\r\n    },\r\n    onError: options.onError,\r\n  });\r\n  \r\n  return { create, update, remove, makeDefault };\r\n}\r\n\r\nexport function useAllBranches() {\r\n  return useBranches({ limit: 100 });\r\n}\r\n\r\nexport function useDefaultBranch() {\r\n  const { data, ...rest } = useBranches({ isDefault: true, limit: 1 });\r\n  return {\r\n    ...rest,\r\n    data: data?.data?.[0] ?? null,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;;;CAIC,GAED;AAAA;AAAA;AAAA;AACA;;;AAWO,MAAM,aAAa;IACxB,KAAK;QAAC;KAAW;IACjB,OAAO,IAAM;eAAI,WAAW,GAAG;YAAE;SAAO;IACxC,MAAM,CAAC,SAA2B;eAAI,WAAW,KAAK;YAAI;SAAO;IACjE,SAAS,IAAM;eAAI,WAAW,GAAG;YAAE;SAAS;IAC5C,QAAQ,CAAC,KAAe;eAAI,WAAW,OAAO;YAAI;SAAG;AACvD;AAEO,SAAS,YAAY,SAAyB,CAAC,CAAC;IACrD,OAAO,IAAA,uLAAQ,EAAC;QACd,UAAU,WAAW,IAAI,CAAC;QAC1B,SAAS,IAAM,IAAA,2KAAa,EAAC;QAC7B,WAAW,KAAK,KAAK;QACrB,QAAQ,KAAK,KAAK;QAClB,iBAAiB,2LAAgB;IACnC;AACF;AAEO,SAAS,UAAU,EAA6B;IACrD,OAAO,IAAA,uLAAQ,EAAC;QACd,UAAU,WAAW,MAAM,CAAC;QAC5B,SAAS,IAAM,IAAA,yKAAW,EAAC;QAC3B,SAAS,CAAC,CAAC;QACX,WAAW,KAAK,KAAK;IACvB;AACF;AAUO,SAAS,mBAAmB,UAAqC,CAAC,CAAC;IACxE,MAAM,cAAc,IAAA,wMAAc;IAElC,MAAM,SAAS,IAAA,6LAAW,EAAC;QACzB,YAAY,0KAAY;QACxB,WAAW,CAAC;YACV,YAAY,iBAAiB,CAAC;gBAAE,UAAU,WAAW,GAAG;YAAC;YACzD,QAAQ,eAAe,GAAG;QAC5B;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,SAAS,IAAA,6LAAW,EAAC;QACzB,YAAY,CAAC,EAAE,QAAQ,EAAE,IAAI,EAA+C,GAC1E,IAAA,0KAAY,EAAC,UAAU;QACzB,WAAW,CAAC,MAAM;YAChB,YAAY,iBAAiB,CAAC;gBAAE,UAAU,WAAW,MAAM,CAAC,UAAU,QAAQ;YAAE;YAChF,YAAY,iBAAiB,CAAC;gBAAE,UAAU,WAAW,KAAK;YAAG;YAC7D,QAAQ,eAAe,GAAG;QAC5B;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,SAAS,IAAA,6LAAW,EAAC;QACzB,YAAY,0KAAY;QACxB,WAAW;YACT,YAAY,iBAAiB,CAAC;gBAAE,UAAU,WAAW,GAAG;YAAC;YACzD,QAAQ,eAAe;QACzB;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,MAAM,cAAc,IAAA,6LAAW,EAAC;QAC9B,YAAY,8KAAgB;QAC5B,WAAW,CAAC;YACV,YAAY,iBAAiB,CAAC;gBAAE,UAAU,WAAW,GAAG;YAAC;YACzD,QAAQ,mBAAmB,GAAG;QAChC;QACA,SAAS,QAAQ,OAAO;IAC1B;IAEA,OAAO;QAAE;QAAQ;QAAQ;QAAQ;IAAY;AAC/C;AAEO,SAAS;IACd,OAAO,YAAY;QAAE,OAAO;IAAI;AAClC;AAEO,SAAS;IACd,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,GAAG,YAAY;QAAE,WAAW;QAAM,OAAO;IAAE;IAClE,OAAO;QACL,GAAG,IAAI;QACP,MAAM,MAAM,MAAM,CAAC,EAAE,IAAI;IAC3B;AACF"}},
    {"offset": {"line": 1744, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/branches/hooks/use-all-branches.ts"],"sourcesContent":["/**\r\n * useAllBranches - Convenience hook for components needing all branches as flat array\r\n * \r\n * Use case: Dropdowns, selects that need branch options\r\n * \r\n * ⚠️ For paginated views, use useBranches() instead\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { useBranches } from './use-branches';\r\nimport type { Branch } from '../types';\r\nimport type { SystemId } from '@/lib/id-types';\r\n\r\n/**\r\n * Returns all branches as a flat array\r\n * Compatible with legacy store pattern: { data: branches }\r\n * \r\n * Note: API returns string systemIds, but we cast to Branch[] for internal use\r\n */\r\nexport function useAllBranches() {\r\n  const query = useBranches({ limit: 100 });\r\n  \r\n  return {\r\n    // Cast to Branch[] - API returns string systemId, but we trust the data structure\r\n    data: (query.data?.data || []) as unknown as Branch[],\r\n    isLoading: query.isLoading,\r\n    isError: query.isError,\r\n    error: query.error,\r\n  };\r\n}\r\n\r\n/**\r\n * Returns branches formatted as options for Select/Combobox\r\n */\r\nexport function useBranchOptions() {\r\n  const { data, isLoading } = useAllBranches();\r\n  \r\n  const options = data.map(b => ({\r\n    value: b.systemId,\r\n    label: b.name,\r\n  }));\r\n  \r\n  return { options, isLoading };\r\n}\r\n\r\n/**\r\n * Returns the default branch\r\n */\r\nexport function useDefaultBranch() {\r\n  const { data, isLoading } = useAllBranches();\r\n  const defaultBranch = data.find(b => b.isDefault) || data[0];\r\n  \r\n  return { defaultBranch, isLoading };\r\n}\r\n\r\n/**\r\n * Helper hook to find a branch by ID from cached data\r\n * Replaces legacy findById() method\r\n */\r\nexport function useBranchFinder() {\r\n  const { data } = useAllBranches();\r\n  \r\n  const findById = React.useCallback(\r\n    (systemId: SystemId | string | undefined) => {\r\n      if (!systemId) return undefined;\r\n      return data.find(b => b.systemId === systemId);\r\n    },\r\n    [data]\r\n  );\r\n  \r\n  return { findById };\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;;;;CAMC,GAED;AACA;;;AAUO,SAAS;IACd,MAAM,QAAQ,IAAA,2KAAW,EAAC;QAAE,OAAO;IAAI;IAEvC,OAAO;QACL,kFAAkF;QAClF,MAAO,MAAM,IAAI,EAAE,QAAQ,EAAE;QAC7B,WAAW,MAAM,SAAS;QAC1B,SAAS,MAAM,OAAO;QACtB,OAAO,MAAM,KAAK;IACpB;AACF;AAKO,SAAS;IACd,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG;IAE5B,MAAM,UAAU,KAAK,GAAG,CAAC,CAAA,IAAK,CAAC;YAC7B,OAAO,EAAE,QAAQ;YACjB,OAAO,EAAE,IAAI;QACf,CAAC;IAED,OAAO;QAAE;QAAS;IAAU;AAC9B;AAKO,SAAS;IACd,MAAM,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG;IAC5B,MAAM,gBAAgB,KAAK,IAAI,CAAC,CAAA,IAAK,EAAE,SAAS,KAAK,IAAI,CAAC,EAAE;IAE5D,OAAO;QAAE;QAAe;IAAU;AACpC;AAMO,SAAS;IACd,MAAM,EAAE,IAAI,EAAE,GAAG;IAEjB,MAAM,WAAW,oNAAiB,CAChC,CAAC;QACC,IAAI,CAAC,UAAU,OAAO;QACtB,OAAO,KAAK,IAAI,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK;IACvC,GACA;QAAC;KAAK;IAGR,OAAO;QAAE;IAAS;AACpB"}}]
}