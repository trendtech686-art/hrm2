{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/inventory-checks/store.ts"],"sourcesContent":["import { createCrudStore, CrudState } from '../../lib/store-factory';\r\nimport type { InventoryCheck } from './types';\r\nimport type { HistoryEntry } from '../../components/ActivityHistory';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport { getCurrentUserSystemId } from '../../contexts/auth-context';\r\nimport { asSystemId } from '../../lib/id-types';\r\nimport type { SystemId } from '../../lib/id-types';\r\nimport { registerBreadcrumbStore } from '../../lib/breadcrumb-generator';\r\nimport { useEmployeeStore } from '../employees/store';\r\n\r\n// Helper to get current user info\r\nconst getCurrentUserInfo = () => {\r\n  const currentUserSystemId = getCurrentUserSystemId();\r\n  const employee = useEmployeeStore.getState().data.find(e => e.systemId === currentUserSystemId);\r\n  return {\r\n    systemId: currentUserSystemId || 'SYSTEM',\r\n    name: employee?.fullName || 'Hệ thống',\r\n    avatar: employee?.avatarUrl,\r\n  };\r\n};\r\n\r\n// Helper to create history entry\r\nconst createHistoryEntry = (\r\n  action: HistoryEntry['action'],\r\n  description: string,\r\n  metadata?: HistoryEntry['metadata']\r\n): HistoryEntry => ({\r\n  id: crypto.randomUUID(),\r\n  action,\r\n  timestamp: new Date(),\r\n  user: getCurrentUserInfo(),\r\n  description,\r\n  metadata,\r\n});\r\n\r\nconst baseStore = createCrudStore<InventoryCheck>([], 'inventory-checks', {\r\n  businessIdField: 'id',\r\n  getCurrentUser: getCurrentUserSystemId,\r\n  apiEndpoint: '/api/inventory-checks',\r\n});\r\n\r\n// Register for breadcrumb auto-generation\r\nregisterBreadcrumbStore('inventory-checks', () => baseStore.getState());\r\n\r\ninterface InventoryCheckStoreState extends CrudState<InventoryCheck> {\r\n  balanceCheck: (systemId: SystemId) => Promise<void>;\r\n  cancelCheck: (systemId: SystemId, reason?: string) => void;\r\n}\r\n\r\nconst augmentedMethods = {\r\n  balanceCheck: async (systemId: SystemId) => {\r\n    const state = baseStore.getState();\r\n    const check = state.findById(systemId);\r\n    \r\n    if (!check || check.status !== 'draft') return;\r\n    \r\n    const currentUserSystemId = getCurrentUserSystemId();\r\n    const currentEmployeeName = useEmployeeStore.getState().data.find(e => e.systemId === currentUserSystemId)?.fullName || 'Hệ thống';\r\n    \r\n    // Update inventory for each item\r\n    if (check.items && check.items.length > 0) {\r\n      const [{ useProductStore }, { useStockHistoryStore }] = await Promise.all([\r\n        import('../products/store'),\r\n        import('../stock-history/store')\r\n      ]);\r\n\r\n      const productStore = useProductStore.getState();\r\n      const stockHistoryStore = useStockHistoryStore.getState();\r\n\r\n      check.items.forEach(item => {\r\n        const difference = (item.actualQuantity ?? 0) - (item.systemQuantity ?? 0);\r\n        if (difference === 0) return;\r\n\r\n        productStore.updateInventory(\r\n          item.productSystemId,\r\n          check.branchSystemId,\r\n          difference\r\n        );\r\n\r\n        const actionType = difference > 0\r\n          ? 'Nhập kho (Kiểm hàng)'\r\n          : 'Xuất kho (Kiểm hàng)';\r\n\r\n        stockHistoryStore.addEntry({\r\n          productId: item.productSystemId,\r\n          date: new Date().toISOString(),\r\n          employeeName: currentEmployeeName,\r\n          action: actionType,\r\n          quantityChange: difference,\r\n          newStockLevel: item.actualQuantity ?? 0,\r\n          documentId: check.id,\r\n          branchSystemId: check.branchSystemId,\r\n          branch: check.branchName || 'Chi nhánh',\r\n        });\r\n      });\r\n    }\r\n    \r\n    // Add history entry for balance action\r\n    const historyEntry = createHistoryEntry(\r\n      'status_changed',\r\n      'Đã cân bằng phiếu kiểm kho',\r\n      { oldValue: 'Nháp', newValue: 'Đã cân bằng' }\r\n    );\r\n    \r\n    // Update check status with balanced user and timestamp\r\n    state.update(systemId, {\r\n      ...check,\r\n      status: 'balanced',\r\n      balancedAt: new Date().toISOString(),\r\n      balancedBy: asSystemId(currentUserSystemId),\r\n      activityHistory: [...(check.activityHistory || []), historyEntry],\r\n    });\r\n  },\r\n  \r\n  cancelCheck: (systemId: SystemId, reason?: string) => {\r\n    const state = baseStore.getState();\r\n    const check = state.findById(systemId);\r\n    \r\n    if (!check || check.status === 'cancelled') return;\r\n    \r\n    const statusLabel = check.status === 'draft' ? 'Nháp' : 'Đã cân bằng';\r\n    const historyEntry = createHistoryEntry(\r\n      'cancelled',\r\n      `Đã hủy phiếu kiểm kho${reason ? `: ${reason}` : ''}`,\r\n      { oldValue: statusLabel, newValue: 'Đã hủy', note: reason }\r\n    );\r\n    \r\n    state.update(systemId, {\r\n      ...check,\r\n      status: 'cancelled',\r\n      cancelledAt: new Date().toISOString(),\r\n      cancelledBy: asSystemId(getCurrentUserSystemId()),\r\n      cancelledReason: reason ?? '',\r\n      activityHistory: [...(check.activityHistory || []), historyEntry],\r\n    });\r\n  },\r\n};\r\n\r\nexport const useInventoryCheckStore = (): InventoryCheckStoreState => {\r\n  const state = baseStore();\r\n  return {\r\n    ...state,\r\n    ...augmentedMethods,\r\n  };\r\n};\r\n\r\nuseInventoryCheckStore.getState = (): InventoryCheckStoreState => {\r\n  const state = baseStore.getState();\r\n  return {\r\n    ...state,\r\n    ...augmentedMethods,\r\n  };\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/inventory-checks/columns.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { formatDateCustom } from '../../lib/date-utils';\r\nimport type { InventoryCheck } from './types';\r\nimport { Checkbox } from '../../components/ui/checkbox';\r\nimport { DataTableColumnHeader } from '../../components/data-table/data-table-column-header';\r\nimport { Badge } from '../../components/ui/badge';\r\nimport type { ColumnDef } from '../../components/data-table/types';\r\nimport { Button } from '../../components/ui/button';\r\nimport { MoreHorizontal, Pencil, XCircle, Printer } from 'lucide-react';\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger } from '../../components/ui/dropdown-menu';\r\n\r\nconst formatDate = (d?: string) => (d ? formatDateCustom(new Date(d), 'dd/MM/yyyy HH:mm') : '');\r\n\r\nexport const getColumns = (\r\n  onEdit: (item: InventoryCheck) => void,\r\n  onCancel: (item: InventoryCheck) => void,\r\n  onBalance: (item: InventoryCheck) => void,\r\n  navigate: (path: string) => void,\r\n  onPrint?: (item: InventoryCheck) => void,\r\n) : ColumnDef<InventoryCheck>[] => [\r\n  // 1 - Select\r\n  {\r\n    id: 'select',\r\n    header: ({ isAllPageRowsSelected, isSomePageRowsSelected, onToggleAll }) => (\r\n      <Checkbox\r\n        checked={isAllPageRowsSelected ? true : isSomePageRowsSelected ? 'indeterminate' : false}\r\n        onCheckedChange={(v) => onToggleAll?.(!!v)}\r\n      />\r\n    ),\r\n    cell: ({ onToggleSelect, isSelected }) => (\r\n      <Checkbox checked={isSelected} onCheckedChange={onToggleSelect} />\r\n    ),\r\n    size: 48,\r\n    meta: { displayName: 'Chọn', sticky: 'left' },\r\n  },\r\n\r\n  // 2 - ID (clickable)\r\n  {\r\n    id: 'id',\r\n    accessorKey: 'id',\r\n    header: ({ sorting, setSorting }) => (\r\n      <DataTableColumnHeader\r\n        title=\"Mã\"\r\n        sortKey=\"id\"\r\n        isSorted={sorting?.id === 'id'}\r\n        sortDirection={sorting?.desc ? 'desc' : 'asc'}\r\n        onSort={() => setSorting?.((s: any) => ({ id: 'id', desc: s.id === 'id' ? !s.desc : false }))}\r\n      />\r\n    ),\r\n    cell: ({ row }) => (\r\n      <div\r\n        className=\"font-medium text-primary cursor-pointer hover:underline\"\r\n        onClick={() => navigate(`/inventory-checks/${row.systemId}`)}\r\n      >\r\n        {row.id}\r\n      </div>\r\n    ),\r\n    meta: { displayName: 'Mã phiếu' },\r\n  },\r\n\r\n  // 3 - Branch\r\n  {\r\n    id: 'branch',\r\n    accessorKey: 'branchName',\r\n    header: 'Chi nhánh',\r\n    cell: ({ row }) => row.branchName,\r\n    meta: { displayName: 'Chi nhánh' },\r\n  },\r\n\r\n  // 4 - Status\r\n  {\r\n    id: 'status',\r\n    accessorKey: 'status',\r\n    header: 'Trạng thái',\r\n    cell: ({ row }) => (\r\n      <Badge variant={row.status === 'balanced' ? 'secondary' : row.status === 'draft' ? 'outline' : 'destructive'}>\r\n        {row.status === 'draft' ? 'Nháp' : row.status === 'balanced' ? 'Đã cân bằng' : 'Đã hủy'}\r\n      </Badge>\r\n    ),\r\n    meta: { displayName: 'Trạng thái' },\r\n  },\r\n\r\n  // 5 - Created At\r\n  {\r\n    id: 'createdAt',\r\n    accessorKey: 'createdAt',\r\n    header: 'Ngày tạo',\r\n    cell: ({ row }) => formatDate(row.createdAt),\r\n    meta: { displayName: 'Ngày tạo' },\r\n  },\r\n\r\n  // 6 - Created By\r\n  {\r\n    id: 'createdBy',\r\n    accessorKey: 'createdBy',\r\n    header: 'Người tạo',\r\n    cell: ({ row }) => row.createdBy,\r\n    meta: { displayName: 'Người tạo' },\r\n  },\r\n\r\n  // 7 - Balanced At\r\n  {\r\n    id: 'balancedAt',\r\n    accessorKey: 'balancedAt',\r\n    header: 'Ngày cân bằng',\r\n    cell: ({ row }) => formatDate(row.balancedAt),\r\n    meta: { displayName: 'Ngày cân bằng' },\r\n  },\r\n\r\n  // 8 - Items count\r\n  {\r\n    id: 'itemsCount',\r\n    header: 'Số dòng',\r\n    cell: ({ row }) => row.items?.length ?? 0,\r\n    meta: { displayName: 'Số dòng' },\r\n  },\r\n\r\n  // 9 - System qty total\r\n  {\r\n    id: 'systemQty',\r\n    header: 'Tổng hệ thống',\r\n    cell: ({ row }) => row.items?.reduce((s, i) => s + (i.systemQuantity || 0), 0),\r\n    meta: { displayName: 'Tổng hệ thống' },\r\n  },\r\n\r\n  // 10 - Actual qty total\r\n  {\r\n    id: 'actualQty',\r\n    header: 'Tổng thực tế',\r\n    cell: ({ row }) => row.items?.reduce((s, i) => s + (i.actualQuantity || 0), 0),\r\n    meta: { displayName: 'Tổng thực tế' },\r\n  },\r\n\r\n  // 11 - Difference total\r\n  {\r\n    id: 'difference',\r\n    header: 'Chênh lệch',\r\n    cell: ({ row }) => row.items?.reduce((s, i) => s + ((i.actualQuantity || 0) - (i.systemQuantity || 0)), 0),\r\n    meta: { displayName: 'Chênh lệch' },\r\n  },\r\n\r\n  // 12 - Item preview\r\n  {\r\n    id: 'itemPreview',\r\n    header: 'Mô tả hàng',\r\n    cell: ({ row }) => (\r\n      <div className=\"max-w-[240px] truncate\" title={row.items?.map(i => i.productName).slice(0,3).join(', ')}>\r\n        {row.items?.map(i => i.productName).slice(0,3).join(', ')}{row.items && row.items.length > 3 ? '...' : ''}\r\n      </div>\r\n    ),\r\n    meta: { displayName: 'Mô tả hàng' },\r\n  },\r\n\r\n  // 13 - Note\r\n  {\r\n    id: 'note',\r\n    accessorKey: 'note',\r\n    header: 'Ghi chú',\r\n    cell: ({ row }) => (\r\n      <div className=\"max-w-[240px] truncate\" title={row.note}>{row.note}</div>\r\n    ),\r\n    meta: { displayName: 'Ghi chú' },\r\n  },\r\n\r\n  // 14 - Actions (sticky right)\r\n  {\r\n    id: 'actions',\r\n    header: () => <div className=\"text-center\">Hành động</div>,\r\n    cell: ({ row }) => (\r\n      <div className=\"text-center\">\r\n        <DropdownMenu>\r\n          <DropdownMenuTrigger asChild>\r\n            <Button variant=\"ghost\" className=\"h-8 w-8 p-0\">\r\n              <MoreHorizontal className=\"h-4 w-4\" />\r\n            </Button>\r\n          </DropdownMenuTrigger>\r\n          <DropdownMenuContent align=\"end\">\r\n            <DropdownMenuItem onClick={() => onPrint?.(row)}>\r\n              <Printer className=\"mr-2 h-4 w-4\" />\r\n              In phiếu kiểm\r\n            </DropdownMenuItem>\r\n            <DropdownMenuItem onClick={() => onEdit(row)}>\r\n              <Pencil className=\"mr-2 h-4 w-4\" />\r\n              Sửa\r\n            </DropdownMenuItem>\r\n            {row.status === 'draft' && (\r\n              <DropdownMenuItem onClick={() => onBalance(row)}>\r\n                Cân bằng\r\n              </DropdownMenuItem>\r\n            )}\r\n            {row.status === 'draft' && (\r\n              <>\r\n                <DropdownMenuSeparator />\r\n                <DropdownMenuItem className=\"text-destructive\" onClick={() => onCancel(row)}>\r\n                  <XCircle className=\"mr-2 h-4 w-4\" />\r\n                  Hủy phiếu\r\n                </DropdownMenuItem>\r\n              </>\r\n            )}\r\n          </DropdownMenuContent>\r\n        </DropdownMenu>\r\n      </div>\r\n    ),\r\n    meta: { displayName: 'Hành động', sticky: 'right' },\r\n    size: 90,\r\n  }\r\n];\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 485, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/inventory-checks/card.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport type { InventoryCheck } from './types';\r\nimport { Badge } from '../../components/ui/badge';\r\nimport { Button } from '../../components/ui/button';\r\nimport { formatDateCustom } from '../../lib/date-utils';\r\n\r\ntype CardProps = {\r\n  item: InventoryCheck;\r\n  onEdit?: (item: InventoryCheck) => void;\r\n  onBalance?: (item: InventoryCheck) => void;\r\n};\r\n\r\nexport function InventoryCheckCard({ item, onEdit, onBalance }: CardProps) {\r\n  const preview = item.items?.slice(0,2).map(i => i.productName).join(', ');\r\n  return (\r\n    <div className=\"p-4 bg-white rounded shadow-sm\">\r\n      <div className=\"flex items-start justify-between\">\r\n        <div>\r\n          <div className=\"font-medium\">{item.id}</div>\r\n          <div className=\"text-body-sm text-muted-foreground\">{item.branchName} • {formatDateCustom(new Date(item.createdAt), 'dd/MM/yyyy')}</div>\r\n        </div>\r\n        <div>\r\n          <Badge>{item.status === 'draft' ? 'Nháp' : item.status === 'balanced' ? 'Đã cân bằng' : 'Đã hủy'}</Badge>\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"mt-2 text-body-sm text-muted-foreground\">\r\n        {preview}\r\n        {item.items && item.items.length > 2 ? ` +${item.items.length - 2} khác` : ''}\r\n      </div>\r\n\r\n      <div className=\"mt-3 flex items-center gap-2\">\r\n        {onEdit && (\r\n          <Button variant=\"outline\" className=\"h-9\" onClick={() => onEdit(item)}>\r\n            Sửa\r\n          </Button>\r\n        )}\r\n        {onBalance && item.status === 'draft' && (\r\n          <Button className=\"h-9\" onClick={() => onBalance(item)}>\r\n            Cân bằng\r\n          </Button>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;;;AAQO,SAAS,mBAAmB,EAAE,IAAI,EAAE,MAAM,EAAE,SAAS,EAAa;IACvE,MAAM,UAAU,KAAK,KAAK,EAAE,MAAM,GAAE,GAAG,IAAI,CAAA,IAAK,EAAE,WAAW,EAAE,KAAK;IACpE,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;;0CACC,8OAAC;gCAAI,WAAU;0CAAe,KAAK,EAAE;;;;;;0CACrC,8OAAC;gCAAI,WAAU;;oCAAsC,KAAK,UAAU;oCAAC;oCAAI,IAAA,wIAAgB,EAAC,IAAI,KAAK,KAAK,SAAS,GAAG;;;;;;;;;;;;;kCAEtH,8OAAC;kCACC,cAAA,8OAAC,mIAAK;sCAAE,KAAK,MAAM,KAAK,UAAU,SAAS,KAAK,MAAM,KAAK,aAAa,gBAAgB;;;;;;;;;;;;;;;;;0BAI5F,8OAAC;gBAAI,WAAU;;oBACZ;oBACA,KAAK,KAAK,IAAI,KAAK,KAAK,CAAC,MAAM,GAAG,IAAI,CAAC,EAAE,EAAE,KAAK,KAAK,CAAC,MAAM,GAAG,EAAE,KAAK,CAAC,GAAG;;;;;;;0BAG7E,8OAAC;gBAAI,WAAU;;oBACZ,wBACC,8OAAC,qIAAM;wBAAC,SAAQ;wBAAU,WAAU;wBAAM,SAAS,IAAM,OAAO;kCAAO;;;;;;oBAIxE,aAAa,KAAK,MAAM,KAAK,yBAC5B,8OAAC,qIAAM;wBAAC,WAAU;wBAAM,SAAS,IAAM,UAAU;kCAAO;;;;;;;;;;;;;;;;;;AAOlE"}},
    {"offset": {"line": 602, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/inventory-checks/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport * as React from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { ROUTES } from '../../lib/router';\r\nimport { useInventoryCheckStore } from './store';\r\nimport { getColumns } from './columns';\r\nimport { InventoryCheckCard } from './card';\r\nimport { ResponsiveDataTable } from '../../components/data-table/responsive-data-table';\r\nimport { DataTableFacetedFilter } from '../../components/data-table/data-table-faceted-filter';\r\nimport { DataTableColumnCustomizer } from '../../components/data-table/data-table-column-toggle';\r\nimport { DataTableExportDialog } from '../../components/data-table/data-table-export-dialog';\r\nimport { PageToolbar } from '../../components/layout/page-toolbar';\r\nimport { Button } from '../../components/ui/button';\r\nimport { Input } from '../../components/ui/input';\r\nimport { usePageHeader } from '../../contexts/page-header-context';\r\nimport { useBreakpoint } from '../../contexts/breakpoint-context';\r\nimport { useAuth } from '../../contexts/auth-context';\r\nimport { Plus, Download, Printer, XCircle, Scale, FileSpreadsheet } from 'lucide-react';\r\nimport { GenericImportDialogV2 } from '../../components/shared/generic-import-dialog-v2';\r\nimport { GenericExportDialogV2 } from '../../components/shared/generic-export-dialog-v2';\r\nimport { inventoryCheckImportExportConfig, flattenInventoryChecksForExport } from '../../lib/import-export/configs/inventory-check.config';\r\nimport { SimplePrintOptionsDialog, SimplePrintOptionsResult } from '../../components/shared/simple-print-options-dialog';\r\nimport { toast } from 'sonner';\r\nimport Fuse from 'fuse.js';\r\nimport { asSystemId, asBusinessId } from '../../lib/id-types';\r\nimport type { InventoryCheck } from './types';\r\nimport {\r\n  AlertDialog,\r\n  AlertDialogAction,\r\n  AlertDialogCancel,\r\n  AlertDialogContent,\r\n  AlertDialogDescription,\r\n  AlertDialogFooter,\r\n  AlertDialogHeader,\r\n  AlertDialogTitle,\r\n} from '../../components/ui/alert-dialog';\r\nimport { useStoreInfoStore } from '../settings/store-info/store-info-store';\r\nimport { usePrint } from '../../lib/use-print';\r\nimport { useBranchStore } from '../settings/branches/store';\r\nimport { \r\n  convertInventoryCheckForPrint,\r\n  mapInventoryCheckToPrintData,\r\n  mapInventoryCheckLineItems,\r\n  createStoreSettings,\r\n} from '../../lib/print/inventory-check-print-helper';\r\n\r\ntype ConfirmState =\r\n  | { type: 'cancel'; item: InventoryCheck }\r\n  | { type: 'balance'; item: InventoryCheck }\r\n  | { type: 'bulk-cancel'; items: InventoryCheck[] }\r\n  | { type: 'bulk-balance'; items: InventoryCheck[] }\r\n  | null;\r\n\r\nexport function InventoryChecksPage() {\r\n  const router = useRouter();\r\n  const { isMobile } = useBreakpoint();\r\n  const { employee: currentUser } = useAuth();\r\n  const { data, balanceCheck, cancelCheck } = useInventoryCheckStore();\r\n  const { info: storeInfo } = useStoreInfoStore();\r\n  const { findById: findBranchById, data: branches } = useBranchStore();\r\n  const { print, printMultiple } = usePrint();\r\n\r\n  // Print dialog state\r\n  const [isPrintDialogOpen, setIsPrintDialogOpen] = React.useState(false);\r\n  const [pendingPrintItems, setPendingPrintItems] = React.useState<InventoryCheck[]>([]);\r\n\r\n  // Import/Export dialog state\r\n  const [showImportDialog, setShowImportDialog] = React.useState(false);\r\n  const [showExportDialog, setShowExportDialog] = React.useState(false);\r\n\r\n  // States\r\n  const [searchQuery, setSearchQuery] = React.useState('');\r\n  const [statusFilter, setStatusFilter] = React.useState('all');\r\n  const [pagination, setPagination] = React.useState({ pageIndex: 0, pageSize: 20 });\r\n  const [sorting, setSorting] = React.useState({ id: 'createdAt', desc: true });\r\n  const [rowSelection, setRowSelection] = React.useState<Record<string, boolean>>({});\r\n  const [columnVisibility, setColumnVisibility] = React.useState<Record<string, boolean>>({});\r\n  const [columnOrder, setColumnOrder] = React.useState<string[]>([]);\r\n  const [pinnedColumns, setPinnedColumns] = React.useState<string[]>(['select', 'id']);\r\n  const [mobileLoadedCount, setMobileLoadedCount] = React.useState(20);\r\n  const [confirmState, setConfirmState] = React.useState<ConfirmState>(null);\r\n  const [isConfirmLoading, setIsConfirmLoading] = React.useState(false);\r\n\r\n  // Handlers\r\n  const handleEdit = React.useCallback((item: InventoryCheck) => {\r\n    router.push(ROUTES.INVENTORY.INVENTORY_CHECK_EDIT.replace(':systemId', item.systemId));\r\n  }, [router]);\r\n\r\n  const requestCancel = React.useCallback((item: InventoryCheck) => {\r\n    if (item.status !== 'draft') {\r\n      toast.info('Chỉ có thể hủy phiếu đang ở trạng thái Nháp');\r\n      return;\r\n    }\r\n    setConfirmState({ type: 'cancel', item });\r\n  }, []);\r\n  const requestBalance = React.useCallback((item: InventoryCheck) => {\r\n    setConfirmState({ type: 'balance', item });\r\n  }, []);\r\n\r\n  const handlePrint = React.useCallback((item: InventoryCheck) => {\r\n    // Use helper to prepare print data\r\n    const branch = findBranchById(item.branchSystemId);\r\n    const storeSettings = branch \r\n      ? {\r\n          name: branch.name,\r\n          address: branch.address || '',\r\n          phone: branch.phone || '',\r\n          email: '',\r\n          province: branch.province || '',\r\n        }\r\n      : createStoreSettings(storeInfo);\r\n    const checkData = convertInventoryCheckForPrint(item, { branch });\r\n    \r\n    print('inventory-check', {\r\n      data: mapInventoryCheckToPrintData(checkData, storeSettings),\r\n      lineItems: mapInventoryCheckLineItems(checkData.items),\r\n    });\r\n  }, [findBranchById, storeInfo, print]);\r\n\r\n  const handleConfirmAction = React.useCallback(async () => {\r\n    if (!confirmState) return;\r\n    setIsConfirmLoading(true);\r\n    try {\r\n      if (confirmState.type === 'cancel' && confirmState.item) {\r\n        cancelCheck(asSystemId(confirmState.item.systemId), 'Hủy từ danh sách');\r\n        toast.success(`Đã hủy phiếu ${confirmState.item.id}`);\r\n      }\r\n\r\n      if (confirmState.type === 'balance' && confirmState.item) {\r\n        await balanceCheck(asSystemId(confirmState.item.systemId));\r\n        toast.success(`Đã cân bằng phiếu ${confirmState.item.id}`);\r\n      }\r\n\r\n      if (confirmState.type === 'bulk-cancel' && confirmState.items) {\r\n        let successCount = 0;\r\n        confirmState.items.forEach(item => {\r\n          if (item.status === 'draft') {\r\n            cancelCheck(asSystemId(item.systemId), 'Hủy hàng loạt');\r\n            successCount++;\r\n          }\r\n        });\r\n        setRowSelection({});\r\n        if (successCount > 0) {\r\n          toast.success(`Đã hủy ${successCount} phiếu kiểm hàng`);\r\n        } else {\r\n          toast.info('Không có phiếu nào được hủy', {\r\n            description: 'Chỉ có thể hủy các phiếu đang ở trạng thái Nháp'\r\n          });\r\n        }\r\n      }\r\n\r\n      if (confirmState.type === 'bulk-balance' && confirmState.items) {\r\n        let successCount = 0;\r\n        for (const item of confirmState.items) {\r\n          if (item.status === 'draft') {\r\n            await balanceCheck(asSystemId(item.systemId));\r\n            successCount++;\r\n          }\r\n        }\r\n        setRowSelection({});\r\n        if (successCount > 0) {\r\n          toast.success(`Đã cân bằng ${successCount} phiếu kiểm hàng`);\r\n        } else {\r\n          toast.info('Không có phiếu nào được cân bằng', {\r\n            description: 'Chỉ có thể cân bằng các phiếu đang ở trạng thái Nháp'\r\n          });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      toast.error('Không thể hoàn tất hành động, vui lòng thử lại');\r\n    } finally {\r\n      setIsConfirmLoading(false);\r\n      setConfirmState(null);\r\n    }\r\n  }, [balanceCheck, cancelCheck, confirmState, setRowSelection]);\r\n\r\n  // Columns\r\n  const columns = React.useMemo(() => \r\n    getColumns(handleEdit, requestCancel, requestBalance, (path: string) => router.push(path), handlePrint),\r\n    [handleEdit, router, requestCancel, requestBalance, handlePrint]\r\n  );\r\n\r\n  // Default column visibility - 15 columns for sticky scrollbar\r\n  React.useEffect(() => {\r\n    if (!columns || columns.length === 0) return;\r\n    \r\n    const defaultVisibleColumns = [\r\n      'id', 'branch', 'status', 'createdAt', 'createdBy', \r\n      'balancedAt', 'itemsCount', 'systemQty', 'actualQty', \r\n      'difference', 'itemPreview', 'note'\r\n    ];\r\n    \r\n    const initialVisibility: Record<string, boolean> = {};\r\n    columns.forEach(c => {\r\n      if (c.id === 'select' || c.id === 'actions') {\r\n        initialVisibility[c.id!] = true;\r\n      } else {\r\n        initialVisibility[c.id!] = defaultVisibleColumns.includes(c.id!);\r\n      }\r\n    });\r\n    \r\n    setColumnVisibility(initialVisibility);\r\n    setColumnOrder(columns.map(c => c.id).filter(Boolean) as string[]);\r\n  }, [columns]);\r\n\r\n  // Search & Filter with Fuse.js\r\n  const fuse = React.useMemo(() => new Fuse(data, { \r\n    keys: ['id', 'branchName', 'createdBy', 'note'],\r\n    threshold: 0.3,\r\n  }), [data]);\r\n\r\n  const filteredData = React.useMemo(() => {\r\n    let result = data;\r\n    \r\n    // Search\r\n    if (searchQuery) {\r\n      result = fuse.search(searchQuery).map(r => r.item);\r\n    }\r\n    \r\n    // Status filter\r\n    if (statusFilter !== 'all') {\r\n      result = result.filter(item => item.status === statusFilter);\r\n    }\r\n    \r\n    // Sorting\r\n    if (sorting) {\r\n      result = [...result].sort((a, b) => {\r\n        const aValue = (a as any)[sorting.id];\r\n        const bValue = (b as any)[sorting.id];\r\n        // Special handling for date columns\r\n        if (sorting.id === 'createdAt' || sorting.id === 'checkDate') {\r\n          const aTime = aValue ? new Date(aValue).getTime() : 0;\r\n          const bTime = bValue ? new Date(bValue).getTime() : 0;\r\n          return sorting.desc ? bTime - aTime : aTime - bTime;\r\n        }\r\n        if (aValue < bValue) return sorting.desc ? 1 : -1;\r\n        if (aValue > bValue) return sorting.desc ? -1 : 1;\r\n        return 0;\r\n      });\r\n    }\r\n    \r\n    return result;\r\n  }, [data, searchQuery, statusFilter, sorting, fuse]);\r\n\r\n  // Pagination\r\n  const pageCount = Math.ceil(filteredData.length / pagination.pageSize);\r\n  const paginatedData = React.useMemo(() => {\r\n    const start = pagination.pageIndex * pagination.pageSize;\r\n    return filteredData.slice(start, start + pagination.pageSize);\r\n  }, [filteredData, pagination]);\r\n\r\n  // Mobile infinite scroll\r\n  React.useEffect(() => {\r\n    setMobileLoadedCount(20);\r\n  }, [searchQuery, statusFilter]);\r\n\r\n  React.useEffect(() => {\r\n    if (!isMobile) return;\r\n    \r\n    const handleScroll = () => {\r\n      const scrollPercentage = ((window.scrollY + window.innerHeight) / document.documentElement.scrollHeight) * 100;\r\n      if (scrollPercentage > 80 && mobileLoadedCount < filteredData.length) {\r\n        setMobileLoadedCount(prev => Math.min(prev + 20, filteredData.length));\r\n      }\r\n    };\r\n    \r\n    window.addEventListener('scroll', handleScroll);\r\n    return () => window.removeEventListener('scroll', handleScroll);\r\n  }, [isMobile, mobileLoadedCount, filteredData.length]);\r\n\r\n  const displayData = isMobile ? filteredData.slice(0, mobileLoadedCount) : paginatedData;\r\n\r\n  // Selected rows\r\n  const allSelectedRows = React.useMemo(() => \r\n    Object.keys(rowSelection)\r\n      .filter(key => rowSelection[key])\r\n      .map(systemId => filteredData.find(item => item.systemId === systemId))\r\n      .filter(Boolean) as InventoryCheck[],\r\n    [rowSelection, filteredData]\r\n  );\r\n\r\n  // Selected checks for export\r\n  const selectedChecks = React.useMemo(() => {\r\n    return data.filter(c => rowSelection[c.systemId]);\r\n  }, [data, rowSelection]);\r\n\r\n  // Import handler\r\n  const handleImport = React.useCallback(async (\r\n    importedChecks: Partial<InventoryCheck>[],\r\n    mode: 'insert-only' | 'update-only' | 'upsert',\r\n    _branchId?: string\r\n  ) => {\r\n    let addedCount = 0;\r\n    let updatedCount = 0;\r\n    let skippedCount = 0;\r\n    const errors: Array<{ row: number; message: string }> = [];\r\n    \r\n    const storeState = useInventoryCheckStore.getState();\r\n    \r\n    importedChecks.forEach((check, index) => {\r\n      try {\r\n        const existing = data.find(c => \r\n          c.id.toLowerCase() === (check.id || '').toLowerCase()\r\n        );\r\n        \r\n        if (existing) {\r\n          if (mode === 'update-only' || mode === 'upsert') {\r\n            storeState.update(asSystemId(existing.systemId), { ...existing, ...check, systemId: existing.systemId } as InventoryCheck);\r\n            updatedCount++;\r\n          } else {\r\n            skippedCount++;\r\n          }\r\n        } else {\r\n          if (mode === 'insert-only' || mode === 'upsert') {\r\n            storeState.add(check as InventoryCheck);\r\n            addedCount++;\r\n          } else {\r\n            skippedCount++;\r\n          }\r\n        }\r\n      } catch (error) {\r\n        errors.push({ row: index + 1, message: (error as Error).message });\r\n      }\r\n    });\r\n    \r\n    if (addedCount > 0 || updatedCount > 0) {\r\n      const messages = [];\r\n      if (addedCount > 0) messages.push(`${addedCount} phiếu kiểm kê mới`);\r\n      if (updatedCount > 0) messages.push(`${updatedCount} phiếu cập nhật`);\r\n      toast.success(`Đã import: ${messages.join(', ')}`);\r\n    }\r\n    \r\n    return {\r\n      success: addedCount + updatedCount,\r\n      failed: errors.length,\r\n      inserted: addedCount,\r\n      updated: updatedCount,\r\n      skipped: skippedCount,\r\n      errors,\r\n    };\r\n  }, [data]);\r\n\r\n  // Bulk print - open dialog\r\n  const handleBulkPrint = React.useCallback(() => {\r\n    if (allSelectedRows.length === 0) return;\r\n    setPendingPrintItems(allSelectedRows);\r\n    setIsPrintDialogOpen(true);\r\n  }, [allSelectedRows]);\r\n\r\n  // Handle print confirm from dialog\r\n  const handlePrintConfirm = React.useCallback((options: SimplePrintOptionsResult) => {\r\n    const { branchSystemId, paperSize } = options;\r\n    \r\n    const printOptionsList = pendingPrintItems.map(item => {\r\n      const branch = branchSystemId \r\n        ? findBranchById(branchSystemId)\r\n        : findBranchById(item.branchSystemId);\r\n      const storeSettings = branch \r\n        ? {\r\n            name: branch.name,\r\n            address: branch.address || '',\r\n            phone: branch.phone || '',\r\n            email: '',\r\n            province: branch.province || '',\r\n          }\r\n        : createStoreSettings(storeInfo);\r\n      const checkData = convertInventoryCheckForPrint(item, { branch });\r\n      \r\n      return {\r\n        data: mapInventoryCheckToPrintData(checkData, storeSettings),\r\n        lineItems: mapInventoryCheckLineItems(checkData.items),\r\n        paperSize,\r\n      };\r\n    });\r\n    \r\n    printMultiple('inventory-check', printOptionsList);\r\n    \r\n    toast.success('Đã gửi lệnh in', {\r\n      description: pendingPrintItems.map(i => i.id).join(', ')\r\n    });\r\n    setRowSelection({});\r\n    setPendingPrintItems([]);\r\n  }, [pendingPrintItems, findBranchById, storeInfo, printMultiple]);\r\n\r\n  // Bulk cancel\r\n  const handleBulkCancel = React.useCallback(() => {\r\n    if (allSelectedRows.length === 0) return;\r\n    const draftItems = allSelectedRows.filter(item => item.status === 'draft');\r\n    if (draftItems.length === 0) {\r\n      toast.info('Không có phiếu nào có thể hủy', {\r\n        description: 'Chỉ có thể hủy các phiếu đang ở trạng thái Nháp'\r\n      });\r\n      return;\r\n    }\r\n    setConfirmState({ type: 'bulk-cancel', items: draftItems });\r\n  }, [allSelectedRows]);\r\n\r\n  // Bulk balance\r\n  const handleBulkBalance = React.useCallback(() => {\r\n    if (allSelectedRows.length === 0) return;\r\n    const draftItems = allSelectedRows.filter(item => item.status === 'draft');\r\n    if (draftItems.length === 0) {\r\n      toast.info('Không có phiếu nào có thể cân bằng', {\r\n        description: 'Chỉ có thể cân bằng các phiếu đang ở trạng thái Nháp'\r\n      });\r\n      return;\r\n    }\r\n    setConfirmState({ type: 'bulk-balance', items: draftItems });\r\n  }, [allSelectedRows]);\r\n\r\n  // Bulk actions\r\n  const bulkActions = React.useMemo(() => [\r\n    {\r\n      label: 'In phiếu kiểm',\r\n      icon: Printer,\r\n      onSelect: handleBulkPrint,\r\n    },\r\n    {\r\n      label: 'Cân bằng',\r\n      icon: Scale,\r\n      onSelect: handleBulkBalance,\r\n    },\r\n    {\r\n      label: 'Hủy phiếu',\r\n      icon: XCircle,\r\n      onSelect: handleBulkCancel,\r\n      variant: 'destructive' as const,\r\n    },\r\n  ], [handleBulkPrint, handleBulkBalance, handleBulkCancel]);\r\n\r\n  // Header actions - Chỉ giữ action chính\r\n  const headerActions = React.useMemo(() => [\r\n    <Button key=\"add\" className=\"h-9\" onClick={() => router.push(ROUTES.INVENTORY.INVENTORY_CHECK_NEW)}>\r\n      <Plus className=\"mr-2 h-4 w-4\" />\r\n      Tạo phiếu kiểm hàng\r\n    </Button>\r\n  ], [router]);\r\n\r\n  const confirmDialogCopy = React.useMemo(() => {\r\n    if (!confirmState) return null;\r\n\r\n    switch (confirmState.type) {\r\n      case 'cancel':\r\n        return {\r\n          title: 'Hủy phiếu kiểm hàng',\r\n          description: `Bạn có chắc muốn hủy phiếu ${confirmState.item?.id}? Phiếu sẽ chuyển sang trạng thái Đã hủy.`,\r\n          confirmLabel: 'Hủy phiếu',\r\n        };\r\n      case 'balance':\r\n        return {\r\n          title: 'Cân bằng phiếu kiểm hàng',\r\n          description: `Sau khi cân bằng, tồn kho hệ thống sẽ cập nhật theo số thực tế của phiếu ${confirmState.item?.id}. Tiếp tục?`,\r\n          confirmLabel: 'Cân bằng ngay',\r\n        };\r\n      case 'bulk-cancel':\r\n        return {\r\n          title: 'Hủy nhiều phiếu kiểm hàng',\r\n          description: `Bạn sắp hủy ${confirmState.items?.length ?? 0} phiếu kiểm hàng đã chọn. Chỉ các phiếu đang ở trạng thái Nháp mới được hủy.`,\r\n          confirmLabel: `Hủy ${confirmState.items?.length ?? 0} phiếu`,\r\n        };\r\n      case 'bulk-balance':\r\n        return {\r\n          title: 'Cân bằng nhiều phiếu kiểm hàng',\r\n          description: `Bạn sắp cân bằng ${confirmState.items?.length ?? 0} phiếu kiểm hàng. Tồn kho hệ thống sẽ được cập nhật theo số thực tế.`,\r\n          confirmLabel: `Cân bằng ${confirmState.items?.length ?? 0} phiếu`,\r\n        };\r\n      default:\r\n        return null;\r\n    }\r\n  }, [confirmState]);\r\n\r\n  usePageHeader({\r\n    title: 'Danh sách kiểm hàng',\r\n    breadcrumb: [\r\n      { label: 'Trang chủ', href: ROUTES.DASHBOARD, isCurrent: false },\r\n      { label: 'Kiểm hàng', href: ROUTES.INVENTORY.INVENTORY_CHECKS, isCurrent: true }\r\n    ],\r\n    actions: headerActions,\r\n  });\r\n\r\n  return (\r\n    <div className=\"space-y-4\">\r\n      {/* Toolbar - Export và Column Customizer */}\r\n      {!isMobile && (\r\n        <PageToolbar\r\n          leftActions={\r\n            <>\r\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setShowImportDialog(true)}>\r\n                <FileSpreadsheet className=\"mr-2 h-4 w-4\" />\r\n                Nhập file\r\n              </Button>\r\n              <Button variant=\"outline\" size=\"sm\" onClick={() => setShowExportDialog(true)}>\r\n                <Download className=\"mr-2 h-4 w-4\" />\r\n                Xuất Excel\r\n              </Button>\r\n            </>\r\n          }\r\n          rightActions={\r\n            columns && columns.length > 0 ? (\r\n              <DataTableColumnCustomizer \r\n                columns={columns}\r\n                columnVisibility={columnVisibility}\r\n                setColumnVisibility={setColumnVisibility}\r\n                columnOrder={columnOrder}\r\n                setColumnOrder={setColumnOrder}\r\n                pinnedColumns={pinnedColumns}\r\n                setPinnedColumns={setPinnedColumns}\r\n              />\r\n            ) : null\r\n          }\r\n        />\r\n      )}\r\n\r\n      {/* Search & Filters */}\r\n      <div className=\"flex flex-col gap-2 md:flex-row md:items-center\">\r\n        <Input \r\n          placeholder=\"Tìm kiếm theo mã, chi nhánh, người tạo...\" \r\n          value={searchQuery}\r\n          onChange={(e) => setSearchQuery(e.target.value)}\r\n          className=\"h-9 max-w-sm\"\r\n        />\r\n        <DataTableFacetedFilter\r\n          title=\"Trạng thái\"\r\n          selectedValues={new Set(statusFilter === 'all' ? [] : [statusFilter])}\r\n          onSelectedValuesChange={(values) => setStatusFilter(values.size === 0 ? 'all' : Array.from(values)[0] as string)}\r\n          options={[\r\n            { label: 'Nháp', value: 'draft' },\r\n            { label: 'Đã cân bằng', value: 'balanced' },\r\n            { label: 'Đã hủy', value: 'cancelled' },\r\n          ]}\r\n        />\r\n      </div>\r\n\r\n      {/* Data Table */}\r\n      <ResponsiveDataTable\r\n        columns={columns}\r\n        data={displayData}\r\n        renderMobileCard={(item) => (\r\n          <InventoryCheckCard \r\n            item={item} \r\n            onEdit={handleEdit}\r\n            onBalance={requestBalance}\r\n          />\r\n        )}\r\n        pageCount={pageCount}\r\n        pagination={pagination}\r\n        setPagination={setPagination}\r\n        rowCount={filteredData.length}\r\n        rowSelection={rowSelection}\r\n        setRowSelection={setRowSelection}\r\n        allSelectedRows={allSelectedRows}\r\n        bulkActions={bulkActions}\r\n        showBulkDeleteButton={false}\r\n        sorting={sorting}\r\n        setSorting={setSorting}\r\n        columnVisibility={columnVisibility}\r\n        setColumnVisibility={setColumnVisibility}\r\n        columnOrder={columnOrder}\r\n        setColumnOrder={setColumnOrder}\r\n        pinnedColumns={pinnedColumns}\r\n        setPinnedColumns={setPinnedColumns}\r\n        emptyTitle=\"Không có phiếu kiểm hàng\"\r\n        emptyDescription=\"Tạo phiếu kiểm hàng đầu tiên để bắt đầu\"\r\n      />\r\n\r\n      {/* Mobile loading indicator */}\r\n      {isMobile && mobileLoadedCount < filteredData.length && (\r\n        <div className=\"py-6 text-center\">\r\n          <div className=\"flex items-center justify-center gap-2 text-muted-foreground\">\r\n            <div className=\"h-4 w-4 animate-spin rounded-full border-2 border-primary border-t-transparent\" />\r\n            <span className=\"text-body-sm\">Đang tải thêm...</span>\r\n          </div>\r\n        </div>\r\n      )}\r\n      \r\n      {isMobile && mobileLoadedCount >= filteredData.length && filteredData.length > 20 && (\r\n        <div className=\"py-6 text-center\">\r\n          <p className=\"text-body-sm text-muted-foreground\">\r\n            Đã hiển thị tất cả {filteredData.length} kết quả\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      <AlertDialog open={!!confirmState} onOpenChange={(open) => {\r\n        if (!open && !isConfirmLoading) {\r\n          setConfirmState(null);\r\n        }\r\n      }}>\r\n        <AlertDialogContent>\r\n          <AlertDialogHeader>\r\n            <AlertDialogTitle>{confirmDialogCopy?.title}</AlertDialogTitle>\r\n            <AlertDialogDescription>\r\n              {confirmDialogCopy?.description}\r\n            </AlertDialogDescription>\r\n          </AlertDialogHeader>\r\n          <AlertDialogFooter>\r\n            <AlertDialogCancel className=\"h-9\" disabled={isConfirmLoading}>\r\n              Hủy\r\n            </AlertDialogCancel>\r\n            <AlertDialogAction\r\n              className=\"h-9\"\r\n              disabled={isConfirmLoading}\r\n              onClick={handleConfirmAction}\r\n            >\r\n              {isConfirmLoading ? 'Đang xử lý...' : confirmDialogCopy?.confirmLabel ?? 'Đồng ý'}\r\n            </AlertDialogAction>\r\n          </AlertDialogFooter>\r\n        </AlertDialogContent>\r\n      </AlertDialog>\r\n\r\n      {/* Print Options Dialog */}\r\n      <SimplePrintOptionsDialog\r\n        open={isPrintDialogOpen}\r\n        onOpenChange={setIsPrintDialogOpen}\r\n        onConfirm={handlePrintConfirm}\r\n        selectedCount={pendingPrintItems.length}\r\n        title=\"In phiếu kiểm hàng\"\r\n      />\r\n\r\n      {/* Import Dialog */}\r\n      <GenericImportDialogV2<InventoryCheck>\r\n        open={showImportDialog}\r\n        onOpenChange={setShowImportDialog}\r\n        config={inventoryCheckImportExportConfig}\r\n        branches={branches.map(b => ({ systemId: b.systemId, name: b.name }))}\r\n        existingData={data}\r\n        onImport={handleImport}\r\n        currentUser={{\r\n          name: currentUser?.fullName || 'Hệ thống',\r\n          systemId: currentUser?.systemId || asSystemId('SYSTEM'),\r\n        }}\r\n      />\r\n\r\n      {/* Export Dialog */}\r\n      <GenericExportDialogV2<InventoryCheck>\r\n        open={showExportDialog}\r\n        onOpenChange={setShowExportDialog}\r\n        config={inventoryCheckImportExportConfig}\r\n        allData={data}\r\n        filteredData={filteredData}\r\n        currentPageData={paginatedData}\r\n        selectedData={selectedChecks}\r\n        currentUser={{\r\n          name: currentUser?.fullName || 'Hệ thống',\r\n          systemId: currentUser?.systemId || asSystemId('SYSTEM'),\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}