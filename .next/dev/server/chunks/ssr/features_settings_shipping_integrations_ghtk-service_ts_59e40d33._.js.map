{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/shipping/integrations/ghtk-service.ts"],"sourcesContent":["/**\r\n * GHTK (Giao H√†ng Ti·∫øt Ki·ªám) API Integration Service\r\n * Documentation: https://api.ghtk.vn/\r\n */\r\n\r\nimport { getBaseUrl } from '@/lib/api-config';\r\n\r\n// ‚úÖ Use local proxy server to avoid CORS\r\nconst GHTK_BASE_URL = `${getBaseUrl()}/api/shipping/ghtk`;\r\n\r\n// GHTK API Response types\r\nexport type GHTKShippingFeeResponse = {\r\n  success: boolean;\r\n  message: string;\r\n  fee: {\r\n    name: string; // area1, area2, area3\r\n    fee: number; // Ph√≠ v·∫≠n chuy·ªÉn (VNƒê)\r\n    insurance_fee: number; // Ph√≠ khai gi√° (VNƒê)\r\n    delivery: boolean; // H·ªó tr·ª£ giao h√†ng\r\n    delivery_type?: string | undefined;\r\n    extFees?: Array<{\r\n      display: string;\r\n      title: string;\r\n      amount: number;\r\n      type: string;\r\n    }> | undefined;\r\n  };\r\n};\r\n\r\nexport type GHTKCreateOrderResponse = {\r\n  success: boolean;\r\n  message: string;\r\n  order?: {\r\n    partner_id: string;\r\n    label: string; // M√£ v·∫≠n ƒë∆°n GHTK\r\n    area: string;\r\n    fee: string;\r\n    insurance_fee: string;\r\n    tracking_id: number;\r\n    estimated_pick_time: string;\r\n    estimated_deliver_time: string;\r\n    status_id: number;\r\n  } | undefined;\r\n  error?: {\r\n    code: string;\r\n    partner_id?: string | undefined;\r\n    ghtk_label?: string | undefined;\r\n    created?: string | undefined;\r\n    status?: number | undefined;\r\n  } | undefined;\r\n};\r\n\r\nexport type GHTKOrderStatusResponse = {\r\n  success: boolean;\r\n  message: string;\r\n  order?: {\r\n    label_id: string; // M√£ GHTK\r\n    partner_id: string; // M√£ ƒë·ªëi t√°c\r\n    status: string; // M√£ tr·∫°ng th√°i\r\n    status_text: string;\r\n    created: string;\r\n    modified: string;\r\n    message: string;\r\n    pick_date: string;\r\n    deliver_date: string;\r\n    customer_fullname: string;\r\n    customer_tel: string;\r\n    address: string;\r\n    storage_day: number;\r\n    ship_money: number;\r\n    insurance: number;\r\n    value: number;\r\n    weight: number;\r\n    pick_money: number;\r\n    is_freeship: number;\r\n  } | undefined;\r\n};\r\n\r\nexport type GHTKCreateOrderParams = {\r\n  // Th√¥ng tin ƒë∆°n h√†ng\r\n  orderId: string; // M√£ ƒë∆°n h√†ng c·ªßa shop\r\n  \r\n  // ƒêi·ªÉm l·∫•y h√†ng\r\n  pickAddressId?: string | undefined; // ID kho l·∫•y h√†ng t·ª´ GHTK (n·∫øu c√≥ - ∆∞u ti√™n d√πng)\r\n  pickName?: string | undefined; // ‚ö†Ô∏è REQUIRED - T√™n ng∆∞·ªùi g·ª≠i (c·∫ßn c·∫£ khi c√≥ pickAddressId)\r\n  pickAddress?: string | undefined; // ‚ö†Ô∏è REQUIRED - ƒê·ªãa ch·ªâ l·∫•y h√†ng (c·∫ßn c·∫£ khi c√≥ pickAddressId!)\r\n  pickTel?: string | undefined; // ‚ö†Ô∏è REQUIRED - SƒêT ng∆∞·ªùi g·ª≠i (c·∫ßn c·∫£ khi c√≥ pickAddressId)\r\n  pickProvince?: string | undefined; // Ch·ªâ c·∫ßn khi KH√îNG c√≥ pickAddressId\r\n  pickDistrict?: string | undefined; // Ch·ªâ c·∫ßn khi KH√îNG c√≥ pickAddressId\r\n  pickWard?: string | undefined; // Ch·ªâ c·∫ßn khi KH√îNG c√≥ pickAddressId\r\n  pickStreet?: string | undefined; // Ch·ªâ c·∫ßn khi KH√îNG c√≥ pickAddressId\r\n  \r\n  // ƒêi·ªÉm giao h√†ng\r\n  customerName: string;\r\n  customerAddress: string;\r\n  customerProvince: string;\r\n  customerDistrict: string;\r\n  customerWard: string;\r\n  customerStreet?: string | undefined;\r\n  customerTel: string;\r\n  customerHamlet?: string | undefined; // Th√¥n/·∫•p (n·∫øu kh√¥ng c√≥ street)\r\n  \r\n  // Th√¥ng tin h√†ng h√≥a\r\n  products: Array<{\r\n    name: string;\r\n    weight: number; // KG\r\n    quantity: number;\r\n    price?: number | undefined;\r\n    productCode?: string | undefined;\r\n    height?: number | undefined; // cm\r\n    width?: number | undefined; // cm\r\n    length?: number | undefined; // cm\r\n  }>;\r\n  \r\n  // Th√¥ng tin thanh to√°n\r\n  pickMoney: number; // Ti·ªÅn CoD\r\n  value: number; // Gi√° tr·ªã khai gi√°\r\n  isFreeship?: number | boolean | undefined; // Shop tr·∫£ ship hay kh√¥ng (0/1 or false/true)\r\n  failedDeliveryFee?: number | undefined; // ‚úÖ S·ªë ti·ªÅn thu khi kh√¥ng giao ƒë∆∞·ª£c (tag 19) - S·∫Ω map sang not_delivered_fee\r\n  \r\n  // Th√¥ng tin b·ªï sung\r\n  note?: string | undefined;\r\n  transport?: 'road' | 'fly' | undefined; // ƒê∆∞·ªùng b·ªô ho·∫∑c bay\r\n  tags?: number[] | undefined; // Nh√£n ƒë∆°n h√†ng\r\n  weightOption?: 'gram' | 'kilogram' | undefined; // ƒê∆°n v·ªã kh·ªëi l∆∞·ª£ng\r\n  totalWeight?: number | undefined; // T·ªïng kh·ªëi l∆∞·ª£ng (theo weightOption)\r\n  totalBox?: number | undefined; // ‚úÖ T·ªïng s·ªë ki·ªán h√†ng\r\n  \r\n  // Ng√†y gi·ªù\r\n  pickDate?: string | undefined; // YYYY/MM/DD (format: YYYY-MM-DD)\r\n  deliverDate?: string | undefined; // YYYY/MM/DD\r\n  pickWorkShift?: 1 | 2 | undefined; // 1=s√°ng, 2=chi·ªÅu\r\n  deliverWorkShift?: 1 | 2 | undefined; // 1=s√°ng, 2=chi·ªÅu\r\n};\r\n\r\nexport type GHTKCalculateFeeParams = {\r\n  // ƒêi·ªÉm l·∫•y h√†ng\r\n  pickProvince: string;\r\n  pickDistrict: string;\r\n  pickWard?: string | undefined;\r\n  \r\n  // ƒêi·ªÉm giao h√†ng\r\n  province: string;\r\n  district: string;\r\n  ward?: string | undefined;\r\n  address?: string | undefined;\r\n  \r\n  // Th√¥ng tin h√†ng h√≥a\r\n  weight: number; // KG (not gram!) - GHTK API uses KG\r\n  value?: number | undefined; // Gi√° tr·ªã khai gi√° (VNƒê)\r\n  transport?: 'road' | 'fly' | undefined;\r\n  tags?: number[] | undefined;\r\n};\r\n\r\n/**\r\n * GHTK Service Class\r\n */\r\nexport class GHTKService {\r\n  private apiToken: string;\r\n  private partnerCode: string;\r\n\r\n  constructor(apiToken: string, partnerCode: string = '') {\r\n    this.apiToken = apiToken;\r\n    this.partnerCode = partnerCode;\r\n  }\r\n\r\n  /**\r\n   * T√≠nh ph√≠ v·∫≠n chuy·ªÉn\r\n   */\r\n  async calculateShippingFee(\r\n    params: GHTKCalculateFeeParams\r\n  ): Promise<GHTKShippingFeeResponse> {\r\n    // ‚úÖ Call through proxy server\r\n    const payload = {\r\n      apiToken: this.apiToken,\r\n      partnerCode: this.partnerCode,\r\n      pick_province: params.pickProvince,\r\n      pick_district: params.pickDistrict,\r\n      pick_ward: params.pickWard,\r\n      province: params.province,\r\n      district: params.district,\r\n      ward: params.ward,\r\n      address: params.address,\r\n      weight: params.weight * 1000, // ‚úÖ Convert KG to GRAM for fee API\r\n      value: params.value,\r\n      transport: params.transport,\r\n      tags: params.tags,\r\n    };\r\n\r\n    const response = await fetch(`${GHTK_BASE_URL}/calculate-fee`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify(payload),\r\n    });\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json().catch(() => ({}));\r\n      throw new Error(errorData.error || `GHTK API Error: ${response.status} ${response.statusText}`);\r\n    }\r\n\r\n    return await response.json();\r\n  }\r\n\r\n  /**\r\n   * T·∫°o ƒë∆°n h√†ng m·ªõi\r\n   */\r\n  async createOrder(\r\n    params: GHTKCreateOrderParams\r\n  ): Promise<GHTKCreateOrderResponse> {\r\n    // ‚ö†Ô∏è GHTK limitation: Cannot create orders >= 20,000 gram (20kg)\r\n    const totalWeightGram = params.totalWeight || params.products.reduce((sum, p) => sum + (p.weight * p.quantity), 0);\r\n    \r\n    if (totalWeightGram >= 20000) {\r\n      throw new Error(`GHTK kh√¥ng h·ªó tr·ª£ ƒë∆°n h√†ng ‚â•20kg (${totalWeightGram}g). Vui l√≤ng li√™n h·ªá GHTK ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£ d·ªãch v·ª• BBS cho h√†ng n·∫∑ng.`);\r\n    }\r\n    \r\n    // ‚úÖ Call through proxy server\r\n    console.log('[GHTKService.createOrder] pickAddressId:', params.pickAddressId, 'type:', typeof params.pickAddressId);\r\n    \r\n    const payload: any = {\r\n      apiToken: this.apiToken,\r\n      partnerCode: this.partnerCode,\r\n      \r\n      // ‚ö†Ô∏è CRITICAL GHTK API STRUCTURE - UPDATED:\r\n      // According to GHTK API behavior (error 30207 testing):\r\n      // \r\n      // pick_address_id = ID c·ªßa KHO GHTK (t·ª´ API /services/shipment/list_pick_address_id)\r\n      // \r\n      // ‚ö†Ô∏è IMPORTANT: Ngay c·∫£ khi c√≥ pick_address_id, GHTK V·∫™N Y√äU C·∫¶U ƒë·∫ßy ƒë·ªß th√¥ng tin ƒë·ªãa ch·ªâ!\r\n      //    - Ph·∫£i g·ª≠i: pick_name, pick_address, pick_province, pick_district, pick_tel\r\n      //    - pick_address_id CH·ªà d√πng ƒë·ªÉ x√°c ƒë·ªãnh kho ∆∞u ti√™n, KH√îNG thay th·∫ø ƒë·ªãa ch·ªâ chi ti·∫øt\r\n      //    - N·∫øu thi·∫øu pick_address ‚Üí Error 30207 \"Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ l·∫•y h√†ng h√≥a\"\r\n      \r\n      // ‚úÖ Pickup info - ALWAYS send full address details\r\n      pick_name: params.pickName || 'Ng∆∞·ªùi g·ª≠i', // ‚ö†Ô∏è REQUIRED\r\n      pick_address: params.pickAddress || '', // ‚ö†Ô∏è REQUIRED - ƒë·ªãa ch·ªâ chi ti·∫øt kho\r\n      pick_province: params.pickProvince || '', // ‚ö†Ô∏è REQUIRED\r\n      pick_district: params.pickDistrict || '', // ‚ö†Ô∏è REQUIRED\r\n      pick_ward: params.pickWard || '',\r\n      pick_tel: params.pickTel || '', // ‚ö†Ô∏è REQUIRED\r\n      \r\n      // ‚úÖ pick_address_id is OPTIONAL, only add if available\r\n      ...(params.pickAddressId ? {\r\n        pick_address_id: params.pickAddressId, // ID kho GHTK (optional but recommended)\r\n      } : {}),\r\n      \r\n      // ‚úÖ Customer/Recipient info (always use generic field names)\r\n      name: params.customerName,\r\n      address: params.customerAddress,\r\n      province: params.customerProvince,\r\n      district: params.customerDistrict,\r\n      ward: params.customerWard,\r\n      street: params.customerStreet,\r\n      hamlet: params.customerHamlet || 'Kh√°c',\r\n      tel: params.customerTel,\r\n      \r\n      // Order info\r\n      id: params.orderId,\r\n      products: params.products.map(p => ({\r\n        name: p.name,\r\n        weight: p.weight, // ‚úÖ Already in GRAM from order-form-page\r\n        quantity: p.quantity,\r\n        product_code: p.productCode || 'DEFAULT',\r\n        price: p.price || 0, // ‚úÖ Add price\r\n      })),\r\n      total_weight: params.totalWeight, // ‚úÖ Already in GRAM\r\n      weight_option: 'gram', // ‚úÖ GHTK requires this\r\n      total_box: params.totalBox, // ‚úÖ Total number of boxes\r\n      value: params.value,\r\n      transport: params.transport || 'road',\r\n      pick_option: 'cod', // ‚úÖ GHTK requires this\r\n      note: params.note,\r\n      \r\n      // Payment\r\n      is_freeship: params.isFreeship === 1 || params.isFreeship === true ? 1 : 0, // ‚úÖ Force convert to 0 or 1\r\n      pick_money: params.pickMoney || 0,  // ‚úÖ ALWAYS use pickMoney for COD\r\n      \r\n      // ‚úÖ NEW: not_delivered_fee field for tag 19 (Kh√¥ng giao ƒë∆∞·ª£c thu ph√≠)\r\n      // According to GHTK docs: Must pass not_delivered_fee when using tag 19\r\n      // Range: 0 < not_delivered_fee <= 20,000,000\r\n      ...(params.tags?.includes(19) && params.failedDeliveryFee ? {\r\n        not_delivered_fee: params.failedDeliveryFee\r\n      } : {}),\r\n      \r\n      // ‚úÖ Dates & shifts\r\n      pick_date: params.pickDate, // YYYY-MM-DD format\r\n      deliver_date: params.deliverDate, // YYYY-MM-DD format\r\n      pick_work_shift: params.pickWorkShift, // 1=s√°ng, 2=chi·ªÅu\r\n      deliver_work_shift: params.deliverWorkShift, // 1=s√°ng, 2=chi·ªÅu\r\n      \r\n      // Tags\r\n      tags: params.tags,\r\n    };\r\n\r\n    console.log('üì§ [GHTKService] FINAL payload before sending to GHTK:', JSON.stringify(payload, null, 2));\r\n\r\n    const response = await fetch(`${GHTK_BASE_URL}/submit-order`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify(payload),\r\n    });\r\n\r\n    console.log('üì° [GHTKService] Response status:', response.status);\r\n    console.log('üì° [GHTKService] Response ok:', response.ok);\r\n\r\n    if (!response.ok) {\r\n      const errorData = await response.json().catch(() => ({}));\r\n      console.error('üì° [GHTKService] Error data:', errorData);\r\n      throw new Error(errorData.error || errorData.message || `GHTK API Error: ${response.status} ${response.statusText}`);\r\n    }\r\n\r\n    const data = await response.json();\r\n    console.log('üì° [GHTKService] Response data:', data);\r\n    \r\n    // ‚úÖ Handle GHTK error response (success: false)\r\n    if (!data.success) {\r\n      console.error('üì° [GHTKService] API returned error:', data.message);\r\n      throw new Error(data.message || 'GHTK API returned error');\r\n    }\r\n    \r\n    return data;\r\n  }\r\n\r\n  /**\r\n   * Ki·ªÉm tra tr·∫°ng th√°i ƒë∆°n h√†ng\r\n   */\r\n  async getOrderStatus(\r\n    trackingCode: string\r\n  ): Promise<GHTKOrderStatusResponse> {\r\n    const url = `${GHTK_BASE_URL}/services/shipment/v2/${trackingCode}`;\r\n\r\n    const response = await fetch(url, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Token': this.apiToken,\r\n        'X-Client-Source': this.partnerCode,\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`GHTK API Error: ${response.status} ${response.statusText}`);\r\n    }\r\n\r\n    return await response.json();\r\n  }\r\n\r\n  /**\r\n   * In nh√£n ƒë∆°n h√†ng (shipping label)\r\n   */\r\n  async printLabel(trackingCode: string): Promise<{ success: boolean; label?: string; message: string }> {\r\n    const url = `${GHTK_BASE_URL}/services/label/${trackingCode}`;\r\n\r\n    const response = await fetch(url, {\r\n      method: 'GET',\r\n      headers: {\r\n        'Token': this.apiToken,\r\n        'X-Client-Source': this.partnerCode,\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`GHTK API Error: ${response.status} ${response.statusText}`);\r\n    }\r\n\r\n    return await response.json();\r\n  }\r\n\r\n  /**\r\n   * H·ªßy ƒë∆°n h√†ng\r\n   */\r\n  async cancelOrder(trackingCode: string): Promise<{ success: boolean; message: string }> {\r\n    const url = `${GHTK_BASE_URL}/services/shipment/cancel/${trackingCode}`;\r\n\r\n    const response = await fetch(url, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Token': this.apiToken,\r\n        'X-Client-Source': this.partnerCode,\r\n      },\r\n    });\r\n\r\n    if (!response.ok) {\r\n      throw new Error(`GHTK API Error: ${response.status} ${response.statusText}`);\r\n    }\r\n\r\n    return await response.json();\r\n  }\r\n}\r\n\r\n/**\r\n * GHTK Status Code Mapping\r\n * https://api.ghtk.vn/docs/submit-order/webhook\r\n */\r\nexport const GHTK_STATUS_MAP: Record<string, { text: string; color: string }> = {\r\n  '-1': { text: 'H·ªßy ƒë∆°n h√†ng', color: 'destructive' },\r\n  '1': { text: 'Ch∆∞a ti·∫øp nh·∫≠n', color: 'secondary' },\r\n  '2': { text: 'ƒê√£ ti·∫øp nh·∫≠n', color: 'info' },\r\n  '3': { text: 'ƒê√£ l·∫•y h√†ng/ƒê√£ nh·∫≠p kho', color: 'warning' },\r\n  '4': { text: 'ƒê√£ ƒëi·ªÅu ph·ªëi giao h√†ng/ƒêang giao h√†ng', color: 'warning' },\r\n  '5': { text: 'ƒê√£ giao h√†ng/Ch∆∞a ƒë·ªëi so√°t', color: 'success' },\r\n  '6': { text: 'ƒê√£ ƒë·ªëi so√°t', color: 'success' },\r\n  '7': { text: 'Kh√¥ng l·∫•y ƒë∆∞·ª£c h√†ng', color: 'destructive' },\r\n  '8': { text: 'Ho√£n l·∫•y h√†ng', color: 'warning' },\r\n  '9': { text: 'Kh√¥ng giao ƒë∆∞·ª£c h√†ng', color: 'destructive' },\r\n  '10': { text: 'Delay giao h√†ng', color: 'warning' },\r\n  '11': { text: 'ƒê√£ ƒë·ªëi so√°t c√¥ng n·ª£ tr·∫£ h√†ng', color: 'secondary' },\r\n  '12': { text: 'ƒê√£ ƒëi·ªÅu ph·ªëi l·∫•y h√†ng/ƒêang l·∫•y h√†ng', color: 'warning' },\r\n  '13': { text: 'ƒê∆°n h√†ng b·ªìi ho√†n', color: 'destructive' },\r\n  '20': { text: 'ƒêang tr·∫£ h√†ng (COD c·∫ßm h√†ng ƒëi tr·∫£)', color: 'warning' },\r\n  '21': { text: 'ƒê√£ tr·∫£ h√†ng', color: 'secondary' },\r\n  '123': { text: 'Shipper b√°o ƒë√£ l·∫•y h√†ng', color: 'info' },\r\n  '127': { text: 'Shipper (nh√¢n vi√™n l·∫•y/giao h√†ng) b√°o kh√¥ng l·∫•y ƒë∆∞·ª£c h√†ng', color: 'destructive' },\r\n  '128': { text: 'Shipper b√°o delay l·∫•y h√†ng', color: 'warning' },\r\n  '45': { text: 'Shipper b√°o ƒë√£ giao h√†ng', color: 'success' },\r\n  '49': { text: 'Shipper b√°o kh√¥ng giao ƒë∆∞·ª£c giao h√†ng', color: 'destructive' },\r\n  '410': { text: 'Shipper b√°o delay giao h√†ng', color: 'warning' },\r\n};\r\n\r\n/**\r\n * GHTK Tags (Nh√£n ƒë∆°n h√†ng)\r\n */\r\nexport const GHTK_TAGS = {\r\n  FRAGILE: 1, // H√†ng d·ªÖ v·ª°\r\n  HIGH_VALUE: 2, // Gi√° tr·ªã cao (>3M)\r\n  BULKY: 3, // H√†ng c·ªìng k·ªÅnh\r\n  DOCUMENT: 4, // Ch·ª©ng t·ª´\r\n  FOOD: 5, // N√¥ng s·∫£n/Th·ª±c ph·∫©m\r\n  TRY_BEFORE_BUY: 10, // Cho xem h√†ng\r\n  CALL_SHOP: 13, // G·ªçi shop khi kh√°ch kh√¥ng nh·∫≠n\r\n  PARTIAL_DELIVERY_SELECT: 17, // Giao 1 ph·∫ßn ch·ªçn s·∫£n ph·∫©m\r\n  PARTIAL_DELIVERY_EXCHANGE: 18, // Giao 1 ph·∫ßn ƒë·ªïi tr·∫£\r\n  NO_DELIVERY_FEE: 19, // Kh√¥ng giao ƒë∆∞·ª£c thu ph√≠\r\n} as const;\r\n"],"names":[],"mappings":"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"}}]
}