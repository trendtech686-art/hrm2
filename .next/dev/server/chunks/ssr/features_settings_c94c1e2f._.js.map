{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/use-settings-page-header.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { usePathname } from 'next/navigation';\r\nimport { Settings2 } from 'lucide-react';\r\nimport { usePageHeader, type PageHeaderState, type PageHeaderDocLink } from '../../contexts/page-header-context';\r\nimport type { BreadcrumbItem } from '../../lib/breadcrumb-system';\r\n\r\nexport type SettingsPageHeaderOptions = Omit<PageHeaderState, 'title' | 'docLink'> & {\r\n  title: string;\r\n  icon?: React.ReactNode;\r\n  docLink?: string | PageHeaderDocLink;\r\n};\r\n\r\nconst defaultDocLabel = 'Xem hướng dẫn';\r\nconst baseBreadcrumb: BreadcrumbItem[] = [\r\n  { label: 'Trang chủ', href: '/', isCurrent: false },\r\n  { label: 'Cài đặt', href: '/settings', isCurrent: false },\r\n];\r\n\r\nconst normalizeLabel = (label?: string) => label?.trim().toLocaleLowerCase('vi');\r\nconst isHomeCrumb = (item: BreadcrumbItem) => item.href === '/' || normalizeLabel(item.label) === 'trang chủ';\r\nconst isSettingsCrumb = (item: BreadcrumbItem) => item.href === '/settings' || normalizeLabel(item.label) === 'cài đặt';\r\n\r\nexport function useSettingsPageHeader(options: SettingsPageHeaderOptions) {\r\n  const pathname = usePathname();\r\n  const { title, icon, docLink, breadcrumb, ...rest } = options;\r\n\r\n  const normalizedDocLink = React.useMemo<PageHeaderDocLink | undefined>(() => {\r\n    if (!docLink) return undefined;\r\n    if (typeof docLink === 'string') {\r\n      return { href: docLink, label: defaultDocLabel };\r\n    }\r\n    return {\r\n      href: docLink.href,\r\n      label: docLink.label ?? defaultDocLabel,\r\n    };\r\n  }, [docLink]);\r\n\r\n  const decoratedTitle = React.useMemo(() => (\r\n    <span className=\"inline-flex items-center gap-2\">\r\n      {(icon ?? <Settings2 className=\"h-5 w-5 text-muted-foreground\" aria-hidden=\"true\" />)}\r\n      <span>{title}</span>\r\n    </span>\r\n  ), [icon, title]);\r\n\r\n  const normalizedBreadcrumb = React.useMemo(() => {\r\n    const custom = (breadcrumb ?? []).map((item) => ({\r\n      ...item,\r\n      href: item.href || pathname,\r\n    }));\r\n\r\n    let merged: BreadcrumbItem[] = custom.length\r\n      ? [...custom]\r\n      : [{ label: title, href: pathname, isCurrent: true }];\r\n\r\n    if (!merged.some(isHomeCrumb)) {\r\n      merged = [{ ...baseBreadcrumb[0] }, ...merged];\r\n    }\r\n\r\n    if (!merged.some(isSettingsCrumb)) {\r\n      const homeIndex = merged.findIndex(isHomeCrumb);\r\n      const insertionIndex = homeIndex >= 0 ? homeIndex + 1 : 0;\r\n      merged = [\r\n        ...merged.slice(0, insertionIndex),\r\n        { ...baseBreadcrumb[1] },\r\n        ...merged.slice(insertionIndex),\r\n      ];\r\n    }\r\n\r\n    return merged.map((item, index) => ({\r\n      ...item,\r\n      isCurrent: index === merged.length - 1,\r\n    }));\r\n  }, [breadcrumb, pathname, title]);\r\n\r\n  return usePageHeader({\r\n    ...rest,\r\n    breadcrumb: normalizedBreadcrumb,\r\n    title: decoratedTitle,\r\n    docLink: normalizedDocLink,\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AACA;AACA;;;;;;AASA,MAAM,kBAAkB;AACxB,MAAM,iBAAmC;IACvC;QAAE,OAAO;QAAa,MAAM;QAAK,WAAW;IAAM;IAClD;QAAE,OAAO;QAAW,MAAM;QAAa,WAAW;IAAM;CACzD;AAED,MAAM,iBAAiB,CAAC,QAAmB,OAAO,OAAO,kBAAkB;AAC3E,MAAM,cAAc,CAAC,OAAyB,KAAK,IAAI,KAAK,OAAO,eAAe,KAAK,KAAK,MAAM;AAClG,MAAM,kBAAkB,CAAC,OAAyB,KAAK,IAAI,KAAK,eAAe,eAAe,KAAK,KAAK,MAAM;AAEvG,SAAS,sBAAsB,OAAkC;IACtE,MAAM,WAAW,IAAA,oMAAW;IAC5B,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,EAAE,UAAU,EAAE,GAAG,MAAM,GAAG;IAEtD,MAAM,oBAAoB,gNAAa,CAAgC;QACrE,IAAI,CAAC,SAAS,OAAO;QACrB,IAAI,OAAO,YAAY,UAAU;YAC/B,OAAO;gBAAE,MAAM;gBAAS,OAAO;YAAgB;QACjD;QACA,OAAO;YACL,MAAM,QAAQ,IAAI;YAClB,OAAO,QAAQ,KAAK,IAAI;QAC1B;IACF,GAAG;QAAC;KAAQ;IAEZ,MAAM,iBAAiB,gNAAa,CAAC,kBACnC,8OAAC;YAAK,WAAU;;gBACZ,sBAAQ,8OAAC,6NAAS;oBAAC,WAAU;oBAAgC,eAAY;;;;;;8BAC3E,8OAAC;8BAAM;;;;;;;;;;;kBAER;QAAC;QAAM;KAAM;IAEhB,MAAM,uBAAuB,gNAAa,CAAC;QACzC,MAAM,SAAS,CAAC,cAAc,EAAE,EAAE,GAAG,CAAC,CAAC,OAAS,CAAC;gBAC/C,GAAG,IAAI;gBACP,MAAM,KAAK,IAAI,IAAI;YACrB,CAAC;QAED,IAAI,SAA2B,OAAO,MAAM,GACxC;eAAI;SAAO,GACX;YAAC;gBAAE,OAAO;gBAAO,MAAM;gBAAU,WAAW;YAAK;SAAE;QAEvD,IAAI,CAAC,OAAO,IAAI,CAAC,cAAc;YAC7B,SAAS;gBAAC;oBAAE,GAAG,cAAc,CAAC,EAAE;gBAAC;mBAAM;aAAO;QAChD;QAEA,IAAI,CAAC,OAAO,IAAI,CAAC,kBAAkB;YACjC,MAAM,YAAY,OAAO,SAAS,CAAC;YACnC,MAAM,iBAAiB,aAAa,IAAI,YAAY,IAAI;YACxD,SAAS;mBACJ,OAAO,KAAK,CAAC,GAAG;gBACnB;oBAAE,GAAG,cAAc,CAAC,EAAE;gBAAC;mBACpB,OAAO,KAAK,CAAC;aACjB;QACH;QAEA,OAAO,OAAO,GAAG,CAAC,CAAC,MAAM,QAAU,CAAC;gBAClC,GAAG,IAAI;gBACP,WAAW,UAAU,OAAO,MAAM,GAAG;YACvC,CAAC;IACH,GAAG;QAAC;QAAY;QAAU;KAAM;IAEhC,OAAO,IAAA,uJAAa,EAAC;QACnB,GAAG,IAAI;QACP,YAAY;QACZ,OAAO;QACP,SAAS;IACX;AACF"}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/types.ts"],"sourcesContent":["import type { SystemId } from '@/lib/id-types';\r\n\r\n// ========================================\r\n// PKGX Reference Data Types\r\n// ========================================\r\n\r\n/**\r\n * Danh mục PKGX (cat_id từ ECShop)\r\n */\r\nexport type PkgxCategory = {\r\n  id: number;         // cat_id trên PKGX\r\n  name: string;       // Tên danh mục\r\n  parentId?: number;  // Parent category (nếu có)\r\n  sortOrder?: number; // Thứ tự sắp xếp\r\n  isShow?: number;    // Hiển thị (1=hiện, 0=ẩn)\r\n  // SEO fields\r\n  cat_desc?: string;      // Mô tả danh mục ngắn\r\n  long_desc?: string;     // Mô tả danh mục dài (HTML)\r\n  keywords?: string;      // SEO keywords\r\n  meta_title?: string;    // Meta title\r\n  meta_desc?: string;     // Meta description\r\n  cat_alias?: string;     // Slug/alias\r\n  style?: string;         // Template style\r\n  grade?: number;         // Cấp độ danh mục\r\n  filter_attr?: string;   // Filter attributes\r\n};\r\n\r\n/**\r\n * Thương hiệu PKGX (brand_id từ ECShop)\r\n */\r\nexport type PkgxBrand = {\r\n  id: number;           // brand_id trên PKGX\r\n  name: string;         // Tên thương hiệu\r\n  // Basic fields\r\n  logo?: string;          // Logo URL\r\n  description?: string;   // Mô tả thương hiệu (brand_desc)\r\n  siteUrl?: string;       // Website URL\r\n  sortOrder?: number;     // Thứ tự sắp xếp\r\n  isShow?: number;        // Hiển thị (1=hiện, 0=ẩn)\r\n  // SEO fields\r\n  keywords?: string;      // Keywords\r\n  metaTitle?: string;     // Meta title\r\n  metaDesc?: string;      // Meta description\r\n  // Description fields\r\n  shortDescription?: string;  // Mô tả ngắn (short_desc)\r\n  longDescription?: string;   // Mô tả dài (long_desc)\r\n  // Legacy fields (backward compatibility)\r\n  brand_logo?: string;    // Logo URL (legacy)\r\n  brand_desc?: string;    // Mô tả thương hiệu (HTML) (legacy)\r\n  site_url?: string;      // Website URL (legacy)\r\n  sort_order?: number;    // Thứ tự sắp xếp (legacy)\r\n};\r\n\r\n/**\r\n * Ảnh trong gallery sản phẩm PKGX\r\n */\r\nexport type PkgxGalleryImage = {\r\n  img_id: number;           // ID ảnh trong gallery\r\n  goods_id: number;         // ID sản phẩm\r\n  img_url: string;          // Đường dẫn ảnh gốc\r\n  thumb_url: string;        // Đường dẫn thumbnail\r\n  img_desc?: string;        // Mô tả ảnh\r\n  img_original?: string;    // Ảnh gốc (nếu có)\r\n};\r\n\r\n// ========================================\r\n// Mapping Types\r\n// ========================================\r\n\r\n/**\r\n * Mapping danh mục HRM → PKGX\r\n */\r\nexport type PkgxCategoryMapping = {\r\n  id: string;                     // Unique mapping ID\r\n  hrmCategorySystemId: SystemId;  // Category systemId trong HRM\r\n  hrmCategoryName: string;        // Tên hiển thị HRM\r\n  pkgxCatId: number;              // cat_id trên PKGX\r\n  pkgxCatName: string;            // Tên danh mục PKGX\r\n};\r\n\r\n/**\r\n * Mapping thương hiệu HRM → PKGX\r\n */\r\nexport type PkgxBrandMapping = {\r\n  id: string;                     // Unique mapping ID\r\n  hrmBrandSystemId: SystemId;     // Brand systemId trong HRM\r\n  hrmBrandName: string;           // Tên hiển thị HRM\r\n  pkgxBrandId: number;            // brand_id trên PKGX\r\n  pkgxBrandName: string;          // Tên thương hiệu PKGX\r\n};\r\n\r\n/**\r\n * Mapping bảng giá HRM → các loại giá PKGX\r\n */\r\nexport type PkgxPriceMapping = {\r\n  shopPrice: SystemId | null;     // Bảng giá → shop_price (giá bán)\r\n  marketPrice: SystemId | null;   // Bảng giá → market_price (giá thị trường)\r\n  partnerPrice: SystemId | null;  // Bảng giá → partner_price (giá đối tác)\r\n  acePrice: SystemId | null;      // Bảng giá → ace_price\r\n  dealPrice: SystemId | null;     // Bảng giá → deal_price\r\n};\r\n\r\n// ========================================\r\n// Sync Settings Types\r\n// ========================================\r\n\r\n/**\r\n * Cài đặt đồng bộ tự động\r\n */\r\nexport type PkgxSyncSettings = {\r\n  autoSyncEnabled: boolean;       // Bật/tắt auto sync\r\n  intervalMinutes: number;        // Tần suất (15, 30, 60, 120, 240)\r\n  syncInventory: boolean;         // Đồng bộ tồn kho\r\n  syncPrice: boolean;             // Đồng bộ giá\r\n  syncSeo: boolean;               // Đồng bộ SEO (meta_title, meta_desc, keywords)\r\n  syncOnProductUpdate: boolean;   // Sync ngay khi update SP trong HRM\r\n  notifyOnError: boolean;         // Thông báo khi có lỗi\r\n};\r\n\r\n/**\r\n * Log đồng bộ PKGX - Ghi lại TẤT CẢ các API call\r\n */\r\nexport type PkgxSyncLog = {\r\n  id: string;                     // Unique log ID\r\n  timestamp: string;              // ISO timestamp\r\n  action: \r\n    | 'test_connection'           // Test kết nối API\r\n    | 'ping'                      // Ping server\r\n    | 'sync_all'                  // Đồng bộ toàn bộ\r\n    | 'sync_price'                // Đồng bộ giá\r\n    | 'sync_inventory'            // Đồng bộ tồn kho\r\n    | 'sync_seo'                  // Đồng bộ SEO\r\n    | 'sync_description'          // Đồng bộ mô tả\r\n    | 'sync_flags'                // Đồng bộ flags (isHot, isNew, etc.)\r\n    | 'sync_basic'                // Đồng bộ thông tin cơ bản (alias)\r\n    | 'sync_basic_info'           // Đồng bộ thông tin cơ bản\r\n    | 'sync_images'               // Đồng bộ ảnh sản phẩm\r\n    | 'create_product'            // Tạo sản phẩm mới trên PKGX\r\n    | 'update_product'            // Cập nhật sản phẩm\r\n    | 'link_product'              // Liên kết SP HRM với PKGX\r\n    | 'unlink_product'            // Hủy liên kết SP\r\n    | 'unlink_mapping'            // Hủy liên kết mapping (category/brand)\r\n    | 'batch_unlink'              // Hủy liên kết hàng loạt\r\n    | 'bulk_sync_all'             // Bulk: Đồng bộ toàn bộ\r\n    | 'bulk_sync_basic'           // Bulk: Đồng bộ thông tin cơ bản\r\n    | 'bulk_sync_price'           // Bulk: Đồng bộ giá\r\n    | 'bulk_sync_inventory'       // Bulk: Đồng bộ tồn kho\r\n    | 'bulk_sync_seo'             // Bulk: Đồng bộ SEO\r\n    | 'bulk_sync_description'     // Bulk: Đồng bộ mô tả\r\n    | 'bulk_sync_flags'           // Bulk: Đồng bộ flags\r\n    | 'bulk_sync_images'          // Bulk: Đồng bộ ảnh\r\n    | 'sync_categories'           // Đồng bộ danh mục\r\n    | 'sync_brands'               // Đồng bộ thương hiệu\r\n    | 'get_products'              // Lấy danh sách SP từ PKGX\r\n    | 'upload_image'              // Upload ảnh sản phẩm\r\n    | 'save_config'               // Lưu cấu hình\r\n    | 'save_mapping';             // Lưu mapping\r\n  status: 'success' | 'error' | 'partial' | 'info';\r\n  message: string;                // Log message\r\n  // User info - Ai thực hiện action\r\n  userId?: string;                // User systemId hoặc 'SYSTEM'\r\n  userName?: string;              // Tên người dùng\r\n  details?: {\r\n    // Request info\r\n    url?: string;\r\n    method?: string;\r\n    // Response info\r\n    responseTime?: number;        // ms\r\n    httpStatus?: number;\r\n    // Data info\r\n    total?: number;\r\n    success?: number;\r\n    failed?: number;\r\n    productId?: string;\r\n    productName?: string;\r\n    pkgxId?: number;\r\n    inventory?: number;\r\n    categoryId?: number;\r\n    brandId?: number;\r\n    // Error info\r\n    error?: string;\r\n    errorCode?: string;\r\n  };\r\n};\r\n\r\n/**\r\n * Kết quả sync gần nhất\r\n */\r\nexport type PkgxSyncResult = {\r\n  status: 'success' | 'partial' | 'error';\r\n  total: number;\r\n  success: number;\r\n  failed: number;\r\n  errors?: string[];\r\n};\r\n\r\n// ========================================\r\n// Main PKGX Settings Type\r\n// ========================================\r\n\r\n/**\r\n * Toàn bộ cài đặt PKGX\r\n */\r\nexport type PkgxSettings = {\r\n  // === General Config ===\r\n  apiUrl: string;\r\n  apiKey: string;\r\n  enabled: boolean;                // Bật/tắt tích hợp PKGX\r\n  \r\n  // === Reference Data ===\r\n  categories: PkgxCategory[];\r\n  brands: PkgxBrand[];\r\n  \r\n  // === Mappings ===\r\n  priceMapping: PkgxPriceMapping;\r\n  categoryMappings: PkgxCategoryMapping[];\r\n  brandMappings: PkgxBrandMapping[];\r\n  \r\n  // === Sync Settings ===\r\n  syncSettings: PkgxSyncSettings;\r\n  \r\n  // === Status ===\r\n  lastSyncAt?: string;\r\n  lastSyncResult?: PkgxSyncResult;\r\n  connectionStatus?: 'connected' | 'disconnected' | 'error';\r\n  connectionError?: string;\r\n  \r\n  // === Logs ===\r\n  logs: PkgxSyncLog[];\r\n  \r\n  // === Cached PKGX Products ===\r\n  pkgxProducts: PkgxProduct[];     // Sản phẩm từ PKGX - lưu cache để không mất khi chuyển tab\r\n  pkgxProductsLastFetch?: string;  // Thời gian fetch gần nhất\r\n};\r\n\r\n// ========================================\r\n// PKGX Product Response Types (từ API)\r\n// ========================================\r\n\r\n/**\r\n * Sản phẩm trả về từ PKGX API\r\n * \r\n * Lưu ý quan trọng:\r\n * - goods_id: Primary Key, dùng để update/link sản phẩm qua API\r\n * - goods_sn: Mã SKU của sản phẩm, có thể sync với HRM.sku\r\n */\r\nexport type PkgxProduct = {\r\n  goods_id: number;      // PRIMARY KEY - Dùng để update sản phẩm qua API\r\n  goods_name: string;\r\n  goods_sn: string;      // Mã SKU - map với HRM Product.sku\r\n  cat_id: number;\r\n  brand_id: number;\r\n  shop_price: number;\r\n  market_price: number;\r\n  partner_price: number;\r\n  ace_price?: number;\r\n  deal_price?: number;\r\n  goods_number: number;\r\n  goods_desc: string;\r\n  keywords: string;\r\n  goods_brief: string;\r\n  meta_title: string;\r\n  meta_desc: string;\r\n  goods_img: string;\r\n  goods_thumb: string;\r\n  original_img: string;\r\n  is_on_sale: number;\r\n  is_best: number;\r\n  is_hot: number;\r\n  is_new: number;\r\n  is_home: number;\r\n  slug: string;\r\n  seller_note?: string;\r\n  add_time?: number;\r\n  last_update?: number;\r\n};\r\n\r\n/**\r\n * Response phân trang từ get_products\r\n */\r\nexport type PkgxProductsResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  pagination: {\r\n    total_items: number;\r\n    total_pages: number;\r\n    current_page: number;\r\n    per_page: number;\r\n  };\r\n  data: PkgxProduct[];\r\n};\r\n\r\n/**\r\n * Response upload ảnh\r\n */\r\nexport type PkgxImageUploadResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  data: {\r\n    original_img: string;\r\n    goods_img: string;\r\n    goods_thumb: string;\r\n    full_urls: {\r\n      original: string;\r\n      goods: string;\r\n      thumb: string;\r\n    };\r\n  };\r\n  goods_id?: number;\r\n  product_updated?: boolean;\r\n};\r\n\r\n/**\r\n * Response lấy danh sách danh mục từ PKGX API\r\n */\r\nexport type PkgxCategoryFromApi = {\r\n  cat_id: number;\r\n  cat_name: string;\r\n  parent_id: number;\r\n  sort_order: number;\r\n  is_show?: number; // 0 or 1\r\n  // SEO fields\r\n  cat_desc?: string;\r\n  long_desc?: string;\r\n  keywords?: string;\r\n  meta_title?: string;\r\n  meta_desc?: string;\r\n  cat_alias?: string;\r\n  style?: string;\r\n  grade?: number;\r\n  filter_attr?: string;\r\n};\r\n\r\nexport type PkgxCategoriesResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  total: number;\r\n  data: PkgxCategoryFromApi[];\r\n};\r\n\r\n/**\r\n * Response lấy danh sách thương hiệu từ PKGX API\r\n */\r\nexport type PkgxBrandFromApi = {\r\n  brand_id: number;\r\n  brand_name: string;\r\n  brand_logo?: string;\r\n  brand_desc?: string;\r\n  short_desc?: string;\r\n  long_desc?: string;\r\n  keywords?: string;\r\n  meta_title?: string;\r\n  meta_desc?: string;\r\n  site_url?: string;\r\n  sort_order: number;\r\n  is_show?: number; // 0 or 1\r\n};\r\n\r\nexport type PkgxBrandsResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  total: number;\r\n  data: PkgxBrandFromApi[];\r\n};\r\n\r\n/**\r\n * Response lấy gallery ảnh sản phẩm từ PKGX API\r\n */\r\nexport type PkgxGalleryResponse = {\r\n  error: boolean;\r\n  message: string;\r\n  goods_id: number;\r\n  total: number;\r\n  data: PkgxGalleryImage[];\r\n};\r\n\r\n/**\r\n * Payload tạo/cập nhật sản phẩm\r\n */\r\nexport type PkgxProductPayload = {\r\n  goods_name?: string;\r\n  goods_sn?: string;\r\n  cat_id?: number;\r\n  brand_id?: number;\r\n  shop_price?: number;\r\n  market_price?: number;\r\n  partner_price?: number;\r\n  ace_price?: number;\r\n  deal_price?: number;\r\n  goods_number?: number;\r\n  goods_desc?: string;\r\n  keywords?: string;\r\n  goods_brief?: string;\r\n  meta_title?: string;\r\n  meta_desc?: string;\r\n  original_img?: string;\r\n  gallery_images?: string[];  // Album ảnh sản phẩm\r\n  best?: boolean;\r\n  hot?: boolean;\r\n  new?: boolean;\r\n  ishome?: boolean;\r\n  is_on_sale?: boolean;  // Hiển thị đăng web (on/off trên website PKGX)\r\n  seller_note?: string;\r\n};\r\n\r\n// ========================================\r\n// UI State Types\r\n// ========================================\r\n\r\nexport type PkgxSettingsTab = \r\n  | 'general'\r\n  | 'categories'\r\n  | 'brands'\r\n  | 'category-mapping'\r\n  | 'brand-mapping'\r\n  | 'price-mapping'\r\n  | 'product-mapping'\r\n  | 'sync';\r\n\r\nexport type ConnectionTestResult = {\r\n  success: boolean;\r\n  message: string;\r\n  productCount?: number;\r\n};\r\n\r\n// ========================================\r\n// Default Values\r\n// ========================================\r\n\r\nexport const DEFAULT_PKGX_SETTINGS: PkgxSettings = {\r\n  apiUrl: 'https://phukiengiaxuong.com.vn/admin/api_product_pro.php',\r\n  apiKey: '',\r\n  enabled: false,\r\n  \r\n  categories: [],\r\n  brands: [],\r\n  \r\n  priceMapping: {\r\n    shopPrice: null,\r\n    marketPrice: null,\r\n    partnerPrice: null,\r\n    acePrice: null,\r\n    dealPrice: null,\r\n  },\r\n  categoryMappings: [],\r\n  brandMappings: [],\r\n  \r\n  syncSettings: {\r\n    autoSyncEnabled: false,\r\n    intervalMinutes: 30,\r\n    syncInventory: true,\r\n    syncPrice: true,\r\n    syncSeo: false,\r\n    syncOnProductUpdate: true,\r\n    notifyOnError: true,\r\n  },\r\n  \r\n  logs: [],\r\n  \r\n  // Cached PKGX Products\r\n  pkgxProducts: [],\r\n  pkgxProductsLastFetch: undefined,\r\n};\r\n\r\nexport const SYNC_INTERVAL_OPTIONS = [\r\n  { value: 15, label: '15 phút' },\r\n  { value: 30, label: '30 phút' },\r\n  { value: 60, label: '1 giờ' },\r\n  { value: 120, label: '2 giờ' },\r\n  { value: 240, label: '4 giờ' },\r\n];\r\n"],"names":[],"mappings":";;;;;;AA6aO,MAAM,wBAAsC;IACjD,QAAQ;IACR,QAAQ;IACR,SAAS;IAET,YAAY,EAAE;IACd,QAAQ,EAAE;IAEV,cAAc;QACZ,WAAW;QACX,aAAa;QACb,cAAc;QACd,UAAU;QACV,WAAW;IACb;IACA,kBAAkB,EAAE;IACpB,eAAe,EAAE;IAEjB,cAAc;QACZ,iBAAiB;QACjB,iBAAiB;QACjB,eAAe;QACf,WAAW;QACX,SAAS;QACT,qBAAqB;QACrB,eAAe;IACjB;IAEA,MAAM,EAAE;IAER,uBAAuB;IACvB,cAAc,EAAE;IAChB,uBAAuB;AACzB;AAEO,MAAM,wBAAwB;IACnC;QAAE,OAAO;QAAI,OAAO;IAAU;IAC9B;QAAE,OAAO;QAAI,OAAO;IAAU;IAC9B;QAAE,OAAO;QAAI,OAAO;IAAQ;IAC5B;QAAE,OAAO;QAAK,OAAO;IAAQ;IAC7B;QAAE,OAAO;QAAK,OAAO;IAAQ;CAC9B"}},
    {"offset": {"line": 194, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/constants.ts"],"sourcesContent":["import type { PkgxCategory, PkgxBrand } from './types';\r\n\r\n/**\r\n * Danh sách danh mục PKGX (cat_id từ ECShop)\r\n * Nguồn: idpkgx.xlsx\r\n */\r\nexport const PKGX_CATEGORIES: PkgxCategory[] = [\r\n  // === Danh mục chính - Hàng theo loại ===\r\n  { id: 382, name: 'Sản phẩm mới' },\r\n  { id: 302, name: 'Hàng Theo Loại Bán' },\r\n  { id: 413, name: 'Hàng Hot Trend' },\r\n  { id: 390, name: 'Hàng Bán Chạy' },\r\n  { id: 389, name: 'Hàng Thanh Lý' },\r\n  { id: 387, name: 'Hàng Độc Quyền' },\r\n  { id: 391, name: 'Hàng bán Sàn TMĐT' },\r\n  { id: 388, name: 'Hàng Tặng Kèm' },\r\n  { id: 386, name: 'Hàng Chợ' },\r\n  \r\n  // === Tai nghe ===\r\n  { id: 37, name: 'Sỉ tai nghe' },\r\n  { id: 315, name: 'Tai nghe Bluetooth TWS' },\r\n  { id: 314, name: 'Tai nghe có dây' },\r\n  { id: 316, name: 'Tai nghe chụp tai bluetooth' },\r\n  { id: 375, name: 'Tai nghe bluetooth 1 bên' },\r\n  { id: 376, name: 'Tai nghe bluetooth thể thao' },\r\n  { id: 377, name: 'Tai nghe chụp tai Gaming' },\r\n  { id: 384, name: 'Case Tai Nghe Bluetooth' },\r\n  \r\n  // === Cáp sạc ===\r\n  { id: 38, name: 'Sỉ cáp sạc' },\r\n  { id: 317, name: 'Cáp sạc Type-C' },\r\n  { id: 318, name: 'Cáp sạc Lightning' },\r\n  { id: 319, name: 'Cáp sạc Micro USB' },\r\n  { id: 320, name: 'Cáp sạc đa năng' },\r\n  { id: 378, name: 'Cáp sạc nhanh' },\r\n  \r\n  // === Củ sạc ===\r\n  { id: 39, name: 'Sỉ củ sạc' },\r\n  { id: 321, name: 'Củ sạc nhanh' },\r\n  { id: 322, name: 'Củ sạc thường' },\r\n  { id: 323, name: 'Củ sạc không dây' },\r\n  { id: 379, name: 'Củ sạc Magsafe' },\r\n  \r\n  // === Sạc dự phòng ===\r\n  { id: 40, name: 'Sỉ sạc dự phòng' },\r\n  { id: 324, name: 'Sạc dự phòng 10000mAh' },\r\n  { id: 325, name: 'Sạc dự phòng 20000mAh' },\r\n  { id: 326, name: 'Sạc dự phòng 30000mAh+' },\r\n  { id: 380, name: 'Sạc dự phòng mini' },\r\n  \r\n  // === Loa ===\r\n  { id: 41, name: 'Sỉ loa bluetooth' },\r\n  { id: 327, name: 'Loa bluetooth mini' },\r\n  { id: 328, name: 'Loa bluetooth karaoke' },\r\n  { id: 329, name: 'Loa bluetooth chống nước' },\r\n  { id: 381, name: 'Loa kéo' },\r\n  \r\n  // === Phụ kiện điện thoại ===\r\n  { id: 42, name: 'Phụ kiện điện thoại' },\r\n  { id: 330, name: 'Ốp lưng điện thoại' },\r\n  { id: 331, name: 'Kính cường lực' },\r\n  { id: 332, name: 'Giá đỡ điện thoại' },\r\n  { id: 333, name: 'Gậy selfie/tripod' },\r\n  { id: 383, name: 'Ring holder' },\r\n  \r\n  // === Phụ kiện máy tính ===\r\n  { id: 43, name: 'Phụ kiện máy tính' },\r\n  { id: 334, name: 'Chuột máy tính' },\r\n  { id: 335, name: 'Bàn phím' },\r\n  { id: 336, name: 'Hub USB' },\r\n  { id: 337, name: 'Webcam' },\r\n  \r\n  // === Đồng hồ thông minh ===\r\n  { id: 44, name: 'Sỉ đồng hồ thông minh' },\r\n  { id: 338, name: 'Smartwatch' },\r\n  { id: 339, name: 'Smartband' },\r\n  { id: 340, name: 'Dây đeo smartwatch' },\r\n  \r\n  // === Gaming ===\r\n  { id: 45, name: 'Phụ kiện gaming' },\r\n  { id: 341, name: 'Tay cầm chơi game' },\r\n  { id: 342, name: 'Quạt tản nhiệt điện thoại' },\r\n  { id: 343, name: 'Nút bấm chơi game' },\r\n  \r\n  // === Ô tô ===\r\n  { id: 46, name: 'Phụ kiện ô tô' },\r\n  { id: 344, name: 'Sạc xe hơi' },\r\n  { id: 345, name: 'Giá đỡ điện thoại xe hơi' },\r\n  { id: 346, name: 'Camera hành trình' },\r\n  \r\n  // === Gia dụng ===\r\n  { id: 47, name: 'Đồ gia dụng' },\r\n  { id: 347, name: 'Đèn LED' },\r\n  { id: 348, name: 'Quạt mini' },\r\n  { id: 349, name: 'Cân điện tử' },\r\n];\r\n\r\n/**\r\n * Danh sách thương hiệu PKGX (brand_id từ ECShop)\r\n * Nguồn: idpkgx.xlsx\r\n */\r\nexport const PKGX_BRANDS: PkgxBrand[] = [\r\n  // === Thương hiệu chính ===\r\n  { id: 15, name: 'Hoco' },\r\n  { id: 141, name: 'Borofone' },\r\n  { id: 138, name: 'Baseus' },\r\n  { id: 12, name: 'Wekome' },\r\n  { id: 157, name: 'Maxitech' },\r\n  \r\n  // === Thương hiệu phụ ===\r\n  { id: 10, name: 'Anker' },\r\n  { id: 11, name: 'Xiaomi' },\r\n  { id: 13, name: 'Samsung' },\r\n  { id: 14, name: 'Apple' },\r\n  { id: 16, name: 'Remax' },\r\n  { id: 17, name: 'Ugreen' },\r\n  { id: 18, name: 'Vivan' },\r\n  { id: 19, name: 'Energizer' },\r\n  { id: 20, name: 'Sony' },\r\n  { id: 21, name: 'JBL' },\r\n  { id: 22, name: 'Logitech' },\r\n  { id: 23, name: 'Rapoo' },\r\n  { id: 24, name: 'Orico' },\r\n  { id: 25, name: 'Havit' },\r\n  { id: 26, name: 'Edifier' },\r\n  { id: 27, name: 'Aukey' },\r\n  { id: 28, name: 'Belkin' },\r\n  { id: 29, name: 'Mophie' },\r\n  { id: 30, name: 'Spigen' },\r\n  { id: 31, name: 'Nillkin' },\r\n  { id: 32, name: 'ESR' },\r\n  { id: 33, name: 'Mazer' },\r\n  { id: 34, name: 'Hyphen' },\r\n  { id: 35, name: 'WiWU' },\r\n  { id: 36, name: 'Pisen' },\r\n  { id: 37, name: 'Yoobao' },\r\n  { id: 38, name: 'iWalk' },\r\n  { id: 39, name: 'Romoss' },\r\n  { id: 40, name: 'Tronsmart' },\r\n  { id: 41, name: 'QCY' },\r\n  { id: 42, name: 'Lenovo' },\r\n  { id: 43, name: 'Huawei' },\r\n  { id: 44, name: 'Oppo' },\r\n  { id: 45, name: 'Vivo' },\r\n  { id: 46, name: 'Realme' },\r\n  { id: 47, name: 'Nothing' },\r\n  { id: 100, name: 'Không thương hiệu' },\r\n  { id: 101, name: 'OEM' },\r\n  { id: 102, name: 'Noname' },\r\n];\r\n\r\n/**\r\n * API Configuration\r\n */\r\nexport const PKGX_API_CONFIG = {\r\n  baseUrl: 'https://phukiengiaxuong.com.vn/admin/api_product_hrm.php',\r\n  cdnUrl: 'https://phukiengiaxuong.com.vn/cdn/',\r\n  defaultApiKey: 'a91f2c47e5d8b6f03a7c4e9d12f0b8a6',\r\n  \r\n  // Rate limiting\r\n  maxRequestsPerMinute: 60,\r\n  requestTimeout: 30000, // 30 seconds\r\n  \r\n  // Pagination\r\n  defaultPageSize: 50,\r\n  maxPageSize: 100,\r\n};\r\n\r\n/**\r\n * Field mapping reference\r\n */\r\nexport const FIELD_MAPPING_REFERENCE = {\r\n  // HRM Field → PKGX Field\r\n  'pkgxId': 'goods_id',\r\n  'id': 'goods_sn',\r\n  'name': 'goods_name',\r\n  'categorySystemId': 'cat_id',\r\n  'brandSystemId': 'brand_id',\r\n  'description': 'goods_desc',\r\n  'shortDescription': 'goods_brief',\r\n  'ktitle': 'meta_title',\r\n  'seoDescription': 'meta_desc',\r\n  'tags': 'keywords',\r\n  'thumbnailImage': 'original_img',\r\n  'isFeatured': 'is_best',\r\n  'isNewArrival': 'is_new',\r\n  'isPublished': 'is_on_sale',\r\n  'slug': 'slug',\r\n} as const;\r\n\r\n/**\r\n * PKGX Price field descriptions\r\n */\r\nexport const PKGX_PRICE_FIELDS = [\r\n  { key: 'shopPrice', field: 'shop_price', label: 'Giá bán (shop_price)', description: 'Giá bán chính trên website' },\r\n  { key: 'marketPrice', field: 'market_price', label: 'Giá thị trường (market_price)', description: 'Giá niêm yết / giá gốc' },\r\n  { key: 'partnerPrice', field: 'partner_price', label: 'Giá đối tác (partner_price)', description: 'Giá dành cho đối tác' },\r\n  { key: 'acePrice', field: 'ace_price', label: 'Giá ACE (ace_price)', description: 'Giá đặc biệt ACE' },\r\n  { key: 'dealPrice', field: 'deal_price', label: 'Giá deal (deal_price)', description: 'Giá khuyến mãi' },\r\n] as const;\r\n"],"names":[],"mappings":";;;;;;;;;;;;AAMO,MAAM,kBAAkC;IAC7C,0CAA0C;IAC1C;QAAE,IAAI;QAAK,MAAM;IAAe;IAChC;QAAE,IAAI;QAAK,MAAM;IAAqB;IACtC;QAAE,IAAI;QAAK,MAAM;IAAiB;IAClC;QAAE,IAAI;QAAK,MAAM;IAAgB;IACjC;QAAE,IAAI;QAAK,MAAM;IAAgB;IACjC;QAAE,IAAI;QAAK,MAAM;IAAiB;IAClC;QAAE,IAAI;QAAK,MAAM;IAAoB;IACrC;QAAE,IAAI;QAAK,MAAM;IAAgB;IACjC;QAAE,IAAI;QAAK,MAAM;IAAW;IAE5B,mBAAmB;IACnB;QAAE,IAAI;QAAI,MAAM;IAAc;IAC9B;QAAE,IAAI;QAAK,MAAM;IAAyB;IAC1C;QAAE,IAAI;QAAK,MAAM;IAAkB;IACnC;QAAE,IAAI;QAAK,MAAM;IAA8B;IAC/C;QAAE,IAAI;QAAK,MAAM;IAA2B;IAC5C;QAAE,IAAI;QAAK,MAAM;IAA8B;IAC/C;QAAE,IAAI;QAAK,MAAM;IAA2B;IAC5C;QAAE,IAAI;QAAK,MAAM;IAA0B;IAE3C,kBAAkB;IAClB;QAAE,IAAI;QAAI,MAAM;IAAa;IAC7B;QAAE,IAAI;QAAK,MAAM;IAAiB;IAClC;QAAE,IAAI;QAAK,MAAM;IAAoB;IACrC;QAAE,IAAI;QAAK,MAAM;IAAoB;IACrC;QAAE,IAAI;QAAK,MAAM;IAAkB;IACnC;QAAE,IAAI;QAAK,MAAM;IAAgB;IAEjC,iBAAiB;IACjB;QAAE,IAAI;QAAI,MAAM;IAAY;IAC5B;QAAE,IAAI;QAAK,MAAM;IAAe;IAChC;QAAE,IAAI;QAAK,MAAM;IAAgB;IACjC;QAAE,IAAI;QAAK,MAAM;IAAmB;IACpC;QAAE,IAAI;QAAK,MAAM;IAAiB;IAElC,uBAAuB;IACvB;QAAE,IAAI;QAAI,MAAM;IAAkB;IAClC;QAAE,IAAI;QAAK,MAAM;IAAwB;IACzC;QAAE,IAAI;QAAK,MAAM;IAAwB;IACzC;QAAE,IAAI;QAAK,MAAM;IAAyB;IAC1C;QAAE,IAAI;QAAK,MAAM;IAAoB;IAErC,cAAc;IACd;QAAE,IAAI;QAAI,MAAM;IAAmB;IACnC;QAAE,IAAI;QAAK,MAAM;IAAqB;IACtC;QAAE,IAAI;QAAK,MAAM;IAAwB;IACzC;QAAE,IAAI;QAAK,MAAM;IAA2B;IAC5C;QAAE,IAAI;QAAK,MAAM;IAAU;IAE3B,8BAA8B;IAC9B;QAAE,IAAI;QAAI,MAAM;IAAsB;IACtC;QAAE,IAAI;QAAK,MAAM;IAAqB;IACtC;QAAE,IAAI;QAAK,MAAM;IAAiB;IAClC;QAAE,IAAI;QAAK,MAAM;IAAoB;IACrC;QAAE,IAAI;QAAK,MAAM;IAAoB;IACrC;QAAE,IAAI;QAAK,MAAM;IAAc;IAE/B,4BAA4B;IAC5B;QAAE,IAAI;QAAI,MAAM;IAAoB;IACpC;QAAE,IAAI;QAAK,MAAM;IAAiB;IAClC;QAAE,IAAI;QAAK,MAAM;IAAW;IAC5B;QAAE,IAAI;QAAK,MAAM;IAAU;IAC3B;QAAE,IAAI;QAAK,MAAM;IAAS;IAE1B,6BAA6B;IAC7B;QAAE,IAAI;QAAI,MAAM;IAAwB;IACxC;QAAE,IAAI;QAAK,MAAM;IAAa;IAC9B;QAAE,IAAI;QAAK,MAAM;IAAY;IAC7B;QAAE,IAAI;QAAK,MAAM;IAAqB;IAEtC,iBAAiB;IACjB;QAAE,IAAI;QAAI,MAAM;IAAkB;IAClC;QAAE,IAAI;QAAK,MAAM;IAAoB;IACrC;QAAE,IAAI;QAAK,MAAM;IAA4B;IAC7C;QAAE,IAAI;QAAK,MAAM;IAAoB;IAErC,eAAe;IACf;QAAE,IAAI;QAAI,MAAM;IAAgB;IAChC;QAAE,IAAI;QAAK,MAAM;IAAa;IAC9B;QAAE,IAAI;QAAK,MAAM;IAA2B;IAC5C;QAAE,IAAI;QAAK,MAAM;IAAoB;IAErC,mBAAmB;IACnB;QAAE,IAAI;QAAI,MAAM;IAAc;IAC9B;QAAE,IAAI;QAAK,MAAM;IAAU;IAC3B;QAAE,IAAI;QAAK,MAAM;IAAY;IAC7B;QAAE,IAAI;QAAK,MAAM;IAAc;CAChC;AAMM,MAAM,cAA2B;IACtC,4BAA4B;IAC5B;QAAE,IAAI;QAAI,MAAM;IAAO;IACvB;QAAE,IAAI;QAAK,MAAM;IAAW;IAC5B;QAAE,IAAI;QAAK,MAAM;IAAS;IAC1B;QAAE,IAAI;QAAI,MAAM;IAAS;IACzB;QAAE,IAAI;QAAK,MAAM;IAAW;IAE5B,0BAA0B;IAC1B;QAAE,IAAI;QAAI,MAAM;IAAQ;IACxB;QAAE,IAAI;QAAI,MAAM;IAAS;IACzB;QAAE,IAAI;QAAI,MAAM;IAAU;IAC1B;QAAE,IAAI;QAAI,MAAM;IAAQ;IACxB;QAAE,IAAI;QAAI,MAAM;IAAQ;IACxB;QAAE,IAAI;QAAI,MAAM;IAAS;IACzB;QAAE,IAAI;QAAI,MAAM;IAAQ;IACxB;QAAE,IAAI;QAAI,MAAM;IAAY;IAC5B;QAAE,IAAI;QAAI,MAAM;IAAO;IACvB;QAAE,IAAI;QAAI,MAAM;IAAM;IACtB;QAAE,IAAI;QAAI,MAAM;IAAW;IAC3B;QAAE,IAAI;QAAI,MAAM;IAAQ;IACxB;QAAE,IAAI;QAAI,MAAM;IAAQ;IACxB;QAAE,IAAI;QAAI,MAAM;IAAQ;IACxB;QAAE,IAAI;QAAI,MAAM;IAAU;IAC1B;QAAE,IAAI;QAAI,MAAM;IAAQ;IACxB;QAAE,IAAI;QAAI,MAAM;IAAS;IACzB;QAAE,IAAI;QAAI,MAAM;IAAS;IACzB;QAAE,IAAI;QAAI,MAAM;IAAS;IACzB;QAAE,IAAI;QAAI,MAAM;IAAU;IAC1B;QAAE,IAAI;QAAI,MAAM;IAAM;IACtB;QAAE,IAAI;QAAI,MAAM;IAAQ;IACxB;QAAE,IAAI;QAAI,MAAM;IAAS;IACzB;QAAE,IAAI;QAAI,MAAM;IAAO;IACvB;QAAE,IAAI;QAAI,MAAM;IAAQ;IACxB;QAAE,IAAI;QAAI,MAAM;IAAS;IACzB;QAAE,IAAI;QAAI,MAAM;IAAQ;IACxB;QAAE,IAAI;QAAI,MAAM;IAAS;IACzB;QAAE,IAAI;QAAI,MAAM;IAAY;IAC5B;QAAE,IAAI;QAAI,MAAM;IAAM;IACtB;QAAE,IAAI;QAAI,MAAM;IAAS;IACzB;QAAE,IAAI;QAAI,MAAM;IAAS;IACzB;QAAE,IAAI;QAAI,MAAM;IAAO;IACvB;QAAE,IAAI;QAAI,MAAM;IAAO;IACvB;QAAE,IAAI;QAAI,MAAM;IAAS;IACzB;QAAE,IAAI;QAAI,MAAM;IAAU;IAC1B;QAAE,IAAI;QAAK,MAAM;IAAoB;IACrC;QAAE,IAAI;QAAK,MAAM;IAAM;IACvB;QAAE,IAAI;QAAK,MAAM;IAAS;CAC3B;AAKM,MAAM,kBAAkB;IAC7B,SAAS;IACT,QAAQ;IACR,eAAe;IAEf,gBAAgB;IAChB,sBAAsB;IACtB,gBAAgB;IAEhB,aAAa;IACb,iBAAiB;IACjB,aAAa;AACf;AAKO,MAAM,0BAA0B;IACrC,yBAAyB;IACzB,UAAU;IACV,MAAM;IACN,QAAQ;IACR,oBAAoB;IACpB,iBAAiB;IACjB,eAAe;IACf,oBAAoB;IACpB,UAAU;IACV,kBAAkB;IAClB,QAAQ;IACR,kBAAkB;IAClB,cAAc;IACd,gBAAgB;IAChB,eAAe;IACf,QAAQ;AACV;AAKO,MAAM,oBAAoB;IAC/B;QAAE,KAAK;QAAa,OAAO;QAAc,OAAO;QAAwB,aAAa;IAA6B;IAClH;QAAE,KAAK;QAAe,OAAO;QAAgB,OAAO;QAAiC,aAAa;IAAyB;IAC3H;QAAE,KAAK;QAAgB,OAAO;QAAiB,OAAO;QAA+B,aAAa;IAAuB;IACzH;QAAE,KAAK;QAAY,OAAO;QAAa,OAAO;QAAuB,aAAa;IAAmB;IACrG;QAAE,KAAK;QAAa,OAAO;QAAc,OAAO;QAAyB,aAAa;IAAiB;CACxG"}},
    {"offset": {"line": 725, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/store.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport type { SystemId } from '@/lib/id-types';\r\nimport type {\r\n  PkgxSettings,\r\n  PkgxCategory,\r\n  PkgxBrand,\r\n  PkgxCategoryMapping,\r\n  PkgxBrandMapping,\r\n  PkgxPriceMapping,\r\n  PkgxSyncSettings,\r\n  PkgxSyncResult,\r\n  PkgxSyncLog,\r\n  PkgxProduct,\r\n} from './types';\r\nimport { DEFAULT_PKGX_SETTINGS } from './types';\r\nimport { PKGX_CATEGORIES, PKGX_BRANDS } from './constants';\r\nimport { getCategories as fetchPkgxCategories, getBrands as fetchPkgxBrands } from '@/lib/pkgx/api-service';\r\nimport { getCurrentUserInfo } from '@/contexts/auth-context';\r\n\r\n// ========================================\r\n// Store Interface\r\n// ========================================\r\n\r\ninterface PkgxSettingsStore {\r\n  // === State ===\r\n  settings: PkgxSettings;\r\n  isLoading: boolean;\r\n  isSaving: boolean;\r\n  \r\n  // === General Config Actions ===\r\n  setApiUrl: (url: string) => void;\r\n  setApiKey: (key: string) => void;\r\n  setEnabled: (enabled: boolean) => void;\r\n  \r\n  // === Reference Data Actions ===\r\n  setCategories: (categories: PkgxCategory[]) => void;\r\n  addCategory: (category: PkgxCategory) => void;\r\n  updateCategory: (id: number, updates: Partial<PkgxCategory>) => void;\r\n  deleteCategory: (id: number) => void;\r\n  \r\n  setBrands: (brands: PkgxBrand[]) => void;\r\n  addBrand: (brand: PkgxBrand) => void;\r\n  updateBrand: (id: number, updates: Partial<PkgxBrand>) => void;\r\n  deleteBrand: (id: number) => void;\r\n  \r\n  // === Mapping Actions ===\r\n  setPriceMapping: (mapping: PkgxPriceMapping) => void;\r\n  updatePriceMapping: (field: keyof PkgxPriceMapping, policyId: SystemId | null) => void;\r\n  \r\n  setCategoryMappings: (mappings: PkgxCategoryMapping[]) => void;\r\n  addCategoryMapping: (mapping: PkgxCategoryMapping) => void;\r\n  updateCategoryMapping: (id: string, updates: Partial<PkgxCategoryMapping>) => void;\r\n  deleteCategoryMapping: (id: string) => void;\r\n  \r\n  setBrandMappings: (mappings: PkgxBrandMapping[]) => void;\r\n  addBrandMapping: (mapping: PkgxBrandMapping) => void;\r\n  updateBrandMapping: (id: string, updates: Partial<PkgxBrandMapping>) => void;\r\n  deleteBrandMapping: (id: string) => void;\r\n  \r\n  // === Sync Settings Actions ===\r\n  setSyncSettings: (settings: PkgxSyncSettings) => void;\r\n  updateSyncSetting: <K extends keyof PkgxSyncSettings>(key: K, value: PkgxSyncSettings[K]) => void;\r\n  \r\n  // === Log Actions ===\r\n  addLog: (log: Omit<PkgxSyncLog, 'id' | 'timestamp'>) => void;\r\n  clearLogs: () => void;\r\n  \r\n  // === Sync Actions ===\r\n  syncCategoriesFromPkgx: () => Promise<void>;\r\n  syncBrandsFromPkgx: () => Promise<void>;\r\n  \r\n  // === PKGX Products Cache Actions ===\r\n  setPkgxProducts: (products: PkgxProduct[]) => void;\r\n  clearPkgxProducts: () => void;\r\n  \r\n  // === Status Actions ===\r\n  setLastSyncAt: (timestamp: string) => void;\r\n  setLastSyncResult: (result: PkgxSyncResult) => void;\r\n  setConnectionStatus: (status: 'connected' | 'disconnected' | 'error', error?: string) => void;\r\n  \r\n  // === Utility Actions ===\r\n  loadDefaultData: () => void;\r\n  resetSettings: () => void;\r\n  setLoading: (loading: boolean) => void;\r\n  setSaving: (saving: boolean) => void;\r\n  \r\n  // === Getters ===\r\n  getCategoryById: (id: number) => PkgxCategory | undefined;\r\n  getBrandById: (id: number) => PkgxBrand | undefined;\r\n  getCategoryMappingByHrmId: (hrmCategoryId: SystemId) => PkgxCategoryMapping | undefined;\r\n  getBrandMappingByHrmId: (hrmBrandId: SystemId) => PkgxBrandMapping | undefined;\r\n  getPkgxCatIdByHrmCategory: (hrmCategoryId: SystemId) => number | null;\r\n  getPkgxBrandIdByHrmBrand: (hrmBrandId: SystemId) => number | null;\r\n  \r\n  // === API Sync ===\r\n  initialized: boolean;\r\n  loadFromAPI: () => Promise<void>;\r\n}\r\n\r\n// ========================================\r\n// API Sync Helper\r\n// ========================================\r\nasync function syncPkgxSettingsToAPI(settings: Partial<PkgxSettings>): Promise<boolean> {\r\n  try {\r\n    const response = await fetch('/api/settings/pkgx', {\r\n      method: 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      credentials: 'include',\r\n      body: JSON.stringify(settings),\r\n    });\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error('[PKGX Settings API] sync error:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\n// ========================================\r\n// Store Implementation\r\n// ========================================\r\n\r\nexport const usePkgxSettingsStore = create<PkgxSettingsStore>()(\r\n  (set, get) => ({\r\n      // === Initial State ===\r\n      settings: {\r\n        ...DEFAULT_PKGX_SETTINGS,\r\n        categories: PKGX_CATEGORIES,\r\n        brands: PKGX_BRANDS,\r\n      },\r\n      isLoading: false,\r\n      isSaving: false,\r\n      initialized: false,\r\n      \r\n      // === General Config Actions ===\r\n      setApiUrl: (url) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, apiUrl: url },\r\n        })),\r\n        \r\n      setApiKey: (key) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, apiKey: key },\r\n        })),\r\n        \r\n      setEnabled: (enabled) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, enabled },\r\n        })),\r\n      \r\n      // === Reference Data Actions ===\r\n      setCategories: (categories) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, categories },\r\n        })),\r\n        \r\n      addCategory: (category) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categories: [...state.settings.categories, category],\r\n          },\r\n        })),\r\n        \r\n      updateCategory: (id, updates) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categories: state.settings.categories.map((c) =>\r\n              c.id === id ? { ...c, ...updates } : c\r\n            ),\r\n          },\r\n        })),\r\n        \r\n      deleteCategory: (id) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categories: state.settings.categories.filter((c) => c.id !== id),\r\n            // Also remove related mappings\r\n            categoryMappings: state.settings.categoryMappings.filter(\r\n              (m) => m.pkgxCatId !== id\r\n            ),\r\n          },\r\n        })),\r\n      \r\n      setBrands: (brands) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, brands },\r\n        })),\r\n        \r\n      addBrand: (brand) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brands: [...state.settings.brands, brand],\r\n          },\r\n        })),\r\n        \r\n      updateBrand: (id, updates) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brands: state.settings.brands.map((b) =>\r\n              b.id === id ? { ...b, ...updates } : b\r\n            ),\r\n          },\r\n        })),\r\n        \r\n      deleteBrand: (id) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brands: state.settings.brands.filter((b) => b.id !== id),\r\n            // Also remove related mappings\r\n            brandMappings: state.settings.brandMappings.filter(\r\n              (m) => m.pkgxBrandId !== id\r\n            ),\r\n          },\r\n        })),\r\n      \r\n      // === Mapping Actions ===\r\n      setPriceMapping: (mapping) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, priceMapping: mapping },\r\n        })),\r\n        \r\n      updatePriceMapping: (field, policyId) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            priceMapping: {\r\n              ...state.settings.priceMapping,\r\n              [field]: policyId,\r\n            },\r\n          },\r\n        })),\r\n      \r\n      setCategoryMappings: (mappings) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, categoryMappings: mappings },\r\n        })),\r\n        \r\n      addCategoryMapping: (mapping) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categoryMappings: [...state.settings.categoryMappings, mapping],\r\n          },\r\n        })),\r\n        \r\n      updateCategoryMapping: (id, updates) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categoryMappings: state.settings.categoryMappings.map((m) =>\r\n              m.id === id ? { ...m, ...updates } : m\r\n            ),\r\n          },\r\n        })),\r\n        \r\n      deleteCategoryMapping: (id) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categoryMappings: state.settings.categoryMappings.filter(\r\n              (m) => m.id !== id\r\n            ),\r\n          },\r\n        })),\r\n      \r\n      setBrandMappings: (mappings) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, brandMappings: mappings },\r\n        })),\r\n        \r\n      addBrandMapping: (mapping) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brandMappings: [...state.settings.brandMappings, mapping],\r\n          },\r\n        })),\r\n        \r\n      updateBrandMapping: (id, updates) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brandMappings: state.settings.brandMappings.map((m) =>\r\n              m.id === id ? { ...m, ...updates } : m\r\n            ),\r\n          },\r\n        })),\r\n        \r\n      deleteBrandMapping: (id) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            brandMappings: state.settings.brandMappings.filter(\r\n              (m) => m.id !== id\r\n            ),\r\n          },\r\n        })),\r\n      \r\n      // === Sync Settings Actions ===\r\n      setSyncSettings: (syncSettings) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, syncSettings },\r\n        })),\r\n        \r\n      updateSyncSetting: (key, value) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            syncSettings: {\r\n              ...state.settings.syncSettings,\r\n              [key]: value,\r\n            },\r\n          },\r\n        })),\r\n      \r\n      // === Log Actions ===\r\n      addLog: (log) => {\r\n        // Lấy thông tin user hiện tại\r\n        const userInfo = getCurrentUserInfo();\r\n        \r\n        const newLog: PkgxSyncLog = {\r\n          ...log,\r\n          id: `log-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,\r\n          timestamp: new Date().toISOString(),\r\n          userId: userInfo.systemId,\r\n          userName: userInfo.name,\r\n        };\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            logs: [newLog, ...state.settings.logs].slice(0, 100), // Keep last 100 logs\r\n          },\r\n        }));\r\n      },\r\n      \r\n      clearLogs: () =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, logs: [] },\r\n        })),\r\n      \r\n      // === Sync Actions ===\r\n      syncCategoriesFromPkgx: async () => {\r\n        const { addLog, setCategories } = get();\r\n        try {\r\n          const response = await fetchPkgxCategories();\r\n          if (response.success && response.data && !response.data.error) {\r\n            // Map API response to PkgxCategory format\r\n            const categories: PkgxCategory[] = response.data.data.map((cat) => ({\r\n              id: cat.cat_id,\r\n              name: cat.cat_name,\r\n              parentId: cat.parent_id > 0 ? cat.parent_id : undefined,\r\n            }));\r\n            \r\n            // Replace all categories with fresh data from server\r\n            setCategories(categories);\r\n            addLog({\r\n              action: 'sync_categories',\r\n              status: 'success',\r\n              message: `Đã đồng bộ ${categories.length} danh mục từ PKGX`,\r\n              details: { total: categories.length, success: categories.length, failed: 0 },\r\n            });\r\n          } else {\r\n            throw new Error(response.error || response.data?.message || 'Không thể lấy danh sách danh mục');\r\n          }\r\n        } catch (error) {\r\n          addLog({\r\n            action: 'sync_categories',\r\n            status: 'error',\r\n            message: 'Lỗi khi đồng bộ danh mục từ PKGX',\r\n            details: { error: error instanceof Error ? error.message : String(error) },\r\n          });\r\n          throw error; // Re-throw to let UI handle\r\n        }\r\n      },\r\n      \r\n      syncBrandsFromPkgx: async () => {\r\n        const { addLog, setBrands } = get();\r\n        try {\r\n          const response = await fetchPkgxBrands();\r\n          if (response.success && response.data && !response.data.error) {\r\n            // Map API response to PkgxBrand format\r\n            const brands: PkgxBrand[] = response.data.data.map((brand) => ({\r\n              id: brand.brand_id,\r\n              name: brand.brand_name,\r\n            }));\r\n            \r\n            // Replace all brands with fresh data from server\r\n            setBrands(brands);\r\n            addLog({\r\n              action: 'sync_brands',\r\n              status: 'success',\r\n              message: `Đã đồng bộ ${brands.length} thương hiệu từ PKGX`,\r\n              details: { total: brands.length, success: brands.length, failed: 0 },\r\n            });\r\n          } else {\r\n            throw new Error(response.error || response.data?.message || 'Không thể lấy danh sách thương hiệu');\r\n          }\r\n        } catch (error) {\r\n          addLog({\r\n            action: 'sync_brands',\r\n            status: 'error',\r\n            message: 'Lỗi khi đồng bộ thương hiệu từ PKGX',\r\n            details: { error: error instanceof Error ? error.message : String(error) },\r\n          });\r\n          throw error; // Re-throw to let UI handle\r\n        }\r\n      },\r\n      \r\n      // === PKGX Products Cache Actions ===\r\n      setPkgxProducts: (products) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            pkgxProducts: products,\r\n            pkgxProductsLastFetch: new Date().toISOString(),\r\n          },\r\n        })),\r\n        \r\n      clearPkgxProducts: () =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            pkgxProducts: [],\r\n            pkgxProductsLastFetch: undefined,\r\n          },\r\n        })),\r\n      \r\n      // === Status Actions ===\r\n      setLastSyncAt: (timestamp) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, lastSyncAt: timestamp },\r\n        })),\r\n        \r\n      setLastSyncResult: (result) =>\r\n        set((state) => ({\r\n          settings: { ...state.settings, lastSyncResult: result },\r\n        })),\r\n        \r\n      setConnectionStatus: (status, error) =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            connectionStatus: status,\r\n            connectionError: error,\r\n          },\r\n        })),\r\n      \r\n      // === Utility Actions ===\r\n      loadDefaultData: () =>\r\n        set((state) => ({\r\n          settings: {\r\n            ...state.settings,\r\n            categories: PKGX_CATEGORIES,\r\n            brands: PKGX_BRANDS,\r\n          },\r\n        })),\r\n        \r\n      resetSettings: () =>\r\n        set({\r\n          settings: {\r\n            ...DEFAULT_PKGX_SETTINGS,\r\n            categories: PKGX_CATEGORIES,\r\n            brands: PKGX_BRANDS,\r\n          },\r\n        }),\r\n        \r\n      setLoading: (isLoading) => set({ isLoading }),\r\n      setSaving: (isSaving) => set({ isSaving }),\r\n      \r\n      // === Getters ===\r\n      getCategoryById: (id) =>\r\n        get().settings.categories.find((c) => c.id === id),\r\n        \r\n      getBrandById: (id) =>\r\n        get().settings.brands.find((b) => b.id === id),\r\n        \r\n      getCategoryMappingByHrmId: (hrmCategoryId) =>\r\n        get().settings.categoryMappings.find(\r\n          (m) => m.hrmCategorySystemId === hrmCategoryId\r\n        ),\r\n        \r\n      getBrandMappingByHrmId: (hrmBrandId) =>\r\n        get().settings.brandMappings.find(\r\n          (m) => m.hrmBrandSystemId === hrmBrandId\r\n        ),\r\n        \r\n      getPkgxCatIdByHrmCategory: (hrmCategoryId) => {\r\n        const mapping = get().settings.categoryMappings.find(\r\n          (m) => m.hrmCategorySystemId === hrmCategoryId\r\n        );\r\n        return mapping?.pkgxCatId ?? null;\r\n      },\r\n      \r\n      getPkgxBrandIdByHrmBrand: (hrmBrandId) => {\r\n        const mapping = get().settings.brandMappings.find(\r\n          (m) => m.hrmBrandSystemId === hrmBrandId\r\n        );\r\n        return mapping?.pkgxBrandId ?? null;\r\n      },\r\n      \r\n      loadFromAPI: async () => {\r\n        if (get().initialized) return;\r\n        \r\n        try {\r\n          const response = await fetch('/api/settings/pkgx', {\r\n            credentials: 'include',\r\n          });\r\n          if (response.ok) {\r\n            const json = await response.json();\r\n            const data = json.data || json.settings;\r\n            if (data) {\r\n              set({ \r\n                settings: { \r\n                  ...DEFAULT_PKGX_SETTINGS, \r\n                  categories: PKGX_CATEGORIES,\r\n                  brands: PKGX_BRANDS,\r\n                  ...data \r\n                },\r\n                initialized: true \r\n              });\r\n            } else {\r\n              set({ initialized: true });\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('[PKGX Settings Store] loadFromAPI error:', error);\r\n        }\r\n      },\r\n    })\r\n);\r\n\r\n// ========================================\r\n// Selector Hooks\r\n// ========================================\r\n\r\nexport function usePkgxEnabled() {\r\n  return usePkgxSettingsStore((state) => state.settings.enabled);\r\n}\r\n\r\nexport function usePkgxApiConfig() {\r\n  return usePkgxSettingsStore((state) => ({\r\n    apiUrl: state.settings.apiUrl,\r\n    apiKey: state.settings.apiKey,\r\n    enabled: state.settings.enabled,\r\n  }));\r\n}\r\n\r\nexport function usePkgxCategories() {\r\n  return usePkgxSettingsStore((state) => state.settings.categories);\r\n}\r\n\r\nexport function usePkgxBrands() {\r\n  return usePkgxSettingsStore((state) => state.settings.brands);\r\n}\r\n\r\nexport function usePkgxPriceMapping() {\r\n  return usePkgxSettingsStore((state) => state.settings.priceMapping);\r\n}\r\n\r\nexport function usePkgxCategoryMappings() {\r\n  return usePkgxSettingsStore((state) => state.settings.categoryMappings);\r\n}\r\n\r\nexport function usePkgxBrandMappings() {\r\n  return usePkgxSettingsStore((state) => state.settings.brandMappings);\r\n}\r\n\r\nexport function usePkgxSyncSettings() {\r\n  return usePkgxSettingsStore((state) => state.settings.syncSettings);\r\n}\r\n\r\nexport function usePkgxSyncStatus() {\r\n  return usePkgxSettingsStore((state) => ({\r\n    lastSyncAt: state.settings.lastSyncAt,\r\n    lastSyncResult: state.settings.lastSyncResult,\r\n    connectionStatus: state.settings.connectionStatus,\r\n    connectionError: state.settings.connectionError,\r\n  }));\r\n}\r\n\r\nexport function usePkgxProducts() {\r\n  return usePkgxSettingsStore((state) => ({\r\n    products: state.settings.pkgxProducts,\r\n    lastFetch: state.settings.pkgxProductsLastFetch,\r\n  }));\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1212, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/components/general-config-tab.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../../../../components/ui/card';\r\nimport { Label } from '../../../../components/ui/label';\r\nimport { Input } from '../../../../components/ui/input';\r\nimport { Button } from '../../../../components/ui/button';\r\nimport { Switch } from '../../../../components/ui/switch';\r\nimport { Badge } from '../../../../components/ui/badge';\r\nimport { Eye, EyeOff, RefreshCw, CheckCircle2, XCircle, Loader2, Save } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { usePkgxSettingsStore } from '../store';\r\nimport { PKGX_API_CONFIG } from '../constants';\r\n\r\nexport function GeneralConfigTab() {\r\n  const { settings, setApiUrl, setApiKey, setEnabled, setConnectionStatus, updateSyncSetting, addLog } = usePkgxSettingsStore();\r\n  const [showApiKey, setShowApiKey] = React.useState(false);\r\n  const [isTesting, setIsTesting] = React.useState(false);\r\n  const [localApiUrl, setLocalApiUrl] = React.useState(settings.apiUrl);\r\n  const [localApiKey, setLocalApiKey] = React.useState(settings.apiKey);\r\n  \r\n  const handleSaveConfig = () => {\r\n    setApiUrl(localApiUrl);\r\n    setApiKey(localApiKey);\r\n    addLog({\r\n      action: 'save_config',\r\n      status: 'success',\r\n      message: 'Đã lưu cấu hình API',\r\n      details: { url: localApiUrl },\r\n    });\r\n    toast.success('Đã lưu cấu hình API');\r\n  };\r\n  \r\n  const handleTestConnection = async () => {\r\n    if (!localApiKey) {\r\n      toast.error('Vui lòng nhập API Key trước khi test');\r\n      return;\r\n    }\r\n    \r\n    setIsTesting(true);\r\n    const startTime = Date.now();\r\n    \r\n    try {\r\n      // Step 1: Ping server (không cần API key) để kiểm tra server hoạt động\r\n      const pingUrl = `${localApiUrl}?action=ping`;\r\n      const pingResponse = await fetch(pingUrl, {\r\n        method: 'GET',\r\n      });\r\n      \r\n      if (!pingResponse.ok) {\r\n        addLog({\r\n          action: 'ping',\r\n          status: 'error',\r\n          message: `Server không phản hồi`,\r\n          details: { url: pingUrl, httpStatus: pingResponse.status },\r\n        });\r\n        throw new Error(`Server không phản hồi (HTTP ${pingResponse.status})`);\r\n      }\r\n      \r\n      // Verify ping response is valid JSON\r\n      const pingText = await pingResponse.text();\r\n      try {\r\n        JSON.parse(pingText);\r\n      } catch {\r\n        // Lấy tên file từ URL người dùng nhập\r\n        const apiFileName = localApiUrl.split('/').pop() || 'api_product_hrm.php';\r\n        addLog({\r\n          action: 'ping',\r\n          status: 'error',\r\n          message: 'Server trả về lỗi PHP thay vì JSON',\r\n          details: { url: pingUrl, error: pingText.substring(0, 100) },\r\n        });\r\n        throw new Error(`Server có lỗi PHP. Vui lòng upload lại file ${apiFileName}`);\r\n      }\r\n      \r\n      addLog({\r\n        action: 'ping',\r\n        status: 'success',\r\n        message: 'Server hoạt động',\r\n        details: { url: pingUrl, responseTime: Date.now() - startTime },\r\n      });\r\n      \r\n      // Step 2: Test với API key\r\n      const testUrl = `${localApiUrl}?action=test`;\r\n      const testStartTime = Date.now();\r\n      const response = await fetch(testUrl, {\r\n        method: 'GET',\r\n        headers: {\r\n          'X-API-KEY': localApiKey,\r\n        },\r\n      });\r\n      \r\n      // Check if response is JSON\r\n      const contentType = response.headers.get('content-type');\r\n      const responseText = await response.text();\r\n      \r\n      let data;\r\n      try {\r\n        data = JSON.parse(responseText);\r\n      } catch (parseError) {\r\n        // PHP trả về HTML error thay vì JSON\r\n        const errorPreview = responseText.substring(0, 200);\r\n        console.error('Invalid JSON response:', errorPreview);\r\n        throw new Error(`Server trả về lỗi PHP. Kiểm tra file API trên server.`);\r\n      }\r\n      \r\n      if (!data.error) {\r\n        setConnectionStatus('connected');\r\n        const stats = data.stats || {};\r\n        addLog({\r\n          action: 'test_connection',\r\n          status: 'success',\r\n          message: `Kết nối thành công! SP: ${stats.total_products}, DM: ${stats.total_categories}, TH: ${stats.total_brands}`,\r\n          details: { \r\n            url: testUrl, \r\n            responseTime: Date.now() - testStartTime,\r\n            total: stats.total_products,\r\n          },\r\n        });\r\n        toast.success(`Kết nối thành công! Sản phẩm: ${stats.total_products || 0}, Danh mục: ${stats.total_categories || 0}, Thương hiệu: ${stats.total_brands || 0}`);\r\n      } else {\r\n        setConnectionStatus('error', data.message);\r\n        addLog({\r\n          action: 'test_connection',\r\n          status: 'error',\r\n          message: `Lỗi xác thực: ${data.message}`,\r\n          details: { url: testUrl, error: data.message },\r\n        });\r\n        toast.error(`Lỗi: ${data.message}`);\r\n      }\r\n    } catch (error) {\r\n      const errorMessage = error instanceof Error ? error.message : 'Không thể kết nối';\r\n      setConnectionStatus('error', errorMessage);\r\n      addLog({\r\n        action: 'test_connection',\r\n        status: 'error',\r\n        message: `Lỗi kết nối: ${errorMessage}`,\r\n        details: { error: errorMessage, responseTime: Date.now() - startTime },\r\n      });\r\n      toast.error(`Không thể kết nối đến server PKGX: ${errorMessage}`);\r\n    } finally {\r\n      setIsTesting(false);\r\n    }\r\n  };\r\n  \r\n  const getStatusBadge = () => {\r\n    switch (settings.connectionStatus) {\r\n      case 'connected':\r\n        return <Badge variant=\"default\" className=\"bg-green-500\"><CheckCircle2 className=\"h-3 w-3 mr-1\" />Đã kết nối</Badge>;\r\n      case 'error':\r\n        return <Badge variant=\"destructive\"><XCircle className=\"h-3 w-3 mr-1\" />Lỗi kết nối</Badge>;\r\n      default:\r\n        return <Badge variant=\"secondary\">Chưa kết nối</Badge>;\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* API Connection Card */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"text-lg\">Thông tin kết nối API</CardTitle>\r\n          <CardDescription>Cấu hình kết nối với website phukiengiaxuong.com.vn</CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"apiUrl\">API URL</Label>\r\n            <Input\r\n              id=\"apiUrl\"\r\n              value={localApiUrl}\r\n              onChange={(e) => setLocalApiUrl(e.target.value)}\r\n              placeholder={PKGX_API_CONFIG.baseUrl}\r\n            />\r\n          </div>\r\n          \r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"apiKey\">API Key</Label>\r\n            <div className=\"flex gap-2\">\r\n              <div className=\"relative flex-1\">\r\n                <Input\r\n                  id=\"apiKey\"\r\n                  type={showApiKey ? 'text' : 'password'}\r\n                  value={localApiKey}\r\n                  onChange={(e) => setLocalApiKey(e.target.value)}\r\n                  placeholder=\"Nhập API Key...\"\r\n                  className=\"pr-10\"\r\n                />\r\n                <Button\r\n                  type=\"button\"\r\n                  variant=\"ghost\"\r\n                  size=\"icon\"\r\n                  className=\"absolute right-0 top-0 h-full\"\r\n                  onClick={() => setShowApiKey(!showApiKey)}\r\n                >\r\n                  {showApiKey ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\r\n                </Button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"flex items-center gap-2 pt-2\">\r\n            <Button onClick={handleSaveConfig} variant=\"default\">\r\n              <Save className=\"h-4 w-4 mr-2\" />\r\n              Lưu cấu hình\r\n            </Button>\r\n            <Button onClick={handleTestConnection} disabled={isTesting} variant=\"outline\">\r\n              {isTesting ? <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" /> : <RefreshCw className=\"h-4 w-4 mr-2\" />}\r\n              Test Connection\r\n            </Button>\r\n          </div>\r\n          \r\n          <div className=\"flex items-center gap-3\">\r\n            <span className=\"text-sm text-muted-foreground\">Trạng thái:</span>\r\n            {getStatusBadge()}\r\n          </div>\r\n          \r\n          {settings.connectionError && (\r\n            <p className=\"text-sm text-destructive\">{settings.connectionError}</p>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n      \r\n      {/* Enable/Disable Card */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"text-lg\">Trạng thái tích hợp</CardTitle>\r\n          <CardDescription>Bật/tắt đồng bộ với PKGX</CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"font-medium\">Bật tích hợp PKGX</p>\r\n              <p className=\"text-sm text-muted-foreground\">Cho phép đồng bộ sản phẩm với website</p>\r\n            </div>\r\n            <Switch checked={settings.enabled} onCheckedChange={setEnabled} />\r\n          </div>\r\n          \r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <p className=\"font-medium\">Bật Auto Sync</p>\r\n              <p className=\"text-sm text-muted-foreground\">Tự động đồng bộ dữ liệu theo lịch</p>\r\n            </div>\r\n            <Switch \r\n              checked={settings.syncSettings.autoSyncEnabled} \r\n              onCheckedChange={(checked) => updateSyncSetting('autoSyncEnabled', checked)} \r\n            />\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n      \r\n      {/* Stats Card */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"text-lg\">Thống kê</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\r\n            <div className=\"text-center p-3 bg-muted rounded-lg\">\r\n              <p className=\"text-2xl font-bold\">{settings.categories.length}</p>\r\n              <p className=\"text-sm text-muted-foreground\">Danh mục PKGX</p>\r\n            </div>\r\n            <div className=\"text-center p-3 bg-muted rounded-lg\">\r\n              <p className=\"text-2xl font-bold\">{settings.brands.length}</p>\r\n              <p className=\"text-sm text-muted-foreground\">Thương hiệu PKGX</p>\r\n            </div>\r\n            <div className=\"text-center p-3 bg-muted rounded-lg\">\r\n              <p className=\"text-2xl font-bold\">{settings.categoryMappings.length}</p>\r\n              <p className=\"text-sm text-muted-foreground\">Mapping danh mục</p>\r\n            </div>\r\n            <div className=\"text-center p-3 bg-muted rounded-lg\">\r\n              <p className=\"text-2xl font-bold\">{settings.brandMappings.length}</p>\r\n              <p className=\"text-sm text-muted-foreground\">Mapping thương hiệu</p>\r\n            </div>\r\n          </div>\r\n          {settings.lastSyncAt && (\r\n            <p className=\"text-sm text-muted-foreground mt-4\">\r\n              Lần sync cuối: {new Date(settings.lastSyncAt).toLocaleString('vi-VN')}\r\n            </p>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1932, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/inventory/product-category-store.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { asSystemId, asBusinessId, type SystemId, type BusinessId } from '@/lib/id-types';\r\nimport type { ProductCategory } from './types';\r\n\r\nconst generateSystemId = (counter: number): SystemId => {\r\n  return asSystemId(`CATEGORY${String(counter + 1).padStart(6, '0')}`);\r\n};\r\n\r\nconst generateBusinessId = (counter: number): BusinessId => {\r\n  return asBusinessId(`DM${String(counter + 1).padStart(6, '0')}`);\r\n};\r\n\r\n// Helper to calculate path and level\r\nconst calculatePathAndLevel = (category: ProductCategory, allCategories: ProductCategory[]): { path: string; level: number } => {\r\n  if (!category.parentId) {\r\n    return { path: category.name, level: 0 };\r\n  }\r\n  \r\n  const parent = allCategories.find(c => c.systemId === category.parentId);\r\n  if (!parent) {\r\n    return { path: category.name, level: 0 };\r\n  }\r\n  \r\n  const parentInfo = calculatePathAndLevel(parent, allCategories);\r\n  return {\r\n    path: `${parentInfo.path} > ${category.name}`,\r\n    level: parentInfo.level + 1\r\n  };\r\n};\r\n\r\ninterface ProductCategoryState {\r\n  data: ProductCategory[];\r\n  counter: number;\r\n  initialized: boolean;\r\n  add: (category: Omit<ProductCategory, 'systemId' | 'id' | 'path' | 'level'> & { id?: string }) => ProductCategory;\r\n  update: (systemId: SystemId, updates: Partial<ProductCategory>) => void;\r\n  remove: (systemId: SystemId) => void;\r\n  findById: (systemId: SystemId) => ProductCategory | undefined;\r\n  findByBusinessId: (id: BusinessId) => ProductCategory | undefined;\r\n  getActive: () => ProductCategory[];\r\n  getByParent: (parentId?: SystemId) => ProductCategory[];\r\n  updateSortOrder: (systemId: SystemId, newSortOrder: number) => void;\r\n  moveCategory: (systemId: SystemId, newParentId: SystemId | undefined, newSortOrder: number) => void;\r\n  recalculatePaths: () => void;\r\n  getNextId: () => BusinessId;\r\n  isBusinessIdExists: (id: string) => boolean;\r\n  loadFromAPI: () => Promise<void>;\r\n}\r\n\r\n// API sync helper\r\nasync function syncCategoryToAPI(category: ProductCategory, action: 'create' | 'update' | 'delete'): Promise<boolean> {\r\n  try {\r\n    const endpoint = action === 'create' ? '/api/categories' : `/api/categories/${category.systemId}`;\r\n    const response = await fetch(endpoint, {\r\n      method: action === 'create' ? 'POST' : action === 'delete' ? 'DELETE' : 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify(category),\r\n    });\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error('syncCategoryToAPI error:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const useProductCategoryStore = create<ProductCategoryState>()(\r\n  (set, get) => ({\r\n    data: [],\r\n    counter: 0,\r\n    initialized: false,\r\n      \r\n    add: (category) => {\r\n        const currentCounter = get().counter;\r\n        const allData = get().data;\r\n        const { id, ...rest } = category;\r\n        \r\n        const businessId = id && id.trim() \r\n          ? asBusinessId(id.trim())\r\n          : generateBusinessId(currentCounter);\r\n        \r\n        const { path, level } = calculatePathAndLevel(\r\n          { ...rest, systemId: 'temp' as SystemId, id: businessId, path: '', level: 0 } as ProductCategory,\r\n          allData\r\n        );\r\n        \r\n        const newCategory: ProductCategory = {\r\n          ...rest,\r\n          systemId: generateSystemId(currentCounter),\r\n          id: businessId,\r\n          path,\r\n          level,\r\n          createdAt: new Date().toISOString(),\r\n          isDeleted: false,\r\n          isActive: category.isActive !== undefined ? category.isActive : true,\r\n        };\r\n        set((state) => ({ \r\n          data: [...state.data, newCategory],\r\n          counter: state.counter + 1,\r\n        }));\r\n        get().recalculatePaths();\r\n        return newCategory;\r\n      },\r\n      \r\n      update: (systemId, updates) => {\r\n        set((state) => ({\r\n          data: state.data.map((item) =>\r\n            item.systemId === systemId\r\n              ? { ...item, ...updates, updatedAt: new Date().toISOString() }\r\n              : item\r\n          ),\r\n        }));\r\n        get().recalculatePaths();\r\n      },\r\n      \r\n      remove: (systemId) => {\r\n        set((state) => ({\r\n          data: state.data.map((item) =>\r\n            item.systemId === systemId\r\n              ? { ...item, isDeleted: true, updatedAt: new Date().toISOString() }\r\n              : item\r\n          ),\r\n        }));\r\n      },\r\n      \r\n      findById: (systemId) => {\r\n        return get().data.find((item) => item.systemId === systemId && !item.isDeleted);\r\n      },\r\n      \r\n      findByBusinessId: (id) => {\r\n        return get().data.find((item) => item.id === id && !item.isDeleted);\r\n      },\r\n      \r\n      getActive: () => {\r\n        return get().data.filter((item) => !item.isDeleted && item.isActive);\r\n      },\r\n      \r\n      getByParent: (parentId) => {\r\n        return get().data.filter(\r\n          (item) => !item.isDeleted && item.isActive && item.parentId === parentId\r\n        ).sort((a, b) => (a.sortOrder ?? 0) - (b.sortOrder ?? 0));\r\n      },\r\n\r\n      updateSortOrder: (systemId, newSortOrder) => {\r\n        set((state) => ({\r\n          data: state.data.map((item) =>\r\n            item.systemId === systemId\r\n              ? { ...item, sortOrder: newSortOrder, updatedAt: new Date().toISOString() }\r\n              : item\r\n          ),\r\n        }));\r\n      },\r\n\r\n      moveCategory: (systemId, newParentId, newSortOrder) => {\r\n        set((state) => ({\r\n          data: state.data.map((item) =>\r\n            item.systemId === systemId\r\n              ? { \r\n                  ...item, \r\n                  parentId: newParentId, \r\n                  sortOrder: newSortOrder,\r\n                  updatedAt: new Date().toISOString() \r\n                }\r\n              : item\r\n          ),\r\n        }));\r\n        get().recalculatePaths();\r\n      },\r\n\r\n      recalculatePaths: () => {\r\n        set((state) => {\r\n          const allData = [...state.data];\r\n          const updated = allData.map(cat => {\r\n            if (cat.isDeleted) return cat;\r\n            const { path, level } = calculatePathAndLevel(cat, allData);\r\n            return { ...cat, path, level };\r\n          });\r\n          return { data: updated };\r\n        });\r\n      },\r\n      \r\n      getNextId: () => generateBusinessId(get().counter),\r\n      \r\n      isBusinessIdExists: (id: string) => get().data.some((item) => String(item.id) === id),\r\n\r\n      loadFromAPI: async () => {\r\n        if (get().initialized) return;\r\n        try {\r\n          const response = await fetch('/api/categories?all=true');\r\n          if (response.ok) {\r\n            const json = await response.json();\r\n            if (json.data && Array.isArray(json.data)) {\r\n              const categories: ProductCategory[] = json.data.map((item: Record<string, unknown>) => ({\r\n                ...item,\r\n                systemId: asSystemId(item.systemId as string),\r\n                id: asBusinessId(item.id as string),\r\n                parentId: item.parentId ? asSystemId(item.parentId as string) : undefined,\r\n                // Add default values for fields not in database\r\n                isActive: item.isDeleted !== true,\r\n                color: item.color as string || '#6366f1',\r\n                path: '',\r\n                level: 0,\r\n              }));\r\n              set({ \r\n                data: categories, \r\n                counter: categories.length,\r\n                initialized: true,\r\n              });\r\n              get().recalculatePaths();\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('loadFromAPI error:', error);\r\n        }\r\n        set({ initialized: true });\r\n      },\r\n    })\r\n);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2130, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/validation/category-mapping-validation.ts"],"sourcesContent":["import type { SystemId } from '@/lib/id-types';\r\nimport type { PkgxCategoryMapping, PkgxCategory } from '../types';\r\n\r\n// ========================================\r\n// Validation Types\r\n// ========================================\r\n\r\nexport interface ValidationResult {\r\n  isValid: boolean;\r\n  errors: ValidationError[];\r\n  warnings: ValidationWarning[];\r\n}\r\n\r\nexport interface ValidationError {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface ValidationWarning {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface CategoryMappingInput {\r\n  hrmCategorySystemId: SystemId | string;\r\n  hrmCategoryName: string;\r\n  pkgxCatId: number | string;\r\n  pkgxCatName: string;\r\n}\r\n\r\n// ========================================\r\n// Error Codes\r\n// ========================================\r\n\r\nexport const CATEGORY_MAPPING_ERROR_CODES = {\r\n  // Required field errors\r\n  HRM_CATEGORY_REQUIRED: 'HRM_CATEGORY_REQUIRED',\r\n  PKGX_CATEGORY_REQUIRED: 'PKGX_CATEGORY_REQUIRED',\r\n  \r\n  // Duplicate/conflict errors\r\n  HRM_CATEGORY_ALREADY_MAPPED: 'HRM_CATEGORY_ALREADY_MAPPED',\r\n  PKGX_CATEGORY_ALREADY_MAPPED: 'PKGX_CATEGORY_ALREADY_MAPPED',\r\n  \r\n  // Not found errors\r\n  HRM_CATEGORY_NOT_FOUND: 'HRM_CATEGORY_NOT_FOUND',\r\n  PKGX_CATEGORY_NOT_FOUND: 'PKGX_CATEGORY_NOT_FOUND',\r\n  \r\n  // Inactive/deleted errors\r\n  HRM_CATEGORY_INACTIVE: 'HRM_CATEGORY_INACTIVE',\r\n  PKGX_CATEGORY_INACTIVE: 'PKGX_CATEGORY_INACTIVE',\r\n  \r\n  // Structure errors\r\n  MAPPING_TO_PARENT_CATEGORY: 'MAPPING_TO_PARENT_CATEGORY',\r\n  HIERARCHY_MISMATCH: 'HIERARCHY_MISMATCH',\r\n} as const;\r\n\r\nexport const CATEGORY_MAPPING_WARNING_CODES = {\r\n  // Suggestions\r\n  SAME_NAME_AVAILABLE: 'SAME_NAME_AVAILABLE',\r\n  PARENT_NOT_MAPPED: 'PARENT_NOT_MAPPED',\r\n  CHILD_ALREADY_MAPPED: 'CHILD_ALREADY_MAPPED',\r\n  NAME_MISMATCH: 'NAME_MISMATCH',\r\n  MANY_TO_ONE_MAPPING: 'MANY_TO_ONE_MAPPING',\r\n} as const;\r\n\r\n// ========================================\r\n// Error Messages (Vietnamese)\r\n// ========================================\r\n\r\nexport const CATEGORY_MAPPING_ERROR_MESSAGES: Record<string, string> = {\r\n  [CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_REQUIRED]: 'Vui lòng chọn danh mục HRM',\r\n  [CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_REQUIRED]: 'Vui lòng chọn danh mục PKGX',\r\n  [CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_ALREADY_MAPPED]: 'Danh mục HRM này đã được mapping với danh mục PKGX khác',\r\n  [CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_ALREADY_MAPPED]: 'Danh mục PKGX này đã được mapping với danh mục HRM khác',\r\n  [CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_NOT_FOUND]: 'Không tìm thấy danh mục HRM trong hệ thống',\r\n  [CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_NOT_FOUND]: 'Không tìm thấy danh mục PKGX (có thể đã bị xóa trên PKGX)',\r\n  [CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_INACTIVE]: 'Danh mục HRM đã bị vô hiệu hóa hoặc xóa',\r\n  [CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_INACTIVE]: 'Danh mục PKGX không hoạt động',\r\n  [CATEGORY_MAPPING_ERROR_CODES.MAPPING_TO_PARENT_CATEGORY]: 'Không nên mapping với danh mục cha. Hãy chọn danh mục con cụ thể',\r\n  [CATEGORY_MAPPING_ERROR_CODES.HIERARCHY_MISMATCH]: 'Cấp danh mục không khớp (cha/con)',\r\n};\r\n\r\nexport const CATEGORY_MAPPING_WARNING_MESSAGES: Record<string, string> = {\r\n  [CATEGORY_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE]: 'Có danh mục PKGX trùng tên, có thể bạn muốn chọn danh mục đó',\r\n  [CATEGORY_MAPPING_WARNING_CODES.PARENT_NOT_MAPPED]: 'Danh mục cha chưa được mapping. Nên mapping danh mục cha trước',\r\n  [CATEGORY_MAPPING_WARNING_CODES.CHILD_ALREADY_MAPPED]: 'Đã có danh mục con được mapping. Kiểm tra lại cấu trúc',\r\n  [CATEGORY_MAPPING_WARNING_CODES.NAME_MISMATCH]: 'Tên danh mục HRM và PKGX khác nhau đáng kể',\r\n  [CATEGORY_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING]: 'Nhiều danh mục HRM đang mapping tới cùng một danh mục PKGX',\r\n};\r\n\r\n// ========================================\r\n// Validation Context\r\n// ========================================\r\n\r\nexport interface ValidationContext {\r\n  existingMappings: PkgxCategoryMapping[];\r\n  hrmCategories: Array<{\r\n    systemId: SystemId;\r\n    name: string;\r\n    parentId?: SystemId;\r\n    status?: string;\r\n    isActive?: boolean;\r\n    path?: string;\r\n  }>;\r\n  pkgxCategories: PkgxCategory[];\r\n  editingMappingId?: string; // ID của mapping đang edit (để exclude khỏi duplicate check)\r\n}\r\n\r\n// ========================================\r\n// Validation Functions\r\n// ========================================\r\n\r\n/**\r\n * Validate required fields\r\n */\r\nexport function validateRequiredFields(input: CategoryMappingInput): ValidationError[] {\r\n  const errors: ValidationError[] = [];\r\n\r\n  if (!input.hrmCategorySystemId) {\r\n    errors.push({\r\n      code: CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_REQUIRED,\r\n      field: 'hrmCategorySystemId',\r\n      message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_REQUIRED],\r\n    });\r\n  }\r\n\r\n  if (!input.pkgxCatId) {\r\n    errors.push({\r\n      code: CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_REQUIRED,\r\n      field: 'pkgxCatId',\r\n      message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_REQUIRED],\r\n    });\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate category exists\r\n */\r\nexport function validateCategoryExists(\r\n  input: CategoryMappingInput,\r\n  context: ValidationContext\r\n): ValidationError[] {\r\n  const errors: ValidationError[] = [];\r\n\r\n  if (input.hrmCategorySystemId) {\r\n    const hrmCat = context.hrmCategories.find(c => c.systemId === input.hrmCategorySystemId);\r\n    if (!hrmCat) {\r\n      errors.push({\r\n        code: CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_NOT_FOUND,\r\n        field: 'hrmCategorySystemId',\r\n        message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_NOT_FOUND],\r\n        details: { systemId: input.hrmCategorySystemId },\r\n      });\r\n    } else if (hrmCat.status === 'inactive' || hrmCat.isActive === false) {\r\n      errors.push({\r\n        code: CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_INACTIVE,\r\n        field: 'hrmCategorySystemId',\r\n        message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_INACTIVE],\r\n        details: { systemId: input.hrmCategorySystemId, name: hrmCat.name },\r\n      });\r\n    }\r\n  }\r\n\r\n  if (input.pkgxCatId) {\r\n    const pkgxCat = context.pkgxCategories.find(c => c.id === input.pkgxCatId);\r\n    if (!pkgxCat) {\r\n      errors.push({\r\n        code: CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_NOT_FOUND,\r\n        field: 'pkgxCatId',\r\n        message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.PKGX_CATEGORY_NOT_FOUND],\r\n        details: { pkgxCatId: input.pkgxCatId },\r\n      });\r\n    }\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate duplicate mappings\r\n */\r\nexport function validateDuplicateMappings(\r\n  input: CategoryMappingInput,\r\n  context: ValidationContext\r\n): ValidationError[] {\r\n  const errors: ValidationError[] = [];\r\n\r\n  if (input.hrmCategorySystemId) {\r\n    const existingHrmMapping = context.existingMappings.find(\r\n      m => m.hrmCategorySystemId === input.hrmCategorySystemId && m.id !== context.editingMappingId\r\n    );\r\n    if (existingHrmMapping) {\r\n      errors.push({\r\n        code: CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_ALREADY_MAPPED,\r\n        field: 'hrmCategorySystemId',\r\n        message: CATEGORY_MAPPING_ERROR_MESSAGES[CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_ALREADY_MAPPED],\r\n        details: {\r\n          existingMapping: existingHrmMapping,\r\n          mappedTo: existingHrmMapping.pkgxCatName,\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  // Note: PKGX category có thể mapping với nhiều HRM category (one-to-many)\r\n  // Nhưng vẫn cảnh báo nếu đã có mapping khác\r\n  \r\n  return errors;\r\n}\r\n\r\n/**\r\n * Check for warnings (không block nhưng cảnh báo)\r\n */\r\nexport function checkWarnings(\r\n  input: CategoryMappingInput,\r\n  context: ValidationContext\r\n): ValidationWarning[] {\r\n  const warnings: ValidationWarning[] = [];\r\n\r\n  if (!input.hrmCategorySystemId || !input.pkgxCatId) {\r\n    return warnings;\r\n  }\r\n\r\n  const hrmCat = context.hrmCategories.find(c => c.systemId === input.hrmCategorySystemId);\r\n  const pkgxCat = context.pkgxCategories.find(c => c.id === input.pkgxCatId);\r\n\r\n  if (!hrmCat || !pkgxCat) return warnings;\r\n\r\n  // 1. Check name mismatch\r\n  const normalizedHrmName = normalizeString(hrmCat.name);\r\n  const normalizedPkgxName = normalizeString(pkgxCat.name);\r\n  const similarity = calculateSimilarity(normalizedHrmName, normalizedPkgxName);\r\n  \r\n  if (similarity < 0.5) {\r\n    warnings.push({\r\n      code: CATEGORY_MAPPING_WARNING_CODES.NAME_MISMATCH,\r\n      message: CATEGORY_MAPPING_WARNING_MESSAGES[CATEGORY_MAPPING_WARNING_CODES.NAME_MISMATCH],\r\n      details: { \r\n        hrmName: hrmCat.name, \r\n        pkgxName: pkgxCat.name,\r\n        similarity: Math.round(similarity * 100) + '%',\r\n      },\r\n    });\r\n  }\r\n\r\n  // 2. Check if same name exists in PKGX\r\n  const sameNamePkgx = context.pkgxCategories.find(\r\n    c => c.id !== input.pkgxCatId && normalizeString(c.name) === normalizedHrmName\r\n  );\r\n  if (sameNamePkgx) {\r\n    warnings.push({\r\n      code: CATEGORY_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE,\r\n      message: CATEGORY_MAPPING_WARNING_MESSAGES[CATEGORY_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE],\r\n      details: {\r\n        suggestedCategory: sameNamePkgx,\r\n      },\r\n    });\r\n  }\r\n\r\n  // 3. Check if parent category is not mapped (for HRM categories with parent)\r\n  if (hrmCat.parentId) {\r\n    const parentMapping = context.existingMappings.find(\r\n      m => m.hrmCategorySystemId === hrmCat.parentId\r\n    );\r\n    if (!parentMapping) {\r\n      const parentCat = context.hrmCategories.find(c => c.systemId === hrmCat.parentId);\r\n      if (parentCat) {\r\n        warnings.push({\r\n          code: CATEGORY_MAPPING_WARNING_CODES.PARENT_NOT_MAPPED,\r\n          message: CATEGORY_MAPPING_WARNING_MESSAGES[CATEGORY_MAPPING_WARNING_CODES.PARENT_NOT_MAPPED],\r\n          details: {\r\n            parentName: parentCat.name,\r\n            parentId: hrmCat.parentId,\r\n          },\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  // 4. Check many-to-one mapping\r\n  const otherMappingsToSamePkgx = context.existingMappings.filter(\r\n    m => m.pkgxCatId === input.pkgxCatId && m.id !== context.editingMappingId\r\n  );\r\n  if (otherMappingsToSamePkgx.length > 0) {\r\n    warnings.push({\r\n      code: CATEGORY_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING,\r\n      message: CATEGORY_MAPPING_WARNING_MESSAGES[CATEGORY_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING],\r\n      details: {\r\n        count: otherMappingsToSamePkgx.length + 1,\r\n        existingMappings: otherMappingsToSamePkgx.map(m => m.hrmCategoryName),\r\n      },\r\n    });\r\n  }\r\n\r\n  // 5. Check if mapping to parent category when children exist\r\n  const pkgxChildren = context.pkgxCategories.filter(c => c.parentId === pkgxCat.id);\r\n  if (pkgxChildren.length > 0) {\r\n    warnings.push({\r\n      code: CATEGORY_MAPPING_WARNING_CODES.CHILD_ALREADY_MAPPED,\r\n      message: 'Danh mục PKGX này có danh mục con. Cân nhắc mapping với danh mục con cụ thể',\r\n      details: {\r\n        childCount: pkgxChildren.length,\r\n        children: pkgxChildren.slice(0, 5).map(c => c.name),\r\n      },\r\n    });\r\n  }\r\n\r\n  return warnings;\r\n}\r\n\r\n/**\r\n * Main validation function\r\n */\r\nexport function validateCategoryMapping(\r\n  input: CategoryMappingInput,\r\n  context: ValidationContext\r\n): ValidationResult {\r\n  const errors: ValidationError[] = [];\r\n  const warnings: ValidationWarning[] = [];\r\n\r\n  // 1. Required fields\r\n  errors.push(...validateRequiredFields(input));\r\n\r\n  // If required fields are missing, stop here\r\n  if (errors.length > 0) {\r\n    return { isValid: false, errors, warnings };\r\n  }\r\n\r\n  // 2. Category exists\r\n  errors.push(...validateCategoryExists(input, context));\r\n\r\n  // 3. Duplicate mappings\r\n  errors.push(...validateDuplicateMappings(input, context));\r\n\r\n  // 4. Warnings (non-blocking)\r\n  warnings.push(...checkWarnings(input, context));\r\n\r\n  return {\r\n    isValid: errors.length === 0,\r\n    errors,\r\n    warnings,\r\n  };\r\n}\r\n\r\n// ========================================\r\n// Utility Functions\r\n// ========================================\r\n\r\n/**\r\n * Normalize string for comparison\r\n */\r\nfunction normalizeString(str: string): string {\r\n  return str\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '') // Remove diacritics\r\n    .replace(/đ/g, 'd')\r\n    .replace(/[^a-z0-9\\s]/g, '')\r\n    .trim();\r\n}\r\n\r\n/**\r\n * Calculate string similarity (Jaccard index)\r\n */\r\nfunction calculateSimilarity(str1: string, str2: string): number {\r\n  const words1 = new Set(str1.split(/\\s+/).filter(w => w.length > 0));\r\n  const words2 = new Set(str2.split(/\\s+/).filter(w => w.length > 0));\r\n  \r\n  if (words1.size === 0 && words2.size === 0) return 1;\r\n  if (words1.size === 0 || words2.size === 0) return 0;\r\n  \r\n  const intersection = new Set([...words1].filter(x => words2.has(x)));\r\n  const union = new Set([...words1, ...words2]);\r\n  \r\n  return intersection.size / union.size;\r\n}\r\n\r\n/**\r\n * Suggest matching categories based on name\r\n */\r\nexport function suggestMatchingCategories(\r\n  hrmCategoryName: string,\r\n  pkgxCategories: PkgxCategory[],\r\n  limit = 5\r\n): Array<{ category: PkgxCategory; score: number }> {\r\n  const normalizedInput = normalizeString(hrmCategoryName);\r\n  \r\n  const scored = pkgxCategories.map(cat => ({\r\n    category: cat,\r\n    score: calculateSimilarity(normalizedInput, normalizeString(cat.name)),\r\n  }));\r\n  \r\n  return scored\r\n    .filter(s => s.score > 0.2)\r\n    .sort((a, b) => b.score - a.score)\r\n    .slice(0, limit);\r\n}\r\n\r\n/**\r\n * Find potential duplicate mappings\r\n */\r\nexport function findPotentialDuplicates(\r\n  mappings: PkgxCategoryMapping[]\r\n): Array<{ pkgxCatId: number; mappings: PkgxCategoryMapping[] }> {\r\n  const grouped = new Map<number, PkgxCategoryMapping[]>();\r\n  \r\n  for (const mapping of mappings) {\r\n    const existing = grouped.get(mapping.pkgxCatId) || [];\r\n    existing.push(mapping);\r\n    grouped.set(mapping.pkgxCatId, existing);\r\n  }\r\n  \r\n  return Array.from(grouped.entries())\r\n    .filter(([, mappings]) => mappings.length > 1)\r\n    .map(([pkgxCatId, mappings]) => ({ pkgxCatId, mappings }));\r\n}\r\n\r\n// ========================================\r\n// Batch Validation\r\n// ========================================\r\n\r\nexport interface BatchValidationResult {\r\n  valid: CategoryMappingInput[];\r\n  invalid: Array<{ input: CategoryMappingInput; errors: ValidationError[] }>;\r\n  withWarnings: Array<{ input: CategoryMappingInput; warnings: ValidationWarning[] }>;\r\n  summary: {\r\n    total: number;\r\n    validCount: number;\r\n    invalidCount: number;\r\n    warningCount: number;\r\n  };\r\n}\r\n\r\n/**\r\n * Validate multiple mappings at once\r\n */\r\nexport function validateBatchMappings(\r\n  inputs: CategoryMappingInput[],\r\n  context: ValidationContext\r\n): BatchValidationResult {\r\n  const valid: CategoryMappingInput[] = [];\r\n  const invalid: Array<{ input: CategoryMappingInput; errors: ValidationError[] }> = [];\r\n  const withWarnings: Array<{ input: CategoryMappingInput; warnings: ValidationWarning[] }> = [];\r\n\r\n  // Check for duplicates within the batch itself\r\n  const hrmIdsSeen = new Set<string>();\r\n  \r\n  for (const input of inputs) {\r\n    // Check batch internal duplicates\r\n    if (input.hrmCategorySystemId && hrmIdsSeen.has(input.hrmCategorySystemId)) {\r\n      invalid.push({\r\n        input,\r\n        errors: [{\r\n          code: CATEGORY_MAPPING_ERROR_CODES.HRM_CATEGORY_ALREADY_MAPPED,\r\n          field: 'hrmCategorySystemId',\r\n          message: 'Danh mục HRM này xuất hiện nhiều lần trong danh sách import',\r\n        }],\r\n      });\r\n      continue;\r\n    }\r\n    \r\n    if (input.hrmCategorySystemId) {\r\n      hrmIdsSeen.add(input.hrmCategorySystemId);\r\n    }\r\n    \r\n    const result = validateCategoryMapping(input, context);\r\n    \r\n    if (!result.isValid) {\r\n      invalid.push({ input, errors: result.errors });\r\n    } else {\r\n      valid.push(input);\r\n      if (result.warnings.length > 0) {\r\n        withWarnings.push({ input, warnings: result.warnings });\r\n      }\r\n    }\r\n  }\r\n\r\n  return {\r\n    valid,\r\n    invalid,\r\n    withWarnings,\r\n    summary: {\r\n      total: inputs.length,\r\n      validCount: valid.length,\r\n      invalidCount: invalid.length,\r\n      warningCount: withWarnings.length,\r\n    },\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2481, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/validation/brand-mapping-validation.ts"],"sourcesContent":["import type { SystemId } from '@/lib/id-types';\r\nimport type { PkgxBrandMapping, PkgxBrand } from '../types';\r\n\r\n// ========================================\r\n// Validation Types\r\n// ========================================\r\n\r\nexport interface BrandValidationResult {\r\n  isValid: boolean;\r\n  errors: BrandValidationError[];\r\n  warnings: BrandValidationWarning[];\r\n}\r\n\r\nexport interface BrandValidationError {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface BrandValidationWarning {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface BrandMappingInput {\r\n  hrmBrandSystemId: SystemId | string;\r\n  hrmBrandName: string;\r\n  pkgxBrandId: number | string;\r\n  pkgxBrandName: string;\r\n}\r\n\r\n// ========================================\r\n// Error Codes\r\n// ========================================\r\n\r\nexport const BRAND_MAPPING_ERROR_CODES = {\r\n  // Required field errors\r\n  HRM_BRAND_REQUIRED: 'HRM_BRAND_REQUIRED',\r\n  PKGX_BRAND_REQUIRED: 'PKGX_BRAND_REQUIRED',\r\n  \r\n  // Duplicate/conflict errors\r\n  HRM_BRAND_ALREADY_MAPPED: 'HRM_BRAND_ALREADY_MAPPED',\r\n  PKGX_BRAND_ALREADY_MAPPED: 'PKGX_BRAND_ALREADY_MAPPED',\r\n  \r\n  // Not found errors\r\n  HRM_BRAND_NOT_FOUND: 'HRM_BRAND_NOT_FOUND',\r\n  PKGX_BRAND_NOT_FOUND: 'PKGX_BRAND_NOT_FOUND',\r\n  \r\n  // Inactive/deleted errors\r\n  HRM_BRAND_INACTIVE: 'HRM_BRAND_INACTIVE',\r\n} as const;\r\n\r\nexport const BRAND_MAPPING_WARNING_CODES = {\r\n  // Suggestions\r\n  SAME_NAME_AVAILABLE: 'SAME_NAME_AVAILABLE',\r\n  NAME_MISMATCH: 'NAME_MISMATCH',\r\n  MANY_TO_ONE_MAPPING: 'MANY_TO_ONE_MAPPING',\r\n} as const;\r\n\r\n// ========================================\r\n// Error Messages (Vietnamese)\r\n// ========================================\r\n\r\nexport const BRAND_MAPPING_ERROR_MESSAGES: Record<string, string> = {\r\n  [BRAND_MAPPING_ERROR_CODES.HRM_BRAND_REQUIRED]: 'Vui lòng chọn thương hiệu HRM',\r\n  [BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_REQUIRED]: 'Vui lòng chọn thương hiệu PKGX',\r\n  [BRAND_MAPPING_ERROR_CODES.HRM_BRAND_ALREADY_MAPPED]: 'Thương hiệu HRM này đã được mapping với thương hiệu PKGX khác',\r\n  [BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_ALREADY_MAPPED]: 'Thương hiệu PKGX này đã được mapping với thương hiệu HRM khác',\r\n  [BRAND_MAPPING_ERROR_CODES.HRM_BRAND_NOT_FOUND]: 'Không tìm thấy thương hiệu HRM trong hệ thống',\r\n  [BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_NOT_FOUND]: 'Không tìm thấy thương hiệu PKGX (có thể đã bị xóa trên PKGX)',\r\n  [BRAND_MAPPING_ERROR_CODES.HRM_BRAND_INACTIVE]: 'Thương hiệu HRM đã bị vô hiệu hóa hoặc xóa',\r\n};\r\n\r\nexport const BRAND_MAPPING_WARNING_MESSAGES: Record<string, string> = {\r\n  [BRAND_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE]: 'Có thương hiệu PKGX trùng tên, có thể bạn muốn chọn thương hiệu đó',\r\n  [BRAND_MAPPING_WARNING_CODES.NAME_MISMATCH]: 'Tên thương hiệu HRM và PKGX khác nhau đáng kể',\r\n  [BRAND_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING]: 'Nhiều thương hiệu HRM đang mapping tới cùng một thương hiệu PKGX',\r\n};\r\n\r\n// ========================================\r\n// Validation Context\r\n// ========================================\r\n\r\nexport interface BrandValidationContext {\r\n  existingMappings: PkgxBrandMapping[];\r\n  hrmBrands: Array<{\r\n    systemId: SystemId;\r\n    name: string;\r\n    status?: string;\r\n    isActive?: boolean;\r\n  }>;\r\n  pkgxBrands: PkgxBrand[];\r\n  editingMappingId?: string;\r\n}\r\n\r\n// ========================================\r\n// Validation Functions\r\n// ========================================\r\n\r\n/**\r\n * Validate required fields\r\n */\r\nexport function validateRequiredFields(input: BrandMappingInput): BrandValidationError[] {\r\n  const errors: BrandValidationError[] = [];\r\n\r\n  if (!input.hrmBrandSystemId) {\r\n    errors.push({\r\n      code: BRAND_MAPPING_ERROR_CODES.HRM_BRAND_REQUIRED,\r\n      field: 'hrmBrandSystemId',\r\n      message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.HRM_BRAND_REQUIRED],\r\n    });\r\n  }\r\n\r\n  if (!input.pkgxBrandId) {\r\n    errors.push({\r\n      code: BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_REQUIRED,\r\n      field: 'pkgxBrandId',\r\n      message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_REQUIRED],\r\n    });\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate brand exists\r\n */\r\nexport function validateBrandExists(\r\n  input: BrandMappingInput,\r\n  context: BrandValidationContext\r\n): BrandValidationError[] {\r\n  const errors: BrandValidationError[] = [];\r\n\r\n  if (input.hrmBrandSystemId) {\r\n    const hrmBrand = context.hrmBrands.find(b => b.systemId === input.hrmBrandSystemId);\r\n    if (!hrmBrand) {\r\n      errors.push({\r\n        code: BRAND_MAPPING_ERROR_CODES.HRM_BRAND_NOT_FOUND,\r\n        field: 'hrmBrandSystemId',\r\n        message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.HRM_BRAND_NOT_FOUND],\r\n        details: { systemId: input.hrmBrandSystemId },\r\n      });\r\n    } else if (hrmBrand.status === 'inactive' || hrmBrand.isActive === false) {\r\n      errors.push({\r\n        code: BRAND_MAPPING_ERROR_CODES.HRM_BRAND_INACTIVE,\r\n        field: 'hrmBrandSystemId',\r\n        message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.HRM_BRAND_INACTIVE],\r\n        details: { systemId: input.hrmBrandSystemId, name: hrmBrand.name },\r\n      });\r\n    }\r\n  }\r\n\r\n  if (input.pkgxBrandId) {\r\n    const pkgxBrand = context.pkgxBrands.find(b => b.id === input.pkgxBrandId);\r\n    if (!pkgxBrand) {\r\n      errors.push({\r\n        code: BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_NOT_FOUND,\r\n        field: 'pkgxBrandId',\r\n        message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.PKGX_BRAND_NOT_FOUND],\r\n        details: { pkgxBrandId: input.pkgxBrandId },\r\n      });\r\n    }\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate duplicate mappings\r\n */\r\nexport function validateDuplicateMappings(\r\n  input: BrandMappingInput,\r\n  context: BrandValidationContext\r\n): BrandValidationError[] {\r\n  const errors: BrandValidationError[] = [];\r\n\r\n  if (input.hrmBrandSystemId) {\r\n    const existingHrmMapping = context.existingMappings.find(\r\n      m => m.hrmBrandSystemId === input.hrmBrandSystemId && m.id !== context.editingMappingId\r\n    );\r\n    if (existingHrmMapping) {\r\n      errors.push({\r\n        code: BRAND_MAPPING_ERROR_CODES.HRM_BRAND_ALREADY_MAPPED,\r\n        field: 'hrmBrandSystemId',\r\n        message: BRAND_MAPPING_ERROR_MESSAGES[BRAND_MAPPING_ERROR_CODES.HRM_BRAND_ALREADY_MAPPED],\r\n        details: {\r\n          existingMapping: existingHrmMapping,\r\n          mappedTo: existingHrmMapping.pkgxBrandName,\r\n        },\r\n      });\r\n    }\r\n  }\r\n  \r\n  return errors;\r\n}\r\n\r\n/**\r\n * Check for warnings (không block nhưng cảnh báo)\r\n */\r\nexport function checkWarnings(\r\n  input: BrandMappingInput,\r\n  context: BrandValidationContext\r\n): BrandValidationWarning[] {\r\n  const warnings: BrandValidationWarning[] = [];\r\n\r\n  if (!input.hrmBrandSystemId || !input.pkgxBrandId) {\r\n    return warnings;\r\n  }\r\n\r\n  const hrmBrand = context.hrmBrands.find(b => b.systemId === input.hrmBrandSystemId);\r\n  const pkgxBrand = context.pkgxBrands.find(b => b.id === input.pkgxBrandId);\r\n\r\n  if (!hrmBrand || !pkgxBrand) return warnings;\r\n\r\n  // 1. Check name mismatch\r\n  const normalizedHrmName = normalizeString(hrmBrand.name);\r\n  const normalizedPkgxName = normalizeString(pkgxBrand.name);\r\n  const similarity = calculateSimilarity(normalizedHrmName, normalizedPkgxName);\r\n  \r\n  if (similarity < 0.5) {\r\n    warnings.push({\r\n      code: BRAND_MAPPING_WARNING_CODES.NAME_MISMATCH,\r\n      message: BRAND_MAPPING_WARNING_MESSAGES[BRAND_MAPPING_WARNING_CODES.NAME_MISMATCH],\r\n      details: { \r\n        hrmName: hrmBrand.name, \r\n        pkgxName: pkgxBrand.name,\r\n        similarity: Math.round(similarity * 100) + '%',\r\n      },\r\n    });\r\n  }\r\n\r\n  // 2. Check if same name exists in PKGX\r\n  const sameNamePkgx = context.pkgxBrands.find(\r\n    b => b.id !== input.pkgxBrandId && normalizeString(b.name) === normalizedHrmName\r\n  );\r\n  if (sameNamePkgx) {\r\n    warnings.push({\r\n      code: BRAND_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE,\r\n      message: BRAND_MAPPING_WARNING_MESSAGES[BRAND_MAPPING_WARNING_CODES.SAME_NAME_AVAILABLE],\r\n      details: {\r\n        suggestedBrand: sameNamePkgx,\r\n      },\r\n    });\r\n  }\r\n\r\n  // 3. Check many-to-one mapping\r\n  const otherMappingsToSamePkgx = context.existingMappings.filter(\r\n    m => m.pkgxBrandId === input.pkgxBrandId && m.id !== context.editingMappingId\r\n  );\r\n  if (otherMappingsToSamePkgx.length > 0) {\r\n    warnings.push({\r\n      code: BRAND_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING,\r\n      message: BRAND_MAPPING_WARNING_MESSAGES[BRAND_MAPPING_WARNING_CODES.MANY_TO_ONE_MAPPING],\r\n      details: {\r\n        count: otherMappingsToSamePkgx.length + 1,\r\n        existingMappings: otherMappingsToSamePkgx.map(m => m.hrmBrandName),\r\n      },\r\n    });\r\n  }\r\n\r\n  return warnings;\r\n}\r\n\r\n/**\r\n * Main validation function\r\n */\r\nexport function validateBrandMapping(\r\n  input: BrandMappingInput,\r\n  context: BrandValidationContext\r\n): BrandValidationResult {\r\n  const errors: BrandValidationError[] = [];\r\n  const warnings: BrandValidationWarning[] = [];\r\n\r\n  // 1. Required fields\r\n  errors.push(...validateRequiredFields(input));\r\n\r\n  // If required fields are missing, stop here\r\n  if (errors.length > 0) {\r\n    return { isValid: false, errors, warnings };\r\n  }\r\n\r\n  // 2. Brand exists\r\n  errors.push(...validateBrandExists(input, context));\r\n\r\n  // 3. Duplicate mappings\r\n  errors.push(...validateDuplicateMappings(input, context));\r\n\r\n  // 4. Warnings (non-blocking)\r\n  warnings.push(...checkWarnings(input, context));\r\n\r\n  return {\r\n    isValid: errors.length === 0,\r\n    errors,\r\n    warnings,\r\n  };\r\n}\r\n\r\n// ========================================\r\n// Utility Functions\r\n// ========================================\r\n\r\n/**\r\n * Normalize string for comparison\r\n */\r\nfunction normalizeString(str: string): string {\r\n  return str\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '')\r\n    .replace(/đ/g, 'd')\r\n    .replace(/[^a-z0-9\\s]/g, '')\r\n    .trim();\r\n}\r\n\r\n/**\r\n * Calculate string similarity (Jaccard index)\r\n */\r\nfunction calculateSimilarity(str1: string, str2: string): number {\r\n  const words1 = new Set(str1.split(/\\s+/).filter(w => w.length > 0));\r\n  const words2 = new Set(str2.split(/\\s+/).filter(w => w.length > 0));\r\n  \r\n  if (words1.size === 0 && words2.size === 0) return 1;\r\n  if (words1.size === 0 || words2.size === 0) return 0;\r\n  \r\n  const intersection = new Set([...words1].filter(x => words2.has(x)));\r\n  const union = new Set([...words1, ...words2]);\r\n  \r\n  return intersection.size / union.size;\r\n}\r\n\r\n/**\r\n * Suggest matching brands based on name\r\n */\r\nexport function suggestMatchingBrands(\r\n  hrmBrandName: string,\r\n  pkgxBrands: PkgxBrand[],\r\n  limit = 5\r\n): Array<{ brand: PkgxBrand; score: number }> {\r\n  const normalizedInput = normalizeString(hrmBrandName);\r\n  \r\n  const scored = pkgxBrands.map(brand => ({\r\n    brand,\r\n    score: calculateSimilarity(normalizedInput, normalizeString(brand.name)),\r\n  }));\r\n  \r\n  return scored\r\n    .filter(s => s.score > 0.2)\r\n    .sort((a, b) => b.score - a.score)\r\n    .slice(0, limit);\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2721, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/validation/product-mapping-validation.ts"],"sourcesContent":["import type { SystemId } from '@/lib/id-types';\r\nimport type { PkgxProduct } from '../types';\r\n\r\n// ========================================\r\n// Validation Types\r\n// ========================================\r\n\r\nexport interface ProductValidationResult {\r\n  isValid: boolean;\r\n  errors: ProductValidationError[];\r\n  warnings: ProductValidationWarning[];\r\n}\r\n\r\nexport interface ProductValidationError {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface ProductValidationWarning {\r\n  code: string;\r\n  field?: string;\r\n  message: string;\r\n  details?: Record<string, any>;\r\n}\r\n\r\nexport interface ProductMappingInput {\r\n  hrmProductSystemId: SystemId | string;\r\n  hrmProductName: string;\r\n  hrmProductSku?: string;\r\n  pkgxProductId: number | string;\r\n  pkgxProductName: string;\r\n  pkgxProductSku?: string;\r\n}\r\n\r\n// ========================================\r\n// Error Codes\r\n// ========================================\r\n\r\nexport const PRODUCT_MAPPING_ERROR_CODES = {\r\n  // Required field errors\r\n  HRM_PRODUCT_REQUIRED: 'HRM_PRODUCT_REQUIRED',\r\n  PKGX_PRODUCT_REQUIRED: 'PKGX_PRODUCT_REQUIRED',\r\n  \r\n  // Duplicate/conflict errors\r\n  HRM_PRODUCT_ALREADY_LINKED: 'HRM_PRODUCT_ALREADY_LINKED',\r\n  PKGX_PRODUCT_ALREADY_LINKED: 'PKGX_PRODUCT_ALREADY_LINKED',\r\n  \r\n  // Not found errors\r\n  HRM_PRODUCT_NOT_FOUND: 'HRM_PRODUCT_NOT_FOUND',\r\n  PKGX_PRODUCT_NOT_FOUND: 'PKGX_PRODUCT_NOT_FOUND',\r\n  \r\n  // Inactive/deleted errors\r\n  HRM_PRODUCT_INACTIVE: 'HRM_PRODUCT_INACTIVE',\r\n} as const;\r\n\r\nexport const PRODUCT_MAPPING_WARNING_CODES = {\r\n  // Suggestions\r\n  SKU_MATCH_AVAILABLE: 'SKU_MATCH_AVAILABLE',\r\n  NAME_MISMATCH: 'NAME_MISMATCH',\r\n  SKU_MISMATCH: 'SKU_MISMATCH',\r\n} as const;\r\n\r\n// ========================================\r\n// Error Messages (Vietnamese)\r\n// ========================================\r\n\r\nexport const PRODUCT_MAPPING_ERROR_MESSAGES: Record<string, string> = {\r\n  [PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_REQUIRED]: 'Vui lòng chọn sản phẩm HRM',\r\n  [PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_REQUIRED]: 'Vui lòng chọn sản phẩm PKGX',\r\n  [PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_ALREADY_LINKED]: 'Sản phẩm HRM này đã được liên kết với sản phẩm PKGX khác',\r\n  [PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_ALREADY_LINKED]: 'Sản phẩm PKGX này đã được liên kết với sản phẩm HRM khác',\r\n  [PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_NOT_FOUND]: 'Không tìm thấy sản phẩm HRM trong hệ thống',\r\n  [PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_NOT_FOUND]: 'Không tìm thấy sản phẩm PKGX (có thể đã bị xóa trên PKGX)',\r\n  [PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_INACTIVE]: 'Sản phẩm HRM đã bị vô hiệu hóa hoặc xóa',\r\n};\r\n\r\nexport const PRODUCT_MAPPING_WARNING_MESSAGES: Record<string, string> = {\r\n  [PRODUCT_MAPPING_WARNING_CODES.SKU_MATCH_AVAILABLE]: 'Có sản phẩm HRM có SKU trùng khớp, có thể bạn muốn chọn sản phẩm đó',\r\n  [PRODUCT_MAPPING_WARNING_CODES.NAME_MISMATCH]: 'Tên sản phẩm HRM và PKGX khác nhau đáng kể',\r\n  [PRODUCT_MAPPING_WARNING_CODES.SKU_MISMATCH]: 'Mã SKU của sản phẩm HRM và PKGX không khớp',\r\n};\r\n\r\n// ========================================\r\n// Validation Context\r\n// ========================================\r\n\r\nexport interface ProductValidationContext {\r\n  hrmProducts: Array<{\r\n    systemId: SystemId;\r\n    name: string;\r\n    id: string; // SKU\r\n    pkgxId?: number;\r\n    status?: string;\r\n    isActive?: boolean;\r\n  }>;\r\n  pkgxProducts: PkgxProduct[];\r\n  editingProductId?: string; // HRM systemId đang edit\r\n}\r\n\r\n// ========================================\r\n// Validation Functions\r\n// ========================================\r\n\r\n/**\r\n * Validate required fields\r\n */\r\nexport function validateRequiredFields(input: ProductMappingInput): ProductValidationError[] {\r\n  const errors: ProductValidationError[] = [];\r\n\r\n  if (!input.hrmProductSystemId) {\r\n    errors.push({\r\n      code: PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_REQUIRED,\r\n      field: 'hrmProductSystemId',\r\n      message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_REQUIRED],\r\n    });\r\n  }\r\n\r\n  if (!input.pkgxProductId) {\r\n    errors.push({\r\n      code: PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_REQUIRED,\r\n      field: 'pkgxProductId',\r\n      message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_REQUIRED],\r\n    });\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate product exists\r\n */\r\nexport function validateProductExists(\r\n  input: ProductMappingInput,\r\n  context: ProductValidationContext\r\n): ProductValidationError[] {\r\n  const errors: ProductValidationError[] = [];\r\n\r\n  if (input.hrmProductSystemId) {\r\n    const hrmProduct = context.hrmProducts.find(p => p.systemId === input.hrmProductSystemId);\r\n    if (!hrmProduct) {\r\n      errors.push({\r\n        code: PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_NOT_FOUND,\r\n        field: 'hrmProductSystemId',\r\n        message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_NOT_FOUND],\r\n        details: { systemId: input.hrmProductSystemId },\r\n      });\r\n    } else if (hrmProduct.status === 'inactive' || hrmProduct.isActive === false) {\r\n      errors.push({\r\n        code: PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_INACTIVE,\r\n        field: 'hrmProductSystemId',\r\n        message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_INACTIVE],\r\n        details: { systemId: input.hrmProductSystemId, name: hrmProduct.name },\r\n      });\r\n    }\r\n  }\r\n\r\n  if (input.pkgxProductId) {\r\n    const pkgxProduct = context.pkgxProducts.find(p => p.goods_id === input.pkgxProductId);\r\n    if (!pkgxProduct) {\r\n      errors.push({\r\n        code: PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_NOT_FOUND,\r\n        field: 'pkgxProductId',\r\n        message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_NOT_FOUND],\r\n        details: { pkgxProductId: input.pkgxProductId },\r\n      });\r\n    }\r\n  }\r\n\r\n  return errors;\r\n}\r\n\r\n/**\r\n * Validate duplicate links\r\n */\r\nexport function validateDuplicateLinks(\r\n  input: ProductMappingInput,\r\n  context: ProductValidationContext\r\n): ProductValidationError[] {\r\n  const errors: ProductValidationError[] = [];\r\n\r\n  if (input.hrmProductSystemId) {\r\n    const hrmProduct = context.hrmProducts.find(p => p.systemId === input.hrmProductSystemId);\r\n    // Check if HRM product already linked to another PKGX product\r\n    if (hrmProduct?.pkgxId && hrmProduct.pkgxId !== input.pkgxProductId && hrmProduct.systemId !== context.editingProductId) {\r\n      errors.push({\r\n        code: PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_ALREADY_LINKED,\r\n        field: 'hrmProductSystemId',\r\n        message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.HRM_PRODUCT_ALREADY_LINKED],\r\n        details: {\r\n          linkedTo: hrmProduct.pkgxId,\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  if (input.pkgxProductId) {\r\n    // Check if PKGX product already linked to another HRM product\r\n    const linkedHrmProduct = context.hrmProducts.find(\r\n      p => p.pkgxId === input.pkgxProductId && p.systemId !== input.hrmProductSystemId\r\n    );\r\n    if (linkedHrmProduct) {\r\n      errors.push({\r\n        code: PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_ALREADY_LINKED,\r\n        field: 'pkgxProductId',\r\n        message: PRODUCT_MAPPING_ERROR_MESSAGES[PRODUCT_MAPPING_ERROR_CODES.PKGX_PRODUCT_ALREADY_LINKED],\r\n        details: {\r\n          linkedTo: linkedHrmProduct.name,\r\n          linkedSystemId: linkedHrmProduct.systemId,\r\n        },\r\n      });\r\n    }\r\n  }\r\n  \r\n  return errors;\r\n}\r\n\r\n/**\r\n * Check for warnings (không block nhưng cảnh báo)\r\n */\r\nexport function checkWarnings(\r\n  input: ProductMappingInput,\r\n  context: ProductValidationContext\r\n): ProductValidationWarning[] {\r\n  const warnings: ProductValidationWarning[] = [];\r\n\r\n  if (!input.hrmProductSystemId || !input.pkgxProductId) {\r\n    return warnings;\r\n  }\r\n\r\n  const hrmProduct = context.hrmProducts.find(p => p.systemId === input.hrmProductSystemId);\r\n  const pkgxProduct = context.pkgxProducts.find(p => p.goods_id === input.pkgxProductId);\r\n\r\n  if (!hrmProduct || !pkgxProduct) return warnings;\r\n\r\n  // 1. Check name mismatch\r\n  const normalizedHrmName = normalizeString(hrmProduct.name);\r\n  const normalizedPkgxName = normalizeString(pkgxProduct.goods_name);\r\n  const similarity = calculateSimilarity(normalizedHrmName, normalizedPkgxName);\r\n  \r\n  if (similarity < 0.3) {\r\n    warnings.push({\r\n      code: PRODUCT_MAPPING_WARNING_CODES.NAME_MISMATCH,\r\n      message: PRODUCT_MAPPING_WARNING_MESSAGES[PRODUCT_MAPPING_WARNING_CODES.NAME_MISMATCH],\r\n      details: { \r\n        hrmName: hrmProduct.name, \r\n        pkgxName: pkgxProduct.goods_name,\r\n        similarity: Math.round(similarity * 100) + '%',\r\n      },\r\n    });\r\n  }\r\n\r\n  // 2. Check SKU mismatch\r\n  if (hrmProduct.id && pkgxProduct.goods_sn && hrmProduct.id !== pkgxProduct.goods_sn) {\r\n    warnings.push({\r\n      code: PRODUCT_MAPPING_WARNING_CODES.SKU_MISMATCH,\r\n      message: PRODUCT_MAPPING_WARNING_MESSAGES[PRODUCT_MAPPING_WARNING_CODES.SKU_MISMATCH],\r\n      details: {\r\n        hrmSku: hrmProduct.id,\r\n        pkgxSku: pkgxProduct.goods_sn,\r\n      },\r\n    });\r\n  }\r\n\r\n  return warnings;\r\n}\r\n\r\n/**\r\n * Main validation function\r\n */\r\nexport function validateProductMapping(\r\n  input: ProductMappingInput,\r\n  context: ProductValidationContext\r\n): ProductValidationResult {\r\n  const errors: ProductValidationError[] = [];\r\n  const warnings: ProductValidationWarning[] = [];\r\n\r\n  // 1. Required fields\r\n  errors.push(...validateRequiredFields(input));\r\n\r\n  // If required fields are missing, stop here\r\n  if (errors.length > 0) {\r\n    return { isValid: false, errors, warnings };\r\n  }\r\n\r\n  // 2. Product exists\r\n  errors.push(...validateProductExists(input, context));\r\n\r\n  // 3. Duplicate links\r\n  errors.push(...validateDuplicateLinks(input, context));\r\n\r\n  // 4. Warnings (non-blocking)\r\n  warnings.push(...checkWarnings(input, context));\r\n\r\n  return {\r\n    isValid: errors.length === 0,\r\n    errors,\r\n    warnings,\r\n  };\r\n}\r\n\r\n// ========================================\r\n// Utility Functions\r\n// ========================================\r\n\r\n/**\r\n * Normalize string for comparison\r\n */\r\nfunction normalizeString(str: string): string {\r\n  return str\r\n    .toLowerCase()\r\n    .normalize('NFD')\r\n    .replace(/[\\u0300-\\u036f]/g, '')\r\n    .replace(/đ/g, 'd')\r\n    .replace(/[^a-z0-9\\s]/g, '')\r\n    .trim();\r\n}\r\n\r\n/**\r\n * Calculate string similarity (Jaccard index)\r\n */\r\nfunction calculateSimilarity(str1: string, str2: string): number {\r\n  const words1 = new Set(str1.split(/\\s+/).filter(w => w.length > 0));\r\n  const words2 = new Set(str2.split(/\\s+/).filter(w => w.length > 0));\r\n  \r\n  if (words1.size === 0 && words2.size === 0) return 1;\r\n  if (words1.size === 0 || words2.size === 0) return 0;\r\n  \r\n  const intersection = new Set([...words1].filter(x => words2.has(x)));\r\n  const union = new Set([...words1, ...words2]);\r\n  \r\n  return intersection.size / union.size;\r\n}\r\n\r\n/**\r\n * Suggest matching HRM products based on PKGX product name/SKU\r\n */\r\nexport function suggestMatchingProducts(\r\n  pkgxProduct: { goods_name: string; goods_sn?: string },\r\n  hrmProducts: Array<{ systemId: SystemId; name: string; id: string; pkgxId?: number }>,\r\n  limit = 5\r\n): Array<{ product: typeof hrmProducts[0]; score: number; matchType: 'sku' | 'name' }> {\r\n  const results: Array<{ product: typeof hrmProducts[0]; score: number; matchType: 'sku' | 'name' }> = [];\r\n  \r\n  // Filter out already linked products\r\n  const availableProducts = hrmProducts.filter(p => !p.pkgxId);\r\n  \r\n  // 1. SKU exact match (highest priority)\r\n  if (pkgxProduct.goods_sn) {\r\n    const skuMatch = availableProducts.find(p => p.id === pkgxProduct.goods_sn);\r\n    if (skuMatch) {\r\n      results.push({ product: skuMatch, score: 1, matchType: 'sku' });\r\n    }\r\n  }\r\n  \r\n  // 2. Name similarity\r\n  const normalizedPkgxName = normalizeString(pkgxProduct.goods_name);\r\n  \r\n  const scored = availableProducts\r\n    .filter(p => !results.some(r => r.product.systemId === p.systemId))\r\n    .map(product => ({\r\n      product,\r\n      score: calculateSimilarity(normalizedPkgxName, normalizeString(product.name)),\r\n      matchType: 'name' as const,\r\n    }))\r\n    .filter(s => s.score > 0.2);\r\n  \r\n  results.push(...scored);\r\n  \r\n  return results\r\n    .sort((a, b) => b.score - a.score)\r\n    .slice(0, limit);\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2981, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/validation/index.ts"],"sourcesContent":["// Category Mapping Validation\r\nexport {\r\n  // Types\r\n  type ValidationResult,\r\n  type ValidationError,\r\n  type ValidationWarning,\r\n  type CategoryMappingInput,\r\n  type ValidationContext,\r\n  type BatchValidationResult,\r\n  \r\n  // Error/Warning codes\r\n  CATEGORY_MAPPING_ERROR_CODES,\r\n  CATEGORY_MAPPING_WARNING_CODES,\r\n  CATEGORY_MAPPING_ERROR_MESSAGES,\r\n  CATEGORY_MAPPING_WARNING_MESSAGES,\r\n  \r\n  // Validation functions\r\n  validateCategoryMapping,\r\n  validateRequiredFields,\r\n  validateCategoryExists,\r\n  validateDuplicateMappings,\r\n  checkWarnings,\r\n  validateBatchMappings,\r\n  \r\n  // Utilities\r\n  suggestMatchingCategories,\r\n  findPotentialDuplicates,\r\n} from './category-mapping-validation';\r\n\r\n// Brand Mapping Validation\r\nexport {\r\n  // Types\r\n  type BrandValidationResult,\r\n  type BrandValidationError,\r\n  type BrandValidationWarning,\r\n  type BrandMappingInput,\r\n  type BrandValidationContext,\r\n  \r\n  // Error/Warning codes\r\n  BRAND_MAPPING_ERROR_CODES,\r\n  BRAND_MAPPING_WARNING_CODES,\r\n  BRAND_MAPPING_ERROR_MESSAGES,\r\n  BRAND_MAPPING_WARNING_MESSAGES,\r\n  \r\n  // Validation functions\r\n  validateBrandMapping,\r\n  validateRequiredFields as validateBrandRequiredFields,\r\n  validateBrandExists,\r\n  validateDuplicateMappings as validateBrandDuplicateMappings,\r\n  checkWarnings as checkBrandWarnings,\r\n  \r\n  // Utilities\r\n  suggestMatchingBrands,\r\n} from './brand-mapping-validation';\r\n\r\n// Product Mapping Validation\r\nexport {\r\n  // Types\r\n  type ProductValidationResult,\r\n  type ProductValidationError,\r\n  type ProductValidationWarning,\r\n  type ProductMappingInput,\r\n  type ProductValidationContext,\r\n  \r\n  // Error/Warning codes\r\n  PRODUCT_MAPPING_ERROR_CODES,\r\n  PRODUCT_MAPPING_WARNING_CODES,\r\n  PRODUCT_MAPPING_ERROR_MESSAGES,\r\n  PRODUCT_MAPPING_WARNING_MESSAGES,\r\n  \r\n  // Validation functions\r\n  validateProductMapping,\r\n  validateRequiredFields as validateProductRequiredFields,\r\n  validateProductExists,\r\n  validateDuplicateLinks,\r\n  checkWarnings as checkProductWarnings,\r\n  \r\n  // Utilities\r\n  suggestMatchingProducts,\r\n} from './product-mapping-validation';\r\n"],"names":[],"mappings":";AAAA,8BAA8B;AAC9B;AA4BA,2BAA2B;AAC3B;AAyBA,6BAA6B;AAC7B"}},
    {"offset": {"line": 2995, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/hooks/use-category-mapping-validation.ts"],"sourcesContent":["import * as React from 'react';\r\nimport type { SystemId } from '@/lib/id-types';\r\nimport type { PkgxCategoryMapping, PkgxCategory } from '../types';\r\nimport {\r\n  validateCategoryMapping,\r\n  suggestMatchingCategories,\r\n  type ValidationResult,\r\n  type ValidationContext,\r\n  type CategoryMappingInput,\r\n} from '../validation';\r\n\r\ninterface UseCategoryMappingValidationOptions {\r\n  existingMappings: PkgxCategoryMapping[];\r\n  hrmCategories: Array<{\r\n    systemId: SystemId;\r\n    name: string;\r\n    parentId?: SystemId;\r\n    status?: string;\r\n    isActive?: boolean;\r\n    path?: string;\r\n  }>;\r\n  pkgxCategories: PkgxCategory[];\r\n  editingMappingId?: string;\r\n  debounceMs?: number;\r\n}\r\n\r\ninterface UseCategoryMappingValidationReturn {\r\n  // Validation state\r\n  validationResult: ValidationResult | null;\r\n  isValidating: boolean;\r\n  \r\n  // Suggestions\r\n  suggestions: Array<{ category: PkgxCategory; score: number }>;\r\n  \r\n  // Actions\r\n  validate: (input: CategoryMappingInput) => ValidationResult;\r\n  validateAsync: (input: CategoryMappingInput) => Promise<ValidationResult>;\r\n  clearValidation: () => void;\r\n  \r\n  // Helpers\r\n  hasErrors: boolean;\r\n  hasWarnings: boolean;\r\n  getFieldError: (field: string) => string | undefined;\r\n  getFieldWarning: (field: string) => string | undefined;\r\n}\r\n\r\n/**\r\n * Hook để quản lý validation cho category mapping\r\n */\r\nexport function useCategoryMappingValidation(\r\n  options: UseCategoryMappingValidationOptions\r\n): UseCategoryMappingValidationReturn {\r\n  const {\r\n    existingMappings,\r\n    hrmCategories,\r\n    pkgxCategories,\r\n    editingMappingId,\r\n    debounceMs = 300,\r\n  } = options;\r\n\r\n  const [validationResult, setValidationResult] = React.useState<ValidationResult | null>(null);\r\n  const [isValidating, setIsValidating] = React.useState(false);\r\n  const [suggestions, setSuggestions] = React.useState<Array<{ category: PkgxCategory; score: number }>>([]);\r\n  \r\n  const debounceTimerRef = React.useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Create validation context\r\n  const context = React.useMemo((): ValidationContext => ({\r\n    existingMappings,\r\n    hrmCategories,\r\n    pkgxCategories,\r\n    editingMappingId,\r\n  }), [existingMappings, hrmCategories, pkgxCategories, editingMappingId]);\r\n\r\n  // Sync validation\r\n  const validate = React.useCallback((input: CategoryMappingInput): ValidationResult => {\r\n    const result = validateCategoryMapping(input, context);\r\n    setValidationResult(result);\r\n    \r\n    // Update suggestions based on HRM category name\r\n    if (input.hrmCategorySystemId) {\r\n      const hrmCat = hrmCategories.find(c => c.systemId === input.hrmCategorySystemId);\r\n      if (hrmCat) {\r\n        const newSuggestions = suggestMatchingCategories(hrmCat.name, pkgxCategories);\r\n        setSuggestions(newSuggestions);\r\n      }\r\n    }\r\n    \r\n    return result;\r\n  }, [context, hrmCategories, pkgxCategories]);\r\n\r\n  // Async validation with debounce\r\n  const validateAsync = React.useCallback(async (input: CategoryMappingInput): Promise<ValidationResult> => {\r\n    return new Promise((resolve) => {\r\n      setIsValidating(true);\r\n      \r\n      if (debounceTimerRef.current) {\r\n        clearTimeout(debounceTimerRef.current);\r\n      }\r\n      \r\n      debounceTimerRef.current = setTimeout(() => {\r\n        const result = validate(input);\r\n        setIsValidating(false);\r\n        resolve(result);\r\n      }, debounceMs);\r\n    });\r\n  }, [validate, debounceMs]);\r\n\r\n  // Clear validation\r\n  const clearValidation = React.useCallback(() => {\r\n    setValidationResult(null);\r\n    setSuggestions([]);\r\n    if (debounceTimerRef.current) {\r\n      clearTimeout(debounceTimerRef.current);\r\n    }\r\n  }, []);\r\n\r\n  // Cleanup on unmount\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (debounceTimerRef.current) {\r\n        clearTimeout(debounceTimerRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Computed values\r\n  const hasErrors = validationResult ? validationResult.errors.length > 0 : false;\r\n  const hasWarnings = validationResult ? validationResult.warnings.length > 0 : false;\r\n\r\n  const getFieldError = React.useCallback((field: string): string | undefined => {\r\n    if (!validationResult) return undefined;\r\n    const error = validationResult.errors.find(e => e.field === field);\r\n    return error?.message;\r\n  }, [validationResult]);\r\n\r\n  const getFieldWarning = React.useCallback((field: string): string | undefined => {\r\n    if (!validationResult) return undefined;\r\n    const warning = validationResult.warnings.find(w => w.field === field);\r\n    return warning?.message;\r\n  }, [validationResult]);\r\n\r\n  return {\r\n    validationResult,\r\n    isValidating,\r\n    suggestions,\r\n    validate,\r\n    validateAsync,\r\n    clearValidation,\r\n    hasErrors,\r\n    hasWarnings,\r\n    getFieldError,\r\n    getFieldWarning,\r\n  };\r\n}\r\n\r\n/**\r\n * Hook đơn giản để validate một field\r\n */\r\nexport function useFieldValidation<T>(\r\n  validator: (value: T) => string | undefined,\r\n  initialValue?: T\r\n) {\r\n  const [error, setError] = React.useState<string | undefined>();\r\n  const [touched, setTouched] = React.useState(false);\r\n\r\n  const validate = React.useCallback((value: T) => {\r\n    const errorMessage = validator(value);\r\n    setError(errorMessage);\r\n    return !errorMessage;\r\n  }, [validator]);\r\n\r\n  const handleBlur = React.useCallback(() => {\r\n    setTouched(true);\r\n  }, []);\r\n\r\n  const reset = React.useCallback(() => {\r\n    setError(undefined);\r\n    setTouched(false);\r\n  }, []);\r\n\r\n  // Validate initial value\r\n  React.useEffect(() => {\r\n    if (initialValue !== undefined) {\r\n      validate(initialValue);\r\n    }\r\n  }, []);\r\n\r\n  return {\r\n    error: touched ? error : undefined,\r\n    touched,\r\n    validate,\r\n    handleBlur,\r\n    reset,\r\n    isValid: !error,\r\n  };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3141, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/hooks/use-brand-mapping-validation.ts"],"sourcesContent":["import * as React from 'react';\r\nimport type { SystemId } from '@/lib/id-types';\r\nimport type { PkgxBrandMapping, PkgxBrand } from '../types';\r\nimport {\r\n  validateBrandMapping,\r\n  suggestMatchingBrands,\r\n  type BrandValidationResult,\r\n  type BrandValidationContext,\r\n  type BrandMappingInput,\r\n} from '../validation';\r\n\r\ninterface UseBrandMappingValidationOptions {\r\n  existingMappings: PkgxBrandMapping[];\r\n  hrmBrands: Array<{\r\n    systemId: SystemId;\r\n    name: string;\r\n    status?: string;\r\n    isActive?: boolean;\r\n  }>;\r\n  pkgxBrands: PkgxBrand[];\r\n  editingMappingId?: string;\r\n  debounceMs?: number;\r\n}\r\n\r\ninterface UseBrandMappingValidationReturn {\r\n  // Validation state\r\n  validationResult: BrandValidationResult | null;\r\n  isValidating: boolean;\r\n  \r\n  // Suggestions\r\n  suggestions: Array<{ brand: PkgxBrand; score: number }>;\r\n  \r\n  // Actions\r\n  validate: (input: BrandMappingInput) => BrandValidationResult;\r\n  validateAsync: (input: BrandMappingInput) => Promise<BrandValidationResult>;\r\n  clearValidation: () => void;\r\n  \r\n  // Helpers\r\n  hasErrors: boolean;\r\n  hasWarnings: boolean;\r\n  getFieldError: (field: string) => string | undefined;\r\n  getFieldWarning: (field: string) => string | undefined;\r\n}\r\n\r\n/**\r\n * Hook để quản lý validation cho brand mapping\r\n */\r\nexport function useBrandMappingValidation(\r\n  options: UseBrandMappingValidationOptions\r\n): UseBrandMappingValidationReturn {\r\n  const {\r\n    existingMappings,\r\n    hrmBrands,\r\n    pkgxBrands,\r\n    editingMappingId,\r\n    debounceMs = 300,\r\n  } = options;\r\n\r\n  const [validationResult, setValidationResult] = React.useState<BrandValidationResult | null>(null);\r\n  const [isValidating, setIsValidating] = React.useState(false);\r\n  const [suggestions, setSuggestions] = React.useState<Array<{ brand: PkgxBrand; score: number }>>([]);\r\n  \r\n  const debounceTimerRef = React.useRef<NodeJS.Timeout | null>(null);\r\n\r\n  // Create validation context\r\n  const context = React.useMemo((): BrandValidationContext => ({\r\n    existingMappings,\r\n    hrmBrands,\r\n    pkgxBrands,\r\n    editingMappingId,\r\n  }), [existingMappings, hrmBrands, pkgxBrands, editingMappingId]);\r\n\r\n  // Sync validation\r\n  const validate = React.useCallback((input: BrandMappingInput): BrandValidationResult => {\r\n    const result = validateBrandMapping(input, context);\r\n    setValidationResult(result);\r\n    \r\n    // Update suggestions based on HRM brand name\r\n    if (input.hrmBrandSystemId) {\r\n      const hrmBrand = hrmBrands.find(b => b.systemId === input.hrmBrandSystemId);\r\n      if (hrmBrand) {\r\n        const newSuggestions = suggestMatchingBrands(hrmBrand.name, pkgxBrands);\r\n        setSuggestions(newSuggestions);\r\n      }\r\n    }\r\n    \r\n    return result;\r\n  }, [context, hrmBrands, pkgxBrands]);\r\n\r\n  // Async validation with debounce\r\n  const validateAsync = React.useCallback(async (input: BrandMappingInput): Promise<BrandValidationResult> => {\r\n    return new Promise((resolve) => {\r\n      setIsValidating(true);\r\n      \r\n      if (debounceTimerRef.current) {\r\n        clearTimeout(debounceTimerRef.current);\r\n      }\r\n      \r\n      debounceTimerRef.current = setTimeout(() => {\r\n        const result = validate(input);\r\n        setIsValidating(false);\r\n        resolve(result);\r\n      }, debounceMs);\r\n    });\r\n  }, [validate, debounceMs]);\r\n\r\n  // Clear validation\r\n  const clearValidation = React.useCallback(() => {\r\n    setValidationResult(null);\r\n    setSuggestions([]);\r\n    if (debounceTimerRef.current) {\r\n      clearTimeout(debounceTimerRef.current);\r\n    }\r\n  }, []);\r\n\r\n  // Cleanup on unmount\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (debounceTimerRef.current) {\r\n        clearTimeout(debounceTimerRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Computed values\r\n  const hasErrors = validationResult ? validationResult.errors.length > 0 : false;\r\n  const hasWarnings = validationResult ? validationResult.warnings.length > 0 : false;\r\n\r\n  const getFieldError = React.useCallback((field: string): string | undefined => {\r\n    if (!validationResult) return undefined;\r\n    const error = validationResult.errors.find(e => e.field === field);\r\n    return error?.message;\r\n  }, [validationResult]);\r\n\r\n  const getFieldWarning = React.useCallback((field: string): string | undefined => {\r\n    if (!validationResult) return undefined;\r\n    const warning = validationResult.warnings.find(w => w.field === field);\r\n    return warning?.message;\r\n  }, [validationResult]);\r\n\r\n  return {\r\n    validationResult,\r\n    isValidating,\r\n    suggestions,\r\n    validate,\r\n    validateAsync,\r\n    clearValidation,\r\n    hasErrors,\r\n    hasWarnings,\r\n    getFieldError,\r\n    getFieldWarning,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAGA;AAAA;;;AA4CO,SAAS,0BACd,OAAyC;IAEzC,MAAM,EACJ,gBAAgB,EAChB,SAAS,EACT,UAAU,EACV,gBAAgB,EAChB,aAAa,GAAG,EACjB,GAAG;IAEJ,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,iNAAc,CAA+B;IAC7F,MAAM,CAAC,cAAc,gBAAgB,GAAG,iNAAc,CAAC;IACvD,MAAM,CAAC,aAAa,eAAe,GAAG,iNAAc,CAA6C,EAAE;IAEnG,MAAM,mBAAmB,+MAAY,CAAwB;IAE7D,4BAA4B;IAC5B,MAAM,UAAU,gNAAa,CAAC,IAA8B,CAAC;YAC3D;YACA;YACA;YACA;QACF,CAAC,GAAG;QAAC;QAAkB;QAAW;QAAY;KAAiB;IAE/D,kBAAkB;IAClB,MAAM,WAAW,oNAAiB,CAAC,CAAC;QAClC,MAAM,SAAS,IAAA,oMAAoB,EAAC,OAAO;QAC3C,oBAAoB;QAEpB,6CAA6C;QAC7C,IAAI,MAAM,gBAAgB,EAAE;YAC1B,MAAM,WAAW,UAAU,IAAI,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK,MAAM,gBAAgB;YAC1E,IAAI,UAAU;gBACZ,MAAM,iBAAiB,IAAA,qMAAqB,EAAC,SAAS,IAAI,EAAE;gBAC5D,eAAe;YACjB;QACF;QAEA,OAAO;IACT,GAAG;QAAC;QAAS;QAAW;KAAW;IAEnC,iCAAiC;IACjC,MAAM,gBAAgB,oNAAiB,CAAC,OAAO;QAC7C,OAAO,IAAI,QAAQ,CAAC;YAClB,gBAAgB;YAEhB,IAAI,iBAAiB,OAAO,EAAE;gBAC5B,aAAa,iBAAiB,OAAO;YACvC;YAEA,iBAAiB,OAAO,GAAG,WAAW;gBACpC,MAAM,SAAS,SAAS;gBACxB,gBAAgB;gBAChB,QAAQ;YACV,GAAG;QACL;IACF,GAAG;QAAC;QAAU;KAAW;IAEzB,mBAAmB;IACnB,MAAM,kBAAkB,oNAAiB,CAAC;QACxC,oBAAoB;QACpB,eAAe,EAAE;QACjB,IAAI,iBAAiB,OAAO,EAAE;YAC5B,aAAa,iBAAiB,OAAO;QACvC;IACF,GAAG,EAAE;IAEL,qBAAqB;IACrB,kNAAe,CAAC;QACd,OAAO;YACL,IAAI,iBAAiB,OAAO,EAAE;gBAC5B,aAAa,iBAAiB,OAAO;YACvC;QACF;IACF,GAAG,EAAE;IAEL,kBAAkB;IAClB,MAAM,YAAY,mBAAmB,iBAAiB,MAAM,CAAC,MAAM,GAAG,IAAI;IAC1E,MAAM,cAAc,mBAAmB,iBAAiB,QAAQ,CAAC,MAAM,GAAG,IAAI;IAE9E,MAAM,gBAAgB,oNAAiB,CAAC,CAAC;QACvC,IAAI,CAAC,kBAAkB,OAAO;QAC9B,MAAM,QAAQ,iBAAiB,MAAM,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK;QAC5D,OAAO,OAAO;IAChB,GAAG;QAAC;KAAiB;IAErB,MAAM,kBAAkB,oNAAiB,CAAC,CAAC;QACzC,IAAI,CAAC,kBAAkB,OAAO;QAC9B,MAAM,UAAU,iBAAiB,QAAQ,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK;QAChE,OAAO,SAAS;IAClB,GAAG;QAAC;KAAiB;IAErB,OAAO;QACL;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;IACF;AACF"}},
    {"offset": {"line": 3253, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/hooks/use-pkgx-entity-sync.ts"],"sourcesContent":["import * as React from 'react';\r\nimport { toast } from 'sonner';\r\nimport { RefreshCw, Search, AlignLeft, Globe, FolderEdit, DollarSign, Package, Tag, FileText } from 'lucide-react';\r\nimport { updateCategory, updateCategoryBasic, updateBrand, updateProduct as updatePkgxProduct } from '../../../../lib/pkgx/api-service';\r\nimport type { LucideIcon } from 'lucide-react';\r\n\r\n// ========================================\r\n// Types\r\n// ========================================\r\n\r\nexport type PkgxEntityType = 'category' | 'brand' | 'product';\r\n\r\nexport type SyncActionKey = \r\n  | 'sync_all' \r\n  | 'sync_basic' \r\n  | 'sync_seo' \r\n  | 'sync_description'\r\n  | 'sync_price'\r\n  | 'sync_inventory'\r\n  | 'sync_flags';\r\n\r\nexport interface SyncAction {\r\n  key: SyncActionKey;\r\n  label: string;\r\n  icon: LucideIcon;\r\n  title: string;\r\n  description: (name: string) => string;\r\n  confirmTitle: string;\r\n  confirmDescription: (name: string) => string;\r\n  /** Which entity types support this action */\r\n  supportedEntities: PkgxEntityType[];\r\n  /** Is this the primary action (shown with separator and bold) */\r\n  isPrimary?: boolean;\r\n}\r\n\r\nexport interface HrmCategoryData {\r\n  systemId: string;\r\n  name: string;\r\n  isActive?: boolean;\r\n  seoKeywords?: string;\r\n  seoTitle?: string;\r\n  metaDescription?: string;\r\n  shortDescription?: string;\r\n  longDescription?: string;\r\n  websiteSeo?: {\r\n    pkgx?: {\r\n      seoKeywords?: string;\r\n      seoTitle?: string;\r\n      metaDescription?: string;\r\n      shortDescription?: string;\r\n      longDescription?: string;\r\n    };\r\n  };\r\n}\r\n\r\nexport interface HrmBrandData {\r\n  systemId: string;\r\n  name: string;\r\n  website?: string;\r\n  seoKeywords?: string;\r\n  seoTitle?: string;\r\n  metaDescription?: string;\r\n  shortDescription?: string;\r\n  longDescription?: string;\r\n  websiteSeo?: {\r\n    pkgx?: {\r\n      seoKeywords?: string;\r\n      seoTitle?: string;\r\n      metaDescription?: string;\r\n      shortDescription?: string;\r\n      longDescription?: string;\r\n    };\r\n  };\r\n}\r\n\r\nexport interface HrmProductData {\r\n  systemId: string;\r\n  name: string;\r\n  sku?: string;\r\n  sellingPrice?: number;\r\n  costPrice?: number;\r\n  dealPrice?: number;\r\n  quantity?: number;\r\n  seoKeywords?: string;\r\n  ktitle?: string;\r\n  seoDescription?: string;\r\n  shortDescription?: string;\r\n  description?: string;\r\n  isBest?: boolean;\r\n  isNew?: boolean;\r\n  isHot?: boolean;\r\n  isHome?: boolean;\r\n  categorySystemId?: string;\r\n  brandSystemId?: string;\r\n}\r\n\r\nexport interface ConfirmActionState {\r\n  open: boolean;\r\n  title: string;\r\n  description: string;\r\n  action: (() => void) | null;\r\n}\r\n\r\nexport type PkgxSyncLogAction = \r\n  | 'test_connection'\r\n  | 'ping'\r\n  | 'sync_all'\r\n  | 'sync_price'\r\n  | 'sync_inventory'\r\n  | 'sync_seo'\r\n  | 'create_product'\r\n  | 'update_product'\r\n  | 'link_product'\r\n  | 'unlink_product'\r\n  | 'unlink_mapping'\r\n  | 'sync_categories'\r\n  | 'sync_brands'\r\n  | 'get_products'\r\n  | 'upload_image'\r\n  | 'save_config'\r\n  | 'save_mapping';\r\n\r\n// Helper to map SyncActionKey to PkgxSyncLogAction\r\nconst mapActionKeyToLogAction = (actionKey: SyncActionKey): PkgxSyncLogAction => {\r\n  switch (actionKey) {\r\n    case 'sync_all': return 'sync_all';\r\n    case 'sync_seo': return 'sync_seo';\r\n    case 'sync_price': return 'sync_price';\r\n    case 'sync_inventory': return 'sync_inventory';\r\n    case 'sync_basic':\r\n    case 'sync_description':\r\n    case 'sync_flags':\r\n    default:\r\n      return 'update_product'; // Map other actions to generic update\r\n  }\r\n};\r\n\r\nexport interface UsePkgxEntitySyncOptions {\r\n  entityType: PkgxEntityType;\r\n  onLog?: (log: {\r\n    action: PkgxSyncLogAction;\r\n    status: 'success' | 'error' | 'info';\r\n    message: string;\r\n    details?: Record<string, any>;\r\n  }) => void;\r\n  /** For products - get PKGX category ID from HRM category */\r\n  getPkgxCatIdByHrmCategory?: (hrmCategoryId: string) => number | undefined;\r\n  /** For products - get PKGX brand ID from HRM brand */\r\n  getPkgxBrandIdByHrmBrand?: (hrmBrandId: string) => number | undefined;\r\n}\r\n\r\n// ========================================\r\n// Action Definitions\r\n// ========================================\r\n\r\nexport const SYNC_ACTIONS: SyncAction[] = [\r\n  {\r\n    key: 'sync_all',\r\n    label: 'Đồng bộ tất cả',\r\n    icon: RefreshCw,\r\n    title: 'Đồng bộ tất cả',\r\n    description: (name) => `Đồng bộ TẤT CẢ thông tin của \"${name}\" lên PKGX`,\r\n    confirmTitle: 'Đồng bộ tất cả',\r\n    confirmDescription: (name) => `Bạn có chắc muốn đồng bộ TẤT CẢ thông tin \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['category', 'brand', 'product'],\r\n    isPrimary: true,\r\n  },\r\n  {\r\n    key: 'sync_basic',\r\n    label: 'Thông tin cơ bản',\r\n    icon: FolderEdit,\r\n    title: 'Đồng bộ thông tin cơ bản',\r\n    description: (name) => `Đồng bộ thông tin cơ bản của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ thông tin cơ bản',\r\n    confirmDescription: (name) => `Đồng bộ thông tin cơ bản của \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['category', 'brand', 'product'],\r\n  },\r\n  {\r\n    key: 'sync_seo',\r\n    label: 'SEO',\r\n    icon: Search,\r\n    title: 'Đồng bộ SEO',\r\n    description: (name) => `Đồng bộ SEO (keywords, meta title, meta description) của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ SEO',\r\n    confirmDescription: (name) => `Đồng bộ SEO của \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['category', 'brand', 'product'],\r\n  },\r\n  {\r\n    key: 'sync_description',\r\n    label: 'Mô tả',\r\n    icon: AlignLeft,\r\n    title: 'Đồng bộ mô tả',\r\n    description: (name) => `Đồng bộ mô tả (short desc, long desc) của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ mô tả',\r\n    confirmDescription: (name) => `Đồng bộ mô tả của \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['category', 'brand', 'product'],\r\n  },\r\n  {\r\n    key: 'sync_price',\r\n    label: 'Giá',\r\n    icon: DollarSign,\r\n    title: 'Đồng bộ giá',\r\n    description: (name) => `Đồng bộ giá bán, giá thị trường, giá khuyến mãi của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ giá',\r\n    confirmDescription: (name) => `Đồng bộ giá sản phẩm \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['product'],\r\n  },\r\n  {\r\n    key: 'sync_inventory',\r\n    label: 'Tồn kho',\r\n    icon: Package,\r\n    title: 'Đồng bộ tồn kho',\r\n    description: (name) => `Đồng bộ tổng số lượng tồn kho của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ tồn kho',\r\n    confirmDescription: (name) => `Đồng bộ tồn kho sản phẩm \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['product'],\r\n  },\r\n  {\r\n    key: 'sync_flags',\r\n    label: 'Flags',\r\n    icon: Tag,\r\n    title: 'Đồng bộ flags',\r\n    description: (name) => `Đồng bộ flags (nổi bật, mới, hot, trang chủ) của \"${name}\"`,\r\n    confirmTitle: 'Đồng bộ flags',\r\n    confirmDescription: (name) => `Đồng bộ flags của \"${name}\" lên PKGX?`,\r\n    supportedEntities: ['product'],\r\n  },\r\n];\r\n\r\n// ========================================\r\n// Hook\r\n// ========================================\r\n\r\nexport function usePkgxEntitySync(options: UsePkgxEntitySyncOptions) {\r\n  const { entityType, onLog, getPkgxCatIdByHrmCategory, getPkgxBrandIdByHrmBrand } = options;\r\n  \r\n  const [isSyncing, setIsSyncing] = React.useState(false);\r\n  const [confirmAction, setConfirmAction] = React.useState<ConfirmActionState>({\r\n    open: false,\r\n    title: '',\r\n    description: '',\r\n    action: null,\r\n  });\r\n  \r\n  // Get available actions for this entity type\r\n  const availableActions = React.useMemo(() => \r\n    SYNC_ACTIONS.filter(action => action.supportedEntities.includes(entityType)),\r\n  [entityType]);\r\n  \r\n  // Primary action (sync all)\r\n  const primaryAction = React.useMemo(() => \r\n    availableActions.find(a => a.isPrimary),\r\n  [availableActions]);\r\n  \r\n  // Secondary actions (non-primary)\r\n  const secondaryActions = React.useMemo(() => \r\n    availableActions.filter(a => !a.isPrimary),\r\n  [availableActions]);\r\n  \r\n  // Confirm handler\r\n  const handleConfirm = React.useCallback((title: string, description: string, action: () => void) => {\r\n    setConfirmAction({ open: true, title, description, action });\r\n  }, []);\r\n  \r\n  // Execute confirmed action\r\n  const executeAction = React.useCallback(() => {\r\n    if (confirmAction.action) {\r\n      confirmAction.action();\r\n    }\r\n    setConfirmAction({ open: false, title: '', description: '', action: null });\r\n  }, [confirmAction.action]);\r\n  \r\n  // Cancel confirm dialog\r\n  const cancelConfirm = React.useCallback(() => {\r\n    setConfirmAction({ open: false, title: '', description: '', action: null });\r\n  }, []);\r\n  \r\n  // ========================================\r\n  // Category Sync Handlers\r\n  // ========================================\r\n  \r\n  const syncCategory = React.useCallback(async (\r\n    pkgxCatId: number,\r\n    hrmCategory: HrmCategoryData,\r\n    actionKey: SyncActionKey\r\n  ) => {\r\n    setIsSyncing(true);\r\n    try {\r\n      const pkgxSeo = hrmCategory.websiteSeo?.pkgx;\r\n      let payload: Record<string, any> = {};\r\n      let successMessage = '';\r\n      \r\n      switch (actionKey) {\r\n        case 'sync_all':\r\n          payload = {\r\n            cat_name: hrmCategory.name,\r\n            keywords: pkgxSeo?.seoKeywords || hrmCategory.seoKeywords || hrmCategory.name,\r\n            meta_title: pkgxSeo?.seoTitle || hrmCategory.seoTitle || hrmCategory.name,\r\n            meta_desc: pkgxSeo?.metaDescription || hrmCategory.metaDescription || '',\r\n            cat_desc: pkgxSeo?.shortDescription || hrmCategory.shortDescription || '',\r\n            long_desc: pkgxSeo?.longDescription || hrmCategory.longDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ tất cả cho danh mục: ${hrmCategory.name}`;\r\n          break;\r\n          \r\n        case 'sync_basic':\r\n          payload = {\r\n            cat_name: hrmCategory.name,\r\n            is_show: hrmCategory.isActive !== false ? 1 : 0,\r\n          };\r\n          successMessage = `Đã đồng bộ thông tin cơ bản cho danh mục: ${hrmCategory.name}`;\r\n          // Use updateCategoryBasic for basic info\r\n          const basicResponse = await updateCategoryBasic(pkgxCatId, payload);\r\n          if (basicResponse.success) {\r\n            toast.success(successMessage);\r\n            onLog?.({\r\n              action: 'update_product', // Map to valid log action\r\n              status: 'success',\r\n              message: successMessage,\r\n              details: { categoryId: pkgxCatId },\r\n            });\r\n          } else {\r\n            toast.error(basicResponse.error || 'Không thể đồng bộ');\r\n          }\r\n          setIsSyncing(false);\r\n          return basicResponse.success;\r\n          \r\n        case 'sync_seo':\r\n          payload = {\r\n            keywords: pkgxSeo?.seoKeywords || hrmCategory.seoKeywords || hrmCategory.name,\r\n            meta_title: pkgxSeo?.seoTitle || hrmCategory.seoTitle || hrmCategory.name,\r\n            meta_desc: pkgxSeo?.metaDescription || hrmCategory.metaDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ SEO cho danh mục: ${hrmCategory.name}`;\r\n          break;\r\n          \r\n        case 'sync_description':\r\n          payload = {\r\n            cat_desc: pkgxSeo?.shortDescription || hrmCategory.shortDescription || '',\r\n            long_desc: pkgxSeo?.longDescription || hrmCategory.longDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ mô tả cho danh mục: ${hrmCategory.name}`;\r\n          break;\r\n          \r\n        default:\r\n          setIsSyncing(false);\r\n          return false;\r\n      }\r\n      \r\n      const response = await updateCategory(pkgxCatId, payload);\r\n      if (response.success) {\r\n        toast.success(successMessage);\r\n        onLog?.({\r\n          action: mapActionKeyToLogAction(actionKey),\r\n          status: 'success',\r\n          message: successMessage,\r\n          details: { categoryId: pkgxCatId },\r\n        });\r\n      } else {\r\n        toast.error(response.error || 'Không thể đồng bộ');\r\n      }\r\n      \r\n      return response.success;\r\n    } catch (error) {\r\n      toast.error('Lỗi khi đồng bộ danh mục');\r\n      return false;\r\n    } finally {\r\n      setIsSyncing(false);\r\n    }\r\n  }, [onLog]);\r\n  \r\n  // ========================================\r\n  // Brand Sync Handlers\r\n  // ========================================\r\n  \r\n  const syncBrand = React.useCallback(async (\r\n    pkgxBrandId: number,\r\n    hrmBrand: HrmBrandData,\r\n    actionKey: SyncActionKey\r\n  ) => {\r\n    setIsSyncing(true);\r\n    try {\r\n      const pkgxSeo = hrmBrand.websiteSeo?.pkgx;\r\n      let payload: Record<string, any> = {};\r\n      let successMessage = '';\r\n      \r\n      switch (actionKey) {\r\n        case 'sync_all':\r\n          payload = {\r\n            brand_name: hrmBrand.name,\r\n            site_url: hrmBrand.website || '',\r\n            keywords: pkgxSeo?.seoKeywords || hrmBrand.seoKeywords || hrmBrand.name,\r\n            meta_title: pkgxSeo?.seoTitle || hrmBrand.seoTitle || hrmBrand.name,\r\n            meta_desc: pkgxSeo?.metaDescription || hrmBrand.metaDescription || '',\r\n            short_desc: pkgxSeo?.shortDescription || hrmBrand.shortDescription || '',\r\n            long_desc: pkgxSeo?.longDescription || hrmBrand.longDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ tất cả cho thương hiệu: ${hrmBrand.name}`;\r\n          break;\r\n          \r\n        case 'sync_basic':\r\n          payload = {\r\n            brand_name: hrmBrand.name,\r\n            site_url: hrmBrand.website || '',\r\n          };\r\n          successMessage = `Đã đồng bộ thông tin cơ bản cho thương hiệu: ${hrmBrand.name}`;\r\n          break;\r\n          \r\n        case 'sync_seo':\r\n          payload = {\r\n            keywords: pkgxSeo?.seoKeywords || hrmBrand.seoKeywords || hrmBrand.name,\r\n            meta_title: pkgxSeo?.seoTitle || hrmBrand.seoTitle || hrmBrand.name,\r\n            meta_desc: pkgxSeo?.metaDescription || hrmBrand.metaDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ SEO cho thương hiệu: ${hrmBrand.name}`;\r\n          break;\r\n          \r\n        case 'sync_description':\r\n          payload = {\r\n            short_desc: pkgxSeo?.shortDescription || hrmBrand.shortDescription || '',\r\n            long_desc: pkgxSeo?.longDescription || hrmBrand.longDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ mô tả cho thương hiệu: ${hrmBrand.name}`;\r\n          break;\r\n          \r\n        default:\r\n          setIsSyncing(false);\r\n          return false;\r\n      }\r\n      \r\n      const response = await updateBrand(pkgxBrandId, payload);\r\n      if (response.success) {\r\n        toast.success(successMessage);\r\n        onLog?.({\r\n          action: mapActionKeyToLogAction(actionKey),\r\n          status: 'success',\r\n          message: successMessage,\r\n          details: { brandId: pkgxBrandId },\r\n        });\r\n      } else {\r\n        toast.error(response.error || 'Không thể đồng bộ');\r\n      }\r\n      \r\n      return response.success;\r\n    } catch (error) {\r\n      toast.error('Lỗi khi đồng bộ thương hiệu');\r\n      return false;\r\n    } finally {\r\n      setIsSyncing(false);\r\n    }\r\n  }, [onLog]);\r\n  \r\n  // ========================================\r\n  // Product Sync Handlers\r\n  // ========================================\r\n  \r\n  const syncProduct = React.useCallback(async (\r\n    pkgxProductId: number,\r\n    hrmProduct: HrmProductData,\r\n    actionKey: SyncActionKey\r\n  ) => {\r\n    setIsSyncing(true);\r\n    try {\r\n      let payload: Record<string, any> = {};\r\n      let successMessage = '';\r\n      \r\n      switch (actionKey) {\r\n        case 'sync_all':\r\n          payload = {\r\n            goods_name: hrmProduct.name,\r\n            goods_sn: hrmProduct.sku || '',\r\n            shop_price: hrmProduct.sellingPrice || 0,\r\n            market_price: hrmProduct.costPrice || hrmProduct.sellingPrice || 0,\r\n            promote_price: hrmProduct.dealPrice || 0,\r\n            goods_number: hrmProduct.quantity || 0,\r\n            keywords: hrmProduct.seoKeywords || hrmProduct.name,\r\n            meta_title: hrmProduct.ktitle || hrmProduct.name,\r\n            meta_desc: hrmProduct.seoDescription || '',\r\n            goods_brief: hrmProduct.shortDescription || '',\r\n            goods_desc: hrmProduct.description || '',\r\n            is_best: hrmProduct.isBest ? 1 : 0,\r\n            is_new: hrmProduct.isNew ? 1 : 0,\r\n            is_hot: hrmProduct.isHot ? 1 : 0,\r\n            is_home: hrmProduct.isHome ? 1 : 0,\r\n          };\r\n          // Add category/brand if mapped\r\n          if (hrmProduct.categorySystemId && getPkgxCatIdByHrmCategory) {\r\n            const catId = getPkgxCatIdByHrmCategory(hrmProduct.categorySystemId);\r\n            if (catId) payload.cat_id = catId;\r\n          }\r\n          if (hrmProduct.brandSystemId && getPkgxBrandIdByHrmBrand) {\r\n            const brandId = getPkgxBrandIdByHrmBrand(hrmProduct.brandSystemId);\r\n            if (brandId) payload.brand_id = brandId;\r\n          }\r\n          successMessage = `Đã đồng bộ tất cả cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_basic':\r\n          payload = {\r\n            goods_name: hrmProduct.name,\r\n            goods_sn: hrmProduct.sku || '',\r\n          };\r\n          // Add category/brand if mapped\r\n          if (hrmProduct.categorySystemId && getPkgxCatIdByHrmCategory) {\r\n            const catId = getPkgxCatIdByHrmCategory(hrmProduct.categorySystemId);\r\n            if (catId) payload.cat_id = catId;\r\n          }\r\n          if (hrmProduct.brandSystemId && getPkgxBrandIdByHrmBrand) {\r\n            const brandId = getPkgxBrandIdByHrmBrand(hrmProduct.brandSystemId);\r\n            if (brandId) payload.brand_id = brandId;\r\n          }\r\n          successMessage = `Đã đồng bộ thông tin cơ bản cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_seo':\r\n          payload = {\r\n            keywords: hrmProduct.seoKeywords || hrmProduct.name,\r\n            meta_title: hrmProduct.ktitle || hrmProduct.name,\r\n            meta_desc: hrmProduct.seoDescription || '',\r\n          };\r\n          successMessage = `Đã đồng bộ SEO cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_description':\r\n          payload = {\r\n            goods_brief: hrmProduct.shortDescription || '',\r\n            goods_desc: hrmProduct.description || '',\r\n          };\r\n          successMessage = `Đã đồng bộ mô tả cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_price':\r\n          payload = {\r\n            shop_price: hrmProduct.sellingPrice || 0,\r\n            market_price: hrmProduct.costPrice || hrmProduct.sellingPrice || 0,\r\n            promote_price: hrmProduct.dealPrice || 0,\r\n          };\r\n          successMessage = `Đã đồng bộ giá cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_inventory':\r\n          payload = {\r\n            goods_number: hrmProduct.quantity || 0,\r\n          };\r\n          successMessage = `Đã đồng bộ tồn kho cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        case 'sync_flags':\r\n          payload = {\r\n            is_best: hrmProduct.isBest ? 1 : 0,\r\n            is_new: hrmProduct.isNew ? 1 : 0,\r\n            is_hot: hrmProduct.isHot ? 1 : 0,\r\n            is_home: hrmProduct.isHome ? 1 : 0,\r\n          };\r\n          successMessage = `Đã đồng bộ flags cho sản phẩm: ${hrmProduct.name}`;\r\n          break;\r\n          \r\n        default:\r\n          setIsSyncing(false);\r\n          return false;\r\n      }\r\n      \r\n      const response = await updatePkgxProduct(pkgxProductId, payload);\r\n      if (response.success) {\r\n        toast.success(successMessage);\r\n        onLog?.({\r\n          action: mapActionKeyToLogAction(actionKey),\r\n          status: 'success',\r\n          message: successMessage,\r\n          details: { pkgxId: pkgxProductId },\r\n        });\r\n      } else {\r\n        toast.error(response.error || 'Không thể đồng bộ');\r\n      }\r\n      \r\n      return response.success;\r\n    } catch (error) {\r\n      toast.error('Lỗi khi đồng bộ sản phẩm');\r\n      return false;\r\n    } finally {\r\n      setIsSyncing(false);\r\n    }\r\n  }, [onLog, getPkgxCatIdByHrmCategory, getPkgxBrandIdByHrmBrand]);\r\n  \r\n  // ========================================\r\n  // Generic sync handler based on entity type\r\n  // ========================================\r\n  \r\n  const sync = React.useCallback(async (\r\n    pkgxId: number,\r\n    hrmData: HrmCategoryData | HrmBrandData | HrmProductData,\r\n    actionKey: SyncActionKey\r\n  ) => {\r\n    switch (entityType) {\r\n      case 'category':\r\n        return syncCategory(pkgxId, hrmData as HrmCategoryData, actionKey);\r\n      case 'brand':\r\n        return syncBrand(pkgxId, hrmData as HrmBrandData, actionKey);\r\n      case 'product':\r\n        return syncProduct(pkgxId, hrmData as HrmProductData, actionKey);\r\n      default:\r\n        return false;\r\n    }\r\n  }, [entityType, syncCategory, syncBrand, syncProduct]);\r\n  \r\n  // ========================================\r\n  // Action trigger with confirmation\r\n  // ========================================\r\n  \r\n  const triggerSyncAction = React.useCallback((\r\n    actionKey: SyncActionKey,\r\n    pkgxId: number,\r\n    hrmData: HrmCategoryData | HrmBrandData | HrmProductData,\r\n    entityName: string\r\n  ) => {\r\n    const action = SYNC_ACTIONS.find(a => a.key === actionKey);\r\n    if (!action) return;\r\n    \r\n    handleConfirm(\r\n      action.confirmTitle,\r\n      action.confirmDescription(entityName),\r\n      () => sync(pkgxId, hrmData, actionKey)\r\n    );\r\n  }, [handleConfirm, sync]);\r\n  \r\n  return {\r\n    // State\r\n    isSyncing,\r\n    confirmAction,\r\n    \r\n    // Actions config\r\n    availableActions,\r\n    primaryAction,\r\n    secondaryActions,\r\n    \r\n    // Handlers\r\n    handleConfirm,\r\n    executeAction,\r\n    cancelConfirm,\r\n    \r\n    // Sync methods\r\n    sync,\r\n    syncCategory,\r\n    syncBrand,\r\n    syncProduct,\r\n    triggerSyncAction,\r\n  };\r\n}\r\n\r\nexport type UsePkgxEntitySyncReturn = ReturnType<typeof usePkgxEntitySync>;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3775, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/hooks/use-pkgx-bulk-sync.ts"],"sourcesContent":["/**\r\n * usePkgxBulkSync - Shared hook for bulk PKGX sync operations\r\n * \r\n * Supports bulk sync for products and brands with:\r\n * - Progress tracking\r\n * - Confirmation dialog\r\n * - Error handling\r\n * - Logging\r\n */\r\n\r\nimport * as React from 'react';\r\nimport { toast } from 'sonner';\r\nimport { updateProduct, updateBrand } from '../../../../lib/pkgx/api-service';\r\nimport { usePkgxSettingsStore } from '../store';\r\nimport type { Product } from '../../../products/types';\r\nimport type { Brand } from '../../../settings/inventory/types';\r\n\r\n// ========================================\r\n// Types\r\n// ========================================\r\n\r\nexport type BulkSyncEntityType = 'product' | 'brand';\r\n\r\nexport type BulkSyncActionKey = \r\n  | 'sync_all'\r\n  | 'sync_basic'\r\n  | 'sync_seo'\r\n  | 'sync_description'\r\n  | 'sync_price'\r\n  | 'sync_inventory'\r\n  | 'sync_flags'\r\n  | 'sync_images';\r\n\r\nexport interface BulkConfirmState {\r\n  open: boolean;\r\n  title: string;\r\n  description: string;\r\n  action: (() => Promise<void>) | null;\r\n  itemCount: number;\r\n}\r\n\r\nexport interface BulkSyncProgress {\r\n  total: number;\r\n  completed: number;\r\n  success: number;\r\n  error: number;\r\n  isRunning: boolean;\r\n}\r\n\r\nexport interface UsePkgxBulkSyncOptions {\r\n  entityType: BulkSyncEntityType;\r\n  onLog?: (log: {\r\n    action: `bulk_${BulkSyncActionKey}`;\r\n    status: 'success' | 'error' | 'info';\r\n    message: string;\r\n    details?: Record<string, unknown>;\r\n  }) => void;\r\n}\r\n\r\n// ========================================\r\n// Bulk Action Configs\r\n// ========================================\r\n\r\nconst BULK_ACTION_LABELS: Record<BulkSyncActionKey, { title: string; description: string }> = {\r\n  sync_all: {\r\n    title: 'Đồng bộ tất cả',\r\n    description: 'Đồng bộ toàn bộ thông tin (tên, SKU, giá, tồn kho, SEO, mô tả, flags)',\r\n  },\r\n  sync_basic: {\r\n    title: 'Đồng bộ thông tin cơ bản',\r\n    description: 'Đồng bộ tên, SKU, danh mục, thương hiệu',\r\n  },\r\n  sync_seo: {\r\n    title: 'Đồng bộ SEO',\r\n    description: 'Đồng bộ keywords, meta title, meta description',\r\n  },\r\n  sync_description: {\r\n    title: 'Đồng bộ mô tả',\r\n    description: 'Đồng bộ mô tả ngắn và mô tả chi tiết',\r\n  },\r\n  sync_price: {\r\n    title: 'Đồng bộ giá',\r\n    description: 'Đồng bộ giá bán, giá thị trường, giá khuyến mãi',\r\n  },\r\n  sync_inventory: {\r\n    title: 'Đồng bộ tồn kho',\r\n    description: 'Đồng bộ số lượng tồn kho',\r\n  },\r\n  sync_flags: {\r\n    title: 'Đồng bộ flags',\r\n    description: 'Đồng bộ trạng thái nổi bật, mới, hot, hiển thị',\r\n  },\r\n  sync_images: {\r\n    title: 'Đồng bộ hình ảnh',\r\n    description: 'Đồng bộ hình ảnh đại diện và album',\r\n  },\r\n};\r\n\r\n// ========================================\r\n// Payload Builders\r\n// ========================================\r\n\r\nfunction buildProductPayload(product: Product, actionKey: BulkSyncActionKey): Record<string, unknown> {\r\n  const pkgxSettings = usePkgxSettingsStore.getState();\r\n  const { categoryMappings, brandMappings } = pkgxSettings.settings;\r\n  \r\n  // Get PKGX category/brand IDs\r\n  const catMapping = categoryMappings.find(m => m.hrmCategorySystemId === product.categorySystemId);\r\n  const brandMapping = brandMappings.find(m => m.hrmBrandSystemId === product.brandSystemId);\r\n  \r\n  // Get website-specific SEO data\r\n  const pkgxSeo = product.seoPkgx;\r\n  \r\n  // Calculate total inventory\r\n  const totalInventory = Object.values(product.inventoryByBranch || {}).reduce((sum, qty) => sum + qty, 0);\r\n  \r\n  switch (actionKey) {\r\n    case 'sync_all':\r\n      return {\r\n        goods_name: product.name,\r\n        goods_sn: product.id,\r\n        shop_price: product.sellingPrice || 0,\r\n        market_price: product.costPrice || product.sellingPrice || 0,\r\n        promote_price: 0, // dealPrice not in Product type\r\n        goods_number: totalInventory,\r\n        keywords: pkgxSeo?.seoKeywords || product.seoKeywords || product.name,\r\n        meta_title: pkgxSeo?.seoTitle || product.ktitle || product.name,\r\n        meta_desc: pkgxSeo?.metaDescription || product.seoDescription || '',\r\n        goods_brief: pkgxSeo?.shortDescription || product.shortDescription || '',\r\n        goods_desc: pkgxSeo?.longDescription || product.description || '',\r\n        is_best: product.isFeatured ? 1 : 0,\r\n        is_new: product.isNewArrival ? 1 : 0,\r\n        is_hot: product.isBestSeller ? 1 : 0,\r\n        is_home: product.isPublished ? 1 : 0,\r\n        is_on_sale: product.isPublished ?? (product.status === 'active') ? 1 : 0,\r\n        ...(catMapping && { cat_id: catMapping.pkgxCatId }),\r\n        ...(brandMapping && { brand_id: brandMapping.pkgxBrandId }),\r\n      };\r\n      \r\n    case 'sync_basic':\r\n      return {\r\n        goods_name: product.name,\r\n        goods_sn: product.id,\r\n        ...(catMapping && { cat_id: catMapping.pkgxCatId }),\r\n        ...(brandMapping && { brand_id: brandMapping.pkgxBrandId }),\r\n      };\r\n      \r\n    case 'sync_price':\r\n      return {\r\n        shop_price: product.sellingPrice || 0,\r\n        market_price: product.costPrice || product.sellingPrice || 0,\r\n        promote_price: 0,\r\n      };\r\n      \r\n    case 'sync_inventory':\r\n      return {\r\n        goods_number: totalInventory,\r\n      };\r\n      \r\n    case 'sync_seo':\r\n      return {\r\n        keywords: pkgxSeo?.seoKeywords || product.seoKeywords || product.name,\r\n        meta_title: pkgxSeo?.seoTitle || product.ktitle || product.name,\r\n        meta_desc: pkgxSeo?.metaDescription || product.seoDescription || '',\r\n      };\r\n      \r\n    case 'sync_description':\r\n      return {\r\n        goods_brief: pkgxSeo?.shortDescription || product.shortDescription || '',\r\n        goods_desc: pkgxSeo?.longDescription || product.description || '',\r\n      };\r\n      \r\n    case 'sync_flags':\r\n      return {\r\n        is_best: product.isFeatured ? 1 : 0,\r\n        is_new: product.isNewArrival ? 1 : 0,\r\n        is_hot: product.isBestSeller ? 1 : 0,\r\n        is_home: product.isPublished ? 1 : 0,\r\n        is_on_sale: product.isPublished ?? (product.status === 'active') ? 1 : 0,\r\n      };\r\n      \r\n    default:\r\n      return {};\r\n  }\r\n}\r\n\r\nfunction buildBrandPayload(brand: Brand, actionKey: BulkSyncActionKey): Record<string, unknown> {\r\n  const pkgxSeo = brand.websiteSeo?.pkgx;\r\n  \r\n  switch (actionKey) {\r\n    case 'sync_all':\r\n      return {\r\n        brand_name: brand.name,\r\n        site_url: brand.website || '',\r\n        keywords: pkgxSeo?.seoKeywords || brand.seoKeywords || brand.name,\r\n        meta_title: pkgxSeo?.seoTitle || brand.seoTitle || brand.name,\r\n        meta_desc: pkgxSeo?.metaDescription || brand.metaDescription || '',\r\n        short_desc: pkgxSeo?.shortDescription || brand.shortDescription || '',\r\n        brand_desc: pkgxSeo?.longDescription || brand.longDescription || brand.description || '',\r\n      };\r\n      \r\n    case 'sync_basic':\r\n      return {\r\n        brand_name: brand.name,\r\n        site_url: brand.website || '',\r\n      };\r\n      \r\n    case 'sync_seo':\r\n      return {\r\n        keywords: pkgxSeo?.seoKeywords || brand.seoKeywords || brand.name,\r\n        meta_title: pkgxSeo?.seoTitle || brand.seoTitle || brand.name,\r\n        meta_desc: pkgxSeo?.metaDescription || brand.metaDescription || '',\r\n        short_desc: pkgxSeo?.shortDescription || brand.shortDescription || '',\r\n      };\r\n      \r\n    case 'sync_description':\r\n      return {\r\n        short_desc: pkgxSeo?.shortDescription || brand.shortDescription || '',\r\n        brand_desc: pkgxSeo?.longDescription || brand.longDescription || brand.description || '',\r\n      };\r\n      \r\n    default:\r\n      return {};\r\n  }\r\n}\r\n\r\n// ========================================\r\n// Main Hook\r\n// ========================================\r\n\r\nexport function usePkgxBulkSync(options: UsePkgxBulkSyncOptions) {\r\n  const { entityType, onLog } = options;\r\n  \r\n  // Confirmation dialog state\r\n  const [confirmAction, setConfirmAction] = React.useState<BulkConfirmState>({\r\n    open: false,\r\n    title: '',\r\n    description: '',\r\n    action: null,\r\n    itemCount: 0,\r\n  });\r\n  \r\n  // Progress state\r\n  const [progress, setProgress] = React.useState<BulkSyncProgress>({\r\n    total: 0,\r\n    completed: 0,\r\n    success: 0,\r\n    error: 0,\r\n    isRunning: false,\r\n  });\r\n  \r\n  // Check if PKGX is enabled\r\n  const checkPkgxEnabled = React.useCallback(() => {\r\n    const pkgxSettings = usePkgxSettingsStore.getState();\r\n    if (!pkgxSettings.settings.enabled) {\r\n      toast.error('PKGX chưa được bật');\r\n      return false;\r\n    }\r\n    return true;\r\n  }, []);\r\n  \r\n  // Helper to get PKGX brand ID from brand mappings\r\n  const getPkgxBrandId = React.useCallback((brand: Brand): number | undefined => {\r\n    const pkgxSettings = usePkgxSettingsStore.getState();\r\n    const mapping = pkgxSettings.settings.brandMappings.find(\r\n      m => m.hrmBrandSystemId === brand.systemId\r\n    );\r\n    return mapping?.pkgxBrandId;\r\n  }, []);\r\n  \r\n  // Execute bulk sync for products\r\n  const executeBulkSyncProducts = React.useCallback(async (\r\n    products: Product[],\r\n    actionKey: BulkSyncActionKey\r\n  ) => {\r\n    const linkedProducts = products.filter(p => p.pkgxId);\r\n    \r\n    if (linkedProducts.length === 0) {\r\n      toast.error('Không có sản phẩm nào đã liên kết PKGX');\r\n      return;\r\n    }\r\n    \r\n    setProgress({\r\n      total: linkedProducts.length,\r\n      completed: 0,\r\n      success: 0,\r\n      error: 0,\r\n      isRunning: true,\r\n    });\r\n    \r\n    const actionLabel = BULK_ACTION_LABELS[actionKey].title.toLowerCase();\r\n    toast.info(`Đang ${actionLabel} ${linkedProducts.length} sản phẩm...`);\r\n    \r\n    let successCount = 0;\r\n    let errorCount = 0;\r\n    \r\n    for (let i = 0; i < linkedProducts.length; i++) {\r\n      const product = linkedProducts[i];\r\n      try {\r\n        const payload = buildProductPayload(product, actionKey);\r\n        const response = await updateProduct(product.pkgxId!, payload);\r\n        \r\n        if (response.success) {\r\n          successCount++;\r\n        } else {\r\n          errorCount++;\r\n        }\r\n      } catch {\r\n        errorCount++;\r\n      }\r\n      \r\n      setProgress(prev => ({\r\n        ...prev,\r\n        completed: i + 1,\r\n        success: successCount,\r\n        error: errorCount,\r\n      }));\r\n    }\r\n    \r\n    setProgress(prev => ({ ...prev, isRunning: false }));\r\n    \r\n    // Show results\r\n    if (successCount > 0) {\r\n      toast.success(`Đã ${actionLabel} ${successCount} sản phẩm`);\r\n      onLog?.({\r\n        action: `bulk_${actionKey}`,\r\n        status: 'success',\r\n        message: `Đã ${actionLabel} ${successCount} sản phẩm`,\r\n        details: { successCount, errorCount },\r\n      });\r\n    }\r\n    if (errorCount > 0) {\r\n      toast.error(`Lỗi ${errorCount} sản phẩm`);\r\n    }\r\n  }, [onLog]);\r\n  \r\n  // Execute bulk sync for brands\r\n  const executeBulkSyncBrands = React.useCallback(async (\r\n    brands: Brand[],\r\n    actionKey: BulkSyncActionKey\r\n  ) => {\r\n    const linkedBrands = brands.filter(b => getPkgxBrandId(b));\r\n    \r\n    if (linkedBrands.length === 0) {\r\n      toast.error('Không có thương hiệu nào đã liên kết PKGX');\r\n      return;\r\n    }\r\n    \r\n    setProgress({\r\n      total: linkedBrands.length,\r\n      completed: 0,\r\n      success: 0,\r\n      error: 0,\r\n      isRunning: true,\r\n    });\r\n    \r\n    const actionLabel = BULK_ACTION_LABELS[actionKey].title.toLowerCase();\r\n    toast.info(`Đang ${actionLabel} ${linkedBrands.length} thương hiệu...`);\r\n    \r\n    let successCount = 0;\r\n    let errorCount = 0;\r\n    \r\n    for (let i = 0; i < linkedBrands.length; i++) {\r\n      const brand = linkedBrands[i];\r\n      const pkgxBrandId = getPkgxBrandId(brand);\r\n      \r\n      if (!pkgxBrandId) {\r\n        errorCount++;\r\n        continue;\r\n      }\r\n      \r\n      try {\r\n        const payload = buildBrandPayload(brand, actionKey);\r\n        const response = await updateBrand(pkgxBrandId, payload);\r\n        \r\n        if (response.success) {\r\n          successCount++;\r\n        } else {\r\n          errorCount++;\r\n        }\r\n      } catch {\r\n        errorCount++;\r\n      }\r\n      \r\n      setProgress(prev => ({\r\n        ...prev,\r\n        completed: i + 1,\r\n        success: successCount,\r\n        error: errorCount,\r\n      }));\r\n    }\r\n    \r\n    setProgress(prev => ({ ...prev, isRunning: false }));\r\n    \r\n    // Show results\r\n    if (successCount > 0) {\r\n      toast.success(`Đã ${actionLabel} ${successCount} thương hiệu`);\r\n      onLog?.({\r\n        action: `bulk_${actionKey}`,\r\n        status: 'success',\r\n        message: `Đã ${actionLabel} ${successCount} thương hiệu`,\r\n        details: { successCount, errorCount },\r\n      });\r\n    }\r\n    if (errorCount > 0) {\r\n      toast.error(`Lỗi ${errorCount} thương hiệu`);\r\n    }\r\n  }, [getPkgxBrandId, onLog]);\r\n  \r\n  // Trigger bulk sync with confirmation\r\n  const triggerBulkSync = React.useCallback(<T extends Product | Brand>(\r\n    items: T[],\r\n    actionKey: BulkSyncActionKey\r\n  ) => {\r\n    if (!checkPkgxEnabled()) return;\r\n    \r\n    // Filter linked items\r\n    let linkedCount = 0;\r\n    let unlinkedCount = 0;\r\n    \r\n    if (entityType === 'product') {\r\n      const products = items as Product[];\r\n      linkedCount = products.filter(p => p.pkgxId).length;\r\n      unlinkedCount = products.length - linkedCount;\r\n    } else {\r\n      const brands = items as Brand[];\r\n      linkedCount = brands.filter(b => getPkgxBrandId(b)).length;\r\n      unlinkedCount = brands.length - linkedCount;\r\n    }\r\n    \r\n    if (linkedCount === 0) {\r\n      toast.error(`Không có ${entityType === 'product' ? 'sản phẩm' : 'thương hiệu'} nào đã liên kết PKGX`);\r\n      return;\r\n    }\r\n    \r\n    const actionConfig = BULK_ACTION_LABELS[actionKey];\r\n    const entityLabel = entityType === 'product' ? 'sản phẩm' : 'thương hiệu';\r\n    \r\n    let description = `Bạn có chắc muốn ${actionConfig.title.toLowerCase()} cho ${linkedCount} ${entityLabel}?`;\r\n    if (unlinkedCount > 0) {\r\n      description += `\\n(${unlinkedCount} ${entityLabel} chưa liên kết sẽ bị bỏ qua)`;\r\n    }\r\n    \r\n    setConfirmAction({\r\n      open: true,\r\n      title: actionConfig.title,\r\n      description,\r\n      itemCount: linkedCount,\r\n      action: async () => {\r\n        if (entityType === 'product') {\r\n          await executeBulkSyncProducts(items as Product[], actionKey);\r\n        } else {\r\n          await executeBulkSyncBrands(items as Brand[], actionKey);\r\n        }\r\n      },\r\n    });\r\n  }, [entityType, checkPkgxEnabled, getPkgxBrandId, executeBulkSyncProducts, executeBulkSyncBrands]);\r\n  \r\n  // Execute confirmed action\r\n  const executeAction = React.useCallback(async () => {\r\n    if (confirmAction.action) {\r\n      await confirmAction.action();\r\n    }\r\n    setConfirmAction({\r\n      open: false,\r\n      title: '',\r\n      description: '',\r\n      action: null,\r\n      itemCount: 0,\r\n    });\r\n  }, [confirmAction.action]);\r\n  \r\n  // Cancel confirmation\r\n  const cancelConfirm = React.useCallback(() => {\r\n    setConfirmAction({\r\n      open: false,\r\n      title: '',\r\n      description: '',\r\n      action: null,\r\n      itemCount: 0,\r\n    });\r\n  }, []);\r\n  \r\n  return {\r\n    // Confirmation dialog state\r\n    confirmAction,\r\n    \r\n    // Progress state\r\n    progress,\r\n    \r\n    // Actions\r\n    triggerBulkSync,\r\n    executeAction,\r\n    cancelConfirm,\r\n    \r\n    // Helpers\r\n    checkPkgxEnabled,\r\n    getPkgxBrandId,\r\n    \r\n    // Direct execute (without confirm)\r\n    executeBulkSyncProducts,\r\n    executeBulkSyncBrands,\r\n  };\r\n}\r\n\r\n// Export types\r\nexport type UsePkgxBulkSyncReturn = ReturnType<typeof usePkgxBulkSync>;\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4201, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/hooks/index.ts"],"sourcesContent":["export { useCategoryMappingValidation, useFieldValidation } from './use-category-mapping-validation';\r\nexport { useBrandMappingValidation } from './use-brand-mapping-validation';\r\nexport { usePkgxEntitySync, SYNC_ACTIONS } from './use-pkgx-entity-sync';\r\nexport { usePkgxBulkSync } from './use-pkgx-bulk-sync';\r\nexport type { \r\n  PkgxEntityType, \r\n  SyncActionKey, \r\n  SyncAction,\r\n  HrmCategoryData,\r\n  HrmBrandData,\r\n  HrmProductData,\r\n  ConfirmActionState,\r\n  UsePkgxEntitySyncOptions,\r\n  UsePkgxEntitySyncReturn,\r\n} from './use-pkgx-entity-sync';\r\nexport type {\r\n  BulkSyncEntityType,\r\n  BulkSyncActionKey,\r\n  BulkConfirmState,\r\n  BulkSyncProgress,\r\n  UsePkgxBulkSyncOptions,\r\n  UsePkgxBulkSyncReturn,\r\n} from './use-pkgx-bulk-sync';\r\n"],"names":[],"mappings":";AAAA;AACA;AACA;AACA"}},
    {"offset": {"line": 4214, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/components/pkgx-sync-confirm-dialog.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Loader2 } from 'lucide-react';\r\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle } from '../../../../components/ui/alert-dialog';\r\nimport type { ConfirmActionState } from '../hooks/use-pkgx-entity-sync';\r\n\r\ninterface PkgxSyncConfirmDialogProps {\r\n  confirmAction: ConfirmActionState;\r\n  isSyncing: boolean;\r\n  onConfirm: () => void;\r\n  onCancel: () => void;\r\n}\r\n\r\n/**\r\n * Shared confirmation dialog for PKGX sync actions\r\n * Used by category-mapping-tab, brand-mapping-tab, product-mapping-tab\r\n */\r\nexport function PkgxSyncConfirmDialog({\r\n  confirmAction,\r\n  isSyncing,\r\n  onConfirm,\r\n  onCancel,\r\n}: PkgxSyncConfirmDialogProps) {\r\n  return (\r\n    <AlertDialog open={confirmAction.open} onOpenChange={(open) => !open && onCancel()}>\r\n      <AlertDialogContent>\r\n        <AlertDialogHeader>\r\n          <AlertDialogTitle>{confirmAction.title}</AlertDialogTitle>\r\n          <AlertDialogDescription>{confirmAction.description}</AlertDialogDescription>\r\n        </AlertDialogHeader>\r\n        <AlertDialogFooter>\r\n          <AlertDialogCancel>Hủy</AlertDialogCancel>\r\n          <AlertDialogAction onClick={onConfirm} disabled={isSyncing}>\r\n            {isSyncing && <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />}\r\n            Xác nhận\r\n          </AlertDialogAction>\r\n        </AlertDialogFooter>\r\n      </AlertDialogContent>\r\n    </AlertDialog>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;;;;AAcO,SAAS,sBAAsB,EACpC,aAAa,EACb,SAAS,EACT,SAAS,EACT,QAAQ,EACmB;IAC3B,qBACE,8OAAC,mJAAW;QAAC,MAAM,cAAc,IAAI;QAAE,cAAc,CAAC,OAAS,CAAC,QAAQ;kBACtE,cAAA,8OAAC,0JAAkB;;8BACjB,8OAAC,yJAAiB;;sCAChB,8OAAC,wJAAgB;sCAAE,cAAc,KAAK;;;;;;sCACtC,8OAAC,8JAAsB;sCAAE,cAAc,WAAW;;;;;;;;;;;;8BAEpD,8OAAC,yJAAiB;;sCAChB,8OAAC,yJAAiB;sCAAC;;;;;;sCACnB,8OAAC,yJAAiB;4BAAC,SAAS;4BAAW,UAAU;;gCAC9C,2BAAa,8OAAC,4NAAO;oCAAC,WAAU;;;;;;gCAA+B;;;;;;;;;;;;;;;;;;;;;;;;AAO5E"}},
    {"offset": {"line": 4301, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/components/category-mapping-tab.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../../../../components/ui/card';\r\nimport { Button } from '../../../../components/ui/button';\r\nimport { Input } from '../../../../components/ui/input';\r\nimport { Badge } from '../../../../components/ui/badge';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '../../../../components/ui/tabs';\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '../../../../components/ui/dialog';\r\nimport { Label } from '../../../../components/ui/label';\r\nimport { ScrollArea } from '../../../../components/ui/scroll-area';\r\nimport { Plus, Pencil, Trash2, RefreshCw, Search, Loader2, FolderTree, Link, Unlink, CheckCircle2, MoreHorizontal, ExternalLink, Upload, AlignLeft, FolderEdit, Link2 } from 'lucide-react';\r\nimport { Checkbox } from '../../../../components/ui/checkbox';\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger } from '../../../../components/ui/dropdown-menu';\r\nimport { getCategoryById, updateCategory } from '../../../../lib/pkgx/api-service';\r\nimport { toast } from 'sonner';\r\nimport { usePkgxSettingsStore } from '../store';\r\nimport { useProductCategoryStore } from '../../inventory/product-category-store';\r\nimport { ResponsiveDataTable } from '../../../../components/data-table/responsive-data-table';\r\nimport type { ColumnDef } from '../../../../components/data-table/types';\r\nimport type { PkgxCategoryMapping, PkgxCategory, PkgxCategoryFromApi } from '../types';\r\nimport { useCategoryMappingValidation, usePkgxEntitySync } from '../hooks';\r\nimport type { HrmCategoryData } from '../hooks';\r\nimport type { CategoryMappingInput } from '../validation';\r\nimport { PkgxMappingDialog } from '../../../../components/shared/pkgx-mapping-dialog';\r\nimport { PkgxSyncConfirmDialog } from './pkgx-sync-confirm-dialog';\r\n\r\n// Extended type for PKGX categories table\r\ninterface PkgxCategoryRow extends PkgxCategory {\r\n  systemId: string;\r\n  mappedToHrm?: string;\r\n}\r\n\r\n// Extended type for mappings table\r\ninterface MappingRow extends PkgxCategoryMapping {\r\n  systemId: string;\r\n}\r\n\r\nexport function CategoryMappingTab() {\r\n  const { \r\n    settings, \r\n    addCategoryMapping, \r\n    updateCategoryMapping, \r\n    deleteCategoryMapping,\r\n    syncCategoriesFromPkgx,\r\n    addLog,\r\n  } = usePkgxSettingsStore();\r\n  const productCategories = useProductCategoryStore();\r\n  \r\n  const [searchTerm, setSearchTerm] = React.useState('');\r\n  const [activeTab, setActiveTab] = React.useState('pkgx-categories');\r\n  const [isDialogOpen, setIsDialogOpen] = React.useState(false);\r\n  const [editingMapping, setEditingMapping] = React.useState<PkgxCategoryMapping | null>(null);\r\n  const [isSyncing, setIsSyncing] = React.useState(false);\r\n  \r\n  // Detail dialog state\r\n  const [isDetailDialogOpen, setIsDetailDialogOpen] = React.useState(false);\r\n  const [selectedCategoryForDetail, setSelectedCategoryForDetail] = React.useState<PkgxCategoryFromApi | null>(null);\r\n  const [isLoadingDetail, setIsLoadingDetail] = React.useState(false);\r\n  const [isPushing, setIsPushing] = React.useState(false);\r\n  \r\n  // Table state\r\n  const [pagination, setPagination] = React.useState({ pageIndex: 0, pageSize: 20 });\r\n  const [sorting, setSorting] = React.useState<{ id: string; desc: boolean }>({ id: 'id', desc: false });\r\n  const [rowSelection, setRowSelection] = React.useState<Record<string, boolean>>({});\r\n  \r\n  // Form state\r\n  const [selectedHrmCategory, setSelectedHrmCategory] = React.useState('');\r\n  const [selectedPkgxCategory, setSelectedPkgxCategory] = React.useState('');\r\n  const [showWarningConfirm, setShowWarningConfirm] = React.useState(false);\r\n  \r\n  // Use shared PKGX entity sync hook\r\n  const entitySync = usePkgxEntitySync({\r\n    entityType: 'category',\r\n    onLog: addLog,\r\n  });\r\n  \r\n  const hrmCategories = React.useMemo(\r\n    () => productCategories.getActive().sort((a, b) => (a.path || '').localeCompare(b.path || '')),\r\n    [productCategories]\r\n  );\r\n  \r\n  // Validation hook\r\n  const validation = useCategoryMappingValidation({\r\n    existingMappings: settings.categoryMappings,\r\n    hrmCategories: hrmCategories,\r\n    pkgxCategories: settings.categories,\r\n    editingMappingId: editingMapping?.id,\r\n    debounceMs: 300,\r\n  });\r\n  \r\n  // Find if PKGX category is mapped\r\n  const findMapping = React.useCallback((pkgxCatId: number) => {\r\n    return settings.categoryMappings.find(m => m.pkgxCatId === pkgxCatId);\r\n  }, [settings.categoryMappings]);\r\n  \r\n  // PKGX Categories data for table\r\n  const pkgxCategoriesData = React.useMemo((): PkgxCategoryRow[] => {\r\n    let filtered = settings.categories;\r\n    if (searchTerm) {\r\n      const term = searchTerm.toLowerCase();\r\n      filtered = settings.categories.filter(c => \r\n        c.name.toLowerCase().includes(term) ||\r\n        c.id.toString().includes(term)\r\n      );\r\n    }\r\n    return filtered.map(c => ({\r\n      ...c,\r\n      systemId: c.id.toString(),\r\n      mappedToHrm: findMapping(c.id)?.hrmCategoryName,\r\n    }));\r\n  }, [settings.categories, searchTerm, findMapping]);\r\n  \r\n  // Mappings data for table\r\n  const mappingsData = React.useMemo((): MappingRow[] => {\r\n    let filtered = settings.categoryMappings;\r\n    if (searchTerm) {\r\n      const term = searchTerm.toLowerCase();\r\n      filtered = settings.categoryMappings.filter(m =>\r\n        m.hrmCategoryName.toLowerCase().includes(term) ||\r\n        m.pkgxCatName.toLowerCase().includes(term)\r\n      );\r\n    }\r\n    return filtered.map(m => ({\r\n      ...m,\r\n      systemId: m.id,\r\n    }));\r\n  }, [settings.categoryMappings, searchTerm]);\r\n  \r\n  // Paginated data\r\n  const paginatedPkgxData = React.useMemo(() => {\r\n    const start = pagination.pageIndex * pagination.pageSize;\r\n    return pkgxCategoriesData.slice(start, start + pagination.pageSize);\r\n  }, [pkgxCategoriesData, pagination]);\r\n  \r\n  const paginatedMappingsData = React.useMemo(() => {\r\n    const start = pagination.pageIndex * pagination.pageSize;\r\n    return mappingsData.slice(start, start + pagination.pageSize);\r\n  }, [mappingsData, pagination]);\r\n  \r\n  // All selected rows and bulk actions for PKGX categories table\r\n  const allSelectedPkgxRows = React.useMemo(() => \r\n    paginatedPkgxData.filter(p => rowSelection[p.systemId]),\r\n  [paginatedPkgxData, rowSelection]);\r\n  \r\n  // Get selected PKGX categories that are NOT mapped (for bulk mapping)\r\n  const selectedUnmappedCategories = React.useMemo(() => \r\n    allSelectedPkgxRows.filter(c => !c.mappedToHrm),\r\n  [allSelectedPkgxRows]);\r\n  \r\n  // Get selected PKGX categories that ARE mapped (for bulk unlink)\r\n  const selectedMappedCategories = React.useMemo(() => \r\n    allSelectedPkgxRows.filter(c => c.mappedToHrm),\r\n  [allSelectedPkgxRows]);\r\n  \r\n  // Bulk actions for PKGX categories table\r\n  const pkgxBulkActions = React.useMemo(() => [\r\n    {\r\n      label: `Hủy liên kết (${selectedMappedCategories.length})`,\r\n      icon: Unlink,\r\n      variant: 'destructive' as const,\r\n      disabled: selectedMappedCategories.length === 0,\r\n      onSelect: () => {\r\n        if (selectedMappedCategories.length === 0) {\r\n          toast.error('Không có danh mục đã liên kết nào được chọn');\r\n          return;\r\n        }\r\n        // Bulk delete mappings\r\n        selectedMappedCategories.forEach(category => {\r\n          const mapping = findMapping(category.id);\r\n          if (mapping) {\r\n            deleteCategoryMapping(mapping.id);\r\n          }\r\n        });\r\n        toast.success(`Đã hủy liên kết ${selectedMappedCategories.length} danh mục`);\r\n        setRowSelection({});\r\n      },\r\n    },\r\n  ], [selectedMappedCategories, findMapping, deleteCategoryMapping]);\r\n  \r\n  // PKGX Categories columns\r\n  const pkgxColumns: ColumnDef<PkgxCategoryRow>[] = React.useMemo(() => [\r\n    {\r\n      id: 'select',\r\n      header: ({ isAllPageRowsSelected, isSomePageRowsSelected, onToggleAll }) => (\r\n        <Checkbox\r\n          checked={isAllPageRowsSelected ? true : isSomePageRowsSelected ? 'indeterminate' : false}\r\n          onCheckedChange={onToggleAll}\r\n          aria-label=\"Select all\"\r\n        />\r\n      ),\r\n      cell: ({ row, isSelected, onToggleSelect }) => (\r\n        <Checkbox\r\n          checked={isSelected}\r\n          onCheckedChange={onToggleSelect}\r\n          aria-label=\"Select row\"\r\n          onClick={(e) => e.stopPropagation()}\r\n        />\r\n      ),\r\n      size: 48,\r\n      enableSorting: false,\r\n      meta: { sticky: 'left', displayName: '' },\r\n    },\r\n    {\r\n      id: 'id',\r\n      accessorKey: 'id',\r\n      header: 'ID',\r\n      size: 70,\r\n      cell: ({ row }) => <span className=\"font-mono text-xs\">{row.id}</span>,\r\n    },\r\n    {\r\n      id: 'name',\r\n      accessorKey: 'name',\r\n      header: 'Danh mục PKGX',\r\n      cell: ({ row }) => {\r\n        // Gộp danh mục cha > danh mục con\r\n        const parent = row.parentId ? settings.categories.find(c => c.id === row.parentId) : null;\r\n        return (\r\n          <div className=\"flex items-center gap-1\">\r\n            {parent && (\r\n              <>\r\n                <span className=\"text-muted-foreground text-sm\">{parent.name}</span>\r\n                <span className=\"text-muted-foreground\">›</span>\r\n              </>\r\n            )}\r\n            <span className=\"font-medium\">{row.name}</span>\r\n          </div>\r\n        );\r\n      },\r\n    },\r\n    {\r\n      id: 'mappedToHrm',\r\n      header: 'Mapping HRM',\r\n      cell: ({ row }) => (\r\n        row.mappedToHrm ? (\r\n          <Badge variant=\"default\" className=\"bg-green-500\">\r\n            <CheckCircle2 className=\"h-3 w-3 mr-1\" />\r\n            {row.mappedToHrm}\r\n          </Badge>\r\n        ) : (\r\n          <Badge variant=\"secondary\">Chưa liên kết</Badge>\r\n        )\r\n      ),\r\n    },\r\n    {\r\n      id: 'actions',\r\n      header: '',\r\n      size: 50,\r\n      cell: ({ row }) => {\r\n        // Get HRM category for sync actions\r\n        const mapping = findMapping(row.id);\r\n        const hrmCategory = mapping ? hrmCategories.find(c => c.systemId === mapping.hrmCategorySystemId) : null;\r\n        \r\n        // Helper to trigger sync with proper HRM data\r\n        const triggerSync = (actionKey: 'sync_all' | 'sync_basic' | 'sync_seo' | 'sync_description') => {\r\n          if (!mapping || !hrmCategory) {\r\n            toast.error('Danh mục chưa được liên kết với HRM');\r\n            return;\r\n          }\r\n          const hrmData: HrmCategoryData = {\r\n            systemId: hrmCategory.systemId,\r\n            name: hrmCategory.name,\r\n            isActive: hrmCategory.isActive,\r\n            seoKeywords: hrmCategory.seoKeywords,\r\n            seoTitle: hrmCategory.seoTitle,\r\n            metaDescription: hrmCategory.metaDescription,\r\n            shortDescription: hrmCategory.shortDescription,\r\n            longDescription: hrmCategory.longDescription,\r\n            websiteSeo: hrmCategory.websiteSeo,\r\n          };\r\n          entitySync.triggerSyncAction(actionKey, row.id, hrmData, row.name);\r\n        };\r\n        \r\n        return (\r\n          <DropdownMenu>\r\n            <DropdownMenuTrigger asChild>\r\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\r\n                <MoreHorizontal className=\"h-4 w-4\" />\r\n              </Button>\r\n            </DropdownMenuTrigger>\r\n            <DropdownMenuContent align=\"end\">\r\n              {row.mappedToHrm ? (\r\n                <>\r\n                  {/* Sync All */}\r\n                  <DropdownMenuItem \r\n                    onClick={() => triggerSync('sync_all')}\r\n                    className=\"font-medium\"\r\n                    title=\"Đồng bộ: Tên, Keywords, Meta Title, Meta Desc, Mô tả ngắn, Mô tả dài\"\r\n                  >\r\n                    <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n                    Đồng bộ tất cả\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuSeparator />\r\n                  \r\n                  {/* Individual sync actions */}\r\n                  <DropdownMenuItem \r\n                    onClick={() => triggerSync('sync_seo')}\r\n                    title=\"Đồng bộ: Keywords, Meta Title, Meta Desc\"\r\n                  >\r\n                    <Search className=\"h-4 w-4 mr-2\" />\r\n                    SEO\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuItem \r\n                    onClick={() => triggerSync('sync_description')}\r\n                    title=\"Đồng bộ: Mô tả ngắn (Short Desc), Mô tả dài (Long Desc)\"\r\n                  >\r\n                    <AlignLeft className=\"h-4 w-4 mr-2\" />\r\n                    Mô tả\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuItem \r\n                    onClick={() => triggerSync('sync_basic')}\r\n                    title=\"Đồng bộ: Tên danh mục, Trạng thái hiển thị\"\r\n                  >\r\n                    <FolderEdit className=\"h-4 w-4 mr-2\" />\r\n                    Thông tin cơ bản\r\n                  </DropdownMenuItem>\r\n                  \r\n                  <DropdownMenuSeparator />\r\n                  <DropdownMenuItem onClick={() => window.open(`https://phukiengiaxuong.com.vn/admin/category.php?act=edit&cat_id=${row.id}`, '_blank')}>\r\n                    <ExternalLink className=\"h-4 w-4 mr-2\" />\r\n                    Xem trên PKGX\r\n                  </DropdownMenuItem>\r\n                  \r\n                  {/* Hủy liên kết */}\r\n                  <DropdownMenuSeparator />\r\n                  <DropdownMenuItem \r\n                    onClick={() => entitySync.handleConfirm(\r\n                      'Hủy liên kết PKGX',\r\n                      `Bạn có chắc muốn hủy liên kết danh mục \"${row.name}\" với PKGX?`,\r\n                      () => handleUnlinkCategory(row.id)\r\n                    )}\r\n                    className=\"text-destructive focus:text-destructive\"\r\n                  >\r\n                    <Unlink className=\"h-4 w-4 mr-2\" />\r\n                    Hủy liên kết\r\n                  </DropdownMenuItem>\r\n                </>\r\n              ) : (\r\n                /* Not linked - show link option */\r\n                <>\r\n                  <DropdownMenuItem onClick={() => handleQuickMap(row)}>\r\n                    <Link2 className=\"h-4 w-4 mr-2\" />\r\n                    Liên kết với HRM\r\n                  </DropdownMenuItem>\r\n                </>\r\n              )}\r\n            </DropdownMenuContent>\r\n          </DropdownMenu>\r\n        );\r\n      },\r\n    },\r\n  ], [settings.categories, hrmCategories, findMapping, entitySync]);\r\n  \r\n  // Mappings columns\r\n  const mappingColumns: ColumnDef<MappingRow>[] = React.useMemo(() => [\r\n    {\r\n      id: 'hrmCategoryName',\r\n      accessorKey: 'hrmCategoryName',\r\n      header: 'Danh mục HRM',\r\n      cell: ({ row }) => <span className=\"font-medium\">{row.hrmCategoryName}</span>,\r\n    },\r\n    {\r\n      id: 'pkgxCatName',\r\n      accessorKey: 'pkgxCatName',\r\n      header: 'Danh mục PKGX',\r\n      cell: ({ row }) => <span>{row.pkgxCatName}</span>,\r\n    },\r\n    {\r\n      id: 'pkgxCatId',\r\n      accessorKey: 'pkgxCatId',\r\n      header: 'ID PKGX',\r\n      size: 80,\r\n      cell: ({ row }) => <span className=\"font-mono text-muted-foreground\">{row.pkgxCatId}</span>,\r\n    },\r\n    {\r\n      id: 'actions',\r\n      header: 'Hành động',\r\n      size: 100,\r\n      cell: ({ row }) => (\r\n        <div className=\"flex justify-end gap-1\">\r\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => handleOpenDialog(row)}>\r\n            <Pencil className=\"h-4 w-4\" />\r\n          </Button>\r\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => handleDelete(row.id)}>\r\n            <Trash2 className=\"h-4 w-4 text-destructive\" />\r\n          </Button>\r\n        </div>\r\n      ),\r\n    },\r\n  ], []);\r\n  \r\n  const handleQuickMap = (pkgxCategory: PkgxCategoryRow) => {\r\n    setSelectedPkgxCategory(pkgxCategory.id.toString());\r\n    setSelectedHrmCategory('');\r\n    setEditingMapping(null);\r\n    setIsDialogOpen(true);\r\n  };\r\n  \r\n  const handleUnlinkCategory = (pkgxCatId: number) => {\r\n    const mapping = findMapping(pkgxCatId);\r\n    if (mapping) {\r\n      deleteCategoryMapping(mapping.id);\r\n      addLog({\r\n        action: 'unlink_mapping',\r\n        status: 'success',\r\n        message: `Đã hủy liên kết danh mục: ${mapping.hrmCategoryName} ↔ ${mapping.pkgxCatName}`,\r\n        details: { categoryId: pkgxCatId },\r\n      });\r\n      toast.success('Đã hủy liên kết danh mục');\r\n    }\r\n  };\r\n  \r\n  // Open detail dialog with category info\r\n  const handleViewDetail = async (catId: number) => {\r\n    setIsDetailDialogOpen(true);\r\n    setIsLoadingDetail(true);\r\n    setSelectedCategoryForDetail(null);\r\n    \r\n    try {\r\n      const response = await getCategoryById(catId);\r\n      if (response.success && response.data?.data) {\r\n        setSelectedCategoryForDetail(response.data.data as any);\r\n      } else {\r\n        toast.error(response.error || 'Không thể lấy thông tin danh mục');\r\n      }\r\n    } catch (error) {\r\n      toast.error('Lỗi khi lấy thông tin danh mục');\r\n    } finally {\r\n      setIsLoadingDetail(false);\r\n    }\r\n  };\r\n  \r\n  // Push category info from HRM to PKGX\r\n  const handlePushCategory = async (pkgxCatId: number) => {\r\n    const mapping = findMapping(pkgxCatId);\r\n    if (!mapping) {\r\n      toast.error('Danh mục chưa được mapping với HRM');\r\n      return;\r\n    }\r\n    \r\n    const hrmCategory = hrmCategories.find(c => c.systemId === mapping.hrmCategorySystemId);\r\n    if (!hrmCategory) {\r\n      toast.error('Không tìm thấy danh mục HRM');\r\n      return;\r\n    }\r\n    \r\n    setIsPushing(true);\r\n    try {\r\n      const payload: { cat_name?: string; cat_desc?: string; keywords?: string } = {};\r\n      \r\n      // Push name\r\n      if (hrmCategory.name) payload.cat_name = hrmCategory.name;\r\n      // Push description (nếu HRM category có field này)\r\n      if ((hrmCategory as any).description) payload.cat_desc = (hrmCategory as any).description;\r\n      // Push keywords (nếu HRM category có field này)\r\n      if ((hrmCategory as any).seoKeywords) payload.keywords = (hrmCategory as any).seoKeywords;\r\n      \r\n      const response = await updateCategory(pkgxCatId, payload);\r\n      if (response.success) {\r\n        toast.success('Đã đẩy thông tin danh mục lên PKGX');\r\n        addLog({\r\n          action: 'update_product',\r\n          status: 'success',\r\n          message: `Đã đẩy thông tin danh mục: ${mapping.hrmCategoryName} → ${mapping.pkgxCatName}`,\r\n          details: { categoryId: pkgxCatId },\r\n        });\r\n        // Refresh detail if open\r\n        if (isDetailDialogOpen && selectedCategoryForDetail?.cat_id === pkgxCatId) {\r\n          handleViewDetail(pkgxCatId);\r\n        }\r\n      } else {\r\n        toast.error(response.error || 'Không thể cập nhật danh mục');\r\n      }\r\n    } catch (error) {\r\n      toast.error('Lỗi khi đẩy thông tin danh mục');\r\n    } finally {\r\n      setIsPushing(false);\r\n    }\r\n  };\r\n  \r\n  const handleOpenDialog = (mapping?: PkgxCategoryMapping) => {\r\n    if (mapping) {\r\n      setEditingMapping(mapping);\r\n      setSelectedHrmCategory(mapping.hrmCategorySystemId);\r\n      setSelectedPkgxCategory(mapping.pkgxCatId.toString());\r\n    } else {\r\n      setEditingMapping(null);\r\n      setSelectedHrmCategory('');\r\n      setSelectedPkgxCategory('');\r\n    }\r\n    setIsDialogOpen(true);\r\n  };\r\n  \r\n  const handleCloseDialog = () => {\r\n    setIsDialogOpen(false);\r\n    setEditingMapping(null);\r\n    setSelectedHrmCategory('');\r\n    setSelectedPkgxCategory('');\r\n    setShowWarningConfirm(false);\r\n    validation.clearValidation();\r\n  };\r\n  \r\n  // Validate when form values change\r\n  React.useEffect(() => {\r\n    if (isDialogOpen && (selectedHrmCategory || selectedPkgxCategory)) {\r\n      const input: CategoryMappingInput = {\r\n        hrmCategorySystemId: selectedHrmCategory || '',\r\n        hrmCategoryName: hrmCategories.find(c => c.systemId === selectedHrmCategory)?.name || '',\r\n        pkgxCatId: selectedPkgxCategory ? parseInt(selectedPkgxCategory) : '',\r\n        pkgxCatName: settings.categories.find(c => c.id === parseInt(selectedPkgxCategory))?.name || '',\r\n      };\r\n      validation.validateAsync(input);\r\n    }\r\n  }, [selectedHrmCategory, selectedPkgxCategory, isDialogOpen]);\r\n  \r\n  const handleSave = () => {\r\n    // Build input for validation\r\n    const input: CategoryMappingInput = {\r\n      hrmCategorySystemId: selectedHrmCategory || '',\r\n      hrmCategoryName: hrmCategories.find(c => c.systemId === selectedHrmCategory)?.name || '',\r\n      pkgxCatId: selectedPkgxCategory ? parseInt(selectedPkgxCategory) : '',\r\n      pkgxCatName: settings.categories.find(c => c.id === parseInt(selectedPkgxCategory))?.name || '',\r\n    };\r\n    \r\n    // Run final validation\r\n    const result = validation.validate(input);\r\n    \r\n    // Block if there are errors\r\n    if (!result.isValid) {\r\n      toast.error(result.errors[0]?.message || 'Vui lòng kiểm tra lại thông tin');\r\n      return;\r\n    }\r\n    \r\n    // Show warning confirmation if there are warnings and not yet confirmed\r\n    if (result.warnings.length > 0 && !showWarningConfirm) {\r\n      setShowWarningConfirm(true);\r\n      return;\r\n    }\r\n    \r\n    const hrmCategory = hrmCategories.find((c) => c.systemId === selectedHrmCategory);\r\n    const pkgxCategory = settings.categories.find((c) => c.id === parseInt(selectedPkgxCategory));\r\n    \r\n    if (!hrmCategory || !pkgxCategory) {\r\n      toast.error('Không tìm thấy danh mục');\r\n      return;\r\n    }\r\n    \r\n    if (editingMapping) {\r\n      updateCategoryMapping(editingMapping.id, {\r\n        hrmCategorySystemId: hrmCategory.systemId,\r\n        hrmCategoryName: hrmCategory.name,\r\n        pkgxCatId: pkgxCategory.id,\r\n        pkgxCatName: pkgxCategory.name,\r\n      });\r\n      addLog({\r\n        action: 'save_mapping',\r\n        status: 'success',\r\n        message: `Cập nhật mapping danh mục: ${hrmCategory.name} → ${pkgxCategory.name}`,\r\n        details: { categoryId: pkgxCategory.id },\r\n      });\r\n      toast.success('Đã cập nhật mapping danh mục');\r\n    } else {\r\n      addCategoryMapping({\r\n        id: `catmap-${Date.now()}`,\r\n        hrmCategorySystemId: hrmCategory.systemId,\r\n        hrmCategoryName: hrmCategory.name,\r\n        pkgxCatId: pkgxCategory.id,\r\n        pkgxCatName: pkgxCategory.name,\r\n      });\r\n      addLog({\r\n        action: 'save_mapping',\r\n        status: 'success',\r\n        message: `Thêm mapping danh mục: ${hrmCategory.name} → ${pkgxCategory.name}`,\r\n        details: { categoryId: pkgxCategory.id },\r\n      });\r\n      toast.success('Đã thêm mapping danh mục');\r\n    }\r\n    \r\n    handleCloseDialog();\r\n  };\r\n  \r\n  const handleDelete = (id: string) => {\r\n    const mapping = settings.categoryMappings.find(m => m.id === id);\r\n    deleteCategoryMapping(id);\r\n    if (mapping) {\r\n      addLog({\r\n        action: 'save_mapping',\r\n        status: 'info',\r\n        message: `Xóa mapping danh mục: ${mapping.hrmCategoryName}`,\r\n        details: { categoryId: mapping.pkgxCatId },\r\n      });\r\n    }\r\n    toast.success('Đã xóa mapping danh mục');\r\n  };\r\n  \r\n  const handleSyncFromPkgx = async () => {\r\n    setIsSyncing(true);\r\n    try {\r\n      await syncCategoriesFromPkgx();\r\n      toast.success('Đã đồng bộ danh mục từ PKGX');\r\n    } catch (error) {\r\n      toast.error(error instanceof Error ? error.message : 'Lỗi khi đồng bộ danh mục');\r\n    } finally {\r\n      setIsSyncing(false);\r\n    }\r\n  };\r\n  \r\n  // Mobile card renderers\r\n  const renderPkgxMobileCard = (row: PkgxCategoryRow) => (\r\n    <div className=\"p-4 space-y-3\">\r\n      <div className=\"flex items-start justify-between\">\r\n        <div>\r\n          <div className=\"font-medium\">{row.name}</div>\r\n          <div className=\"text-sm text-muted-foreground\">ID: {row.id}</div>\r\n        </div>\r\n        {row.mappedToHrm ? (\r\n          <Badge variant=\"default\" className=\"bg-green-500 shrink-0\">\r\n            <CheckCircle2 className=\"h-3 w-3 mr-1\" />\r\n            Đã mapping\r\n          </Badge>\r\n        ) : (\r\n          <Badge variant=\"secondary\" className=\"shrink-0\">Chưa mapping</Badge>\r\n        )}\r\n      </div>\r\n      {row.mappedToHrm && (\r\n        <div className=\"text-sm\">\r\n          <span className=\"text-muted-foreground\">HRM: </span>\r\n          <span>{row.mappedToHrm}</span>\r\n        </div>\r\n      )}\r\n      {!row.mappedToHrm && (\r\n        <Button\r\n          variant=\"outline\"\r\n          size=\"sm\"\r\n          className=\"w-full\"\r\n          onClick={() => handleQuickMap(row)}\r\n        >\r\n          <Link className=\"h-4 w-4 mr-2\" />\r\n          Mapping nhanh\r\n        </Button>\r\n      )}\r\n    </div>\r\n  );\r\n  \r\n  const renderMappingMobileCard = (row: MappingRow) => (\r\n    <div className=\"p-4 space-y-3\">\r\n      <div>\r\n        <div className=\"font-medium\">{row.hrmCategoryName}</div>\r\n        <div className=\"text-sm text-muted-foreground\">\r\n          → {row.pkgxCatName} (ID: {row.pkgxCatId})\r\n        </div>\r\n      </div>\r\n      <div className=\"flex gap-2\">\r\n        <Button variant=\"outline\" size=\"sm\" className=\"flex-1\" onClick={() => handleOpenDialog(row)}>\r\n          <Pencil className=\"h-4 w-4 mr-2\" />\r\n          Sửa\r\n        </Button>\r\n        <Button variant=\"outline\" size=\"sm\" className=\"flex-1\" onClick={() => handleDelete(row.id)}>\r\n          <Trash2 className=\"h-4 w-4 mr-2 text-destructive\" />\r\n          Xóa\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n  \r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card>\r\n        <CardHeader>\r\n          <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\r\n            <div>\r\n              <CardTitle className=\"text-lg\">Mapping danh mục sản phẩm</CardTitle>\r\n              <CardDescription>\r\n                Liên kết danh mục HRM với danh mục PKGX để đồng bộ sản phẩm\r\n              </CardDescription>\r\n            </div>\r\n            <div className=\"flex gap-2\">\r\n              <Button onClick={handleSyncFromPkgx} disabled={isSyncing} variant=\"outline\">\r\n                {isSyncing ? <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" /> : <RefreshCw className=\"h-4 w-4 mr-2\" />}\r\n                Đồng bộ từ PKGX\r\n              </Button>\r\n              <Button onClick={() => handleOpenDialog()}>\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Thêm mapping\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-4\">\r\n            <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-2\">\r\n              <div className=\"relative flex-1\">\r\n                <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\r\n                <Input\r\n                  placeholder=\"Tìm kiếm danh mục...\"\r\n                  value={searchTerm}\r\n                  onChange={(e) => setSearchTerm(e.target.value)}\r\n                  className=\"pl-9\"\r\n                />\r\n              </div>\r\n              <div className=\"text-sm text-muted-foreground whitespace-nowrap text-center sm:text-right\">\r\n                {settings.categories.length} danh mục PKGX | {settings.categoryMappings.length} mapping\r\n              </div>\r\n            </div>\r\n            \r\n            <Tabs value={activeTab} onValueChange={setActiveTab}>\r\n              <TabsList>\r\n                <TabsTrigger value=\"pkgx-categories\">\r\n                  <FolderTree className=\"h-4 w-4 mr-2\" />\r\n                  Danh mục PKGX ({settings.categories.length})\r\n                </TabsTrigger>\r\n                <TabsTrigger value=\"mappings\">\r\n                  <Link className=\"h-4 w-4 mr-2\" />\r\n                  Mapping ({settings.categoryMappings.length})\r\n                </TabsTrigger>\r\n              </TabsList>\r\n              \r\n              <TabsContent value=\"pkgx-categories\" className=\"mt-4\">\r\n                {settings.categories.length === 0 ? (\r\n                  <div className=\"text-center py-8 text-muted-foreground\">\r\n                    <FolderTree className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\r\n                    <p>Chưa có danh mục từ PKGX.</p>\r\n                    <p className=\"text-sm mt-1\">Bấm \"Đồng bộ từ PKGX\" để lấy danh sách.</p>\r\n                  </div>\r\n                ) : (\r\n                  <ResponsiveDataTable\r\n                    columns={pkgxColumns}\r\n                    data={paginatedPkgxData}\r\n                    renderMobileCard={renderPkgxMobileCard}\r\n                    pageCount={Math.ceil(pkgxCategoriesData.length / pagination.pageSize)}\r\n                    pagination={pagination}\r\n                    setPagination={setPagination}\r\n                    rowCount={pkgxCategoriesData.length}\r\n                    sorting={sorting}\r\n                    setSorting={setSorting}\r\n                    rowSelection={rowSelection}\r\n                    setRowSelection={setRowSelection}\r\n                    bulkActions={pkgxBulkActions}\r\n                    allSelectedRows={allSelectedPkgxRows}\r\n                    emptyTitle=\"Không tìm thấy danh mục\"\r\n                  />\r\n                )}\r\n              </TabsContent>\r\n              \r\n              <TabsContent value=\"mappings\" className=\"mt-4\">\r\n                {settings.categoryMappings.length === 0 ? (\r\n                  <div className=\"text-center py-8 text-muted-foreground\">\r\n                    <Link className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\r\n                    <p>Chưa có mapping nào.</p>\r\n                    <p className=\"text-sm mt-1\">Bấm \"Thêm mapping\" để bắt đầu.</p>\r\n                  </div>\r\n                ) : (\r\n                  <ResponsiveDataTable\r\n                    columns={mappingColumns}\r\n                    data={paginatedMappingsData}\r\n                    renderMobileCard={renderMappingMobileCard}\r\n                    pageCount={Math.ceil(mappingsData.length / pagination.pageSize)}\r\n                    pagination={pagination}\r\n                    setPagination={setPagination}\r\n                    rowCount={mappingsData.length}\r\n                    sorting={sorting}\r\n                    setSorting={setSorting}\r\n                    emptyTitle=\"Không tìm thấy mapping\"\r\n                  />\r\n                )}\r\n              </TabsContent>\r\n            </Tabs>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n      \r\n      {/* Mapping Dialog - Using shared PkgxMappingDialog component */}\r\n      <PkgxMappingDialog\r\n        open={isDialogOpen}\r\n        onOpenChange={setIsDialogOpen}\r\n        type=\"category\"\r\n        isEditing={!!editingMapping}\r\n        hrmItems={hrmCategories.map((c) => ({\r\n          id: c.systemId,\r\n          name: c.path || c.name,\r\n        }))}\r\n        selectedHrmId={selectedHrmCategory}\r\n        onSelectHrmId={setSelectedHrmCategory}\r\n        pkgxItems={settings.categories.map((c) => ({\r\n          id: c.id.toString(),\r\n          name: c.name,\r\n          subText: `ID: ${c.id}`,\r\n        }))}\r\n        selectedPkgxId={selectedPkgxCategory}\r\n        onSelectPkgxId={setSelectedPkgxCategory}\r\n        pkgxSuggestions={validation.suggestions.map(s => ({\r\n          item: { id: s.category.id.toString(), name: s.category.name },\r\n          score: s.score,\r\n        }))}\r\n        validation={validation.validationResult}\r\n        hasErrors={validation.hasErrors}\r\n        isValidating={validation.isValidating}\r\n        showWarningConfirm={showWarningConfirm}\r\n        onConfirm={handleSave}\r\n        onCancel={handleCloseDialog}\r\n      />\r\n      \r\n      {/* Category Detail Dialog */}\r\n      <Dialog open={isDetailDialogOpen} onOpenChange={setIsDetailDialogOpen}>\r\n        <DialogContent className=\"max-w-2xl\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-2\">\r\n              <FolderTree className=\"h-5 w-5\" />\r\n              Chi tiết danh mục PKGX\r\n            </DialogTitle>\r\n            <DialogDescription>\r\n              {selectedCategoryForDetail ? `ID: ${selectedCategoryForDetail.cat_id}` : 'Đang tải...'}\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          \r\n          {isLoadingDetail ? (\r\n            <div className=\"flex items-center justify-center py-8\">\r\n              <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\r\n            </div>\r\n          ) : selectedCategoryForDetail ? (\r\n            <ScrollArea className=\"max-h-[60vh] pr-4\">\r\n              <div className=\"space-y-4\">\r\n                {/* Basic info */}\r\n                <div className=\"space-y-2\">\r\n                  <Label className=\"text-sm font-medium\">Tên danh mục</Label>\r\n                  <div className=\"p-2 border rounded text-sm font-medium\">\r\n                    {selectedCategoryForDetail.cat_name}\r\n                  </div>\r\n                </div>\r\n                \r\n                <div className=\"grid grid-cols-2 gap-4\">\r\n                  <div className=\"space-y-1\">\r\n                    <Label className=\"text-xs text-muted-foreground\">Parent ID</Label>\r\n                    <div className=\"p-2 border rounded text-sm\">\r\n                      {selectedCategoryForDetail.parent_id || 'Không có (Root)'}\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"space-y-1\">\r\n                    <Label className=\"text-xs text-muted-foreground\">Thứ tự</Label>\r\n                    <div className=\"p-2 border rounded text-sm\">\r\n                      {selectedCategoryForDetail.sort_order}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                \r\n                {/* SEO Info */}\r\n                <div className=\"space-y-3\">\r\n                  <Label className=\"text-sm font-medium\">Thông tin SEO</Label>\r\n                  <div className=\"space-y-2\">\r\n                    <div className=\"space-y-1\">\r\n                      <Label className=\"text-xs text-muted-foreground\">Alias (Slug)</Label>\r\n                      <div className=\"p-2 border rounded text-sm\">\r\n                        {selectedCategoryForDetail.cat_alias || '-'}\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"space-y-1\">\r\n                      <Label className=\"text-xs text-muted-foreground\">Keywords</Label>\r\n                      <div className=\"p-2 border rounded text-sm\">\r\n                        {selectedCategoryForDetail.keywords || '-'}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                \r\n                {/* Description */}\r\n                <div className=\"space-y-1\">\r\n                  <Label className=\"text-sm font-medium\">Mô tả danh mục</Label>\r\n                  {selectedCategoryForDetail.cat_desc ? (\r\n                    <div \r\n                      className=\"p-3 border rounded text-sm max-h-40 overflow-y-auto bg-muted/30\"\r\n                      dangerouslySetInnerHTML={{ __html: selectedCategoryForDetail.cat_desc }}\r\n                    />\r\n                  ) : (\r\n                    <div className=\"p-2 border rounded text-sm text-muted-foreground\">Chưa có mô tả</div>\r\n                  )}\r\n                </div>\r\n                \r\n                {/* Mapping status */}\r\n                {findMapping(selectedCategoryForDetail.cat_id) && (\r\n                  <div className=\"p-3 bg-green-50 border border-green-200 rounded-lg\">\r\n                    <div className=\"flex items-center gap-2 text-green-700\">\r\n                      <CheckCircle2 className=\"h-4 w-4\" />\r\n                      <span className=\"font-medium\">Đã mapping với HRM:</span>\r\n                      <span>{findMapping(selectedCategoryForDetail.cat_id)?.hrmCategoryName}</span>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </ScrollArea>\r\n          ) : null}\r\n          \r\n          <DialogFooter className=\"gap-2\">\r\n            {selectedCategoryForDetail && (\r\n              <>\r\n                {findMapping(selectedCategoryForDetail.cat_id) && (\r\n                  <Button \r\n                    variant=\"outline\" \r\n                    size=\"sm\"\r\n                    onClick={() => handlePushCategory(selectedCategoryForDetail.cat_id)}\r\n                    disabled={isPushing}\r\n                  >\r\n                    {isPushing ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : <Upload className=\"h-4 w-4 mr-2\" />}\r\n                    Đẩy HRM → PKGX\r\n                  </Button>\r\n                )}\r\n                <Button \r\n                  variant=\"outline\" \r\n                  size=\"sm\"\r\n                  onClick={() => window.open(`https://phukiengiaxuong.com.vn/admin/category.php?act=edit&cat_id=${selectedCategoryForDetail.cat_id}`, '_blank')}\r\n                >\r\n                  <ExternalLink className=\"h-4 w-4 mr-2\" />\r\n                  Xem trên PKGX\r\n                </Button>\r\n              </>\r\n            )}\r\n            <Button variant=\"outline\" onClick={() => setIsDetailDialogOpen(false)}>\r\n              Đóng\r\n            </Button>\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n      \r\n      {/* Confirmation Dialog for sync actions - using shared component */}\r\n      <PkgxSyncConfirmDialog\r\n        confirmAction={entitySync.confirmAction}\r\n        isSyncing={entitySync.isSyncing}\r\n        onConfirm={entitySync.executeAction}\r\n        onCancel={entitySync.cancelConfirm}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6103, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/inventory/brand-store.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { asSystemId, asBusinessId, type SystemId, type BusinessId } from '@/lib/id-types';\r\nimport type { Brand } from './types';\r\n\r\ninterface BrandState {\r\n  data: Brand[];\r\n  counter: number;\r\n  initialized: boolean;\r\n  add: (brand: Omit<Brand, 'systemId' | 'createdAt' | 'updatedAt'> & { id?: string }) => void;\r\n  update: (systemId: SystemId, brand: Partial<Brand>) => void;\r\n  remove: (systemId: SystemId) => void;\r\n  getActive: () => Brand[];\r\n  findById: (systemId: SystemId) => Brand | undefined;\r\n  findByBusinessId: (id: BusinessId) => Brand | undefined;\r\n  getNextId: () => BusinessId;\r\n  isBusinessIdExists: (id: string) => boolean;\r\n  loadFromAPI: () => Promise<void>;\r\n}\r\n\r\nconst generateSystemId = (currentCounter: number): SystemId => {\r\n  return asSystemId(`BRAND${String(currentCounter + 1).padStart(6, '0')}`);\r\n};\r\n\r\nconst generateBusinessId = (currentCounter: number): BusinessId => {\r\n  return asBusinessId(`TH${String(currentCounter + 1).padStart(6, '0')}`);\r\n};\r\n\r\n// API sync helper\r\nasync function syncBrandToAPI(brand: Brand, action: 'create' | 'update' | 'delete'): Promise<boolean> {\r\n  try {\r\n    const endpoint = action === 'create' ? '/api/brands' : `/api/brands/${brand.systemId}`;\r\n    const response = await fetch(endpoint, {\r\n      method: action === 'create' ? 'POST' : action === 'delete' ? 'DELETE' : 'PUT',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify(brand),\r\n    });\r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error('syncBrandToAPI error:', error);\r\n    return false;\r\n  }\r\n}\r\n\r\nexport const useBrandStore = create<BrandState>()(\r\n  (set, get) => ({\r\n    data: [],\r\n    counter: 0,\r\n    initialized: false,\r\n      \r\n    add: (brand) => {\r\n        const currentCounter = get().counter;\r\n        const { id, ...rest } = brand;\r\n        const businessId = id && id.trim() \r\n          ? asBusinessId(id.trim())\r\n          : generateBusinessId(currentCounter);\r\n          \r\n        set((state) => ({\r\n          data: [\r\n            ...state.data,\r\n            {\r\n              ...rest,\r\n              systemId: generateSystemId(currentCounter),\r\n              id: businessId,\r\n              createdAt: new Date().toISOString(),\r\n              updatedAt: new Date().toISOString(),\r\n              isActive: brand.isActive ?? true,\r\n              isDeleted: false,\r\n            },\r\n          ],\r\n          counter: state.counter + 1,\r\n        }));\r\n      },\r\n      \r\n      update: (systemId, brand) => set((state) => ({\r\n        data: state.data.map((item) =>\r\n          item.systemId === systemId\r\n            ? { ...item, ...brand, updatedAt: new Date().toISOString() }\r\n            : item\r\n        ),\r\n      })),\r\n      \r\n      remove: (systemId) => set((state) => ({\r\n        data: state.data.map((item) =>\r\n          item.systemId === systemId\r\n            ? { ...item, isDeleted: true, updatedAt: new Date().toISOString() }\r\n            : item\r\n        ),\r\n      })),\r\n      \r\n      getActive: () => get().data.filter((item) => !item.isDeleted && item.isActive),\r\n      \r\n      findById: (systemId) => get().data.find((item) => item.systemId === systemId),\r\n      \r\n      findByBusinessId: (id) => get().data.find((item) => item.id === id),\r\n      \r\n      getNextId: () => generateBusinessId(get().counter),\r\n      \r\n      isBusinessIdExists: (id: string) => get().data.some((item) => String(item.id) === id),\r\n\r\n      loadFromAPI: async () => {\r\n        if (get().initialized) return;\r\n        try {\r\n          const response = await fetch('/api/brands?all=true');\r\n          if (response.ok) {\r\n            const json = await response.json();\r\n            if (json.data && Array.isArray(json.data)) {\r\n              const brands: Brand[] = json.data.map((item: Record<string, unknown>) => ({\r\n                ...item,\r\n                systemId: asSystemId(item.systemId as string),\r\n                id: asBusinessId(item.id as string),\r\n                // Add default values for fields not in database\r\n                isActive: item.isDeleted !== true,\r\n              }));\r\n              set({ \r\n                data: brands, \r\n                counter: brands.length,\r\n                initialized: true,\r\n              });\r\n            }\r\n          }\r\n        } catch (error) {\r\n          console.error('loadFromAPI error:', error);\r\n        }\r\n        set({ initialized: true });\r\n      },\r\n    })\r\n);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6210, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/components/brand-mapping-tab.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../../../../components/ui/card';\r\nimport { Button } from '../../../../components/ui/button';\r\nimport { Input } from '../../../../components/ui/input';\r\nimport { Badge } from '../../../../components/ui/badge';\r\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '../../../../components/ui/tabs';\r\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from '../../../../components/ui/dialog';\r\nimport { Label } from '../../../../components/ui/label';\r\nimport { ScrollArea } from '../../../../components/ui/scroll-area';\r\nimport { Plus, Pencil, Trash2, RefreshCw, Search, Loader2, Award, Link, Unlink, CheckCircle2, MoreHorizontal, ExternalLink, Upload, AlignLeft, Globe, Link2 } from 'lucide-react';\r\nimport { Checkbox } from '../../../../components/ui/checkbox';\r\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuSeparator, DropdownMenuTrigger } from '../../../../components/ui/dropdown-menu';\r\nimport { getBrandById, updateBrand } from '../../../../lib/pkgx/api-service';\r\nimport { toast } from 'sonner';\r\nimport { usePkgxSettingsStore } from '../store';\r\nimport { useBrandStore } from '../../inventory/brand-store';\r\nimport { ResponsiveDataTable } from '../../../../components/data-table/responsive-data-table';\r\nimport type { ColumnDef } from '../../../../components/data-table/types';\r\nimport type { PkgxBrandMapping, PkgxBrand, PkgxBrandFromApi } from '../types';\r\nimport { useBrandMappingValidation, usePkgxEntitySync } from '../hooks';\r\nimport type { HrmBrandData } from '../hooks';\r\nimport type { BrandMappingInput } from '../validation';\r\nimport { PkgxMappingDialog } from '../../../../components/shared/pkgx-mapping-dialog';\r\nimport { PkgxSyncConfirmDialog } from './pkgx-sync-confirm-dialog';\r\n\r\n// Extended type for PKGX brands table\r\ninterface PkgxBrandRow extends PkgxBrand {\r\n  systemId: string;\r\n  mappedToHrm?: string;\r\n}\r\n\r\n// Extended type for mappings table\r\ninterface MappingRow extends PkgxBrandMapping {\r\n  systemId: string;\r\n}\r\n\r\nexport function BrandMappingTab() {\r\n  const { \r\n    settings, \r\n    addBrandMapping, \r\n    updateBrandMapping, \r\n    deleteBrandMapping,\r\n    syncBrandsFromPkgx,\r\n    addLog,\r\n  } = usePkgxSettingsStore();\r\n  const brandStore = useBrandStore();\r\n  \r\n  const [searchTerm, setSearchTerm] = React.useState('');\r\n  const [activeTab, setActiveTab] = React.useState('pkgx-brands');\r\n  const [isDialogOpen, setIsDialogOpen] = React.useState(false);\r\n  const [editingMapping, setEditingMapping] = React.useState<PkgxBrandMapping | null>(null);\r\n  const [isSyncing, setIsSyncing] = React.useState(false);\r\n  \r\n  // Detail dialog state\r\n  const [isDetailDialogOpen, setIsDetailDialogOpen] = React.useState(false);\r\n  const [selectedBrandForDetail, setSelectedBrandForDetail] = React.useState<PkgxBrandFromApi | null>(null);\r\n  const [isLoadingDetail, setIsLoadingDetail] = React.useState(false);\r\n  const [isPushing, setIsPushing] = React.useState(false);\r\n  \r\n  // Table state\r\n  const [pagination, setPagination] = React.useState({ pageIndex: 0, pageSize: 20 });\r\n  const [sorting, setSorting] = React.useState<{ id: string; desc: boolean }>({ id: 'id', desc: false });\r\n  const [rowSelection, setRowSelection] = React.useState<Record<string, boolean>>({});\r\n  \r\n  // Form state\r\n  const [selectedHrmBrand, setSelectedHrmBrand] = React.useState('');\r\n  const [selectedPkgxBrand, setSelectedPkgxBrand] = React.useState('');\r\n  const [showWarningConfirm, setShowWarningConfirm] = React.useState(false);\r\n  \r\n  // Use shared PKGX entity sync hook\r\n  const entitySync = usePkgxEntitySync({\r\n    entityType: 'brand',\r\n    onLog: addLog,\r\n  });\r\n  \r\n  const hrmBrands = React.useMemo(\r\n    () => brandStore.getActive().sort((a, b) => a.name.localeCompare(b.name)),\r\n    [brandStore]\r\n  );\r\n  \r\n  // Validation hook\r\n  const validation = useBrandMappingValidation({\r\n    existingMappings: settings.brandMappings,\r\n    hrmBrands: hrmBrands,\r\n    pkgxBrands: settings.brands,\r\n    editingMappingId: editingMapping?.id,\r\n    debounceMs: 300,\r\n  });\r\n  \r\n  // Find if PKGX brand is mapped\r\n  const findMapping = React.useCallback((pkgxBrandId: number) => {\r\n    return settings.brandMappings.find(m => m.pkgxBrandId === pkgxBrandId);\r\n  }, [settings.brandMappings]);\r\n  \r\n  // PKGX Brands data for table\r\n  const pkgxBrandsData = React.useMemo((): PkgxBrandRow[] => {\r\n    let filtered = settings.brands;\r\n    if (searchTerm) {\r\n      const term = searchTerm.toLowerCase();\r\n      filtered = settings.brands.filter(b => \r\n        b.name.toLowerCase().includes(term) ||\r\n        b.id.toString().includes(term)\r\n      );\r\n    }\r\n    return filtered.map(b => ({\r\n      ...b,\r\n      systemId: b.id.toString(),\r\n      mappedToHrm: findMapping(b.id)?.hrmBrandName,\r\n    }));\r\n  }, [settings.brands, searchTerm, findMapping]);\r\n  \r\n  // Mappings data for table\r\n  const mappingsData = React.useMemo((): MappingRow[] => {\r\n    let filtered = settings.brandMappings;\r\n    if (searchTerm) {\r\n      const term = searchTerm.toLowerCase();\r\n      filtered = settings.brandMappings.filter(m =>\r\n        m.hrmBrandName.toLowerCase().includes(term) ||\r\n        m.pkgxBrandName.toLowerCase().includes(term)\r\n      );\r\n    }\r\n    return filtered.map(m => ({\r\n      ...m,\r\n      systemId: m.id,\r\n    }));\r\n  }, [settings.brandMappings, searchTerm]);\r\n  \r\n  // Paginated data\r\n  const paginatedPkgxData = React.useMemo(() => {\r\n    const start = pagination.pageIndex * pagination.pageSize;\r\n    return pkgxBrandsData.slice(start, start + pagination.pageSize);\r\n  }, [pkgxBrandsData, pagination]);\r\n  \r\n  const paginatedMappingsData = React.useMemo(() => {\r\n    const start = pagination.pageIndex * pagination.pageSize;\r\n    return mappingsData.slice(start, start + pagination.pageSize);\r\n  }, [mappingsData, pagination]);\r\n  \r\n  // All selected rows and bulk actions for PKGX brands table\r\n  const allSelectedPkgxRows = React.useMemo(() => \r\n    paginatedPkgxData.filter(p => rowSelection[p.systemId]),\r\n  [paginatedPkgxData, rowSelection]);\r\n  \r\n  // Get selected PKGX brands that are NOT mapped (for bulk mapping)\r\n  const selectedUnmappedBrands = React.useMemo(() => \r\n    allSelectedPkgxRows.filter(b => !b.mappedToHrm),\r\n  [allSelectedPkgxRows]);\r\n  \r\n  // Get selected PKGX brands that ARE mapped (for bulk unlink)\r\n  const selectedMappedBrands = React.useMemo(() => \r\n    allSelectedPkgxRows.filter(b => b.mappedToHrm),\r\n  [allSelectedPkgxRows]);\r\n  \r\n  // Bulk actions for PKGX brands table\r\n  const pkgxBulkActions = React.useMemo(() => [\r\n    {\r\n      label: `Hủy mapping (${selectedMappedBrands.length})`,\r\n      icon: Unlink,\r\n      variant: 'destructive' as const,\r\n      disabled: selectedMappedBrands.length === 0,\r\n      onSelect: () => {\r\n        if (selectedMappedBrands.length === 0) {\r\n          toast.error('Không có thương hiệu đã mapping nào được chọn');\r\n          return;\r\n        }\r\n        // Bulk delete mappings\r\n        selectedMappedBrands.forEach(brand => {\r\n          const mapping = findMapping(brand.id);\r\n          if (mapping) {\r\n            deleteBrandMapping(mapping.id);\r\n          }\r\n        });\r\n        toast.success(`Đã hủy mapping ${selectedMappedBrands.length} thương hiệu`);\r\n        setRowSelection({});\r\n      },\r\n    },\r\n  ], [selectedMappedBrands, findMapping, deleteBrandMapping]);\r\n  \r\n  // PKGX Brands columns\r\n  const pkgxColumns: ColumnDef<PkgxBrandRow>[] = React.useMemo(() => [\r\n    {\r\n      id: 'select',\r\n      header: ({ isAllPageRowsSelected, isSomePageRowsSelected, onToggleAll }) => (\r\n        <Checkbox\r\n          checked={isAllPageRowsSelected ? true : (isSomePageRowsSelected ? 'indeterminate' : false)}\r\n          onCheckedChange={(checked) => onToggleAll?.(checked === true)}\r\n          aria-label=\"Select all\"\r\n        />\r\n      ),\r\n      cell: ({ row, isSelected, onToggleSelect }) => (\r\n        <Checkbox\r\n          checked={isSelected}\r\n          onCheckedChange={() => onToggleSelect(!isSelected)}\r\n          aria-label=\"Select row\"\r\n          onClick={(e) => e.stopPropagation()}\r\n        />\r\n      ),\r\n      size: 48,\r\n      enableSorting: false,\r\n      meta: { displayName: 'Chọn', sticky: 'left' },\r\n    },\r\n    {\r\n      id: 'id',\r\n      accessorKey: 'id',\r\n      header: 'ID',\r\n      size: 70,\r\n      cell: ({ row }) => <span className=\"font-mono text-xs\">{row.id}</span>,\r\n    },\r\n    {\r\n      id: 'name',\r\n      accessorKey: 'name',\r\n      header: 'Thương hiệu PKGX',\r\n      cell: ({ row }) => <span className=\"font-medium\">{row.name}</span>,\r\n    },\r\n    {\r\n      id: 'mappedToHrm',\r\n      header: 'Mapping HRM',\r\n      cell: ({ row }) => (\r\n        row.mappedToHrm ? (\r\n          <Badge variant=\"default\" className=\"bg-green-500\">\r\n            <CheckCircle2 className=\"h-3 w-3 mr-1\" />\r\n            {row.mappedToHrm}\r\n          </Badge>\r\n        ) : (\r\n          <Badge variant=\"secondary\">Chưa mapping</Badge>\r\n        )\r\n      ),\r\n    },\r\n    {\r\n      id: 'actions',\r\n      header: '',\r\n      size: 50,\r\n      cell: ({ row }) => {\r\n        // Get HRM brand for sync actions\r\n        const mapping = findMapping(row.id);\r\n        const hrmBrand = mapping ? hrmBrands.find(b => b.systemId === mapping.hrmBrandSystemId) : null;\r\n        \r\n        // Helper to trigger sync with proper HRM data\r\n        const triggerSync = (actionKey: 'sync_all' | 'sync_basic' | 'sync_seo' | 'sync_description') => {\r\n          if (!mapping || !hrmBrand) {\r\n            toast.error('Thương hiệu chưa được liên kết với HRM');\r\n            return;\r\n          }\r\n          const hrmData: HrmBrandData = {\r\n            systemId: hrmBrand.systemId,\r\n            name: hrmBrand.name,\r\n            website: hrmBrand.website,\r\n            seoKeywords: hrmBrand.seoKeywords,\r\n            seoTitle: hrmBrand.seoTitle,\r\n            metaDescription: hrmBrand.metaDescription,\r\n            shortDescription: hrmBrand.shortDescription,\r\n            longDescription: hrmBrand.longDescription,\r\n            websiteSeo: hrmBrand.websiteSeo,\r\n          };\r\n          entitySync.triggerSyncAction(actionKey, row.id, hrmData, row.name);\r\n        };\r\n        \r\n        return (\r\n          <DropdownMenu>\r\n            <DropdownMenuTrigger asChild>\r\n              <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\r\n                <MoreHorizontal className=\"h-4 w-4\" />\r\n              </Button>\r\n            </DropdownMenuTrigger>\r\n            <DropdownMenuContent align=\"end\">\r\n              {row.mappedToHrm ? (\r\n                <>\r\n                  {/* Sync All */}\r\n                  <DropdownMenuItem \r\n                    onClick={() => triggerSync('sync_all')}\r\n                    className=\"font-medium\"\r\n                    title=\"Đồng bộ: Tên, Website, Keywords, Meta Title, Meta Desc, Mô tả ngắn, Mô tả dài\"\r\n                  >\r\n                    <RefreshCw className=\"h-4 w-4 mr-2\" />\r\n                    Đồng bộ tất cả\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuSeparator />\r\n                  \r\n                  {/* Individual sync actions */}\r\n                  <DropdownMenuItem \r\n                    onClick={() => triggerSync('sync_basic')}\r\n                    title=\"Đồng bộ: Tên thương hiệu, Website URL\"\r\n                  >\r\n                    <Globe className=\"h-4 w-4 mr-2\" />\r\n                    Thông tin cơ bản\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuItem \r\n                    onClick={() => triggerSync('sync_seo')}\r\n                    title=\"Đồng bộ: Keywords, Meta Title, Meta Desc\"\r\n                  >\r\n                    <Search className=\"h-4 w-4 mr-2\" />\r\n                    SEO\r\n                  </DropdownMenuItem>\r\n                  <DropdownMenuItem \r\n                    onClick={() => triggerSync('sync_description')}\r\n                    title=\"Đồng bộ: Mô tả ngắn (Short Desc), Mô tả dài (Long Desc)\"\r\n                  >\r\n                    <AlignLeft className=\"h-4 w-4 mr-2\" />\r\n                    Mô tả\r\n                  </DropdownMenuItem>\r\n                  \r\n                  <DropdownMenuSeparator />\r\n                  <DropdownMenuItem onClick={() => window.open(`https://phukiengiaxuong.com.vn/admin/brand.php?act=edit&brand_id=${row.id}`, '_blank')}>\r\n                    <ExternalLink className=\"h-4 w-4 mr-2\" />\r\n                    Xem trên PKGX\r\n                  </DropdownMenuItem>\r\n                  \r\n                  {/* Hủy liên kết */}\r\n                  <DropdownMenuSeparator />\r\n                  <DropdownMenuItem \r\n                    onClick={() => entitySync.handleConfirm(\r\n                      'Hủy liên kết PKGX',\r\n                      `Bạn có chắc muốn hủy liên kết thương hiệu \"${row.name}\" với PKGX?`,\r\n                      () => handleUnlinkBrand(row.id)\r\n                    )}\r\n                    className=\"text-destructive focus:text-destructive\"\r\n                  >\r\n                    <Unlink className=\"h-4 w-4 mr-2\" />\r\n                    Hủy liên kết\r\n                  </DropdownMenuItem>\r\n                </>\r\n              ) : (\r\n                /* Not linked - show link option */\r\n                <>\r\n                  <DropdownMenuItem onClick={() => handleQuickMap(row)}>\r\n                    <Link2 className=\"h-4 w-4 mr-2\" />\r\n                    Liên kết với HRM\r\n                  </DropdownMenuItem>\r\n                </>\r\n              )}\r\n            </DropdownMenuContent>\r\n          </DropdownMenu>\r\n        );\r\n      },\r\n    },\r\n  ], [hrmBrands, findMapping, entitySync]);\r\n  \r\n  // Mappings columns\r\n  const mappingColumns: ColumnDef<MappingRow>[] = React.useMemo(() => [\r\n    {\r\n      id: 'hrmBrandName',\r\n      accessorKey: 'hrmBrandName',\r\n      header: 'Thương hiệu HRM',\r\n      cell: ({ row }) => <span className=\"font-medium\">{row.hrmBrandName}</span>,\r\n    },\r\n    {\r\n      id: 'pkgxBrandName',\r\n      accessorKey: 'pkgxBrandName',\r\n      header: 'Thương hiệu PKGX',\r\n      cell: ({ row }) => <span>{row.pkgxBrandName}</span>,\r\n    },\r\n    {\r\n      id: 'pkgxBrandId',\r\n      accessorKey: 'pkgxBrandId',\r\n      header: 'ID PKGX',\r\n      size: 80,\r\n      cell: ({ row }) => <span className=\"font-mono text-muted-foreground\">{row.pkgxBrandId}</span>,\r\n    },\r\n    {\r\n      id: 'actions',\r\n      header: 'Hành động',\r\n      size: 100,\r\n      cell: ({ row }) => (\r\n        <div className=\"flex justify-end gap-1\">\r\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => handleOpenDialog(row)}>\r\n            <Pencil className=\"h-4 w-4\" />\r\n          </Button>\r\n          <Button variant=\"ghost\" size=\"sm\" onClick={() => handleDelete(row.id)}>\r\n            <Trash2 className=\"h-4 w-4 text-destructive\" />\r\n          </Button>\r\n        </div>\r\n      ),\r\n    },\r\n  ], []);\r\n  \r\n  const handleQuickMap = (pkgxBrand: PkgxBrandRow) => {\r\n    setSelectedPkgxBrand(pkgxBrand.id.toString());\r\n    setSelectedHrmBrand('');\r\n    setEditingMapping(null);\r\n    setIsDialogOpen(true);\r\n  };\r\n  \r\n  const handleUnlinkBrand = (pkgxBrandId: number) => {\r\n    const mapping = findMapping(pkgxBrandId);\r\n    if (mapping) {\r\n      deleteBrandMapping(mapping.id);\r\n      addLog({\r\n        action: 'unlink_mapping',\r\n        status: 'success',\r\n        message: `Đã hủy liên kết thương hiệu: ${mapping.hrmBrandName} ↔ ${mapping.pkgxBrandName}`,\r\n        details: { brandId: pkgxBrandId },\r\n      });\r\n      toast.success('Đã hủy liên kết thương hiệu');\r\n    }\r\n  };\r\n  \r\n  const handleOpenDialog = (mapping?: PkgxBrandMapping) => {\r\n    if (mapping) {\r\n      setEditingMapping(mapping);\r\n      setSelectedHrmBrand(mapping.hrmBrandSystemId);\r\n      setSelectedPkgxBrand(mapping.pkgxBrandId.toString());\r\n    } else {\r\n      setEditingMapping(null);\r\n      setSelectedHrmBrand('');\r\n      setSelectedPkgxBrand('');\r\n    }\r\n    setIsDialogOpen(true);\r\n  };\r\n  \r\n  const handleCloseDialog = () => {\r\n    setIsDialogOpen(false);\r\n    setEditingMapping(null);\r\n    setSelectedHrmBrand('');\r\n    setSelectedPkgxBrand('');\r\n    setShowWarningConfirm(false);\r\n    validation.clearValidation();\r\n  };\r\n  \r\n  // Validate when form values change\r\n  React.useEffect(() => {\r\n    if (isDialogOpen && (selectedHrmBrand || selectedPkgxBrand)) {\r\n      const input: BrandMappingInput = {\r\n        hrmBrandSystemId: selectedHrmBrand || '',\r\n        hrmBrandName: hrmBrands.find(b => b.systemId === selectedHrmBrand)?.name || '',\r\n        pkgxBrandId: selectedPkgxBrand ? parseInt(selectedPkgxBrand) : '',\r\n        pkgxBrandName: settings.brands.find(b => b.id === parseInt(selectedPkgxBrand))?.name || '',\r\n      };\r\n      validation.validateAsync(input);\r\n    }\r\n  }, [selectedHrmBrand, selectedPkgxBrand, isDialogOpen]);\r\n  \r\n  const handleSave = () => {\r\n    // Build input for validation\r\n    const input: BrandMappingInput = {\r\n      hrmBrandSystemId: selectedHrmBrand || '',\r\n      hrmBrandName: hrmBrands.find(b => b.systemId === selectedHrmBrand)?.name || '',\r\n      pkgxBrandId: selectedPkgxBrand ? parseInt(selectedPkgxBrand) : '',\r\n      pkgxBrandName: settings.brands.find(b => b.id === parseInt(selectedPkgxBrand))?.name || '',\r\n    };\r\n    \r\n    // Run final validation\r\n    const result = validation.validate(input);\r\n    \r\n    // Block if there are errors\r\n    if (!result.isValid) {\r\n      toast.error(result.errors[0]?.message || 'Vui lòng kiểm tra lại thông tin');\r\n      return;\r\n    }\r\n    \r\n    // Show warning confirmation if there are warnings and not yet confirmed\r\n    if (result.warnings.length > 0 && !showWarningConfirm) {\r\n      setShowWarningConfirm(true);\r\n      return;\r\n    }\r\n    \r\n    const hrmBrand = hrmBrands.find((b) => b.systemId === selectedHrmBrand);\r\n    const pkgxBrand = settings.brands.find((b) => b.id === parseInt(selectedPkgxBrand));\r\n    \r\n    if (!hrmBrand || !pkgxBrand) {\r\n      toast.error('Không tìm thấy thương hiệu');\r\n      return;\r\n    }\r\n    \r\n    if (editingMapping) {\r\n      updateBrandMapping(editingMapping.id, {\r\n        hrmBrandSystemId: hrmBrand.systemId,\r\n        hrmBrandName: hrmBrand.name,\r\n        pkgxBrandId: pkgxBrand.id,\r\n        pkgxBrandName: pkgxBrand.name,\r\n      });\r\n      addLog({\r\n        action: 'save_mapping',\r\n        status: 'success',\r\n        message: `Cập nhật mapping thương hiệu: ${hrmBrand.name} → ${pkgxBrand.name}`,\r\n        details: { brandId: pkgxBrand.id },\r\n      });\r\n      toast.success('Đã cập nhật mapping thương hiệu');\r\n    } else {\r\n      addBrandMapping({\r\n        id: `brandmap-${Date.now()}`,\r\n        hrmBrandSystemId: hrmBrand.systemId,\r\n        hrmBrandName: hrmBrand.name,\r\n        pkgxBrandId: pkgxBrand.id,\r\n        pkgxBrandName: pkgxBrand.name,\r\n      });\r\n      addLog({\r\n        action: 'save_mapping',\r\n        status: 'success',\r\n        message: `Thêm mapping thương hiệu: ${hrmBrand.name} → ${pkgxBrand.name}`,\r\n        details: { brandId: pkgxBrand.id },\r\n      });\r\n      toast.success('Đã thêm mapping thương hiệu');\r\n    }\r\n    \r\n    handleCloseDialog();\r\n  };\r\n  \r\n  const handleDelete = (id: string) => {\r\n    const mapping = settings.brandMappings.find(m => m.id === id);\r\n    deleteBrandMapping(id);\r\n    if (mapping) {\r\n      addLog({\r\n        action: 'save_mapping',\r\n        status: 'info',\r\n        message: `Xóa mapping thương hiệu: ${mapping.hrmBrandName}`,\r\n        details: { brandId: mapping.pkgxBrandId },\r\n      });\r\n    }\r\n    toast.success('Đã xóa mapping thương hiệu');\r\n  };\r\n  \r\n  const handleSyncFromPkgx = async () => {\r\n    setIsSyncing(true);\r\n    try {\r\n      await syncBrandsFromPkgx();\r\n      toast.success('Đã đồng bộ thương hiệu từ PKGX');\r\n    } catch (error) {\r\n      toast.error(error instanceof Error ? error.message : 'Lỗi khi đồng bộ thương hiệu');\r\n    } finally {\r\n      setIsSyncing(false);\r\n    }\r\n  };\r\n  \r\n  // View brand detail\r\n  const handleViewDetail = async (pkgxBrandId: number) => {\r\n    setIsLoadingDetail(true);\r\n    setIsDetailDialogOpen(true);\r\n    try {\r\n      const response = await getBrandById(pkgxBrandId);\r\n      if (response.success && response.data) {\r\n        setSelectedBrandForDetail(response.data);\r\n      } else {\r\n        toast.error('Không tìm thấy thương hiệu');\r\n        setIsDetailDialogOpen(false);\r\n      }\r\n    } catch (error) {\r\n      toast.error('Không thể tải thông tin thương hiệu');\r\n      setIsDetailDialogOpen(false);\r\n    } finally {\r\n      setIsLoadingDetail(false);\r\n    }\r\n  };\r\n  \r\n  // Push brand from HRM to PKGX\r\n  const handlePushBrand = async (pkgxBrandId: number) => {\r\n    const mapping = findMapping(pkgxBrandId);\r\n    if (!mapping) {\r\n      toast.error('Thương hiệu chưa được mapping với HRM');\r\n      return;\r\n    }\r\n    \r\n    const hrmBrand = hrmBrands.find(b => b.systemId === mapping.hrmBrandSystemId);\r\n    if (!hrmBrand) {\r\n      toast.error('Không tìm thấy thương hiệu HRM');\r\n      return;\r\n    }\r\n    \r\n    setIsPushing(true);\r\n    try {\r\n      await updateBrand(pkgxBrandId, {\r\n        brand_name: hrmBrand.name,\r\n        brand_desc: hrmBrand.description || '',\r\n        site_url: '',\r\n      });\r\n      \r\n      // Refresh detail\r\n      const response = await getBrandById(pkgxBrandId);\r\n      if (response.success && response.data) {\r\n        setSelectedBrandForDetail(response.data);\r\n      }\r\n      \r\n      addLog({\r\n        action: 'sync_all',\r\n        status: 'success',\r\n        message: `Đẩy thương hiệu từ HRM sang PKGX: ${hrmBrand.name}`,\r\n        details: { brandId: pkgxBrandId },\r\n      });\r\n      toast.success('Đã đẩy thông tin thương hiệu sang PKGX');\r\n    } catch (error) {\r\n      toast.error(error instanceof Error ? error.message : 'Lỗi khi đẩy thương hiệu');\r\n    } finally {\r\n      setIsPushing(false);\r\n    }\r\n  };\r\n  \r\n  // Mobile card renderers\r\n  const renderPkgxMobileCard = (row: PkgxBrandRow) => (\r\n    <div className=\"p-4 space-y-3\">\r\n      <div className=\"flex items-start justify-between\">\r\n        <div>\r\n          <div className=\"font-medium\">{row.name}</div>\r\n          <div className=\"text-sm text-muted-foreground\">ID: {row.id}</div>\r\n        </div>\r\n        {row.mappedToHrm ? (\r\n          <Badge variant=\"default\" className=\"bg-green-500 shrink-0\">\r\n            <CheckCircle2 className=\"h-3 w-3 mr-1\" />\r\n            Đã mapping\r\n          </Badge>\r\n        ) : (\r\n          <Badge variant=\"secondary\" className=\"shrink-0\">Chưa mapping</Badge>\r\n        )}\r\n      </div>\r\n      {row.mappedToHrm && (\r\n        <div className=\"text-sm\">\r\n          <span className=\"text-muted-foreground\">HRM: </span>\r\n          <span>{row.mappedToHrm}</span>\r\n        </div>\r\n      )}\r\n      {!row.mappedToHrm && (\r\n        <Button\r\n          variant=\"outline\"\r\n          size=\"sm\"\r\n          className=\"w-full\"\r\n          onClick={() => handleQuickMap(row)}\r\n        >\r\n          <Link className=\"h-4 w-4 mr-2\" />\r\n          Mapping nhanh\r\n        </Button>\r\n      )}\r\n    </div>\r\n  );\r\n  \r\n  const renderMappingMobileCard = (row: MappingRow) => (\r\n    <div className=\"p-4 space-y-3\">\r\n      <div>\r\n        <div className=\"font-medium\">{row.hrmBrandName}</div>\r\n        <div className=\"text-sm text-muted-foreground\">\r\n          → {row.pkgxBrandName} (ID: {row.pkgxBrandId})\r\n        </div>\r\n      </div>\r\n      <div className=\"flex gap-2\">\r\n        <Button variant=\"outline\" size=\"sm\" className=\"flex-1\" onClick={() => handleOpenDialog(row)}>\r\n          <Pencil className=\"h-4 w-4 mr-2\" />\r\n          Sửa\r\n        </Button>\r\n        <Button variant=\"outline\" size=\"sm\" className=\"flex-1\" onClick={() => handleDelete(row.id)}>\r\n          <Trash2 className=\"h-4 w-4 mr-2 text-destructive\" />\r\n          Xóa\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n  \r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card>\r\n        <CardHeader>\r\n          <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\r\n            <div>\r\n              <CardTitle className=\"text-lg\">Mapping thương hiệu</CardTitle>\r\n              <CardDescription>\r\n                Liên kết thương hiệu HRM với thương hiệu PKGX để đồng bộ sản phẩm\r\n              </CardDescription>\r\n            </div>\r\n            <div className=\"flex gap-2\">\r\n              <Button onClick={handleSyncFromPkgx} disabled={isSyncing} variant=\"outline\">\r\n                {isSyncing ? <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" /> : <RefreshCw className=\"h-4 w-4 mr-2\" />}\r\n                Đồng bộ từ PKGX\r\n              </Button>\r\n              <Button onClick={() => handleOpenDialog()}>\r\n                <Plus className=\"h-4 w-4 mr-2\" />\r\n                Thêm mapping\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"space-y-4\">\r\n            <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-2\">\r\n              <div className=\"relative flex-1\">\r\n                <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\r\n                <Input\r\n                  placeholder=\"Tìm kiếm thương hiệu...\"\r\n                  value={searchTerm}\r\n                  onChange={(e) => setSearchTerm(e.target.value)}\r\n                  className=\"pl-9\"\r\n                />\r\n              </div>\r\n              <div className=\"text-sm text-muted-foreground whitespace-nowrap text-center sm:text-right\">\r\n                {settings.brands.length} thương hiệu PKGX | {settings.brandMappings.length} mapping\r\n              </div>\r\n            </div>\r\n            \r\n            <Tabs value={activeTab} onValueChange={setActiveTab}>\r\n              <TabsList>\r\n                <TabsTrigger value=\"pkgx-brands\">\r\n                  <Award className=\"h-4 w-4 mr-2\" />\r\n                  Thương hiệu PKGX ({settings.brands.length})\r\n                </TabsTrigger>\r\n                <TabsTrigger value=\"mappings\">\r\n                  <Link className=\"h-4 w-4 mr-2\" />\r\n                  Mapping ({settings.brandMappings.length})\r\n                </TabsTrigger>\r\n              </TabsList>\r\n              \r\n              <TabsContent value=\"pkgx-brands\" className=\"mt-4\">\r\n                {settings.brands.length === 0 ? (\r\n                  <div className=\"text-center py-8 text-muted-foreground\">\r\n                    <Award className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\r\n                    <p>Chưa có thương hiệu từ PKGX.</p>\r\n                    <p className=\"text-sm mt-1\">Bấm \"Đồng bộ từ PKGX\" để lấy danh sách.</p>\r\n                  </div>\r\n                ) : (\r\n                  <ResponsiveDataTable\r\n                    columns={pkgxColumns}\r\n                    data={paginatedPkgxData}\r\n                    renderMobileCard={renderPkgxMobileCard}\r\n                    pageCount={Math.ceil(pkgxBrandsData.length / pagination.pageSize)}\r\n                    pagination={pagination}\r\n                    setPagination={setPagination}\r\n                    rowCount={pkgxBrandsData.length}\r\n                    sorting={sorting}\r\n                    setSorting={setSorting}\r\n                    rowSelection={rowSelection}\r\n                    setRowSelection={setRowSelection}\r\n                    bulkActions={pkgxBulkActions}\r\n                    allSelectedRows={allSelectedPkgxRows}\r\n                    emptyTitle=\"Không tìm thấy thương hiệu\"\r\n                  />\r\n                )}\r\n              </TabsContent>\r\n              \r\n              <TabsContent value=\"mappings\" className=\"mt-4\">\r\n                {settings.brandMappings.length === 0 ? (\r\n                  <div className=\"text-center py-8 text-muted-foreground\">\r\n                    <Link className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\r\n                    <p>Chưa có mapping nào.</p>\r\n                    <p className=\"text-sm mt-1\">Bấm \"Thêm mapping\" để bắt đầu.</p>\r\n                  </div>\r\n                ) : (\r\n                  <ResponsiveDataTable\r\n                    columns={mappingColumns}\r\n                    data={paginatedMappingsData}\r\n                    renderMobileCard={renderMappingMobileCard}\r\n                    pageCount={Math.ceil(mappingsData.length / pagination.pageSize)}\r\n                    pagination={pagination}\r\n                    setPagination={setPagination}\r\n                    rowCount={mappingsData.length}\r\n                    sorting={sorting}\r\n                    setSorting={setSorting}\r\n                    emptyTitle=\"Không tìm thấy mapping\"\r\n                  />\r\n                )}\r\n              </TabsContent>\r\n            </Tabs>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n      \r\n      {/* Mapping Dialog - Using shared PkgxMappingDialog component */}\r\n      <PkgxMappingDialog\r\n        open={isDialogOpen}\r\n        onOpenChange={setIsDialogOpen}\r\n        type=\"brand\"\r\n        isEditing={!!editingMapping}\r\n        hrmItems={hrmBrands.map((b) => ({\r\n          id: b.systemId,\r\n          name: b.name,\r\n        }))}\r\n        selectedHrmId={selectedHrmBrand}\r\n        onSelectHrmId={setSelectedHrmBrand}\r\n        pkgxItems={settings.brands.map((b) => ({\r\n          id: b.id.toString(),\r\n          name: b.name,\r\n          subText: `ID: ${b.id}`,\r\n        }))}\r\n        selectedPkgxId={selectedPkgxBrand}\r\n        onSelectPkgxId={setSelectedPkgxBrand}\r\n        pkgxSuggestions={validation.suggestions.map(s => ({\r\n          item: { id: s.brand.id.toString(), name: s.brand.name },\r\n          score: s.score,\r\n        }))}\r\n        validation={validation.validationResult}\r\n        hasErrors={validation.hasErrors}\r\n        isValidating={validation.isValidating}\r\n        showWarningConfirm={showWarningConfirm}\r\n        onConfirm={handleSave}\r\n        onCancel={handleCloseDialog}\r\n      />\r\n      \r\n      {/* Brand Detail Dialog */}\r\n      <Dialog open={isDetailDialogOpen} onOpenChange={setIsDetailDialogOpen}>\r\n        <DialogContent className=\"max-w-2xl\">\r\n          <DialogHeader>\r\n            <DialogTitle className=\"flex items-center gap-2\">\r\n              <Award className=\"h-5 w-5\" />\r\n              Chi tiết thương hiệu PKGX\r\n            </DialogTitle>\r\n            <DialogDescription>\r\n              Thông tin chi tiết và SEO của thương hiệu\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          \r\n          {isLoadingDetail ? (\r\n            <div className=\"flex items-center justify-center py-12\">\r\n              <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\r\n            </div>\r\n          ) : selectedBrandForDetail ? (\r\n            <ScrollArea className=\"max-h-[60vh]\">\r\n              <div className=\"space-y-6 pr-4\">\r\n                {/* Basic Info */}\r\n                <div className=\"space-y-3\">\r\n                  <h4 className=\"font-medium text-sm text-muted-foreground uppercase tracking-wide\">\r\n                    Thông tin cơ bản\r\n                  </h4>\r\n                  <div className=\"grid grid-cols-2 gap-4 text-sm\">\r\n                    <div>\r\n                      <span className=\"text-muted-foreground\">ID:</span>\r\n                      <span className=\"ml-2 font-mono\">{selectedBrandForDetail.brand_id}</span>\r\n                    </div>\r\n                    <div>\r\n                      <span className=\"text-muted-foreground\">Tên:</span>\r\n                      <span className=\"ml-2 font-medium\">{selectedBrandForDetail.brand_name}</span>\r\n                    </div>\r\n                    {selectedBrandForDetail.brand_logo && (\r\n                      <div className=\"col-span-2\">\r\n                        <span className=\"text-muted-foreground\">Logo:</span>\r\n                        <img \r\n                          src={selectedBrandForDetail.brand_logo} \r\n                          alt={selectedBrandForDetail.brand_name}\r\n                          className=\"mt-2 h-16 object-contain\"\r\n                        />\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n                \r\n                {/* SEO Info */}\r\n                <div className=\"space-y-3\">\r\n                  <h4 className=\"font-medium text-sm text-muted-foreground uppercase tracking-wide\">\r\n                    SEO & Mô tả\r\n                  </h4>\r\n                  <div className=\"space-y-3 text-sm\">\r\n                    <div>\r\n                      <span className=\"text-muted-foreground block mb-1\">Website:</span>\r\n                      {selectedBrandForDetail.site_url ? (\r\n                        <a \r\n                          href={selectedBrandForDetail.site_url} \r\n                          target=\"_blank\" \r\n                          rel=\"noopener noreferrer\"\r\n                          className=\"text-primary hover:underline\"\r\n                        >\r\n                          {selectedBrandForDetail.site_url}\r\n                        </a>\r\n                      ) : (\r\n                        <span className=\"text-muted-foreground italic\">Chưa có</span>\r\n                      )}\r\n                    </div>\r\n                    <div>\r\n                      <span className=\"text-muted-foreground block mb-1\">Mô tả:</span>\r\n                      {selectedBrandForDetail.brand_desc ? (\r\n                        <div \r\n                          className=\"prose prose-sm dark:prose-invert max-w-none bg-muted/30 rounded-md p-3\"\r\n                          dangerouslySetInnerHTML={{ __html: selectedBrandForDetail.brand_desc }}\r\n                        />\r\n                      ) : (\r\n                        <span className=\"text-muted-foreground italic\">Chưa có mô tả</span>\r\n                      )}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n                \r\n                {/* Mapping Info */}\r\n                <div className=\"space-y-3\">\r\n                  <h4 className=\"font-medium text-sm text-muted-foreground uppercase tracking-wide\">\r\n                    Trạng thái mapping\r\n                  </h4>\r\n                  {findMapping(selectedBrandForDetail.brand_id) ? (\r\n                    <div className=\"bg-green-500/10 border border-green-500/20 rounded-md p-3\">\r\n                      <Badge variant=\"default\" className=\"bg-green-500 mb-2\">\r\n                        <CheckCircle2 className=\"h-3 w-3 mr-1\" />\r\n                        Đã mapping\r\n                      </Badge>\r\n                      <p className=\"text-sm\">\r\n                        HRM: <span className=\"font-medium\">{findMapping(selectedBrandForDetail.brand_id)?.hrmBrandName}</span>\r\n                      </p>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"bg-muted/50 rounded-md p-3\">\r\n                      <Badge variant=\"secondary\">Chưa mapping</Badge>\r\n                      <p className=\"text-sm text-muted-foreground mt-2\">\r\n                        Thương hiệu này chưa được liên kết với HRM\r\n                      </p>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            </ScrollArea>\r\n          ) : null}\r\n          \r\n          <DialogFooter className=\"gap-2\">\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => window.open(`https://phukiengiaxuong.com.vn/admin/brand.php?act=edit&brand_id=${selectedBrandForDetail?.brand_id}`, '_blank')}\r\n              disabled={!selectedBrandForDetail}\r\n            >\r\n              <ExternalLink className=\"h-4 w-4 mr-2\" />\r\n              Xem trên PKGX\r\n            </Button>\r\n            {selectedBrandForDetail && findMapping(selectedBrandForDetail.brand_id) && (\r\n              <Button\r\n                onClick={() => handlePushBrand(selectedBrandForDetail.brand_id)}\r\n                disabled={isPushing}\r\n              >\r\n                {isPushing ? (\r\n                  <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n                ) : (\r\n                  <Upload className=\"h-4 w-4 mr-2\" />\r\n                )}\r\n                Đẩy HRM → PKGX\r\n              </Button>\r\n            )}\r\n          </DialogFooter>\r\n        </DialogContent>\r\n      </Dialog>\r\n      \r\n      {/* Confirmation Dialog for sync actions - using shared component */}\r\n      <PkgxSyncConfirmDialog\r\n        confirmAction={entitySync.confirmAction}\r\n        isSyncing={entitySync.isSyncing}\r\n        onConfirm={entitySync.executeAction}\r\n        onCancel={entitySync.cancelConfirm}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8003, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pricing/store.ts"],"sourcesContent":["import type { SystemId } from '@/lib/id-types';\r\nimport type { UseBoundStore, StoreApi } from 'zustand';\r\n// REMOVED: import { data as initialData } from './data'; // Mock data no longer used - database is source of truth\r\nimport type { PricingPolicy } from './types';\r\nimport { createCrudStore, type CrudState } from '../../../lib/store-factory';\r\nimport { getCurrentUserSystemId } from '../../../contexts/auth-context';\r\n\r\ntype PricingPolicyStore = CrudState<PricingPolicy> & {\r\n  setDefault: (systemId: SystemId) => void;\r\n  getActive: () => PricingPolicy[];\r\n  getInactive: () => PricingPolicy[];\r\n};\r\n\r\nconst baseStore = createCrudStore<PricingPolicy>([], 'pricing-settings', {\r\n  businessIdField: 'id',\r\n  getCurrentUser: getCurrentUserSystemId,\r\n  apiEndpoint: '/api/settings/data?type=pricing-policy',\r\n}) as UseBoundStore<StoreApi<PricingPolicyStore>>;\r\n\r\nconst originalAdd = baseStore.getState().add;\r\n\r\nconst setDefaultAction = (systemId: SystemId) => {\r\n  baseStore.setState((current) => {\r\n    const target = current.data.find((policy) => policy.systemId === systemId);\r\n    if (!target) return current;\r\n\r\n    const updatedData = current.data.map((policy) => (\r\n      policy.type === target.type\r\n        ? { ...policy, isDefault: policy.systemId === systemId }\r\n        : policy\r\n    ));\r\n\r\n    return { ...current, data: updatedData };\r\n  });\r\n};\r\n\r\nconst enhancedAdd: typeof originalAdd = (item) => {\r\n  const newItem = originalAdd(item);\r\n  const storeData = baseStore.getState().data;\r\n  const hasDefaultForType = storeData\r\n    .filter((policy) => policy.type === newItem.type)\r\n    .some((policy) => policy.isDefault);\r\n\r\n  if (item.isDefault) {\r\n    setDefaultAction(newItem.systemId);\r\n  } else if (!hasDefaultForType) {\r\n    setDefaultAction(newItem.systemId);\r\n  }\r\n\r\n  return newItem;\r\n};\r\n\r\nbaseStore.setState((state) => ({\r\n  ...state,\r\n  add: enhancedAdd,\r\n  setDefault: setDefaultAction,\r\n  getActive: () => baseStore.getState().data.filter((policy) => policy.isActive),\r\n  getInactive: () => baseStore.getState().data.filter((policy) => !policy.isActive),\r\n}));\r\n\r\nexport const usePricingPolicyStore = baseStore;\r\n"],"names":[],"mappings":";;;;AAIA;AACA;;;AAQA,MAAM,YAAY,IAAA,0IAAe,EAAgB,EAAE,EAAE,oBAAoB;IACvE,iBAAiB;IACjB,gBAAgB,sJAAsB;IACtC,aAAa;AACf;AAEA,MAAM,cAAc,UAAU,QAAQ,GAAG,GAAG;AAE5C,MAAM,mBAAmB,CAAC;IACxB,UAAU,QAAQ,CAAC,CAAC;QAClB,MAAM,SAAS,QAAQ,IAAI,CAAC,IAAI,CAAC,CAAC,SAAW,OAAO,QAAQ,KAAK;QACjE,IAAI,CAAC,QAAQ,OAAO;QAEpB,MAAM,cAAc,QAAQ,IAAI,CAAC,GAAG,CAAC,CAAC,SACpC,OAAO,IAAI,KAAK,OAAO,IAAI,GACvB;gBAAE,GAAG,MAAM;gBAAE,WAAW,OAAO,QAAQ,KAAK;YAAS,IACrD;QAGN,OAAO;YAAE,GAAG,OAAO;YAAE,MAAM;QAAY;IACzC;AACF;AAEA,MAAM,cAAkC,CAAC;IACvC,MAAM,UAAU,YAAY;IAC5B,MAAM,YAAY,UAAU,QAAQ,GAAG,IAAI;IAC3C,MAAM,oBAAoB,UACvB,MAAM,CAAC,CAAC,SAAW,OAAO,IAAI,KAAK,QAAQ,IAAI,EAC/C,IAAI,CAAC,CAAC,SAAW,OAAO,SAAS;IAEpC,IAAI,KAAK,SAAS,EAAE;QAClB,iBAAiB,QAAQ,QAAQ;IACnC,OAAO,IAAI,CAAC,mBAAmB;QAC7B,iBAAiB,QAAQ,QAAQ;IACnC;IAEA,OAAO;AACT;AAEA,UAAU,QAAQ,CAAC,CAAC,QAAU,CAAC;QAC7B,GAAG,KAAK;QACR,KAAK;QACL,YAAY;QACZ,WAAW,IAAM,UAAU,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,SAAW,OAAO,QAAQ;QAC7E,aAAa,IAAM,UAAU,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,SAAW,CAAC,OAAO,QAAQ;IAClF,CAAC;AAEM,MAAM,wBAAwB"}},
    {"offset": {"line": 8054, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/components/price-mapping-tab.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../../../../components/ui/card';\r\nimport { Label } from '../../../../components/ui/label';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../../../../components/ui/select';\r\nimport { Button } from '../../../../components/ui/button';\r\nimport { Save } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { usePkgxSettingsStore } from '../store';\r\nimport { usePricingPolicyStore } from '../../pricing/store';\r\nimport { PKGX_PRICE_FIELDS } from '../constants';\r\nimport type { SystemId } from '../../../../lib/id-types';\r\n\r\nexport function PriceMappingTab() {\r\n  const { settings, updatePriceMapping, addLog } = usePkgxSettingsStore();\r\n  const pricingPolicies = usePricingPolicyStore((state) => state.data);\r\n\r\n  // Filter only selling price policies\r\n  const sellingPolicies = pricingPolicies.filter((p) => p.type === 'Bán hàng' && p.isActive);\r\n\r\n  const handleChange = (field: keyof typeof settings.priceMapping, value: string) => {\r\n    updatePriceMapping(field, value === 'none' ? null : (value as SystemId));\r\n  };\r\n\r\n  const handleSave = () => {\r\n    // Log the mapping save\r\n    const mappingSummary = PKGX_PRICE_FIELDS\r\n      .filter(pf => settings.priceMapping[pf.key as keyof typeof settings.priceMapping])\r\n      .map(pf => {\r\n        const policyId = settings.priceMapping[pf.key as keyof typeof settings.priceMapping];\r\n        const policy = pricingPolicies.find(p => p.systemId === policyId);\r\n        return `${pf.field} → ${policy?.name || policyId}`;\r\n      })\r\n      .join(', ');\r\n    \r\n    addLog({\r\n      action: 'save_mapping',\r\n      status: 'success',\r\n      message: 'Đã lưu mapping bảng giá',\r\n      details: {\r\n        total: PKGX_PRICE_FIELDS.filter(pf => settings.priceMapping[pf.key as keyof typeof settings.priceMapping]).length,\r\n      }\r\n    });\r\n    \r\n    toast.success('Đã lưu mapping bảng giá');\r\n  };\r\n\r\n  const getPolicyName = (policyId: SystemId | null) => {\r\n    if (!policyId) return '-- Không áp dụng --';\r\n    const policy = pricingPolicies.find((p) => p.systemId === policyId);\r\n    return policy?.name || policyId;\r\n  };\r\n\r\n  return (\r\n    <Card>\r\n      <CardHeader>\r\n        <CardTitle className=\"text-lg\">Mapping Bảng giá HRM → PKGX</CardTitle>\r\n        <CardDescription>\r\n          Chọn bảng giá trong HRM tương ứng với mỗi loại giá trên PKGX\r\n        </CardDescription>\r\n      </CardHeader>\r\n      <CardContent className=\"space-y-6\">\r\n        {PKGX_PRICE_FIELDS.map((priceField) => (\r\n          <div key={priceField.key} className=\"grid grid-cols-1 md:grid-cols-2 gap-4 items-start\">\r\n            <div>\r\n              <Label className=\"text-base font-medium\">{priceField.label}</Label>\r\n              <p className=\"text-sm text-muted-foreground\">{priceField.description}</p>\r\n            </div>\r\n            <Select\r\n              value={settings.priceMapping[priceField.key as keyof typeof settings.priceMapping] || 'none'}\r\n              onValueChange={(value) => handleChange(priceField.key as keyof typeof settings.priceMapping, value)}\r\n            >\r\n              <SelectTrigger>\r\n                <SelectValue placeholder=\"Chọn bảng giá...\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"none\">-- Không áp dụng --</SelectItem>\r\n                {sellingPolicies.map((policy) => (\r\n                  <SelectItem key={policy.systemId} value={policy.systemId}>\r\n                    {policy.name}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n        ))}\r\n\r\n        <div className=\"pt-4 border-t\">\r\n          <h4 className=\"font-medium mb-2\">Tóm tắt mapping hiện tại:</h4>\r\n          <div className=\"bg-muted p-4 rounded-lg text-sm space-y-1\">\r\n            {PKGX_PRICE_FIELDS.map((priceField) => (\r\n              <div key={priceField.key} className=\"flex justify-between\">\r\n                <span className=\"text-muted-foreground\">{priceField.field}:</span>\r\n                <span className=\"font-medium\">\r\n                  {getPolicyName(settings.priceMapping[priceField.key as keyof typeof settings.priceMapping])}\r\n                </span>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"flex justify-end pt-4\">\r\n          <Button onClick={handleSave}>\r\n            <Save className=\"h-4 w-4 mr-2\" />\r\n            Lưu mapping\r\n          </Button>\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8309, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/components/product-mapping-tab.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ProductMappingTab = registerClientReference(\n    function() { throw new Error(\"Attempted to call ProductMappingTab() from the server but ProductMappingTab is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/features/settings/pkgx/components/product-mapping-tab.tsx <module evaluation>\",\n    \"ProductMappingTab\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,oBAAoB,IAAA,wQAAuB,EACpD;IAAa,MAAM,IAAI,MAAM;AAAkP,GAC/Q,2FACA","ignoreList":[0]}},
    {"offset": {"line": 8323, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/components/product-mapping-tab.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ProductMappingTab = registerClientReference(\n    function() { throw new Error(\"Attempted to call ProductMappingTab() from the server but ProductMappingTab is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/features/settings/pkgx/components/product-mapping-tab.tsx\",\n    \"ProductMappingTab\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,oBAAoB,IAAA,wQAAuB,EACpD;IAAa,MAAM,IAAI,MAAM;AAAkP,GAC/Q,uEACA","ignoreList":[0]}},
    {"offset": {"line": 8337, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 8345, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/components/sync-settings-tab.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../../../../components/ui/card';\r\nimport { Button } from '../../../../components/ui/button';\r\nimport { Switch } from '../../../../components/ui/switch';\r\nimport { Label } from '../../../../components/ui/label';\r\nimport { Badge } from '../../../../components/ui/badge';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../../../../components/ui/select';\r\nimport { Play, Pause, FileText, CheckCircle2, AlertCircle, Loader2 } from 'lucide-react';\r\nimport { toast } from 'sonner';\r\nimport { usePkgxSettingsStore } from '../store';\r\nimport { SYNC_INTERVAL_OPTIONS } from '../types';\r\n\r\nexport function SyncSettingsTab() {\r\n  const { settings, updateSyncSetting, setLastSyncAt, setLastSyncResult, addLog } = usePkgxSettingsStore();\r\n  const { syncSettings, lastSyncAt, lastSyncResult, apiKey, apiUrl } = settings;\r\n  const [isSyncing, setIsSyncing] = React.useState(false);\r\n\r\n  const handleManualSync = async () => {\r\n    if (!apiUrl || !apiKey) {\r\n      toast.error('Vui lòng cấu hình API URL và API Key trước!');\r\n      return;\r\n    }\r\n\r\n    setIsSyncing(true);\r\n    const startTime = Date.now();\r\n    toast.info('Đang đồng bộ dữ liệu...');\r\n    \r\n    try {\r\n      // TODO: Implement actual sync logic with real API\r\n      await new Promise((resolve) => setTimeout(resolve, 2000));\r\n      \r\n      const responseTime = Date.now() - startTime;\r\n      const result = { status: 'success' as const, total: 150, success: 150, failed: 0 };\r\n      \r\n      setLastSyncAt(new Date().toISOString());\r\n      setLastSyncResult(result);\r\n      \r\n      addLog({\r\n        action: 'sync_all',\r\n        status: 'success',\r\n        message: 'Đồng bộ tất cả dữ liệu thành công',\r\n        details: {\r\n          total: result.total,\r\n          success: result.success,\r\n          failed: result.failed,\r\n          responseTime,\r\n          url: apiUrl,\r\n          method: 'POST',\r\n        }\r\n      });\r\n      \r\n      toast.success('Đồng bộ thành công!');\r\n    } catch (error) {\r\n      const responseTime = Date.now() - startTime;\r\n      const errorMessage = error instanceof Error ? error.message : 'Lỗi không xác định';\r\n      \r\n      setLastSyncResult({ status: 'error', total: 0, success: 0, failed: 0 });\r\n      \r\n      addLog({\r\n        action: 'sync_all',\r\n        status: 'error',\r\n        message: 'Lỗi đồng bộ dữ liệu',\r\n        details: {\r\n          error: errorMessage,\r\n          responseTime,\r\n          url: apiUrl,\r\n          method: 'POST',\r\n        }\r\n      });\r\n      \r\n      toast.error('Lỗi đồng bộ: ' + errorMessage);\r\n    } finally {\r\n      setIsSyncing(false);\r\n    }\r\n  };\r\n\r\n  const handleToggleAutoSync = (checked: boolean) => {\r\n    updateSyncSetting('autoSyncEnabled', checked);\r\n    addLog({\r\n      action: 'save_config',\r\n      status: 'info',\r\n      message: checked ? 'Đã bật Auto Sync' : 'Đã tắt Auto Sync',\r\n      details: {}\r\n    });\r\n    toast.success(checked ? 'Đã bật Auto Sync' : 'Đã tắt Auto Sync');\r\n  };\r\n\r\n  const handleToggleSyncInventory = (checked: boolean) => {\r\n    updateSyncSetting('syncInventory', checked);\r\n    addLog({\r\n      action: 'save_config',\r\n      status: 'info',\r\n      message: checked ? 'Đã bật đồng bộ tồn kho' : 'Đã tắt đồng bộ tồn kho',\r\n      details: {}\r\n    });\r\n  };\r\n\r\n  const handleToggleSyncPrice = (checked: boolean) => {\r\n    updateSyncSetting('syncPrice', checked);\r\n    addLog({\r\n      action: 'save_config',\r\n      status: 'info',\r\n      message: checked ? 'Đã bật đồng bộ giá' : 'Đã tắt đồng bộ giá',\r\n      details: {}\r\n    });\r\n  };\r\n\r\n  const handleToggleSyncSeo = (checked: boolean) => {\r\n    updateSyncSetting('syncSeo', checked);\r\n    addLog({\r\n      action: 'save_config',\r\n      status: 'info',\r\n      message: checked ? 'Đã bật đồng bộ SEO' : 'Đã tắt đồng bộ SEO',\r\n      details: {}\r\n    });\r\n  };\r\n\r\n  const handleToggleSyncOnUpdate = (checked: boolean) => {\r\n    updateSyncSetting('syncOnProductUpdate', checked);\r\n    addLog({\r\n      action: 'save_config',\r\n      status: 'info',\r\n      message: checked ? 'Đã bật đồng bộ khi cập nhật SP' : 'Đã tắt đồng bộ khi cập nhật SP',\r\n      details: {}\r\n    });\r\n  };\r\n\r\n  const handleToggleNotify = (checked: boolean) => {\r\n    updateSyncSetting('notifyOnError', checked);\r\n    addLog({\r\n      action: 'save_config',\r\n      status: 'info',\r\n      message: checked ? 'Đã bật thông báo lỗi' : 'Đã tắt thông báo lỗi',\r\n      details: {}\r\n    });\r\n  };\r\n\r\n  const getNextSyncTime = () => {\r\n    if (!lastSyncAt || !syncSettings.autoSyncEnabled) return null;\r\n    const lastSync = new Date(lastSyncAt);\r\n    const nextSync = new Date(lastSync.getTime() + syncSettings.intervalMinutes * 60 * 1000);\r\n    return nextSync;\r\n  };\r\n\r\n  const nextSync = getNextSyncTime();\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      {/* Schedule Card */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"text-lg\">Lịch đồng bộ tự động</CardTitle>\r\n          <CardDescription>Cài đặt thời gian và tần suất đồng bộ</CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <Label className=\"text-base\">Bật Auto Sync</Label>\r\n              <p className=\"text-sm text-muted-foreground\">Tự động đồng bộ dữ liệu theo lịch</p>\r\n            </div>\r\n            <Switch\r\n              checked={syncSettings.autoSyncEnabled}\r\n              onCheckedChange={handleToggleAutoSync}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between\">\r\n            <Label>Tần suất đồng bộ</Label>\r\n            <Select\r\n              value={syncSettings.intervalMinutes.toString()}\r\n              onValueChange={(value) => updateSyncSetting('intervalMinutes', parseInt(value, 10))}\r\n              disabled={!syncSettings.autoSyncEnabled}\r\n            >\r\n              <SelectTrigger className=\"w-[180px]\">\r\n                <SelectValue />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                {SYNC_INTERVAL_OPTIONS.map((option) => (\r\n                  <SelectItem key={option.value} value={option.value.toString()}>\r\n                    {option.label}\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Data Types Card */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"text-lg\">Loại dữ liệu đồng bộ</CardTitle>\r\n          <CardDescription>Chọn những thông tin cần đồng bộ lên PKGX</CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <Label className=\"text-base\">Đồng bộ tồn kho</Label>\r\n              <p className=\"text-sm text-muted-foreground\">Tổng tồn kho tất cả chi nhánh</p>\r\n            </div>\r\n            <Switch\r\n              checked={syncSettings.syncInventory}\r\n              onCheckedChange={handleToggleSyncInventory}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <Label className=\"text-base\">Đồng bộ giá</Label>\r\n              <p className=\"text-sm text-muted-foreground\">Theo mapping bảng giá đã cấu hình</p>\r\n            </div>\r\n            <Switch\r\n              checked={syncSettings.syncPrice}\r\n              onCheckedChange={handleToggleSyncPrice}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <Label className=\"text-base\">Đồng bộ SEO</Label>\r\n              <p className=\"text-sm text-muted-foreground\">meta_title, meta_desc, keywords</p>\r\n            </div>\r\n            <Switch\r\n              checked={syncSettings.syncSeo}\r\n              onCheckedChange={handleToggleSyncSeo}\r\n            />\r\n          </div>\r\n\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <Label className=\"text-base\">Sync ngay khi cập nhật sản phẩm</Label>\r\n              <p className=\"text-sm text-muted-foreground\">Đồng bộ real-time khi sửa SP trong HRM</p>\r\n            </div>\r\n            <Switch\r\n              checked={syncSettings.syncOnProductUpdate}\r\n              onCheckedChange={handleToggleSyncOnUpdate}\r\n            />\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Notification Card */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"text-lg\">Thông báo</CardTitle>\r\n        </CardHeader>\r\n        <CardContent>\r\n          <div className=\"flex items-center justify-between\">\r\n            <div>\r\n              <Label className=\"text-base\">Thông báo khi có lỗi sync</Label>\r\n              <p className=\"text-sm text-muted-foreground\">Nhận thông báo khi đồng bộ thất bại</p>\r\n            </div>\r\n            <Switch\r\n              checked={syncSettings.notifyOnError}\r\n              onCheckedChange={handleToggleNotify}\r\n            />\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n\r\n      {/* Status Card */}\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"text-lg\">Trạng thái đồng bộ</CardTitle>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n            <div className=\"p-4 bg-muted rounded-lg\">\r\n              <p className=\"text-sm text-muted-foreground\">Lần sync cuối</p>\r\n              <p className=\"font-medium\">\r\n                {lastSyncAt ? new Date(lastSyncAt).toLocaleString('vi-VN') : 'Chưa có'}\r\n              </p>\r\n            </div>\r\n            <div className=\"p-4 bg-muted rounded-lg\">\r\n              <p className=\"text-sm text-muted-foreground\">Kết quả</p>\r\n              {lastSyncResult ? (\r\n                <div className=\"flex items-center gap-2\">\r\n                  {lastSyncResult.status === 'success' ? (\r\n                    <Badge className=\"bg-green-500\"><CheckCircle2 className=\"h-3 w-3 mr-1\" />Thành công</Badge>\r\n                  ) : (\r\n                    <Badge variant=\"destructive\"><AlertCircle className=\"h-3 w-3 mr-1\" />Có lỗi</Badge>\r\n                  )}\r\n                  <span className=\"text-sm\">{lastSyncResult.success}/{lastSyncResult.total}</span>\r\n                </div>\r\n              ) : (\r\n                <p className=\"font-medium\">--</p>\r\n              )}\r\n            </div>\r\n            <div className=\"p-4 bg-muted rounded-lg\">\r\n              <p className=\"text-sm text-muted-foreground\">Lần sync tiếp theo</p>\r\n              <p className=\"font-medium\">\r\n                {nextSync ? nextSync.toLocaleString('vi-VN') : 'Không có'}\r\n              </p>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"flex gap-2 pt-4\">\r\n            <Button onClick={handleManualSync} disabled={isSyncing}>\r\n              {isSyncing ? (\r\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\r\n              ) : (\r\n                <Play className=\"h-4 w-4 mr-2\" />\r\n              )}\r\n              {isSyncing ? 'Đang sync...' : 'Sync ngay'}\r\n            </Button>\r\n            <Button variant=\"outline\">\r\n              <FileText className=\"h-4 w-4 mr-2\" />\r\n              Xem log\r\n            </Button>\r\n            {syncSettings.autoSyncEnabled && (\r\n              <Button variant=\"outline\" onClick={() => handleToggleAutoSync(false)}>\r\n                <Pause className=\"h-4 w-4 mr-2\" />\r\n                Tạm dừng\r\n              </Button>\r\n            )}\r\n          </div>\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9160, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/components/log-tab.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '../../../../components/ui/card';\r\nimport { Button } from '../../../../components/ui/button';\r\nimport { Input } from '../../../../components/ui/input';\r\nimport { Badge } from '../../../../components/ui/badge';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../../../../components/ui/select';\r\nimport { ResponsiveDataTable } from '../../../../components/data-table/responsive-data-table';\r\nimport { PageFilters } from '../../../../components/layout/page-filters';\r\nimport type { ColumnDef } from '../../../../components/data-table/types';\r\nimport { Search, CheckCircle2, XCircle, AlertCircle, RefreshCw, Globe, Link, Unlink, Save, Settings, DollarSign, Package, FileText, Info, User, Image } from 'lucide-react';\r\nimport { usePkgxSettingsStore } from '../store';\r\nimport type { PkgxSyncLog } from '../types';\r\n\r\n// Extended type with systemId for ResponsiveDataTable\r\ntype PkgxSyncLogWithSystemId = PkgxSyncLog & { systemId: string };\r\n\r\nexport function LogTab() {\r\n  const { settings } = usePkgxSettingsStore();\r\n  \r\n  const [searchTerm, setSearchTerm] = React.useState('');\r\n  const [statusFilter, setStatusFilter] = React.useState<'all' | 'success' | 'error' | 'partial' | 'info'>('all');\r\n  const [actionFilter, setActionFilter] = React.useState<string>('all');\r\n  \r\n  // Pagination state\r\n  const [pagination, setPagination] = React.useState({ pageIndex: 0, pageSize: 20 });\r\n  const [sorting, setSorting] = React.useState<{ id: string; desc: boolean }>({ id: 'timestamp', desc: true });\r\n  const [columnVisibility, setColumnVisibility] = React.useState<Record<string, boolean>>({});\r\n  const [columnOrder, setColumnOrder] = React.useState<string[]>([]);\r\n  const [pinnedColumns, setPinnedColumns] = React.useState<string[]>([]);\r\n  \r\n  // Convert logs to include systemId\r\n  const allLogs = React.useMemo((): PkgxSyncLogWithSystemId[] => {\r\n    return settings.logs.map(log => ({\r\n      ...log,\r\n      systemId: log.id,\r\n    }));\r\n  }, [settings.logs]);\r\n  \r\n  const filteredLogs = React.useMemo(() => {\r\n    let logs = allLogs;\r\n    \r\n    // Filter by status\r\n    if (statusFilter !== 'all') {\r\n      logs = logs.filter((log) => log.status === statusFilter);\r\n    }\r\n    \r\n    // Filter by action\r\n    if (actionFilter !== 'all') {\r\n      logs = logs.filter((log) => log.action === actionFilter);\r\n    }\r\n    \r\n    // Filter by search term\r\n    if (searchTerm) {\r\n      const term = searchTerm.toLowerCase();\r\n      logs = logs.filter(\r\n        (log) =>\r\n          log.message.toLowerCase().includes(term) ||\r\n          log.action.toLowerCase().includes(term) ||\r\n          (log.userName && log.userName.toLowerCase().includes(term))\r\n      );\r\n    }\r\n    \r\n    return logs;\r\n  }, [allLogs, statusFilter, actionFilter, searchTerm]);\r\n  \r\n  // Sorted data\r\n  const sortedData = React.useMemo(() => {\r\n    const sorted = [...filteredLogs];\r\n    if (sorting.id) {\r\n      sorted.sort((a, b) => {\r\n        const aVal = (a as unknown as Record<string, unknown>)[sorting.id];\r\n        const bVal = (b as unknown as Record<string, unknown>)[sorting.id];\r\n        \r\n        if (aVal === bVal) return 0;\r\n        if (aVal === null || aVal === undefined) return 1;\r\n        if (bVal === null || bVal === undefined) return -1;\r\n        \r\n        const comparison = String(aVal).localeCompare(String(bVal));\r\n        return sorting.desc ? -comparison : comparison;\r\n      });\r\n    }\r\n    return sorted;\r\n  }, [filteredLogs, sorting]);\r\n  \r\n  // Paginated data\r\n  const paginatedData = React.useMemo(() => {\r\n    const start = pagination.pageIndex * pagination.pageSize;\r\n    return sortedData.slice(start, start + pagination.pageSize);\r\n  }, [sortedData, pagination]);\r\n  \r\n  const pageCount = Math.ceil(sortedData.length / pagination.pageSize);\r\n  \r\n  const getStatusBadge = (status: PkgxSyncLog['status']) => {\r\n    switch (status) {\r\n      case 'success':\r\n        return (\r\n          <Badge variant=\"default\" className=\"bg-green-500\">\r\n            <CheckCircle2 className=\"h-3 w-3 mr-1\" />\r\n            Thành công\r\n          </Badge>\r\n        );\r\n      case 'error':\r\n        return (\r\n          <Badge variant=\"destructive\">\r\n            <XCircle className=\"h-3 w-3 mr-1\" />\r\n            Lỗi\r\n          </Badge>\r\n        );\r\n      case 'partial':\r\n        return (\r\n          <Badge variant=\"default\" className=\"bg-yellow-500\">\r\n            <AlertCircle className=\"h-3 w-3 mr-1\" />\r\n            Một phần\r\n          </Badge>\r\n        );\r\n      case 'info':\r\n        return (\r\n          <Badge variant=\"secondary\">\r\n            <Info className=\"h-3 w-3 mr-1\" />\r\n            Thông tin\r\n          </Badge>\r\n        );\r\n    }\r\n  };\r\n  \r\n  const getActionIcon = (action: PkgxSyncLog['action']) => {\r\n    switch (action) {\r\n      case 'test_connection':\r\n      case 'ping':\r\n        return <Globe className=\"h-4 w-4 text-blue-500\" />;\r\n      case 'sync_price':\r\n        return <DollarSign className=\"h-4 w-4 text-green-500\" />;\r\n      case 'sync_inventory':\r\n        return <Package className=\"h-4 w-4 text-orange-500\" />;\r\n      case 'sync_seo':\r\n        return <FileText className=\"h-4 w-4 text-purple-500\" />;\r\n      case 'sync_images':\r\n      case 'bulk_sync_images':\r\n      case 'upload_image':\r\n        return <Image className=\"h-4 w-4 text-pink-500\" />;\r\n      case 'create_product':\r\n      case 'update_product':\r\n        return <RefreshCw className=\"h-4 w-4 text-cyan-500\" />;\r\n      case 'link_product':\r\n        return <Link className=\"h-4 w-4 text-blue-500\" />;\r\n      case 'unlink_product':\r\n      case 'unlink_mapping':\r\n      case 'batch_unlink':\r\n        return <Unlink className=\"h-4 w-4 text-gray-500\" />;\r\n      case 'save_config':\r\n      case 'save_mapping':\r\n        return <Save className=\"h-4 w-4 text-emerald-500\" />;\r\n      case 'sync_categories':\r\n      case 'sync_brands':\r\n      case 'get_products':\r\n      case 'sync_all':\r\n      case 'bulk_sync_all':\r\n      case 'bulk_sync_basic':\r\n      case 'bulk_sync_price':\r\n      case 'bulk_sync_inventory':\r\n      case 'bulk_sync_seo':\r\n      case 'bulk_sync_description':\r\n      case 'bulk_sync_flags':\r\n        return <RefreshCw className=\"h-4 w-4 text-indigo-500\" />;\r\n      default:\r\n        return <Settings className=\"h-4 w-4 text-gray-500\" />;\r\n    }\r\n  };\r\n  \r\n  const getActionLabel = (action: PkgxSyncLog['action']) => {\r\n    const labels: Record<PkgxSyncLog['action'], string> = {\r\n      test_connection: 'Test kết nối',\r\n      ping: 'Ping server',\r\n      sync_all: 'Đồng bộ tất cả',\r\n      sync_price: 'Đồng bộ giá',\r\n      sync_inventory: 'Đồng bộ tồn kho',\r\n      sync_seo: 'Đồng bộ SEO',\r\n      sync_description: 'Đồng bộ mô tả',\r\n      sync_flags: 'Đồng bộ flags',\r\n      sync_basic: 'Đồng bộ cơ bản',\r\n      sync_basic_info: 'Đồng bộ cơ bản',\r\n      sync_images: 'Đồng bộ ảnh',\r\n      create_product: 'Tạo SP',\r\n      update_product: 'Cập nhật SP',\r\n      link_product: 'Liên kết SP',\r\n      unlink_product: 'Hủy liên kết',\r\n      unlink_mapping: 'Hủy mapping',\r\n      batch_unlink: 'Hủy hàng loạt',\r\n      bulk_sync_all: 'Bulk: Tất cả',\r\n      bulk_sync_basic: 'Bulk: Cơ bản',\r\n      bulk_sync_price: 'Bulk: Giá',\r\n      bulk_sync_inventory: 'Bulk: Tồn kho',\r\n      bulk_sync_seo: 'Bulk: SEO',\r\n      bulk_sync_description: 'Bulk: Mô tả',\r\n      bulk_sync_flags: 'Bulk: Flags',\r\n      bulk_sync_images: 'Bulk: Ảnh',\r\n      sync_categories: 'Đồng bộ danh mục',\r\n      sync_brands: 'Đồng bộ thương hiệu',\r\n      get_products: 'Lấy DS sản phẩm',\r\n      upload_image: 'Upload ảnh',\r\n      save_config: 'Lưu cấu hình',\r\n      save_mapping: 'Lưu mapping',\r\n    };\r\n    return labels[action] || action;\r\n  };\r\n  \r\n  const formatTimestamp = (timestamp: string) => {\r\n    const date = new Date(timestamp);\r\n    return date.toLocaleString('vi-VN', {\r\n      year: 'numeric',\r\n      month: '2-digit',\r\n      day: '2-digit',\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      second: '2-digit',\r\n    });\r\n  };\r\n  \r\n  const getDetailsDisplay = (log: PkgxSyncLogWithSystemId) => {\r\n    if (!log.details) return null;\r\n    \r\n    return (\r\n      <div className=\"space-y-0.5 text-xs text-muted-foreground\">\r\n        {/* API details */}\r\n        {log.details.method && log.details.url && (\r\n          <div className=\"font-mono text-blue-600\">\r\n            {log.details.method} {log.details.url.length > 25 ? '...' + log.details.url.slice(-25) : log.details.url}\r\n          </div>\r\n        )}\r\n        {log.details.httpStatus && (\r\n          <div className={log.details.httpStatus >= 400 ? 'text-red-600' : 'text-green-600'}>\r\n            HTTP: {log.details.httpStatus}\r\n          </div>\r\n        )}\r\n        {log.details.responseTime !== undefined && (\r\n          <div className=\"text-gray-500\">{log.details.responseTime}ms</div>\r\n        )}\r\n        {/* Sync stats */}\r\n        {log.details.total !== undefined && (\r\n          <div>Tổng: {log.details.total}</div>\r\n        )}\r\n        {log.details.success !== undefined && log.details.success > 0 && (\r\n          <div className=\"text-green-600\">OK: {log.details.success}</div>\r\n        )}\r\n        {log.details.failed !== undefined && log.details.failed > 0 && (\r\n          <div className=\"text-red-600\">Lỗi: {log.details.failed}</div>\r\n        )}\r\n        {/* Product details */}\r\n        {log.details.productId && (\r\n          <div>SP: {log.details.productId}</div>\r\n        )}\r\n        {log.details.pkgxId && (\r\n          <div>PKGX: {log.details.pkgxId}</div>\r\n        )}\r\n        {/* Error info */}\r\n        {log.details.errorCode && (\r\n          <div className=\"text-red-600\">Mã: {log.details.errorCode}</div>\r\n        )}\r\n        {log.details.error && (\r\n          <div className=\"text-red-600 truncate max-w-[150px]\" title={log.details.error}>\r\n            {log.details.error}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Define columns\r\n  const columns: ColumnDef<PkgxSyncLogWithSystemId>[] = [\r\n    {\r\n      id: 'timestamp',\r\n      accessorKey: 'timestamp',\r\n      header: 'Thời gian',\r\n      size: 150,\r\n      cell: ({ row }) => (\r\n        <span className=\"text-xs font-mono\">\r\n          {formatTimestamp(row.timestamp)}\r\n        </span>\r\n      ),\r\n    },\r\n    {\r\n      id: 'action',\r\n      accessorKey: 'action',\r\n      header: 'Hành động',\r\n      size: 150,\r\n      cell: ({ row }) => (\r\n        <div className=\"flex items-center gap-2\">\r\n          {getActionIcon(row.action)}\r\n          <Badge variant=\"outline\" className=\"text-xs whitespace-nowrap\">\r\n            {getActionLabel(row.action)}\r\n          </Badge>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      id: 'status',\r\n      accessorKey: 'status',\r\n      header: 'Trạng thái',\r\n      size: 110,\r\n      cell: ({ row }) => getStatusBadge(row.status),\r\n    },\r\n    {\r\n      id: 'message',\r\n      accessorKey: 'message',\r\n      header: 'Thông báo',\r\n      size: 280,\r\n      cell: ({ row }) => (\r\n        <span className=\"text-sm truncate block max-w-[260px]\" title={row.message}>\r\n          {row.message}\r\n        </span>\r\n      ),\r\n    },\r\n    {\r\n      id: 'userName',\r\n      accessorKey: 'userName',\r\n      header: 'Người thực hiện',\r\n      size: 130,\r\n      cell: ({ row }) => (\r\n        <div className=\"flex items-center gap-1.5 text-xs\">\r\n          <User className=\"h-3 w-3 text-muted-foreground\" />\r\n          <span className=\"truncate max-w-[100px]\" title={row.userName || 'Hệ thống'}>\r\n            {row.userName || 'Hệ thống'}\r\n          </span>\r\n        </div>\r\n      ),\r\n    },\r\n    {\r\n      id: 'details',\r\n      accessorKey: 'details',\r\n      header: 'Chi tiết',\r\n      size: 180,\r\n      cell: ({ row }) => getDetailsDisplay(row),\r\n    },\r\n  ];\r\n\r\n  // Mobile card renderer\r\n  const renderMobileCard = (log: PkgxSyncLogWithSystemId) => (\r\n    <div className=\"p-4 space-y-3\">\r\n      <div className=\"flex items-start justify-between\">\r\n        <div className=\"flex items-center gap-2\">\r\n          {getActionIcon(log.action)}\r\n          <Badge variant=\"outline\" className=\"text-xs\">\r\n            {getActionLabel(log.action)}\r\n          </Badge>\r\n        </div>\r\n        {getStatusBadge(log.status)}\r\n      </div>\r\n      \r\n      <div className=\"space-y-1.5\">\r\n        <p className=\"text-sm\">{log.message}</p>\r\n        <p className=\"text-xs text-muted-foreground font-mono\">\r\n          {formatTimestamp(log.timestamp)}\r\n        </p>\r\n      </div>\r\n      \r\n      {log.details && (\r\n        <div className=\"pt-2 border-t\">\r\n          {getDetailsDisplay(log)}\r\n        </div>\r\n      )}\r\n      \r\n      <div className=\"flex items-center justify-between pt-2 border-t\">\r\n        <div className=\"flex items-center gap-1.5 text-xs text-muted-foreground\">\r\n          <User className=\"h-3 w-3\" />\r\n          <span>{log.userName || 'Hệ thống'}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <Card>\r\n        <CardHeader>\r\n          <CardTitle className=\"text-lg\">Lịch sử đồng bộ</CardTitle>\r\n          <CardDescription>\r\n            Theo dõi hoạt động đồng bộ với PKGX\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          {/* Filters */}\r\n          <PageFilters>\r\n            <div className=\"relative flex-1 min-w-[200px]\">\r\n              <Search className=\"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\r\n              <Input\r\n                placeholder=\"Tìm kiếm logs...\"\r\n                value={searchTerm}\r\n                onChange={(e) => setSearchTerm(e.target.value)}\r\n                className=\"pl-9\"\r\n              />\r\n            </div>\r\n            <Select value={statusFilter} onValueChange={(v: 'all' | 'success' | 'error' | 'partial' | 'info') => setStatusFilter(v)}>\r\n              <SelectTrigger className=\"w-[160px]\">\r\n                <SelectValue placeholder=\"Trạng thái\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"all\">Tất cả trạng thái</SelectItem>\r\n                <SelectItem value=\"success\">Thành công</SelectItem>\r\n                <SelectItem value=\"error\">Lỗi</SelectItem>\r\n                <SelectItem value=\"partial\">Một phần</SelectItem>\r\n                <SelectItem value=\"info\">Thông tin</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n            <Select value={actionFilter} onValueChange={setActionFilter}>\r\n              <SelectTrigger className=\"w-[170px]\">\r\n                <SelectValue placeholder=\"Hành động\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"all\">Tất cả hành động</SelectItem>\r\n                <SelectItem value=\"test_connection\">Test kết nối</SelectItem>\r\n                <SelectItem value=\"ping\">Ping server</SelectItem>\r\n                <SelectItem value=\"save_config\">Lưu cấu hình</SelectItem>\r\n                <SelectItem value=\"save_mapping\">Lưu mapping</SelectItem>\r\n                <SelectItem value=\"create_product\">Tạo sản phẩm</SelectItem>\r\n                <SelectItem value=\"update_product\">Cập nhật SP</SelectItem>\r\n                <SelectItem value=\"link_product\">Liên kết SP</SelectItem>\r\n                <SelectItem value=\"unlink_product\">Hủy liên kết</SelectItem>\r\n                <SelectItem value=\"sync_all\">Đồng bộ tất cả</SelectItem>\r\n                <SelectItem value=\"sync_price\">Đồng bộ giá</SelectItem>\r\n                <SelectItem value=\"sync_inventory\">Đồng bộ tồn kho</SelectItem>\r\n                <SelectItem value=\"sync_seo\">Đồng bộ SEO</SelectItem>\r\n                <SelectItem value=\"sync_images\">Đồng bộ ảnh</SelectItem>\r\n                <SelectItem value=\"sync_categories\">Đồng bộ danh mục</SelectItem>\r\n                <SelectItem value=\"sync_brands\">Đồng bộ thương hiệu</SelectItem>\r\n                <SelectItem value=\"get_products\">Lấy danh sách SP</SelectItem>\r\n                <SelectItem value=\"upload_image\">Upload ảnh</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n          </PageFilters>\r\n          \r\n          {/* Stats */}\r\n          <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\r\n            <span>{filteredLogs.length} logs</span>\r\n            {filteredLogs.length !== allLogs.length && (\r\n              <span className=\"text-xs\">(tổng: {allLogs.length})</span>\r\n            )}\r\n          </div>\r\n          \r\n          {/* ResponsiveDataTable */}\r\n          <ResponsiveDataTable<PkgxSyncLogWithSystemId>\r\n            columns={columns}\r\n            data={paginatedData}\r\n            pageCount={pageCount}\r\n            pagination={pagination}\r\n            setPagination={setPagination}\r\n            rowCount={sortedData.length}\r\n            sorting={sorting}\r\n            setSorting={setSorting}\r\n            columnVisibility={columnVisibility}\r\n            setColumnVisibility={setColumnVisibility}\r\n            columnOrder={columnOrder}\r\n            setColumnOrder={setColumnOrder}\r\n            pinnedColumns={pinnedColumns}\r\n            setPinnedColumns={setPinnedColumns}\r\n            renderMobileCard={renderMobileCard}\r\n            emptyTitle=\"Chưa có hoạt động\"\r\n            emptyDescription={\r\n              searchTerm || statusFilter !== 'all' || actionFilter !== 'all'\r\n                ? 'Không tìm thấy log nào phù hợp với bộ lọc'\r\n                : 'Chưa có hoạt động đồng bộ nào'\r\n            }\r\n            emptyAction={\r\n              allLogs.length === 0 ? (\r\n                <div className=\"flex flex-col items-center gap-2 text-muted-foreground\">\r\n                  <RefreshCw className=\"h-12 w-12 text-muted-foreground/50\" />\r\n                  <p className=\"text-sm\">Bắt đầu đồng bộ để xem lịch sử hoạt động</p>\r\n                </div>\r\n              ) : undefined\r\n            }\r\n          />\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10245, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/components/index.ts"],"sourcesContent":["export { GeneralConfigTab } from './general-config-tab';\r\nexport { CategoryMappingTab } from './category-mapping-tab';\r\nexport { BrandMappingTab } from './brand-mapping-tab';\r\nexport { PriceMappingTab } from './price-mapping-tab';\r\nexport { ProductMappingTab } from './product-mapping-tab';\r\nexport { SyncSettingsTab } from './sync-settings-tab';\r\nexport { LogTab } from './log-tab';\r\n"],"names":[],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 10264, "column": 0}, "map": {"version":3,"sources":["file:///D:/hrm2/features/settings/pkgx/pkgx-settings-page.tsx"],"sourcesContent":["import * as React from 'react';\r\nimport { TabsContent } from '../../../components/ui/tabs';\r\nimport { Globe } from 'lucide-react';\r\nimport { SettingsVerticalTabs } from '../../../components/settings/SettingsVerticalTabs';\r\nimport { useSettingsPageHeader } from '../use-settings-page-header';\r\nimport {\r\n  GeneralConfigTab,\r\n  CategoryMappingTab,\r\n  BrandMappingTab,\r\n  PriceMappingTab,\r\n  ProductMappingTab,\r\n  SyncSettingsTab,\r\n  LogTab,\r\n} from './components';\r\n\r\nconst PKGX_TABS = [\r\n  { value: 'general', label: 'Cấu hình chung' },\r\n  { value: 'category-mapping', label: 'Mapping danh mục' },\r\n  { value: 'brand-mapping', label: 'Mapping thương hiệu' },\r\n  { value: 'price-mapping', label: 'Mapping giá' },\r\n  { value: 'product-mapping', label: 'Sản phẩm đã liên kết' },\r\n  { value: 'sync', label: 'Auto Sync' },\r\n  { value: 'logs', label: 'Logs' },\r\n];\r\n\r\nexport function PkgxSettingsPage() {\r\n  const [activeTab, setActiveTab] = React.useState('general');\r\n\r\n  useSettingsPageHeader({\r\n    title: 'Website phukiengiaxuong.com.vn',\r\n    icon: <Globe className=\"h-5 w-5 text-rose-600\" />,\r\n    breadcrumb: [\r\n      { label: 'Tích hợp PKGX', href: '/settings/pkgx', isCurrent: true },\r\n    ],\r\n  });\r\n\r\n  return (\r\n    <SettingsVerticalTabs\r\n      value={activeTab}\r\n      onValueChange={setActiveTab}\r\n      tabs={PKGX_TABS}\r\n    >\r\n      <TabsContent value=\"general\" className=\"mt-0\">\r\n        <GeneralConfigTab />\r\n      </TabsContent>\r\n\r\n      <TabsContent value=\"category-mapping\" className=\"mt-0\">\r\n        <CategoryMappingTab />\r\n      </TabsContent>\r\n\r\n      <TabsContent value=\"brand-mapping\" className=\"mt-0\">\r\n        <BrandMappingTab />\r\n      </TabsContent>\r\n\r\n      <TabsContent value=\"price-mapping\" className=\"mt-0\">\r\n        <PriceMappingTab />\r\n      </TabsContent>\r\n\r\n      <TabsContent value=\"product-mapping\" className=\"mt-0\">\r\n        <ProductMappingTab />\r\n      </TabsContent>\r\n\r\n      <TabsContent value=\"sync\" className=\"mt-0\">\r\n        <SyncSettingsTab />\r\n      </TabsContent>\r\n\r\n      <TabsContent value=\"logs\" className=\"mt-0\">\r\n        <LogTab />\r\n      </TabsContent>\r\n    </SettingsVerticalTabs>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;AAUA,MAAM,YAAY;IAChB;QAAE,OAAO;QAAW,OAAO;IAAiB;IAC5C;QAAE,OAAO;QAAoB,OAAO;IAAmB;IACvD;QAAE,OAAO;QAAiB,OAAO;IAAsB;IACvD;QAAE,OAAO;QAAiB,OAAO;IAAc;IAC/C;QAAE,OAAO;QAAmB,OAAO;IAAuB;IAC1D;QAAE,OAAO;QAAQ,OAAO;IAAY;IACpC;QAAE,OAAO;QAAQ,OAAO;IAAO;CAChC;AAEM,SAAS;IACd,MAAM,CAAC,WAAW,aAAa,GAAG,iNAAc,CAAC;IAEjD,IAAA,mLAAqB,EAAC;QACpB,OAAO;QACP,oBAAM,8OAAC,6MAAK;YAAC,WAAU;;;;;;QACvB,YAAY;YACV;gBAAE,OAAO;gBAAiB,MAAM;gBAAkB,WAAW;YAAK;SACnE;IACH;IAEA,qBACE,8OAAC,uKAAoB;QACnB,OAAO;QACP,eAAe;QACf,MAAM;;0BAEN,8OAAC,wIAAW;gBAAC,OAAM;gBAAU,WAAU;0BACrC,cAAA,8OAAC,2LAAgB;;;;;;;;;;0BAGnB,8OAAC,wIAAW;gBAAC,OAAM;gBAAmB,WAAU;0BAC9C,cAAA,8OAAC,+LAAkB;;;;;;;;;;0BAGrB,8OAAC,wIAAW;gBAAC,OAAM;gBAAgB,WAAU;0BAC3C,cAAA,8OAAC,yLAAe;;;;;;;;;;0BAGlB,8OAAC,wIAAW;gBAAC,OAAM;gBAAgB,WAAU;0BAC3C,cAAA,8OAAC,yLAAe;;;;;;;;;;0BAGlB,8OAAC,wIAAW;gBAAC,OAAM;gBAAkB,WAAU;0BAC7C,cAAA,8OAAC,6LAAiB;;;;;;;;;;0BAGpB,8OAAC,wIAAW;gBAAC,OAAM;gBAAO,WAAU;0BAClC,cAAA,8OAAC,yLAAe;;;;;;;;;;0BAGlB,8OAAC,wIAAW;gBAAC,OAAM;gBAAO,WAAU;0BAClC,cAAA,8OAAC,mKAAM;;;;;;;;;;;;;;;;AAIf"}}]
}