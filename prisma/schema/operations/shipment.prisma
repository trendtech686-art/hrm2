model Shipment {
  systemId         String         @id
  id               String         @unique
  trackingCode     String?        @unique
  orderId          String
  carrier          String
  status           ShipmentStatus @default(PENDING)
  recipientName    String?
  recipientPhone   String?
  recipientAddress String?
  shippingFee      Decimal        @default(0) @db.Decimal(15, 2)
  codAmount        Decimal        @default(0) @db.Decimal(15, 2)
  insuranceFee     Decimal        @default(0) @db.Decimal(15, 2)
  weight           Decimal?       @db.Decimal(10, 2)
  createdAt        DateTime       @default(now())
  pickedAt         DateTime?
  deliveredAt      DateTime?
  returnedAt       DateTime?
  notes            String?
  failReason       String?
  updatedAt        DateTime       @updatedAt
  createdBy        String?
  trackingNumber   String?
  
  // === MISSING FIELDS FROM types.ts (Phase 7) ===
  
  // Linking
  packagingSystemId    String?    // Link to Packaging
  orderSystemId        String?
  orderBusinessId      String?    // DH000001
  
  // Carrier details
  service              String?    // Service name (Chuẩn, Nhanh)
  
  // Status details
  deliveryStatus       String?    // Chờ lấy hàng, Đang giao, etc.
  printStatus          String     @default("Chưa in")  // Đã in, Chưa in
  reconciliationStatus String?    // Chưa đối soát, Đã đối soát
  partnerStatus        String?    // Status from carrier API
  
  // Financial
  shippingFeeToPartner Decimal?   @db.Decimal(15, 2)
  payer                String?    // 'Người gửi' | 'Người nhận'
  
  // Dates
  dispatchedAt         DateTime?  // Ngày xuất kho
  cancelledAt          DateTime?  // Ngày hủy
  
  // Physical properties
  dimensions           String?    // 'DxRxC cm'
  noteToShipper        String?    // Ghi chú cho shipper
  
  // GHTK specific fields
  ghtkStatusId         Int?
  ghtkReasonCode       String?
  ghtkReasonText       String?
  ghtkTrackingId       String?
  estimatedPickTime    DateTime?
  estimatedDeliverTime DateTime?
  lastSyncedAt         DateTime?
  actualWeight         Decimal?   @db.Decimal(10, 3)
  actualFee            Decimal?   @db.Decimal(15, 2)
  
  // Activity History
  activityHistory      Json?
  
  // === RELATIONS ===
  order            Order          @relation(fields: [orderId], references: [systemId])

  @@index([carrier])
  @@index([orderId])
  @@index([status])
  @@map("shipments")
}
